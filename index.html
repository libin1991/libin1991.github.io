<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="Blog">
<meta property="og:type" content="website">
<meta property="og:title" content="LuckDay">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="LuckDay">
<meta property="og:description" content="Blog">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="LuckDay">
<meta name="twitter:description" content="Blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>LuckDay</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">LuckDay</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            æ ‡ç­¾
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            å…³äº
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/08/HTML5çš„Websocket/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/08/HTML5çš„Websocket/" itemprop="url">HTML5çš„Websocket</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-08-08T22:18:50+08:00">
                2018-08-08
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<ul>
<li>å…ˆè¯·æ¥TAçš„é‚»å±…ï¼š*<br>httpï¼šæ— çŠ¶æ€ã€åŸºäºtcpè¯·æ±‚/å“åº”æ¨¡å¼çš„åº”ç”¨å±‚åè®® ï¼ˆA:å“å‘€ï¼Œä¸Šæ¬¡ä½ è¯·æˆ‘åƒé¥­äº†ä¹ˆ? B:æˆ‘æƒ³æƒ³, ä¸Šæ¬¡è¯·ä½ åƒäº†ä¹ˆï¼‰tcpï¼šé¢å‘è¿æ¥ã€ä¿è¯é«˜å¯é æ€§(æ•°æ®æ— ä¸¢å¤±ã€æ•°æ®æ— å¤±åºã€æ•°æ®æ— é”™è¯¯ã€æ•°æ®æ— é‡å¤åˆ°è¾¾) ä¼ è¾“å±‚åè®®ã€‚ï¼ˆçœ‹å•Šï¼Œå¤§é˜…å…µï¼Œå¦‚æ­¤è§„æ•´æœ‰ç§©åºï¼‰</li>
</ul>
</blockquote>
<h2 id="ä¸ºä»€ä¹ˆè¦å¼•å…¥Websocketï¼š"><a href="#ä¸ºä»€ä¹ˆè¦å¼•å…¥Websocketï¼š" class="headerlink" title="ä¸ºä»€ä¹ˆè¦å¼•å…¥Websocketï¼š"></a>ä¸ºä»€ä¹ˆè¦å¼•å…¥Websocketï¼š</h2><blockquote>
<p>RFCå¼€ç¯‡ä»‹ç»ï¼šæœ¬åè®®çš„ç›®çš„æ˜¯ä¸ºäº†è§£å†³åŸºäºæµè§ˆå™¨çš„ç¨‹åºéœ€è¦æ‹‰å–èµ„æºæ—¶å¿…é¡»å‘èµ·å¤šä¸ªHTTPè¯·æ±‚å’Œé•¿æ—¶é—´çš„è½®è¯¢çš„é—®é¢˜ã€‚</p>
</blockquote>
<p>long poll(é•¿è½®è¯¢): å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªrequeståï¼ŒæœåŠ¡å™¨æ‹¿åˆ°è¿™ä¸ªè¿æ¥ï¼Œå¦‚æœæœ‰æ¶ˆæ¯ï¼Œæ‰è¿”å›responseç»™å®¢æˆ·ç«¯ã€‚æ²¡æœ‰æ¶ˆæ¯ï¼Œå°±ä¸€ç›´ä¸è¿”å›responseã€‚ä¹‹åå®¢æˆ·ç«¯å†æ¬¡å‘é€request, é‡å¤ä¸Šæ¬¡çš„åŠ¨ä½œã€‚</p>
<p><img src="https://pic3.zhimg.com/v2-b900392bfe564de524ec5460a2b5d235_b.jpg" alt=""><img src="https://pic3.zhimg.com/80/v2-b900392bfe564de524ec5460a2b5d235_hd.jpg" alt=""></p>
<p>ä»ä¸Šå¯ä»¥çœ‹å‡ºï¼Œhttpåè®®çš„ç‰¹ç‚¹æ˜¯æœåŠ¡å™¨ä¸èƒ½ä¸»åŠ¨è”ç³»å®¢æˆ·ç«¯ï¼Œåªèƒ½ç”±å®¢æˆ·ç«¯å‘èµ·ã€‚å®ƒçš„è¢«åŠ¨æ€§é¢„ç¤ºäº†åœ¨å®ŒæˆåŒå‘é€šä¿¡æ—¶éœ€è¦ä¸åœçš„è¿æ¥æˆ–è¿æ¥ä¸€ç›´æ‰“å¼€ï¼Œè¿™å°±éœ€è¦æœåŠ¡å™¨å¿«é€Ÿçš„å¤„ç†é€Ÿåº¦æˆ–é«˜å¹¶å‘çš„èƒ½åŠ›ï¼Œæ˜¯éå¸¸æ¶ˆè€—èµ„æºçš„ã€‚</p>
<p>è¿™ä¸ªæ—¶å€™ï¼ŒWebsocketå‡ºç°äº†ã€‚</p>
<h2 id="Websocketæ˜¯ä»€ä¹ˆï¼š"><a href="#Websocketæ˜¯ä»€ä¹ˆï¼š" class="headerlink" title="Websocketæ˜¯ä»€ä¹ˆï¼š"></a>Websocketæ˜¯ä»€ä¹ˆï¼š</h2><blockquote>
<p>RFCä¸­å†™åˆ°ï¼šWebSocketåè®®ä½¿åœ¨æ§åˆ¶ç¯å¢ƒä¸‹è¿è¡Œä¸å—ä¿¡ä»»ä»£ç çš„å®¢æˆ·ç«¯å’Œèƒ½å¤Ÿé€‰æ‹©ä¸é‚£äº›ä»£ç é€šä¿¡çš„è¿œç¨‹ä¸»æœºä¹‹é—´èƒ½å¤ŸåŒå‘é€šä¿¡ã€‚</p>
</blockquote>
<p>å¯¹ï¼Œåˆ’é‡ç‚¹ï¼šåŒå‘é€šä¿¡</p>
<p>Websocketåœ¨è¿æ¥ä¹‹åï¼Œå®¢æˆ·ç«¯å¯ä»¥ä¸»åŠ¨å‘é€æ¶ˆæ¯ç»™æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨ä¹Ÿå¯ä»¥ä¸»åŠ¨å‘å®¢æˆ·ç«¯æ¨é€æ¶ˆæ¯ã€‚æ¯”å¦‚ï¼šé¢„è®¢è½¦ç¥¨ä¿¡æ¯ï¼Œé™¤äº†æˆ‘ä»¬å‘è¯·æ±‚è¯¢é—®è½¦ç¥¨å¦‚ä½•ï¼Œå½“ç„¶æ›´å¸Œæœ›å¦‚æœæœ‰æ–°æ¶ˆæ¯ï¼Œå¯ä»¥ç›´æ¥é€šçŸ¥æˆ‘ä»¬ã€‚</p>
<p>å…¶ç‰¹ç‚¹ï¼š</p>
<p>ï¼ˆ1ï¼‰æ¡æ‰‹é˜¶æ®µé‡‡ç”¨ HTTP åè®®ï¼Œé»˜è®¤ç«¯å£æ˜¯80å’Œ443</p>
<p>ï¼ˆ2ï¼‰å»ºç«‹åœ¨TCPåè®®åŸºç¡€ä¹‹ä¸Šï¼Œå’Œhttpåè®®åŒå±äºåº”ç”¨å±‚</p>
<p>ï¼ˆ4ï¼‰å¯ä»¥å‘é€æ–‡æœ¬ï¼Œä¹Ÿå¯ä»¥å‘é€äºŒè¿›åˆ¶æ•°æ®</p>
<p>ï¼ˆ5ï¼‰æ²¡æœ‰åŒæºé™åˆ¶ï¼Œå®¢æˆ·ç«¯å¯ä»¥ä¸ä»»æ„æœåŠ¡å™¨é€šä¿¡</p>
<p>ï¼ˆ6ï¼‰åè®®æ ‡è¯†ç¬¦æ˜¯wsï¼ˆå¦‚æœåŠ å¯†ï¼Œä¸ºwssï¼‰ï¼Œå¦‚ws://localhost:8023</p>
<p>ç®€å•æ¥è¯´ï¼ŒWebsocketåè®®åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šæ¡æ‰‹å’Œæ•°æ®ä¼ è¾“ã€‚</p>
<p><img src="https://pic2.zhimg.com/v2-5b1e92b99d352ba977f69cbe28604ecf_b.jpg" alt=""><img src="https://pic2.zhimg.com/80/v2-5b1e92b99d352ba977f69cbe28604ecf_hd.jpg" alt=""></p>
<h2 id="Websocket-APIï¼š"><a href="#Websocket-APIï¼š" class="headerlink" title="Websocket APIï¼š"></a>Websocket APIï¼š</h2><blockquote>
<p>è¿™é‡Œæ˜¯æŒ‡å®¢æˆ·ç«¯ APIã€‚</p>
</blockquote>
<h2 id="WebSocket-æ„é€ å‡½æ•°"><a href="#WebSocket-æ„é€ å‡½æ•°" class="headerlink" title="WebSocket æ„é€ å‡½æ•°"></a>WebSocket æ„é€ å‡½æ•°</h2><ol>
<li><code>é€šè¿‡è°ƒç”¨WebSocketæ„é€ å‡½æ•°æ¥åˆ›å»ºä¸€ä¸ªWebSocketå®ä¾‹å¯¹è±¡ï¼Œå»ºç«‹å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨çš„è¿æ¥ã€‚</code></li>
<li><code>const ws =`</code>new<code></code>WebSocket(â€˜ws://localhost:8023â€™);`</li>
</ol>
<h2 id="Websocketäº‹ä»¶"><a href="#Websocketäº‹ä»¶" class="headerlink" title="Websocketäº‹ä»¶"></a>Websocketäº‹ä»¶</h2><ol>
<li><code>WebSocket`</code>æ˜¯çº¯äº‹ä»¶é©±åŠ¨ï¼Œé€šè¿‡ç›‘å¬äº‹ä»¶å¯ä»¥å¤„ç†åˆ°æ¥çš„æ•°æ®å’Œæ”¹å˜çš„è¿æ¥çŠ¶æ€ã€‚æœåŠ¡ç«¯å‘é€æ•°æ®åï¼Œæ¶ˆæ¯å’Œäº‹ä»¶ä¼šå¼‚æ­¥åˆ°è¾¾ã€‚`</li>
</ol>
<p>open:</p>
<p>æœåŠ¡ç«¯å“åº”WebSocketè¿æ¥è¯·æ±‚ï¼Œå°±ä¼šè§¦å‘openäº‹ä»¶ã€‚onopenæ˜¯å“åº”çš„å›è°ƒå‡½æ•°ã€‚</p>
<p><code>// è¿æ¥è¯·æ±‚openäº‹ä»¶å¤„ç†ï¼š</code></p>
<pre><code>ws.onopen=e=&gt;{
   console.log(&apos;Connection success&apos;);
   ws.send(`Hello ${e}`);
};
</code></pre><p>å¦‚æœè¦æŒ‡å®šå¤šä¸ªå›è°ƒå‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨addEventListeneræ–¹æ³•ã€‚</p>
<pre><code>ws.addEventListener(&apos;open&apos;, e =&gt; {
 ws.send(`Hello ${e}`);
});
</code></pre><p>å½“openäº‹ä»¶è§¦å‘æ—¶ï¼Œæ„å‘³ç€æ¡æ‰‹é˜¶æ®µå·²ç»“æŸã€‚æœåŠ¡ç«¯å·²ç»å¤„ç†äº†è¿æ¥çš„è¯·æ±‚ï¼Œå¯ä»¥å‡†å¤‡æ”¶å‘æ•°æ®ã€‚</p>
<p>Message:</p>
<p>æ”¶åˆ°æœåŠ¡å™¨æ•°æ®ï¼Œä¼šè§¦å‘æ¶ˆæ¯äº‹ä»¶ï¼Œonmessageæ˜¯å“åº”çš„å›è°ƒå‡½æ•°ã€‚å¦‚ä¸‹ï¼š</p>
<pre><code>// æ¥å—æ–‡æœ¬æ¶ˆæ¯çš„äº‹ä»¶å¤„ç†ï¼š
ws.onmessage = e =&gt; {
const data = e.data;
if (typeof data === &quot;string&quot;) {
       console.log(&quot;Received string message &quot;,data);
} else if (data instanceof Blob) {
       console.log(&quot;Received blob message &quot;, data);
}
};
</code></pre><p>æœåŠ¡å™¨æ•°æ®å¯èƒ½æ˜¯æ–‡æœ¬ï¼Œä¹Ÿå¯èƒ½æ˜¯äºŒè¿›åˆ¶æ•°æ®ï¼Œæœ‰Blobå’ŒArrayBufferä¸¤ç§ç±»å‹ï¼Œåœ¨è¯»å–åˆ°æ•°æ®ä¹‹å‰éœ€è¦å†³å®šå¥½æ•°æ®çš„ç±»å‹ã€‚</p>
<p>Error</p>
<p>å‘ç”Ÿé”™è¯¯ä¼šè§¦å‘erroräº‹ä»¶, onerroræ˜¯å“åº”çš„å›è°ƒå‡½æ•°, ä¼šå¯¼è‡´è¿æ¥å…³é—­ã€‚</p>
<pre><code>//å¼‚å¸¸å¤„ç†
ws.onerror = e =&gt; {
   console.log(&quot;WebSocket Error: &quot; , e);
   handleErrors(e);
};
</code></pre><p>å½“è¿æ¥å…³é—­æ—¶è§¦å‘closeäº‹ä»¶ï¼Œå¯¹åº”oncloseæ–¹æ³•ï¼Œè¿æ¥å…³é—­ä¹‹åï¼ŒæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯å°±ä¸èƒ½å†é€šä¿¡ã€‚</p>
<p>WebSocket è§„èŒƒä¸­å®šä¹‰äº†ping å¸§ å’Œpong å¸§ï¼Œå¯ä»¥ç”¨æ¥åšå¿ƒè·³é‡è¿ï¼Œç½‘ç»œçŠ¶æ€æŸ¥è¯¢ç­‰ï¼Œä½†æ˜¯ç›®å‰ æµè§ˆå™¨åªä¼šè‡ªåŠ¨å‘é€pongå¸§ï¼Œè€Œä¸ä¼šå‘ping å¸§ã€‚ï¼ˆæœ‰å…´è¶£å¯è¯¦æŸ¥pingå’Œpongå¸§ï¼‰</p>
<pre><code>//å…³é—­è¿æ¥å¤„ç†
ws.onclose = e =&gt; {
const code = e.code;
const reason = e.reason;
   console.log(&quot;Connection close&quot;, code, reason);
};
</code></pre><h2 id="WebSocket-æ–¹æ³•ï¼š"><a href="#WebSocket-æ–¹æ³•ï¼š" class="headerlink" title="WebSocket æ–¹æ³•ï¼š"></a>WebSocket æ–¹æ³•ï¼š</h2><blockquote>
<p>WebSocket å¯¹è±¡æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼šsend å’Œ close</p>
</blockquote>
<p>send:</p>
<p>å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å»ºç«‹è¿æ¥åï¼Œå¯ä»¥è°ƒç”¨sendæ–¹æ³•å»å‘é€æ¶ˆæ¯ã€‚</p>
<pre><code>//å‘é€ä¸€ä¸ªæ–‡æœ¬æ¶ˆæ¯
ws.send(&quot;this is websocket&quot;);
</code></pre><p>åœ¨openäº‹ä»¶çš„å›è°ƒä¸­è°ƒç”¨send()æ–¹æ³•ä¼ é€æ•°æ®ï¼š</p>
<pre><code>const ws = new WebSocket(&apos;ws://localhost:8023&apos;);
ws.onopen = e =&gt; {
   console.log(&apos;Connection success&apos;);
   ws.send(`Hello ${e}`);
};
</code></pre><p>å¦‚æœæƒ³é€šè¿‡å“åº”å…¶ä»–äº‹ä»¶å‘é€æ¶ˆæ¯ï¼Œå¯é€šè¿‡åˆ¤æ–­å½“å‰çš„Websocketçš„readyStateå±æ€§ã€‚æ¥ä¸‹æ¥ä¼šè¯´åˆ°readyState.</p>
<p>close</p>
<p>closeæ–¹æ³•ç”¨æ¥å…³é—­è¿æ¥ã€‚è°ƒç”¨closeæ–¹æ³•åï¼Œå°†ä¸èƒ½å‘é€æ•°æ®ã€‚closeæ–¹æ³•å¯ä»¥ä¼ å…¥ä¸¤ä¸ªå¯é€‰çš„å‚æ•°ï¼Œcode å’Œreason, ä»¥å‘Šè¯‰æœåŠ¡ç«¯ä¸ºä»€ä¹ˆç»ˆæ­¢è¿æ¥ã€‚</p>
<pre><code>ws.close();

//1000æ˜¯çŠ¶æ€ç ï¼Œä»£è¡¨æ­£å¸¸ç»“æŸã€‚
ws.close(1000, &quot;Closing normally&quot;);
</code></pre><h2 id="WebSocket-å±æ€§"><a href="#WebSocket-å±æ€§" class="headerlink" title="WebSocket å±æ€§"></a>WebSocket å±æ€§</h2><ul>
<li>readyStateï¼š</li>
</ul>
<p>readyStateå€¼è¡¨ç¤ºè¿æ¥çŠ¶æ€ï¼Œæ˜¯åªè¯»å±æ€§ã€‚å®ƒæœ‰ä»¥ä¸‹å››ä¸ªå€¼ï¼š</p>
<blockquote>
<p>WebSocket.CONNECTING ï¼šè¿æ¥æ­£åœ¨è¿›è¡Œï¼Œä½†è¿˜æ²¡æœ‰å»ºç«‹ WebSocket.OPEN ï¼šè¿æ¥å·²ç»å»ºç«‹ï¼Œå¯ä»¥å‘é€æ¶ˆæ¯ WebSocket.CLOSING ï¼šè¿æ¥æ­£åœ¨è¿›è¡Œå…³é—­æ¡æ‰‹ WebSocket.CLOSED ï¼šè¿æ¥å·²ç»å…³é—­æˆ–ä¸èƒ½æ‰“å¼€</p>
</blockquote>
<p>é™¤äº†åœ¨openäº‹ä»¶å›è°ƒä¸­è°ƒç”¨sendæ–¹æ³•ï¼Œå¯é€šè¿‡åˆ¤æ–­readyStateå€¼æ¥å‘é€æ¶ˆæ¯ã€‚</p>
<pre><code>function bindEventHandler(data) {
if (ws.readyState === WebSocket.OPEN) {
       ws.send(data);
} else {
//do something
}
} 
</code></pre><p>bufferedAmountï¼š</p>
<p>å½“å®¢æˆ·ç«¯ä¼ è¾“å¤§é‡æ•°æ®æ—¶ï¼Œæµè§ˆå™¨ä¼šç¼“å­˜å°†è¦æµå‡ºçš„æ•°æ®ï¼ŒbufferedAmountå±æ€§å¯åˆ¤æ–­æœ‰å¤šå°‘å­—èŠ‚çš„äºŒè¿›åˆ¶æ•°æ®æ²¡æœ‰å‘é€å‡ºå»ï¼Œå‘é€æ˜¯å¦ç»“æŸã€‚</p>
<pre><code>ws.onopen = function () {
   setInterval( function() {
//ç¼“å­˜æœªæ»¡çš„æ—¶å€™å‘é€
if (ws.bufferedAmount &lt; 1024 * 5) {
           ws.send(data);
}
}, 2000);
};
</code></pre><p>protocolï¼š</p>
<p>protocolä»£è¡¨å®¢æˆ·ç«¯ä½¿ç”¨çš„WebSocketåè®®ã€‚å½“æ¡æ‰‹åè®®æœªæˆåŠŸï¼Œè¿™ä¸ªå±æ€§æ˜¯ç©ºã€‚</p>
<ul>
<li>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¯´è¯´æ¡æ‰‹é˜¶æ®µè¿‡ç¨‹ã€‚*</li>
</ul>
<p>å½“æˆ‘ä»¬åˆ›å»ºWebsocketå®ä¾‹å¯¹è±¡ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥æ—¶ï¼Œ</p>
<pre><code>const ws = new WebSocket(&apos;ws://localhost:8023&apos;)ï¼›
</code></pre><p>é¦–å…ˆå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘èµ·ä¸€ä¸ªæ¡æ‰‹è¯·æ±‚ï¼Œå…¶è¯·æ±‚æŠ¥æ–‡çš„å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre><code>GET /game HTTP/1.1
Host: 10.242.17.102:8023
Cache-Control: no-cache
Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Key: dGhlIHNhbXBsZSBub25jZQ==
Sec-WebSocket-Protocol: game
Sec-WebSocket-Version: 10
Origin: http://192.168.185.16
Accept-Encoding: gzip, deflate, sdch
Accept-Language: zh-CN,zh;q=0.8
</code></pre><p>ä»è¯·æ±‚å¤´ä¸­å¯ä»¥çœ‹å‡ºï¼Œå…¶å®æ˜¯ä¸€ä¸ªåŸºäºhttpçš„æ¡æ‰‹è¯·æ±‚ã€‚ä¸é€šå¸¸çš„httpè¯·æ±‚ä¸åŒçš„æ˜¯ï¼Œå¢åŠ äº†ä¸€äº›å¤´ä¿¡æ¯ã€‚</p>
<ul>
<li>Upgradeå­—æ®µ: é€šçŸ¥æœåŠ¡å™¨ï¼Œç°åœ¨è¦ä½¿ç”¨ä¸€ä¸ªå‡çº§ç‰ˆåè®® - Websocketã€‚</li>
<li>Sec-WebSocket-Key: æ˜¯ä¸€ä¸ªBase64ç¼–ç çš„å€¼ï¼Œè¿™ä¸ªæ˜¯æµè§ˆå™¨éšæœºç”Ÿæˆ,é€šçŸ¥æœåŠ¡å™¨ï¼Œéœ€è¦éªŒè¯ä¸‹æ˜¯å¦å¯ä»¥è¿›è¡ŒWebsocketé€šä¿¡</li>
<li>Sec_WebSocket-Protocol: æ˜¯ç”¨æˆ·è‡ªå®šä¹‰çš„å­—ç¬¦ä¸²ï¼Œç”¨æ¥æ ‡è¯†æœåŠ¡æ‰€éœ€è¦çš„åè®®</li>
<li>Sec-WebSocket-Version: é€šçŸ¥æœåŠ¡å™¨æ‰€ä½¿ç”¨çš„åè®®ç‰ˆæœ¬</li>
</ul>
<p>æœåŠ¡å™¨å“åº”ï¼š</p>
<pre><code>å½“æœåŠ¡å™¨è¿”å›ä»¥ä¸‹å†…å®¹ï¼Œå°±è¡¨ç¤ºå·²ç»æ¥å—å®¢æˆ·ç«¯è¯·æ±‚å•¦ï¼Œå¯ä»¥å»ºç«‹Websocketé€šä¿¡å•¦ã€‚ 
HTTP/1.1 101 Switching Protocols
Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Accept: SIEylb7zRYJAEgiqJXaOW3V+ZWQ=
</code></pre><ul>
<li>101 çŠ¶æ€ç ï¼Œè¡¨ç¤ºè¦è½¬æ¢åè®®å•¦</li>
<li>Upgrde: é€šçŸ¥å®¢æˆ·ç«¯å°†è¦å‡çº§æˆWebsocketåè®®</li>
<li>Sec-WebSocket-Acceptï¼š ç»è¿‡æœåŠ¡å™¨ç¡®è®¤ï¼Œå¹¶ä¸”åŠ å¯†è¿‡åçš„ Sec-WebSocket-Keyã€‚ç”¨æ¥è¯æ˜å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´èƒ½è¿›è¡Œé€šä¿¡äº†ã€‚</li>
</ul>
<p><img src="https://pic4.zhimg.com/v2-05e821d0db32cf8cb5ebf51625870cb1_b.jpg" alt=""><img src="https://pic4.zhimg.com/80/v2-05e821d0db32cf8cb5ebf51625870cb1_hd.jpg" alt=""></p>
<p>è‡³æ­¤ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨æ¡æ‰‹æˆåŠŸå»ºç«‹äº†Websocketè¿æ¥ï¼Œé€šä¿¡ä¸å†ä½¿ç”¨httpæ•°æ®å¸§ï¼Œè€Œé‡‡ç”¨Websocketç‹¬ç«‹çš„æ•°æ®å¸§ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/15/nodejså‡ ç§æ–‡ä»¶è·¯å¾„åŠpathæ¨¡å—/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/15/nodejså‡ ç§æ–‡ä»¶è·¯å¾„åŠpathæ¨¡å—/" itemprop="url">Node.jså‡ ç§æ–‡ä»¶è·¯å¾„åŠpathæ¨¡å—</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-07-15T22:24:49+08:00">
                2018-07-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ€è¿‘åœ¨å†™ä¸€ç¯‡weexçš„webpacké…ç½®ï¼Œåˆšåˆšè¸©å‘äº†ï¼Œweekpackä¸­ä¼šç”¨åˆ°pathæ¨¡å—ï¼Œè€Œå¯¹äºè¿™ä¸ªæ¨¡å—ï¼Œæˆ‘æƒ³æŠ½ç¦»å‡ºæ¥çœ‹ä¸€ä¸‹ï¼Œå› ä¸ºè¿™ä¸ªç”¨åˆ°çš„è¿˜æ˜¯æ¯”è¾ƒå¤šçš„,å–œæ¬¢çš„æœ‹å‹å¯ä»¥ç‚¹ä¸ªå–œæ¬¢ï¼Œæˆ–è€…å»æˆ‘çš„<a href="https://link.zhihu.com/?target=https%3A//link.juejin.im/%3Ftarget%3Dhttps%253A%252F%252Fgithub.com%252Flaihuamin%252FJS-total" target="_blank" rel="noopener">github</a>ç‚¹ä¸ªstarä¹Ÿè¡Œï¼Œè°¢è°¢æ”¯æŒï¼Œä¸¾èµ·å°æ‰‹æŒ‡ç‚¹ä¸€ç‚¹å“¦ğŸ˜¯ï¼Œå†™çš„ä¸å¯¹çš„åœ°æ–¹ï¼Œè¯„è®ºæ‹ç –ï¼Œè°¢è°¢ã€‚</p>
<h2 id="nodeä¸­çš„è·¯å¾„åˆ†ç±»"><a href="#nodeä¸­çš„è·¯å¾„åˆ†ç±»" class="headerlink" title="nodeä¸­çš„è·¯å¾„åˆ†ç±»"></a>nodeä¸­çš„è·¯å¾„åˆ†ç±»</h2><p>nodeä¸­çš„è·¯å¾„å¤§è‡´åˆ†5ç±»ï¼Œdirname,filename,process.cwd(),./,../,å…¶ä¸­å‰ä¸‰ä¸ªéƒ½æ˜¯ç»å¯¹è·¯å¾„</p>
<p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªç®€å•ç‚¹çš„ä¾‹å­</p>
<p>å‡å¦‚ï¼Œæˆ‘æœ‰ä¸€ä¸ªæ–‡ä»¶çš„ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre><code>editor/
  - dist/
  - src/
      - task.js
</code></pre><p>ç„¶åæˆ‘ä»¬åœ¨task.jsæ–‡ä»¶ä¸­å†™å…¥ä¸€ä¸‹ä»£ç </p>
<pre><code>const path = require(&apos;path&apos;);
console.log(__dirname);
console.log(__filename);
console.log(process.cwd());
console.log(path.resolve(&apos;./&apos;));
</code></pre><p>åœ¨editorç›®å½•ä¸‹è¿è¡Œnode src/task.jsï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code>/Users/laihuamin/Documents/richEditor/editor/src
/Users/laihuamin/Documents/richEditor/editor/src/task.js
/Users/laihuamin/Documents/richEditor/editor
/Users/laihuamin/Documents/richEditor/editor
</code></pre><p>ç„¶åæˆ‘ä»¬æœ‰å¯ä»¥åœ¨srcç›®å½•ä¸‹è¿è¡Œè¿™ä¸ªæ–‡ä»¶ï¼Œnode task.js,è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code>/Users/laihuamin/Documents/richEditor/editor/src
/Users/laihuamin/Documents/richEditor/editor/src/task.js
/Users/laihuamin/Documents/richEditor/editor/src
/Users/laihuamin/Documents/richEditor/editor/src
</code></pre><p>å¯¹æ¯”ä¸¤ä¸ªè¾“å‡ºç»“æœï¼Œæˆ‘ä»¬å¯ä»¥å½’çº³ä¸€ä¸‹å‡ ç‚¹ï¼š</p>
<p>1.<strong>dirname:è¿”å›çš„æ˜¯è¿™ä¸ªæ–‡ä»¶æ‰€åœ¨æ–‡ä»¶å¤¹çš„ä½ç½®<br>2.</strong>filename:ä½ è¿è¡Œå‘½ä»¤ä»£è¡¨çš„æ˜¯æ–‡ä»¶æ‰€åœ¨çš„ä½ç½®ï¼Œä¸ç®¡ä½ è¿è¡Œä»€ä¹ˆå‘½ä»¤ï¼Œéƒ½æ˜¯æŒ‡å‘æ–‡ä»¶<br>3.process.cwd():ä½ è¿è¡Œnodeå‘½ä»¤æ‰€åœ¨æ–‡ä»¶å¤¹çš„ä½ç½®ï¼Œæ¯”å¦‚ä½ åœ¨srcç›®å½•ä¸‹è¿è¡Œï¼Œé‚£ä¹ˆå°±æ˜¯è¾“å‡ºåˆ°srcä¸ºæ­¢ï¼Œä¸‹é¢çš„åŒç†ã€‚</p>
<h2 id="path"><a href="#path" class="headerlink" title="path"></a>path</h2><p>è®²å®Œå‰é¢ä¸‰ä¸ªç»å¯¹è·¯å¾„ï¼Œæˆ‘å€’æ˜¯æŒºæƒ³æ¥èŠèŠpathè¿™ä¸ªæ¨¡å—çš„ï¼Œè¿™ä¸ªnodeæ¨¡å—åœ¨å¾ˆå¤šåœ°æ–¹éƒ½æœ‰åº”ç”¨ï¼Œæ‰€ä»¥ï¼Œå¯¹äºæˆ‘ä»¬æ¥è¯´ï¼ŒæŒæ¡ä»–ï¼Œå¯¹æˆ‘ä»¬ä»¥åçš„å‘å±•æ›´æœ‰åˆ©ï¼Œä¸ç”¨æ¯æ¬¡çœ‹webpackçš„é…ç½®æ–‡ä»¶è¿˜è¦å»æŸ¥è¯¢ä¸€ä¸‹è¿™ä¸ªapiæ˜¯å¹²ä»€ä¹ˆç”¨çš„ï¼Œå¾ˆå½±å“æˆ‘ä»¬çš„æ•ˆç‡</p>
<p><a href="https://link.zhihu.com/?target=https%3A//link.juejin.im/%3Ftarget%3Dhttps%253A%252F%252Fnodejs.org%252Fapi%252Fpath.html" target="_blank" rel="noopener">nodeJS/path</a></p>
<p>ä¸Šé¢é‚£ä¸ªç½‘ç«™æœ‰è¯¦ç»†çš„apiï¼Œä½†æ˜¯æˆ‘ä»¬è¿™é‡Œä¸ç”¨éƒ½æŒæ¡å§ï¼Œæˆ‘å°±è®²å‡ ä¸ªæˆ‘é‡åˆ°è¿‡çš„ï¼Œæˆ‘è§‰å¾—webpackç­‰å·¥ç¨‹é…ç½®ä¸­ä¼šç”¨åˆ°çš„</p>
<h2 id="path-normalize"><a href="#path-normalize" class="headerlink" title="path.normalize"></a>path.normalize</h2><p>è¿™ä¸ªæ–¹æ³•å°±æ˜¯æŠŠä¸è§„èŒƒçš„è·¯å¾„è§„èŒƒåŒ–ï¼Œæ¯”å¦‚çœ‹ä¸‹é¢çš„ä¾‹å­</p>
<pre><code>const path = require(&apos;path&apos;);
console.log(path.normalize(&apos;/foo/bar//baz/asdf/quux/..&apos;));
</code></pre><p>è¾“å‡ºç»“æœï¼š</p>
<pre><code>/foo/bar/baz/asdf
</code></pre><h2 id="path-join"><a href="#path-join" class="headerlink" title="path.join"></a>path.join</h2><pre><code>const path = require(&apos;path&apos;);
console.log(path.join(&apos;src&apos;, &apos;task.js&apos;));

const path = require(&apos;path&apos;);
console.log(path.join(&apos;dist&apos;, &apos;task.js&apos;));

const path = require(&apos;path&apos;);
console.log(path.join(&apos;&apos;));
</code></pre><p>è¿™ä¹ˆä¸¤ä¸ªçš„è¾“å‡ºç»“æœæ˜¯ï¼š</p>
<pre><code>src/task.js
dist/task.js
.
</code></pre><p>ä»–çš„ä½œç”¨ä¹Ÿå°±æ˜¾è€Œæ˜“è§ï¼Œä»–æœ‰ä¸€ä¸‹å‡ æ¡è§„åˆ™ï¼š<br>1.ä¼ å…¥çš„å‚æ•°æ˜¯å­—ç¬¦ä¸²çš„è·¯å¾„ç‰‡æ®µï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªï¼Œä¹Ÿå¯ä»¥æ˜¯å¤šä¸ª</p>
<p>2.è¿”å›çš„æ˜¯ä¸€ä¸ªæ‹¼æ¥å¥½çš„è·¯å¾„ï¼Œä½†æ˜¯æ ¹æ®å¹³å°çš„ä¸åŒï¼Œä»–ä¼šå¯¹è·¯å¾„è¿›è¡Œä¸åŒçš„è§„èŒƒåŒ–ï¼Œä¸¾ä¸ªä¾‹å­ï¼ŒUnixç³»ç»Ÿæ˜¯â€/â€œï¼ŒWindowsç³»ç»Ÿæ˜¯â€\â€œï¼Œé‚£ä¹ˆä½ åœ¨ä¸¤ä¸ªç³»ç»Ÿä¸‹çœ‹åˆ°çš„è¿”å›ç»“æœå°±ä¸ä¸€æ ·ã€‚</p>
<p>3.å¦‚æœè¿”å›çš„è·¯å¾„å­—ç¬¦ä¸²é•¿åº¦ä¸ºé›¶ï¼Œé‚£ä¹ˆä»–ä¼šè¿”å›ä¸€ä¸ªâ€™.â€™ï¼Œä»£è¡¨å½“å‰çš„æ–‡ä»¶å¤¹ã€‚</p>
<p>4.å¦‚æœä¼ å…¥çš„å‚æ•°ä¸­æœ‰ä¸æ˜¯å­—ç¬¦ä¸²çš„ï¼Œé‚£å°±ç›´æ¥ä¼šæŠ¥é”™</p>
<h2 id="path-parse"><a href="#path-parse" class="headerlink" title="path.parse"></a>path.parse</h2><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸ªä¾‹å­ï¼Œåœ¨srcç›®å½•ä¸‹çš„task.jså†™å…¥</p>
<pre><code>const path = require(&apos;path&apos;);
console.log(path.parse(&apos;/Users/laihuamin/Documents/richEditor/editor&apos;));
</code></pre><p>ç„¶åè¿è¡Œnode src/task.jsä¹‹å,è¾“å‡ºçš„ç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code>{ 
  root: &apos;/&apos;,
  dir: &apos;/Users/laihuamin/Documents/richEditor&apos;,
  base: &apos;editor&apos;,
  ext: &apos;&apos;,
  name: &apos;editor&apos; 
}
</code></pre><p>ä»–è¿”å›çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥æŠŠè¿™ä¹ˆå‡ ä¸ªåè¯ç†Ÿæ‚‰ä¸€ä¸‹ï¼š</p>
<p><img src="https://pic3.zhimg.com/v2-b7c5d496b89fde98f097a4a6e2ba7d03_b.jpg" alt=""><img src="https://pic3.zhimg.com/80/v2-b7c5d496b89fde98f097a4a6e2ba7d03_hd.jpg" alt=""></p>
<p>è¿™ä¸ªè¡¨æ ¼åº”è¯¥å±•ç¤ºçš„å¾ˆå½¢è±¡ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯æ¥è§£é‡Šä¸€ä¸‹è¿™äº›åè¯ï¼š<br>1.rootï¼šä»£è¡¨æ ¹ç›®å½•<br>2.dirï¼šä»£è¡¨æ–‡ä»¶æ‰€åœ¨çš„æ–‡ä»¶å¤¹<br>3.baseï¼šä»£è¡¨æ•´ä¸€ä¸ªæ–‡ä»¶<br>4.nameï¼šä»£è¡¨æ–‡ä»¶å<br>5.ext: ä»£è¡¨æ–‡ä»¶çš„åç¼€å</p>
<p>é‚£æˆ‘ä»¬æ ¹æ®ä¸‹é¢çš„è§„åˆ™ï¼Œæ¥çœ‹ä¸€ä¸‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼Œæœ€å¥½è‡ªå·±è„‘å­åšä¸€é</p>
<pre><code>const path = require(&apos;path&apos;);
console.log(path.parse(&apos;/Users/laihuamin/Documents/richEditor/editor/src/task.js&apos;));
</code></pre><p>è¾“å‡ºçš„ç»“æœï¼š</p>
<pre><code>{ 
  root: &apos;/&apos;,
  dir: &apos;/Users/laihuamin/Documents/richEditor/editor/src&apos;,
  base: &apos;task.js&apos;,
  ext: &apos;.js&apos;,
  name: &apos;task&apos; 
}
</code></pre><p>ä½ åšå¯¹äº†ä¹ˆï¼Ÿ0.0</p>
<h2 id="path-basename"><a href="#path-basename" class="headerlink" title="path.basename"></a>path.basename</h2><p>é‚£æœ‰äº†å‰é¢è¿™ä¸ªé“ºå«ï¼Œæƒ³å¿…è¿™ä¸ªæ¥å£çŒœä¹Ÿèƒ½çŒœçš„åˆ°äº†ã€‚ã€‚ã€‚ã€‚æˆ‘ä»¬çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­</p>
<pre><code>const path = require(&apos;path&apos;);
console.log(path.basename(&apos;/Users/laihuamin/Documents/richEditor/editor/src/task.js&apos;));
</code></pre><p>è¾“å‡ºçš„ç»“æœæ˜¯ï¼š</p>
<pre><code>task.js
</code></pre><p>æˆ‘ä»¬è¿˜æ˜¯ç®€å•ä»‹ç»ä¸€ä¸‹ï¼Œæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯path,è¿˜æœ‰ä¸€ä¸ªæ˜¯extï¼ˆå¯é€‰å‚æ•°ï¼‰.</p>
<pre><code>const path = require(&apos;path&apos;)
console.log(path.basename(&apos;/Users/laihuamin/Documents/richEditor/editor/src/task.js&apos;, &apos;.js&apos;));
</code></pre><p>è¾“å‡ºç»“æœ:</p>
<pre><code>task
</code></pre><h2 id="path-dirname"><a href="#path-dirname" class="headerlink" title="path.dirname"></a>path.dirname</h2><p>è¿™ä¸ªæ¥å£æ¯”basenameè¿˜è¦ç®€å•ï¼Œæˆ‘å°±ä¸å¤šè¯´äº†ï¼Œçœ‹ä¾‹å­ï¼Œçœ‹ç»“æœ</p>
<pre><code>const path = require(&apos;path&apos;);
console.log(path.basename(&apos;/Users/laihuamin/Documents/richEditor/editor/src/task.js&apos;));
</code></pre><p>è¾“å‡ºçš„ç»“æœ:</p>
<pre><code>/Users/laihuamin/Documents/richEditor/editor/src
</code></pre><p>æ³¨æ„ä¸€ä¸‹ï¼Œæ¥æ”¶çš„å‚æ•°æ˜¯å­—ç¬¦ä¸²ç±»å‹</p>
<h2 id="path-extname"><a href="#path-extname" class="headerlink" title="path.extname"></a>path.extname</h2><p>è¿™ä¸ªå°±æ˜¯å±•ç¤ºæ–‡ä»¶çš„æ‰©å±•åï¼Œæˆ‘ä»¬å¾—æ³¨æ„å‡ ç§æƒ…å†µ</p>
<pre><code>const path = require(&apos;path&apos;);
path.extname(&apos;index.html&apos;);
path.extname(&apos;index.coffee.md&apos;);
path.extname(&apos;index.&apos;);
path.extname(&apos;index&apos;);
path.extname(&apos;.index&apos;);
</code></pre><p>è¾“å‡ºçš„ç»“æœæ˜¯ï¼š</p>
<pre><code>.html
.md
.
&apos;&apos;
&apos;&apos;
</code></pre><p>è‡ªå·±æ³¨æ„ä¸€ä¸‹è¿™å‡ ä¸ªæƒ…å†µ</p>
<h2 id="path-resolve"><a href="#path-resolve" class="headerlink" title="path.resolve"></a>path.resolve</h2><p>æˆ‘ä»¬é€šè¿‡ä¸‹é¢è¿™å‡ ä¸ªä¾‹å­å…ˆæ¥ç†Ÿæ‚‰ä¸€ä¸‹ï¼š</p>
<pre><code>const path = require(&apos;path&apos;);
console.log(path.resolve(&apos;/foo/bar&apos;, &apos;/bar/faa&apos;, &apos;..&apos;, &apos;a/../c&apos;));
</code></pre><p>è¾“å‡ºçš„ç»“æœæ˜¯</p>
<pre><code>/bar/c
</code></pre><p>ä»–å°±ç›¸å½“äºä¸€å †cdæ“ä½œï¼Œæˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥çœ‹</p>
<pre><code>cd /foo/bar/    //è¿™æ˜¯ç¬¬ä¸€æ­¥, ç°åœ¨çš„ä½ç½®æ˜¯/foo/bar/
cd /bar/faa     //è¿™æ˜¯ç¬¬äºŒæ­¥ï¼Œè¿™é‡Œå’Œç¬¬ä¸€æ­¥æœ‰åŒºåˆ«ï¼Œä»–æ˜¯ä»/è¿›å…¥çš„ï¼Œä¹Ÿå°±æ—¶å€™æ ¹ç›®å½•ï¼Œç°åœ¨çš„ä½ç½®æ˜¯/bar/faa
cd ..       //ç¬¬ä¸‰æ­¥ï¼Œä»faaé€€å‡ºæ¥ï¼Œç°åœ¨çš„ä½ç½®æ˜¯ /bar
cd a/../c   //ç¬¬å››æ­¥ï¼Œè¿›å…¥aï¼Œç„¶ååœ¨æ¨å‡ºï¼Œåœ¨è¿›å…¥cï¼Œæœ€åä½ç½®æ˜¯/bar/c
</code></pre><p>ä½†æ˜¯è¿™ä¸ªæ“ä½œå’Œcdè¿˜æ˜¯æœ‰åŒºåˆ«çš„ï¼Œè¿™ä¸ªè·¯å¾„ä¸ä¸€å®šè¦å­˜åœ¨ï¼Œè€Œä¸”æœ€åçš„å¯ä»¥æ˜¯æ–‡ä»¶</p>
<h2 id="path-relative"><a href="#path-relative" class="headerlink" title="path.relative"></a>path.relative</h2><p>è¿™ä¸ªè¿”å›çš„æ˜¯fromåˆ°toçš„ç›¸å¯¹è·¯å¾„ï¼Œä»€ä¹ˆæ„æ€å‘¢ï¼Œæˆ‘ä»¬çœ‹ä¸‹é¢çš„ä¾‹å­å°±çŸ¥é“äº†.</p>
<pre><code>const path = require(&apos;path&apos;);
console.log(path.relative(&apos;src/bar/baz&apos;, &apos;src/aaa/bbb&apos;));
</code></pre><p>è¾“å‡ºçš„ç»“æœæ˜¯ï¼š</p>
<pre><code>../../aaa/bbb
</code></pre><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿™äº›æ¯”è¾ƒå®ç”¨çš„æ–¹æ³•ï¼Œåˆ†äº«ç»™å¤§å®¶ï¼Œè‡ªå·±è¿˜æ˜¯è€è€å®å®å»çœ‹weektoolçš„webpackçš„é…ç½®æ–‡ä»¶äº†ï¼Œå–œæ¬¢çš„æœ‹å‹å¯ä»¥ç‚¹ä¸ªå–œæ¬¢ï¼Œæˆ–è€…å»æˆ‘çš„<a href="https://link.zhihu.com/?target=https%3A//link.juejin.im/%3Ftarget%3Dhttps%253A%252F%252Fgithub.com%252Flaihuamin%252FJS-total" target="_blank" rel="noopener">github</a>ç‚¹ä¸ªstarä¹Ÿè¡Œï¼Œè°¢è°¢æ”¯æŒï¼Œä¸¾èµ·å°æ‰‹æŒ‡ç‚¹ä¸€ç‚¹å“¦ğŸ˜¯ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/02/ES6-å®ç°è‡ªå·±çš„-Promise/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/02/ES6-å®ç°è‡ªå·±çš„-Promise/" itemprop="url">ES6å®ç°è‡ªå·±çš„ Promise</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-07-02T22:15:53+08:00">
                2018-07-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="ä¸€ã€JavaScriptå¼‚æ­¥ç¼–ç¨‹èƒŒæ™¯"><a href="#ä¸€ã€JavaScriptå¼‚æ­¥ç¼–ç¨‹èƒŒæ™¯" class="headerlink" title="ä¸€ã€JavaScriptå¼‚æ­¥ç¼–ç¨‹èƒŒæ™¯"></a>ä¸€ã€JavaScriptå¼‚æ­¥ç¼–ç¨‹èƒŒæ™¯</h2><p>ä»å»å¹´ES2015å‘å¸ƒè‡³ä»Šï¼Œå·²ç»è¿‡å»äº†ä¸€å¹´å¤šï¼ŒES2015å‘å¸ƒçš„æ–°çš„è¯­è¨€ç‰¹æ€§ä¸­æœ€ä¸ºæµè¡Œçš„ä¹Ÿå°±è«è¿‡äºPromiseäº†ï¼ŒPromiseä½¿å¾—å¦‚ä»ŠJavaScriptå¼‚æ­¥ç¼–ç¨‹å¦‚æ­¤è½»æ¾æƒ¬æ„ï¼Œç”šè‡³æ…¢æ…¢é—å¿˜äº†æ›¾ç»é‚£ä¸å ªå›é¦–çš„ç—›æ¥šã€‚å…¶å®ä»JavaScriptè¯ç”Ÿï¼ŒJavaScriptä¸­çš„å¼‚æ­¥ç¼–ç¨‹å°±å·²ç»å‡ºç°ï¼Œä¾‹å¦‚ç‚¹å‡»é¼ æ ‡ã€æ•²å‡»é”®ç›˜è¿™äº›äº‹ä»¶çš„å¤„ç†å‡½æ•°éƒ½æ˜¯å¼‚æ­¥çš„ï¼Œæ—¶é—´åˆ°äº†2009å¹´ï¼ŒNode.jsæ¨ªç©ºå‡ºä¸–ï¼Œåœ¨æ•´ä¸ªNode.jsçš„å®ç°ä¸­ï¼Œå°†å›è°ƒæ¨¡å¼çš„å¼‚æ­¥ç¼–ç¨‹æœºåˆ¶å‘æŒ¥çš„æ·‹æ¼“å°½è‡´ï¼ŒNodeçš„æµè¡Œä¹Ÿæ˜¯çš„è¶Šæ¥è¶Šå¤šçš„JavaScripterå¼€å§‹äº†å¼‚æ­¥ç¼–ç¨‹ï¼Œä½†æ˜¯å›è°ƒæ¨¡å¼çš„å‰¯ä½œç”¨ä¹Ÿæ…¢æ…¢å±•ç°åœ¨äººä»¬çœ¼å‰ï¼Œé”™è¯¯å¤„ç†ä¸å¤Ÿä¼˜é›…ä»¥åŠåµŒå¥—å›è°ƒå¸¦æ¥çš„â€œå›è°ƒåœ°ç‹±â€ã€‚è¿™äº›å‰¯ä½œç”¨ä½¿å¾—äººä»¬ä»å›è°ƒæ¨¡å¼çš„æ¸©æŸ”ä¹¡ä¸­æ…¢æ…¢æ¸…é†’è¿‡æ¥ï¼Œå¼€å§‹å¯»æ‰¾æ›´ä¸ºä¼˜é›…çš„å¼‚æ­¥ç¼–ç¨‹æ¨¡å¼ï¼Œè·¯æ¼«æ¼«å…¶ä¿®è¿œå…®ã€å¾å°†ä¸Šä¸‹è€Œæ±‚ç´¢ã€‚æ—¶é—´åˆ°äº†2015å¹´ï¼ŒPromiseæ‹¯æ•‘é‚£äº›è‹¦è‹¦æ¢ç´¢çš„å…ˆé©±ã€‚è¡Œä½¿å®ƒå†å²ä½¿å‘½çš„æ—¶ä»£ä¼¼ä¹å·²ç»åˆ°æ¥ã€‚</p>
<p>æ¯ä¸ªäº‹ç‰©çš„è¯ç”Ÿæœ‰ä»–çš„å†å²ä½¿å‘½ï¼Œæ›´æœ‰å…¶å†å²æˆå› ï¼Œä¿ƒè¿›å…¶è¢«é‚£äº›æ¢ç´¢çš„å…ˆé©±ä»¬æ‰€å‘ç°ã€‚äº†è§£nodejsæˆ–è€…ç†Ÿæ‚‰æµè§ˆå™¨çš„äººéƒ½çŸ¥é“ï¼ŒJavaScriptå¼•æ“æ˜¯åŸºäºäº‹ä»¶å¾ªç¯æˆ–å•çº¿ç¨‹è¿™ä¸¤ä¸ªç‰¹æ€§çš„ã€‚æ›´ä¸ºç”šè€…åœ¨æµè§ˆå™¨ä¸­ï¼Œæ›´æ–°UI(ä¹Ÿå°±æ˜¯æµè§ˆå™¨é‡ç»˜ã€é‡æ‹é¡µé¢å¸ƒå±€)å’Œæ‰§è¡ŒJavaScriptä»£ç ä¹Ÿåœ¨ä¸€ä¸ªå•çº¿ç¨‹ä¸­ï¼Œå¯æƒ³è€ŒçŸ¥ï¼Œä¸€ä¸ªçº¿ç¨‹å°±ç›¸å½“äºåªæœ‰ä¸€æ¡é©¬è·¯ï¼Œå¦‚æœä¸€è¾†é©¬è½¦æŠ›é”šåœ¨è·¯ä¸Šäº†é˜»å¡äº†é©¬è·¯ï¼Œé‚£ä¹ˆåˆ«çš„é©¬è½¦ä¹Ÿå°±æ‹¥å µåœ¨äº†é‚£å„¿ï¼Œè¿™ä¸ªå•çº¿ç¨‹å®¹æ˜“è¢«é˜»å¡æ˜¯ä¸€ä¸ªé“ç†ï¼Œå•çº¿ç¨‹ä¹Ÿåªèƒ½å…è®¸æŸä¸€æ—¶é—´ç‚¹åªèƒ½å¤Ÿæ‰§è¡Œä¸€æ®µä»£ç ã€‚åŒæ—¶ï¼ŒJavaScriptæ²¡æœ‰æƒ³å®ƒçš„å“¥å“¥å§å§ä»¬é‚£ä¹ˆè´¢å¤§æ°”ç²—ï¼ŒåƒJavaæˆ–è€…C++ï¼Œä¸€ä¸ªçº¿ç¨‹ä¸å¤Ÿï¼Œé‚£ä¹ˆå†åŠ ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™æ ·å°±èƒ½å¤ŸåŒæ—¶æ‰§è¡Œå¤šæ®µä»£ç äº†ï¼Œä½†æ˜¯è¿™æ ·å°±ä¼šå¸¦æ¥çš„éšæ‚£å°±æ˜¯çŠ¶æ€ä¸å®¹æ˜“ç»´æŠ¤ï¼ŒJavaScripté€‰æ‹©äº†å•çº¿ç¨‹éé˜»å¡å¼çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯å¼‚æ­¥ç¼–ç¨‹çš„æ–¹å¼ï¼Œå°±åƒä¸Šé¢çš„é©¬è½¦æŠ›é”šåœ¨äº†è·¯ä¸Šï¼Œé‚£ä¹ˆæŠŠé©¬è½¦æ¨åˆ°è·¯è¾¹çš„ç»´ä¿®ç«™ï¼Œè®©å…¶ä»–é©¬è½¦å…ˆè¿‡å»ï¼Œç­‰é©¬è½¦ä¿®å¥½äº†å†å›åˆ°é©¬è·¯ä¸Šç»§ç»­è¡Œé©¶ï¼Œè¿™å°±æ˜¯å•çº¿ç¨‹éé˜»å¡æ–¹å¼ã€‚æ­£å¦‚Promiseçš„å·¥ä½œæ–¹å¼ä¸€æ ·ï¼Œé€šè¿‡Promiseå»å‘æœåŠ¡å™¨å‘èµ·ä¸€ä¸ªè¯·æ±‚ï¼Œæ¯•ç«Ÿè¯·æ±‚æœ‰ç½‘ç»œå¼€é”€ï¼Œä¸å¯èƒ½é©¬ä¸Šå°±è¿”å›è¯·æ±‚ç»“æœçš„ï¼Œè¿™ä¸ªæ—¶å€™Promiseå°±å¤„äºpendingçŠ¶æ€ï¼Œä½†æ˜¯å…¶å¹¶ä¸ä¼šé˜»å¡å…¶ä»–ä»£ç çš„æ‰§è¡Œï¼Œå½“è¯·æ±‚è¿”å›æ—¶ï¼Œä¿®æ”¹PromiseçŠ¶æ€ä¸ºfulfilledæˆ–è€…rejectedï¼ˆå¤±è´¥è¯·æ±‚ï¼‰ã€‚åŒæ—¶æ‰§è¡Œç»‘å®šåˆ°è¿™ä¸¤ä¸ªçŠ¶æ€ä¸Šé¢çš„â€œå¤„ç†å‡½æ•°â€ã€‚è¿™å°±æ˜¯å¼‚æ­¥ç¼–ç¨‹çš„æ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯Promiseå…¢å…¢ä¸šä¸šçš„å·¥ä½œæ–¹å¼ï¼Œåœ¨ä¸‹é¢ä¸€ä¸ªéƒ¨åˆ†å°†è¯¦ç»†è®¨è®ºPromiseã€‚</p>
<h2 id="äºŒã€PromiseåŸºç¡€"><a href="#äºŒã€PromiseåŸºç¡€" class="headerlink" title="äºŒã€PromiseåŸºç¡€"></a>äºŒã€PromiseåŸºç¡€</h2><p>æ€ä¹ˆä¸€å¥è¯è§£é‡ŠPromiseå‘¢ï¼ŸPromiseå¯ä»¥ä»£æŒ‡é‚£äº›å°šæœªå®Œæˆçš„ä¸€äº›æ“ä½œï¼Œä½†æ˜¯å…¶åœ¨æœªæ¥çš„æŸä¸ªæ—¶é—´ä¼šè¿”å›æŸä¸€ç‰¹å®šçš„ç»“æœã€‚</p>
<p>å½“åˆ›å»ºä¸€ä¸ªPromiseå®ä¾‹åï¼Œå…¶ä»£è¡¨ä¸€ä¸ªæœªçŸ¥çš„å€¼ï¼Œåœ¨å°†æ¥çš„æŸä¸ªæ—¶é—´ä¼šè¿”å›ä¸€ä¸ªæˆåŠŸçš„è¿”å›å€¼ï¼Œæˆ–è€…å¤±è´¥çš„è¿”å›å€¼ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºè¿™äº›è¿”å›å€¼æ·»åŠ å¤„ç†å‡½æ•°ï¼Œå½“å€¼è¿”å›æ—¶ï¼Œå¤„ç†å‡½æ•°è¢«è°ƒç”¨ã€‚Promiseæ€»æ˜¯å¤„äºä¸‹é¢ä¸‰ç§çŠ¶æ€ä¹‹ä¸€ï¼š</p>
<ul>
<li>pendingï¼š Promiseçš„åˆå§‹çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯æœªè¢«fulfilledæˆ–è€…rejectedçš„çŠ¶æ€ã€‚</li>
<li>fulfilledï¼š æ„å‘³ç€promiseä»£æŒ‡çš„æ“ä½œå·²ç»æˆåŠŸå®Œæˆã€‚</li>
<li>rejectedï¼šæ„å‘³ç€promiseä»£æŒ‡çš„æ“ä½œç”±äºæŸäº›åŸå› å¤±è´¥ã€‚</li>
</ul>
<p>ä¸€ä¸ªå¤„äºpendingçŠ¶æ€çš„promiseå¯èƒ½ç”±äºæŸä¸ªæˆåŠŸè¿”å›å€¼è€Œå‘å±•ä¸ºfulfilledçŠ¶æ€ï¼Œä¹Ÿæœ‰å¯èƒ½å› ä¸ºæŸäº›é”™è¯¯è€Œè¿›å…¥rejectedçŠ¶æ€ï¼Œæ— è®ºæ˜¯è¿›å…¥fulfilledçŠ¶æ€æˆ–è€…rejectedçŠ¶æ€ï¼Œç»‘å®šåˆ°è¿™ä¸¤ç§çŠ¶æ€ä¸Šé¢çš„å¤„ç†å‡½æ•°å°±ä¼šè¢«æ‰§è¡Œã€‚å¹¶ä¸”è¿›å…¥fulfilledæˆ–è€…rejectedçŠ¶æ€ä¹Ÿå°±ä¸èƒ½å†è¿”å›pendingçŠ¶æ€äº†ã€‚<br><img src="https://pic4.zhimg.com/v2-cf3e4ae1a35caad7c2d8d7bdd8c763d2_b.jpg" alt=""><img src="https://pic4.zhimg.com/80/v2-cf3e4ae1a35caad7c2d8d7bdd8c763d2_hd.jpg" alt=""></p>
<h2 id="ä¸‰ã€è¾¹å­¦è¾¹å†™"><a href="#ä¸‰ã€è¾¹å­¦è¾¹å†™" class="headerlink" title="ä¸‰ã€è¾¹å­¦è¾¹å†™"></a>ä¸‰ã€è¾¹å­¦è¾¹å†™</h2><p>ä¸Šé¢è¯´äº†é‚£ä¹ˆå¤šï¼Œå…¶å®éƒ½æ˜¯é“ºå«ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°±å¼€å§‹å®ç°è‡ªå·±çš„Promiseå¯¹è±¡ã€‚go go goï¼ï¼ï¼</p>
<h2 id="ç¬¬ä¸€æ­¥ï¼šPromiseæ„é€ å‡½æ•°"><a href="#ç¬¬ä¸€æ­¥ï¼šPromiseæ„é€ å‡½æ•°" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼šPromiseæ„é€ å‡½æ•°"></a>ç¬¬ä¸€æ­¥ï¼šPromiseæ„é€ å‡½æ•°</h2><p>Promiseæœ‰ä¸‰ç§çŠ¶æ€ï¼Œpendingã€fulfilledã€rejectedã€‚</p>
<pre><code>const PENDING = &apos;PENDING&apos; // Promise çš„ åˆå§‹çŠ¶æ€
const FULFILLED = &apos;FULFILLED&apos; // Promise æˆåŠŸè¿”å›åçš„çŠ¶æ€
const REJECTED = &apos;REJECTED&apos; // Promise å¤±è´¥åçš„çŠ¶æ€
</code></pre><p>æœ‰äº†ä¸‰ç§çŠ¶æ€åï¼Œé‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆåˆ›å»ºä¸€ä¸ªPromiseå®ä¾‹å‘¢ï¼Ÿ</p>
<blockquote>
<p>const promise = new Promise(executor) // åˆ›å»ºPromiseçš„è¯­æ³•</p>
</blockquote>
<p>é€šè¿‡ä¸Šé¢ç”Ÿæˆpromiseè¯­æ³•æˆ‘ä»¬çŸ¥é“ï¼ŒPromiseå®ä¾‹æ˜¯è°ƒç”¨Promiseæ„é€ å‡½æ•°é€šè¿‡newæ“ä½œç¬¦ç”Ÿæˆçš„ã€‚è¿™ä¸ªæ„é€ å‡½æ•°æˆ‘ä»¬å¯ä»¥å…ˆè¿™æ ·å†™ï¼š</p>
<pre><code>class Promise {
    constructor(executor) {
        this.status = PENDING // åˆ›å»ºä¸€ä¸ªpromiseæ—¶ï¼Œé¦–å…ˆè¿›è¡ŒçŠ¶æ€åˆå§‹åŒ–ã€‚pending
        this.result = undefined // resultå±æ€§ç”¨æ¥ç¼“å­˜promiseçš„è¿”å›ç»“æœï¼Œå¯ä»¥æ˜¯æˆåŠŸçš„è¿”å›ç»“æœï¼Œæˆ–å¤±è´¥çš„è¿”å›ç»“æœ
    }
}
</code></pre><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸Šé¢æ„é€ å‡½æ•°æ¥å—çš„å‚æ•°executorã€‚å®ƒæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶ä¸”æ¥å—å…¶ä»–ä¸¤ä¸ªå‡½æ•°ï¼ˆresolveå’Œrejectï¼‰ä½œä¸ºå‚æ•°ï¼Œå½“resolveå‡½æ•°è°ƒç”¨åï¼Œpromiseçš„çŠ¶æ€è½¬åŒ–ä¸ºfulfilledï¼Œå¹¶ä¸”æ‰§è¡ŒæˆåŠŸè¿”å›çš„å¤„ç†å‡½æ•°ï¼ˆä¸ç”¨ç€æ€¥åé¢ä¼šè¯´åˆ°æ€ä¹ˆæ·»åŠ å¤„ç†å‡½æ•°ï¼‰ã€‚å½“rejectå‡½æ•°è°ƒç”¨åï¼ŒpromiseçŠ¶æ€è½¬åŒ–ä¸ºrejectedï¼Œå¹¶ä¸”æ‰§è¡Œå¤±è´¥è¿”å›çš„å¤„ç†å‡½æ•°ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬çš„ä»£ç å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code>class Promise {
    constructor(executor) {
        this.status = PENDING 
        this.result = undefined
        executor(data =&gt; resolveProvider(this, data), err =&gt; rejectProvider(this, err))
    }
}

function resolveProvider(promise, data) {
    if (promise.status !== PENDING) return false
    promise.status = FULFILLED
}
function rejectProvider(promise, data) {
    if (promise.status !== PENDING) return false
    promise.status = FULFILLED
}
</code></pre><p>Dont Repeat Yourseltï¼ï¼ï¼æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸Šé¢ä»£ç åé¢ä¸¤ä¸ªå‡½æ•°åŸºæœ¬ç›¸åŒï¼Œå…¶å®æˆ‘ä»¬å¯ä»¥æŠŠå®ƒæ•´åˆæˆä¸€ä¸ªå‡½æ•°ï¼Œåœ¨ç»“åˆé«˜é˜¶å‡½æ•°çš„ä½¿ç”¨ã€‚</p>
<pre><code>const statusProvider = (promise, status) =&gt; data =&gt; {
    if (promise.status !== PENDING) return false
    promise.status = status
    promise.result = data
}
class Promise {
    constructor(executor) {
        this.status = PENDING 
        this.result = undefined
        executor(statusProvider(this, FULFILLED), statusProvider(this, REJECTED))
    }
}
</code></pre><p>ç°åœ¨æˆ‘ä»¬çš„ä»£ç å°±çœ‹ä¸Šå»ç®€æ´å¤šäº†ã€‚</p>
<h2 id="ç¬¬äºŒæ­¥ï¼šä¸ºPromiseæ·»åŠ å¤„ç†å‡½æ•°"><a href="#ç¬¬äºŒæ­¥ï¼šä¸ºPromiseæ·»åŠ å¤„ç†å‡½æ•°" class="headerlink" title="ç¬¬äºŒæ­¥ï¼šä¸ºPromiseæ·»åŠ å¤„ç†å‡½æ•°"></a>ç¬¬äºŒæ­¥ï¼šä¸ºPromiseæ·»åŠ å¤„ç†å‡½æ•°</h2><p>å…¶å®é€šè¿‡ <code>new Promise(executor)</code>å·²ç»å¯ä»¥ç”Ÿæˆä¸€ä¸ªPromiseå®ä¾‹äº†ï¼Œç”šè‡³æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¼ é€’åˆ°executorä¸­çš„resolveå’Œrejectæ–¹æ³•æ¥æ”¹å˜promiseçŠ¶æ€ï¼Œä½†æ˜¯ï¼ç°åœ¨çš„promiseä¾ç„¶æ²¡å•¥åµç”¨ï¼ï¼ï¼å› ä¸ºæˆ‘ä»¬å¹¶æ²¡æœ‰ç»™å®ƒæ·»åŠ æˆåŠŸå’Œå¤±è´¥è¿”å›çš„å¤„ç†å‡½æ•°ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬éœ€è¦ç»™æˆ‘ä»¬çš„promiseå¢åŠ ä¸¤ä¸ªå±æ€§ï¼ŒsuccessListenerå’ŒfailureListenerç”¨æ¥åˆ†åˆ«ç¼“å­˜æˆåŠŸå¤„ç†å‡½æ•°å’Œå¤±è´¥å¤„ç†å‡½æ•°ã€‚</p>
<pre><code>class Promise {
    constructor(executor) {
        this.status = PENDING
         this.successListener = []
         this.failureListener = []
        this.result = undefined
        executor(statusProvider(this, FULFILLED), statusProvider(this, REJECTED))
    }
}
</code></pre><p>æ€ä¹ˆæ·»åŠ å¤„ç†å‡½æ•°å‘¢ï¼ŸECMASCRIPTæ ‡å‡†ä¸­è¯´åˆ°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡promiseåŸå‹ä¸Šé¢çš„thenæ–¹æ³•ä¸ºpromiseæ·»åŠ æˆåŠŸå¤„ç†å‡½æ•°å’Œå¤±è´¥å¤„ç†å‡½æ•°ï¼Œå¯ä»¥é€šè¿‡catchæ–¹æ³•ä¸ºpromiseæ·»åŠ å¤±è´¥å¤„ç†å‡½æ•°ã€‚</p>
<pre><code>const statusProvider = (promise, status) =&gt; data =&gt; {
    if (promise.status !== PENDING) return false
    promise.status = status
    promise.result = data
    switch(status) {
        case FULFILLED: return promise.successListener.forEach(fn =&gt; fn(data))
        case REJECTED: return promise.failurelistener.forEach(fn =&gt; fn(data))
    }
}
class Promise {
    constructor(executor) {
        this.status = PENDING
        this.successListener = []
        this.failurelistener = []
        this.result = undefined
        executor(statusProvider(this, FULFILLED), statusProvider(this, REJECTED))
    }
    /**
     * PromiseåŸå‹ä¸Šé¢çš„æ–¹æ³•
     */
    then(...args) {
        switch (this.status) {
            case PENDING: {
                this.successListener.push(args[0])
                this.failurelistener.push(args[1])
                break
            }
            case FULFILLED: {
                args[0](this.result)
                break
            }
            case REJECTED: {
                args[1](this.result)
            }
        }
    }
    catch(arg) {
        return this.then(undefined, arg)
    }
}
</code></pre><p>æˆ‘ä»¬ç°åœ¨çš„PromiseåŸºæœ¬åˆå…·é›å½¢äº†ã€‚ç”šè‡³å¯ä»¥è¿ç”¨åˆ°ä¸€äº›ç®€å•çš„åœºæ™¯ä¸­äº†ã€‚ä¸¾ä¸ªä¾‹å­ã€‚</p>
<pre><code>/*åˆ›å»ºä¸€ä¸ªå»¶æ—¶resolveçš„pormise*/
new Promise((resolve, reject) =&gt; {setTimeout(() =&gt; resolve(5), 2000)}).then(data =&gt; console.log(data)) // 5
/*åˆ›å»ºä¸€ä¸ªåŠæ—¶resolveçš„promise*/
new Promise((resolve, reject) =&gt; resolve(5)).then(data =&gt; console.log(data)) // 5
/*é“¾å¼è°ƒç”¨thenæ–¹æ³•è¿˜ä¸èƒ½å¤Ÿä½¿ç”¨ï¼*/
new Promise(resolve=&gt; resolve(5)).then(data =&gt; data).then(data =&gt; console.log(data))
// Uncaught TypeError: Cannot read property &apos;then&apos; of undefined
</code></pre><h2 id="ç¬¬ä¸‰æ­¥ï¼šPromiseçš„é“¾å¼è°ƒç”¨"><a href="#ç¬¬ä¸‰æ­¥ï¼šPromiseçš„é“¾å¼è°ƒç”¨" class="headerlink" title="ç¬¬ä¸‰æ­¥ï¼šPromiseçš„é“¾å¼è°ƒç”¨"></a>ç¬¬ä¸‰æ­¥ï¼šPromiseçš„é“¾å¼è°ƒç”¨</h2><p>Promiseéœ€è¦å®ç°é“¾å¼è°ƒç”¨ï¼Œæˆ‘ä»¬éœ€è¦å†æ¬¡å›é¡¾ä¸‹thenæ–¹æ³•çš„å®šä¹‰ï¼š</p>
<blockquote>
<p>thenæ–¹æ³•ä¸ºpormiseæ·»åŠ æˆåŠŸå’Œå¤±è´¥çš„å¤„ç†å‡½æ•°ï¼ŒåŒæ—¶thenæ–¹æ³•è¿”å›ä¸€ä¸ªæ–°çš„promiseå¯¹è±¡ï¼Œè¿™ä¸ªæ–°çš„promiseå¯¹è±¡resolveå¤„ç†å‡½æ•°çš„è¿”å›å€¼ï¼Œæˆ–è€…å½“æ²¡æœ‰æä¾›å¤„ç†å‡½æ•°æ—¶ç›´æ¥resolveåŸå§‹çš„å€¼ã€‚</p>
</blockquote>
<p>å¯ä»¥çœ‹å‡ºï¼Œpromiseèƒ½å¤Ÿé“¾å¼è°ƒç”¨å½’åŠŸäºthenæ–¹æ³•è¿”å›ä¸€ä¸ªå…¨æ–°çš„promiseï¼Œå¹¶ä¸”resolveå¤„ç†å‡½æ•°çš„è¿”å›å€¼ï¼Œå½“ç„¶ï¼Œå¦‚æœthenæ–¹æ³•çš„å¤„ç†å‡½æ•°æœ¬èº«å°±è¿”å›ä¸€ä¸ªpromiseï¼Œé‚£ä¹ˆä¹…ä¸ç”¨æˆ‘ä»¬è‡ªå·±æ‰‹åŠ¨ç”Ÿæˆä¸€ä¸ªpromiseäº†ã€‚äº†è§£äº†è¿™äº›ï¼Œå°±å¼€å§‹åŠ¨æ‰‹å†™ä»£ç äº†ã€‚</p>
<pre><code>const isPromise = object =&gt; object &amp;&amp; object.then &amp;&amp; typeof object.then === &apos;function&apos;
const noop = () =&gt; {}

const statusProvider = (promise, status) =&gt; data =&gt; {
    // åŒä¸Šé¢ä»£ç 
}

class Promise {
    constructor(executor) {
        // åŒä¸Šé¢ä»£ç 
    }
    then(...args) {
        const child = new this.constructor(noop)

        const handler = fn =&gt; data =&gt; {
            if (typeof fn === &apos;function&apos;) {
                const result = fn(data)
                if (isPromise(result)) {
                    Object.assign(child, result)
                } else {
                    statusProvider(child, FULFILLED)(result)
                }   
            } else if(!fn) {
                statusProvider(child, this.status)(data)
            }
        }
        switch (this.status) {
            case PENDING: {
                this.successListener.push(handler(args[0]))
                this.failurelistener.push(handler(args[1]))
                break
            }
            case FULFILLED: {
                handler(args[0])(this.result)
                break
            }
            case REJECTED: {
                handler(args[1])(this.result)
                break
            }
        }
        return child
    }
    catch(arg) {
        return this.then(undefined, arg)
    }
}
</code></pre><p>é¦–å…ˆæˆ‘ä»¬å†™äº†ä¸€ä¸ªisPromiseæ–¹æ³•ï¼Œç”¨äºåˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯promiseã€‚å°±æ˜¯åˆ¤æ–­å¯¹è±¡æ˜¯å¦æœ‰ä¸€ä¸ª<code>then</code>æ–¹æ³•ï¼Œå…è´£å£°æ˜ä¸ºäº†å®ç°ä¸Šçš„ç®€å•ï¼Œæˆ‘ä»¬ä¸åŒºåˆ†thenableå’Œpromiseçš„åŒºåˆ«ï¼Œä½†æ˜¯æˆ‘ä»¬åº”è¯¥æ˜¯çŸ¥é“ã€‚æ‰€æœ‰çš„promiseéƒ½æ˜¯thenableçš„ï¼Œè€Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„thenableå¯¹è±¡éƒ½æ˜¯promiseã€‚ï¼ˆthenableå¯¹è±¡æ˜¯æŒ‡å¸¦æœ‰ä¸€ä¸ªthenæ–¹æ³•çš„å¯¹è±¡ï¼Œè¯¥thenæ–¹æ³•å…¶å®å°±æ˜¯ä¸€ä¸ªexecutorã€‚ï¼‰isPromiseçš„ä½œç”¨å°±æ˜¯ç”¨äºåˆ¤æ–­thenæ–¹æ³•è¿”å›å€¼æ˜¯å¦æ˜¯ä¸€ä¸ªpromiseï¼Œå¦‚æœæ˜¯promiseï¼Œå°±ç›´æ¥è¿”å›è¯¥promiseï¼Œå¦‚æœä¸æ˜¯ï¼Œå°±æ–°ç”Ÿæˆä¸€ä¸ªpromiseå¹¶è¿”å›è¯¥promiseã€‚</p>
<p>ç”±äºéœ€è¦é“¾å¼è°ƒç”¨ï¼Œæˆ‘ä»¬å¯¹successListenerå’ŒfailureListenerä¸­å¤„ç†å‡½æ•°è¿›è¡Œäº†é‡å†™ï¼Œå¹¶ä¸æ˜¯ç›´æ¥pushè¿›å»thenæ–¹æ³•æ¥å—çš„å‚æ•°å‡½æ•°äº†ï¼Œå› ä¸ºthenæ–¹æ³•éœ€è¦è¿”å›ä¸€ä¸ªpromiseï¼Œæ‰€ä»¥å½“thenæ–¹æ³•é‡Œé¢çš„å¤„ç†å‡½æ•°è¢«æ‰§è¡Œçš„åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦å¯¹thenæ–¹æ³•è¿”å›çš„è¿™ä¸ªpromiseè¿›è¡Œå¤„ç†ï¼Œè¦ä¹ˆresolveï¼Œè¦ä¹ˆrejectæ‰ã€‚å½“ç„¶ï¼Œå¤§éƒ¨åˆ†æƒ…å†µéƒ½æ˜¯éœ€è¦resolveæ‰çš„ï¼Œåªæœ‰å½“thenæ–¹æ³•æ²¡æœ‰æ·»åŠ ç¬¬äºŒä¸ªå‚æ•°å‡½æ•°ï¼ŒåŒæ—¶è°ƒç”¨thenæ–¹æ³•çš„promiseå°±æ˜¯rejectedçš„æ—¶å€™ï¼Œæ‰éœ€è¦æŠŠthenæ–¹æ³•è¿”å›çš„pormiseè¿›è¡Œrejectå¤„ç†ï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨<code>statusProvider(child, REJECTED)(data)</code>.</p>
<p>toy Promiseå®ç°çš„å®Œæ•´ä»£ç ï¼š</p>
<pre><code>const PENDING = &apos;PENDING&apos; // Promise çš„ åˆå§‹çŠ¶æ€
const FULFILLED = &apos;FULFILLED&apos; // Promise æˆåŠŸè¿”å›åçš„çŠ¶æ€
const REJECTED = &apos;REJECTED&apos; // Promise å¤±è´¥åçš„çŠ¶æ€

const isPromise = object =&gt; object &amp;&amp; object.then &amp;&amp; typeof object.then === &apos;function&apos;
const noop = () =&gt; {}

const statusProvider = (promise, status) =&gt; data =&gt; {
    if (promise.status !== PENDING) return false
    promise.status = status
    promise.result = data
    switch(status) {
        case FULFILLED: return promise.successListener.forEach(fn =&gt; fn(data))
        case REJECTED: return promise.failurelistener.forEach(fn =&gt; fn(data))
    }
}

class Promise {
    constructor(executor) {
        this.status = PENDING
        this.successListener = []
        this.failurelistener = []
        this.result = undefined 
        executor(statusProvider(this, FULFILLED), statusProvider(this, REJECTED))
    }
    /**
     * PromiseåŸå‹ä¸Šé¢çš„æ–¹æ³•
     */
    then(...args) {
        const child = new this.constructor(noop)

        const handler = fn =&gt; data =&gt; {
            if (typeof fn === &apos;function&apos;) {
                const result = fn(data)
                if (isPromise(result)) {
                    Object.assign(child, result)
                } else {
                    statusProvider(child, FULFILLED)(result)
                }   
            } else if(!fn) {
                statusProvider(child, this.status)(data)
            }
        }
        switch (this.status) {
            case PENDING: {
                this.successListener.push(handler(args[0]))
                this.failurelistener.push(handler(args[1]))
                break
            }
            case FULFILLED: {
                handler(args[0])(this.result)
                break
            }
            case REJECTED: {
                handler(args[1])(this.result)
                break
            }
        }
        return child
    }
    catch(arg) {
        return this.then(undefined, arg)
    }
}
</code></pre><h2 id="å››ã€æ€ä¹ˆè®©æˆ‘ä»¬çš„toy-Promiseå˜å¼ºå¥"><a href="#å››ã€æ€ä¹ˆè®©æˆ‘ä»¬çš„toy-Promiseå˜å¼ºå¥" class="headerlink" title="å››ã€æ€ä¹ˆè®©æˆ‘ä»¬çš„toy Promiseå˜å¼ºå¥"></a>å››ã€æ€ä¹ˆè®©æˆ‘ä»¬çš„toy Promiseå˜å¼ºå¥</h2><ol>
<li>åœ¨ECMAScriptæ ‡å‡†ä¸­ï¼ŒPromiseæ„é€ å‡½æ•°ä¸Šé¢è¿˜æä¾›äº†ä¸€äº›é™æ€æ–¹æ³•ï¼Œæ¯”å¦‚<code>Promise.resolve</code>ã€<code>Promise.reject</code>ã€<code>Promsie.all</code>ã€<code>Promise.race</code>ã€‚å½“æˆ‘ä»¬æœ‰äº†ä¸Šé¢çš„åŸºç¡€å®ç°åï¼Œä¸ºæˆ‘ä»¬çš„toy Promiseæ·»åŠ ä¸Šé¢è¿™äº›æ–°çš„åŠŸèƒ½ä¸€å®šèƒ½è®©å…¶æ›´åŠ å®ç”¨ã€‚</li>
<li>åœ¨æˆ‘ä»¬çš„åŸºæœ¬å®ç°ä¸­ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰åŒºåˆ†thenableå¯¹è±¡ï¼Œå…¶å®<code>Promise.resolve</code>å’Œ<code>then</code>æ–¹æ³•éƒ½å¯ä»¥æ¥å—ä¸€ä¸ªthenableå¯¹è±¡ï¼Œå¹¶æŠŠè¯¥thenableå¯¹è±¡è½¬åŒ–ä¸ºä¸€ä¸ªpromiseå¯¹è±¡ï¼Œå¦‚æœæƒ³è®©æˆ‘ä»¬çš„toy Promiseç”¨äºç”Ÿäº§çš„è¯ï¼Œè¿™ä¹Ÿæ˜¯è¦è€ƒè™‘çš„ã€‚</li>
<li>ä¸ºäº†è®©æˆ‘ä»¬çš„toy Promiseå˜å¾—æ›´å¼ºå£®ï¼Œæˆ‘ä»¬éœ€è¦æ‹¥æœ‰å¼ºå¥çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼Œæ¯”å¦‚éªŒè¯executorå¿…é¡»æ˜¯ä¸€ä¸ªå‡½æ•°ã€thenæ–¹æ³•çš„å‚æ•°åªèƒ½æ˜¯å‡½æ•°æˆ–è€…undefinedæˆ–nullï¼Œåˆæ¯”å¦‚executorå’Œthenæ–¹æ³•ä¸­æŠ›å‡ºçš„é”™è¯¯å¹¶ä¸èƒ½å¤Ÿè¢«window.onerrorç›‘æµ‹åˆ°ï¼Œè€Œåªèƒ½å¤Ÿé€šè¿‡é”™è¯¯å¤„ç†å‡½æ•°æ¥å¤„ç†ï¼Œè¿™ä¹Ÿæ˜¯éœ€è¦è€ƒè™‘çš„å› ç´ ã€‚</li>
<li>å¦‚æœæˆ‘ä»¬çš„Promise polyfillæ˜¯è€ƒè™‘æ”¯æŒå¤šå¹³å°ï¼Œé‚£ä¹ˆé¦–è¦è€ƒè™‘çš„å°±æ˜¯æµè§ˆå™¨ç¯å¢ƒæˆ–Node.jsç¯å¢ƒï¼Œå…¶å®åœ¨è¿™ä¸¤ä¸ªå¹³å°ï¼ŒåŸç”ŸPromiseéƒ½æ˜¯æ”¯æŒä¸¤ä¸ªäº‹ä»¶çš„ã€‚å°±æ‹¿æµè§ˆå™¨ç«¯ä¸¾ä¾‹ï¼š</li>
</ol>
<ul>
<li><code>unhandledrejection</code>: åœ¨ä¸€ä¸ªäº‹ä»¶å¾ªç¯ä¸­ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰å¯¹promiseè¿”å›çš„é”™è¯¯è¿›è¡Œå¤„ç†ï¼Œé‚£ä¹ˆå°±ä¼šåœ¨windowå¯¹è±¡ä¸Šé¢è§¦å‘è¯¥äº‹ä»¶ã€‚</li>
<li><code>rejectionhandled</code>:å¦‚æœåœ¨ä¸€ä¸ªäº‹ä»¶å¾ªç¯åï¼Œæˆ‘ä»¬æ‰å»å¯¹promiseè¿”å›çš„é”™è¯¯è¿›è¡Œå¤„ç†ï¼Œé‚£ä¹ˆå°±ä¼šåœ¨windowå¯¹è±¡ä¸Šé¢ç›‘å¬åˆ°æ­¤äº‹ä»¶ã€‚</li>
</ul>
<p>å…³äºè¿™ä¸¤ä¸ªäº‹ä»¶ä»¥åŠnode.jså¹³å°ä¸Šé¢ç±»ä¼¼çš„äº‹ä»¶è¯·å‚è€ƒNicholas C. Zakasæ–°ä¹¦</p>
<p>Promiseèƒ½å¤Ÿå¾ˆæ£’çš„å¤„ç†å¼‚æ­¥ç¼–ç¨‹ï¼Œè¦æƒ³å­¦å¥½å®ƒæˆ‘è®¤ä¸ºæœ€å¥½çš„æ–¹æ³•å°±æ˜¯äº²è‡ªåŠ¨æ‰‹å»å®ç°ä¸€ä¸ªè‡ªå·±çš„Promiseã€‚</p>
<p>å®Œæ•´codeï¼š</p>
<pre><code>/**
 * 2016.09.19
 */
const PENDING = &apos;PENDING&apos; // Promise çš„åˆå§‹çŠ¶æ€
const FULFILLED = &apos;FULFILLED&apos; // Promise æˆåŠŸè¿”å›åçš„çŠ¶æ€
const REJECTED = &apos;REJECTED&apos; // Promise å¤±è´¥åçš„çŠ¶æ€

const isThenable = data =&gt; data &amp;&amp; data.then &amp;&amp; typeof data.then === &apos;function&apos;
const isPromise = object =&gt; isThenable(object) &amp;&amp; (&apos;catch&apos; in object) &amp;&amp; typeof object.catch === &apos;function&apos;
const noop = () =&gt; {}
const range = n =&gt; n === 0 ? [] : [n, ...range(n - 1)]

// resolve function
const statusProvider = (promise, status) =&gt; data =&gt; {
    if (promise.status !== PENDING) return false
    promise.status = status
    promise.result = data
    promise.listeners[status].forEach(fn =&gt; fn(data))
}

class APromise {
    constructor(executor) {
        if (typeof executor !== &apos;function&apos;) {
            throw new TypeError(`Promise resolver ${executor.toString()} is not a function`)
        }
        this.status = PENDING
        this.listeners = {
            FULFILLED: [],
            REJECTED: []
        }
        this.result = undefined

        try {
            executor(statusProvider(this, FULFILLED), statusProvider(this, REJECTED))
        } catch (e) {
            statusProvider(this, REJECTED)(e)
        }
    }
    // prototype method
    then(...args) {
        const child = new this.constructor(noop)

        const handler = fn =&gt; data =&gt; {
            if (typeof fn === &apos;function&apos;) {
                try {
                    const result = fn(data)
                    if (isThenable(result)) {
                        isPromise(result) ? Object.assign(child, result) : Object.assign(child, new this.constructor(result.then))
                    } else {
                        statusProvider(child, FULFILLED)(result)
                    }
                } catch (e) {
                    statusProvider(child, REJECTED)(e)
                }
            } else if (!fn) {
                statusProvider(child, this.status)(data)
            }
        }
        switch (this.status) {
            case PENDING: {
                this.listeners[FULFILLED].push(handler(args[0]))
                this.listeners[REJECTED].push(handler(args[1]))
                break
            }
            case FULFILLED: {
                handler(args[0])(this.result)
                break
            }
            case REJECTED: {
                handler(args[1])(this.result)
                break
            }
        }
        return child
    }

    catch(arg) {
        return this.then(undefined, arg)
    }
}

APromise.resolve = data =&gt; {
    if (isPromise(data)) return data
    return isThenable(data) ? new APromise(data.then) : new APromise((resolve, reject) =&gt; resolve(data))
}

APromise.reject = err =&gt; new APromise((resolve, reject) =&gt; reject(err))

APromise.all = promises =&gt; {
    const length = promises.length
    const result = new APromise(noop)
    let count = 0
    const values = range(length)

    promises.forEach((p, i) =&gt; {
        p.then(data =&gt; {
            values[i] = data
            count++
            if (count === length) statusProvider(result, FULFILLED)(values)
        }, statusProvider(result, REJECTED))
    })
    return result
}

APromise.race = promises =&gt; {
    const result = new APromise(noop)
    promises.forEach((p, i) =&gt; {
        p.then(statusProvider(result, FULFILLED), statusProvider(result, REJECTED))
    })
    return result
}

export default APromise
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/01/ä»ä½ åœ¨æµè§ˆå™¨è¾“å…¥ä¸€ä¸ªç½‘å€.../">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/01/ä»ä½ åœ¨æµè§ˆå™¨è¾“å…¥ä¸€ä¸ªç½‘å€.../" itemprop="url">ä»ä½ åœ¨æµè§ˆå™¨è¾“å…¥ä¸€ä¸ªç½‘å€....</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-06-01T18:35:10+08:00">
                2018-06-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="ä»ä½ åœ¨æµè§ˆå™¨è¾“å…¥ä¸€ä¸ªç½‘å€â€¦"><a href="#ä»ä½ åœ¨æµè§ˆå™¨è¾“å…¥ä¸€ä¸ªç½‘å€â€¦" class="headerlink" title="ä»ä½ åœ¨æµè§ˆå™¨è¾“å…¥ä¸€ä¸ªç½‘å€â€¦"></a><a href="https://zhuanlan.zhihu.com/p/30621272" target="_blank" rel="noopener">ä»ä½ åœ¨æµè§ˆå™¨è¾“å…¥ä¸€ä¸ªç½‘å€â€¦</a></h2><p>æˆ‘ä»¬åœ¨é¢è¯•çš„æ—¶å€™æˆ–è®¸ç»å¸¸ä¼šè¢«é—®åˆ°ï¼š</p>
<blockquote>
<p>ä»ä½ åœ¨æµè§ˆå™¨è¾“å…¥ä¸€ä¸ªç½‘å€åˆ°ç½‘é¡µå†…å®¹å®Œå…¨è¢«å±•ç¤ºçš„è¿™æ®µæ—¶é—´å†…ï¼Œéƒ½å‘ç”Ÿäº†ä»€ä¹ˆäº‹æƒ…ï¼Ÿ</p>
</blockquote>
<p>ç¡®å®æ˜¯ä¸ªè€ç”Ÿå¸¸è°ˆçš„é—®é¢˜ï¼Œä½†é—®é¢˜çš„ç­”æ¡ˆå¹¶ä¸æ˜¯å”¯ä¸€çš„ï¼Œæˆ–è®¸åœ¨ä¸‰äº”å¹´å‰ï¼Œè¿™ä¸ªé—®é¢˜è¿˜ä¼šæœ‰ä¸€ä¸ªã€Œç›¸å¯¹ã€æ ‡å‡†çš„ç­”æ¡ˆã€‚</p>
<ol>
<li>æµè§ˆå™¨åœ¨æ¥æ”¶åˆ°è¿™ä¸ªè¯·æ±‚æ—¶ï¼Œä¼šå¼€å¯ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹æ¥å¤„ç†è¿™ä¸ªè¯·æ±‚ï¼Œé¦–å…ˆè¦åˆ¤æ–­ç”¨æˆ·è¾“å…¥æ˜¯å¦ä¸ºåˆæ³•æˆ–åˆç†çš„ URL åœ°å€ï¼Œæ˜¯å¦ä¸º HTTP åè®®è¯·æ±‚ï¼Œå¦‚æœæ˜¯é‚£å°±è¿›å…¥ä¸‹ä¸€æ­¥</li>
<li>æµè§ˆå™¨çš„æµè§ˆå™¨å¼•æ“å°†å¯¹æ­¤ URL è¿›è¡Œåˆ†æåŠ è½½</li>
<li>é€šè¿‡ DNS è§£æåŸŸåè·å–è¯¥ç½‘ç«™åœ°å€å¯¹åº”çš„ IP åœ°å€ï¼ŒæŸ¥è¯¢å®Œæˆåè¿åŒæµè§ˆå™¨çš„ Cookieã€ userAgent ç­‰ä¿¡æ¯å‘ç½‘ç«™ç›®çš„ IP å‘å‡º GET è¯·æ±‚ã€‚</li>
<li>æ¥ä¸‹æ¥å°±æ˜¯ç»å…¸çš„ã€Œä¸‰æ¬¡æ¡æ‰‹ã€ï¼ŒHTTP åè®®ä¼šè¯ï¼Œæµè§ˆå™¨å®¢æˆ·ç«¯å‘ Web æœåŠ¡å™¨å‘é€æŠ¥æ–‡ï¼Œè¿›è¡Œé€šè®¯å’Œæ•°æ®ä¼ è¾“ã€‚</li>
<li>è¿›å…¥ç½‘ç«™çš„åç«¯æœåŠ¡ï¼Œå¦‚ Tomcatã€Apache ç­‰ï¼Œè¿˜æœ‰è¿‘å‡ å¹´æµè¡Œçš„ Node.js æœåŠ¡å™¨ï¼Œè¿™äº›æœåŠ¡å™¨ä¸Šéƒ¨ç½²ç€åº”ç”¨ä»£ç ï¼Œè¯­è¨€æœ‰å¾ˆå¤šï¼Œå¦‚ Javaã€ PHPã€ C++ã€ C# å’Œ Javascript ç­‰ã€‚</li>
<li>æœåŠ¡å™¨æ ¹æ® URL æ‰§è¡Œç›¸åº”çš„åç«¯åº”ç”¨é€»è¾‘ï¼Œæ•´ç†æ•°æ®ç»„è£…æˆä¸€ä¸ªå®Œæ•´çš„ HTML æ•°æ®è¿”å›ç»™æµè§ˆå™¨ï¼ŒæœŸé—´ä¼šä½¿ç”¨åˆ°ã€ŒæœåŠ¡å™¨ç¼“å­˜ã€æˆ–ã€Œæ•°æ®åº“ã€å†…çš„å†…å®¹ã€‚</li>
<li>æµè§ˆå™¨æ¥æ”¶åˆ°è¿”å›ä¿¡æ¯åå…ˆåˆ¤è¯»æ­¤ HTML æ–‡ä»¶æ˜¯å¦å­˜åœ¨æœ¬åœ°ç¼“å­˜ï¼Œå¦‚æœä¸å­˜åœ¨æˆ–ä¸å¯ç”¨ï¼Œåˆ™ä¸‹è½½æ­¤ HTML æ–‡ä»¶ï¼ˆ200çŠ¶æ€ç ï¼‰ï¼Œå¦‚æœå¯ç”¨ï¼ˆæœªè¿‡æœŸï¼‰ï¼Œåˆ™èµ°æµè§ˆå™¨ç¼“å­˜ï¼ˆ304è¿”å›ç ï¼‰ã€‚ã€Œå¼ºç¼“å­˜ï¼ˆ200è¿”å›ç ï¼‰ä¸åœ¨è€ƒè™‘èŒƒå›´ã€</li>
<li>æµè§ˆå™¨çš„æ¸²æŸ“å¼•æ“åœ¨æ‹¿åˆ° HTML æ–‡ä»¶åï¼Œä¾¿å¼€å§‹è§£ææ„å»º DOM æ•°ï¼Œå¹¶æ ¹æ® HTML ä¸­çš„æ ‡è®°è¯·æ±‚ä¸‹è½½æŒ‡å®šçš„ MIME ç±»å‹æ–‡ä»¶ï¼ˆå¦‚ CSSã€ JavaScript è„šæœ¬ç­‰ï¼‰ï¼ŒåŒæ—¶ä½¿ç”¨&amp;è®¾ç½®ç¼“å­˜ç­‰å†…å®¹ã€‚</li>
<li>æ¸²æŸ“å¼•æ“æ ¹æ® CSS æ ·å¼è§„åˆ™å°† DOM æ ‘æ‰©å……ä¸ºæ¸²æŸ“æ ‘ï¼Œç„¶åè¿›è¡Œé‡æ’ã€é‡ç»˜ã€‚</li>
<li>å¦‚æœå«æœ‰ JS æ–‡ä»¶å°†ä¼šæ‰§è¡Œï¼Œè¿›è¡Œ Dom æ“ä½œã€ç¼“å­˜è¯»å­˜ã€æ—¶é—´ç»‘å®šç­‰æ“ä½œã€‚æœ€ç»ˆé¡µé¢å°†è¢«å±•ç¤ºåœ¨æµè§ˆå™¨ä¸Šã€‚</li>
</ol>
<p>æ­¤ç­”æ¡ˆç²¾ç®€çš„æ¦‚æ‹¬äº†ã€Œåç«¯ä¸ºä¸»çš„ MVC æ¨¡å¼ã€åŠæ—©æœŸ Web åº”ç”¨çš„æµè§ˆå™¨ç›¸åº”çš„å…¨è¿‡ç¨‹ã€‚é‚£ï¼Œå‰ç«¯æŠ€æœ¯å‘å±•åˆ°ç°åœ¨ï¼Œã€Œå‰åç«¯åˆ†ç¦»ã€ã€Œä¸­é—´ä»¶ç›´å‡ºã€å’Œã€ŒMNV*æ¨¡å¼ã€ä¹Ÿå·²é—®ä¸–ï¼Œå†è°ˆåŠæ­¤é—®é¢˜ï¼Œç­”æ¡ˆä¼šæœ‰ä¸åŒã€‚</p>
<p>å°±ä»¥ã€Œå‰åç«¯åˆ†ç¦»ã€ä¸ºä¾‹ï¼Œåœ¨ä¸Šæ–¹ç­”æ¡ˆçš„ç¬¬4æ­¥åï¼Œç´§æ¥ç€å°±ä¸ä¼šç›´æ¥è¿›å…¥åç«¯æœåŠ¡å™¨äº†ã€‚è€Œä¼šè¢« HTTP å’Œåå‘ä»£ç†æœåŠ¡å™¨ï¼Œå¦‚ Ngnixï¼Œä»£æ›¿ã€‚</p>
<ul>
<li>å‰ç½®æ­¥éª¤1ã€2ã€3ã€4</li>
<li>Ngnix åœ¨æ¥æ”¶åˆ° HTTPï¼ˆ80ç«¯å£ï¼‰æˆ– HTTPSï¼ˆ443ç«¯å£ï¼‰åï¼Œæ ¹æ® URL åšæœåŠ¡å™¨åˆ†å‘ï¼Œåˆ†å‘ï¼ˆrewriteï¼‰åˆ°åç«¯æœåŠ¡å™¨æˆ–é™æ€èµ„æºæœåŠ¡å™¨ï¼Œé¦–é¡µè¯·æ±‚åŸºæœ¬æ˜¯é™æ€æœåŠ¡å™¨ï¼Œè¿”å›ä¸€ä¸ªé™æ€çš„ HTML æ–‡ä»¶</li>
<li>æ­¥éª¤7ã€8ã€9</li>
<li>æ‰§è¡Œ JS è„šæœ¬ï¼Œå¼‚æ­¥ ajaxã€ fetch å‘èµ· POSTã€ GET è¯·æ±‚ï¼Œé‡æ–°è¿›å…¥ Ngnix åˆ†å‘ï¼Œæ­¤æ¬¡åˆ†å‘åˆ°åç«¯æœåŠ¡å™¨ï¼Œæ­¥éª¤5ã€6ï¼Œç„¶åè¿”å›ä¸€ä¸ª xml æˆ– json æ ¼å¼çš„ä¿¡æ¯ï¼Œä¸€èˆ¬å«æœ‰ codeï¼ˆè¿”å›ç ï¼‰ã€resultï¼ˆä¾èµ–ä¿¡æ¯ï¼‰</li>
<li>æœ€åæ ¹æ®è¿”å›ç æ‰§è¡Œä¸åŒçš„ js é€»è¾‘ï¼Œå¢åˆ æ”¹é¡µé¢å…ƒç´ ï¼Œæ­¤æ—¶å¯èƒ½ä¼šå‘ç”Ÿé‡æ’æˆ–é‡æ±‡ã€‚é¦–é¡µåŠ è½½ç»“æŸã€‚</li>
</ul>
<p>ä»¥ä¸Šæ­¥éª¤å¯ä»¥å‘ç°ï¼Œæµè§ˆå™¨å¯èƒ½ä¼šè§¦å‘é‡ç»˜ä¸¤æ¬¡ï¼Œææ˜“å‘ç”Ÿã€Œç™½å±ã€æˆ–ã€Œé¡µé¢æŠ–åŠ¨ã€ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ã€Œä¸­é—´ä»¶ç›´å‡ºã€çš„æ¨¡å¼åº”è¿è€Œç”Ÿã€‚å¦å¤–ä¸ºäº†æ‰©å……å¤§å‰ç«¯çš„é˜µè¥ï¼Œå¸çº³ IOS å’Œ Androidï¼ŒGoogleåˆè®¾è®¡äº†ã€ŒMNV*æ¨¡å¼ã€ï¼Œå…¸å‹ä»£è¡¨å°±æ˜¯ ReactNativeï¼Œä½†æ­¤æ¨¡å¼å·²ç»è„±ç¦»äº†æµè§ˆå™¨çš„èŒƒç•´ï¼Œæ­¤å¤„å°±ä¸å†åšæ‰©å±•ã€‚</p>
<p>ä»¥ä¸Šè®¨è®ºçš„æ¸²æŸ“è¿‡ç¨‹ä¸­ä½¿ç”¨åˆ°äº†è¾ƒå¤šçš„æµè§ˆå™¨åŠŸèƒ½ï¼Œå¦‚ç”¨æˆ·åœ°å€æ è¾“å…¥æ¡†ã€ç½‘ç»œè¯·æ±‚ã€æµè§ˆå™¨æ–‡æ¡£è§£æã€æ¸²æŸ“å¼•æ“æ¸²æŸ“ç½‘é¡µã€ JavaScript å¼•æ“æ‰§è¡Œjsè„šæœ¬ã€å®¢æˆ·ç«¯å­˜å‚¨ç­‰ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬ä»‹ç»ä¸‹æµè§ˆå™¨çš„åŸºæœ¬ç»“æ„ç»„æˆã€‚</p>
<h2 id="æµè§ˆå™¨çš„ç»“æ„ç»„æˆ"><a href="#æµè§ˆå™¨çš„ç»“æ„ç»„æˆ" class="headerlink" title="æµè§ˆå™¨çš„ç»“æ„ç»„æˆ"></a>æµè§ˆå™¨çš„ç»“æ„ç»„æˆ</h2><p>æµè§ˆå™¨ä¸€èˆ¬ç”±ä¸ƒä¸ªæ¨¡å—ç»„æˆï¼ŒUser Interfaceï¼ˆç”¨æˆ·ç•Œé¢ï¼‰ã€Browser engineï¼ˆæµè§ˆå™¨å¼•æ“ï¼‰ã€Rendering engineï¼ˆæ¸²æŸ“å¼•æ“ï¼‰ã€Networkingï¼ˆç½‘ç»œï¼‰ã€JavaScript Interpreterï¼ˆjsè§£é‡Šå™¨ï¼‰ã€UI Backendï¼ˆUI åç«¯ï¼‰ã€Date Persistenceï¼ˆæ•°æ®æŒä¹…åŒ–å­˜å‚¨ï¼‰ å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://pic1.zhimg.com/v2-47101c25a44a21a25f3123a88c623b15_b.jpg" alt=""><img src="https://pic1.zhimg.com/80/v2-47101c25a44a21a25f3123a88c623b15_hd.jpg" alt=""></p>
<ul>
<li>ç”¨æˆ·ç•Œé¢ï¼åŒ…æ‹¬åœ°å€æ ã€åé€€/å‰è¿›æŒ‰é’®ã€ä¹¦ç­¾ç›®å½•ç­‰ï¼Œä¹Ÿå°±æ˜¯ä½ æ‰€çœ‹åˆ°çš„é™¤äº†é¡µé¢æ˜¾ç¤ºçª—å£ä¹‹å¤–çš„å…¶ä»–éƒ¨åˆ†</li>
<li>æµè§ˆå™¨å¼•æ“ï¼å¯ä»¥åœ¨ç”¨æˆ·ç•Œé¢å’Œæ¸²æŸ“å¼•æ“ä¹‹é—´ä¼ é€æŒ‡ä»¤æˆ–åœ¨å®¢æˆ·ç«¯æœ¬åœ°ç¼“å­˜ä¸­è¯»å†™æ•°æ®ç­‰ï¼Œæ˜¯æµè§ˆå™¨ä¸­å„ä¸ªéƒ¨åˆ†ä¹‹é—´ç›¸äº’é€šä¿¡çš„æ ¸å¿ƒ</li>
<li>æ¸²æŸ“å¼•æ“ï¼è§£æDOMæ–‡æ¡£å’ŒCSSè§„åˆ™å¹¶å°†å†…å®¹æ’ç‰ˆåˆ°æµè§ˆå™¨ä¸­æ˜¾ç¤ºæœ‰æ ·å¼çš„ç•Œé¢ï¼Œä¹Ÿæœ‰äººç§°ä¹‹ä¸ºæ’ç‰ˆå¼•æ“ï¼Œæˆ‘ä»¬å¸¸è¯´çš„æµè§ˆå™¨å†…æ ¸ä¸»è¦æŒ‡çš„å°±æ˜¯æ¸²æŸ“å¼•æ“</li>
<li>ç½‘ç»œï¼ç”¨æ¥å®Œæˆç½‘ç»œè°ƒç”¨æˆ–èµ„æºä¸‹è½½çš„æ¨¡å—</li>
<li>UI åç«¯ï¼ç”¨æ¥ç»˜åˆ¶åŸºæœ¬çš„æµè§ˆå™¨çª—å£å†…æ§ä»¶ï¼Œå¦‚è¾“å…¥æ¡†ã€æŒ‰é’®ã€å•é€‰æŒ‰é’®ç­‰ï¼Œæ ¹æ®æµè§ˆå™¨ä¸åŒç»˜åˆ¶çš„æ•ˆæœä¹Ÿä¸åŒ</li>
<li>JSè§£é‡Šå™¨ï¼ç”¨æ¥è§£é‡Šæ‰§è¡ŒJSè„šæœ¬çš„æ¨¡å—ï¼Œå¦‚ V8 å¼•æ“</li>
<li>æ•°æ®å­˜å‚¨ï¼æµè§ˆå™¨åœ¨ç¡¬ç›˜ä¸­ä¿å­˜ cookieã€localStorageç­‰å„ç§æ•°æ®ï¼Œå¯é€šè¿‡æµè§ˆå™¨å¼•æ“æä¾›çš„APIè¿›è¡Œè°ƒç”¨</li>
</ul>
<p>ä½œä¸ºå‰ç«¯å¼€å‘äººå‘˜ï¼Œæˆ‘ä»¬éœ€è¦é‡ç‚¹ç†è§£æ¸²æŸ“å¼•æ“çš„å·¥ä½œåŸç†ï¼Œçµæ´»åº”ç”¨æ•°æ®å­˜å‚¨æŠ€æœ¯ï¼Œåœ¨å®é™…é¡¹ç›®å¼€å‘ä¸­ä¼šç»å¸¸æ¶‰åŠåˆ°è¿™ä¸¤ä¸ªéƒ¨åˆ†ï¼Œå°¤å…¶æ˜¯åœ¨åšé¡¹ç›®æ€§èƒ½ä¼˜åŒ–æ—¶ï¼Œç†è§£æµè§ˆå™¨æ¸²æŸ“å¼•æ“å°¤ä¸ºé‡è¦ã€‚è€Œå…¶ä»–éƒ¨åˆ†åˆ™æ˜¯ç”±å„ç§æµè§ˆå™¨è‡ªè¡Œç®¡ç†çš„ï¼Œå¼€å‘è€…èƒ½æ§åˆ¶çš„åœ°æ–¹è¾ƒå°‘ã€‚ä»Šå¤©æˆ‘ä»¬å°±å›´ç»•è¿™ä¸¤ä¸ªé‡ç‚¹å…¶ä¸­çš„ä¸€ä¸ªéƒ¨åˆ†ã€Œæµè§ˆå™¨æ¸²æŸ“å¼•æ“ã€è¿›è¡Œå±•å¼€</p>
<h2 id="æµè§ˆå™¨æ¸²æŸ“å¼•æ“"><a href="#æµè§ˆå™¨æ¸²æŸ“å¼•æ“" class="headerlink" title="æµè§ˆå™¨æ¸²æŸ“å¼•æ“"></a>æµè§ˆå™¨æ¸²æŸ“å¼•æ“</h2><p>æµè§ˆå™¨æ¸²æŸ“å¼•æ“æ˜¯ç”±å„å¤§æµè§ˆå™¨å‚å•†ä¾ç…§ W3C æ ‡å‡†è‡ªè¡Œå®ç°çš„ï¼Œä¹Ÿè¢«ç§°ä¹‹ä¸ºã€Œæµè§ˆå™¨å†…æ ¸ã€ã€‚</p>
<p>ç›®å‰ï¼Œå¸‚é¢ä¸Šä½¿ç”¨çš„ä¸»æµæµè§ˆå™¨å†…æ ¸æœ‰5ç±»ï¼šTridentã€Geckoã€Prestoã€Webkitã€Blinkã€‚</p>
<p>Tridentï¼šä¿—ç§° IE å†…æ ¸ï¼Œä¹Ÿè¢«å«åš MSHTML å¼•æ“ï¼Œç›®å‰åœ¨ä½¿ç”¨çš„æµè§ˆå™¨ä¸º IE11-ï¼Œä»¥åŠå„ç§å›½äº§å¤šæ ¸æµè§ˆå™¨ä¸­çš„IEå…¼å®¹æ¨¡å¼ã€‚å¦å¤–Edge æµè§ˆå™¨ä¸å†ä½¿ç”¨ MSHTML å¼•æ“ï¼Œè€Œæ˜¯ä½¿ç”¨ç±»å…¨æ–°çš„å¼•æ“ EdgeHTMLã€‚</p>
<p>Geckoï¼šä¿—ç§° Firefox å†…æ ¸ï¼ŒNetscape6å¼€å§‹é‡‡ç”¨çš„å†…æ ¸ï¼Œåæ¥çš„Mozilla FireFox(ç«ç‹æµè§ˆå™¨) ä¹Ÿé‡‡ç”¨äº†è¯¥å†…æ ¸ï¼ŒGeckoçš„ç‰¹ç‚¹æ˜¯ä»£ç å®Œå…¨å…¬å¼€ï¼Œå› æ­¤ï¼Œå…¶å¯å¼€å‘ç¨‹åº¦å¾ˆé«˜ï¼Œå…¨ä¸–ç•Œçš„ç¨‹åºå‘˜éƒ½å¯ä»¥ä¸ºå…¶ç¼–å†™ä»£ç ï¼Œå¢åŠ åŠŸèƒ½ã€‚å› ä¸ºè¿™æ˜¯ä¸ªå¼€æºå†…æ ¸ï¼Œå› æ­¤å—åˆ°è®¸å¤šäººçš„é’çï¼ŒGeckoå†…æ ¸çš„æµè§ˆå™¨ä¹Ÿå¾ˆå¤šï¼Œè¿™ä¹Ÿæ˜¯Geckoå†…æ ¸è™½ç„¶å¹´è½»ä½†å¸‚åœºå æœ‰ç‡èƒ½å¤Ÿè¿…é€Ÿæé«˜çš„é‡è¦åŸå› ã€‚</p>
<p>Prestoï¼šOpera å‰å†…æ ¸ï¼Œä¸ºå•¥è¯´æ˜¯å‰å†…æ ¸å‘¢ï¼Ÿå› ä¸º Opera12.17 ä»¥åä¾¿æ‹¥æŠ±äº† Google Chrome çš„ Blink å†…æ ¸ï¼Œæ­¤å†…æ ¸å°±æ²¡äº†å¯„æ‰˜</p>
<p>Webkitï¼šSafari å†…æ ¸ä¹Ÿæ˜¯ Chrome å†…æ ¸åŸå‹ï¼Œä¸»è¦æ˜¯ Safari æµè§ˆå™¨åœ¨ä½¿ç”¨çš„å†…æ ¸ï¼Œä¹Ÿæ˜¯ç‰¹æ€§ä¸Šè¡¨ç°è¾ƒå¥½çš„æµè§ˆå™¨å†…æ ¸ã€‚ä¹Ÿè¢«å¤§é‡ä½¿ç”¨åœ¨ç§»åŠ¨ç«¯æµè§ˆå™¨ä¸Šã€‚</p>
<p>Blinkï¼š ç”±Googleå’ŒOpera Softwareå¼€å‘çš„æµè§ˆå™¨æ’ç‰ˆå¼•æ“ï¼Œåœ¨Chromeï¼ˆ28åŠå¾€åç‰ˆæœ¬ï¼‰ã€Operaï¼ˆ15åŠå¾€åç‰ˆæœ¬ï¼‰å’ŒYandexæµè§ˆå™¨ ä¸­ä½¿ç”¨ã€‚Blink å…¶å®æ˜¯ WebKit çš„ä¸€ä¸ªåˆ†æ”¯ï¼Œæ·»åŠ äº†ä¸€äº›ä¼˜åŒ–çš„æ–°ç‰¹æ€§ï¼Œä¾‹å¦‚è·¨è¿›ç¨‹çš„ iframeï¼Œå°† DOM ç§»å…¥ JavaScript ä¸­æ¥æé«˜ JavaScript å¯¹ DOM çš„è®¿é—®é€Ÿåº¦ç­‰ï¼Œç›®å‰è¾ƒå¤šçš„ç§»åŠ¨ç«¯åº”ç”¨å†…åµŒçš„æµè§ˆå™¨å†…æ ¸ä¹Ÿæ¸æ¸å¼€å§‹é‡‡ç”¨ Blinkã€‚</p>
<h2 id="æ¸²æŸ“å¼•æ“çš„å·¥ä½œæµç¨‹"><a href="#æ¸²æŸ“å¼•æ“çš„å·¥ä½œæµç¨‹" class="headerlink" title="æ¸²æŸ“å¼•æ“çš„å·¥ä½œæµç¨‹"></a>æ¸²æŸ“å¼•æ“çš„å·¥ä½œæµç¨‹</h2><p>æµè§ˆå™¨æ¸²æŸ“å¼•æ“é‡è¦çš„å·¥ä½œå°±æ˜¯å°† HTML å’Œ CSS æ–‡æ¡£è§£æç»„åˆæœ€ç»ˆæ¸²æŸ“åˆ°æµè§ˆå™¨çª—å£ä¸Šã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ¸²æŸ“å¼•æ“åœ¨æ¥å—åˆ° HTML æ–‡ä»¶åä¸»è¦è¿›è¡Œäº†ä»¥ä¸‹æ“ä½œï¼šè§£æ HTML æ„å»º DOM æ ‘ -&gt; æ„å»ºæ¸²æŸ“æ ‘ -&gt; æ¸²æŸ“æ ‘å¸ƒå±€ -&gt; æ¸²æŸ“æ ‘ç»˜åˆ¶ã€‚</p>
<p><img src="https://pic2.zhimg.com/v2-898d192f36fcc9c8843ec9d89f112bde_b.jpg" alt=""><img src="https://pic2.zhimg.com/80/v2-898d192f36fcc9c8843ec9d89f112bde_hd.jpg" alt=""></p>
<p>è§£æ HTML æ„å»º DOM æ ‘æ—¶æ¸²æŸ“å¼•æ“ä¼šå°† HTML æ–‡ä»¶çš„ä¾¿ç­¾å…ƒç´ è§£ææˆå¤šä¸ª DOM å…ƒç´ å¯¹è±¡èŠ‚ç‚¹ï¼Œå¹¶ä¸”å°†è¿™äº›å¯¹è±¡æ ¹æ®çˆ¶å­å…³ç³»ç»„æˆä¸€ä¸ªæ ‘ç»“æ„ã€‚åŒæ—¶ CSS æ–‡ä»¶è¢«è§£ææˆ CSSè§„åˆ™è¡¨ï¼Œç„¶åå°†æ¯æ¡ CSS è§„åˆ™æŒ‰ç…§ã€Œä»å³å‘å·¦ã€çš„æ–¹å¼åœ¨ DOM æ ‘ä¸Šè¿›è¡Œé€†å‘åŒ¹é…ï¼Œç”Ÿæˆä¸€ä¸ªå…·æœ‰æ ·å¼è§„åˆ™æè¿°çš„ DOM æ¸²æŸ“æ ‘ã€‚æ¥ä¸‹æ¥å°±æ˜¯å°†æ¸²æŸ“æ ‘è¿›è¡Œå¸ƒå±€ã€ç»˜åˆ¶çš„è¿‡ç¨‹ã€‚é¦–å…ˆæ ¹æ® DOM æ¸²æŸ“æ ‘ä¸Šçš„æ ·å¼è§„åˆ™ï¼Œå¯¹ DOM å…ƒç´ è¿›è¡Œå¤§å°å’Œä½ç½®çš„å®šä½ï¼Œå…³é”®å±æ€§å¦‚<code>position;width;margin;padding;top;border;...</code>ï¼Œæ¥ä¸‹æ¥åœ¨æ ¹æ®å…ƒç´ æ ·å¼è§„åˆ™ä¸­çš„<code>color;background;shadow;...</code>è§„åˆ™è¿›è¡Œ DOM çš„ç»˜åˆ¶ã€‚</p>
<p>å¦å¤–ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯é€æ­¥å®Œæˆçš„ï¼Œä¸ºäº†æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œæ¸²æŸ“å¼•æ“å°†ä¼šå°½å¯èƒ½æ—©çš„å°†å†…å®¹å‘ˆç°åˆ°å±å¹•ä¸Šï¼Œå¹¶ä¸ä¼šç­‰åˆ°æ‰€æœ‰çš„htmléƒ½è§£æå®Œæˆä¹‹åå†å»æ„å»ºå’Œå¸ƒå±€renderæ ‘ã€‚å®ƒæ˜¯è§£æå®Œä¸€éƒ¨åˆ†å†…å®¹å°±æ˜¾ç¤ºä¸€éƒ¨åˆ†å†…å®¹ï¼ŒåŒæ—¶ï¼Œå¯èƒ½è¿˜åœ¨é€šè¿‡ç½‘ç»œä¸‹è½½å…¶ä½™å†…å®¹ã€‚</p>
<p>å†è€…ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨æµè§ˆå™¨æ¸²æŸ“å®Œé¦–å±é¡µé¢åï¼Œå¦‚æœå¯¹ DOM è¿›è¡Œæ“ä½œä¼šå¼•èµ·æµè§ˆå™¨å¼•æ“å¯¹ DOM æ¸²æŸ“æ ‘çš„é‡æ–°å¸ƒå±€å’Œé‡æ–°ç»˜åˆ¶ï¼Œæˆ‘ä»¬å«åšã€Œé‡æ’ã€å’Œã€Œé‡ç»˜ã€ï¼Œç”±äºé‡æ’å’Œé‡ç»˜æ˜¯å‰åä¾èµ–çš„å…³ç³»ï¼Œæ‰€ä»¥é‡ç»˜å‘ç”Ÿæ—¶æœªå¿…ä¼šè§¦å‘æ¸²æŸ“å¼•æ“çš„é‡æ’ï¼Œä½†æ˜¯å¦‚æœå‘ç”Ÿäº†é‡æ’å°±å¿…ç„¶ä¼šè§¦å‘é‡ç»˜æ“ä½œï¼Œè¿™æ ·å¸¦æ¥çš„æ€§èƒ½æŸå®³å°±æ˜¯å·¨å¤§çš„ã€‚å› æ­¤æˆ‘ä»¬åœ¨åšæ€§èƒ½ä¼˜åŒ–çš„æ—¶å€™åº”è¯¥éµå¾ªã€Œé¿å…é‡æ’ï¼›å‡å°‘é‡ç»˜ã€çš„åŸåˆ™ã€‚</p>
<h2 id="ä¸åŒæµè§ˆå™¨å†…æ ¸é—´çš„å·®å¼‚"><a href="#ä¸åŒæµè§ˆå™¨å†…æ ¸é—´çš„å·®å¼‚" class="headerlink" title="ä¸åŒæµè§ˆå™¨å†…æ ¸é—´çš„å·®å¼‚"></a>ä¸åŒæµè§ˆå™¨å†…æ ¸é—´çš„å·®å¼‚</h2><p>åœ¨ä¸åŒçš„æµè§ˆå™¨å†…æ ¸ä¸‹ï¼Œ æµè§ˆå™¨é¡µé¢æ¸²æŸ“çš„æµç¨‹ç•¥æœ‰ä¸åŒ</p>
<p><img src="https://pic2.zhimg.com/v2-d29985fb1443ee3dc499a2b974f52c0e_b.jpg" alt=""><img src="https://pic2.zhimg.com/80/v2-d29985fb1443ee3dc499a2b974f52c0e_hd.jpg" alt=""></p>
<p><img src="https://pic2.zhimg.com/v2-17090b8745e504fd6877dfa6f5950422_b.jpg" alt=""><img src="https://pic2.zhimg.com/80/v2-17090b8745e504fd6877dfa6f5950422_hd.jpg" alt=""></p>
<p>ä¸Šé¢ä¸¤å¹…å›¾åˆ†åˆ«æ˜¯ Webkit å’Œ Geoko å†…æ ¸æ¸²æŸ“ DOM çš„å·¥ä½œæµç¨‹ï¼Œå¯¹æ¯”å¯ä»¥çœ‹å‡ºï¼Œä¸¤è€…æµç¨‹çš„åŒºåˆ«ä¸»è¦åœ¨äº CSS æ ·å¼è¡¨çš„è§£ææ—¶æœºï¼ŒWebkit å†…æ ¸ä¸‹ï¼ŒHTML å’Œ CSS æ–‡ä»¶çš„è§£ææ˜¯åŒæ­¥çš„ï¼Œè€Œ Geoko å†…æ ¸ä¸‹ï¼ŒCSS æ–‡ä»¶éœ€è¦ç­‰åˆ° HTML æ–‡ä»¶è§£ææˆå†…å®¹ Sink åæ‰è¿›è¡Œè§£æã€‚</p>
<p>å¦å¤–ä¸¤è€…çš„ä¸åŒè¿˜æœ‰æè¿°æœ¯è¯­ï¼Œé™¤æ­¤ä¹‹å¤–ä¸¤è€…çš„æµç¨‹å°±åŸºæœ¬ç›¸åŒäº†ï¼Œå…¶ä¸­æœ€é‡è¦çš„ä¸‰ä¸ªéƒ¨åˆ†å°±æ˜¯ ã€ŒHTML çš„è§£æã€ã€ŒCSS çš„è§£æã€ã€Œæ¸²æŸ“æ ‘çš„ç”Ÿæˆã€ã€‚è¿™ä¸‰ä¸ªéƒ¨åˆ†çš„åŸç†å†…å®¹å°±æ¯”è¾ƒæ·±ï¼Œæ¶‰åŠåˆ°ã€Œè¯æ³•åˆ†æã€ã€Œè¯­æ³•åˆ†æã€ã€Œè½¬æ¢ã€ã€Œè§£é‡Šã€ç­‰æ•°æ®ç»“æ„çš„å†…å®¹ï¼Œæ¯”è¾ƒæ¯ç‡¥ï¼Œä¸€èˆ¬æˆ‘ä»¬äº†è§£åˆ°è¿™é‡Œå°±å¤Ÿäº†ï¼Œä¸è¿‡æƒ³æ·±å…¥äº†è§£çš„åŒå­¦å¯ä»¥é˜…è¯»æ­¤ç¯‡è¯‘æ–‡ï¼Œ<a href="https://link.zhihu.com/?target=https%3A//link.juejin.im/%3Ftarget%3Dhttp%253A%252F%252Fblog.csdn.net%252Fu010794365%252Farticle%252Fdetails%252F77982768" target="_blank" rel="noopener">æµè§ˆå™¨çš„å·¥ä½œåŸç†</a>ï¼Œé‡Œé¢è¯¦ç»†çš„è§£é‡Šäº†ä»¥ä¸Šä¸‰ä¸ªéƒ¨åˆ†çš„æµç¨‹å’Œå…³ç³»ã€‚æ­¤å¤„å°±ä¸å†å¤šåšèµ˜è¿°äº†ã€‚</p>
<h2 id="å…³äº-CSS-è§„åˆ™çš„åŒ¹é…"><a href="#å…³äº-CSS-è§„åˆ™çš„åŒ¹é…" class="headerlink" title="å…³äº CSS è§„åˆ™çš„åŒ¹é…"></a>å…³äº CSS è§„åˆ™çš„åŒ¹é…</h2><p>ä¸Šé¢æˆ‘ä»¬æåˆ°è¿‡ï¼Œ CSS è§„åˆ™æ˜¯æŒ‰ç…§ã€Œä»å³å‘å·¦ã€çš„æ–¹å¼åœ¨ DOM æ ‘ä¸Šè¿›è¡Œé€†å‘åŒ¹é…çš„ï¼Œæœ€ç»ˆç”Ÿæˆä¸€ä¸ªå…·æœ‰æ ·å¼è§„åˆ™æè¿°çš„ DOM æ¸²æŸ“æ ‘ã€‚</p>
<p>ä½†æ˜¯ä½ çŸ¥é“ä¸ºä»€ä¹ˆè¦ã€Œä»å³å‘å·¦ã€åšé€†å‘åŒ¹é…ç ï¼Ÿ</p>
<p>æˆ‘ä»¬é‡æ–°å›åˆ°ã€webkit å†…æ ¸å·¥ä½œæµç¨‹ã€‘å›¾</p>
<p><img src="https://pic2.zhimg.com/v2-d29985fb1443ee3dc499a2b974f52c0e_b.jpg" alt=""><img src="https://pic2.zhimg.com/80/v2-d29985fb1443ee3dc499a2b974f52c0e_hd.jpg" alt=""></p>
<p>CSS è§„åˆ™åŒ¹é…æ˜¯å‘ç”Ÿåœ¨webkitå¼•æ“çš„ã€ŒAttachmentã€è¿‡ç¨‹ä¸­ï¼Œæµè§ˆå™¨è¦ä¸ºæ¯ä¸ª DOM Tree ä¸­çš„å…ƒç´ æ‰©å…… CSS æ ·å¼è§„åˆ™ï¼ˆåŒ¹é… Style Rulesï¼‰ã€‚å¯¹äºæ¯ä¸ª DOM å…ƒç´ ï¼Œå¿…é¡»åœ¨æ‰€æœ‰ Style Rules ä¸­æ‰¾åˆ°ç¬¦åˆçš„ selector å¹¶å°†å¯¹åº”çš„è§„åˆ™è¿›è¡Œåˆå¹¶ã€‚é€‰æ‹©å™¨çš„ã€Œè§£æã€å®é™…æ˜¯åœ¨è¿™é‡Œæ‰§è¡Œçš„ï¼Œåœ¨éå† DOM Tree æ—¶ï¼Œä» Style Rules ä¸­å»å¯»æ‰¾å¯¹åº”çš„ selectorã€‚</p>
<p>æˆ‘ä»¬æ¥ä¸¾ä¸€ä¸ªæœ€ç®€å•çš„æ —å­ï¼š</p>
<pre><code>&lt;template&gt;
&lt;div&gt;
  &lt;div class=&quot;t&quot;&gt;
    &lt;span&gt;test&lt;/span&gt;
    &lt;p&gt;test&lt;/p&gt;
  &lt;div&gt;
&lt;/div&gt;
&lt;/template&gt;

&lt;style&gt;
div{ color: #000; }
div .t span{ color: red; }
div .t p{color: blue; }
&lt;/style&gt;
</code></pre><p>æ­¤å¤„æˆ‘ä»¬æœ‰ä¸€ä¸ª html å…ƒç´  å’Œä¸€ä¸ª style å…ƒç´ ï¼Œä¸¤è€…éœ€è¦åšéå†åŒ¹é…</p>
<p><img src="https://pic1.zhimg.com/v2-727bdb01745d4f9692a5f7a8678e62e2_b.jpg" alt=""><img src="https://pic1.zhimg.com/80/v2-727bdb01745d4f9692a5f7a8678e62e2_hd.jpg" alt=""></p>
<p>æ­¤å¤„ä¼šæœ‰ 4*3 ä¸ªåŒ¹é…é¡¹ï¼Œå¦‚æœåšæ­£å‘åŒ¹é…ï¼Œåœ¨é‡åˆ° <code>&lt;span&gt;</code> æ ‡ç­¾åŒ¹é… <code>div .t p{ color: red; }</code>åˆ°åŒ¹é…é¡¹æ—¶ï¼Œæ˜¾ç„¶æ—¶ä¸é€šè¿‡åˆ°ï¼Œè®¡ç®—æœºé¦–å…ˆè¦æ‰¾åˆ°<code>&lt;span&gt;</code> æ ‡ç­¾åˆ°çˆ¶æ ‡ç­¾å’Œç¥–çˆ¶æ ‡ç­¾ï¼Œåˆ¤æ–­ä»–ä»¬æ˜¯å¦æ»¡è¶³<code>div .t</code>çš„è§„åˆ™ï¼Œç„¶ååœ¨åŒ¹é…<code>&lt;span&gt;</code>æ˜¯å¦ä¸º<code>p</code>æ ‡ç­¾ï¼Œæ­¤å¤„åŒ¹é…ä¸æˆåŠŸï¼Œæ­¤å¤„å°±äº§ç”Ÿäº†ä¸‰æ¬¡æµªè´¹ã€‚</p>
<p>å¦‚æœæ—¶é€†å‘åŒ¹é…ï¼Œé‚£ä¹ˆç¬¬ä¸€æ¬¡å¯¹æ¯”<code>&lt;span&gt;</code>æ˜¯å¦ä¸º<code>p</code>æ ‡ç­¾ä¾¿å¯æ’é™¤æ­¤è§„åˆ™ï¼Œæ•ˆç‡æ›´é«˜ã€‚</p>
<p>å¦‚æœå°† HTML ç»“æ„å˜å¤æ‚ï¼ŒCSS è§„åˆ™è¡¨å˜åºå¤§ï¼Œé‚£ä¹ˆï¼Œã€Œé€†å‘åŒ¹é…ã€çš„ä¼˜åŠ¿å°±è¿œå¤§äºã€Œæ­£å‘åŒ¹é…ã€äº†ï¼Œå› ä¸ºåŒ¹é…çš„æƒ…å†µè¿œè¿œä½äºä¸åŒ¹é…çš„æƒ…å†µã€‚åŒæ—¶å¦‚æœåœ¨é€‰æ‹©å™¨ç»“å°¾åŠ ä¸Šé€šé…ç¬¦ã€Œ*ã€ï¼Œé‚£ä¹ˆã€Œé€†å‘åŒ¹é…ã€çš„ä¼˜åŠ¿å°±å¤§æ‰“æŠ˜æ‰£ï¼Œè¿™ä¹Ÿå°±æ˜¯å¾ˆå¤šä¼˜åŒ–åŸåˆ™æåˆ°çš„å°½é‡é¿å…åœ¨é€‰æ‹©å™¨æœ«å°¾æ·»åŠ é€šé…ç¬¦çš„åŸå› ã€‚</p>
<p>æé™äº†æƒ³ï¼Œå¦‚æœæˆ‘ä»¬çš„æ ·å¼è¡¨ä¸å­˜åœ¨åµŒå¥—å…³ç³»ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code>&lt;template&gt;
&lt;div&gt;
  &lt;div&gt;
    &lt;span class=&quot;div_t_span&quot;&gt;test&lt;/span&gt;
    &lt;p class=&quot;div_t_p&quot;&gt;test&lt;/p&gt;
  &lt;div&gt;
&lt;/div&gt;
&lt;/template&gt;

&lt;style&gt;
div{ color: #000; }
.div_t_span{ color: red; }
.div_t_p{color: blue; }
&lt;/style
</code></pre><p>é‚£ä¹ˆå¼•æ“çš„ã€ŒAttachmentã€è¿‡ç¨‹å°†å¾—åˆ°æå¤§çš„ç²¾ç®€ï¼Œæ•ˆç‡ä¹Ÿæ˜¯å¯æƒ³è€ŒçŸ¥çš„ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆã€Œå¾®ä¿¡å°ç¨‹åºã€æ ·å¼è¡¨ä¸å»ºè®®ä½¿ç”¨å…³ç³»è¡Œå†™æ³•çš„åŸå› ã€‚</p>
<h2 id="ç›¸å…³çš„æ€§èƒ½ä¼˜åŒ–"><a href="#ç›¸å…³çš„æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="ç›¸å…³çš„æ€§èƒ½ä¼˜åŒ–"></a>ç›¸å…³çš„æ€§èƒ½ä¼˜åŒ–</h2><p>ç”±ä»¥ä¸Šä»‹ç»ï¼Œæˆ‘ä»¬å¤§è‡´å¯ä»¥åœ¨æ¡ˆä¾‹ä¸­çœ‹åˆ°åŒæµè§ˆå™¨æ¸²æŸ“å¼•æ“ç›¸å…³çš„å¯è¡Œä¼˜åŒ–ç‚¹ã€‚</p>
<p>å¤§è‡´ä¸ºä»¥ä¸‹å‡ ç§</p>
<ol>
<li>å‡å°‘ JS åŠ è½½å¯¹ Dom æ¸²æŸ“çš„å½±å“ï¼šå°† JS æ–‡ä»¶æ”¾åœ¨ HTML æ–‡æ¡£ååŠ è½½ï¼Œæˆ–è€…ä½¿ç”¨å¼‚æ­¥çš„æ–¹å¼åŠ è½½ JS ä»£ç </li>
<li>é¿å…é‡æ’ï¼Œå‡å°‘é‡ç»˜ï¼šåœ¨åšcssåŠ¨ç”»çš„æ—¶å€™å‡å°‘ä½¿ç”¨ widthã€ marginã€ paddingç­‰å½±å“ CSS å¸ƒå±€å¯¹è§„åˆ™ï¼Œå¯ä»¥ä½¿ç”¨ CSS3 çš„ transform ä»£æ›¿</li>
<li>å‡å°‘ä½¿ç”¨å…³ç³»å‹æ ·å¼è¡¨çš„å†™æ³•ï¼šç›´æ¥ä½¿ç”¨å”¯ä¸€çš„ç±»åå³å¯æœ€å¤§é™åº¦çš„æå‡æ¸²æŸ“æ•ˆç‡</li>
<li>å‡å°‘ DOM çš„å±‚çº§ï¼šå‡å°‘æ— æ„ä¹‰çš„dom å±‚çº§å¯ä»¥å‡å°‘ æ¸²æŸ“å¼•æ“ Attachment è¿‡ç¨‹ä¸­çš„åŒ¹é…è®¡ç®—é‡</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/30/æ·±å…¥ç†è§£ES6  Async Functions/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/30/æ·±å…¥ç†è§£ES6  Async Functions/" itemprop="url">æ·±å…¥ç†è§£ES6 Async Functions (å¼‚æ­¥å‡½æ•°)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-05-30T18:35:10+08:00">
                2018-05-30
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><h2 id="async-å¼‚æ­¥-å‡½æ•°å˜ä½“"><a href="#async-å¼‚æ­¥-å‡½æ•°å˜ä½“" class="headerlink" title="async(å¼‚æ­¥) å‡½æ•°å˜ä½“"></a>async(å¼‚æ­¥) å‡½æ•°å˜ä½“</h2><p>ä»¥ä¸‹æ˜¯å·²ç»å­˜åœ¨çš„å¼‚æ­¥å‡½æ•°å˜ä½“ã€‚è¯·æ³¨æ„æ— å¤„ä¸åœ¨çš„ <code>async</code> å…³é”®å­—ã€‚</p>
<ul>
<li>å¼‚æ­¥å‡½æ•°å£°æ˜ï¼š <code>async function foo() {}</code></li>
<li>å¼‚æ­¥å‡½æ•°è¡¨è¾¾å¼ï¼š <code>const foo = async function () {};</code></li>
<li>å¼‚æ­¥å‡½æ•°å®šä¹‰ï¼š<code>let obj = { async foo() {} }</code></li>
<li>å¼‚æ­¥ç®­å¤´å‡½æ•°ï¼š <code>const foo = async () =&gt; {};</code></li>
</ul>
<h2 id="async-å¼‚æ­¥-å‡½æ•°æ€»æ˜¯è¿”å›-Promises"><a href="#async-å¼‚æ­¥-å‡½æ•°æ€»æ˜¯è¿”å›-Promises" class="headerlink" title="async(å¼‚æ­¥) å‡½æ•°æ€»æ˜¯è¿”å› Promises"></a>async(å¼‚æ­¥) å‡½æ•°æ€»æ˜¯è¿”å› Promises</h2><p>async(å¼‚æ­¥) å‡½æ•°çš„ Promise å®ŒæˆçŠ¶æ€ï¼š</p>
<pre><code>async function asyncFunc() {
return 123;
}

asyncFunc()
.then(x =&gt; console.log(x));
// 123
</code></pre><p>async(å¼‚æ­¥) å‡½æ•°çš„ Promise æ‹’ç»çŠ¶æ€ï¼š</p>
<pre><code>async function asyncFunc() {
throw new Error(&apos;Problem!&apos;);
}

asyncFunc()
.catch(err =&gt; console.log(err));
// Error: Problem!
</code></pre><h2 id="é€šè¿‡-await-å¤„ç†-async-å¼‚æ­¥-è®¡ç®—çš„ç»“æœå’Œé”™è¯¯"><a href="#é€šè¿‡-await-å¤„ç†-async-å¼‚æ­¥-è®¡ç®—çš„ç»“æœå’Œé”™è¯¯" class="headerlink" title="é€šè¿‡ await å¤„ç† async(å¼‚æ­¥) è®¡ç®—çš„ç»“æœå’Œé”™è¯¯"></a>é€šè¿‡ <code>await</code> å¤„ç† async(å¼‚æ­¥) è®¡ç®—çš„ç»“æœå’Œé”™è¯¯</h2><p><code>await</code>ï¼ˆåªå…è®¸åœ¨ async(å¼‚æ­¥) å‡½æ•°å†…éƒ¨ä½¿ç”¨ï¼‰ç­‰å¾…å…¶æ“ä½œå¯¹è±¡ Promise è¿”å›ï¼š</p>
<ul>
<li>å¦‚æœ Promise æ˜¯å®ŒæˆçŠ¶æ€ï¼Œ<code>await</code> çš„ç»“æœæ˜¯å®Œæˆæ€çš„å€¼ã€‚</li>
<li>å¦‚æœ Promise æ˜¯æ‹’ç»çŠ¶æ€ï¼Œ<code>await</code> ä¼šæŠ›å‡ºæ‹’ç»å€¼ã€‚</li>
</ul>
<p>å¤„ç†å•ä¸ª async(å¼‚æ­¥) è¿”å›å€¼ï¼š</p>
<pre><code>async function asyncFunc() {
const result = await otherAsyncFunc();
   console.log(result);
}

// ç­‰ä»·äº:
function asyncFunc() {
return otherAsyncFunc()
.then(result =&gt; {
       console.log(result);
});
}
</code></pre><p>æŒ‰é¡ºåºå¤„ç†å¤šä¸ª async(å¼‚æ­¥) è¿”å›å€¼ï¼š</p>
<pre><code>async function asyncFunc() {
const result1 = await otherAsyncFunc1();
   console.log(result1);
const result2 = await otherAsyncFunc2();
   console.log(result2);
}

// ç­‰ä»·äº:
function asyncFunc() {
return otherAsyncFunc1()
.then(result1 =&gt; {
       console.log(result1);
return otherAsyncFunc2();
})
.then(result2 =&gt; {
       console.log(result2);
});
}
</code></pre><p>å¹¶è¡Œå¤„ç†å¤šä¸ª async(å¼‚æ­¥) è¿”å›å€¼ï¼š</p>
<pre><code>async function asyncFunc() {
const [result1, result2] = await Promise.all([
       otherAsyncFunc1(),
       otherAsyncFunc2(),
]);
   console.log(result1, result2);
}

// ç­‰ä»·äº:
function asyncFunc() {
return Promise.all([
       otherAsyncFunc1(),
       otherAsyncFunc2(),
])
.then([result1, result2] =&gt; {
       console.log(result1, result2);
});
}
</code></pre><p>é”™è¯¯å¤„ç†ï¼š</p>
<pre><code>async function asyncFunc() {
try {
await otherAsyncFunc();
} catch (err) {
       console.error(err);
}
}

// ç­‰ä»·äº:
function asyncFunc() {
return otherAsyncFunc()
.catch(err =&gt; {
       console.error(err);
});
}
</code></pre><h2 id="ç†è§£-async-å¼‚æ­¥-å‡½æ•°"><a href="#ç†è§£-async-å¼‚æ­¥-å‡½æ•°" class="headerlink" title="ç†è§£ async(å¼‚æ­¥) å‡½æ•°"></a>ç†è§£ async(å¼‚æ­¥) å‡½æ•°</h2><p>åœ¨æˆ‘è§£é‡Š async(å¼‚æ­¥) å‡½æ•°ä¹‹å‰ï¼Œæˆ‘éœ€è¦è§£é‡Šä¸€ä¸‹å¦‚ä½•ç»„åˆä½¿ç”¨ Promises å’Œ Generator ï¼Œé€šè¿‡çœ‹èµ·æ¥åŒæ­¥çš„ä»£ç æ¥æ‰§è¡Œ async(å¼‚æ­¥) æ“ä½œã€‚</p>
<p>å¯¹äºèƒ½å¤Ÿ async(å¼‚æ­¥) è®¡ç®—å…¶ä¸€æ¬¡æ€§ç»“æœçš„å‡½æ•°ï¼Œä½œä¸º ES6 ä¸€éƒ¨åˆ†çš„ Promises å·²ç»å˜å¾—æµè¡Œèµ·æ¥ã€‚ä¸€ä¸ªä¾‹å­æ˜¯ <a href="https://link.zhihu.com/?target=https%3A//fetch.spec.whatwg.org/%23concept-request" target="_blank" rel="noopener">å®¢æˆ·ç«¯ fetch API</a> ï¼Œå®ƒæ˜¯ XMLHttpRequest è·å–æ•°æ®çš„æ›¿ä»£æ–¹æ³•ã€‚ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<pre><code>function fetchJson(url) {
return fetch(url)
.then(request =&gt; request.text())
.then(text =&gt; {
return JSON.parse(text);
})
.catch(error =&gt; {
       console.log(`ERROR: ${error.stack}`);
});
}
fetchJson(&apos;http://example.com/some_file.json&apos;)
.then(obj =&gt; console.log(obj));
</code></pre><h2 id="é€šè¿‡-generator-æ¥ç¼–å†™å¼‚æ­¥ä»£ç "><a href="#é€šè¿‡-generator-æ¥ç¼–å†™å¼‚æ­¥ä»£ç " class="headerlink" title="é€šè¿‡ generator æ¥ç¼–å†™å¼‚æ­¥ä»£ç "></a>é€šè¿‡ generator æ¥ç¼–å†™å¼‚æ­¥ä»£ç </h2><p>co æ˜¯ä¸€ä¸ªä½¿ç”¨ Promise å’Œ generator æ¥å®ç°çœ‹ä¼¼åŒæ­¥ç¼–ç çš„åº“ï¼Œä½†ä¸ä¸Šä¸€ç¤ºä¾‹ä¸­ä½¿ç”¨çš„æ ·å¼ç›¸åŒï¼š</p>
<pre><code>const fetchJson = co.wrap(function* (url) {
try {
let request = yield fetch(url);
let text = yield request.text();
return JSON.parse(text);
}
catch (error) {
       console.log(`ERROR: ${error.stack}`);
}
});
</code></pre><p>æ¯æ¬¡å›è°ƒå‡½æ•°ï¼ˆ generator å‡½æ•°ï¼‰äº§ç”Ÿä¸€ä¸ª Promise å¯¹è±¡ç»™ co ï¼Œå›è°ƒä¼šè¢«æš‚åœï¼Œåªæœ‰å½“ Promise æ‰§è¡Œå®Œæˆåï¼Œco æ‰ä¼šç»§ç»­æ‰§è¡Œå›è°ƒ ã€‚ å¦‚æœ Promise å¤„äºå®ŒæˆçŠ¶æ€ï¼Œ<code>yield</code> è¿”å›å®ŒæˆçŠ¶æ€çš„å€¼ï¼Œå¦‚æœå¤„äºæ‹’ç»çŠ¶æ€ï¼Œ<code>yield</code> æŠ›å‡ºæ‹’ç»çŠ¶æ€çš„é”™è¯¯ã€‚æ­¤å¤–ï¼Œco ä¿è¯ç»“æœæ˜¯é€šè¿‡å›è°ƒæ‰§è¡Œå®Œæˆæ‰è¿”å›çš„ï¼ˆç±»ä¼¼äº <code>then()</code> æ‰€åšçš„å·¥ä½œï¼‰ã€‚</p>
<h2 id="é€šè¿‡-async-å¼‚æ­¥-å‡½æ•°æ¥ç¼–å†™å¼‚æ­¥ä»£ç "><a href="#é€šè¿‡-async-å¼‚æ­¥-å‡½æ•°æ¥ç¼–å†™å¼‚æ­¥ä»£ç " class="headerlink" title="é€šè¿‡ async(å¼‚æ­¥) å‡½æ•°æ¥ç¼–å†™å¼‚æ­¥ä»£ç "></a>é€šè¿‡ async(å¼‚æ­¥) å‡½æ•°æ¥ç¼–å†™å¼‚æ­¥ä»£ç </h2><p>async(å¼‚æ­¥) å‡½æ•°ç”¨çš„ç‰¹å®šè¯­æ³•åŸºæœ¬ä¸Šå’Œ co ç±»ä¼¼ï¼š</p>
<pre><code>async function fetchJson(url) {
try {
let request = await fetch(url);
let text = await request.text();
return JSON.parse(text);
}
catch (error) {
       console.log(`ERROR: ${error.stack}`);
}
}
</code></pre><p>åœ¨å†…éƒ¨ï¼Œå¼‚æ­¥å‡½æ•°å†™æ³•æ›´ç±»ä¼¼äº generators ã€‚</p>
<h2 id="ä»¥åŒæ­¥å¼€å§‹ï¼Œå¼‚æ­¥å¤„ç†çš„-async-å¼‚æ­¥-å‡½æ•°"><a href="#ä»¥åŒæ­¥å¼€å§‹ï¼Œå¼‚æ­¥å¤„ç†çš„-async-å¼‚æ­¥-å‡½æ•°" class="headerlink" title="ä»¥åŒæ­¥å¼€å§‹ï¼Œå¼‚æ­¥å¤„ç†çš„ async(å¼‚æ­¥) å‡½æ•°"></a>ä»¥åŒæ­¥å¼€å§‹ï¼Œå¼‚æ­¥å¤„ç†çš„ async(å¼‚æ­¥) å‡½æ•°</h2><p>ä»¥ä¸‹æ˜¯ async(å¼‚æ­¥)å‡½æ•°æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼š</p>
<ol>
<li>async(å¼‚æ­¥) å‡½æ•°æ€»æ˜¯è¿”å›ä¸€ä¸ª Promise å¯¹è±¡ <code>p</code> ã€‚Promise å¯¹è±¡åœ¨ async(å¼‚æ­¥) å‡½æ•°å¼€å§‹æ‰§è¡Œæ—¶è¢«åˆ›å»ºã€‚</li>
<li>å‡½æ•°ä½“æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯ä»¥é€šè¿‡ <code>return</code> æˆ– <code>throw</code> ç»ˆæ­¢æ‰§è¡Œã€‚æˆ–è€…é€šè¿‡ <code>await</code> æš‚åœæ‰§è¡Œï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé€šå¸¸ä¼šåœ¨ä»¥åç»§ç»­æ‰§è¡Œã€‚</li>
<li>è¿”å› Promise å¯¹è±¡ <code>p</code>ã€‚</li>
</ol>
<p>å½“æ‰§è¡Œ async(å¼‚æ­¥) å‡½æ•°çš„å‡½æ•°ä½“æ—¶ï¼Œ<code>return x</code> ä¸­çš„ <code>x</code> æ˜¯ Promise å¯¹è±¡ <code>p</code> çš„å®ŒæˆçŠ¶æ€çš„ç»“æœï¼Œè€Œ <code>throw err</code> æ˜¯ <code>p</code> çš„æ‹’ç»çŠ¶æ€çš„ç»“æœã€‚æ‰§è¡Œç»“æœæ˜¯å¼‚æ­¥è¿”å›çš„ã€‚æ¢å¥è¯è¯´ï¼š<code>then()</code> å’Œ <code>catch()</code> çš„å›è°ƒæ€»æ˜¯åœ¨å½“å‰ä»£ç å®Œæˆåæ‰§è¡Œã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä»£ç ç¤ºä¾‹ï¼š</p>
<pre><code>async function asyncFunc() {
   console.log(&apos;asyncFunc()&apos;); // (A)
return &apos;abc&apos;;
}
asyncFunc().
then(x =&gt; console.log(`Resolved: ${x}`)); // (B)
console.log(&apos;main&apos;); // (C)

// Output:
// asyncFunc()
// main
// Resolved: abc
</code></pre><p>æ‚¨å¯ä»¥è®¤ä¸ºæ˜¯ä»¥ä¸‹çš„æ‰§è¡Œé¡ºåºï¼š</p>
<ol>
<li>è¡ŒAï¼šasync(å¼‚æ­¥) å‡½æ•°ä»¥åŒæ­¥å¼€å§‹ã€‚async(å¼‚æ­¥) å‡½æ•°çš„ Promise é€šè¿‡ <code>return</code> æ¥è¿”å›å®ŒæˆçŠ¶æ€çš„ç»“æœã€‚</li>
<li>è¡ŒCï¼šæ‰§è¡Œç»§ç»­ã€‚</li>
<li>è¡ŒBï¼šPromise å®ŒæˆçŠ¶æ€é€šçŸ¥æ˜¯å¼‚æ­¥å‘ç”Ÿçš„ã€‚</li>
</ol>
<h2 id="è¿”å›ä¸è¢«åŒ…è£¹çš„-Promise-å¯¹è±¡"><a href="#è¿”å›ä¸è¢«åŒ…è£¹çš„-Promise-å¯¹è±¡" class="headerlink" title="è¿”å›ä¸è¢«åŒ…è£¹çš„ Promise å¯¹è±¡"></a>è¿”å›ä¸è¢«åŒ…è£¹çš„ Promise å¯¹è±¡</h2><p>Promise çš„ resolve æ˜¯ä¸€é¡¹æ ‡å‡†æ“ä½œã€‚ <code>return</code> å°±æ˜¯ä½¿ç”¨å®ƒæ¥ resolve async(å¼‚æ­¥) å‡½æ•°çš„ Promise <code>p</code> çš„ã€‚è¿™æ„å‘³ç€ï¼š</p>
<ol>
<li>è¿”å›ä¸€ä¸ªé Promise å€¼ï¼Œè¯¥å€¼å°†è¢«å¤„ç†æˆ <code>p</code> çš„å®ŒæˆçŠ¶æ€å€¼ã€‚</li>
<li>è¿”å›ä¸€ä¸ª Promise å¯¹è±¡ï¼Œé‚£ä¹ˆ <code>p</code> æ­¤æ—¶ç›¸å½“äºæ˜¯è¯¥ Promise çš„çŠ¶æ€ã€‚</li>
</ol>
<p>å› æ­¤ï¼Œæ‚¨å¯ä»¥è¿”å›ä¸€ä¸ª Promise ï¼Œå¹¶ä¸”è¿™ä¸ª Promise ä¸ä¼šåŒ…è£¹åœ¨åˆ«çš„ Promise ä¸­ï¼š</p>
<pre><code>async function asyncFunc() {
return Promise.resolve(123);
}
asyncFunc()
.then(x =&gt; console.log(x)) // 123
</code></pre><p>æœ‰è¶£çš„æ˜¯ï¼Œè¿”å›ä¸€ä¸ªæ‹’ç»çŠ¶æ€ï¼ˆrejectï¼‰çš„ Promise å¯¹è±¡ä¼šå¯¼è‡´ async(å¼‚æ­¥) å‡½æ•°è¢«æ‹’ç»ï¼ˆrejectï¼‰ï¼ˆé€šå¸¸ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <code>throw</code> ï¼‰ï¼š</p>
<pre><code>async function asyncFunc() {
return Promise.reject(new Error(&apos;Problem!&apos;));
}
asyncFunc()
.catch(err =&gt; console.error(err)); // Error: Problem!
</code></pre><p>è¿™ä¸ Promise è§£å†³æ–¹æ¡ˆçš„å·¥ä½œæ–¹å¼æ˜¯ä¸€è‡´çš„ã€‚ ä½¿ä½ èƒ½å¤Ÿåœ¨ä¸ä½¿ç”¨ <code>await</code> çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨å…¶ä»– async(å¼‚æ­¥) è®¡ç®—æ¥æ‰§è¡Œå®Œæˆå’Œæ‹’ç»å¤„ç†ï¼š</p>
<pre><code>async function asyncFunc() {
return anotherAsyncFunc();
}
</code></pre><p>ä¸Šé¢çš„ä»£ç ç¤ºä¾‹å’Œä¸‹é¢çš„ç±»ä¼¼ï¼Œä½†æ˜¯æ¯”ä¸‹é¢çš„æ›´é«˜æ•ˆã€‚ï¼ˆä»¥ä¸‹ä»£ç ç¤ºä¾‹æ²¡æœ‰åŒ…è£¹ <code>anotherAsyncFunc()</code> çš„ Promise ï¼Œè€Œæ˜¯åŒ…è£¹ <code>anotherAsyncFunc()</code> æœ¬èº« ï¼‰ï¼š</p>
<pre><code>async function asyncFunc() {
return await anotherAsyncFunc();
}
</code></pre><h2 id="ä½¿ç”¨-await-å°è´´å£«"><a href="#ä½¿ç”¨-await-å°è´´å£«" class="headerlink" title="ä½¿ç”¨ await å°è´´å£«"></a>ä½¿ç”¨ <code>await</code> å°è´´å£«</h2><h2 id="ä¸è¦å¿˜è®°ä½¿ç”¨-await"><a href="#ä¸è¦å¿˜è®°ä½¿ç”¨-await" class="headerlink" title="ä¸è¦å¿˜è®°ä½¿ç”¨ await"></a>ä¸è¦å¿˜è®°ä½¿ç”¨ <code>await</code></h2><p>åœ¨ async(å¼‚æ­¥) å‡½æ•°ä¸­å®¹æ˜“çŠ¯çš„ä¸€ä¸ªé”™è¯¯å°±æ˜¯åœ¨è°ƒç”¨ async(å¼‚æ­¥) å‡½æ•°æ—¶å¿˜è®°ä½¿ç”¨ <code>await</code> ï¼š</p>
<pre><code>async function asyncFunc() {
const value = otherAsyncFunc(); // missing `await`!
Â·Â·Â·
}
</code></pre><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ–¹æ³•æ‰§è¡Œè¿”å›çš„ Promise å¯¹è±¡èµ‹å€¼ç»™äº† <code>value</code> ï¼Œå®ƒé€šå¸¸ä¸æ˜¯ä½ åœ¨ async(å¼‚æ­¥) å‡½æ•°ä¸­æƒ³è¦çš„ç»“æœã€‚</p>
<p>await ç”šè‡³å¯ä»¥åœ¨ async(å¼‚æ­¥) å‡½æ•°ä¸è¿”å›ä»»ä½•å€¼çš„æƒ…å†µä¸‹èµ·ä½œç”¨ã€‚å®ƒçš„ Promise åªæ˜¯ç”¨æ¥å‘Šè¯‰è°ƒç”¨è€…å®ŒæˆçŠ¶æ€ã€‚ä¾‹å¦‚ï¼š</p>
<pre><code>async function foo() {
await step1(); // (A)
Â·Â·Â·
}
</code></pre><p>è¡ŒAä¸­çš„ <code>await</code> ç¡®ä¿åœ¨æ‰§è¡Œ <code>foo()</code> å‰©ä½™éƒ¨åˆ†ä¹‹å‰ï¼Œ <code>step1()</code> å·²ç»æ‰§è¡Œå®Œæˆã€‚</p>
<h2 id="ä¸éœ€è¦ä½¿ç”¨-await-çš„æƒ…å†µ"><a href="#ä¸éœ€è¦ä½¿ç”¨-await-çš„æƒ…å†µ" class="headerlink" title="ä¸éœ€è¦ä½¿ç”¨ await çš„æƒ…å†µ"></a>ä¸éœ€è¦ä½¿ç”¨ await çš„æƒ…å†µ</h2><p>æœ‰æ—¶ï¼Œä½ åªæƒ³è§¦å‘å¼‚æ­¥è®¡ç®—ï¼Œå¹¶ä¸”ä¸éœ€è¦å…³æ³¨å®ƒä»€ä¹ˆæ—¶å€™å®Œæˆã€‚ä»¥ä¸‹æ˜¯ä»£ç ç¤ºä¾‹ï¼š</p>
<pre><code>async function asyncFunc() {
const writer = openFile(&apos;someFile.txt&apos;);
   writer.write(&apos;hello&apos;); // donâ€™t wait
   writer.write(&apos;world&apos;); // donâ€™t wait
await writer.close(); // wait for file to close
}
</code></pre><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¸å…³å¿ƒå•ä¸ªçš„å†™å…¥æ“ä½œæ˜¯å¦å®Œæˆï¼Œåªéœ€è¦ä»–ä»¬ä»¥æ­£ç¡®çš„é¡ºåºæ‰§è¡Œ (APIå¿…é¡»ä¿è¯ï¼Œä½†è¿™æ˜¯ç”± async(å¼‚æ­¥) å‡½æ•°çš„æ‰§è¡Œæ¨¡å‹æ‰€é¼“åŠ±çš„ï¼Œæ­£å¦‚æˆ‘ä»¬æ‰€è§)ã€‚</p>
<p><code>asyncFunc()</code> å‡½æ•°æœ€åä¸€è¡Œçš„ <code>await</code> ç¡®ä¿è¯¥å‡½æ•°ä»…åœ¨æ–‡ä»¶å†™å…¥å…³é—­åæ‰ä¼šæ‰§è¡Œã€‚</p>
<p>ç”±äºè¿”å›çš„ Promises æ²¡æœ‰è¢«å…¶ä»– async(å¼‚æ­¥) å‡½æ•°åŒ…è£¹ï¼Œæ‰€ä»¥ä½ å¯ä»¥ç”¨ <code>return</code> æ›¿æ¢ <code>await writer.close()</code> ï¼š</p>
<pre><code>async function asyncFunc() {
const writer = openFile(&apos;someFile.txt&apos;);
   writer.write(&apos;hello&apos;);
   writer.write(&apos;world&apos;);
return writer.close();
}
</code></pre><p>è¿™ä¸¤ä¸ªç‰ˆæœ¬å„æœ‰åˆ©å¼Šï¼Œ<code>await</code> ç‰ˆæœ¬å¯èƒ½ç¨å¾®æ›´å®¹æ˜“ç†è§£ã€‚</p>
<h2 id="await-æ˜¯é¡ºåºæ‰§è¡Œçš„ï¼ŒPromise-all-æ˜¯å¹¶è¡Œçš„"><a href="#await-æ˜¯é¡ºåºæ‰§è¡Œçš„ï¼ŒPromise-all-æ˜¯å¹¶è¡Œçš„" class="headerlink" title="await æ˜¯é¡ºåºæ‰§è¡Œçš„ï¼ŒPromise.all() æ˜¯å¹¶è¡Œçš„"></a>await æ˜¯é¡ºåºæ‰§è¡Œçš„ï¼ŒPromise.all() æ˜¯å¹¶è¡Œçš„</h2><p>ä¸‹é¢çš„ä»£ç è°ƒç”¨äº†ä¸¤ä¸ª async(å¼‚æ­¥) å‡½æ•°ï¼Œ <code>asyncFunc1()</code> å’Œ <code>asyncFunc1()</code> ã€‚</p>
<pre><code>async function foo() {
const result1 = await asyncFunc1();
const result2 = await asyncFunc2();
}
</code></pre><p>è¿™ä¸¤ä¸ªå‡½æ•°è°ƒç”¨é¡ºåºæ‰§è¡Œã€‚ä½†æ˜¯å¹¶è¡Œæ‰§è¡Œå®ƒä»¬å¾€å¾€ä¼šåŠ å¿«é€Ÿåº¦ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ Promise.all() ï¼š</p>
<pre><code>async function foo() {
const [result1, result2] = await Promise.all([
       asyncFunc1(),
       asyncFunc2(),
]);
}
</code></pre><p>æˆ‘ä»¬ç°åœ¨æ­£åœ¨ç­‰å¾…ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªå…ƒç´ çš„æ•°ç»„çš„ Promise ï¼Œè€Œä¸æ˜¯ç­‰å¾…ä¸¤ä¸ª Promiseã€‚</p>
<h2 id="å¼‚æ­¥å‡½æ•°å’Œå›è°ƒ"><a href="#å¼‚æ­¥å‡½æ•°å’Œå›è°ƒ" class="headerlink" title="å¼‚æ­¥å‡½æ•°å’Œå›è°ƒ"></a>å¼‚æ­¥å‡½æ•°å’Œå›è°ƒ</h2><p>async(å¼‚æ­¥) å‡½æ•°çš„ä¸€ä¸ªé™åˆ¶æ˜¯ <code>await</code>(ç­‰å¾…) åªå½±å“ç›´æ¥ç›¸å…³çš„ async(å¼‚æ­¥) å‡½æ•°ã€‚å› æ­¤ï¼Œasync(å¼‚æ­¥) å‡½æ•°æ— æ³•åœ¨å›è°ƒï¼ˆä½†æ˜¯ï¼Œå›è°ƒå¯ä»¥æ˜¯ async(å¼‚æ­¥) å‡½æ•°æœ¬èº«ï¼Œç¨åæˆ‘ä»¬å°†ä¼šçœ‹åˆ°ï¼‰ä¸­ä½¿ç”¨ <code>await</code>(ç­‰å¾…)ã€‚è¿™ä½¿å¾—åŸºäºå›è°ƒçš„å®ç”¨å‡½æ•°å’Œæ–¹æ³•éš¾ä»¥ä½¿ç”¨ã€‚ä¾‹å­ä¸­æˆ‘ä»¬å°†ä½¿ç”¨æ•°ç»„æ–¹æ³• <code>map()</code> å’Œ <code>forEach()</code>ã€‚</p>
<h2 id="Array-prototype-map"><a href="#Array-prototype-map" class="headerlink" title="Array.prototype.map()"></a>Array.prototype.map()</h2><p>æˆ‘ä»¬ä»æ•°ç»„æ–¹æ³• <code>map()</code> å¼€å§‹è®²è§£ã€‚åœ¨ä¸‹é¢çš„ä»£ç ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬æƒ³è¦åŠ è½½ç”± URLs æ•°ç»„æŒ‡å‘çš„æ–‡ä»¶ï¼Œå¹¶å°†å®ƒä»¬è¿”å›åˆ°æ•°ç»„ä¸­ã€‚</p>
<pre><code>async function downloadContent(urls) {
return urls.map(url =&gt; {
// é”™è¯¯çš„è¯­æ³•!
const content = await httpGet(url);
return content;
});
}
</code></pre><p>è¿™ä¸èµ·ä½œç”¨ï¼Œå› ä¸ºåœ¨æ­£å¸¸ç®­å¤´å‡½æ•°ä¸­ <code>await</code> è¯­æ³•ä¸Šæ˜¯éæ³•çš„(æ„šäººç å¤´æ³¨ï¼š <code>await</code>(ç­‰å¾…) åªå½±å“ç›´æ¥ç›¸å…³çš„ async(å¼‚æ­¥) å‡½æ•°)ã€‚é‚£ä¹ˆå¦‚ä½•ä½¿ç”¨å¼‚æ­¥çš„ç®­å¤´å‡½æ•°å‘¢ï¼Ÿ</p>
<pre><code>async function downloadContent(urls) {
return urls.map(async (url) =&gt; { // æ³¨æ„è¿™ä¸€è¡Œä¸­çš„ async ;
const content = await httpGet(url);
return content;
});
}
</code></pre><p>è¿™æ®µä»£ç æœ‰ä¸¤ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>ç°åœ¨è¿”å›çš„ç»“æœæ˜¯ä¸€ä¸ª Promises å¯¹è±¡çš„æ•°ç»„ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²çš„æ•°ç»„ã€‚</li>
<li>ä¸€æ—¦ <code>map()</code> æ‰§è¡Œå®Œæˆï¼Œå›è°ƒæ‰§è¡Œçš„å·¥ä½œå¹¶ä¸èƒ½åŒæ—¶å®Œæˆï¼Œå› ä¸º <code>await</code> åªæš‚åœäº†åŒ…è£¹å®ƒçš„ç®­å¤´å‡½æ•° å’Œ <code>httpGet()</code> å¼‚æ­¥æ‰§è¡Œè¾¾åˆ°å®ŒæˆçŠ¶æ€ã€‚è¿™æ„å‘³ç€ä½ ä¸èƒ½ä½¿ç”¨ <code>await</code>ï¼Œæ¥ç­‰å¾… <code>downloadContent()</code> æ‰§è¡Œç»“æŸã€‚</li>
</ul>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>Promise.all()</code> æ¥è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œ<code>Promise.all()</code> å¯ä»¥å°†ä¸€ç³»åˆ—çš„ Promise è½¬æ¢ä¸ºä¸€ä¸ª Promise æ•°ç»„ï¼ˆæ‰€æœ‰å€¼éƒ½æ˜¯ç»è¿‡ Promise å®Œæˆå¹¶è¿”å›ï¼‰ï¼š</p>
<pre><code>async function downloadContent(urls) {
const promiseArray = urls.map(async (url) =&gt; {
const content = await httpGet(url);
return content;
});
return await Promise.all(promiseArray);
}
</code></pre><p><code>map()</code> çš„å›è°ƒå¹¶ä¸å¯¹ <code>httpGet()</code> çš„ç»“æœèµ·ä½œç”¨ï¼Œåªæ˜¯èµ·åˆ°ä¸æ–­æ‰§è¡Œçš„ä½œç”¨ã€‚å› æ­¤ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸éœ€è¦ä¸€ä¸ªå¼‚æ­¥çš„ç®­å¤´å‡½æ•°ï¼Œåªéœ€è¦ä¸€ä¸ªæ™®é€šçš„ç®­å¤´å‡½æ•°å°±èƒ½è¾¾åˆ°ç›¸åŒçš„ç»“æœã€‚</p>
<pre><code>async function downloadContent(urls) {
const promiseArray = urls.map(
       url =&gt; httpGet(url));
return await Promise.all(promiseArray);
}
</code></pre><p>æˆ‘ä»¬ä»ç„¶å¯ä»¥åšä¸€ä¸ªå°çš„æ”¹è¿›ï¼šè¿™ä¸ªå¼‚æ­¥å‡½æ•°ç¨å¾®æœ‰ç‚¹ä½æ•ˆ â€“ é¦–å…ˆé€šè¿‡ <code>await</code> æ¥è§£å¼€ <code>Promise.all()</code> çš„ç»“æœï¼Œç„¶åé€šè¿‡ <code>return</code> å†æ¬¡åŒ…è£¹å®ƒã€‚ å‡è®¾ <code>return</code> ä¸åŒ…è£¹ Promisesï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è¿”å› <code>Promise.all()</code> çš„ç»“æœï¼š</p>
<pre><code>async function downloadContent(urls) {
const promiseArray = urls.map(
       url =&gt; httpGet(url));
return Promise.all(promiseArray);
}
</code></pre><h2 id="Array-prototype-forEach"><a href="#Array-prototype-forEach" class="headerlink" title="Array.prototype.forEach()"></a>Array.prototype.forEach()</h2><p>æˆ‘ä»¬ä½¿ç”¨æ•°ç»„çš„ forEach() æ–¹æ³•åœ¨æ§åˆ¶å°ä¸­æ‰“å°å‡ ä¸ªé€šè¿‡ URLs åŠ è½½çš„æ–‡ä»¶çš„å†…å®¹ï¼š</p>
<pre><code>async function logContent(urls) {
   urls.forEach(url =&gt; {
// Wrong syntax
const content = await httpGet(url);
       console.log(content);
});
}
</code></pre><p>åŒæ ·çš„ï¼Œè¿™é‡Œçš„ä»£ç ä¼šäº§ç”Ÿä¸€ä¸ªè¯­æ³•é”™è¯¯ï¼Œå› ä¸ºä½ ä¸èƒ½åœ¨é€šå¸¸çš„ç®­å¤´å‡½æ•°å†…éƒ¨ä½¿ç”¨ <code>await</code> ã€‚</p>
<p>æˆ‘ä»¬æ¢ä½œå¼‚æ­¥ç®­å¤´å‡½æ•°ï¼š</p>
<pre><code>async function logContent(urls) {
   urls.forEach(async url =&gt; {
const content = await httpGet(url);
       console.log(content);
});
// Not finished here
}
</code></pre><p>è¿™æ®µä»£ç èµ·ä½œç”¨äº†ï¼Œä½†æ˜¯ä¼šå‡ºç°ä¸€ä¸ªè­¦å‘Šï¼š<code>httpGet()</code> è¿”å›çš„ Promise å¯¹è±¡æ˜¯å¼‚æ­¥å®Œæˆçš„ï¼Œè¿™ä¹Ÿæ„å‘³ç€å½“ <code>forEach()</code> è¿”å›çš„æ—¶å€™å›è°ƒå¯èƒ½è¿˜æ²¡æœ‰ç»“æŸï¼Œå› æ­¤ä½ æ— æ³•ç­‰åˆ° <code>logContent()</code> åªèƒ½ç»“æŸã€‚</p>
<p>å¦‚æœä½ å¹¶ä¸æƒ³è¦è¿™ä¸ªç»“æœï¼Œä½ å¯ä»¥å°† <code>forEach()</code> è½¬æ¢ä¸º <code>for-of</code> å¾ªç¯ã€‚</p>
<pre><code>async function logContent(urls) {
for (const url of urls) {
const content = await httpGet(url);
       console.log(content);
}
}
</code></pre><p>ç°åœ¨ä¸€åˆ‡éƒ½åœ¨ <code>for-of</code> å¾ªç¯å®Œæˆåå®Œæˆã€‚ä½†æ˜¯ï¼Œå¤„ç†æ­¥éª¤ä¾æ¬¡å‘ç”Ÿï¼š<code>httpGet()</code> åªæ˜¯åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨å®Œæˆåå†æ¬¡è°ƒç”¨ã€‚å¦‚æœæ‚¨å¸Œæœ›å¤„ç†æ­¥éª¤å¹¶è¡Œæ‰§è¡Œï¼Œä½ å¿…é¡»ä½¿ç”¨ <code>Promise.all()</code>ï¼š</p>
<pre><code>async function logContent(urls) {
await Promise.all(urls.map(
async url =&gt; {
const content = await httpGet(url);
           console.log(content);
}));
}
</code></pre><p><code>map()</code> ç”¨äºåˆ›å»ºä¸€ä¸ª Promises æ•°ç»„ã€‚ æˆ‘ä»¬å¯¹ä»–ä»¬çš„å®Œæˆç»“æœå¹¶ä¸æ„Ÿå…´è¶£ï¼Œæˆ‘ä»¬åªè¦ <code>await</code>(ç­‰å¾…) æ‰€æœ‰æ–¹æ³•æ‰§è¡Œå®Œæˆã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¸Œæœ›çš„æ˜¯åœ¨ async(å¼‚æ­¥) å‡½æ•°å®Œæˆä¹‹åæ‰€æœ‰çš„æ‰§è¡Œéƒ½å·²ç»å®Œæˆã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥è¿”å› <code>Promise.all()</code> ï¼Œä½†æ˜¯è¯¥å‡½æ•°çš„ç»“æœæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå…¶å…ƒç´ éƒ½æ˜¯æœªå®ŒæˆçŠ¶æ€çš„ã€‚</p>
<h2 id="ä½¿ç”¨å¼‚æ­¥å‡½æ•°å°è´´å£«"><a href="#ä½¿ç”¨å¼‚æ­¥å‡½æ•°å°è´´å£«" class="headerlink" title="ä½¿ç”¨å¼‚æ­¥å‡½æ•°å°è´´å£«"></a>ä½¿ç”¨å¼‚æ­¥å‡½æ•°å°è´´å£«</h2><h2 id="äº†è§£ä½ çš„-Promises"><a href="#äº†è§£ä½ çš„-Promises" class="headerlink" title="äº†è§£ä½ çš„ Promises"></a>äº†è§£ä½ çš„ Promises</h2><p>async(å¼‚æ­¥) å‡½æ•°çš„åŸºç¡€å°±æ˜¯ <a href="https://link.zhihu.com/?target=http%3A//exploringjs.com/es6/ch_promises.html" target="_blank" rel="noopener">Promises</a> å¯¹è±¡ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆç†è§£ Promises å¯¹äºç†è§£ async(å¼‚æ­¥) å‡½æ•°è‡³å…³é‡è¦ã€‚ç‰¹åˆ«æ˜¯å½“é‡åˆ°ä¸æ˜¯åŸºäº Promises çš„è€ä»£ç æ¥å®ç° async(å¼‚æ­¥) å‡½æ•°æ—¶ï¼Œä½ é€šå¸¸åˆ«æ— é€‰æ‹©ï¼Œåªèƒ½ç”¨ Promise æ¥é‡æ„ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œè¿™é‡Œæœ‰ä¸ª â€œpromisifiedâ€ ç‰ˆæœ¬çš„ <code>XMLHttpRequest</code> ï¼š</p>
<pre><code>function httpGet(url, responseType=&quot;&quot;) {
return new Promise(
function (resolve, reject) {
const request = new XMLHttpRequest();
           request.onload = function () {
if (this.status === 200) {
// Success
                   resolve(this.response);
} else {
// Something went wrong (404 etc.)
                   reject(new Error(this.statusText));
}
};
           request.onerror = function () {
               reject(new Error(
&apos;XMLHttpRequest Error: &apos;+this.statusText));
};
           request.open(&apos;GET&apos;, url);
           xhr.responseType = responseType;
           request.send();
});
}
</code></pre><p>XMLHttpRequest çš„ API æ˜¯åŸºäºå›è°ƒçš„ã€‚é€šè¿‡ä¸€ä¸ª async(å¼‚æ­¥) å‡½æ•°æ¥å®ç°å®ƒï¼Œæ„å‘³ç€ä½ å¿…é¡»åœ¨å›è°ƒä¸­è¿”å› Promise çš„å®Œæˆ(fulfill) æˆ–æ‹’ç»(reject) çŠ¶æ€ã€‚è¿™æ˜¯ä¸å¯èƒ½çš„ï¼Œå› ä¸ºä½ åªèƒ½é€šè¿‡ <code>return</code> æˆ–è€… <code>throw</code> æ¥å®Œæˆè¿™æ ·çš„æ“ä½œã€‚ä½ ä¸èƒ½ä»å›è°ƒå‡½æ•°å†…éƒ¨ <code>return</code> ä¸€ä¸ªå‡½æ•°çš„ç»“æœã€‚<code>throw</code>ä¹Ÿæœ‰ç±»ä¼¼çš„çº¦æŸã€‚</p>
<p>å› æ­¤ï¼Œå¼‚æ­¥å‡½æ•°çš„é€šç”¨ç¼–ç é£æ ¼æ˜¯ï¼š</p>
<ul>
<li>ç›´æ¥ä½¿ç”¨ Promise å¯¹è±¡æ¥æ„å»ºå¼‚æ­¥åŸè¯­ã€‚</li>
<li>ç”¨å¼‚æ­¥å‡½æ•°æ¥ä½¿ç”¨è¿™äº›åŸè¯­ã€‚</li>
</ul>
<p>æ‰©å±•é˜…è¯»ï¼šâ€œExploring ES6â€ ä¸­çš„ â€œ<a href="https://link.zhihu.com/?target=http%3A//exploringjs.com/es6/ch_promises.html" target="_blank" rel="noopener">å¼‚æ­¥ç¼–ç¨‹ä¸­çš„ Promises å¯¹è±¡</a>â€ ç« èŠ‚</p>
<h2 id="ç«‹å³è°ƒç”¨å¼‚æ­¥å‡½æ•°è¡¨è¾¾å¼"><a href="#ç«‹å³è°ƒç”¨å¼‚æ­¥å‡½æ•°è¡¨è¾¾å¼" class="headerlink" title="ç«‹å³è°ƒç”¨å¼‚æ­¥å‡½æ•°è¡¨è¾¾å¼"></a>ç«‹å³è°ƒç”¨å¼‚æ­¥å‡½æ•°è¡¨è¾¾å¼</h2><p>æœ‰æ—¶ï¼Œå¦‚æœä½ å¯ä»¥åœ¨æ¨¡å—æˆ–è„šæœ¬çš„é¡¶å±‚ä½¿ç”¨ await ï¼Œé‚£å°†æ˜¯ä¸€ç§å¾ˆå¥½çš„é€‰æ‹©ã€‚å½“ç„¶ï¼Œå®ƒåªèƒ½åœ¨å¼‚æ­¥å‡½æ•°ä¸­ä½¿ç”¨ã€‚æ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªå¼‚æ­¥å‡½æ•° <code>main()</code> å¹¶ç«‹å³è°ƒç”¨å®ƒï¼š</p>
<pre><code>async function main() {
   console.log(await asyncFunction());
}
main();
</code></pre><p>æˆ–è€…æ‚¨å¯ä»¥ä½¿ç”¨ç«‹å³è°ƒç”¨å¼‚æ­¥å‡½æ•°è¡¨è¾¾å¼ï¼š</p>
<pre><code>(async function () {
   console.log(await asyncFunction());
})();
</code></pre><p>å¦ä¸€ä¸ªé€‰æ‹©æ˜¯ç«‹å³è°ƒç”¨å¼‚æ­¥ç®­å¤´å‡½æ•°ï¼š</p>
<pre><code>(async () =&gt; {
   console.log(await asyncFunction());
})();
</code></pre><h2 id="ç”¨å¼‚æ­¥å‡½æ•°è¿›è¡Œå•å…ƒæµ‹è¯•"><a href="#ç”¨å¼‚æ­¥å‡½æ•°è¿›è¡Œå•å…ƒæµ‹è¯•" class="headerlink" title="ç”¨å¼‚æ­¥å‡½æ•°è¿›è¡Œå•å…ƒæµ‹è¯•"></a>ç”¨å¼‚æ­¥å‡½æ•°è¿›è¡Œå•å…ƒæµ‹è¯•</h2><p>ä»¥ä¸‹ä»£ç ä½¿ç”¨ <a href="https://link.zhihu.com/?target=https%3A//mochajs.org/" target="_blank" rel="noopener">æµ‹è¯•æ¡†æ¶ mocha</a> å¯¹å¼‚æ­¥å‡½æ•° asyncFun1() å’Œ asyncFun2() æ¥è¿›è¡Œå•å…ƒæµ‹è¯•ï¼š</p>
<pre><code>import assert from &apos;assert&apos;;

// Bug: the following test always succeeds
test(&apos;Testing async code&apos;, function () {
   asyncFunc1() // (A)
.then(result1 =&gt; {
assert.strictEqual(result1, &apos;a&apos;); // (B)
return asyncFunc2();
})
.then(result2 =&gt; {
assert.strictEqual(result2, &apos;b&apos;); // (C)
});
});
</code></pre><p>ç„¶è€Œï¼Œè¿™ä¸ªæµ‹è¯•æ€»æ˜¯æˆåŠŸçš„ï¼Œå› ä¸º mocha ä¸ä¼šç­‰å¾… B è¡Œå’Œ C è¡Œæ–­è¨€æ‰§è¡Œå®Œæˆã€‚</p>
<p>ä½ å¯ä»¥é€šè¿‡è¿”å›é“¾å¼è°ƒç”¨çš„ Promise æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸º mocha ä¼šè¯†åˆ«ä¸€ä¸ªæµ‹è¯•æ˜¯å¦è¿”å›ä¸€ä¸ª Promise ï¼Œç„¶åç­‰å¾…è¯¥ Promise å®Œæˆ å†è¿›è¡Œä¸‹ä¸€æ­¥ï¼ˆé™¤éè¶…æ—¶ï¼‰ã€‚</p>
<pre><code>return asyncFunc1() // (A)
</code></pre><p>å¼‚æ­¥å‡½æ•°æ€»æ˜¯è¿”å› Promises ï¼Œè¿™ä½¿å¾—å®ƒä»¬èƒ½æ–¹ä¾¿çš„ã€å®Œç¾çš„æ¥è¿›è¡Œè¿™ç§å•å…ƒæµ‹è¯•ï¼š</p>
<pre><code>import assert from &apos;assert&apos;;
test(&apos;Testing async code&apos;, async function () {
const result1 = await asyncFunc1();
assert.strictEqual(result1, &apos;a&apos;);
const result2 = await asyncFunc2();
assert.strictEqual(result2, &apos;b&apos;);
});
</code></pre><p>åœ¨ mocha ä¸­ä½¿ç”¨å¼‚æ­¥å•å…ƒæµ‹è¯•å¼‚æ­¥å‡½æ•°æœ‰ä¸¤ä¸ªä¼˜ç‚¹ï¼šä»£ç æ›´ç®€æ´ï¼Œèƒ½å¤Ÿå‡†ç¡®å¤„ç†è¿”å›çš„ Promise å¯¹è±¡ã€‚</p>
<h2 id="ä¸è¦æ‹…å¿ƒæ²¡æœ‰å¤„ç†çš„æ‹’ç»æ‹’æ€"><a href="#ä¸è¦æ‹…å¿ƒæ²¡æœ‰å¤„ç†çš„æ‹’ç»æ‹’æ€" class="headerlink" title="ä¸è¦æ‹…å¿ƒæ²¡æœ‰å¤„ç†çš„æ‹’ç»æ‹’æ€"></a>ä¸è¦æ‹…å¿ƒæ²¡æœ‰å¤„ç†çš„æ‹’ç»æ‹’æ€</h2><p>å½“å‰çš„ JavaScript å¼•æ“å¯ä»¥åœ¨æ‹’ç»æ€æœªå¤„ç†çš„æƒ…å†µä¸‹æå‡ºè­¦å‘Šã€‚ä»¥ä¸‹ä»£ç åœ¨è¿‡å»ä¼šç»å¸¸æ‰§è¡Œå¤±è´¥ï¼Œä½†æ˜¯å½“å‰çš„ JavaScript å¼•æ“å¯ä»¥è¿›è¡Œè­¦å‘Šï¼š</p>
<pre><code>JavaScript ä»£ç :
async function foo() {
throw new Error(&apos;Problem!&apos;);
}
foo();
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/18/æ¢ç´¢webpack-æœºåˆ¶/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/18/æ¢ç´¢webpack-æœºåˆ¶/" itemprop="url">æ¢ç´¢webpack æœºåˆ¶</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-05-18T22:20:52+08:00">
                2018-05-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>æœ¬æ–‡ä»ç®€å•çš„ä¾‹å­å…¥æ‰‹ï¼Œä»æ‰“åŒ…æ–‡ä»¶å»åˆ†æä»¥ä¸‹ä¸‰ä¸ªé—®é¢˜ï¼šwebpackæ‰“åŒ…æ–‡ä»¶æ˜¯æ€æ ·çš„ï¼Ÿå¦‚ä½•åšåˆ°å…¼å®¹å„å¤§æ¨¡å—åŒ–æ–¹æ¡ˆçš„ï¼Ÿwebpack3å¸¦æ¥çš„æ–°ç‰¹æ€§åˆæ˜¯ä»€ä¹ˆï¼Ÿ</p>
<h2 id="ä¸€ä¸ªç®€å•çš„ä¾‹å­"><a href="#ä¸€ä¸ªç®€å•çš„ä¾‹å­" class="headerlink" title="ä¸€ä¸ªç®€å•çš„ä¾‹å­"></a>ä¸€ä¸ªç®€å•çš„ä¾‹å­</h2><p>webpacké…ç½®</p>
<pre><code>// webpack.config.js
module.exports = {
  entry: &apos;./src/index.js&apos;,
  output: {
    filename: &apos;bundle.js&apos;,
    path: path.resolve(__dirname, &apos;dist&apos;)
  },
};
</code></pre><p>ç®€å•çš„jsæ–‡ä»¶</p>
<pre><code>// src/index.js
 console.log(&apos;hello world&apos;);
</code></pre><p>webpackæ‰“åŒ…åçš„ä»£ç </p>
<pre><code>// dist/bundle.js
 /******/ (function(modules) { // webpackBootstrap
/******/     // The module cache
/******/     var installedModules = {};
/******/
/******/     // The require function
/******/     function __webpack_require__(moduleId) {
/******/
/******/         // Check if module is in cache
/******/         if(installedModules[moduleId]) {
/******/             return installedModules[moduleId].exports;
/******/         }
/******/         // Create a new module (and put it into the cache)
/******/         var module = installedModules[moduleId] = {
/******/             i: moduleId,
/******/             l: false,
/******/             exports: {}
/******/         };
/******/
/******/         // Execute the module function
/******/         modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/         // Flag the module as loaded
/******/         module.l = true;
/******/
/******/         // Return the exports of the module
/******/         return module.exports;
/******/     }
/******/
/******/
/******/     // expose the modules object (__webpack_modules__)
/******/     __webpack_require__.m = modules;
/******/
/******/     // expose the module cache
/******/     __webpack_require__.c = installedModules;
/******/
/******/     // define getter function for harmony exports
/******/     __webpack_require__.d = function(exports, name, getter) {
/******/         if(!__webpack_require__.o(exports, name)) {
/******/             Object.defineProperty(exports, name, {
/******/                 configurable: false,
/******/                 enumerable: true,
/******/                 get: getter
/******/             });
/******/         }
/******/     };
/******/
/******/     // getDefaultExport function for compatibility with non-harmony modules
/******/     __webpack_require__.n = function(module) {
/******/         var getter = module &amp;&amp; module.__esModule ?
/******/             function getDefault() { return module[&apos;default&apos;]; } :
/******/             function getModuleExports() { return module; };
/******/         __webpack_require__.d(getter, &apos;a&apos;, getter);
/******/         return getter;
/******/     };
/******/
/******/     // Object.prototype.hasOwnProperty.call
/******/     __webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/     // __webpack_public_path__
/******/     __webpack_require__.p = &quot;&quot;;
/******/
/******/     // Load entry module and return exports
/******/     return __webpack_require__(__webpack_require__.s = 0);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ (function(module, exports) {

console.log(&apos;hello world&apos;);


/***/ })
/******/ ]);
</code></pre><p>ä¸€çœ‹ä½ å°±ä¼šæƒ³ï¼Œæˆ‘å°±ä¸€è¡Œä»£ç ï¼Œä½ ç»™æˆ‘æ‰“åŒ…é‚£ä¹ˆå¤šï¼Ÿï¼Ÿï¼Ÿï¼ˆé»‘äººé—®å·ï¼‰</p>
<p>æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹è¿™éƒ¨åˆ†ä»£ç ï¼Œå…ˆç²¾ç®€ä¸€ä¸‹ï¼Œå…¶å®æ•´ä½“å°±æ˜¯ä¸€ä¸ªè‡ªæ‰§è¡Œå‡½æ•°ï¼Œç„¶åä¼ å…¥ä¸€ä¸ªæ¨¡å—æ•°ç»„</p>
<pre><code>(function(modules) { 
     //...
 })([function(module, exports) {
     //..
 }])
</code></pre><p>å¥½äº†ï¼Œä¼ å…¥æ¨¡å—æ•°ç»„åšäº†ä»€ä¹ˆ(å…¶å®æ³¨é‡Šéƒ½å¾ˆæ˜æ˜¾äº†ï¼Œæˆ‘åªæ˜¯å¤§æ¦‚ç¿»è¯‘ä¸€ä¸‹ï¼‰</p>
<pre><code>/******/ (function(modules) { // webpackBootstrap
/******/     // The module cache  ç¼“å­˜å·²ç»loadè¿‡çš„æ¨¡å—
/******/     var installedModules = {};
/******/
/******/     // The require function  å¼•ç”¨çš„å‡½æ•°
/******/     function __webpack_require__(moduleId) {
/******/
/******/         // Check if module is in cache å‡å¦‚åœ¨ç¼“å­˜é‡Œå°±ç›´æ¥è¿”å›
/******/         if(installedModules[moduleId]) {
/******/             return installedModules[moduleId].exports;
/******/         }
/******/         // Create a new module (and put it into the cache) æ„é€ ä¸€ä¸ªæ¨¡å—å¹¶æ”¾å…¥ç¼“å­˜
/******/         var module = installedModules[moduleId] = {
/******/             i: moduleId, //æ¨¡å—id
/******/             l: false, // æ˜¯å¦å·²ç»åŠ è½½å®Œæ¯•
/******/             exports: {} // å¯¹å¤–æš´éœ²çš„å†…å®¹
/******/         };
/******/
/******/         // Execute the module function ä¼ å…¥æ¨¡å—å‚æ•°ï¼Œå¹¶æ‰§è¡Œæ¨¡å—
/******/         modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/         // Flag the module as loaded æ ‡è®°æ¨¡å—å·²ç»åŠ è½½å®Œæ¯•
/******/         module.l = true;
/******/
/******/         // Return the exports of the module è¿”å›æ¨¡å—æš´éœ²çš„å†…å®¹
/******/         return module.exports;
/******/     }
/******/
/******/
/******/     // expose the modules object (__webpack_modules__) æš´éœ²æ¨¡å—æ•°ç»„
/******/     __webpack_require__.m = modules;
/******/
/******/     // expose the module cache æš´éœ²ç¼“å­˜æ•°ç»„
/******/     __webpack_require__.c = installedModules;
/******/
/******/     // define getter function for harmony exports ä¸ºES6 exportså®šä¹‰getter
/******/     __webpack_require__.d = function(exports, name, getter) {
/******/         if(!__webpack_require__.o(exports, name)) { // å‡å¦‚exportsæœ¬èº«ä¸å«æœ‰nameè¿™ä¸ªå±æ€§
/******/             Object.defineProperty(exports, name, {
/******/                 configurable: false,
/******/                 enumerable: true,
/******/                 get: getter
/******/             });
/******/         }
/******/     };
/******/
/******/     // getDefaultExport function for compatibility with non-harmony modules è§£å†³ES moduleå’ŒCommon js moduleçš„å†²çªï¼ŒESåˆ™è¿”å›module[&apos;default&apos;]
/******/     __webpack_require__.n = function(module) {
/******/         var getter = module &amp;&amp; module.__esModule ?
/******/             function getDefault() { return module[&apos;default&apos;]; } :
/******/             function getModuleExports() { return module; };
/******/         __webpack_require__.d(getter, &apos;a&apos;, getter);
/******/         return getter;
/******/     };
/******/
/******/     // Object.prototype.hasOwnProperty.call
/******/     __webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/     // __webpack_public_path__ webpacké…ç½®ä¸‹çš„å…¬å…±è·¯å¾„
/******/     __webpack_require__.p = &quot;&quot;;
/******/
/******/     // Load entry module and return exports æœ€åæ‰§è¡Œentryæ¨¡å—å¹¶ä¸”è¿”å›å®ƒçš„æš´éœ²å†…å®¹
/******/     return __webpack_require__(__webpack_require__.s = 0);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ (function(module, exports) {

console.log(&apos;hello world&apos;);


/***/ })
/******/ ]);
</code></pre><p>æ•´ä½“æµç¨‹æ˜¯æ€æ ·çš„å‘¢</p>
<ul>
<li>ä¼ å…¥moduleæ•°ç»„</li>
<li><p>è°ƒç”¨<strong>webpack_require</strong>(<strong>webpack_require</strong>.s = 0)</p>
</li>
<li><p>æ„é€ moduleå¯¹è±¡ï¼Œæ”¾å…¥ç¼“å­˜</p>
</li>
<li>è°ƒç”¨module,ä¼ å…¥ç›¸åº”å‚æ•°modules[moduleId].call(module.exports, module, module.exports, <strong>webpack_require</strong>); ï¼ˆè¿™é‡Œexportsä¼šè¢«å‡½æ•°å†…éƒ¨çš„ä¸œè¥¿ä¿®æ”¹ï¼‰</li>
<li>æ ‡è®°moduleå¯¹è±¡å·²ç»åŠ è½½å®Œæ¯•</li>
<li><p>è¿”å›æ¨¡å—æš´éœ²çš„å†…å®¹ï¼ˆæ³¨æ„åˆ°ä¸Šé¢å‡½æ•°ä¼ å…¥äº†module.exports,å¯ä»¥å¯¹å¼•ç”¨è¿›è¡Œä¿®æ”¹ï¼‰</p>
</li>
<li><p>æ¨¡å—å‡½æ•°ä¸­ä¼ å…¥module, module.exports, webpack_require</p>
</li>
<li>æ‰§è¡Œè¿‡ç¨‹ä¸­é€šè¿‡å¯¹ä¸Šé¢ä¸‰è€…çš„å¼•ç”¨ä¿®æ”¹ï¼Œå®Œæˆå˜é‡æš´éœ²å’Œå¼•ç”¨</li>
</ul>
<h2 id="webpackæ¨¡å—æœºåˆ¶æ˜¯æ€æ ·çš„"><a href="#webpackæ¨¡å—æœºåˆ¶æ˜¯æ€æ ·çš„" class="headerlink" title="webpackæ¨¡å—æœºåˆ¶æ˜¯æ€æ ·çš„"></a>webpackæ¨¡å—æœºåˆ¶æ˜¯æ€æ ·çš„</h2><p>æˆ‘ä»¬å¯ä»¥å»å®˜ç½‘çœ‹ä¸‹webpackæ¨¡å—</p>
<blockquote>
<p><a href="https://link.zhihu.com/?target=https%3A//doc.webpack-china.org/concepts/modules%23-webpack-" target="_blank" rel="noopener">https://doc.webpack-china.org/concepts/modules#-webpack-</a><br>webpack æ¨¡å—èƒ½å¤Ÿä»¥å„ç§æ–¹å¼è¡¨è¾¾å®ƒä»¬çš„ä¾èµ–å…³ç³»ï¼Œå‡ ä¸ªä¾‹å­å¦‚ä¸‹ï¼š</p>
</blockquote>
<ul>
<li>ES2015 import è¯­å¥</li>
<li>CommonJS require() è¯­å¥</li>
<li>AMD define å’Œ require è¯­å¥</li>
<li>css/sass/less æ–‡ä»¶ä¸­çš„ @import è¯­å¥ã€‚</li>
<li>æ ·å¼(url(â€¦))æˆ– HTML æ–‡ä»¶(<img src="...">)ä¸­çš„å›¾ç‰‡é“¾æ¥(image url)</li>
</ul>
<p>å¼ºå¤§çš„webpackæ¨¡å—å¯ä»¥å…¼å®¹å„ç§æ¨¡å—åŒ–æ–¹æ¡ˆï¼Œå¹¶ä¸”æ— ä¾µå…¥æ€§(non-opinionated)</p>
<p>æˆ‘ä»¬å¯ä»¥å†ç¼–å†™ä¾‹å­ä¸€æ¢ç©¶ç«Ÿ</p>
<h2 id="CommonJS"><a href="#CommonJS" class="headerlink" title="CommonJS"></a>CommonJS</h2><p>ä¿®æ”¹src/index.js</p>
<pre><code>var cj = require(&apos;./cj.js&apos;);

console.log(&apos;hello world&apos;);
cj();
</code></pre><p>æ–°å¢src/cj.jsï¼Œä¿æŒå‰é¢ä¾‹å­å…¶ä»–ä¸å˜</p>
<pre><code>// src/cj.js
function a() {
    console.log(&quot;CommonJS&quot;);
}
module.exports = a;
</code></pre><p>å†æ¬¡è¿è¡Œwebpack</p>
<pre><code>/******/ (function(modules) { // webpackBootstrap
  //... çœç•¥ä»£ç 
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ (function(module, exports, __webpack_require__) {

let cj = __webpack_require__(1);

console.log(&apos;hello world&apos;);
cj();


/***/ }),
/* 1 */
/***/ (function(module, exports) {

function a() {
    console.log(&quot;CommonJS&quot;);
}
module.exports = a;


/***/ })
/******/ ]);
</code></pre><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ¨¡å—æ•°ç»„å¤šäº†ä¸ªå¼•å…¥çš„æ–‡ä»¶ï¼Œç„¶åindex.jsæ¨¡å—å‡½æ•°å¤šäº†ä¸ªå‚æ•°<strong>webpack_require</strong>ï¼Œå»å¼•ç”¨æ–‡ä»¶ï¼ˆ<strong>webpack_require</strong>åœ¨ä¸Šä¸€èŠ‚æœ‰ä»‹ç»ï¼‰ï¼Œæ•´ä½“ä¸Šå°±æ˜¯ä¾èµ–çš„æ¨¡å—ä¿®æ”¹äº†module.exportsï¼Œç„¶åä¸»æ¨¡å—æ‰§è¡Œä¾èµ–æ¨¡å—ï¼Œè·å–exportså³å¯</p>
<h2 id="ES2015-import"><a href="#ES2015-import" class="headerlink" title="ES2015 import"></a>ES2015 import</h2><p>æ–°å¢src/es.js</p>
<pre><code>// src/es.js
export default function b() {
    console.log(&apos;ES Modules&apos;);
}
</code></pre><p>ä¿®æ”¹src/index.js</p>
<pre><code>// src/index.js
import es from &apos;./es.js&apos;;

console.log(&apos;hello world&apos;);
es();
</code></pre><p>webpack.config.jsä¸å˜ï¼Œæ‰§è¡Œwebpack</p>
<pre><code>/******/ (function(modules) { // webpackBootstrap
// ... çœç•¥ä»£ç 
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

&quot;use strict&quot;;
Object.defineProperty(__webpack_exports__, &quot;__esModule&quot;, { value: true });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__es_js__ = __webpack_require__(1);


console.log(&apos;hello world&apos;);
Object(__WEBPACK_IMPORTED_MODULE_0__es_js__[&quot;a&quot; /* default */])();


/***/ }),
/* 1 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

&quot;use strict&quot;;
/* harmony export (immutable) */ __webpack_exports__[&quot;a&quot;] = b;
function b() {
    console.log(&apos;ES Modules&apos;);
}


/***/ })
/******/ ]);
</code></pre><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒä»¬éƒ½å˜æˆäº†ä¸¥æ ¼æ¨¡å¼ï¼Œwebpackè‡ªåŠ¨é‡‡ç”¨çš„</p>
<p>è¡¨ç°å…¶å®è·ŸCommonJSç›¸ä¼¼ï¼Œä¹Ÿæ˜¯ä¼ å…¥exportç„¶åä¿®æ”¹ï¼Œåœ¨ä¸»æ¨¡å—å†requireè¿›æ¥ï¼Œ</p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ª</p>
<pre><code>Object.defineProperty(__webpack_exports__, &quot;__esModule&quot;, { value: true });
</code></pre><p>è¿™ä¸ªå¹²å˜›ç”¨çš„ï¼Ÿå…¶å®å°±æ˜¯æ ‡è®°å½“å‰çš„exportsæ˜¯esæ¨¡å—ï¼Œè¿˜è®°å¾—ä¹‹å‰çš„<strong>webpack_require</strong>.nå—ï¼Œæˆ‘ä»¬å†æ‹¿å‡ºæ¥çœ‹çœ‹</p>
<pre><code>/******/     // getDefaultExport function for compatibility with non-harmony modules è§£å†³ES moduleå’ŒCommon js moduleçš„å†²çªï¼ŒESåˆ™è¿”å›module[&apos;default&apos;]
/******/     __webpack_require__.n = function(module) {
/******/         var getter = module &amp;&amp; module.__esModule ?
/******/             function getDefault() { return module[&apos;default&apos;]; } :
/******/             function getModuleExports() { return module; };
/******/         __webpack_require__.d(getter, &apos;a&apos;, getter);
/******/         return getter;
/******/     };
</code></pre><p>ä¸ºäº†é¿å…è·ŸéES Moduleså†²çªï¼Ÿå†²çªåœ¨å“ªé‡Œå‘¢ï¼Ÿ<br>å…¶å®è¿™éƒ¨åˆ†å¦‚æœä½ çœ‹åˆ°babelè½¬æ¢ES Modulesæºç å°±çŸ¥é“äº†ï¼Œä¸ºäº†å…¼å®¹æ¨¡å—ï¼Œä¼šæŠŠES Modulesç›´æ¥æŒ‚åœ¨exports.defaultä¸Šï¼Œç„¶ååŠ ä¸Š__esModuleå±æ€§ï¼Œå¼•å…¥çš„æ—¶å€™åˆ¤æ–­ä¸€æ¬¡æ˜¯å¦æ˜¯è½¬æ¢æ¨¡å—ï¼Œæ˜¯åˆ™å¼•å…¥module[â€˜defaultâ€™]ï¼Œä¸æ˜¯åˆ™å¼•å…¥module</p>
<p>æˆ‘ä»¬å†å¤šå¼•å…¥å‡ ä¸ªES Modulesçœ‹çœ‹æ•ˆæœ</p>
<pre><code>// src/es.js
export function es() {
    console.log(&apos;ES Modules&apos;);
}

export function esTwo() {
    console.log(&apos;ES Modules Two&apos;);
}

export function esThree() {
    console.log(&apos;ES Modules Three&apos;);
}

export function esFour() {
    console.log(&apos;ES Modules Four&apos;);
}
</code></pre><p>æˆ‘ä»¬å¤šå¼•å…¥esTwoå’ŒesFourï¼Œä½†æ˜¯ä¸ä½¿ç”¨esFour</p>
<pre><code>// src/index.js
import { es, esTwo, esFour} from &apos;./es.js&apos;;

console.log(&apos;hello world&apos;);
es();
esTwo();
</code></pre><p>å¾—å‡º</p>
<pre><code>/******/ (function(modules) { // webpackBootstrap
// ...
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

&quot;use strict&quot;;
Object.defineProperty(__webpack_exports__, &quot;__esModule&quot;, { value: true });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__es_js__ = __webpack_require__(1);


console.log(&apos;hello world&apos;);
Object(__WEBPACK_IMPORTED_MODULE_0__es_js__[&quot;a&quot; /* es */])();
Object(__WEBPACK_IMPORTED_MODULE_0__es_js__[&quot;b&quot; /* esTwo */])();


/***/ }),
/* 1 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

&quot;use strict&quot;;
/* harmony export (immutable) */ __webpack_exports__[&quot;a&quot;] = es;
/* harmony export (immutable) */ __webpack_exports__[&quot;b&quot;] = esTwo;
/* unused harmony export esThree */
/* unused harmony export esFour */
function es() {
    console.log(&apos;ES Modules&apos;);
}

function esTwo() {
    console.log(&apos;ES Modules Two&apos;);
}

function esThree() {
    console.log(&apos;ES Modules Three&apos;);
}

function esFour() {
    console.log(&apos;ES Modules Four&apos;);
}



/***/ })
/******/ ]);
</code></pre><p>å—¯å—¯å…¶å®è·Ÿå‰é¢æ˜¯ä¸€æ ·çš„ï¼Œä¸¾å‡ºè¿™ä¸ªä¾‹å­é‡ç‚¹åœ¨å“ªé‡Œå‘¢ï¼Œæœ‰æ²¡æœ‰æ³¨æ„åˆ°æ³¨é‡Šä¸­</p>
<pre><code>/* unused harmony export esThree */
/* unused harmony export esFour */
</code></pre><p>esThreeæ˜¯æˆ‘ä»¬æ²¡æœ‰å¼•å…¥çš„æ¨¡å—ï¼ŒesFouræ˜¯æˆ‘ä»¬å¼•ç”¨ä½†æ˜¯æ²¡æœ‰ä½¿ç”¨çš„æ¨¡å—ï¼Œwebpackå‡å¯¹å®ƒä»¬åšäº†unusedçš„æ ‡è®°ï¼Œå…¶å®è¿™ä¸ªå¦‚æœä½ ä½¿ç”¨äº†webpackæ’ä»¶uglifyï¼Œé€šè¿‡æ ‡è®°ï¼Œå°±ä¼šæŠŠesThreeå’ŒesFourè¿™ä¸¤ä¸ªæœªä½¿ç”¨çš„ä»£ç æ¶ˆé™¤ï¼ˆå…¶å®å®ƒå°±æ˜¯tree-shaking)</p>
<h2 id="AMD"><a href="#AMD" class="headerlink" title="AMD"></a>AMD</h2><p>æˆ‘ä»¬å†æ¥çœ‹çœ‹webpackæ€ä¹ˆæ”¯æŒAMD</p>
<p>æ–°å¢src/amd.js</p>
<pre><code>// src/amd.js
define([
],function(){
    return {
        amd:function(){
            console.log(&apos;AMD&apos;);
        }
    };
});
</code></pre><p>ä¿®æ”¹index.js</p>
<pre><code>// src/index.js
define([
    &apos;./amd.js&apos;
],function(amdModule){
    amdModule.amd();
});
</code></pre><p>å¾—åˆ°</p>
<pre><code>/******/ (function(modules) { // webpackBootstrap
// ... çœç•¥ä»£ç 
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ (function(module, exports, __webpack_require__) {

var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [
    __webpack_require__(1)
], __WEBPACK_AMD_DEFINE_RESULT__ = function(amdModule){
    amdModule.amd();
}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),
                __WEBPACK_AMD_DEFINE_RESULT__ !== undefined &amp;&amp; (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));


/***/ }),
/* 1 */
/***/ (function(module, exports, __webpack_require__) {

var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [
], __WEBPACK_AMD_DEFINE_RESULT__ = function(){
    return {
        amd:function(){
            console.log(&apos;AMD&apos;);
        }
    };
}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),
                __WEBPACK_AMD_DEFINE_RESULT__ !== undefined &amp;&amp; (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));


/***/ })
/******/ ]);
</code></pre><p>å…ˆçœ‹amd.jsæ•´ç†ä¸€ä¸‹ä»£ç </p>
<pre><code>function(module, exports, __webpack_require__) {
    var __WEBPACK_AMD_DEFINE_ARRAY__,
        __WEBPACK_AMD_DEFINE_RESULT__;

    !(
        __WEBPACK_AMD_DEFINE_ARRAY__ = [],

        __WEBPACK_AMD_DEFINE_RESULT__ = function() {
            return {
                amd: function() {
                    console.log(&apos;AMD&apos;);
                }
            };
        }.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),

        __WEBPACK_AMD_DEFINE_RESULT__ !== undefined &amp;&amp;
        (module.exports = __WEBPACK_AMD_DEFINE_RESULT__)

    );
})
</code></pre><p>ç®€å•æ¥è®²æ”¶é›†define Arrayç„¶åç½®å…¥è¿”å›å‡½æ•°ï¼Œæ ¹æ®å‚æ•°è·å–ä¾èµ–</p>
<blockquote>
<p>applyå¯¹æ•°ç»„æ‹†è§£æˆä¸€ä¸ªä¸€ä¸ªå‚æ•°</p>
</blockquote>
<p>å†çœ‹index.jsæ¨¡å—éƒ¨åˆ†</p>
<pre><code>function(module, exports, __webpack_require__) {

    var __WEBPACK_AMD_DEFINE_ARRAY__,
        __WEBPACK_AMD_DEFINE_RESULT__;
    !(
        __WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(1)],
        __WEBPACK_AMD_DEFINE_RESULT__ = function(amdModule) {
                amdModule.amd();
        }.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),

        __WEBPACK_AMD_DEFINE_RESULT__ !== undefined &amp;&amp; 
        (module.exports = __WEBPACK_AMD_DEFINE_RESULT__)
    );
}
</code></pre><p>å…¶å®å°±æ˜¯å¼•å…¥äº†amd.jsæš´éœ²çš„{amd:[Function: amd]}</p>
<h2 id="css-image"><a href="#css-image" class="headerlink" title="css/image?"></a>css/image?</h2><p>csså’Œimageä¹Ÿå¯ä»¥æˆä¸ºwebpackçš„æ¨¡å—ï¼Œè¿™æ˜¯ä»¤äººéœ‡æƒŠçš„ï¼Œè¿™å°±ä¸èƒ½é€šè¿‡æ™®é€šçš„hack commonjsæˆ–è€…å‡½æ•°è°ƒç”¨ç®€å•å»è°ƒç”¨äº†ï¼Œè¿™å°±æ˜¯anything to JSï¼Œå®ƒå°±éœ€è¦å€ŸåŠ©webpack loaderå»å®ç°äº†</p>
<blockquote>
<p>åƒcsså°±æ˜¯è½¬æ¢æˆä¸€æ®µjsä»£ç ï¼Œé€šè¿‡å¤„ç†ï¼Œè°ƒç”¨æ—¶å°±æ˜¯å¯ä»¥ç”¨jså°†è¿™æ®µcssæ’å…¥åˆ°styleä¸­ï¼Œimageä¹Ÿç±»ä¼¼ï¼Œè¿™éƒ¨åˆ†å°±ä¸è¯¦ç»†é˜è¿°äº†ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥æ·±å…¥å»ç ”ç©¶</p>
</blockquote>
<h2 id="webpack3æ–°ç‰¹æ€§"><a href="#webpack3æ–°ç‰¹æ€§" class="headerlink" title="webpack3æ–°ç‰¹æ€§"></a>webpack3æ–°ç‰¹æ€§</h2><p>æˆ‘ä»¬å¯ä»¥å†é¡ºä¾¿çœ‹ä¸‹webpack3æ–°ç‰¹æ€§çš„è¡¨ç°<br>å…·ä½“å¯ä»¥çœ‹è¿™é‡Œ<a href="https://link.zhihu.com/?target=https%3A//medium.com/webpack/webpack-3-official-release-15fd2dd8f07b" target="_blank" rel="noopener">https://medium.com/webpack/webpack-3-official-release-15fd2dd8f07b</a></p>
<h2 id="Scope-Hoisting"><a href="#Scope-Hoisting" class="headerlink" title="Scope Hoisting"></a>Scope Hoisting</h2><p>æˆ‘ä»¬å¯ä»¥å‘ç°æ¨¡å—æ•°ç»„æ˜¯ä¸€ä¸ªä¸€ä¸ªç‹¬ç«‹çš„å‡½æ•°ç„¶åé—­åŒ…å¼•ç”¨webpackä¸»å‡½æ•°çš„ç›¸åº”å†…å®¹ï¼Œæ¯ä¸ªæ¨¡å—éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œç„¶åå¸¦æ¥çš„ç»“æœæ˜¯åœ¨æµè§ˆå™¨ä¸­æ‰§è¡Œé€Ÿåº¦å˜æ…¢ï¼Œç„¶åwebpack3å­¦ä¹ äº†Closure Compilerå’ŒRollupJSè¿™ä¸¤ä¸ªå·¥å…·ï¼Œè¿æ¥æ‰€æœ‰é—­åŒ…åˆ°ä¸€ä¸ªé—­åŒ…é‡Œï¼Œæ”¾å…¥ä¸€ä¸ªå‡½æ•°ï¼Œè®©æ‰§è¡Œé€Ÿåº¦æ›´å¿«,å¹¶ä¸”æ•´ä½“ä»£ç ä½“ç§¯ä¹Ÿä¼šæœ‰æ‰€ç¼©å°</p>
<p>æˆ‘ä»¬å¯ä»¥å®é™…çœ‹ä¸€ä¸‹æ•ˆæœï¼ˆè¦æ³¨æ„çš„æ˜¯è¿™ä¸ªç‰¹æ€§åªæ”¯æŒES Modules,æ˜¯ä¸æ”¯æŒCommonJså’ŒAMDçš„ï¼‰<br>ä½¿ç”¨ä¸Šé¢çš„ä¾‹å­ï¼Œé…ç½®webpack.config.jsï¼Œå¢åŠ new webpack.optimize.ModuleConcatenationPlugin()</p>
<pre><code>const path = require(&apos;path&apos;);
const webpack = require(&apos;webpack&apos;);

module.exports = {
  entry: &apos;./src/index.js&apos;,
  output: {
    filename: &apos;bundle.js&apos;,
    path: path.resolve(__dirname, &apos;dist&apos;)
  },
  module: {
  },
  plugins: [
    new webpack.optimize.ModuleConcatenationPlugin(),
  ]
};
</code></pre><p>æ‰“åŒ…</p>
<pre><code>/******/ (function(modules) { // webpackBootstrap
// ... çœç•¥ä»£ç 
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

&quot;use strict&quot;;
Object.defineProperty(__webpack_exports__, &quot;__esModule&quot;, { value: true });

// CONCATENATED MODULE: ./src/es.js
function es() {
    console.log(&apos;ES Modules&apos;);
}

function esTwo() {
    console.log(&apos;ES Modules Two&apos;);
}

function esThree() {
    console.log(&apos;ES Modules Three&apos;);
}

function esFour() {
    console.log(&apos;ES Modules Four&apos;);
}


// CONCATENATED MODULE: ./src/index.js
// src/index.js


console.log(&apos;hello world&apos;);
es();


/***/ })
/******/ ]);
</code></pre><p>æˆ‘ä»¬å¯ä»¥æƒŠå–œçš„å‘ç°æ²¡æœ‰ä»€ä¹ˆrequireäº†ï¼Œå®ƒä»¬æ‹¼æ¥æˆäº†ä¸€ä¸ªå‡½æ•°ï¼Œgood!?</p>
<h2 id="Magic-Comments"><a href="#Magic-Comments" class="headerlink" title="Magic Comments"></a>Magic Comments</h2><p>code splittingæ˜¯webpackä¸€ä¸ªé‡ç‚¹ç‰¹æ€§ä¹‹ä¸€ï¼Œæ¶‰åŠåˆ°è¦åŠ¨æ€å¼•å…¥çš„æ—¶å€™ï¼Œwebpackå¯ä»¥ä½¿ç”¨ require.ensureå»å®ç°ï¼Œåæ¥webpack2æ”¯æŒä½¿ç”¨äº†ç¬¦åˆ ECMAScript ææ¡ˆ çš„ import() è¯­æ³•ï¼Œä½†æ˜¯å®ƒæœ‰ä¸ªä¸è¶³ä¹‹å¤„ï¼Œæ— æ³•æŒ‡å®šchunkçš„åç§°chunkName,ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå‡ºç°äº†Magic Commentsï¼Œæ”¯æŒç”¨æ³¨é‡Šçš„æ–¹å¼å»æŒ‡å®šï¼Œå¦‚ä¸‹</p>
<pre><code>import(/* webpackChunkName: &quot;my-chunk-name&quot; */ &apos;module&apos;);
</code></pre><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>webpackæ˜¯ä¸€ä¸ªå¼ºå¤§çš„æ¨¡å—æ‰“åŒ…å·¥å…·ï¼Œåœ¨å¤„ç†ä¾èµ–ã€æ¨¡å—ä¸Šéƒ½å¾ˆä¼˜ç§€ï¼Œæœ¬æ–‡ä»bundle.jsæ–‡ä»¶åˆ†æå‡ºå‘å»æ¢ç´¢äº†ä¸åŒæ¨¡å—æ–¹æ¡ˆçš„åŠ è½½æœºåˆ¶ï¼Œåˆæ­¥å»ç†è§£webpackï¼Œå¹¶ä¸”å¯¹webpack3ç‰¹æ€§è¿›è¡Œé˜è¿°ï¼Œå½“ç„¶ï¼Œwebpackè¿˜æœ‰å¾ˆå¤šåœ°æ–¹éœ€è¦å»æ¢ç´¢æ·±ç©¶ï¼Œæ•¬è¯·æœŸå¾…ä»¥åçš„æ–‡ç« å§ï½</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/02/20ä¸ªCSSé«˜çº§æŠ€å·§æ±‡æ€»/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/02/20ä¸ªCSSé«˜çº§æŠ€å·§æ±‡æ€»/" itemprop="url">20ä¸ª CSSé«˜çº§æŠ€å·§æ±‡æ€»</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-05-02T16:24:04+08:00">
                2018-05-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ä½¿ç”¨æŠ€å·§ä¼šè®©äººå˜çš„è¶Šæ¥è¶Šæ‡’ï¼Œæ²¡é”™ï¼Œæˆ‘å°±æ˜¯æƒ³è®©ä½ å˜æ‡’ã€‚ä¸‹é¢æ˜¯æˆ‘æ”¶é›†çš„CSSé«˜çº§æŠ€å·§ï¼Œå¸Œæœ›ä½ æ‡’å‡ºå¢ƒç•Œã€‚</p>
<h2 id="1-é»‘ç™½å›¾åƒ"><a href="#1-é»‘ç™½å›¾åƒ" class="headerlink" title="1. é»‘ç™½å›¾åƒ"></a>1. é»‘ç™½å›¾åƒ</h2><p>è¿™æ®µä»£ç ä¼šè®©ä½ çš„å½©è‰²ç…§ç‰‡æ˜¾ç¤ºä¸ºé»‘ç™½ç…§ç‰‡ï¼Œæ˜¯ä¸æ˜¯å¾ˆé…·ï¼Ÿ</p>
<pre><code>img.desaturate {
 filter: grayscale(100%);
-webkit-filter: grayscale(100%);
-moz-filter: grayscale(100%);
-ms-filter: grayscale(100%);
-o-filter: grayscale(100%);
}
</code></pre><h2 id="2-ä½¿ç”¨-not-åœ¨èœå•ä¸Šåº”ç”¨-å–æ¶ˆåº”ç”¨è¾¹æ¡†"><a href="#2-ä½¿ç”¨-not-åœ¨èœå•ä¸Šåº”ç”¨-å–æ¶ˆåº”ç”¨è¾¹æ¡†" class="headerlink" title="2. ä½¿ç”¨ :not() åœ¨èœå•ä¸Šåº”ç”¨/å–æ¶ˆåº”ç”¨è¾¹æ¡†"></a>2. ä½¿ç”¨ <code>:not()</code> åœ¨èœå•ä¸Šåº”ç”¨/å–æ¶ˆåº”ç”¨è¾¹æ¡†</h2><p>å…ˆç»™æ¯ä¸€ä¸ªèœå•é¡¹æ·»åŠ è¾¹æ¡†</p>
<pre><code>/* add border */
.nav li {
 border-right: 1px solid #666;
}
</code></pre><p>ç„¶åå†é™¤å»æœ€åä¸€ä¸ªå…ƒç´ </p>
<pre><code>// remove border /

.nav li:last-child {
 border-right: none;
}
</code></pre><p>å¯ä»¥ç›´æ¥ä½¿ç”¨ :not() ä¼ªç±»æ¥åº”ç”¨å…ƒç´ ï¼š</p>
<pre><code>.nav li:not(:last-child) {
 border-right: 1px solid #666;
}
</code></pre><p>è¿™æ ·ä»£ç å°±å¹²å‡€ï¼Œæ˜“è¯»ï¼Œæ˜“äºç†è§£äº†ã€‚</p>
<p>å½“ç„¶ï¼Œå¦‚æœä½ çš„æ–°å…ƒç´ æœ‰å…„å¼Ÿå…ƒç´ çš„è¯ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨é€šç”¨çš„å…„å¼Ÿé€‰æ‹©ç¬¦ï¼ˆ~ï¼‰ï¼š</p>
<pre><code>.nav li:first-child ~ li {
 border-left: 1px solid #666;
}
</code></pre><h2 id="3-é¡µé¢é¡¶éƒ¨é˜´å½±"><a href="#3-é¡µé¢é¡¶éƒ¨é˜´å½±" class="headerlink" title="3. é¡µé¢é¡¶éƒ¨é˜´å½±"></a>3. é¡µé¢é¡¶éƒ¨é˜´å½±</h2><p>ä¸‹é¢è¿™ä¸ªç®€å•çš„ CSS3 ä»£ç ç‰‡æ®µå¯ä»¥ç»™ç½‘é¡µåŠ ä¸Šæ¼‚äº®çš„é¡¶éƒ¨é˜´å½±æ•ˆæœï¼š</p>
<pre><code>body:before {
 content: &quot;&quot;;
 position: fixed;
 top: -10px;
 left: 0;
 width: 100%;
 height: 10px;

-webkit-box-shadow: 0px 0px 10px rgba(0,0,0,.8);
-moz-box-shadow: 0px 0px 10px rgba(0,0,0,.8);
 box-shadow: 0px 0px 10px rgba(0,0,0,.8);

 z-index: 100;
}
</code></pre><h2 id="4-ç»™-body-æ·»åŠ è¡Œé«˜"><a href="#4-ç»™-body-æ·»åŠ è¡Œé«˜" class="headerlink" title="4. ç»™ body æ·»åŠ è¡Œé«˜"></a>4. ç»™ body æ·»åŠ è¡Œé«˜</h2><p>ä½ ä¸éœ€è¦åˆ†åˆ«æ·»åŠ  line-height åˆ°æ¯ä¸ªp,hæ ‡è®°ç­‰ã€‚åªè¦æ·»åŠ åˆ° body å³å¯ï¼š</p>
<pre><code>body {
 line-height: 1;
}
</code></pre><p>è¿™æ ·æ–‡æœ¬å…ƒç´ å°±å¯ä»¥å¾ˆå®¹æ˜“åœ°ä» body ç»§æ‰¿ã€‚</p>
<h2 id="5-æ‰€æœ‰ä¸€åˆ‡éƒ½å‚ç›´å±…ä¸­"><a href="#5-æ‰€æœ‰ä¸€åˆ‡éƒ½å‚ç›´å±…ä¸­" class="headerlink" title="5. æ‰€æœ‰ä¸€åˆ‡éƒ½å‚ç›´å±…ä¸­"></a>5. æ‰€æœ‰ä¸€åˆ‡éƒ½å‚ç›´å±…ä¸­</h2><p>è¦å°†æ‰€æœ‰å…ƒç´ å‚ç›´å±…ä¸­ï¼Œå¤ªç®€å•äº†ï¼š</p>
<pre><code>html, body {
 height: 100%;
 margin: 0;
}

body {
-webkit-align-items: center; 
-ms-flex-align: center; 
 align-items: center;
 display: -webkit-flex;
 display: flex;
}
</code></pre><p>çœ‹ï¼Œæ˜¯ä¸æ˜¯å¾ˆç®€å•ã€‚</p>
<p>æ³¨æ„ï¼šåœ¨IE11ä¸­è¦å°å¿ƒflexbox</p>
<h2 id="6-é€—å·åˆ†éš”çš„åˆ—è¡¨"><a href="#6-é€—å·åˆ†éš”çš„åˆ—è¡¨" class="headerlink" title="6. é€—å·åˆ†éš”çš„åˆ—è¡¨"></a>6. é€—å·åˆ†éš”çš„åˆ—è¡¨</h2><p>è®©HTMLåˆ—è¡¨é¡¹çœ‹ä¸Šå»åƒä¸€ä¸ªçœŸæ­£çš„ï¼Œç”¨é€—å·åˆ†éš”çš„åˆ—è¡¨ï¼š</p>
<pre><code>ul &gt; li:not(:last-child)::after {
 content: &quot;,&quot;;
}
</code></pre><p>å¯¹æœ€åä¸€ä¸ªåˆ—è¡¨é¡¹ä½¿ç”¨ :not() ä¼ªç±»ã€‚</p>
<h2 id="7-ä½¿ç”¨è´Ÿçš„-nth-child-é€‰æ‹©é¡¹ç›®"><a href="#7-ä½¿ç”¨è´Ÿçš„-nth-child-é€‰æ‹©é¡¹ç›®" class="headerlink" title="7. ä½¿ç”¨è´Ÿçš„ nth-child é€‰æ‹©é¡¹ç›®"></a>7. ä½¿ç”¨è´Ÿçš„ nth-child é€‰æ‹©é¡¹ç›®</h2><p>åœ¨CSSä¸­ä½¿ç”¨è´Ÿçš„ nth-child é€‰æ‹©é¡¹ç›®1åˆ°é¡¹ç›®nã€‚</p>
<pre><code>li {
 display: none;
}

/* select items 1 through 3 and display them */
li:nth-child(-n+3) {
 display: block;
}
</code></pre><h2 id="8-å¯¹å›¾æ ‡ä½¿ç”¨-SVG"><a href="#8-å¯¹å›¾æ ‡ä½¿ç”¨-SVG" class="headerlink" title="8. å¯¹å›¾æ ‡ä½¿ç”¨ SVG"></a>8. å¯¹å›¾æ ‡ä½¿ç”¨ SVG</h2><p>æˆ‘ä»¬æ²¡æœ‰ç†ç”±ä¸å¯¹å›¾æ ‡ä½¿ç”¨SVGï¼š</p>
<pre><code>.logo {
 background: url(&quot;logo.svg&quot;);
}
</code></pre><p>SVGå¯¹æ‰€æœ‰çš„åˆ†è¾¨ç‡ç±»å‹éƒ½å…·æœ‰è‰¯å¥½çš„æ‰©å±•æ€§ï¼Œå¹¶æ”¯æŒæ‰€æœ‰æµè§ˆå™¨éƒ½å›å½’åˆ°IE9ã€‚è¿™æ ·å¯ä»¥é¿å¼€.pngã€.jpgæˆ–.gifæ–‡ä»¶äº†ã€‚</p>
<h2 id="9-ä¼˜åŒ–æ˜¾ç¤ºæ–‡æœ¬"><a href="#9-ä¼˜åŒ–æ˜¾ç¤ºæ–‡æœ¬" class="headerlink" title="9. ä¼˜åŒ–æ˜¾ç¤ºæ–‡æœ¬"></a>9. ä¼˜åŒ–æ˜¾ç¤ºæ–‡æœ¬</h2><p>æœ‰æ—¶ï¼Œå­—ä½“å¹¶ä¸èƒ½åœ¨æ‰€æœ‰è®¾å¤‡ä¸Šéƒ½è¾¾åˆ°æœ€ä½³çš„æ˜¾ç¤ºï¼Œæ‰€ä»¥å¯ä»¥è®©è®¾å¤‡æµè§ˆå™¨æ¥å¸®åŠ©ä½ ï¼š</p>
<pre><code>html {
-moz-osx-font-smoothing: grayscale;
-webkit-font-smoothing: antialiased;
 text-rendering: optimizeLegibility;
}
</code></pre><p>æ³¨ï¼šè¯·è´Ÿè´£ä»»åœ°ä½¿ç”¨ optimizeLegibilityã€‚æ­¤å¤–ï¼ŒIE /Edgeæ²¡æœ‰ text-rendering æ”¯æŒã€‚</p>
<h2 id="10-å¯¹çº¯-CSS-æ»‘å—ä½¿ç”¨-max-height"><a href="#10-å¯¹çº¯-CSS-æ»‘å—ä½¿ç”¨-max-height" class="headerlink" title="10. å¯¹çº¯ CSS æ»‘å—ä½¿ç”¨ max-height"></a>10. å¯¹çº¯ CSS æ»‘å—ä½¿ç”¨ max-height</h2><p>ä½¿ç”¨ max-height å’Œæº¢å‡ºéšè—æ¥å®ç°åªæœ‰CSSçš„æ»‘å—ï¼š</p>
<pre><code>.slider ul {
 max-height: 0;
 overlow: hidden;
}

.slider:hover ul {
 max-height: 1000px;
 transition: .3s ease;
}
</code></pre><h2 id="11-ç»§æ‰¿-box-sizing"><a href="#11-ç»§æ‰¿-box-sizing" class="headerlink" title="11. ç»§æ‰¿ box-sizing"></a>11. ç»§æ‰¿ box-sizing</h2><p>è®© box-sizing ç»§æ‰¿ htmlï¼š</p>
<pre><code>html {
 box-sizing: border-box;
}

*, *:before, *:after {
 box-sizing: inherit;
}
</code></pre><p>è¿™æ ·åœ¨æ’ä»¶æˆ–æ æ†å…¶ä»–è¡Œä¸ºçš„å…¶ä»–ç»„ä»¶ä¸­å°±èƒ½æ›´å®¹æ˜“åœ°æ”¹å˜ box-sizing äº†ã€‚</p>
<h2 id="12-è¡¨æ ¼å•å…ƒæ ¼ç­‰å®½"><a href="#12-è¡¨æ ¼å•å…ƒæ ¼ç­‰å®½" class="headerlink" title="12. è¡¨æ ¼å•å…ƒæ ¼ç­‰å®½"></a>12. è¡¨æ ¼å•å…ƒæ ¼ç­‰å®½</h2><p>è¡¨æ ¼å·¥ä½œèµ·æ¥å¾ˆéº»çƒ¦ï¼Œæ‰€ä»¥åŠ¡å¿…å°½é‡ä½¿ç”¨ table-layout: fixed æ¥ä¿æŒå•å…ƒæ ¼çš„ç­‰å®½ï¼š</p>
<pre><code>.calendar {
 table-layout: fixed;
}
</code></pre><h2 id="13-ç”¨-Flexbox-æ‘†è„±å¤–è¾¹è·çš„å„ç§-hack"><a href="#13-ç”¨-Flexbox-æ‘†è„±å¤–è¾¹è·çš„å„ç§-hack" class="headerlink" title="13. ç”¨ Flexbox æ‘†è„±å¤–è¾¹è·çš„å„ç§ hack"></a>13. ç”¨ Flexbox æ‘†è„±å¤–è¾¹è·çš„å„ç§ hack</h2><p>å½“éœ€è¦ç”¨åˆ°åˆ—åˆ†éš”ç¬¦æ—¶ï¼Œé€šè¿‡flexboxçš„ space-between å±æ€§ï¼Œä½ å°±å¯ä»¥æ‘†è„±nth-ï¼Œfirst-ï¼Œå’Œ last-child çš„hackäº†ï¼š</p>
<pre><code>.list {
 display: flex;
 justify-content: space-between;
}

.list .person {
 flex-basis: 23%;
}
</code></pre><p>ç°åœ¨ï¼Œåˆ—è¡¨åˆ†éš”ç¬¦å°±ä¼šåœ¨å‡åŒ€é—´éš”çš„ä½ç½®å‡ºç°ã€‚</p>
<h2 id="14-ä½¿ç”¨å±æ€§é€‰æ‹©å™¨ç”¨äºç©ºé“¾æ¥"><a href="#14-ä½¿ç”¨å±æ€§é€‰æ‹©å™¨ç”¨äºç©ºé“¾æ¥" class="headerlink" title="14. ä½¿ç”¨å±æ€§é€‰æ‹©å™¨ç”¨äºç©ºé“¾æ¥"></a>14. ä½¿ç”¨å±æ€§é€‰æ‹©å™¨ç”¨äºç©ºé“¾æ¥</h2><p>å½“aå…ƒç´ æ²¡æœ‰æ–‡æœ¬å€¼ï¼Œä½† href å±æ€§æœ‰é“¾æ¥çš„æ—¶å€™æ˜¾ç¤ºé“¾æ¥ï¼š</p>
<pre><code>a[href^=&quot;http&quot;]:empty::before {
 content: attr(href);
}
</code></pre><p>ç›¸å½“æ–¹ä¾¿ã€‚</p>
<h2 id="15-æ£€æµ‹é¼ æ ‡åŒå‡»"><a href="#15-æ£€æµ‹é¼ æ ‡åŒå‡»" class="headerlink" title="15. æ£€æµ‹é¼ æ ‡åŒå‡»"></a>15. æ£€æµ‹é¼ æ ‡åŒå‡»</h2><p>HTMLï¼š</p>
<pre><code>&lt;div class=&quot;test3&quot;&gt;
&lt;span&gt;&lt;input type=&quot;text&quot; value=&quot; &quot; readonly=&quot;true&quot; /&gt;
&lt;a href=&quot;http://renpingjun.com&quot;&gt;Double click me&lt;/a&gt;&lt;/span&gt;
&lt;/div&gt;
</code></pre><p>CSSï¼š</p>
<pre><code>.test3 span {
 position: relative;
}
.test3 span a {
 position: relative;
 z-index: 2;
}
.test3 span a:hover, .test3 span a:active {
 z-index: 4;
}
.test3 span input {
 background: transparent;
 border: 0;
 cursor: pointer;
 position: absolute;
 top: -1px;
 left: 0;
 width: 101%; /* Hacky */
 height: 301%; /* Hacky */
 z-index: 3;
}
.test3 span input:focus {
 background: transparent;
 border: 0;
 z-index: 1;
}
</code></pre><h2 id="16-CSS-å†™å‡ºä¸‰è§’å½¢"><a href="#16-CSS-å†™å‡ºä¸‰è§’å½¢" class="headerlink" title="16. CSS å†™å‡ºä¸‰è§’å½¢"></a>16. CSS å†™å‡ºä¸‰è§’å½¢</h2><pre><code>/* create an arrow that points up */
div.arrow-up {
 width:0px;
 height:0px;
 border-left:5px solid transparent; /* left arrow slant */
 border-right:5px solid transparent; /* right arrow slant */
 border-bottom:5px solid #2f2f2f; /* bottom, add background color here */
 font-size:0px;
 line-height:0px;
}

/* create an arrow that points down */
div.arrow-down {
 width:0px;
 height:0px;
 border-left:5px solid transparent;
 border-right:5px solid transparent;
 border-top:5px solid #2f2f2f;
 font-size:0px;
 line-height:0px;
}

/* create an arrow that points left */
div.arrow-left {
 width:0px;
 height:0px;
 border-bottom:5px solid transparent; /* left arrow slant */
 border-top:5px solid transparent; /* right arrow slant */
 border-right:5px solid #2f2f2f; /* bottom, add background color here */
 font-size:0px;
 line-height:0px;
}

/* create an arrow that points right */
div.arrow-right {
 width:0px;
 height:0px;
 border-bottom:5px solid transparent; /* left arrow slant */
 border-top:5px solid transparent; /* right arrow slant */
 border-left:5px solid #2f2f2f; /* bottom, add background color here */
 font-size:0px;
 line-height:0px;
}
</code></pre><h2 id="17-CSS3-calc-çš„ä½¿ç”¨"><a href="#17-CSS3-calc-çš„ä½¿ç”¨" class="headerlink" title="17. CSS3 calc() çš„ä½¿ç”¨"></a>17. CSS3 calc() çš„ä½¿ç”¨</h2><p>calc() ç”¨æ³•ç±»ä¼¼äºå‡½æ•°ï¼Œèƒ½å¤Ÿç»™å…ƒç´ è®¾ç½®åŠ¨æ€çš„å€¼ï¼š</p>
<pre><code>/* basic calc */
.simpleBlock {
 width: calc(100% - 100px);
}

/* calc in calc */
.complexBlock {
 width: calc(100% - 50% / 3);
 padding: 5px calc(3% - 2px);
 margin-left: calc(10% + 10px);
}
</code></pre><h2 id="18-æ–‡æœ¬æ¸å˜"><a href="#18-æ–‡æœ¬æ¸å˜" class="headerlink" title="18. æ–‡æœ¬æ¸å˜"></a>18. æ–‡æœ¬æ¸å˜</h2><p>æ–‡æœ¬æ¸å˜æ•ˆæœå¾ˆæµè¡Œï¼Œä½¿ç”¨ CSS3 èƒ½å¤Ÿå¾ˆç®€å•å°±å®ç°ï¼š</p>
<pre><code>h2[data-text] {
 position: relative;
}
h2[data-text]::after {
 content: attr(data-text);
 z-index: 10;
 color: #e3e3e3;
 position: absolute;
 top: 0;
 left: 0;
-webkit-mask-image: -webkit-gradient(linear, left top, left bottom, from(rgba(0,0,0,0)), color-stop(50%, rgba(0,0,0,1)), to(rgba(0,0,0,0)));}
</code></pre><h2 id="19-ç¦ç”¨é¼ æ ‡äº‹ä»¶"><a href="#19-ç¦ç”¨é¼ æ ‡äº‹ä»¶" class="headerlink" title="19. ç¦ç”¨é¼ æ ‡äº‹ä»¶"></a>19. ç¦ç”¨é¼ æ ‡äº‹ä»¶</h2><p>CSS3 æ–°å¢çš„ pointer-events è®©ä½ èƒ½å¤Ÿç¦ç”¨å…ƒç´ çš„é¼ æ ‡äº‹ä»¶ï¼Œä¾‹å¦‚ï¼Œä¸€ä¸ªè¿æ¥å¦‚æœè®¾ç½®äº†ä¸‹é¢çš„æ ·å¼å°±æ— æ³•ç‚¹å‡»äº†ã€‚</p>
<pre><code>.disabled { pointer-events: none; }
</code></pre><h2 id="20-æ¨¡ç³Šæ–‡æœ¬"><a href="#20-æ¨¡ç³Šæ–‡æœ¬" class="headerlink" title="20. æ¨¡ç³Šæ–‡æœ¬"></a>20. æ¨¡ç³Šæ–‡æœ¬</h2><p>ç®€å•ä½†å¾ˆæ¼‚äº®çš„æ–‡æœ¬æ¨¡ç³Šæ•ˆæœï¼Œç®€å•åˆå¥½çœ‹ï¼</p>
<pre><code>.blur {
  color: transparent;
  text-shadow: 0 0 5px rgba(0,0,0,0.5);
}
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/02/Vueæºç å¿…çŸ¥å¿…ä¼š/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/02/Vueæºç å¿…çŸ¥å¿…ä¼š/" itemprop="url">Vueæºç å¿…çŸ¥å¿…ä¼š</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-05-02T16:24:04+08:00">
                2018-05-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>Vue.jsæºç åˆ†æï¼Œè®°å½•äº†ä¸ªäººå­¦ä¹ Vue.jsæºç çš„è¿‡ç¨‹ä¸­çš„ä¸€äº›å¿ƒå¾—ä»¥åŠæ”¶è·ã€‚ä»¥åŠå¯¹äºVueæ¡†æ¶ï¼Œå‘¨è¾¹åº“çš„ä¸€äº›å­¦ä¹ å¿ƒå¾—å’Œä¸ªäººè§è§£ã€‚</p>
<p>åœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­æˆ‘åˆ†åˆ«ä¸ºVue.jsã€Vuexã€Vue-routeråŠ ä¸Šäº†æ³¨é‡Šï¼Œåˆ†åˆ«åœ¨æ–‡ä»¶å¤¹<a href="https://link.zhihu.com/?target=https%3A//github.com/answershuto/learnVue/blob/master/vue-src" target="_blank" rel="noopener">vue-src</a>ã€<a href="https://link.zhihu.com/?target=https%3A//github.com/answershuto/learnVue/blob/master/vuex-src" target="_blank" rel="noopener">vuex-src</a>ä»¥åŠ<a href="https://link.zhihu.com/?target=https%3A//github.com/answershuto/learnVue/blob/master/vue-router-src" target="_blank" rel="noopener">vue-router-src</a>ä¸­ï¼Œå¸Œæœ›å¯ä»¥å¸®åŠ©æœ‰éœ€è¦çš„åŒå­¦æ›´å¥½åœ°å­¦ä¹ ç†è§£Vue.jsåŠå‘¨è¾¹åº“çš„æºç ã€‚</p>
<p>æ„Ÿè°¢å°¤å¤§æé«˜ç”Ÿäº§åŠ›ã€‚</p>
<p>å½“å‰Vue.jsæºç ç‰ˆæœ¬2.3.0ï¼ŒVuexç‰ˆæœ¬ä¸º2.4.0ï¼ŒVue-routerç‰ˆæœ¬ä¸º3.0.1ã€‚</p>
<p>æœ¬é¡¹ç›®å¸Œæœ›å¯¹Vue.jsåšæ›´è¿›ä¸€æ­¥çš„æ¢ç´¢ä¸å­¦ä¹ ï¼ŒVue.jsåŸºç¡€å†…å®¹è¯·å‚è€ƒVue.jså®˜ç½‘ï¼Œ<a href="https://link.zhihu.com/?target=https%3A//cn.vuejs.org/v2/guide/" target="_blank" rel="noopener">https://cn.vuejs.org/v2/guide/</a>ã€‚ å¯èƒ½ä¼šæœ‰ç†è§£å­˜åœ¨åå·®çš„åœ°æ–¹ï¼Œæ¬¢è¿æissueæŒ‡å‡ºï¼Œå…±åŒå­¦ä¹ ï¼Œå…±åŒè¿›æ­¥ã€‚</p>
<h2 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h2><h2 id="æºç ç›¸å…³"><a href="#æºç ç›¸å…³" class="headerlink" title="æºç ç›¸å…³"></a>æºç ç›¸å…³</h2><p><a href="https://link.zhihu.com/?target=https%3A//github.com/answershuto/learnVue/blob/master/docs/%25E5%2593%258D%25E5%25BA%2594%25E5%25BC%258F%25E5%258E%259F%25E7%2590%2586.MarkDown" target="_blank" rel="noopener">Vue.jså“åº”å¼åŸç†</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/answershuto/learnVue/blob/master/docs/%25E4%25BE%259D%25E8%25B5%2596%25E6%2594%25B6%25E9%259B%2586.MarkDown" target="_blank" rel="noopener">Vue.jsä¾èµ–æ”¶é›†</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/answershuto/learnVue/blob/master/docs/%25E4%25BB%258E%25E6%25BA%2590%25E7%25A0%2581%25E8%25A7%2592%25E5%25BA%25A6%25E5%2586%258D%25E7%259C%258B%25E6%2595%25B0%25E6%258D%25AE%25E7%25BB%2591%25E5%25AE%259A.MarkDown" target="_blank" rel="noopener">ä»Vue.jsæºç è§’åº¦å†çœ‹æ•°æ®ç»‘å®š</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/answershuto/learnVue/blob/master/docs/Vue%25E4%25BA%258B%25E4%25BB%25B6%25E6%259C%25BA%25E5%2588%25B6.MarkDown" target="_blank" rel="noopener">Vue.jsäº‹ä»¶æœºåˆ¶</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/answershuto/learnVue/blob/master/docs/VNode%25E8%258A%2582%25E7%2582%25B9.MarkDown" target="_blank" rel="noopener">VNodeèŠ‚ç‚¹(Vue.jså®ç°)</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/answershuto/learnVue/blob/master/docs/VirtualDOM%25E4%25B8%258Ediff%28Vue%25E5%25AE%259E%25E7%258E%25B0%29.MarkDown" target="_blank" rel="noopener">Virtual DOMä¸diff(Vue.jså®ç°)</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/answershuto/learnVue/blob/master/docs/%25E8%2581%258A%25E8%2581%258AVue%25E7%259A%2584template%25E7%25BC%2596%25E8%25AF%2591.MarkDown" target="_blank" rel="noopener">èŠèŠVue.jsçš„templateç¼–è¯‘</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/answershuto/learnVue/blob/master/docs/Vue.js%25E5%25BC%2582%25E6%25AD%25A5%25E6%259B%25B4%25E6%2596%25B0DOM%25E7%25AD%2596%25E7%2595%25A5%25E5%258F%258AnextTick.MarkDown" target="_blank" rel="noopener">Vue.jså¼‚æ­¥æ›´æ–°DOMç­–ç•¥åŠnextTick</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/answershuto/learnVue/blob/master/docs/%25E4%25BB%258Etemplate%25E5%2588%25B0DOM%28Vue.js%25E6%25BA%2590%25E7%25A0%2581%25E8%25A7%2592%25E5%25BA%25A6%25E7%259C%258B%25E5%2586%2585%25E9%2583%25A8%25E8%25BF%2590%25E8%25A1%258C%25E6%259C%25BA%25E5%2588%25B6%29.MarkDown" target="_blank" rel="noopener">ä»templateåˆ°DOMï¼ˆVue.jsæºç è§’åº¦çœ‹å†…éƒ¨è¿è¡Œæœºåˆ¶ï¼‰</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/answershuto/learnVue/blob/master/docs/Vuex%25E6%25BA%2590%25E7%25A0%2581%25E8%25A7%25A3%25E6%259E%2590.MarkDown" target="_blank" rel="noopener">Vuexæºç è§£æ</a></p>
<h2 id="éšç¬”æ‚è°ˆ"><a href="#éšç¬”æ‚è°ˆ" class="headerlink" title="éšç¬”æ‚è°ˆ"></a>éšç¬”æ‚è°ˆ</h2><p><a href="https://link.zhihu.com/?target=https%3A//github.com/answershuto/learnVue/blob/master/docs/Vue%25E7%25BB%2584%25E4%25BB%25B6%25E9%2597%25B4%25E9%2580%259A%25E4%25BF%25A1.MarkDown" target="_blank" rel="noopener">Vueç»„ä»¶é—´é€šä¿¡</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/answershuto/learnVue/blob/master/docs/%25E8%25AF%25B4%25E8%25AF%25B4element%25E7%25BB%2584%25E4%25BB%25B6%25E5%25BA%2593broadcast%25E4%25B8%258Edispatch.MarkDown" target="_blank" rel="noopener">è¯´è¯´elementç»„ä»¶åº“broadcastä¸dispatch</a></p>
<p>è¯¥æºç åˆ†æï¼Œä¼šå¸¦ç€å¤§å®¶ä¸€èµ·å­¦ä¹ <code>Vue</code>çš„å¤§éƒ¨åˆ†ä»£ç ï¼Œè€Œä¸æ˜¯ç®€å•çš„è®²ä¸€ä¸‹å®ƒçš„åŸç†ï¼Œæˆ‘ä¼šå°½å¯èƒ½çš„å¤šè§£é‡Šæ¯ä¸€è¡Œä¸»è¦çš„ä»£ç å«ä¹‰ï¼Œå¦å¤–ä¸€äº›è¾…åŠ©æ–¹æ³•ä»€ä¹ˆçš„ï¼Œå¤§å®¶å¯ä»¥åœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­ï¼Œè‡ªå·±çœ‹ä¸€çœ¼å°±çŸ¥é“äº†ã€‚</p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/Vue%25E6%25BA%2590%25E7%25A0%2581%25E7%259B%25AE%25E5%25BD%2595%25E7%25BB%2593%25E6%259E%2584%25E6%2595%25B4%25E7%2590%2586.md" target="_blank" rel="noopener">Vueæºç ç›®å½•ç»“æ„æ•´ç†</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/%25E4%25BB%258E%25E5%2585%25A5%25E5%258F%25A3%25E6%2596%2587%25E4%25BB%25B6%25E6%259F%25A5%25E7%259C%258BVue%25E6%25BA%2590%25E7%25A0%2581.md" target="_blank" rel="noopener">ä»å…¥å£æ–‡ä»¶æŸ¥çœ‹Vueæºç </a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/%25E4%25BB%258E%25E4%25B8%2580%25E4%25B8%25AA%25E5%25B0%258F%25E6%25A0%2597%25E5%25AD%2590%25E6%259F%25A5%25E7%259C%258BVue%25E7%259A%2584%25E7%2594%259F%25E5%2591%25BD%25E5%2591%25A8%25E6%259C%259F.md" target="_blank" rel="noopener">ä»å°æ —å­æŸ¥çœ‹Vueçš„ç”Ÿå‘½å‘¨æœŸ</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/%25E5%258F%258C%25E5%2590%2591%25E6%2595%25B0%25E6%258D%25AE%25E7%25BB%2591%25E5%25AE%259A.md" target="_blank" rel="noopener">åŒå‘æ•°æ®ç»‘å®š</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/compile%25E6%25A6%2582%25E8%25BF%25B0.md" target="_blank" rel="noopener">compileæ¦‚è¿°</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/compile%25E2%2580%2594%25E2%2580%2594%25E7%2594%259F%25E6%2588%2590ast.md" target="_blank" rel="noopener">compileâ€”â€”ç”Ÿæˆast</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/compile%25E2%2580%2594%25E2%2580%2594%25E4%25BC%2598%25E5%258C%2596%25E9%259D%2599%25E6%2580%2581%25E5%2586%2585%25E5%25AE%25B9.md" target="_blank" rel="noopener">compileâ€”â€”ä¼˜åŒ–é™æ€å†…å®¹</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/compile%25E2%2580%2594%25E2%2580%2594%25E7%2594%259F%25E6%2588%2590render%25E5%25AD%2597%25E7%25AC%25A6%25E4%25B8%25B2.md" target="_blank" rel="noopener">compileâ€”â€”ç”Ÿæˆrenderå­—ç¬¦ä¸²</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/vdom%25E6%25A6%2582%25E8%25BF%25B0.md" target="_blank" rel="noopener">vdomæ¦‚è¿°</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/Vue.extend.md" target="_blank" rel="noopener">Vue.extend</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/vdom%25E2%2580%2594%25E2%2580%2594VNode.md" target="_blank" rel="noopener">vdomâ€”â€”VNode</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/children%25E7%259A%2584%25E5%25BD%2592%25E4%25B8%2580%25E5%258C%2596%25E5%25A4%2584%25E7%2590%2586.md" target="_blank" rel="noopener">childrençš„å½’ä¸€åŒ–å¤„ç†</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/patch%25E2%2580%2594%25E2%2580%2594%25E5%2588%259B%25E5%25BB%25BAdom.md" target="_blank" rel="noopener">patchâ€”â€”åˆ›å»ºdom</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/patch%25E2%2580%2594%25E2%2580%2594diff.md" target="_blank" rel="noopener">patchâ€”â€”diff</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/patch%25E2%2580%2594%25E2%2580%2594%25E8%2587%25AA%25E5%25AE%259A%25E4%25B9%2589%25E7%25BB%2584%25E4%25BB%25B6%25E7%259A%2584%25E5%25A4%2584%25E7%2590%2586%25E6%25B5%2581%25E7%25A8%258B.md" target="_blank" rel="noopener">patchâ€”â€”è‡ªå®šä¹‰ç»„ä»¶çš„å¤„ç†æµç¨‹</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/%25E4%25BA%258B%25E4%25BB%25B6%25E5%25A4%2584%25E7%2590%2586.md" target="_blank" rel="noopener">äº‹ä»¶å¤„ç†</a></p>
<p>æŒ‡ä»¤çš„å¤„ç†</p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/directives%25E6%25A6%2582%25E8%25BF%25B0.md" target="_blank" rel="noopener">directivesæ¦‚è¿°</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/%25E8%2587%25AA%25E5%25AE%259A%25E4%25B9%2589%25E6%258C%2587%25E4%25BB%25A4.md" target="_blank" rel="noopener">è‡ªå®šä¹‰æŒ‡ä»¤</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/v-for.md" target="_blank" rel="noopener">v-for</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/v-if.md" target="_blank" rel="noopener">v-if</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/v-once.md" target="_blank" rel="noopener">v-once</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/v-show.md" target="_blank" rel="noopener">v-show</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/v-text%25E3%2580%2581v-html%25E3%2580%2581v-cloak%25E3%2580%2581v-pre.md" target="_blank" rel="noopener">v-textã€v-htmlã€v-cloakã€v-pre</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/v-model.md" target="_blank" rel="noopener">v-model</a></p>
<p>å†…ç½®ç»„ä»¶å’Œæ ‡ç­¾</p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/slot%25E5%2592%258C%25E4%25BD%259C%25E7%2594%25A8%25E5%259F%259F%25E6%258F%2592%25E6%25A7%25BD.md" target="_blank" rel="noopener">slotå’Œä½œç”¨åŸŸæ’æ§½</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/keep-alive.md" target="_blank" rel="noopener">keep-alive</a></p>
<p>ä»¥ä¸‹æ˜¯æ•´ç†ä¸€äº›æ¯”è¾ƒé›¶æ•£çš„æ•°æ®ï¼Œä¸»è¦æ˜¯è®°å½•ç»“æ„ä¸­æ¯ä¸ªæ•°æ®è¡¨ç¤ºä»€ä¹ˆæ„æ€ï¼Œä¼šä¸æ–­å®Œå–„æ›´æ–°ï¼š</p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/Vue-globals.md" target="_blank" rel="noopener">Vueå…¨å±€å±æ€§</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/Vue%25E5%25AE%259E%25E4%25BE%258B%25E5%25B1%259E%25E6%2580%25A7.md" target="_blank" rel="noopener">Vueå®ä¾‹å±æ€§</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/AstElement.md" target="_blank" rel="noopener">AstElement</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/VNode.md" target="_blank" rel="noopener">VNode</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/22/å‰ç«¯å¸¸è§è·¨åŸŸè§£å†³æ–¹æ¡ˆ/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/22/å‰ç«¯å¸¸è§è·¨åŸŸè§£å†³æ–¹æ¡ˆ/" itemprop="url">å‰ç«¯å¸¸è§è·¨åŸŸè§£å†³æ–¹æ¡ˆ</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-04-22T22:23:15+08:00">
                2018-04-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="ä»€ä¹ˆæ˜¯è·¨åŸŸï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯è·¨åŸŸï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯è·¨åŸŸï¼Ÿ"></a>ä»€ä¹ˆæ˜¯è·¨åŸŸï¼Ÿ</h2><p>è·¨åŸŸæ˜¯æŒ‡ä¸€ä¸ªåŸŸä¸‹çš„æ–‡æ¡£æˆ–è„šæœ¬è¯•å›¾å»è¯·æ±‚å¦ä¸€ä¸ªåŸŸä¸‹çš„èµ„æºï¼Œè¿™é‡Œè·¨åŸŸæ˜¯å¹¿ä¹‰çš„ã€‚</p>
<p>å¹¿ä¹‰çš„è·¨åŸŸï¼š</p>
<pre><code>1.) èµ„æºè·³è½¬ï¼š Aé“¾æ¥ã€é‡å®šå‘ã€è¡¨å•æäº¤
2.) èµ„æºåµŒå…¥ï¼š &lt;link&gt;ã€&lt;script&gt;ã€&lt;img&gt;ã€&lt;frame&gt;ç­‰domæ ‡ç­¾ï¼Œè¿˜æœ‰æ ·å¼ä¸­background:url()ã€@font-face()ç­‰æ–‡ä»¶å¤–é“¾
3.) è„šæœ¬è¯·æ±‚ï¼š jså‘èµ·çš„ajaxè¯·æ±‚ã€domå’Œjså¯¹è±¡çš„è·¨åŸŸæ“ä½œç­‰
</code></pre><p>å…¶å®æˆ‘ä»¬é€šå¸¸æ‰€è¯´çš„è·¨åŸŸæ˜¯ç‹­ä¹‰çš„ï¼Œæ˜¯ç”±æµè§ˆå™¨åŒæºç­–ç•¥é™åˆ¶çš„ä¸€ç±»è¯·æ±‚åœºæ™¯ã€‚</p>
<p>ä»€ä¹ˆæ˜¯åŒæºç­–ç•¥ï¼Ÿ<br>åŒæºç­–ç•¥/SOPï¼ˆSame origin policyï¼‰æ˜¯ä¸€ç§çº¦å®šï¼Œç”±Netscapeå…¬å¸1995å¹´å¼•å…¥æµè§ˆå™¨ï¼Œå®ƒæ˜¯æµè§ˆå™¨æœ€æ ¸å¿ƒä¹Ÿæœ€åŸºæœ¬çš„å®‰å…¨åŠŸèƒ½ï¼Œå¦‚æœç¼ºå°‘äº†åŒæºç­–ç•¥ï¼Œæµè§ˆå™¨å¾ˆå®¹æ˜“å—åˆ°XSSã€CSFRç­‰æ”»å‡»ã€‚æ‰€è°“åŒæºæ˜¯æŒ‡â€åè®®+åŸŸå+ç«¯å£â€ä¸‰è€…ç›¸åŒï¼Œå³ä¾¿ä¸¤ä¸ªä¸åŒçš„åŸŸåæŒ‡å‘åŒä¸€ä¸ªipåœ°å€ï¼Œä¹ŸéåŒæºã€‚</p>
<p>åŒæºç­–ç•¥é™åˆ¶ä»¥ä¸‹å‡ ç§è¡Œä¸ºï¼š</p>
<pre><code>1.) Cookieã€LocalStorage å’Œ IndexDB æ— æ³•è¯»å–
2.) DOM å’Œ Jså¯¹è±¡æ— æ³•è·å¾—
3.) AJAX è¯·æ±‚ä¸èƒ½å‘é€
</code></pre><h2 id="å¸¸è§è·¨åŸŸåœºæ™¯"><a href="#å¸¸è§è·¨åŸŸåœºæ™¯" class="headerlink" title="å¸¸è§è·¨åŸŸåœºæ™¯"></a>å¸¸è§è·¨åŸŸåœºæ™¯</h2><pre><code>URL                                      è¯´æ˜                    æ˜¯å¦å…è®¸é€šä¿¡
http://www.domain.com/a.js
http://www.domain.com/b.js         åŒä¸€åŸŸåï¼Œä¸åŒæ–‡ä»¶æˆ–è·¯å¾„           å…è®¸
http://www.domain.com/lab/c.js

http://www.domain.com:8000/a.js
http://www.domain.com/b.js         åŒä¸€åŸŸåï¼Œä¸åŒç«¯å£                ä¸å…è®¸

http://www.domain.com/a.js
https://www.domain.com/b.js        åŒä¸€åŸŸåï¼Œä¸åŒåè®®                ä¸å…è®¸

http://www.domain.com/a.js
http://192.168.4.12/b.js           åŸŸåå’ŒåŸŸåå¯¹åº”ç›¸åŒip              ä¸å…è®¸

http://www.domain.com/a.js
http://x.domain.com/b.js           ä¸»åŸŸç›¸åŒï¼Œå­åŸŸä¸åŒ                ä¸å…è®¸
http://domain.com/c.js

http://www.domain1.com/a.js
http://www.domain2.com/b.js        ä¸åŒåŸŸå                         ä¸å…è®¸
</code></pre><h2 id="è·¨åŸŸè§£å†³æ–¹æ¡ˆ"><a href="#è·¨åŸŸè§£å†³æ–¹æ¡ˆ" class="headerlink" title="è·¨åŸŸè§£å†³æ–¹æ¡ˆ"></a>è·¨åŸŸè§£å†³æ–¹æ¡ˆ</h2><p>1ã€ é€šè¿‡jsonpè·¨åŸŸ<br>2ã€ document.domain + iframeè·¨åŸŸ<br>3ã€ location.hash + iframe<br>4ã€ window.name + iframeè·¨åŸŸ<br>5ã€ postMessageè·¨åŸŸ<br>6ã€ è·¨åŸŸèµ„æºå…±äº«ï¼ˆCORSï¼‰<br>7ã€ nginxä»£ç†è·¨åŸŸ<br>8ã€ nodejsä¸­é—´ä»¶ä»£ç†è·¨åŸŸ<br>9ã€ WebSocketåè®®è·¨åŸŸ</p>
<h2 id="ä¸€ã€-é€šè¿‡jsonpè·¨åŸŸ"><a href="#ä¸€ã€-é€šè¿‡jsonpè·¨åŸŸ" class="headerlink" title="ä¸€ã€ é€šè¿‡jsonpè·¨åŸŸ"></a>ä¸€ã€ é€šè¿‡jsonpè·¨åŸŸ</h2><p>é€šå¸¸ä¸ºäº†å‡è½»webæœåŠ¡å™¨çš„è´Ÿè½½ï¼Œæˆ‘ä»¬æŠŠjsã€cssï¼Œimgç­‰é™æ€èµ„æºåˆ†ç¦»åˆ°å¦ä¸€å°ç‹¬ç«‹åŸŸåçš„æœåŠ¡å™¨ä¸Šï¼Œåœ¨htmlé¡µé¢ä¸­å†é€šè¿‡ç›¸åº”çš„æ ‡ç­¾ä»ä¸åŒåŸŸåä¸‹åŠ è½½é™æ€èµ„æºï¼Œè€Œè¢«æµè§ˆå™¨å…è®¸ï¼ŒåŸºäºæ­¤åŸç†ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åŠ¨æ€åˆ›å»ºscriptï¼Œå†è¯·æ±‚ä¸€ä¸ªå¸¦å‚ç½‘å€å®ç°è·¨åŸŸé€šä¿¡ã€‚</p>
<p>1.ï¼‰åŸç”Ÿå®ç°ï¼š</p>
<pre><code>&lt;script&gt;
    var script = document.createElement(&apos;script&apos;);
    script.type = &apos;text/javascript&apos;;

    // ä¼ å‚å¹¶æŒ‡å®šå›è°ƒæ‰§è¡Œå‡½æ•°ä¸ºonBack
    script.src = &apos;http://www.domain2.com:8080/login?user=admin&amp;callback=onBack&apos;;
    document.head.appendChild(script);

    // å›è°ƒæ‰§è¡Œå‡½æ•°
    function onBack(res) {
        alert(JSON.stringify(res));
    }
 &lt;/script&gt;
</code></pre><p>æœåŠ¡ç«¯è¿”å›å¦‚ä¸‹ï¼ˆè¿”å›æ—¶å³æ‰§è¡Œå…¨å±€å‡½æ•°ï¼‰ï¼š</p>
<pre><code>onBack({&quot;status&quot;: true, &quot;user&quot;: &quot;admin&quot;})
</code></pre><p>2.ï¼‰jquery ajaxï¼š</p>
<pre><code>$.ajax({
    url: &apos;http://www.domain2.com:8080/login&apos;,
    type: &apos;get&apos;,
    dataType: &apos;jsonp&apos;,  // è¯·æ±‚æ–¹å¼ä¸ºjsonp
    jsonpCallback: &quot;onBack&quot;,    // è‡ªå®šä¹‰å›è°ƒå‡½æ•°å
    data: {}
});
</code></pre><p>3.ï¼‰vue.jsï¼š</p>
<pre><code>this.$http.jsonp(&apos;http://www.domain2.com:8080/login&apos;, {
    params: {},
    jsonp: &apos;onBack&apos;
}).then((res) =&gt; {
    console.log(res); 
})
</code></pre><p>åç«¯node.jsä»£ç ç¤ºä¾‹ï¼š</p>
<pre><code>var querystring = require(&apos;querystring&apos;);
var http = require(&apos;http&apos;);
var server = http.createServer();

server.on(&apos;request&apos;, function(req, res) {
    var params = qs.parse(req.url.split(&apos;?&apos;)[1]);
    var fn = params.callback;

    // jsonpè¿”å›è®¾ç½®
    res.writeHead(200, { &apos;Content-Type&apos;: &apos;text/javascript&apos; });
    res.write(fn + &apos;(&apos; + JSON.stringify(params) + &apos;)&apos;);

    res.end();
});

server.listen(&apos;8080&apos;);
console.log(&apos;Server is running at port 8080...&apos;);
</code></pre><p>jsonpç¼ºç‚¹ï¼šåªèƒ½å®ç°getä¸€ç§è¯·æ±‚ã€‚</p>
<h2 id="äºŒã€-document-domain-iframeè·¨åŸŸ"><a href="#äºŒã€-document-domain-iframeè·¨åŸŸ" class="headerlink" title="äºŒã€ document.domain + iframeè·¨åŸŸ"></a>äºŒã€ document.domain + iframeè·¨åŸŸ</h2><p>æ­¤æ–¹æ¡ˆä»…é™ä¸»åŸŸç›¸åŒï¼Œå­åŸŸä¸åŒçš„è·¨åŸŸåº”ç”¨åœºæ™¯ã€‚</p>
<p>å®ç°åŸç†ï¼šä¸¤ä¸ªé¡µé¢éƒ½é€šè¿‡jså¼ºåˆ¶è®¾ç½®document.domainä¸ºåŸºç¡€ä¸»åŸŸï¼Œå°±å®ç°äº†åŒåŸŸã€‚</p>
<p>1.ï¼‰çˆ¶çª—å£ï¼š(<a href="https://link.zhihu.com/?target=http%3A//www.domain.com/a.html%29" target="_blank" rel="noopener">http://www.domain.com/a.html)</a></p>
<pre><code>&lt;iframe id=&quot;iframe&quot; src=&quot;http://child.domain.com/b.html&quot;&gt;&lt;/iframe&gt;
&lt;script&gt;
    document.domain = &apos;domain.com&apos;;
    var user = &apos;admin&apos;;
&lt;/script&gt;
</code></pre><p>2.ï¼‰å­çª—å£ï¼š(<a href="https://link.zhihu.com/?target=http%3A//child.domain.com/b.html%29" target="_blank" rel="noopener">http://child.domain.com/b.html)</a></p>
<pre><code>&lt;script&gt;
    document.domain = &apos;domain.com&apos;;
    // è·å–çˆ¶çª—å£ä¸­å˜é‡
    alert(&apos;get js data from parent ---&gt; &apos; + window.parent.user);
&lt;/script&gt;
</code></pre><h2 id="ä¸‰ã€-location-hash-iframeè·¨åŸŸ"><a href="#ä¸‰ã€-location-hash-iframeè·¨åŸŸ" class="headerlink" title="ä¸‰ã€ location.hash + iframeè·¨åŸŸ"></a>ä¸‰ã€ location.hash + iframeè·¨åŸŸ</h2><p>å®ç°åŸç†ï¼š aæ¬²ä¸bè·¨åŸŸç›¸äº’é€šä¿¡ï¼Œé€šè¿‡ä¸­é—´é¡µcæ¥å®ç°ã€‚ ä¸‰ä¸ªé¡µé¢ï¼Œä¸åŒåŸŸä¹‹é—´åˆ©ç”¨iframeçš„location.hashä¼ å€¼ï¼Œç›¸åŒåŸŸä¹‹é—´ç›´æ¥jsè®¿é—®æ¥é€šä¿¡ã€‚</p>
<p>å…·ä½“å®ç°ï¼šAåŸŸï¼ša.html -&gt; BåŸŸï¼šb.html -&gt; AåŸŸï¼šc.htmlï¼Œaä¸bä¸åŒåŸŸåªèƒ½é€šè¿‡hashå€¼å•å‘é€šä¿¡ï¼Œbä¸cä¹Ÿä¸åŒåŸŸä¹Ÿåªèƒ½å•å‘é€šä¿¡ï¼Œä½†cä¸aåŒåŸŸï¼Œæ‰€ä»¥cå¯é€šè¿‡parent.parentè®¿é—®aé¡µé¢æ‰€æœ‰å¯¹è±¡ã€‚</p>
<p>1.ï¼‰a.htmlï¼š(<a href="https://link.zhihu.com/?target=http%3A//www.domain1.com/a.html%29" target="_blank" rel="noopener">http://www.domain1.com/a.html)</a></p>
<pre><code>&lt;iframe id=&quot;iframe&quot; src=&quot;http://www.domain2.com/b.html&quot; style=&quot;display:none;&quot;&gt;&lt;/iframe&gt;
&lt;script&gt;
    var iframe = document.getElementById(&apos;iframe&apos;);

    // å‘b.htmlä¼ hashå€¼
    setTimeout(function() {
        iframe.src = iframe.src + &apos;#user=admin&apos;;
    }, 1000);

    // å¼€æ”¾ç»™åŒåŸŸc.htmlçš„å›è°ƒæ–¹æ³•
    function onCallback(res) {
        alert(&apos;data from c.html ---&gt; &apos; + res);
    }
&lt;/script&gt;
</code></pre><p>2.ï¼‰b.htmlï¼š(<a href="https://link.zhihu.com/?target=http%3A//www.domain2.com/b.html%29" target="_blank" rel="noopener">http://www.domain2.com/b.html)</a></p>
<pre><code>&lt;iframe id=&quot;iframe&quot; src=&quot;http://www.domain1.com/c.html&quot; style=&quot;display:none;&quot;&gt;&lt;/iframe&gt;
&lt;script&gt;
    var iframe = document.getElementById(&apos;iframe&apos;);

    // ç›‘å¬a.htmlä¼ æ¥çš„hashå€¼ï¼Œå†ä¼ ç»™c.html
    window.onhashchange = function () {
        iframe.src = iframe.src + location.hash;
    };
&lt;/script&gt;
</code></pre><p>3.ï¼‰c.htmlï¼š(<a href="https://link.zhihu.com/?target=http%3A//www.domain1.com/c.html%29" target="_blank" rel="noopener">http://www.domain1.com/c.html)</a></p>
<pre><code>&lt;script&gt;
    // ç›‘å¬b.htmlä¼ æ¥çš„hashå€¼
    window.onhashchange = function () {
        // å†é€šè¿‡æ“ä½œåŒåŸŸa.htmlçš„jså›è°ƒï¼Œå°†ç»“æœä¼ å›
        window.parent.parent.onCallback(&apos;hello: &apos; + location.hash.replace(&apos;#user=&apos;, &apos;&apos;));
    };
&lt;/script&gt;
</code></pre><h2 id="å››ã€-window-name-iframeè·¨åŸŸ"><a href="#å››ã€-window-name-iframeè·¨åŸŸ" class="headerlink" title="å››ã€ window.name + iframeè·¨åŸŸ"></a>å››ã€ window.name + iframeè·¨åŸŸ</h2><p>window.nameå±æ€§çš„ç‹¬ç‰¹ä¹‹å¤„ï¼šnameå€¼åœ¨ä¸åŒçš„é¡µé¢ï¼ˆç”šè‡³ä¸åŒåŸŸåï¼‰åŠ è½½åä¾æ—§å­˜åœ¨ï¼Œå¹¶ä¸”å¯ä»¥æ”¯æŒéå¸¸é•¿çš„ name å€¼ï¼ˆ2MBï¼‰ã€‚</p>
<p>1.ï¼‰a.htmlï¼š(<a href="https://link.zhihu.com/?target=http%3A//www.domain1.com/a.html%29" target="_blank" rel="noopener">http://www.domain1.com/a.html)</a></p>
<pre><code>var proxy = function(url, callback) {
    var state = 0;
    var iframe = document.createElement(&apos;iframe&apos;);

    // åŠ è½½è·¨åŸŸé¡µé¢
    iframe.src = url;

    // onloadäº‹ä»¶ä¼šè§¦å‘2æ¬¡ï¼Œç¬¬1æ¬¡åŠ è½½è·¨åŸŸé¡µï¼Œå¹¶ç•™å­˜æ•°æ®äºwindow.name
    iframe.onload = function() {
        if (state === 1) {
            // ç¬¬2æ¬¡onload(åŒåŸŸproxyé¡µ)æˆåŠŸåï¼Œè¯»å–åŒåŸŸwindow.nameä¸­æ•°æ®
            callback(iframe.contentWindow.name);
            destoryFrame();

        } else if (state === 0) {
            // ç¬¬1æ¬¡onload(è·¨åŸŸé¡µ)æˆåŠŸåï¼Œåˆ‡æ¢åˆ°åŒåŸŸä»£ç†é¡µé¢
            iframe.contentWindow.location = &apos;http://www.domain1.com/proxy.html&apos;;
            state = 1;
        }
    };

    document.body.appendChild(iframe);

    // è·å–æ•°æ®ä»¥åé”€æ¯è¿™ä¸ªiframeï¼Œé‡Šæ”¾å†…å­˜ï¼›è¿™ä¹Ÿä¿è¯äº†å®‰å…¨ï¼ˆä¸è¢«å…¶ä»–åŸŸframe jsè®¿é—®ï¼‰
    function destoryFrame() {
        iframe.contentWindow.document.write(&apos;&apos;);
        iframe.contentWindow.close();
        document.body.removeChild(iframe);
    }
};

// è¯·æ±‚è·¨åŸŸbé¡µé¢æ•°æ®
proxy(&apos;http://www.domain2.com/b.html&apos;, function(data){
    alert(data);
});
</code></pre><p>2.ï¼‰proxy.htmlï¼š(<a href="https://link.zhihu.com/?target=http%3A//www.domain1.com/proxy.html%29" target="_blank" rel="noopener">http://www.domain1.com/proxyâ€¦.</a><br>ä¸­é—´ä»£ç†é¡µï¼Œä¸a.htmlåŒåŸŸï¼Œå†…å®¹ä¸ºç©ºå³å¯ã€‚</p>
<p>3.ï¼‰b.htmlï¼š(<a href="https://link.zhihu.com/?target=http%3A//www.domain2.com/b.html%29" target="_blank" rel="noopener">http://www.domain2.com/b.html)</a></p>
<pre><code>&lt;script&gt;
    window.name = &apos;This is domain2 data!&apos;;
&lt;/script&gt;
</code></pre><p>æ€»ç»“ï¼šé€šè¿‡iframeçš„srcå±æ€§ç”±å¤–åŸŸè½¬å‘æœ¬åœ°åŸŸï¼Œè·¨åŸŸæ•°æ®å³ç”±iframeçš„window.nameä»å¤–åŸŸä¼ é€’åˆ°æœ¬åœ°åŸŸã€‚è¿™ä¸ªå°±å·§å¦™åœ°ç»•è¿‡äº†æµè§ˆå™¨çš„è·¨åŸŸè®¿é—®é™åˆ¶ï¼Œä½†åŒæ—¶å®ƒåˆæ˜¯å®‰å…¨æ“ä½œã€‚</p>
<h2 id="äº”ã€-postMessageè·¨åŸŸ"><a href="#äº”ã€-postMessageè·¨åŸŸ" class="headerlink" title="äº”ã€ postMessageè·¨åŸŸ"></a>äº”ã€ postMessageè·¨åŸŸ</h2><p>postMessageæ˜¯HTML5 XMLHttpRequest Level 2ä¸­çš„APIï¼Œä¸”æ˜¯ä¸ºæ•°ä¸å¤šå¯ä»¥è·¨åŸŸæ“ä½œçš„windowå±æ€§ä¹‹ä¸€ï¼Œå®ƒå¯ç”¨äºè§£å†³ä»¥ä¸‹æ–¹é¢çš„é—®é¢˜ï¼š<br>a.ï¼‰ é¡µé¢å’Œå…¶æ‰“å¼€çš„æ–°çª—å£çš„æ•°æ®ä¼ é€’<br>b.ï¼‰ å¤šçª—å£ä¹‹é—´æ¶ˆæ¯ä¼ é€’<br>c.ï¼‰ é¡µé¢ä¸åµŒå¥—çš„iframeæ¶ˆæ¯ä¼ é€’<br>d.ï¼‰ ä¸Šé¢ä¸‰ä¸ªåœºæ™¯çš„è·¨åŸŸæ•°æ®ä¼ é€’</p>
<p>ç”¨æ³•ï¼špostMessage(data,origin)æ–¹æ³•æ¥å—ä¸¤ä¸ªå‚æ•°<br>dataï¼š html5è§„èŒƒæ”¯æŒä»»æ„åŸºæœ¬ç±»å‹æˆ–å¯å¤åˆ¶çš„å¯¹è±¡ï¼Œä½†éƒ¨åˆ†æµè§ˆå™¨åªæ”¯æŒå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥ä¼ å‚æ—¶æœ€å¥½ç”¨JSON.stringify()åºåˆ—åŒ–ã€‚<br>originï¼š åè®®+ä¸»æœº+ç«¯å£å·ï¼Œä¹Ÿå¯ä»¥è®¾ç½®ä¸ºâ€*â€ï¼Œè¡¨ç¤ºå¯ä»¥ä¼ é€’ç»™ä»»æ„çª—å£ï¼Œå¦‚æœè¦æŒ‡å®šå’Œå½“å‰çª—å£åŒæºçš„è¯è®¾ç½®ä¸ºâ€/â€œã€‚</p>
<p>1.ï¼‰a.htmlï¼š(<a href="https://link.zhihu.com/?target=http%3A//www.domain1.com/a.html%29" target="_blank" rel="noopener">http://www.domain1.com/a.html)</a></p>
<pre><code>&lt;iframe id=&quot;iframe&quot; src=&quot;http://www.domain2.com/b.html&quot; style=&quot;display:none;&quot;&gt;&lt;/iframe&gt;
&lt;script&gt;       
    var iframe = document.getElementById(&apos;iframe&apos;);
    iframe.onload = function() {
        var data = {
            name: &apos;aym&apos;
        };
        // å‘domain2ä¼ é€è·¨åŸŸæ•°æ®
        iframe.contentWindow.postMessage(JSON.stringify(data), &apos;http://www.domain2.com&apos;);
    };

    // æ¥å—domain2è¿”å›æ•°æ®
    window.addEventListener(&apos;message&apos;, function(e) {
        alert(&apos;data from domain2 ---&gt; &apos; + e.data);
    }, false);
&lt;/script&gt;
</code></pre><p>2.ï¼‰b.htmlï¼š(<a href="https://link.zhihu.com/?target=http%3A//www.domain2.com/b.html%29" target="_blank" rel="noopener">http://www.domain2.com/b.html)</a></p>
<pre><code>&lt;script&gt;
    // æ¥æ”¶domain1çš„æ•°æ®
    window.addEventListener(&apos;message&apos;, function(e) {
        alert(&apos;data from domain1 ---&gt; &apos; + e.data);

        var data = JSON.parse(e.data);
        if (data) {
            data.number = 16;

            // å¤„ç†åå†å‘å›domain1
            window.parent.postMessage(JSON.stringify(data), &apos;http://www.domain1.com&apos;);
        }
    }, false);
&lt;/script&gt;
</code></pre><h2 id="å…­ã€-è·¨åŸŸèµ„æºå…±äº«ï¼ˆCORSï¼‰"><a href="#å…­ã€-è·¨åŸŸèµ„æºå…±äº«ï¼ˆCORSï¼‰" class="headerlink" title="å…­ã€ è·¨åŸŸèµ„æºå…±äº«ï¼ˆCORSï¼‰"></a>å…­ã€ è·¨åŸŸèµ„æºå…±äº«ï¼ˆCORSï¼‰</h2><p>æ™®é€šè·¨åŸŸè¯·æ±‚ï¼šåªæœåŠ¡ç«¯è®¾ç½®Access-Control-Allow-Originå³å¯ï¼Œå‰ç«¯æ— é¡»è®¾ç½®ï¼Œè‹¥è¦å¸¦cookieè¯·æ±‚ï¼šå‰åç«¯éƒ½éœ€è¦è®¾ç½®ã€‚</p>
<p>éœ€æ³¨æ„çš„æ˜¯ï¼šç”±äºåŒæºç­–ç•¥çš„é™åˆ¶ï¼Œæ‰€è¯»å–çš„cookieä¸ºè·¨åŸŸè¯·æ±‚æ¥å£æ‰€åœ¨åŸŸçš„cookieï¼Œè€Œéå½“å‰é¡µã€‚å¦‚æœæƒ³å®ç°å½“å‰é¡µcookieçš„å†™å…¥ï¼Œå¯å‚è€ƒä¸‹æ–‡ï¼šä¸ƒã€nginxåå‘ä»£ç†ä¸­è®¾ç½®proxy_cookie_domain å’Œ å…«ã€NodeJsä¸­é—´ä»¶ä»£ç†ä¸­cookieDomainRewriteå‚æ•°çš„è®¾ç½®ã€‚</p>
<p>ç›®å‰ï¼Œæ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒè¯¥åŠŸèƒ½(IE8+ï¼šIE8/9éœ€è¦ä½¿ç”¨XDomainRequestå¯¹è±¡æ¥æ”¯æŒCORSï¼‰)ï¼ŒCORSä¹Ÿå·²ç»æˆä¸ºä¸»æµçš„è·¨åŸŸè§£å†³æ–¹æ¡ˆã€‚</p>
<h2 id="1ã€-å‰ç«¯è®¾ç½®ï¼š"><a href="#1ã€-å‰ç«¯è®¾ç½®ï¼š" class="headerlink" title="1ã€ å‰ç«¯è®¾ç½®ï¼š"></a>1ã€ å‰ç«¯è®¾ç½®ï¼š</h2><p>1.ï¼‰åŸç”Ÿajax</p>
<pre><code>// å‰ç«¯è®¾ç½®æ˜¯å¦å¸¦cookie
xhr.withCredentials = true;
</code></pre><p>ç¤ºä¾‹ä»£ç ï¼š</p>
<pre><code>var xhr = new XMLHttpRequest(); // IE8/9éœ€ç”¨window.XDomainRequestå…¼å®¹

// å‰ç«¯è®¾ç½®æ˜¯å¦å¸¦cookie
xhr.withCredentials = true;

xhr.open(&apos;post&apos;, &apos;http://www.domain2.com:8080/login&apos;, true);
xhr.setRequestHeader(&apos;Content-Type&apos;, &apos;application/x-www-form-urlencoded&apos;);
xhr.send(&apos;user=admin&apos;);

xhr.onreadystatechange = function() {
    if (xhr.readyState == 4 &amp;&amp; xhr.status == 200) {
        alert(xhr.responseText);
    }
};
</code></pre><p>2.ï¼‰jQuery ajax</p>
<pre><code>$.ajax({
    ...
   xhrFields: {
       withCredentials: true    // å‰ç«¯è®¾ç½®æ˜¯å¦å¸¦cookie
   },
   crossDomain: true,   // ä¼šè®©è¯·æ±‚å¤´ä¸­åŒ…å«è·¨åŸŸçš„é¢å¤–ä¿¡æ¯ï¼Œä½†ä¸ä¼šå«cookie
    ...
});
</code></pre><p>3.ï¼‰vueæ¡†æ¶<br>åœ¨vue-resourceå°è£…çš„ajaxç»„ä»¶ä¸­åŠ å…¥ä»¥ä¸‹ä»£ç ï¼š</p>
<pre><code>Vue.http.options.credentials = true
</code></pre><h2 id="2ã€-æœåŠ¡ç«¯è®¾ç½®ï¼š"><a href="#2ã€-æœåŠ¡ç«¯è®¾ç½®ï¼š" class="headerlink" title="2ã€ æœåŠ¡ç«¯è®¾ç½®ï¼š"></a>2ã€ æœåŠ¡ç«¯è®¾ç½®ï¼š</h2><p>è‹¥åç«¯è®¾ç½®æˆåŠŸï¼Œå‰ç«¯æµè§ˆå™¨æ§åˆ¶å°åˆ™ä¸ä¼šå‡ºç°è·¨åŸŸæŠ¥é”™ä¿¡æ¯ï¼Œåä¹‹ï¼Œè¯´æ˜æ²¡è®¾æˆåŠŸã€‚</p>
<p>1.ï¼‰Javaåå°ï¼š</p>
<pre><code>/*
 * å¯¼å…¥åŒ…ï¼šimport javax.servlet.http.HttpServletResponse;
 * æ¥å£å‚æ•°ä¸­å®šä¹‰ï¼šHttpServletResponse response
 */
response.setHeader(&quot;Access-Control-Allow-Origin&quot;, &quot;http://www.domain1.com&quot;);  // è‹¥æœ‰ç«¯å£éœ€å†™å…¨ï¼ˆåè®®+åŸŸå+ç«¯å£ï¼‰
response.setHeader(&quot;Access-Control-Allow-Credentials&quot;, &quot;true&quot;);
</code></pre><p>2.ï¼‰Nodejsåå°ç¤ºä¾‹ï¼š</p>
<pre><code>var http = require(&apos;http&apos;);
var server = http.createServer();
var qs = require(&apos;querystring&apos;);

server.on(&apos;request&apos;, function(req, res) {
    var postData = &apos;&apos;;

    // æ•°æ®å—æ¥æ”¶ä¸­
    req.addListener(&apos;data&apos;, function(chunk) {
        postData += chunk;
    });

    // æ•°æ®æ¥æ”¶å®Œæ¯•
    req.addListener(&apos;end&apos;, function() {
        postData = qs.parse(postData);

        // è·¨åŸŸåå°è®¾ç½®
        res.writeHead(200, {
            &apos;Access-Control-Allow-Credentials&apos;: &apos;true&apos;,     // åç«¯å…è®¸å‘é€Cookie
            &apos;Access-Control-Allow-Origin&apos;: &apos;http://www.domain1.com&apos;,    // å…è®¸è®¿é—®çš„åŸŸï¼ˆåè®®+åŸŸå+ç«¯å£ï¼‰
            &apos;Set-Cookie&apos;: &apos;l=a123456;Path=/;Domain=www.domain2.com;HttpOnly&apos;   // HttpOnly:è„šæœ¬æ— æ³•è¯»å–cookie
        });

        res.write(JSON.stringify(postData));
        res.end();
    });
});

server.listen(&apos;8080&apos;);
console.log(&apos;Server is running at port 8080...&apos;);
</code></pre><h2 id="ä¸ƒã€-nginxä»£ç†è·¨åŸŸ"><a href="#ä¸ƒã€-nginxä»£ç†è·¨åŸŸ" class="headerlink" title="ä¸ƒã€ nginxä»£ç†è·¨åŸŸ"></a>ä¸ƒã€ nginxä»£ç†è·¨åŸŸ</h2><h2 id="1ã€-nginxé…ç½®è§£å†³iconfontè·¨åŸŸ"><a href="#1ã€-nginxé…ç½®è§£å†³iconfontè·¨åŸŸ" class="headerlink" title="1ã€ nginxé…ç½®è§£å†³iconfontè·¨åŸŸ"></a>1ã€ nginxé…ç½®è§£å†³iconfontè·¨åŸŸ</h2><p>æµè§ˆå™¨è·¨åŸŸè®¿é—®jsã€cssã€imgç­‰å¸¸è§„é™æ€èµ„æºè¢«åŒæºç­–ç•¥è®¸å¯ï¼Œä½†iconfontå­—ä½“æ–‡ä»¶(eot|otf|ttf|woff|svg)ä¾‹å¤–ï¼Œæ­¤æ—¶å¯åœ¨nginxçš„é™æ€èµ„æºæœåŠ¡å™¨ä¸­åŠ å…¥ä»¥ä¸‹é…ç½®ã€‚</p>
<pre><code>location / {
  add_header Access-Control-Allow-Origin *;
}
</code></pre><h2 id="2ã€-nginxåå‘ä»£ç†æ¥å£è·¨åŸŸ"><a href="#2ã€-nginxåå‘ä»£ç†æ¥å£è·¨åŸŸ" class="headerlink" title="2ã€ nginxåå‘ä»£ç†æ¥å£è·¨åŸŸ"></a>2ã€ nginxåå‘ä»£ç†æ¥å£è·¨åŸŸ</h2><p>è·¨åŸŸåŸç†ï¼š åŒæºç­–ç•¥æ˜¯æµè§ˆå™¨çš„å®‰å…¨ç­–ç•¥ï¼Œä¸æ˜¯HTTPåè®®çš„ä¸€éƒ¨åˆ†ã€‚æœåŠ¡å™¨ç«¯è°ƒç”¨HTTPæ¥å£åªæ˜¯ä½¿ç”¨HTTPåè®®ï¼Œä¸ä¼šæ‰§è¡ŒJSè„šæœ¬ï¼Œä¸éœ€è¦åŒæºç­–ç•¥ï¼Œä¹Ÿå°±ä¸å­˜åœ¨è·¨è¶Šé—®é¢˜ã€‚</p>
<p>å®ç°æ€è·¯ï¼šé€šè¿‡nginxé…ç½®ä¸€ä¸ªä»£ç†æœåŠ¡å™¨ï¼ˆåŸŸåä¸domain1ç›¸åŒï¼Œç«¯å£ä¸åŒï¼‰åšè·³æ¿æœºï¼Œåå‘ä»£ç†è®¿é—®domain2æ¥å£ï¼Œå¹¶ä¸”å¯ä»¥é¡ºä¾¿ä¿®æ”¹cookieä¸­domainä¿¡æ¯ï¼Œæ–¹ä¾¿å½“å‰åŸŸcookieå†™å…¥ï¼Œå®ç°è·¨åŸŸç™»å½•ã€‚</p>
<p>nginxå…·ä½“é…ç½®ï¼š</p>
<pre><code>#proxyæœåŠ¡å™¨
server {
    listen       81;
    server_name  www.domain1.com;

    location / {
        proxy_pass   http://www.domain2.com:8080;  #åå‘ä»£ç†
        proxy_cookie_domain www.domain2.com www.domain1.com; #ä¿®æ”¹cookieé‡ŒåŸŸå
        index  index.html index.htm;

        # å½“ç”¨webpack-dev-serverç­‰ä¸­é—´ä»¶ä»£ç†æ¥å£è®¿é—®nignxæ—¶ï¼Œæ­¤æ—¶æ— æµè§ˆå™¨å‚ä¸ï¼Œæ•…æ²¡æœ‰åŒæºé™åˆ¶ï¼Œä¸‹é¢çš„è·¨åŸŸé…ç½®å¯ä¸å¯ç”¨
        add_header Access-Control-Allow-Origin http://www.domain1.com;  #å½“å‰ç«¯åªè·¨åŸŸä¸å¸¦cookieæ—¶ï¼Œå¯ä¸º*
        add_header Access-Control-Allow-Credentials true;
    }
}
</code></pre><p>1.) å‰ç«¯ä»£ç ç¤ºä¾‹ï¼š</p>
<pre><code>var xhr = new XMLHttpRequest();

// å‰ç«¯å¼€å…³ï¼šæµè§ˆå™¨æ˜¯å¦è¯»å†™cookie
xhr.withCredentials = true;

// è®¿é—®nginxä¸­çš„ä»£ç†æœåŠ¡å™¨
xhr.open(&apos;get&apos;, &apos;http://www.domain1.com:81/?user=admin&apos;, true);
xhr.send();
</code></pre><p>2.) Nodejsåå°ç¤ºä¾‹ï¼š</p>
<pre><code>var http = require(&apos;http&apos;);
var server = http.createServer();
var qs = require(&apos;querystring&apos;);

server.on(&apos;request&apos;, function(req, res) {
    var params = qs.parse(req.url.substring(2));

    // å‘å‰å°å†™cookie
    res.writeHead(200, {
        &apos;Set-Cookie&apos;: &apos;l=a123456;Path=/;Domain=www.domain2.com;HttpOnly&apos;   // HttpOnly:è„šæœ¬æ— æ³•è¯»å–
    });

    res.write(JSON.stringify(params));
    res.end();
});

server.listen(&apos;8080&apos;);
console.log(&apos;Server is running at port 8080...&apos;);
</code></pre><h2 id="å…«ã€-Nodejsä¸­é—´ä»¶ä»£ç†è·¨åŸŸ"><a href="#å…«ã€-Nodejsä¸­é—´ä»¶ä»£ç†è·¨åŸŸ" class="headerlink" title="å…«ã€ Nodejsä¸­é—´ä»¶ä»£ç†è·¨åŸŸ"></a>å…«ã€ Nodejsä¸­é—´ä»¶ä»£ç†è·¨åŸŸ</h2><p>nodeä¸­é—´ä»¶å®ç°è·¨åŸŸä»£ç†ï¼ŒåŸç†å¤§è‡´ä¸nginxç›¸åŒï¼Œéƒ½æ˜¯é€šè¿‡å¯ä¸€ä¸ªä»£ç†æœåŠ¡å™¨ï¼Œå®ç°æ•°æ®çš„è½¬å‘ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½®cookieDomainRewriteå‚æ•°ä¿®æ”¹å“åº”å¤´ä¸­cookieä¸­åŸŸåï¼Œå®ç°å½“å‰åŸŸçš„cookieå†™å…¥ï¼Œæ–¹ä¾¿æ¥å£ç™»å½•è®¤è¯ã€‚</p>
<h2 id="1ã€-évueæ¡†æ¶çš„è·¨åŸŸï¼ˆ2æ¬¡è·¨åŸŸï¼‰"><a href="#1ã€-évueæ¡†æ¶çš„è·¨åŸŸï¼ˆ2æ¬¡è·¨åŸŸï¼‰" class="headerlink" title="1ã€ évueæ¡†æ¶çš„è·¨åŸŸï¼ˆ2æ¬¡è·¨åŸŸï¼‰"></a>1ã€ évueæ¡†æ¶çš„è·¨åŸŸï¼ˆ2æ¬¡è·¨åŸŸï¼‰</h2><p>åˆ©ç”¨node + express + http-proxy-middlewareæ­å»ºä¸€ä¸ªproxyæœåŠ¡å™¨ã€‚</p>
<p>1.ï¼‰å‰ç«¯ä»£ç ç¤ºä¾‹ï¼š</p>
<pre><code>var xhr = new XMLHttpRequest();

// å‰ç«¯å¼€å…³ï¼šæµè§ˆå™¨æ˜¯å¦è¯»å†™cookie
xhr.withCredentials = true;

// è®¿é—®http-proxy-middlewareä»£ç†æœåŠ¡å™¨
xhr.open(&apos;get&apos;, &apos;http://www.domain1.com:3000/login?user=admin&apos;, true);
xhr.send();
</code></pre><p>2.ï¼‰ä¸­é—´ä»¶æœåŠ¡å™¨ï¼š</p>
<pre><code>var express = require(&apos;express&apos;);
var proxy = require(&apos;http-proxy-middleware&apos;);
var app = express();

app.use(&apos;/&apos;, proxy({
    // ä»£ç†è·¨åŸŸç›®æ ‡æ¥å£
    target: &apos;http://www.domain2.com:8080&apos;,
    changeOrigin: true,

    // ä¿®æ”¹å“åº”å¤´ä¿¡æ¯ï¼Œå®ç°è·¨åŸŸå¹¶å…è®¸å¸¦cookie
    onProxyRes: function(proxyRes, req, res) {
        res.header(&apos;Access-Control-Allow-Origin&apos;, &apos;http://www.domain1.com&apos;);
        res.header(&apos;Access-Control-Allow-Credentials&apos;, &apos;true&apos;);
    },

    // ä¿®æ”¹å“åº”ä¿¡æ¯ä¸­çš„cookieåŸŸå
    cookieDomainRewrite: &apos;www.domain1.com&apos;  // å¯ä»¥ä¸ºfalseï¼Œè¡¨ç¤ºä¸ä¿®æ”¹
}));

app.listen(3000);
console.log(&apos;Proxy server is listen at port 3000...&apos;);
</code></pre><p>3.ï¼‰Nodejsåå°åŒï¼ˆå…­ï¼šnginxï¼‰</p>
<h2 id="2ã€-vueæ¡†æ¶çš„è·¨åŸŸï¼ˆ1æ¬¡è·¨åŸŸï¼‰"><a href="#2ã€-vueæ¡†æ¶çš„è·¨åŸŸï¼ˆ1æ¬¡è·¨åŸŸï¼‰" class="headerlink" title="2ã€ vueæ¡†æ¶çš„è·¨åŸŸï¼ˆ1æ¬¡è·¨åŸŸï¼‰"></a>2ã€ vueæ¡†æ¶çš„è·¨åŸŸï¼ˆ1æ¬¡è·¨åŸŸï¼‰</h2><p>åˆ©ç”¨node + webpack + webpack-dev-serverä»£ç†æ¥å£è·¨åŸŸã€‚åœ¨å¼€å‘ç¯å¢ƒä¸‹ï¼Œç”±äºvueæ¸²æŸ“æœåŠ¡å’Œæ¥å£ä»£ç†æœåŠ¡éƒ½æ˜¯webpack-dev-serveråŒä¸€ä¸ªï¼Œæ‰€ä»¥é¡µé¢ä¸ä»£ç†æ¥å£ä¹‹é—´ä¸å†è·¨åŸŸï¼Œæ— é¡»è®¾ç½®headersè·¨åŸŸä¿¡æ¯äº†ã€‚</p>
<p>webpack.config.jséƒ¨åˆ†é…ç½®ï¼š</p>
<pre><code>module.exports = {
    entry: {},
    module: {},
    ...
    devServer: {
        historyApiFallback: true,
        proxy: [{
            context: &apos;/login&apos;,
            target: &apos;http://www.domain2.com:8080&apos;,  // ä»£ç†è·¨åŸŸç›®æ ‡æ¥å£
            changeOrigin: true,
            cookieDomainRewrite: &apos;www.domain1.com&apos;  // å¯ä»¥ä¸ºfalseï¼Œè¡¨ç¤ºä¸ä¿®æ”¹
        }],
        noInfo: true
    }
}
</code></pre><h2 id="ä¹ã€-WebSocketåè®®è·¨åŸŸ"><a href="#ä¹ã€-WebSocketåè®®è·¨åŸŸ" class="headerlink" title="ä¹ã€ WebSocketåè®®è·¨åŸŸ"></a>ä¹ã€ WebSocketåè®®è·¨åŸŸ</h2><p>WebSocket protocolæ˜¯HTML5ä¸€ç§æ–°çš„åè®®ã€‚å®ƒå®ç°äº†æµè§ˆå™¨ä¸æœåŠ¡å™¨å…¨åŒå·¥é€šä¿¡ï¼ŒåŒæ—¶å…è®¸è·¨åŸŸé€šè®¯ï¼Œæ˜¯server pushæŠ€æœ¯çš„ä¸€ç§å¾ˆå¥½çš„å®ç°ã€‚<br>åŸç”ŸWebSocket APIä½¿ç”¨èµ·æ¥ä¸å¤ªæ–¹ä¾¿ï¼Œæˆ‘ä»¬ä½¿ç”¨<a href="https://link.zhihu.com/?target=http%3A//Socket.io" target="_blank" rel="noopener">http://Socket.io</a>ï¼Œå®ƒå¾ˆå¥½åœ°å°è£…äº†webSocketæ¥å£ï¼Œæä¾›äº†æ›´ç®€å•ã€çµæ´»çš„æ¥å£ï¼Œä¹Ÿå¯¹ä¸æ”¯æŒwebSocketçš„æµè§ˆå™¨æä¾›äº†å‘ä¸‹å…¼å®¹ã€‚</p>
<p>1.ï¼‰å‰ç«¯ä»£ç ï¼š</p>
<pre><code>&lt;div&gt;user inputï¼š&lt;input type=&quot;text&quot;&gt;&lt;/div&gt;
&lt;script src=&quot;./socket.io.js&quot;&gt;&lt;/script&gt;
&lt;script&gt;
var socket = io(&apos;http://www.domain2.com:8080&apos;);

// è¿æ¥æˆåŠŸå¤„ç†
socket.on(&apos;connect&apos;, function() {
    // ç›‘å¬æœåŠ¡ç«¯æ¶ˆæ¯
    socket.on(&apos;message&apos;, function(msg) {
        console.log(&apos;data from server: ---&gt; &apos; + msg); 
    });

    // ç›‘å¬æœåŠ¡ç«¯å…³é—­
    socket.on(&apos;disconnect&apos;, function() { 
        console.log(&apos;Server socket has closed.&apos;); 
    });
});

document.getElementsByTagName(&apos;input&apos;)[0].onblur = function() {
    socket.send(this.value);
};
&lt;/script&gt;
</code></pre><p>2.ï¼‰Nodejs socketåå°ï¼š</p>
<pre><code>var http = require(&apos;http&apos;);
var socket = require(&apos;socket.io&apos;);

// å¯httpæœåŠ¡
var server = http.createServer(function(req, res) {
    res.writeHead(200, {
        &apos;Content-type&apos;: &apos;text/html&apos;
    });
    res.end();
});

server.listen(&apos;8080&apos;);
console.log(&apos;Server is running at port 8080...&apos;);

// ç›‘å¬socketè¿æ¥
socket.listen(server).on(&apos;connection&apos;, function(client) {
    // æ¥æ”¶ä¿¡æ¯
    client.on(&apos;message&apos;, function(msg) {
        client.send(&apos;helloï¼š&apos; + msg);
        console.log(&apos;data from client: ---&gt; &apos; + msg);
    });

    // æ–­å¼€å¤„ç†
    client.on(&apos;disconnect&apos;, function() {
        console.log(&apos;Client socket has closed.&apos;); 
    });
}); 
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/01/NPMå­¦ä¹ ç¬”è®°æ•´ç†/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/01/NPMå­¦ä¹ ç¬”è®°æ•´ç†/" itemprop="url">NPMå­¦ä¹ ç¬”è®°æ•´ç†</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-04-01T18:35:10+08:00">
                2018-04-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="ä»€ä¹ˆæ˜¯-NPMä»€ä¹ˆæ˜¯-NPM"><a href="#ä»€ä¹ˆæ˜¯-NPMä»€ä¹ˆæ˜¯-NPM" class="headerlink" title="ä»€ä¹ˆæ˜¯-NPMä»€ä¹ˆæ˜¯ NPM"></a><a href="#ä»€ä¹ˆæ˜¯-NPM">ä»€ä¹ˆæ˜¯-NPM</a>ä»€ä¹ˆæ˜¯ NPM</h1><p><code>npm</code> ä¹‹äº <code>Node</code> ï¼Œå°±åƒ <code>pip</code> ä¹‹äº <code>Python</code> , <code>gem</code> ä¹‹äº <code>Ruby</code> , <code>composer</code> ä¹‹äº <code>PHP</code> ã€‚</p>
<p><code>npm</code> æ˜¯ <code>Node</code> å®˜æ–¹æä¾›çš„åŒ…ç®¡ç†å·¥å…·ï¼Œä»–å·²ç»æˆäº† <code>Node</code> åŒ…çš„æ ‡å‡†å‘å¸ƒå¹³å°ï¼Œç”¨äº <code>Node</code> åŒ…çš„å‘å¸ƒã€ä¼ æ’­ã€ä¾èµ–æ§åˆ¶ã€‚<br><code>npm</code> æä¾›äº†å‘½ä»¤è¡Œå·¥å…·ï¼Œä½¿ä½ å¯ä»¥æ–¹ä¾¿åœ°ä¸‹è½½ã€å®‰è£…ã€å‡çº§ã€åˆ é™¤åŒ…ï¼Œä¹Ÿå¯ä»¥è®©ä½ ä½œä¸ºå¼€å‘è€…å‘å¸ƒå¹¶ç»´æŠ¤åŒ…ã€‚</p>
<h1 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-NPMä¸ºä»€ä¹ˆè¦ä½¿ç”¨-NPM"><a href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-NPMä¸ºä»€ä¹ˆè¦ä½¿ç”¨-NPM" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-NPMä¸ºä»€ä¹ˆè¦ä½¿ç”¨ NPM"></a><a href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-NPM">ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-NPM</a>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ NPM</h1><p><code>npm</code> æ˜¯éšåŒ <code>Node</code> ä¸€èµ·å®‰è£…çš„åŒ…ç®¡ç†å·¥å…·ï¼Œèƒ½è§£å†³ <code>Node</code> ä»£ç éƒ¨ç½²ä¸Šçš„å¾ˆå¤šé—®é¢˜ï¼Œå¸¸è§çš„åœºæ™¯æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p>
<ul>
<li>å…è®¸ç”¨æˆ·ä» <code>npm</code> æœåŠ¡å™¨ä¸‹è½½åˆ«äººç¼–å†™çš„ç¬¬ä¸‰æ–¹åŒ…åˆ°æœ¬åœ°ä½¿ç”¨ã€‚</li>
<li>å…è®¸ç”¨æˆ·ä» <code>npm</code> æœåŠ¡å™¨ä¸‹è½½å¹¶å®‰è£…åˆ«äººç¼–å†™çš„å‘½ä»¤è¡Œç¨‹åºåˆ°æœ¬åœ°ä½¿ç”¨ã€‚</li>
<li>å…è®¸ç”¨æˆ·å°†è‡ªå·±ç¼–å†™çš„åŒ…æˆ–å‘½ä»¤è¡Œç¨‹åºä¸Šä¼ åˆ° <code>npm</code> æœåŠ¡å™¨ä¾›åˆ«äººä½¿ç”¨ã€‚</li>
</ul>
<p><code>npm</code> çš„èƒŒåï¼Œæ˜¯åŸºäº <code>CouchDB</code> çš„ä¸€ä¸ªæ•°æ®åº“ï¼Œè¯¦ç»†è®°å½•äº†æ¯ä¸ªåŒ…çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä½œè€…ã€ç‰ˆæœ¬ã€ä¾èµ–ã€æˆæƒä¿¡æ¯ç­‰ã€‚å®ƒçš„ä¸€ä¸ªå¾ˆé‡è¦çš„ä½œç”¨å°±æ˜¯ï¼šå°†å¼€å‘è€…ä»ç¹ççš„åŒ…ç®¡ç†å·¥ä½œï¼ˆç‰ˆæœ¬ã€ä¾èµ–ç­‰ï¼‰ä¸­è§£æ”¾å‡ºæ¥ï¼Œæ›´åŠ ä¸“æ³¨äºåŠŸèƒ½çš„å¼€å‘ã€‚</p>
<h1 id="å¦‚ä½•ä½¿ç”¨-NPMå¦‚ä½•ä½¿ç”¨-NPM"><a href="#å¦‚ä½•ä½¿ç”¨-NPMå¦‚ä½•ä½¿ç”¨-NPM" class="headerlink" title="å¦‚ä½•ä½¿ç”¨-NPMå¦‚ä½•ä½¿ç”¨ NPM"></a><a href="#å¦‚ä½•ä½¿ç”¨-NPM">å¦‚ä½•ä½¿ç”¨-NPM</a>å¦‚ä½•ä½¿ç”¨ NPM</h1><h2 id="å®‰è£…å®‰è£…"><a href="#å®‰è£…å®‰è£…" class="headerlink" title="å®‰è£…å®‰è£…"></a><a href="#å®‰è£…">å®‰è£…</a>å®‰è£…</h2><p><code>npm</code> ä¸éœ€è¦å•ç‹¬å®‰è£…ã€‚åœ¨å®‰è£… <code>Node</code> çš„æ—¶å€™ï¼Œä¼šè¿å¸¦ä¸€èµ·å®‰è£… <code>npm</code> ã€‚ä½†æ˜¯ï¼Œ<code>Node</code> é™„å¸¦çš„ <code>npm</code> å¯èƒ½ä¸æ˜¯æœ€æ–°ç‰ˆæœ¬ï¼Œæœ€åç”¨ä¸‹é¢çš„å‘½ä»¤ï¼Œæ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚</p>
<pre><code>$ sudo npm install npm@latest -g
</code></pre><p>å¦‚æœæ˜¯ Window ç³»ç»Ÿä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å³å¯ï¼š</p>
<pre><code>npm install npm -g
</code></pre><p>ä¹Ÿå°±æ˜¯ä½¿ç”¨ <code>npm</code> å®‰è£…è‡ªå·±ã€‚ä¹‹æ‰€ä»¥å¯ä»¥è¿™æ ·ï¼Œæ˜¯å› ä¸º <code>npm</code> æœ¬èº«ä¸ <code>Node</code> çš„å…¶ä»–æ¨¡å—æ²¡æœ‰åŒºåˆ«ã€‚</p>
<p>ç„¶åï¼Œè¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼ŒæŸ¥çœ‹å„ç§ä¿¡æ¯ã€‚</p>
<pre><code># æŸ¥çœ‹ npm å‘½ä»¤åˆ—è¡¨
$ npm help

# æŸ¥çœ‹å„ä¸ªå‘½ä»¤çš„ç®€å•ç”¨æ³•
$ npm -l

# æŸ¥çœ‹ npm çš„ç‰ˆæœ¬
$ npm -v

# æŸ¥çœ‹ npm çš„é…ç½®
$ npm config list -l
</code></pre><h2 id="ä½¿ç”¨ä½¿ç”¨"><a href="#ä½¿ç”¨ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨ä½¿ç”¨"></a><a href="#ä½¿ç”¨">ä½¿ç”¨</a>ä½¿ç”¨</h2><h3 id="npm-initnpm-init"><a href="#npm-initnpm-init" class="headerlink" title="npm-initnpm init"></a><a href="#npm-init">npm-init</a>npm init</h3><p><code>npm init</code> ç”¨æ¥åˆå§‹åŒ–ç”Ÿæˆä¸€ä¸ªæ–°çš„ <code>package.json</code> æ–‡ä»¶ã€‚å®ƒä¼šå‘ç”¨æˆ·æé—®ä¸€ç³»åˆ—é—®é¢˜ï¼Œå¦‚æœä½ è§‰å¾—ä¸ç”¨ä¿®æ”¹é»˜è®¤é…ç½®ï¼Œä¸€è·¯å›è½¦å°±å¯ä»¥äº†ã€‚<br>å¦‚æœä½¿ç”¨äº† <code>-f</code>ï¼ˆä»£è¡¨<code>force</code>ï¼‰ã€<code>-y</code>ï¼ˆä»£è¡¨<code>yes</code>ï¼‰ï¼Œåˆ™è·³è¿‡æé—®é˜¶æ®µï¼Œç›´æ¥ç”Ÿæˆä¸€ä¸ªæ–°çš„ <code>package.json</code> æ–‡ä»¶ã€‚</p>
<pre><code>$ npm init -y
</code></pre><h3 id="npm-setnpm-set"><a href="#npm-setnpm-set" class="headerlink" title="npm-setnpm set"></a><a href="#npm-set">npm-set</a>npm set</h3><p><code>npm set</code> ç”¨æ¥è®¾ç½®ç¯å¢ƒå˜é‡</p>
<pre><code>$ npm set init-author-name &apos;Your name&apos;
$ npm set init-author-email &apos;Your email&apos;
$ npm set init-author-url &apos;http://yourdomain.com&apos;
$ npm set init-license &apos;MIT&apos;
</code></pre><p>ä¸Šé¢å‘½ä»¤ç­‰äºä¸º <code>npm init</code> è®¾ç½®äº†é»˜è®¤å€¼ï¼Œä»¥åæ‰§è¡Œ <code>npm init</code> çš„æ—¶å€™ï¼Œ<code>package.json</code>çš„ä½œè€…å§“åã€é‚®ä»¶ã€ä¸»é¡µã€è®¸å¯è¯å­—æ®µå°±ä¼šè‡ªåŠ¨å†™å…¥é¢„è®¾çš„å€¼ã€‚è¿™äº›ä¿¡æ¯ä¼šå­˜æ”¾åœ¨ç”¨æˆ·ä¸»ç›®å½•çš„ <code>~/.npmrc</code>æ–‡ä»¶ï¼Œä½¿å¾—ç”¨æˆ·ä¸ç”¨æ¯ä¸ªé¡¹ç›®éƒ½è¾“å…¥ã€‚å¦‚æœæŸä¸ªé¡¹ç›®æœ‰ä¸åŒçš„è®¾ç½®ï¼Œå¯ä»¥é’ˆå¯¹è¯¥é¡¹ç›®è¿è¡Œ <code>npm config</code>ã€‚</p>
<h3 id="npm-infonpm-info"><a href="#npm-infonpm-info" class="headerlink" title="npm-infonpm info"></a><a href="#npm-info">npm-info</a>npm info</h3><p><code>npm info</code> å‘½ä»¤å¯ä»¥æŸ¥çœ‹æ¯ä¸ªæ¨¡å—çš„å…·ä½“ä¿¡æ¯ã€‚æ¯”å¦‚ï¼ŒæŸ¥çœ‹ <code>underscore</code> æ¨¡å—çš„ä¿¡æ¯ã€‚</p>
<pre><code>$ npm info underscore
</code></pre><p>ä¸Šé¢å‘½ä»¤è¿”å›ä¸€ä¸ª <code>JavaScript</code> å¯¹è±¡ï¼ŒåŒ…å«äº† <code>underscore</code> æ¨¡å—çš„è¯¦ç»†ä¿¡æ¯ã€‚è¿™ä¸ªå¯¹è±¡çš„æ¯ä¸ªæˆå‘˜ï¼Œéƒ½å¯ä»¥ç›´æ¥ä» <code>info</code> å‘½ä»¤æŸ¥è¯¢ã€‚</p>
<pre><code>$ npm info underscore description

$ npm info underscore homepage

$ npm info underscore version
</code></pre><h3 id="npm-searchnpm-search"><a href="#npm-searchnpm-search" class="headerlink" title="npm-searchnpm search"></a><a href="#npm-search">npm-search</a>npm search</h3><p><code>npm search</code> å‘½ä»¤ç”¨äºæœç´¢ <code>npm</code> ä»“åº“ï¼Œå®ƒåé¢å¯ä»¥è·Ÿå­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥è·Ÿæ­£åˆ™è¡¨è¾¾å¼ã€‚</p>
<pre><code>$ npm search &lt;æœç´¢è¯&gt;
</code></pre><h3 id="npm-listnpm-list"><a href="#npm-listnpm-list" class="headerlink" title="npm-listnpm list"></a><a href="#npm-list">npm-list</a>npm list</h3><p><code>npm list</code> å‘½ä»¤ä»¥æ ‘å½¢ç»“æ„åˆ—å‡ºå½“å‰é¡¹ç›®å®‰è£…çš„æ‰€æœ‰æ¨¡å—ï¼Œä»¥åŠå®ƒä»¬ä¾èµ–çš„æ¨¡å—ã€‚</p>
<pre><code>$ npm list

# åŠ ä¸Š global å‚æ•°ï¼Œä¼šåˆ—å‡ºå…¨å±€å®‰è£…çš„æ¨¡å—
$ npm list -global

# npm list å‘½ä»¤ä¹Ÿå¯ä»¥åˆ—å‡ºå•ä¸ªæ¨¡å—
$ npm list underscore
</code></pre><h3 id="npm-installnpm-install"><a href="#npm-installnpm-install" class="headerlink" title="npm-installnpm install"></a><a href="#npm-install">npm-install</a>npm install</h3><p>ä½¿ç”¨ <code>npm</code> å®‰è£…åŒ…çš„å‘½ä»¤æ ¼å¼ä¸ºï¼š<code>npm [install/i] [package_name]</code></p>
<h4 id="æœ¬åœ°æ¨¡å¼å’Œå…¨å±€æ¨¡å¼æœ¬åœ°æ¨¡å¼å’Œå…¨å±€æ¨¡å¼"><a href="#æœ¬åœ°æ¨¡å¼å’Œå…¨å±€æ¨¡å¼æœ¬åœ°æ¨¡å¼å’Œå…¨å±€æ¨¡å¼" class="headerlink" title="æœ¬åœ°æ¨¡å¼å’Œå…¨å±€æ¨¡å¼æœ¬åœ°æ¨¡å¼å’Œå…¨å±€æ¨¡å¼"></a><a href="#æœ¬åœ°æ¨¡å¼å’Œå…¨å±€æ¨¡å¼">æœ¬åœ°æ¨¡å¼å’Œå…¨å±€æ¨¡å¼</a>æœ¬åœ°æ¨¡å¼å’Œå…¨å±€æ¨¡å¼</h4><p><code>npm</code> åœ¨é»˜è®¤æƒ…å†µä¸‹ä¼šä» <a href="http://npmjs.org" target="_blank" rel="noopener">NPM</a> æœç´¢æˆ–ä¸‹è½½åŒ…ï¼Œå°†åŒ…å®‰è£…åˆ°å½“å‰ç›®å½•çš„ <code>node_modules</code> å­ç›®å½•ä¸‹ã€‚</p>
<p>å¦‚æœä½ ç†Ÿæ‚‰ <code>Ruby</code> çš„ <code>gem</code> æˆ–è€… <code>Python</code> çš„ <code>pip</code> ï¼Œä½ ä¼šå‘ç° <code>npm</code> ä¸å®ƒä»¬çš„è¡Œä¸ºä¸åŒï¼Œ <code>gem</code> æˆ– <code>pip</code> æ€»æ˜¯ä»¥å…¨å±€æ¨¡å¼å®‰è£…ï¼Œä½¿åŒ…å¯ä»¥ä¾›æ‰€æœ‰çš„ç¨‹åºä½¿ç”¨ï¼Œè€Œ <code>npm</code> é»˜è®¤ä¼šæŠŠåŒ…å®‰è£…åˆ°å½“å‰ç›®å½•ä¸‹ã€‚è¿™åæ˜ äº† <code>npm</code> ä¸åŒçš„è®¾è®¡å“²å­¦ã€‚å¦‚æœæŠŠåŒ…å®‰è£…åˆ°å…¨å±€ï¼Œå¯ä»¥æä¾›ç¨‹åºçš„é‡å¤åˆ©ç”¨ç¨‹åº¦ï¼Œé¿å…åŒæ ·çš„å†…å®¹çš„å¤šåˆ†å‰¯æœ¬ï¼Œä½†åå¤„æ˜¯éš¾ä»¥å¤„ç†ä¸åŒçš„ç‰ˆæœ¬ä¾èµ–ã€‚å¦‚æœæŠŠåŒ…å®‰è£…åˆ°å½“å‰ç›®å½•ï¼Œæˆ–è€…è¯´æœ¬åœ°ï¼Œåˆ™ä¸ä¼šæœ‰ä¸åŒç¨‹åºä¾èµ–ä¸åŒç‰ˆæœ¬çš„åŒ…çš„å†²çªé—®é¢˜ï¼ŒåŒæ—¶è¿˜å‡è½»äº†åŒ…ä½œè€…çš„ <code>API</code> å…¼å®¹æ€§å‹åŠ›ï¼Œä½†ç¼ºé™·åˆ™æ˜¯åŒä¸€ä¸ªåŒ…å¯èƒ½ä¼šè¢«å®‰è£…è®¸å¤šæ¬¡ã€‚</p>
<p>æˆ‘ä»¬åœ¨ä½¿ç”¨ <code>supervisor</code> çš„æ—¶å€™ä½¿ç”¨äº† <code>npm install -g supervisor</code> å‘½ä»¤ï¼Œå°±æ˜¯ä»¥å…¨å±€æ¨¡å¼å®‰è£… <code>supervisor</code> ã€‚</p>
<p>è¿™é‡Œæ³¨æ„ä¸€ç‚¹çš„å°±æ˜¯ï¼Œ <code>supervisor</code> å¿…é¡»å®‰è£…åˆ°å…¨å±€ï¼Œå¦‚æœä½ ä¸å®‰è£…åˆ°å…¨å±€ï¼Œé”™è¯¯å‘½ä»¤ä¼šæç¤ºä½ å®‰è£…åˆ°å…¨å±€ã€‚å¦‚æœä¸æƒ³å®‰è£…åˆ°é»˜è®¤çš„å…¨å±€ï¼Œä¹Ÿå¯ä»¥è‡ªå·±ä¿®æ”¹å…¨å±€è·¯å¾„åˆ°å½“å‰è·¯å¾„ <code>npm config set prefix &quot;è·¯å¾„&quot;</code> å®‰è£…å®Œä»¥åå°±å¯ä»¥ç”¨ <code>supervisor</code> æ¥å¯åŠ¨æœåŠ¡äº†ã€‚<br><code>supervisor</code> å¯ä»¥å¸®åŠ©ä½ å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œå®ƒä¼šç›‘è§†ä½ å¯¹ä»£ç çš„é©±åŠ¨ï¼Œå¹¶è‡ªåŠ¨é‡å¯ <code>Node</code> ã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œå…¨å±€å®‰è£…åªé€‚ç”¨äºå·¥å…·æ¨¡å—ï¼Œæ¯”å¦‚ <code>eslint</code> å’Œ <code>gulp</code> ã€‚å…³äºä½¿ç”¨å…¨å±€æ¨¡å¼ï¼Œå¤šæ•°æ—¶å€™å¹¶ä¸æ˜¯å› ä¸ºè®¸å¤šç¨‹åºéƒ½æœ‰å¯èƒ½ç”¨åˆ°äº†å®ƒï¼Œä¸ºäº†å‡å°‘å¤šé‡å‰¯æœ¬è€Œä½¿ç”¨å…¨å±€æ¨¡å¼ï¼Œè€Œæ˜¯å› ä¸º <strong>æœ¬åœ°æ¨¡å¼ä¸ä¼šæ³¨å†Œ <code>PATH</code> ç¯å¢ƒå˜é‡</strong>ã€‚<br>â€œæœ¬åœ°å®‰è£…â€æŒ‡çš„æ˜¯å°†ä¸€ä¸ªæ¨¡å—ä¸‹è½½åˆ°å½“å‰é¡¹ç›®çš„ <code>node_modules</code> å­ç›®å½•ï¼Œç„¶ååªæœ‰åœ¨é¡¹ç›®ç›®å½•ä¹‹ä¸­ï¼Œæ‰èƒ½è°ƒç”¨è¿™ä¸ªæ¨¡å—ã€‚</p>
<p>æœ¬åœ°æ¨¡å¼å’Œå…¨å±€æ¨¡å¼çš„ç‰¹ç‚¹å¦‚ä¸‹ï¼š<br>æ¨¡å¼å¯é€šè¿‡ require ä½¿ç”¨æ³¨å†Œ PATHæœ¬åœ°æ¨¡å¼æ˜¯å¦å…¨å±€æ¨¡å¼å¦æ˜¯</p>
<pre><code># æœ¬åœ°å®‰è£…
$ npm install &lt;package name&gt;

# å…¨å±€å®‰è£…
$ sudo npm install -global &lt;package name&gt;
$ sudo npm install -g &lt;package name&gt;
</code></pre><p><code>npm install</code> ä¹Ÿæ”¯æŒç›´æ¥è¾“å…¥ <code>Github</code> ä»£ç åº“åœ°å€ã€‚</p>
<pre><code>$ npm install git://github.com/package/path.git
$ npm install git://github.com/package/path.git#0.1.0
</code></pre><p>å®‰è£…ä¹‹å‰ï¼Œ<code>npm install</code> ä¼šå…ˆæ£€æŸ¥ï¼Œ<code>node_modules</code> ç›®å½•ä¹‹ä¸­æ˜¯å¦å·²ç»å­˜åœ¨æŒ‡å®šæ¨¡å—ã€‚å¦‚æœå­˜åœ¨ï¼Œå°±ä¸å†é‡æ–°å®‰è£…äº†ï¼Œå³ä½¿è¿œç¨‹ä»“åº“å·²ç»æœ‰äº†ä¸€ä¸ªæ–°ç‰ˆæœ¬ï¼Œä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p>
<p>å¦‚æœä½ å¸Œæœ›ï¼Œä¸€ä¸ªæ¨¡å—ä¸ç®¡æ˜¯å¦å®‰è£…è¿‡ï¼Œ <code>npm</code> éƒ½è¦å¼ºåˆ¶é‡æ–°å®‰è£…ï¼Œå¯ä»¥ä½¿ç”¨ <code>-f</code> æˆ– <code>--force</code> å‚æ•°ã€‚</p>
<pre><code>$ npm install &lt;packageName&gt; --force
</code></pre><h4 id="å®‰è£…ä¸åŒç‰ˆæœ¬å®‰è£…ä¸åŒç‰ˆæœ¬"><a href="#å®‰è£…ä¸åŒç‰ˆæœ¬å®‰è£…ä¸åŒç‰ˆæœ¬" class="headerlink" title="å®‰è£…ä¸åŒç‰ˆæœ¬å®‰è£…ä¸åŒç‰ˆæœ¬"></a><a href="#å®‰è£…ä¸åŒç‰ˆæœ¬">å®‰è£…ä¸åŒç‰ˆæœ¬</a>å®‰è£…ä¸åŒç‰ˆæœ¬</h4><p><code>install</code> å‘½ä»¤æ€»æ˜¯å®‰è£…æ¨¡å—çš„æœ€æ–°ç‰ˆæœ¬ï¼Œå¦‚æœè¦å®‰è£…æ¨¡å—çš„ç‰¹å®šç‰ˆæœ¬ï¼Œå¯ä»¥åœ¨æ¨¡å—ååé¢åŠ ä¸Š <code>@</code> å’Œç‰ˆæœ¬å·ã€‚</p>
<pre><code>$ npm install sax@latest
$ npm install sax@0.1.1
$ npm install sax@&quot;&gt;=0.1.0 &lt;0.2.0&quot;
</code></pre><p><code>install</code> å‘½ä»¤å¯ä»¥ä½¿ç”¨ä¸åŒå‚æ•°ï¼ŒæŒ‡å®šæ‰€å®‰è£…çš„æ¨¡å—å±äºå“ªä¸€ç§æ€§è´¨çš„ä¾èµ–å…³ç³»ï¼Œå³å‡ºç°åœ¨ <code>packages.json</code> æ–‡ä»¶çš„å“ªä¸€é¡¹ä¸­ã€‚</p>
<blockquote>
<p>â€“saveï¼šæ¨¡å—åå°†è¢«æ·»åŠ åˆ° dependenciesï¼Œå¯ä»¥ç®€åŒ–ä¸ºå‚æ•°-Sã€‚<br>â€“save-devï¼šæ¨¡å—åå°†è¢«æ·»åŠ åˆ° devDependenciesï¼Œå¯ä»¥ç®€åŒ–ä¸ºå‚æ•°-Dã€‚</p>
</blockquote>
<pre><code>$ npm install sax --save
$ npm install node-tap --save-dev
# æˆ–è€…
$ npm install sax -S
$ npm install node-tap -D
</code></pre><h5 id="dependencies-ä¾èµ–dependencies-ä¾èµ–"><a href="#dependencies-ä¾èµ–dependencies-ä¾èµ–" class="headerlink" title="dependencies-ä¾èµ–dependencies ä¾èµ–"></a><a href="#dependencies-ä¾èµ–">dependencies-ä¾èµ–</a>dependencies ä¾èµ–</h5><p>è¿™ä¸ªå¯ä»¥è¯´æ˜¯æˆ‘ä»¬ <code>npm</code> æ ¸å¿ƒä¸€é¡¹å†…å®¹ï¼Œä¾èµ–ç®¡ç†ï¼Œè¿™ä¸ªå¯¹è±¡é‡Œé¢çš„å†…å®¹å°±æ˜¯æˆ‘ä»¬è¿™ä¸ªé¡¹ç›®æ‰€ä¾èµ–çš„ <code>js</code> æ¨¡å—åŒ…ã€‚ä¸‹é¢è¿™æ®µä»£ç è¡¨ç¤ºæˆ‘ä»¬ä¾èµ–äº† <code>markdown-it</code> è¿™ä¸ªåŒ…ï¼Œç‰ˆæœ¬æ˜¯ <code>^8.1.0</code> ï¼Œä»£è¡¨æœ€å°ä¾èµ–ç‰ˆæœ¬æ˜¯ <code>8.1.0</code> ï¼Œå¦‚æœè¿™ä¸ªåŒ…æœ‰æ›´æ–°ï¼Œé‚£ä¹ˆå½“æˆ‘ä»¬ä½¿ç”¨ <code>npm install</code> å‘½ä»¤çš„æ—¶å€™ï¼Œ <code>npm</code> ä¼šå¸®æˆ‘ä»¬ä¸‹è½½æœ€æ–°çš„åŒ…ã€‚å½“åˆ«äººå¼•ç”¨æˆ‘ä»¬è¿™ä¸ªåŒ…çš„æ—¶å€™ï¼ŒåŒ…å†…çš„ä¾èµ–åŒ…ä¹Ÿä¼šè¢«ä¸‹è½½ä¸‹æ¥ã€‚</p>
<pre><code>&quot;dependencies&quot;: {
&quot;markdown-it&quot;: &quot;^8.1.0&quot;
}
</code></pre><h5 id="devDependencies-å¼€å‘ä¾èµ–devDependencies-å¼€å‘ä¾èµ–"><a href="#devDependencies-å¼€å‘ä¾èµ–devDependencies-å¼€å‘ä¾èµ–" class="headerlink" title="devDependencies-å¼€å‘ä¾èµ–devDependencies å¼€å‘ä¾èµ–"></a><a href="#devDependencies-å¼€å‘ä¾èµ–">devDependencies-å¼€å‘ä¾èµ–</a>devDependencies å¼€å‘ä¾èµ–</h5><p>åœ¨æˆ‘ä»¬å¼€å‘çš„æ—¶å€™ä¼šç”¨åˆ°çš„ä¸€äº›åŒ…ï¼Œåªæ˜¯åœ¨å¼€å‘ç¯å¢ƒä¸­éœ€è¦ç”¨åˆ°ï¼Œä½†æ˜¯åœ¨åˆ«äººå¼•ç”¨æˆ‘ä»¬åŒ…çš„æ—¶å€™ï¼Œä¸ä¼šç”¨åˆ°è¿™äº›å†…å®¹ï¼Œæ”¾åœ¨ <code>devDependencies</code> çš„åŒ…ï¼Œåœ¨åˆ«äººå¼•ç”¨çš„æ—¶å€™ä¸ä¼šè¢« <code>npm</code> ä¸‹è½½ã€‚</p>
<pre><code>&quot;devDependencies&quot;: {
&quot;autoprefixer&quot;: &quot;^6.4.0&quot;,
&quot;babel-preset-es2015&quot;: &quot;^6.0.0&quot;,
&quot;babel-preset-stage-2&quot;: &quot;^6.0.0&quot;,
&quot;babel-register&quot;: &quot;^6.0.0&quot;,
&quot;webpack&quot;: &quot;^1.13.2&quot;,
&quot;webpack-dev-middleware&quot;: &quot;^1.8.3&quot;,
&quot;webpack-hot-middleware&quot;: &quot;^2.12.2&quot;,
&quot;webpack-merge&quot;: &quot;^0.14.1&quot;,
&quot;highlightjs&quot;: &quot;^9.8.0&quot;
}
</code></pre><p>å½“ä½ æœ‰äº†ä¸€ä¸ªå®Œæ•´çš„ <code>package.json</code>æ–‡ä»¶çš„æ—¶å€™ï¼Œå°±å¯ä»¥è®©äººä¸€çœ¼çœ‹å‡ºæ¥ï¼Œè¿™ä¸ªæ¨¡å—çš„åŸºæœ¬ä¿¡æ¯ï¼Œå’Œè¿™ä¸ªæ¨¡å—æ‰€éœ€è¦ä¾èµ–çš„åŒ…ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>npm install</code> å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„ä¸‹è½½å¥½è¿™ä¸ªæ¨¡å—æ‰€éœ€è¦çš„åŒ…ã€‚</p>
<p><code>npm install</code> é»˜è®¤ä¼šå®‰è£… <code>dependencies</code> å­—æ®µå’Œ <code>devDependencies</code> å­—æ®µä¸­çš„æ‰€æœ‰æ¨¡å—ï¼Œå¦‚æœä½¿ç”¨ <code>--production</code> å‚æ•°ï¼Œå¯ä»¥åªå®‰è£… <code>dependencies</code> å­—æ®µçš„æ¨¡å—ã€‚</p>
<pre><code>$ npm install --production
# æˆ–è€…
$ NODE_ENV=production npm install
</code></pre><p>ä¸€æ—¦å®‰è£…äº†æŸä¸ªæ¨¡å—ï¼Œå°±å¯ä»¥åœ¨ä»£ç ä¸­ç”¨ <code>require</code> å‘½ä»¤åŠ è½½è¿™ä¸ªæ¨¡å—ã€‚</p>
<pre><code>var backbone = require(&apos;backbone&apos;)
console.log(backbone.VERSION)
</code></pre><h3 id="npm-runnpm-run"><a href="#npm-runnpm-run" class="headerlink" title="npm-runnpm run"></a><a href="#npm-run">npm-run</a>npm run</h3><p><code>npm</code> ä¸ä»…å¯ä»¥ç”¨äºæ¨¡å—ç®¡ç†ï¼Œè¿˜å¯ä»¥ç”¨äºæ‰§è¡Œè„šæœ¬ã€‚<code>package.json</code> æ–‡ä»¶æœ‰ä¸€ä¸ª <code>scripts</code> å­—æ®µï¼Œå¯ä»¥ç”¨äºæŒ‡å®šè„šæœ¬å‘½ä»¤ï¼Œä¾› <code>npm</code> ç›´æ¥è°ƒç”¨ã€‚<br><code>package.json</code> æ–‡ä»¶å†…å®¹ï¼š</p>
<pre><code>{
&quot;name&quot;: &quot;myproject&quot;,
&quot;devDependencies&quot;: {
&quot;jshint&quot;: &quot;latest&quot;,
&quot;browserify&quot;: &quot;latest&quot;,
&quot;mocha&quot;: &quot;latest&quot;
  },
&quot;scripts&quot;: {
&quot;lint&quot;: &quot;jshint **.js&quot;,
&quot;test&quot;: &quot;mocha test/&quot;
  }
}
</code></pre><h4 id="scripts-è„šæœ¬scripts-è„šæœ¬"><a href="#scripts-è„šæœ¬scripts-è„šæœ¬" class="headerlink" title="scripts-è„šæœ¬scripts è„šæœ¬"></a><a href="#scripts-è„šæœ¬">scripts-è„šæœ¬</a>scripts è„šæœ¬</h4><p>é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ä¸€äº›è„šæœ¬ä»£ç ï¼Œå¯ä»¥é€šè¿‡ <code>npm run script-key</code> æ¥è°ƒç”¨ï¼Œä¾‹å¦‚åœ¨è¿™ä¸ª <code>package.json</code> çš„æ–‡ä»¶å¤¹ä¸‹ä½¿ç”¨ <code>npm run dev</code> å°±ç›¸å½“äºè¿è¡Œäº† <code>node build/dev-server.js</code> è¿™ä¸€æ®µä»£ç ã€‚ä½¿ç”¨ <code>scripts</code> çš„ç›®çš„å°±æ˜¯ä¸ºäº†æŠŠä¸€äº›è¦æ‰§è¡Œçš„ä»£ç åˆå¹¶åˆ°ä¸€èµ·ï¼Œä½¿ç”¨ npm run æ¥å¿«é€Ÿçš„è¿è¡Œï¼Œæ–¹ä¾¿çœäº‹ã€‚<br><code>npm run</code> æ˜¯ <code>npm run-script</code> çš„ç¼©å†™ï¼Œä¸€èˆ¬éƒ½ä½¿ç”¨å‰è€…ï¼Œä½†æ˜¯åè€…å¯ä»¥æ›´å¥½çš„ååº”è¿™ä¸ªå‘½ä»¤çš„æœ¬è´¨ã€‚</p>
<pre><code>// è„šæœ¬
&quot;scripts&quot;: {
&quot;dev&quot;: &quot;node build/dev-server.js&quot;,
&quot;build&quot;: &quot;node build/build.js&quot;,
&quot;docs&quot;: &quot;node build/docs.js&quot;,
&quot;build-docs&quot;: &quot;npm run docs &amp; git checkout gh-pages &amp; xcopy /sy dist\\* . &amp; git add . &amp; git commit -m &apos;auto-pages&apos; &amp; git push &amp; git checkout master&quot;,
&quot;build-publish&quot;: &quot;rmdir /S /Q lib &amp; npm run build &amp;git add . &amp; git commit -m auto-build &amp; npm version patch &amp; npm publish &amp; git push&quot;,
&quot;lint&quot;: &quot;eslint --ext .js,.vue src&quot;
}
</code></pre><p><code>npm run</code> å¦‚æœä¸åŠ ä»»ä½•å‚æ•°ï¼Œç›´æ¥è¿è¡Œï¼Œä¼šåˆ—å‡º <code>package.json</code> é‡Œé¢æ‰€æœ‰å¯ä»¥æ‰§è¡Œçš„è„šæœ¬å‘½ä»¤ã€‚<br><code>npm</code> å†…ç½®äº†ä¸¤ä¸ªå‘½ä»¤ç®€å†™ï¼Œ <code>npm test</code> ç­‰åŒäºæ‰§è¡Œ <code>npm run test</code> ï¼Œ<code>npm start</code> ç­‰åŒäºæ‰§è¡Œ <code>npm run start</code>ã€‚</p>
<pre><code>&quot;build&quot;: &quot;npm run build-js &amp;&amp; npm run build-css&quot;
</code></pre><p>ä¸Šé¢çš„å†™æ³•æ˜¯å…ˆè¿è¡Œ <code>npm run build-js</code> ï¼Œç„¶åå†è¿è¡Œ <code>npm run build-css</code> ï¼Œä¸¤ä¸ªå‘½ä»¤ä¸­é—´ç”¨ <code>&amp;&amp;</code> è¿æ¥ã€‚å¦‚æœå¸Œæœ›ä¸¤ä¸ªå‘½ä»¤åŒæ—¶å¹³è¡Œæ‰§è¡Œï¼Œå®ƒä»¬ä¸­é—´å¯ä»¥ç”¨ <code>&amp;</code> è¿æ¥ã€‚</p>
<p>å†™åœ¨ <code>scripts</code> å±æ€§ä¸­çš„å‘½ä»¤ï¼Œä¹Ÿå¯ä»¥åœ¨ <code>node_modules/.bin</code> ç›®å½•ä¸­ç›´æ¥å†™æˆ <code>bash</code> è„šæœ¬ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ª <code>bash</code> è„šæœ¬ã€‚</p>
<pre><code>#!/bin/bash

cd site/main
browserify browser/main.js | uglifyjs -mc &gt; static/bundle.js
</code></pre><p>å‡å®šä¸Šé¢çš„è„šæœ¬æ–‡ä»¶åä¸º <code>build.sh</code> ï¼Œå¹¶ä¸”æƒé™ä¸ºå¯æ‰§è¡Œï¼Œå°±å¯ä»¥åœ¨ <code>scripts</code> å±æ€§ä¸­å¼•ç”¨è¯¥æ–‡ä»¶ã€‚</p>
<pre><code>&quot;build-js&quot;: &quot;bin/build.sh&quot;
</code></pre><h3 id="pre-å’Œ-post-è„šæœ¬pre-å’Œ-post-è„šæœ¬"><a href="#pre-å’Œ-post-è„šæœ¬pre-å’Œ-post-è„šæœ¬" class="headerlink" title="pre-å’Œ-post-è„šæœ¬pre- å’Œ post- è„šæœ¬"></a><a href="#pre-å’Œ-post-è„šæœ¬">pre-å’Œ-post-è„šæœ¬</a>pre- å’Œ post- è„šæœ¬</h3><p><code>npm run</code> ä¸ºæ¯æ¡å‘½ä»¤æä¾›äº† <code>pre-</code> å’Œ <code>post-</code> ä¸¤ä¸ªé’©å­ï¼ˆ <code>hook</code> ï¼‰ã€‚ä»¥ <code>npm run lint</code> ä¸ºä¾‹ï¼Œæ‰§è¡Œè¿™æ¡å‘½ä»¤ä¹‹å‰ï¼Œ <code>npm</code> ä¼šå…ˆæŸ¥çœ‹æœ‰æ²¡æœ‰å®šä¹‰ <code>prelint</code> å’Œ <code>postlint</code> ä¸¤ä¸ªé’©å­ï¼Œå¦‚æœæœ‰çš„è¯ï¼Œå°±ä¼šå…ˆæ‰§è¡Œ <code>npm run prelint</code> ï¼Œç„¶åæ‰§è¡Œ <code>npm run lint</code> ï¼Œæœ€åæ‰§è¡Œ <code>npm run postlint</code> ã€‚</p>
<pre><code>{
&quot;name&quot;: &quot;myproject&quot;,
&quot;devDependencies&quot;: {
&quot;eslint&quot;: &quot;latest&quot;
&quot;karma&quot;: &quot;latest&quot;
  },
&quot;scripts&quot;: {
&quot;lint&quot;: &quot;eslint --cache --ext .js --ext .jsx src&quot;,
&quot;test&quot;: &quot;karma start --log-leve=error karma.config.js --single-run=true&quot;,
&quot;pretest&quot;: &quot;npm run lint&quot;,
&quot;posttest&quot;: &quot;echo &apos;Finished running tests&apos;&quot;
  }
}
</code></pre><p>ä¸Šé¢ä»£ç æ˜¯ä¸€ä¸ª <code>package.json</code> æ–‡ä»¶çš„ä¾‹å­ã€‚å¦‚æœæ‰§è¡Œ <code>npm test</code>ï¼Œä¼šæŒ‰ä¸‹é¢çš„é¡ºåºæ‰§è¡Œç›¸åº”çš„å‘½ä»¤ã€‚</p>
<ol>
<li><code>pretest</code></li>
<li><code>test</code></li>
<li><code>posttest</code></li>
</ol>
<p>å¦‚æœæ‰§è¡Œè¿‡ç¨‹å‡ºé”™ï¼Œå°±ä¸ä¼šæ‰§è¡Œæ’åœ¨åé¢çš„è„šæœ¬ï¼Œå³å¦‚æœ <code>prelint</code> è„šæœ¬æ‰§è¡Œå‡ºé”™ï¼Œå°±ä¸ä¼šæ¥ç€æ‰§è¡Œ <code>lint</code> å’Œ <code>postlint</code> è„šæœ¬ã€‚</p>
<h3 id="npm-binnpm-bin"><a href="#npm-binnpm-bin" class="headerlink" title="npm-binnpm bin"></a><a href="#npm-bin">npm-bin</a>npm bin</h3><p><code>npm bin</code> å‘½ä»¤æ˜¾ç¤ºç›¸å¯¹äºå½“å‰ç›®å½•çš„ï¼Œ<code>Node</code> æ¨¡å—çš„å¯æ‰§è¡Œè„šæœ¬æ‰€åœ¨çš„ç›®å½•ï¼ˆå³ <code>.bin</code> ç›®å½•ï¼‰ã€‚</p>
<pre><code># é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œ
$ npm bin
./node_modules/.bin
</code></pre><h1 id="åˆ›å»ºå…¨å±€é“¾æ¥åˆ›å»ºå…¨å±€é“¾æ¥"><a href="#åˆ›å»ºå…¨å±€é“¾æ¥åˆ›å»ºå…¨å±€é“¾æ¥" class="headerlink" title="åˆ›å»ºå…¨å±€é“¾æ¥åˆ›å»ºå…¨å±€é“¾æ¥"></a><a href="#åˆ›å»ºå…¨å±€é“¾æ¥">åˆ›å»ºå…¨å±€é“¾æ¥</a>åˆ›å»ºå…¨å±€é“¾æ¥</h1><p><code>npm</code> æä¾›äº†ä¸€ä¸ªæœ‰è¶£çš„å‘½ä»¤ <code>npm link</code>ï¼Œå®ƒçš„åŠŸèƒ½æ˜¯åœ¨æœ¬åœ°åŒ…å’Œå…¨å±€åŒ…ä¹‹é—´åˆ›å»ºç¬¦å·é“¾æ¥ã€‚æˆ‘ä»¬è¯´è¿‡ä½¿ç”¨å…¨å±€æ¨¡å¼å®‰è£…çš„åŒ…ä¸èƒ½ç›´æ¥é€šè¿‡ <code>require</code> ä½¿ç”¨ã€‚ä½†é€šè¿‡ <code>npm link</code> å‘½ä»¤å¯ä»¥æ‰“ç ´è¿™ä¸€é™åˆ¶ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å·²ç»é€šè¿‡ <code>npm install -g express</code> å®‰è£…äº† <code>express</code> ï¼Œè¿™æ—¶åœ¨å·¥ç¨‹çš„ç›®å½•ä¸‹è¿è¡Œå‘½ä»¤ï¼š<code>npm link express ./node_modules/express -&gt; /user/local/lib/node_modules/express</code><br>æˆ‘ä»¬å¯ä»¥åœ¨ <code>node_modules</code> å­ç›®å½•ä¸­å‘ç°ä¸€ä¸ªæŒ‡å‘å®‰è£…åˆ°å…¨å±€çš„åŒ…çš„ç¬¦å·é“¾æ¥ã€‚é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠå…¨å±€åŒ…å½“åšæœ¬åœ°åŒ…æ¥ä½¿ç”¨äº†ã€‚<br>é™¤äº†å°†å…¨å±€çš„åŒ…é“¾æ¥åˆ°æœ¬åœ°ä»¥å¤–ï¼Œä½¿ç”¨ <code>npm link</code> å‘½ä»¤è¿˜å¯ä»¥å°†æœ¬åœ°çš„åŒ…é“¾æ¥åˆ°å…¨å±€ã€‚ä½¿ç”¨æ–¹æ³•æ˜¯åœ¨åŒ…ç›®å½•ï¼ˆ<code>package.json</code> æ‰€åœ¨ç›®å½•ï¼‰ä¸­è¿è¡Œ <code>npm link</code> å‘½ä»¤ã€‚å¦‚æœæˆ‘ä»¬è¦å¼€å‘ä¸€ä¸ªåŒ…ï¼Œåˆ©ç”¨è¿™ç§æ–¹æ³•å¯ä»¥éå¸¸æ–¹ä¾¿åœ°åœ¨ä¸åŒçš„å·¥ç¨‹é—´è¿›è¡Œæµ‹è¯•ã€‚</p>
<h1 id="åˆ›å»ºåŒ…åˆ›å»ºåŒ…"><a href="#åˆ›å»ºåŒ…åˆ›å»ºåŒ…" class="headerlink" title="åˆ›å»ºåŒ…åˆ›å»ºåŒ…"></a><a href="#åˆ›å»ºåŒ…">åˆ›å»ºåŒ…</a>åˆ›å»ºåŒ…</h1><p>åŒ…æ˜¯åœ¨æ¨¡å—åŸºç¡€ä¸Šæ›´æ·±ä¸€æ­¥çš„æŠ½è±¡ï¼Œ<code>Node</code> çš„åŒ…ç±»ä¼¼äº <code>C/C++</code> çš„å‡½æ•°åº“æˆ–è€… <code>Java</code> ã€<code>.Net</code> çš„ç±»åº“ã€‚å®ƒå°†æŸä¸ªç‹¬ç«‹çš„åŠŸèƒ½å°è£…èµ·æ¥ï¼Œç”¨äºå‘å¸ƒã€æ›´æ–°ã€ä¾èµ–ç®¡ç†å’Œç‰ˆæœ¬æ§åˆ¶ã€‚<code>Node</code> æ ¹æ® <code>CommonJS</code> è§„èŒƒå®ç°äº†åŒ…æœºåˆ¶ï¼Œå¼€å‘äº† <code>npm</code> æ¥è§£å†³åŒ…çš„å‘å¸ƒå’Œè·å–éœ€æ±‚ã€‚<br><code>Node</code> çš„åŒ…æ˜¯ä¸€ä¸ªç›®å½•ï¼Œå…¶ä¸­åŒ…å«äº†ä¸€ä¸ª <code>JSON</code> æ ¼å¼çš„åŒ…è¯´æ˜æ–‡ä»¶ <code>package.json</code>ã€‚ä¸¥æ ¼ç¬¦åˆ <code>CommonJS</code> è§„èŒƒçš„åŒ…åº”è¯¥å…·å¤‡ä»¥ä¸‹ç‰¹å¾ï¼š</p>
<ul>
<li><code>package.json</code> å¿…é¡»åœ¨åŒ…çš„é¡¶å±‚ç›®å½•ä¸‹ï¼›</li>
<li>äºŒè¿›åˆ¶æ–‡ä»¶åº”è¯¥åœ¨ <code>bin</code> ç›®å½•ä¸‹ï¼›</li>
<li><code>JavaScript</code> ä»£ç åº”è¯¥åœ¨ <code>lib</code> ç›®å½•ä¸‹ï¼›</li>
<li>æ–‡æ¡£åº”è¯¥åœ¨ <code>doc</code> ç›®å½•ä¸‹ï¼›</li>
<li>å•å…ƒæµ‹è¯•åº”è¯¥åœ¨ <code>test</code> ç›®å½•ä¸‹ã€‚</li>
</ul>
<p><code>Node</code> å¯¹åŒ…çš„è¦æ±‚å¹¶æ²¡æœ‰è¿™ä¹ˆä¸¥æ ¼ï¼Œåªè¦é¡¶å±‚ç›®å½•ä¸‹æœ‰ <code>package.json</code>ï¼Œå¹¶ç¬¦åˆä¸€äº›è§„èŒƒå³å¯ã€‚å½“ç„¶ä¸ºäº†æé«˜å…¼å®¹æ€§ï¼Œæˆ‘ä»¬è¿˜æ˜¯å»ºè®®ä½ åœ¨åˆ¶ä½œåŒ…çš„æ—¶å€™ï¼Œä¸¥æ ¼éµå®ˆ <code>CommonJS</code> è§„èŒƒã€‚</p>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠæ–‡ä»¶å¤¹å°è£…ä¸ºä¸€ä¸ªæ¨¡å—ï¼Œå³æ‰€è°“çš„åŒ…ã€‚åŒ…é€šå¸¸æ˜¯ä¸€äº›æ¨¡å—çš„é›†åˆï¼Œåœ¨æ¨¡å—çš„åŸºç¡€ä¸Šæä¾›äº†æ›´é«˜å±‚çš„æŠ½è±¡ï¼Œç›¸å½“äºæä¾›äº†ä¸€äº›å›ºå®šæ¥å£çš„å‡½æ•°åº“ã€‚é€šè¿‡å®šåˆ¶ <code>package.json</code>ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºæ›´å¤æ‚ï¼Œæ›´å®Œå–„ï¼Œæ›´ç¬¦åˆè§„èŒƒçš„åŒ…ç”¨äºå‘å¸ƒã€‚</p>
<p><code>Node</code> åœ¨è°ƒç”¨æŸä¸ªåŒ…æ—¶ï¼Œä¼šé¦–å…ˆæ£€æŸ¥åŒ…ä¸­ <code>packgage.json</code> æ–‡ä»¶çš„ <code>main</code> å­—æ®µï¼Œå°†å…¶ä½œä¸ºåŒ…çš„æ¥å£æ¨¡å—ï¼Œå¦‚æœ <code>package.json</code> æˆ– <code>main</code> å­—æ®µä¸å­˜åœ¨ï¼Œä¼šå°è¯•å¯»æ‰¾ index.js æˆ– index.node ä½œä¸ºåŒ…çš„æ¥å£ã€‚</p>
<p><code>package.json</code> æ˜¯ <code>CommonJS</code> è§„å®šçš„ç”¨æ¥æè¿°åŒ…çš„æ–‡ä»¶ï¼Œå®Œå…¨ç¬¦åˆè§„èŒƒçš„ <code>package.json</code> æ–‡ä»¶åº”è¯¥å«æœ‰ä»¥ä¸‹å­—æ®µï¼š<br>name: åŒ…çš„åå­—ï¼Œå¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œç”±å°å†™è‹±æ–‡å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿ç»„æˆï¼Œä¸èƒ½åŒ…å«ç©ºæ ¼ã€‚<br>description: åŒ…çš„ç®€è¦è¯´æ˜ã€‚<br>version: ç¬¦åˆè¯­ä¹‰åŒ–ç‰ˆæœ¬è¯†åˆ«è§„èŒƒçš„ç‰ˆæœ¬å­—ç¬¦ä¸²ã€‚<br>keywords: å…³é”®å­—æ•°ç»„ï¼Œé€šå¸¸ç”¨äºæœç´¢ã€‚<br>maintainers: ç»´æŠ¤è€…æ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ è¦åŒ…å« <code>name</code> ã€ <code>email</code>(å¯é€‰)ã€ <code>web</code>(å¯é€‰)å­—æ®µã€‚<br>contributors: è´¡çŒ®è€…æ•°ç»„ï¼Œæ ¼å¼ä¸ <code>maintainers</code> ç›¸åŒã€‚åŒ…çš„ä½œè€…åº”è¯¥æ˜¯è´¡çŒ®è€…æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚<br>bugs: æäº¤ <code>bug</code> çš„åœ°å€ï¼Œå¯ä»¥æ˜¯ç½‘å€æˆ–è€…ç”µå­é‚®ä»¶åœ°å€ã€‚<br>licenses: è®¸å¯è¯æ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ è¦åŒ…å« <code>type</code> ï¼ˆè®¸å¯è¯çš„åç§°ï¼‰å’Œ urlï¼ˆé“¾æ¥åˆ°è®¸å¯è¯æ–‡æœ¬çš„åœ°å€ï¼‰å­—æ®µã€‚<br>repositories: ä»“åº“æ‰˜ç®¡åœ°å€æ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ è¦åŒ…å« <code>type</code> ï¼ˆä»“åº“çš„ç±»å‹ï¼Œå¦‚ gitï¼‰ã€URLï¼ˆä»“åº“çš„åœ°å€ï¼‰å’Œ pathï¼ˆç›¸å¯¹äºä»“åº“çš„è·¯å¾„ï¼Œå¯é€‰ï¼‰å­—æ®µã€‚<br>dependencies: åŒ…çš„ä¾èµ–ï¼Œä¸€ä¸ªå…³è”æ•°ç»„ï¼Œç”±åŒ…åç§°å’Œç‰ˆæœ¬å·ç»„æˆã€‚</p>
<h1 id="åŒ…çš„å‘å¸ƒåŒ…çš„å‘å¸ƒ"><a href="#åŒ…çš„å‘å¸ƒåŒ…çš„å‘å¸ƒ" class="headerlink" title="åŒ…çš„å‘å¸ƒåŒ…çš„å‘å¸ƒ"></a><a href="#åŒ…çš„å‘å¸ƒ">åŒ…çš„å‘å¸ƒ</a>åŒ…çš„å‘å¸ƒ</h1><p>é€šè¿‡ä½¿ç”¨ <code>npm init</code> å¯ä»¥æ ¹æ®äº¤äº’å¼å›ç­”äº§ç”Ÿä¸€ä¸ªç¬¦åˆæ ‡å‡†çš„ <code>package.json</code>ã€‚åˆ›å»ºä¸€ä¸ª <code>index.js</code> ä½œä¸ºåŒ…çš„æ¥å£,ä¸€ä¸ªç®€å•çš„åŒ…å°±åˆ¶ä½œå®Œæˆäº†ã€‚<br>åœ¨å‘å¸ƒå‰,æˆ‘ä»¬è¿˜éœ€è¦è·å¾—ä¸€ä¸ªè´¦å·ç”¨äºä»Šåç»´æŠ¤è‡ªå·±çš„åŒ…,ä½¿ç”¨ <code>npm adduser</code> æ ¹æ®æç¤ºå®Œæˆè´¦å·çš„åˆ›å»º<br>å®Œæˆåå¯ä»¥ä½¿ç”¨ <code>npm whoami</code> æ£€æµ‹æ˜¯å¦å·²ç»å–å¾—äº†è´¦å·ã€‚<br>æ¥ä¸‹æ¥,åœ¨ <code>package.json</code> æ‰€åœ¨ç›®å½•ä¸‹è¿è¡Œ <code>npm publish</code>ï¼Œç¨ç­‰ç‰‡åˆ»å°±å¯ä»¥å®Œæˆå‘å¸ƒäº†ï¼Œæ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® <a href="http://search.npmjs.org/" target="_blank" rel="noopener">NPMæœç´¢</a> å°±å¯ä»¥æ‰¾åˆ°è‡ªå·±åˆšåˆšå‘å¸ƒçš„åŒ…äº†ã€‚ç°åœ¨æˆ‘ä»¬å¯ä»¥åœ¨ä¸–ç•Œçš„ä»»æ„ä¸€å°è®¡ç®—æœºä¸Šä½¿ç”¨ <code>npm install neveryumodule</code> å‘½ä»¤æ¥å®‰è£…å®ƒã€‚<br>å¦‚æœä½ çš„åŒ…å°†æ¥æœ‰æ›´æ–°,åªéœ€è¦åœ¨ <code>package.json</code> æ–‡ä»¶ä¸­ä¿®æ”¹ <code>version</code> å­—æ®µ,ç„¶åé‡æ–°ä½¿ç”¨ <code>npm publish</code>å‘½ä»¤å°±è¡Œäº†ã€‚<br>å¦‚æœä½ å¯¹å·²å‘å¸ƒçš„åŒ…ä¸æ»¡æ„ï¼Œå¯ä»¥ä½¿ç”¨ <code>npm unpublish</code> å‘½ä»¤æ¥å–æ¶ˆå‘å¸ƒã€‚</p>
<p><em>éœ€è¦è¯´æ˜çš„æ˜¯ï¼š <code>json</code> æ–‡ä»¶ä¸èƒ½æœ‰æ³¨é‡Š</em></p>
<h3 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">package.json å¥½å¤„</span><br><span class="line"> 1.ä»¥jsonæ–‡ä»¶æ ¼å¼å®šä¹‰é¡¹ç›®æ‰€ä¾èµ–çš„åŒ…ï¼›</span><br><span class="line"> 2.ç¡®å®šæ¯ä¸ªåŒ…çš„ä½¿ç”¨ç‰ˆæœ¬ï¼›</span><br><span class="line"> 3.é¡¹ç›®æ„å»ºå¯é‡å¤ï¼Œå¤šäººååŠ©å…¬ç”¨ä¸€å¥—åŸºç¡€ä»£ç ï¼›</span><br><span class="line"> 4.npm init åˆå§‹åŒ– ã€å¿…é¡»å«æœ‰çš„ä¸¤ä¸ªï¼šname å’Œ versionã€‘</span><br><span class="line">   &#123;</span><br><span class="line">     &quot;name&quot;: &quot;react-redux-webpack&quot;,</span><br><span class="line">     &quot;version&quot;: &quot;1.1.0&quot;,</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">devDependencies    ï¼šå¼€å‘ç¯å¢ƒå’Œæµ‹è¯•ç¯å¢ƒæ‰€ä¾èµ–çš„åŒ…åˆ—è¡¨</span><br><span class="line">dependencies       ï¼šåœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨çš„ä¾èµ–åŒ…åˆ—è¡¨</span><br><span class="line"></span><br><span class="line">    dependenciesä¸‹è®°å½•çš„æ˜¯é¡¹ç›®åœ¨è¿è¡Œæ—¶å¿…é¡»ä¾èµ–çš„æ’ä»¶ï¼Œå¸¸è§çš„ä¾‹å¦‚react jqueryç­‰ï¼Œå³åŠæ—¶é¡¹ç›®æ‰“åŒ…å¥½äº†ã€ä¸Šçº¿äº†ï¼Œ</span><br><span class="line">   è¿™äº›ä¹Ÿæ˜¯éœ€è¦ç”¨çš„ï¼Œå¦åˆ™ç¨‹åºæ— æ³•æ­£å¸¸æ‰§è¡Œã€‚</span><br><span class="line">    devDependenciesä¸‹è®°å½•çš„æ˜¯é¡¹ç›®åœ¨å¼€å‘è¿‡ç¨‹ä¸­ä½¿ç”¨çš„æ’ä»¶ï¼Œä¾‹å¦‚è¿™é‡Œæˆ‘ä»¬å¼€å‘è¿‡ç¨‹ä¸­éœ€è¦ä½¿ç”¨webpackæ‰“åŒ…ï¼Œ</span><br><span class="line">    è€Œæˆ‘åœ¨å·¥ä½œä¸­ä½¿ç”¨fis3æ‰“åŒ…ï¼Œä½†æ˜¯ä¸€æ—¦é¡¹ç›®æ‰“åŒ…å‘å¸ƒã€ä¸Šçº¿äº†ä¹‹åï¼Œwebpackå’Œfis3å°±éƒ½æ²¡æœ‰ç”¨äº†ï¼Œå¯å¸ç£¨æ€é©´ã€‚</span><br><span class="line"></span><br><span class="line">æœ¬åœ°å®‰è£… npm install --save|--save-dev åˆ†åˆ«å†™å…¥  dependencies|devDependencies ä¸­ï¼›</span><br><span class="line">ç®€å†™ï¼š     npm i -S pkg      |  npm i -D pkg</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">åŒ…ï¼ˆpackage)å’Œæ¨¡å—ï¼ˆmoduleï¼‰</span><br><span class="line">åŒ…ï¼špackage.json æ–‡ä»¶æ‰€æè¿°çš„æ–‡ä»¶å¤¹æˆ–è€…æ–‡ä»¶ï¼Œç¬¦åˆCommonJSè§„èŒƒ</span><br><span class="line">æ¨¡å—ï¼šä»»ä½•è¢«node.jsä¸­çš„requireæ‰€è½½å…¥çš„æ–‡ä»¶</span><br><span class="line"></span><br><span class="line">~ ä¼šåŒ¹é…æœ€è¿‘çš„å°ç‰ˆæœ¬ä¾èµ–åŒ…ï¼Œæ¯”å¦‚~1.2.3ä¼šåŒ¹é…æ‰€æœ‰1.2.xç‰ˆæœ¬ï¼Œä½†æ˜¯ä¸åŒ…æ‹¬1.3.0</span><br><span class="line">^ ä¼šåŒ¹é…æœ€æ–°çš„å¤§ç‰ˆæœ¬ä¾èµ–åŒ…ï¼Œæ¯”å¦‚^1.2.3ä¼šåŒ¹é…æ‰€æœ‰1.x.xçš„åŒ…ï¼ŒåŒ…æ‹¬1.3.0ï¼Œä½†æ˜¯ä¸åŒ…æ‹¬2.0.0</span><br><span class="line">* è¿™æ„å‘³ç€å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„ä¾èµ–åŒ…</span><br><span class="line"></span><br><span class="line">å¸¸ç”¨å‘½ä»¤:</span><br><span class="line">    npm init -y    //å¼ºåˆ¶ç”Ÿæˆ</span><br><span class="line">	npm init //åœ¨é¡¹ç›®ä¸­å¼•å¯¼åˆ›å»ºä¸€ä¸ªpackage.jsonæ–‡ä»¶</span><br><span class="line">	npm search mkdir   //å¯»æ‰¾åŒ…ä½¿ç”¨npm searchå‘½ä»¤</span><br><span class="line">	npm help //æŸ¥çœ‹æŸæ¡å‘½ä»¤çš„è¯¦ç»†å¸®åŠ© </span><br><span class="line">	npm root //æŸ¥çœ‹åŒ…çš„å®‰è£…è·¯å¾„</span><br><span class="line">	npm config //ç®¡ç†npmçš„é…ç½®è·¯å¾„</span><br><span class="line">	npm prefix -g   //æŸ¥çœ‹å…¨å±€å®‰è£…çš„åŒ…ä½ç½®  -gå…¨å±€</span><br><span class="line">	npm cache  //ç®¡ç†æ¨¡å—çš„ç¼“å­˜ ,å¯ä»¥ä½¿ç”¨ä¸‹é¢å‘½ä»¤ï¼Œå¶å°”æ¸…æ¥šä¸€ä¸‹ç¼“å­˜ï¼š      eg: npm cache clean</span><br><span class="line">	npm info webpack   //æŸ¥çœ‹webpack ç‰ˆæœ¬ä¿¡æ¯</span><br><span class="line">	npm install pkg //å®‰è£…æ¨¡å— ç®€å†™ï¼šnpm i pkg   ,å¸¦ç‰ˆæœ¬:  npm install underscore@1.8.2</span><br><span class="line">	npm uninstall //å¸è½½æ¨¡å—   eg: npm uninstall webpack</span><br><span class="line">	npm update   // æ›´æ–°æ¨¡å—   npm update underscore</span><br><span class="line">	npm outdated  //æ£€æŸ¥æ¨¡å—æ˜¯å¦å·²ç»è¿‡æ—¶</span><br><span class="line">	npm ls   //æŸ¥çœ‹å®‰è£…çš„æ¨¡å— </span><br><span class="line">	npm list  //å¯ä»¥æŸ¥çœ‹å…¨å±€è·¯å¾„ä¸‹çš„æ‰€æœ‰åŒ…    eg:   npm list --global</span><br><span class="line">	          //ä¹Ÿå¯ä»¥ä½¿ç”¨--depth=0æ¥ç¼©çŸ­è¿”å›çš„ç»“æœ   eg:     npm list -g --depth=0</span><br><span class="line">	npm stop  //åœæ­¢æ¨¡å—</span><br><span class="line">	npm restart  //é‡æ–°å¯åŠ¨æ¨¡å—</span><br><span class="line">	npm test //æµ‹è¯•æ¨¡å— </span><br><span class="line">	npm version //æŸ¥çœ‹æ¨¡å—ç‰ˆæœ¬</span><br><span class="line">	npm publish //å‘å¸ƒæ¨¡å—</span><br><span class="line"></span><br><span class="line">ç®€å†™:</span><br><span class="line">	npm i â€“ å®‰è£…åŒ…</span><br><span class="line">	npm i -g â€“ å®‰è£…åŒ…åˆ°å…¨å±€ä¸‹</span><br><span class="line">	npm un â€“ åˆ é™¤æœ¬åœ°ä¸‹åŒ…</span><br><span class="line">	npm up â€“ æ›´æ–°åŒ…</span><br><span class="line">	npm t â€“ è¿è¡Œæµ‹è¯•</span><br><span class="line">	npm ls â€“ ç½—åˆ—å·²ç»å®‰è£…åŒ…</span><br><span class="line">	npm ll or npm la â€“ ç½—åˆ—åŒ…æ—¶æ˜¾ç¤ºé¢å¤–ä¿¡æ¯</span><br><span class="line"></span><br><span class="line">    npm i express momemt lodash mongoose  webpack   //ä¹Ÿå¯ä»¥ä¸€æ¬¡å®‰è£…å¤šä¸ªåŒ…</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    yarn cache clean   //åˆ é™¤ç”µè„‘ä¸Šæ‰€æœ‰ yarn å®‰è£…çš„ç¼“å­˜</span><br><span class="line">    yarn   //å‘½ä»¤å®‰è£…é¡¹ç›®ç›¸å…³ä¾èµ–</span><br><span class="line">    yarn cache dir //è·å–ç¼“å­˜æ–‡ä»¶å¤¹åœ°å€</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/tx.jpg"
                alt="ææ–Œ" />
            
              <p class="site-author-name" itemprop="name">ææ–Œ</p>
              <p class="site-description motion-element" itemprop="description">æƒ³è¦é£å¾—é«˜ï¼Œé‚£å°±æŠŠåœ°å¹³çº¿å¿˜æ‰</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">12</span>
                  <span class="site-state-item-name">æ—¥å¿—</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">14</span>
                  <span class="site-state-item-name">æ ‡ç­¾</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/libin1991" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="3120217729@qq.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://juejin.im/user/57e737f6c4c971005f6bcd8d" target="_blank" title="juejin">
                      
                        <i class="fa fa-fw fa-spinner"></i>juejin</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ææ–Œ</span>

  
</div>


  <div class="powered-by">ç”± <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">ä¸»é¢˜ &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
<script type="text/javascript" src="/js/src/clicklove.js"></script>

