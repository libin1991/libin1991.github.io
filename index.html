<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="Blog">
<meta property="og:type" content="website">
<meta property="og:title" content="LuckDay">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="LuckDay">
<meta property="og:description" content="Blog">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="LuckDay">
<meta name="twitter:description" content="Blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>LuckDay - æƒ³è¦é£å¾—é«˜ï¼Œé‚£å°±æŠŠåœ°å¹³çº¿å¿˜æ‰</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband">
    	<div class="eevee"><div class="body"><div class="head"><div class="ears"><div class="ear"><div class="lobe"></div></div><div class="ear"><div class="lobe"></div></div></div><div class="face"><div class="eyes"><div class="eye"><div class="eyelid"></div></div><div class="eye"><div class="eyelid"></div></div></div><div class="nose"></div><div class="mouth"></div></div></div><div class="chest"><div class="fur"><div class="patch"></div></div><div class="fur"><div class="patch"></div></div><div class="fur"><div class="patch"></div></div></div><div class="legs"><div class="leg"><div class="inner-leg"></div></div><div class="leg"><div class="inner-leg"></div></div><div class="leg"><div class="inner-leg"></div></div><div class="leg"><div class="inner-leg"></div></div></div><div class="tail"><div class="tail"><div class="tail"><div class="tail"><div class="tail"><div class="tail -end"></div></div></div></div></div></div></div></div>
    </div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
    	<div class="sky">
	<div class="clouds_one"></div>
	<div class="clouds_two"></div>
	<div class="clouds_three"></div>
</div>
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">LuckDay</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">æƒ³è¦é£å¾—é«˜ï¼Œé‚£å°±æŠŠåœ°å¹³çº¿å¿˜æ‰</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            æ ‡ç­¾
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            å…³äº
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            æœç´¢
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="æœç´¢..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/09/44ä¸ªJavaScript-å˜æ€é¢˜è§£æ/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/09/44ä¸ªJavaScript-å˜æ€é¢˜è§£æ/" itemprop="url">44ä¸ªJavaScript å˜æ€é¢˜è§£æ</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-12-09T18:39:40+08:00">
                2018-12-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="/2018/12/09/44ä¸ªJavaScript-å˜æ€é¢˜è§£æ/1.jpg" alt=""></p>
<h2 id="ç¬¬1é¢˜"><a href="#ç¬¬1é¢˜" class="headerlink" title="ç¬¬1é¢˜"></a>ç¬¬1é¢˜</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&quot;1&quot;, &quot;2&quot;, &quot;3&quot;].map(parseInt)</span><br></pre></td></tr></table></figure>
<p>çŸ¥è¯†ç‚¹:</p>
<ul>
<li><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FArray%2Fmap" target="_blank" rel="noopener">Array/map</a></li>
<li><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FNumber%2FparseInt" target="_blank" rel="noopener">Number/parseInt</a></li>
<li><p><a href="https://link.juejin.im?target=http%3A%2F%2Fwww.w3school.com.cn%2Fjsref%2Fjsref_parseInt.asp" target="_blank" rel="noopener">JavaScript parseInt</a></p>
<p>é¦–å…ˆ, mapæ¥å—ä¸¤ä¸ªå‚æ•°, ä¸€ä¸ªå›è°ƒå‡½æ•° callback, ä¸€ä¸ªå›è°ƒå‡½æ•°çš„thiså€¼</p>
<p>å…¶ä¸­å›è°ƒå‡½æ•°æ¥å—ä¸‰ä¸ªå‚æ•° currentValue, index, arrary;</p>
<p>è€Œé¢˜ç›®ä¸­, mapåªä¼ å…¥äº†å›è°ƒå‡½æ•°â€“parseInt.</p>
<p>å…¶æ¬¡, parseInt åªæ¥å—ä¸¤ä¸ªä¸¤ä¸ªå‚æ•° string, radix(åŸºæ•°).</p>
</li>
</ul>
<blockquote>
<p> å¯é€‰ã€‚è¡¨ç¤ºè¦è§£æçš„æ•°å­—çš„åŸºæ•°ã€‚è¯¥å€¼ä»‹äº 2 ~ 36 ä¹‹é—´ã€‚<br> å¦‚æœçœç•¥è¯¥å‚æ•°æˆ–å…¶å€¼ä¸º 0ï¼Œåˆ™æ•°å­—å°†ä»¥ 10 ä¸ºåŸºç¡€æ¥è§£æã€‚å¦‚æœå®ƒä»¥ â€œ0xâ€ æˆ– â€œ0Xâ€ å¼€å¤´ï¼Œå°†ä»¥ 16 ä¸ºåŸºæ•°ã€‚<br> å¦‚æœè¯¥å‚æ•°å°äº 2 æˆ–è€…å¤§äº 36ï¼Œåˆ™ parseInt() å°†è¿”å› NaNã€‚</p>
</blockquote>
<p> æ‰€ä»¥æœ¬é¢˜å³é—®<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">parseInt(&apos;1&apos;, 0);</span><br><span class="line">parseInt(&apos;2&apos;, 1);</span><br><span class="line">parseInt(&apos;3&apos;, 2);</span><br></pre></td></tr></table></figure></p>
<p> é¦–å…ˆåä¸¤è€…å‚æ•°ä¸åˆæ³•.</p>
<p> æ‰€ä»¥ç­”æ¡ˆæ˜¯ [1, NaN, NaN]</p>
<h2 id="ç¬¬2é¢˜"><a href="#ç¬¬2é¢˜" class="headerlink" title="ç¬¬2é¢˜"></a>ç¬¬2é¢˜</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[typeof null, null instanceof Object]</span><br></pre></td></tr></table></figure>
<p> ä¸¤ä¸ªçŸ¥è¯†ç‚¹:</p>
<ul>
<li><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FOperators%2Ftypeof" target="_blank" rel="noopener">Operators/typeof</a></li>
<li><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FOperators%2Finstanceof" target="_blank" rel="noopener">Operators/instanceof</a></li>
<li><p><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FOperators%2Finstanceof" target="_blank" rel="noopener">Operators/instanceof(ä¸­)</a></p>
<p>typeof è¿”å›ä¸€ä¸ªè¡¨ç¤ºç±»å‹çš„å­—ç¬¦ä¸².</p>
<p>instanceof è¿ç®—ç¬¦ç”¨æ¥æ£€æµ‹ constructor.prototype æ˜¯å¦å­˜åœ¨äºå‚æ•° object çš„åŸå‹é“¾ä¸Š.</p>
<p>è¿™ä¸ªé¢˜å¯ä»¥ç›´æ¥çœ‹é“¾æ¥â€¦ å› ä¸º typeof null === â€˜objectâ€™ è‡ªè¯­è¨€ä¹‹åˆå°±æ˜¯è¿™æ ·â€¦.</p>
</li>
</ul>
<p>typeof çš„ç»“æœè¯·çœ‹ä¸‹è¡¨:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">type         result</span><br><span class="line">Undefined   &quot;undefined&quot;</span><br><span class="line">Null        &quot;object&quot;</span><br><span class="line">Boolean     &quot;boolean&quot;</span><br><span class="line">Number      &quot;number&quot;</span><br><span class="line">String      &quot;string&quot;</span><br><span class="line">Symbol      &quot;symbol&quot;</span><br><span class="line">Host object Implementation-dependent</span><br><span class="line">Function    &quot;function&quot;</span><br><span class="line">Object      &quot;object&quot;</span><br></pre></td></tr></table></figure></p>
<p> æ‰€ä»¥ç­”æ¡ˆ [object, false]</p>
<h2 id="ç¬¬3é¢˜"><a href="#ç¬¬3é¢˜" class="headerlink" title="ç¬¬3é¢˜"></a>ç¬¬3é¢˜</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[ [3,2,1].reduce(Math.pow), [].reduce(Math.pow) ]</span><br></pre></td></tr></table></figure>
<p> çŸ¥è¯†ç‚¹:</p>
<ul>
<li><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FArray%2FReduce" target="_blank" rel="noopener">Array/Reduce</a></li>
</ul>
<p>arr.reduce(callback[, initialValue])</p>
<p>reduceæ¥å—ä¸¤ä¸ªå‚æ•°, ä¸€ä¸ªå›è°ƒ, ä¸€ä¸ªåˆå§‹å€¼.</p>
<p>å›è°ƒå‡½æ•°æ¥å—å››ä¸ªå‚æ•° previousValue, currentValue, currentIndex, array</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ If the array is empty and no initialValue was provided, TypeError would be thrown.</p>
<p>æ‰€ä»¥ç¬¬äºŒä¸ªè¡¨è¾¾å¼ä¼šæŠ¥å¼‚å¸¸. ç¬¬ä¸€ä¸ªè¡¨è¾¾å¼ç­‰ä»·äº Math.pow(3, 2) =&gt; 9; Math.pow(9, 1) =&gt;9</p>
<p>ç­”æ¡ˆ an error</p>
<h2 id="ç¬¬4é¢˜"><a href="#ç¬¬4é¢˜" class="headerlink" title="ç¬¬4é¢˜"></a>ç¬¬4é¢˜</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var val = &apos;smtg&apos;;</span><br><span class="line">console.log(&apos;Value is &apos; + (val === &apos;smtg&apos;) ? &apos;Something&apos; : &apos;Nothing&apos;);</span><br></pre></td></tr></table></figure>
<p> ä¸¤ä¸ªçŸ¥è¯†ç‚¹:</p>
<ul>
<li><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FOperators%2FOperator_Precedence" target="_blank" rel="noopener">Operators/Operator_Precedence</a></li>
<li><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FOperators%2FConditional_Operator" target="_blank" rel="noopener">Operators/Conditional_Operator</a></li>
</ul>
<p>ç®€è€Œè¨€ä¹‹ + çš„ä¼˜å…ˆçº§ å¤§äº ?</p>
<p>æ‰€ä»¥åŸé¢˜ç­‰ä»·äº â€˜Value is trueâ€™ ? â€˜Somthingâ€™ : â€˜Nonthingâ€™ è€Œä¸æ˜¯ â€˜Value isâ€™ + (true ? â€˜Somethingâ€™ : â€˜Nonthingâ€™)</p>
<p>ç­”æ¡ˆ â€˜Somethingâ€™</p>
<h2 id="ç¬¬5é¢˜"><a href="#ç¬¬5é¢˜" class="headerlink" title="ç¬¬5é¢˜"></a>ç¬¬5é¢˜</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var name = &apos;World!&apos;;</span><br><span class="line">(function () &#123;</span><br><span class="line">    if (typeof name === &apos;undefined&apos;) &#123;</span><br><span class="line">        var name = &apos;Jack&apos;;</span><br><span class="line">        console.log(&apos;Goodbye &apos; + name);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        console.log(&apos;Hello &apos; + name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p> è¿™ä¸ªç›¸å¯¹ç®€å•, ä¸€ä¸ªçŸ¥è¯†ç‚¹:</p>
<ul>
<li><p><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FGlossary%2FHoisting" target="_blank" rel="noopener">Hoisting</a></p>
<p>åœ¨ JavaScriptä¸­ï¼Œ functions å’Œ variables ä¼šè¢«æå‡ã€‚å˜é‡æå‡æ˜¯JavaScriptå°†å£°æ˜ç§»è‡³ä½œç”¨åŸŸ scope (å…¨å±€åŸŸæˆ–è€…å½“å‰å‡½æ•°ä½œç”¨åŸŸ) é¡¶éƒ¨çš„è¡Œä¸ºã€‚</p>
</li>
</ul>
<p>è¿™ä¸ªé¢˜ç›®ç›¸å½“äº<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">var name = &apos;World!&apos;;</span><br><span class="line">(function () &#123;</span><br><span class="line">    var name;</span><br><span class="line">    if (typeof name === &apos;undefined&apos;) &#123;</span><br><span class="line">        name = &apos;Jack&apos;;</span><br><span class="line">        console.log(&apos;Goodbye &apos; + name);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        console.log(&apos;Hello &apos; + name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure></p>
<p> æ‰€ä»¥ç­”æ¡ˆæ˜¯ â€˜Goodbye Jackâ€™</p>
<h2 id="ç¬¬6é¢˜"><a href="#ç¬¬6é¢˜" class="headerlink" title="ç¬¬6é¢˜"></a>ç¬¬6é¢˜</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var END = Math.pow(2, 53);</span><br><span class="line">var START = END - 100;</span><br><span class="line">var count = 0;</span><br><span class="line">for (var i = START; i &lt;= END; i++) &#123;</span><br><span class="line">    count++;</span><br><span class="line">&#125;</span><br><span class="line">console.log(count);</span><br></pre></td></tr></table></figure>
<p> ä¸€ä¸ªçŸ¥è¯†ç‚¹:</p>
<ul>
<li><p><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FInfinity" target="_blank" rel="noopener">Infinity</a></p>
<p>åœ¨ JS é‡Œ, Math.pow(2, 53) == 9007199254740992 æ˜¯å¯ä»¥è¡¨ç¤ºçš„æœ€å¤§å€¼. æœ€å¤§å€¼åŠ ä¸€è¿˜æ˜¯æœ€å¤§å€¼. æ‰€ä»¥å¾ªç¯ä¸ä¼šåœ.</p>
</li>
</ul>
<h2 id="ç¬¬7é¢˜"><a href="#ç¬¬7é¢˜" class="headerlink" title="ç¬¬7é¢˜"></a>ç¬¬7é¢˜</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var ary = [0,1,2];</span><br><span class="line">ary[10] = 10;</span><br><span class="line">ary.filter(function(x) &#123; return x === undefined;&#125;);</span><br></pre></td></tr></table></figure>
<p>ç­”æ¡ˆæ˜¯ []</p>
<p> çœ‹ä¸€ç¯‡æ–‡ç« ç†è§£ç¨€ç–æ•°ç»„</p>
<ul>
<li><a href="https://link.juejin.im?target=http%3A%2F%2Fwww.cnblogs.com%2Fziyunfei%2Farchive%2F2012%2F09%2F16%2F2687165.html" target="_blank" rel="noopener">è¯‘ JavaScriptä¸­çš„ç¨€ç–æ•°ç»„ä¸å¯†é›†æ•°ç»„</a></li>
<li><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FArray%2Ffilter" target="_blank" rel="noopener">Array/filter</a></li>
</ul>
<p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ Array.prototype.filter çš„ polyfill:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">if (!Array.prototype.filter) &#123;</span><br><span class="line">  Array.prototype.filter = function(fun/*, thisArg*/) &#123;</span><br><span class="line">    &apos;use strict&apos;;</span><br><span class="line"></span><br><span class="line">    if (this === void 0 || this === null) &#123;</span><br><span class="line">      throw new TypeError();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    var t = Object(this);</span><br><span class="line">    var len = t.length &gt;&gt;&gt; 0;</span><br><span class="line">    if (typeof fun !== &apos;function&apos;) &#123;</span><br><span class="line">      throw new TypeError();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    var res = [];</span><br><span class="line">    var thisArg = arguments.length &gt;= 2 ? arguments[1] : void 0;</span><br><span class="line">    for (var i = 0; i &lt; len; i++) &#123;</span><br><span class="line">      if (i in t) &#123; // æ³¨æ„è¿™é‡Œ!!!</span><br><span class="line">        var val = t[i];</span><br><span class="line">        if (fun.call(thisArg, val, i, t)) &#123;</span><br><span class="line">          res.push(val);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return res;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p> æˆ‘ä»¬çœ‹åˆ°åœ¨è¿­ä»£è¿™ä¸ªæ•°ç»„çš„æ—¶å€™, é¦–å…ˆæ£€æŸ¥äº†è¿™ä¸ªç´¢å¼•å€¼æ˜¯ä¸æ˜¯æ•°ç»„çš„ä¸€ä¸ªå±æ€§, é‚£ä¹ˆæˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0 in ary; =&gt; true</span><br><span class="line">3 in ary; =&gt; false</span><br><span class="line">10 in ary; =&gt; true</span><br></pre></td></tr></table></figure></p>
<p>ä¹Ÿå°±æ˜¯è¯´ ä» 3 - 9 éƒ½æ˜¯æ²¡æœ‰åˆå§‹åŒ–çš„â€™å‘â€™!, è¿™äº›ç´¢å¼•å¹¶ä¸å­˜åœ¨ä¸æ•°ç»„ä¸­. åœ¨ array çš„å‡½æ•°è°ƒç”¨çš„æ—¶å€™æ˜¯ä¼šè·³è¿‡è¿™äº›â€™å‘â€™çš„.</p>
<h2 id="ç¬¬8é¢˜"><a href="#ç¬¬8é¢˜" class="headerlink" title="ç¬¬8é¢˜"></a>ç¬¬8é¢˜</h2><pre><code>var two   = 0.2
var one   = 0.1
var eight = 0.8
var six   = 0.6
[two - one == one, eight - six == two]
</code></pre><ul>
<li><p><a href="https://link.juejin.im?target=http%3A%2F%2Fourjs.com%2Fdetail%2F54695381bc3f9b154e000046" target="_blank" rel="noopener">JavaScriptçš„è®¾è®¡ç¼ºé™·?æµ®ç‚¹è¿ç®—ï¼š0.1 + 0.2 != 0.3</a></p>
<p>IEEE 754æ ‡å‡†ä¸­çš„æµ®ç‚¹æ•°å¹¶ä¸èƒ½ç²¾ç¡®åœ°è¡¨è¾¾å°æ•°</p>
<p>é‚£ä»€ä¹ˆæ—¶å€™ç²¾å‡†, ä»€ä¹ˆæ—¶å€™ä¸ç»å‡†å‘¢? ç¬”è€…ä¹Ÿä¸çŸ¥é“â€¦</p>
<p>ç­”æ¡ˆ [true, false]</p>
</li>
</ul>
<h2 id="ç¬¬9é¢˜"><a href="#ç¬¬9é¢˜" class="headerlink" title="ç¬¬9é¢˜"></a>ç¬¬9é¢˜</h2><pre><code>function showCase(value) {
    switch(value) {
    case &apos;A&apos;:
        console.log(&apos;Case A&apos;);
        break;
    case &apos;B&apos;:
        console.log(&apos;Case B&apos;);
        break;
    case undefined:
        console.log(&apos;undefined&apos;);
        break;
    default:
        console.log(&apos;Do not know!&apos;);
    }
}
showCase(new String(&apos;A&apos;));
</code></pre><p> ä¸¤ä¸ªçŸ¥è¯†ç‚¹:</p>
<ul>
<li><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FStatements%2Fswitch" target="_blank" rel="noopener">Statements/switch</a></li>
<li><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FString" target="_blank" rel="noopener">String</a></li>
</ul>
<p>switch æ˜¯ä¸¥æ ¼æ¯”è¾ƒ, String å®ä¾‹å’Œ å­—ç¬¦ä¸²ä¸ä¸€æ ·.</p>
<pre><code>var s_prim = &apos;foo&apos;;
var s_obj = new String(s_prim);

console.log(typeof s_prim); // &quot;string&quot;
console.log(typeof s_obj);  // &quot;object&quot;
console.log(s_prim === s_obj); // false
</code></pre><p> ç­”æ¡ˆæ˜¯ â€˜Do not know!â€™</p>
<h2 id="ç¬¬10é¢˜"><a href="#ç¬¬10é¢˜" class="headerlink" title="ç¬¬10é¢˜"></a>ç¬¬10é¢˜</h2><pre><code>function showCase2(value) {
    switch(value) {
    case &apos;A&apos;:
        console.log(&apos;Case A&apos;);
        break;
    case &apos;B&apos;:
        console.log(&apos;Case B&apos;);
        break;
    case undefined:
        console.log(&apos;undefined&apos;);
        break;
    default:
        console.log(&apos;Do not know!&apos;);
    }
}
showCase2(String(&apos;A&apos;));
</code></pre><p>è§£é‡Š:<br> String(x) does not create an object but does return a string, i.e. typeof String(1) === â€œstringâ€</p>
<p>è¿˜æ˜¯åˆšæ‰çš„çŸ¥è¯†ç‚¹, åªä¸è¿‡ String ä¸ä»…æ˜¯ä¸ªæ„é€ å‡½æ•° ç›´æ¥è°ƒç”¨è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²å“¦.</p>
<p> ç­”æ¡ˆ â€˜Case Aâ€™</p>
<h2 id="ç¬¬11é¢˜"><a href="#ç¬¬11é¢˜" class="headerlink" title="ç¬¬11é¢˜"></a>ç¬¬11é¢˜</h2><pre><code>function isOdd(num) {
    return num % 2 == 1;
}
function isEven(num) {
    return num % 2 == 0;
}
function isSane(num) {
    return isEven(num) || isOdd(num);
}
var values = [7, 4, &apos;13&apos;, -9, Infinity];
values.map(isSane);
</code></pre><p> ä¸€ä¸ªçŸ¥è¯†ç‚¹</p>
<ul>
<li><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FOperators%2FArithmetic_Operators%23Remainder" target="_blank" rel="noopener">Arithmetic_Operators#Remainder</a></li>
</ul>
<p>æ­¤é¢˜ç­‰ä»·äº<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">7 % 2 =&gt; 1</span><br><span class="line">4 % 2 =&gt; 0</span><br><span class="line">&apos;13&apos; % 2 =&gt; 1</span><br><span class="line">-9 % % 2 =&gt; -1</span><br><span class="line">Infinity % 2 =&gt; NaN</span><br></pre></td></tr></table></figure></p>
<p> éœ€è¦æ³¨æ„çš„æ˜¯ ä½™æ•°çš„æ­£è´Ÿå·éšç¬¬ä¸€ä¸ªæ“ä½œæ•°.</p>
<p> ç­”æ¡ˆ [true, true, true, false, false]</p>
<h2 id="ç¬¬12é¢˜"><a href="#ç¬¬12é¢˜" class="headerlink" title="ç¬¬12é¢˜"></a>ç¬¬12é¢˜</h2><pre><code>parseInt(3, 8)
parseInt(3, 2)
parseInt(3, 0)
</code></pre><p> ç¬¬ä¸€ä¸ªé¢˜è®²è¿‡äº†, ç­”æ¡ˆ 3, NaN, 3</p>
<h2 id="ç¬¬13é¢˜"><a href="#ç¬¬13é¢˜" class="headerlink" title="ç¬¬13é¢˜"></a>ç¬¬13é¢˜</h2><pre><code>Array.isArray( Array.prototype )
</code></pre><p> ä¸€ä¸ªçŸ¥è¯†ç‚¹:</p>
<ul>
<li><p><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FArray%2Fprototype" target="_blank" rel="noopener">Array/prototype</a></p>
<p>ä¸€ä¸ªé²œä¸ºäººçŸ¥çš„å®äº‹: Array.prototype =&gt; [];</p>
<p>ç­”æ¡ˆ: true</p>
</li>
</ul>
<h2 id="ç¬¬14é¢˜"><a href="#ç¬¬14é¢˜" class="headerlink" title="ç¬¬14é¢˜"></a>ç¬¬14é¢˜</h2><pre><code>var a = [0];
if ([0]) {
  console.log(a == true);
} else {
  console.log(&quot;wut&quot;);
}
</code></pre><ul>
<li><p><a href="https://link.juejin.im?target=https%3A%2F%2Fdorey.github.io%2FJavaScript-Equality-Table%2F" target="_blank" rel="noopener">JavaScript-Equality-Table</a></p>
<p>ç­”æ¡ˆ: false</p>
</li>
</ul>
<h2 id="ç¬¬15é¢˜"><a href="#ç¬¬15é¢˜" class="headerlink" title="ç¬¬15é¢˜"></a>ç¬¬15é¢˜</h2><pre><code>[]==[]
</code></pre><p> == æ˜¯ä¸‡æ¶ä¹‹æº, çœ‹ä¸Šå›¾</p>
<p> ç­”æ¡ˆæ˜¯ false</p>
<h2 id="ç¬¬16é¢˜"><a href="#ç¬¬16é¢˜" class="headerlink" title="ç¬¬16é¢˜"></a>ç¬¬16é¢˜</h2><pre><code>&apos;5&apos; + 3
&apos;5&apos; - 3
</code></pre><p> ä¸¤ä¸ªçŸ¥è¯†ç‚¹:</p>
<ul>
<li><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FOperators%2FArithmetic_Operators%23Addition" target="_blank" rel="noopener">Arithmetic_Operators#Addition</a></li>
<li><p><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FOperators%2FArithmetic_Operators%23Subtraction" target="_blank" rel="noopener">Arithmetic_Operators#Subtraction</a></p>
<ul>
<li>ç”¨æ¥è¡¨ç¤ºä¸¤ä¸ªæ•°çš„å’Œæˆ–è€…å­—ç¬¦ä¸²æ‹¼æ¥, -è¡¨ç¤ºä¸¤æ•°ä¹‹å·®.</li>
</ul>
</li>
</ul>
<p>è¯·çœ‹ä¾‹å­, ä½“ä¼šåŒºåˆ«:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; &apos;5&apos; + 3</span><br><span class="line">&apos;53&apos;</span><br><span class="line">&gt; 5 + &apos;3&apos;</span><br><span class="line">&apos;53&apos;</span><br><span class="line">&gt; 5 - &apos;3&apos;</span><br><span class="line">2</span><br><span class="line">&gt; &apos;5&apos; - 3</span><br><span class="line">2</span><br><span class="line">&gt; &apos;5&apos; - &apos;3&apos;</span><br><span class="line">2</span><br></pre></td></tr></table></figure></p>
<p> ä¹Ÿå°±æ˜¯è¯´ - ä¼šå°½å¯èƒ½çš„å°†ä¸¤ä¸ªæ“ä½œæ•°å˜æˆæ•°å­—, è€Œ + å¦‚æœä¸¤è¾¹ä¸éƒ½æ˜¯æ•°å­—, é‚£ä¹ˆå°±æ˜¯å­—ç¬¦ä¸²æ‹¼æ¥.</p>
<p> ç­”æ¡ˆæ˜¯ â€˜53â€™, 2</p>
<h2 id="ç¬¬17é¢˜"><a href="#ç¬¬17é¢˜" class="headerlink" title="ç¬¬17é¢˜"></a>ç¬¬17é¢˜</h2><pre><code>1 + - + + + - + 1
</code></pre><p> è¿™é‡Œåº”è¯¥æ˜¯(å€’ç€çœ‹)</p>
<pre><code>1 + (a)  =&gt; 2
a = - (b) =&gt; 1
b = + (c) =&gt; -1
c = + (d) =&gt; -1
d = + (e) =&gt; -1
e = + (f) =&gt; -1
f = - (g) =&gt; -1
g = + 1   =&gt; 1
</code></pre><p> æ‰€ä»¥ç­”æ¡ˆ 2</p>
<h2 id="ç¬¬18é¢˜"><a href="#ç¬¬18é¢˜" class="headerlink" title="ç¬¬18é¢˜"></a>ç¬¬18é¢˜</h2><pre><code>var ary = Array(3);
ary[0]=2
ary.map(function(elem) { return &apos;1&apos;; });
</code></pre><p> ç¨€ç–æ•°ç»„. åŒç¬¬7é¢˜.</p>
<p> é¢˜ç›®ä¸­çš„æ•°ç»„å…¶å®æ˜¯ä¸€ä¸ªé•¿åº¦ä¸º3, ä½†æ˜¯æ²¡æœ‰å†…å®¹çš„æ•°ç»„, array ä¸Šçš„æ“ä½œä¼šè·³è¿‡è¿™äº›æœªåˆå§‹åŒ–çš„â€™å‘â€™.</p>
<p> æ‰€ä»¥ç­”æ¡ˆæ˜¯ [â€œ1â€, undefined Ã— 2]</p>
<p> è¿™é‡Œè´´ä¸Š Array.prototype.map çš„ polyfill.</p>
<pre><code>Array.prototype.map = function(callback, thisArg) {

        var T, A, k;

        if (this == null) {
            throw new TypeError(&apos; this is null or not defined&apos;);
        }

        var O = Object(this);
        var len = O.length &gt;&gt;&gt; 0;
        if (typeof callback !== &apos;function&apos;) {
            throw new TypeError(callback + &apos; is not a function&apos;);
        }
        if (arguments.length &gt; 1) {
            T = thisArg;
        }
        A = new Array(len);
        k = 0;
        while (k &lt; len) {
            var kValue, mappedValue;
            if (k in O) {
                kValue = O[k];
                mappedValue = callback.call(T, kValue, k, O);
                A[k] = mappedValue;
            }
            k++;
        }
        return A;
    };
</code></pre><h2 id="ç¬¬19é¢˜"><a href="#ç¬¬19é¢˜" class="headerlink" title="ç¬¬19é¢˜"></a>ç¬¬19é¢˜</h2><pre><code>function sidEffecting(ary) {
  ary[0] = ary[2];
}
function bar(a,b,c) {
  c = 10
  sidEffecting(arguments);
  return a + b + c;
}
bar(1,1,1)
</code></pre><p> è¿™æ˜¯ä¸€ä¸ªå¤§å‘, å°¤å…¶æ˜¯æ¶‰åŠåˆ° ES6è¯­æ³•çš„æ—¶å€™</p>
<p> çŸ¥è¯†ç‚¹:</p>
<ul>
<li><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FFunctions%2Farguments" target="_blank" rel="noopener">Functions/arguments</a></li>
</ul>
<p>é¦–å…ˆ The arguments object is an Array-like object corresponding to the arguments passed to a function.</p>
<p>ä¹Ÿå°±æ˜¯è¯´ arguments æ˜¯ä¸€ä¸ª object, c å°±æ˜¯ arguments[2], æ‰€ä»¥å¯¹äº c çš„ä¿®æ”¹å°±æ˜¯å¯¹ arguments[2] çš„ä¿®æ”¹.</p>
<p>æ‰€ä»¥ç­”æ¡ˆæ˜¯ 21.</p>
<p>ç„¶è€Œ!!!!!!</p>
<p>å½“å‡½æ•°å‚æ•°æ¶‰åŠåˆ° any rest parameters, any default parameters or any destructured parameters çš„æ—¶å€™, è¿™ä¸ª arguments å°±ä¸åœ¨æ˜¯ä¸€ä¸ª mapped arguments object äº†â€¦..</p>
<p>è¯·çœ‹:</p>
<pre><code>function sidEffecting(ary) {
  ary[0] = ary[2];
}
function bar(a,b,c=3) {
  c = 10
  sidEffecting(arguments);
  return a + b + c;
}
bar(1,1,1)
</code></pre><p> ç­”æ¡ˆæ˜¯ 12 !!!!</p>
<p> è¯·è¯»è€…ç»†ç»†ä½“ä¼š!!</p>
<h2 id="ç¬¬20é¢˜"><a href="#ç¬¬20é¢˜" class="headerlink" title="ç¬¬20é¢˜"></a>ç¬¬20é¢˜</h2><pre><code>var a = 111111111111111110000,
    b = 1111;
a + b;
</code></pre><p> ç­”æ¡ˆè¿˜æ˜¯ 111111111111111110000. è§£é‡Šæ˜¯ Lack of precision for numbers in JavaScript affects both small and big numbers. ä½†æ˜¯ç¬”è€…ä¸æ˜¯å¾ˆæ˜ç™½â€¦â€¦â€¦â€¦â€¦. è¯·è¯»è€…èµæ•™!</p>
<h2 id="ç¬¬21é¢˜"><a href="#ç¬¬21é¢˜" class="headerlink" title="ç¬¬21é¢˜"></a>ç¬¬21é¢˜</h2><pre><code>var x = [].reverse;
x();
</code></pre><p> è¿™ä¸ªé¢˜æœ‰æ„æ€!</p>
<p> çŸ¥è¯†ç‚¹:</p>
<ul>
<li><p><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FArray%2Freverse" target="_blank" rel="noopener">Array/reverse</a></p>
<p>The reverse method transposes the elements of the calling array object in place, mutating the array, and returning a reference to the array.</p>
<p>ä¹Ÿå°±æ˜¯è¯´ æœ€åä¼šè¿”å›è¿™ä¸ªè°ƒç”¨è€…(this), å¯æ˜¯ x æ‰§è¡Œçš„æ—¶å€™æ˜¯ä¸Šä¸‹æ–‡æ˜¯å…¨å±€. é‚£ä¹ˆæœ€åè¿”å›çš„æ˜¯ window.</p>
<p>ç­”æ¡ˆæ˜¯ window</p>
</li>
</ul>
<h2 id="ç¬¬22é¢˜"><a href="#ç¬¬22é¢˜" class="headerlink" title="ç¬¬22é¢˜"></a>ç¬¬22é¢˜</h2><pre><code>Number.MIN_VALUE &gt; 0
</code></pre><p> true</p>
<h2 id="ç¬¬23é¢˜"><a href="#ç¬¬23é¢˜" class="headerlink" title="ç¬¬23é¢˜"></a>ç¬¬23é¢˜</h2><pre><code>[1 &lt; 2 &lt; 3, 3 &lt; 2 &lt; 1]
</code></pre><p> è¿™ä¸ªé¢˜ä¹Ÿè¿˜å¯ä»¥.</p>
<p> è¿™ä¸ªé¢˜ä¼šè®©äººè¯¯ä»¥ä¸ºæ˜¯ 2 &gt; 1 &amp;&amp; 2 &lt; 3 å…¶å®ä¸æ˜¯çš„.</p>
<p> è¿™ä¸ªé¢˜ç­‰ä»·äº</p>
<pre><code>1 &lt; 2 =&gt; true;
true &lt; 3 =&gt;  1 &lt; 3 =&gt; true;
3 &lt; 2 =&gt; false;
false &lt; 1 =&gt; 0 &lt; 1 =&gt; true;
</code></pre><p> ç­”æ¡ˆæ˜¯ [true, true]</p>
<h2 id="ç¬¬24é¢˜"><a href="#ç¬¬24é¢˜" class="headerlink" title="ç¬¬24é¢˜"></a>ç¬¬24é¢˜</h2><pre><code>// the most classic wtf
2 == [[[2]]]
</code></pre><p> è¿™ä¸ªé¢˜æˆ‘æ˜¯çŒœçš„. æˆ‘çŒœçš„ true, è‡³äºä¸ºä»€ä¹ˆâ€¦..</p>
<p> both objects get converted to strings and in both cases the resulting string is â€œ2â€ æˆ‘ä¸èƒ½ä¿¡æœâ€¦</p>
<h2 id="ç¬¬25é¢˜"><a href="#ç¬¬25é¢˜" class="headerlink" title="ç¬¬25é¢˜"></a>ç¬¬25é¢˜</h2><pre><code>3.toString()
3..toString()
3...toString()
</code></pre><p> è¿™ä¸ªé¢˜ä¹ŸæŒºé€—, æˆ‘åšå¯¹äº† :) ç­”æ¡ˆæ˜¯ error, â€˜3â€™, error</p>
<p> ä½ å¦‚æœæ¢ä¸€ä¸ªå†™æ³•å°±æ›´è´¹è§£äº†</p>
<pre><code>var a = 3;
a.toString()
</code></pre><p> è¿™ä¸ªç­”æ¡ˆå°±æ˜¯ â€˜3â€™;</p>
<p> ä¸ºå•¥å‘¢?</p>
<p> å› ä¸ºåœ¨ js ä¸­ 1.1, 1., .1 éƒ½æ˜¯åˆæ³•çš„æ•°å­—. é‚£ä¹ˆåœ¨è§£æ 3.toString çš„æ—¶å€™è¿™ä¸ª . åˆ°åº•æ˜¯å±äºè¿™ä¸ªæ•°å­—è¿˜æ˜¯å‡½æ•°è°ƒç”¨å‘¢? åªèƒ½æ˜¯æ•°å­—, å› ä¸º3.åˆæ³•å•Š!</p>
<h2 id="ç¬¬26é¢˜"><a href="#ç¬¬26é¢˜" class="headerlink" title="ç¬¬26é¢˜"></a>ç¬¬26é¢˜</h2><pre><code>(function(){
  var x = y = 1;
})();
console.log(y);
console.log(x);
</code></pre><p> ç­”æ¡ˆæ˜¯ 1, error</p>
<p> y è¢«èµ‹å€¼åˆ°å…¨å±€. x æ˜¯å±€éƒ¨å˜é‡. æ‰€ä»¥æ‰“å° x çš„æ—¶å€™ä¼šæŠ¥ ReferenceError</p>
<h2 id="ç¬¬27é¢˜"><a href="#ç¬¬27é¢˜" class="headerlink" title="ç¬¬27é¢˜"></a>ç¬¬27é¢˜</h2><pre><code>var a = /123/,
    b = /123/;
a == b
a === b
</code></pre><p> å³ä½¿æ­£åˆ™çš„å­—é¢é‡ä¸€è‡´, ä»–ä»¬ä¹Ÿä¸ç›¸ç­‰.</p>
<p> ç­”æ¡ˆ false, false</p>
<h2 id="ç¬¬28é¢˜"><a href="#ç¬¬28é¢˜" class="headerlink" title="ç¬¬28é¢˜"></a>ç¬¬28é¢˜</h2><pre><code>var a = [1, 2, 3],
    b = [1, 2, 3],
    c = [1, 2, 4]
a ==  b
a === b
a &gt;   c
a &lt;   c
</code></pre><p> å­—é¢é‡ç›¸ç­‰çš„æ•°ç»„ä¹Ÿä¸ç›¸ç­‰.</p>
<p> æ•°ç»„åœ¨æ¯”è¾ƒå¤§å°çš„æ—¶å€™æŒ‰ç…§å­—å…¸åºæ¯”è¾ƒ</p>
<p> ç­”æ¡ˆ false, false, false, true</p>
<h2 id="ç¬¬29é¢˜"><a href="#ç¬¬29é¢˜" class="headerlink" title="ç¬¬29é¢˜"></a>ç¬¬29é¢˜</h2><pre><code>var a = {}, b = Object.prototype;
[a.prototype === b, Object.getPrototypeOf(a) === b]
</code></pre><p> çŸ¥è¯†ç‚¹:</p>
<ul>
<li><p><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FObject%2FgetPrototypeOf" target="_blank" rel="noopener">Object/getPrototypeOf</a></p>
<p>åªæœ‰ Function æ‹¥æœ‰ä¸€ä¸ª prototype çš„å±æ€§. æ‰€ä»¥ a.prototype ä¸º undefined.</p>
<p>è€Œ Object.getPrototypeOf(obj) è¿”å›ä¸€ä¸ªå…·ä½“å¯¹è±¡çš„åŸå‹(è¯¥å¯¹è±¡çš„å†…éƒ¨[[prototype]]å€¼)</p>
<p>ç­”æ¡ˆ false, true</p>
</li>
</ul>
<h2 id="ç¬¬30é¢˜"><a href="#ç¬¬30é¢˜" class="headerlink" title="ç¬¬30é¢˜"></a>ç¬¬30é¢˜</h2><pre><code>function f() {}
var a = f.prototype, b = Object.getPrototypeOf(f);
a === b
</code></pre><p> f.prototype is the object that will become the parent of any objects created with new f while Object.getPrototypeOf returns the parent in the inheritance hierarchy.</p>
<p> f.prototype æ˜¯ä½¿ç”¨ä½¿ç”¨ new åˆ›å»ºçš„ f å®ä¾‹çš„åŸå‹. è€Œ Object.getPrototypeOf æ˜¯ f å‡½æ•°çš„åŸå‹.</p>
<p> è¯·çœ‹:</p>
<pre><code>a === Object.getPrototypeOf(new f()) // true
b === Function.prototype // true
</code></pre><p> ç­”æ¡ˆ false</p>
<h2 id="31"><a href="#31" class="headerlink" title="31"></a>31</h2><pre><code>function foo() { }
var oldName = foo.name;
foo.name = &quot;bar&quot;;
[oldName, foo.name]
</code></pre><p> ç­”æ¡ˆ [â€˜fooâ€™, â€˜fooâ€™]</p>
<p> çŸ¥è¯†ç‚¹:</p>
<ul>
<li><p><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FFunction%2Fname" target="_blank" rel="noopener">Function/name</a></p>
<p>å› ä¸ºå‡½æ•°çš„åå­—ä¸å¯å˜.</p>
</li>
</ul>
<h2 id="ç¬¬32é¢˜"><a href="#ç¬¬32é¢˜" class="headerlink" title="ç¬¬32é¢˜"></a>ç¬¬32é¢˜</h2><pre><code>&quot;1 2 3&quot;.replace(/\d/g, parseInt)
</code></pre><p> çŸ¥è¯†ç‚¹:</p>
<ul>
<li><p><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FString%2Freplace%23Specifying_a_function_as_a_parameter" target="_blank" rel="noopener">String/replace#Specifying_a_function_as_a_parameter</a></p>
<p>str.replace(regexp|substr, newSubStr|function)</p>
<p>å¦‚æœreplaceå‡½æ•°ä¼ å…¥çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯å‡½æ•°, é‚£ä¹ˆè¿™ä¸ªå‡½æ•°å°†æ¥å—å¦‚ä¸‹å‚æ•°</p>
</li>
<li><p>match é¦–å…ˆæ˜¯åŒ¹é…çš„å­—ç¬¦ä¸²</p>
</li>
<li>p1, p2 â€¦. ç„¶åæ˜¯æ­£åˆ™çš„åˆ†ç»„</li>
<li>offset match åŒ¹é…çš„index</li>
<li>string æ•´ä¸ªå­—ç¬¦ä¸²</li>
</ul>
<p>ç”±äºé¢˜ç›®ä¸­çš„æ­£åˆ™æ²¡æœ‰åˆ†ç»„, æ‰€ä»¥ç­‰ä»·äºé—®</p>
<pre><code>parseInt(&apos;1&apos;, 0)
parseInt(&apos;2&apos;, 2)
parseInt(&apos;3&apos;, 4)
</code></pre><p> ç­”æ¡ˆ: 1, NaN, 3</p>
<h2 id="ç¬¬33é¢˜"><a href="#ç¬¬33é¢˜" class="headerlink" title="ç¬¬33é¢˜"></a>ç¬¬33é¢˜</h2><pre><code>function f() {}
var parent = Object.getPrototypeOf(f);
f.name // ?
parent.name // ?
typeof eval(f.name) // ?
typeof eval(parent.name) //  ?
</code></pre><p> å…ˆè¯´ä»¥ä¸‹ç­”æ¡ˆ â€˜fâ€™, â€˜Emptyâ€™, â€˜functionâ€™, error è¿™ä¸ªç­”æ¡ˆå¹¶ä¸é‡è¦â€¦..</p>
<p> è¿™é‡Œç¬¬ä¸€å°é—®å’Œç¬¬ä¸‰å°é—®å¾ˆç®€å•ä¸è§£é‡Šäº†.</p>
<p> ç¬¬äºŒå°é—®ç¬”è€…åœ¨è‡ªå·±çš„æµè§ˆå™¨æµ‹è¯•çš„æ—¶å€™æ˜¯ â€˜â€™, ç¬¬å››é—®æ˜¯ â€˜undefinedâ€™</p>
<p> æ‰€ä»¥åº”è¯¥æ˜¯å¹³å°ç›¸å…³çš„. è¿™é‡Œæ˜ç™½ parent === Function.prototype å°±å¥½äº†.</p>
<h2 id="ç¬¬34é¢˜"><a href="#ç¬¬34é¢˜" class="headerlink" title="ç¬¬34é¢˜"></a>ç¬¬34é¢˜</h2><pre><code>var lowerCaseOnly =  /^[a-z]+$/;
[lowerCaseOnly.test(null), lowerCaseOnly.test()]
</code></pre><p> çŸ¥è¯†ç‚¹:</p>
<ul>
<li><p><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FRegExp%2Ftest" target="_blank" rel="noopener">RegExp/test</a></p>
<p>è¿™é‡Œ test å‡½æ•°ä¼šå°†å‚æ•°è½¬ä¸ºå­—ç¬¦ä¸². â€˜nulâ€™, â€˜undefinedâ€™ è‡ªç„¶éƒ½æ˜¯å…¨å°å†™äº†</p>
<p>ç­”æ¡ˆ: true, true</p>
</li>
</ul>
<h2 id="ç¬¬35é¢˜"><a href="#ç¬¬35é¢˜" class="headerlink" title="ç¬¬35é¢˜"></a>ç¬¬35é¢˜</h2><pre><code>[,,,].join(&quot;, &quot;)
</code></pre><p> [,,,] =&gt; [undefined Ã— 3]</p>
<p> å› ä¸ºjavascript åœ¨å®šä¹‰æ•°ç»„çš„æ—¶å€™å…è®¸æœ€åä¸€ä¸ªå…ƒç´ åè·Ÿä¸€ä¸ª,, æ‰€ä»¥è¿™æ˜¯ä¸ªé•¿åº¦ä¸ºä¸‰çš„ç¨€ç–æ•°ç»„(è¿™æ˜¯é•¿åº¦ä¸ºä¸‰, å¹¶æ²¡æœ‰ 0, 1, 2ä¸‰ä¸ªå±æ€§å“¦)</p>
<p> ç­”æ¡ˆ: â€œ, , â€œ</p>
<h2 id="ç¬¬36é¢˜"><a href="#ç¬¬36é¢˜" class="headerlink" title="ç¬¬36é¢˜"></a>ç¬¬36é¢˜</h2><pre><code>var a = {class: &quot;Animal&quot;, name: &apos;Fido&apos;};
a.class
</code></pre><p> è¿™ä¸ªé¢˜æ¯”è¾ƒæµæ°“.. å› ä¸ºæ˜¯æµè§ˆå™¨ç›¸å…³, classæ˜¯ä¸ªä¿ç•™å­—(ç°åœ¨æ˜¯ä¸ªå…³é”®å­—äº†)</p>
<p> æ‰€ä»¥ç­”æ¡ˆä¸é‡è¦, é‡è¦çš„æ˜¯è‡ªå·±åœ¨å–å±æ€§åç§°çš„æ—¶å€™å°½é‡é¿å…ä¿ç•™å­—. å¦‚æœä½¿ç”¨çš„è¯è¯·åŠ å¼•å· a[â€˜classâ€™]</p>
<h2 id="ç¬¬37é¢˜"><a href="#ç¬¬37é¢˜" class="headerlink" title="ç¬¬37é¢˜"></a>ç¬¬37é¢˜</h2><pre><code>var a = new Date(&quot;epoch&quot;)
</code></pre><p> çŸ¥è¯†ç‚¹:</p>
<ul>
<li><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FDate" target="_blank" rel="noopener">Date</a></li>
<li><p><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FDate%2Fparse" target="_blank" rel="noopener">Date/parse</a></p>
<p>ç®€å•æ¥è¯´, å¦‚æœè°ƒç”¨ Date çš„æ„é€ å‡½æ•°ä¼ å…¥ä¸€ä¸ªå­—ç¬¦ä¸²çš„è¯éœ€è¦ç¬¦åˆè§„èŒƒ, å³æ»¡è¶³ Date.parse çš„æ¡ä»¶.</p>
<p>å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ å¦‚æœæ ¼å¼é”™è¯¯ æ„é€ å‡½æ•°è¿”å›çš„ä»æ˜¯ä¸€ä¸ªDate çš„å®ä¾‹ Invalid Date.</p>
<p>ç­”æ¡ˆ Invalid Date</p>
</li>
</ul>
<h2 id="ç¬¬38é¢˜"><a href="#ç¬¬38é¢˜" class="headerlink" title="ç¬¬38é¢˜"></a>ç¬¬38é¢˜</h2><pre><code>var a = Function.length,
    b = new Function().length
a === b
</code></pre><p> æˆ‘ä»¬çŸ¥é“ä¸€ä¸ªfunction(Function çš„å®ä¾‹)çš„ length å±æ€§å°±æ˜¯å‡½æ•°ç­¾åçš„å‚æ•°ä¸ªæ•°, æ‰€ä»¥ b.length == 0.</p>
<p> å¦å¤– Function.length å®šä¹‰ä¸º1â€¦â€¦</p>
<p> æ‰€ä»¥ä¸ç›¸ç­‰â€¦â€¦.ç­”æ¡ˆ false</p>
<h2 id="ç¬¬39é¢˜"><a href="#ç¬¬39é¢˜" class="headerlink" title="ç¬¬39é¢˜"></a>ç¬¬39é¢˜</h2><pre><code>var a = Date(0);
var b = new Date(0);
var c = new Date();
[a === b, b === c, a === c]
</code></pre><p> è¿˜æ˜¯å…³äºDate çš„é¢˜, éœ€è¦æ³¨æ„çš„æ˜¯</p>
<ul>
<li>å¦‚æœä¸ä¼ å‚æ•°ç­‰ä»·äºå½“å‰æ—¶é—´.</li>
<li><p>å¦‚æœæ˜¯å‡½æ•°è°ƒç”¨ è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸².</p>
<p>ç­”æ¡ˆ false, false, false</p>
</li>
</ul>
<h2 id="ç¬¬40é¢˜"><a href="#ç¬¬40é¢˜" class="headerlink" title="ç¬¬40é¢˜"></a>ç¬¬40é¢˜</h2><pre><code>var min = Math.min(), max = Math.max()
min &lt; max
</code></pre><p> çŸ¥è¯†ç‚¹:</p>
<ul>
<li><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FMath%2Fmin" target="_blank" rel="noopener">Math/min</a></li>
<li><p><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FMath%2Fmax" target="_blank" rel="noopener">Math/max</a></p>
<p>æœ‰è¶£çš„æ˜¯, Math.min ä¸ä¼ å‚æ•°è¿”å› Infinity, Math.max ä¸ä¼ å‚æ•°è¿”å› -InfinityğŸ˜†</p>
<p>ç­”æ¡ˆ: false</p>
</li>
</ul>
<h2 id="ç¬¬41é¢˜"><a href="#ç¬¬41é¢˜" class="headerlink" title="ç¬¬41é¢˜"></a>ç¬¬41é¢˜</h2><pre><code>function captureOne(re, str) {
  var match = re.exec(str);
  return match &amp;&amp; match[1];
}
var numRe  = /num=(\d+)/ig,
    wordRe = /word=(\w+)/i,
    a1 = captureOne(numRe,  &quot;num=1&quot;),
    a2 = captureOne(wordRe, &quot;word=1&quot;),
    a3 = captureOne(numRe,  &quot;NUM=2&quot;),
    a4 = captureOne(wordRe,  &quot;WORD=2&quot;);
[a1 === a2, a3 === a4]
</code></pre><p> çŸ¥è¯†ç‚¹:</p>
<ul>
<li><p><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FRegExp%2Fexec" target="_blank" rel="noopener">RegExp/exec</a></p>
<p>é€šä¿—çš„è®²</p>
<p>å› ä¸ºç¬¬ä¸€ä¸ªæ­£åˆ™æœ‰ä¸€ä¸ª g é€‰é¡¹ å®ƒä¼šâ€˜è®°å¿†â€™ä»–æ‰€åŒ¹é…çš„å†…å®¹, ç­‰åŒ¹é…åä»–ä¼šä»ä¸Šæ¬¡åŒ¹é…çš„ç´¢å¼•ç»§ç»­, è€Œç¬¬äºŒä¸ªæ­£åˆ™ä¸ä¼š</p>
</li>
</ul>
<p>ä¸¾ä¸ªä¾‹å­</p>
<pre><code>var myRe = /ab*/g;
var str = &apos;abbcdefabh&apos;;
var myArray;
while ((myArray = myRe.exec(str)) !== null) {
  var msg = &apos;Found &apos; + myArray[0] + &apos;. &apos;;
  msg += &apos;Next match starts at &apos; + myRe.lastIndex;
  console.log(msg);
}
// Found abb. Next match starts at 3
// Found ab. Next match starts at 9
</code></pre><p> æ‰€ä»¥ a1 = â€˜1â€™; a2 = â€˜1â€™; a3 = null; a4 = â€˜2â€™</p>
<p> ç­”æ¡ˆ [true, false]</p>
<h2 id="ç¬¬42é¢˜"><a href="#ç¬¬42é¢˜" class="headerlink" title="ç¬¬42é¢˜"></a>ç¬¬42é¢˜</h2><pre><code>var a = new Date(&quot;2014-03-19&quot;),
    b = new Date(2014, 03, 19);
[a.getDay() === b.getDay(), a.getMonth() === b.getMonth()]
</code></pre><p> è¿™ä¸ªâ€¦.</p>
<blockquote>
<p> JavaScript inherits 40 years old design from C: days are 1-indexed in Câ€™s struct tm, but months are 0 indexed. In addition to that, getDay returns the 0-indexed day of the week, to get the 1-indexed day of the month you have to use getDate,<br>                    which doesnâ€™t return a Date object.</p>
</blockquote>
<pre><code>a.getDay()
3
b.getDay()
6
a.getMonth()
2
b.getMonth()
3
</code></pre><p> éƒ½æ˜¯å¥—è·¯!</p>
<p> ç­”æ¡ˆ [false, false]</p>
<h2 id="ç¬¬43é¢˜"><a href="#ç¬¬43é¢˜" class="headerlink" title="ç¬¬43é¢˜"></a>ç¬¬43é¢˜</h2><pre><code>if (&apos;http://giftwrapped.com/picture.jpg&apos;.match(&apos;.gif&apos;)) {
  &apos;a gif file&apos;
} else {
  &apos;not a gif file&apos;
}
</code></pre><p> çŸ¥è¯†ç‚¹:</p>
<ul>
<li><p><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FString%2Fmatch" target="_blank" rel="noopener">String/match</a></p>
<p>String.prototype.match æ¥å—ä¸€ä¸ªæ­£åˆ™, å¦‚æœä¸æ˜¯, æŒ‰ç…§ new RegExp(obj) è½¬åŒ–. æ‰€ä»¥ . å¹¶ä¸ä¼šè½¬ä¹‰<br>é‚£ä¹ˆ /gif å°±åŒ¹é…äº† /.gif/</p>
<p>ç­”æ¡ˆ: â€˜a gif fileâ€™</p>
</li>
</ul>
<h2 id="ç¬¬44é¢˜"><a href="#ç¬¬44é¢˜" class="headerlink" title="ç¬¬44é¢˜"></a>ç¬¬44é¢˜</h2><pre><code>function foo(a) {
    var a;
    return a;
}
function bar(a) {
    var a = &apos;bye&apos;;
    return a;
}
[foo(&apos;hello&apos;), bar(&apos;hello&apos;)]
</code></pre><p> åœ¨ä¸¤ä¸ªå‡½æ•°é‡Œ, aä½œä¸ºå‚æ•°å…¶å®å·²ç»å£°æ˜äº†, æ‰€ä»¥ var a; var a = â€˜byeâ€™ å…¶å®å°±æ˜¯ a; a =â€™byeâ€™</p>
<p> æ‰€ä»¥ç­”æ¡ˆ â€˜helloâ€™, â€˜byeâ€™</p>
<p> å…¨éƒ¨ç»“æŸ!</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/05/ES6æ¨¡æ‹Ÿcall-apply-bind/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/05/ES6æ¨¡æ‹Ÿcall-apply-bind/" itemprop="url">ES6æ¨¡æ‹Ÿcall,apply,bind</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-12-05T20:06:26+08:00">
                2018-12-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="ES6è‡ªå·±å®ç°"><a href="#ES6è‡ªå·±å®ç°" class="headerlink" title="ES6è‡ªå·±å®ç°"></a>ES6è‡ªå·±å®ç°</h3><blockquote>
<p>call</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Function.prototype.call2 = function(context,...list) &#123;</span><br><span class="line">	context = context || window;</span><br><span class="line">	context.fn = this;			 </span><br><span class="line">	let result = context.fn(...list);</span><br><span class="line">	delete context.fn</span><br><span class="line">	return result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var value = &quot;JS&quot;;</span><br><span class="line">var foo = &#123;</span><br><span class="line">	value: &quot;Node&quot;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">function bar(...list) &#123;</span><br><span class="line">	console.log(this.value);</span><br><span class="line">	console.log(list)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bar.call2(foo,1,2,3);</span><br><span class="line">bar.call2(null,4,5,6);</span><br><span class="line">bar.call2(undefined,4,5,6);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>apply</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Function.prototype.apply2 = function(context,arr) &#123;</span><br><span class="line">	context = context || window;</span><br><span class="line">	context.fn = this;			 </span><br><span class="line">	let result = context.fn(...arr);</span><br><span class="line">	delete context.fn</span><br><span class="line">	return result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var value = &quot;JS&quot;;</span><br><span class="line">var foo = &#123;</span><br><span class="line">	value: &quot;Node&quot;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">function bar(...list) &#123;</span><br><span class="line">	console.log(this.value);</span><br><span class="line">	console.log(list)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bar.apply2(foo,[1,2,3]);</span><br><span class="line">bar.apply2(null,[4,5,6]);</span><br><span class="line">bar.apply2(undefined,[4,5,6]);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>bind1</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Function.prototype.bind1 = function(context, ...arr1) &#123;</span><br><span class="line">	let func = this;</span><br><span class="line">	return function(...arr2) &#123;</span><br><span class="line">	</span><br><span class="line">		//func.apply(context, [...arr1, ...arr2]);</span><br><span class="line">		</span><br><span class="line">		func.call(context, ...arr1, ...arr2);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var value = &quot;JS&quot;;</span><br><span class="line">var foo = &#123;</span><br><span class="line">	value: &quot;Node&quot;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">function bar(...list) &#123;</span><br><span class="line">	console.log(this.value);</span><br><span class="line">	console.log(list)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bar.bind1(foo, 1, 2)(3, 4);</span><br><span class="line">bar.bind1(null, 5, 6)(7, 8);</span><br><span class="line">bar.bind1(null)(5, 6, 7, 8);</span><br><span class="line">bar.bind1(undefined)(5, 6, 7, 8);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>bind2</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Function.prototype.bind2 = function(context, ...arr1) &#123;</span><br><span class="line">	context = context || window;</span><br><span class="line">	context.fn = this;</span><br><span class="line">	return function(...arr2) &#123;</span><br><span class="line">		return context.fn(...arr1, ...arr2);</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var value = &quot;JS&quot;;</span><br><span class="line">var foo = &#123;</span><br><span class="line">	value: &quot;Node&quot;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">function bar(...list) &#123;</span><br><span class="line">	console.log(this.value);</span><br><span class="line">	console.log(list)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bar.bind2(foo, 1, 2)(3, 4);</span><br><span class="line">bar.bind2(null, 5, 6)(7, 8);</span><br><span class="line">bar.bind2(null)(5, 6, 7, 8);</span><br><span class="line">bar.bind2(undefined)(5, 6, 7, 8);</span><br></pre></td></tr></table></figure>
<h3 id="æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ"><a href="#æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ" class="headerlink" title="æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ"></a>æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h3><p>å‰é¢æˆ‘ä»¬ç”¨çš„ eval æ–¹å¼å¯ä»¥ç”¨ ES6 çš„è§£å†³è¿˜å­˜åœ¨çš„ä¸€äº›é—®é¢˜ï¼Œæœ‰æ²¡æœ‰æ³¨æ„åˆ°ï¼Œè¿™æ®µä»£ç æ˜¯æœ‰é—®é¢˜çš„ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">context.fn = this;</span><br></pre></td></tr></table></figure></p>
<p><strong> å‡å¦‚å¯¹è±¡åœ¨è¢« call è°ƒç”¨å‰ï¼Œå·²ç»æœ‰ fn å±æ€§æ€ä¹ˆåŠï¼Ÿ </strong></p>
<p>ES6 ä¸­æä¾›äº†ä¸€ç§æ–°çš„åŸºæœ¬æ•°æ®ç±»å‹ï¼ŒSymbolï¼Œè¡¨ç¤ºç‹¬ä¸€æ— äºŒçš„å€¼ï¼Œå¦å¤–ï¼ŒSymbol ä½œä¸ºå±æ€§çš„æ—¶å€™ï¼Œä¸èƒ½ä½¿ç”¨ç‚¹è¿ç®—ç¬¦ã€‚æ‰€ä»¥å†åŠ ä¸Š ES çš„ rest å‰©ä½™å‚æ•°æ›¿ä»£ arguments éå†çš„å·¥ä½œå°±æœ‰ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Function.prototype.newCall = function (context,...params) &#123;</span><br><span class="line">    if (typeof context === &apos;object&apos;) &#123;</span><br><span class="line">        context = context || window</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        context = Object.create(null);</span><br><span class="line">    &#125;</span><br><span class="line">    let fn = Symbol();</span><br><span class="line">    context[fn] = thisvar result = context[fn](...params);</span><br><span class="line"></span><br><span class="line">    delete context.fn;</span><br><span class="line">    return result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var person = &#123;</span><br><span class="line">    name: &quot;jayChou&quot;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">functionsay(age, sex) &#123;</span><br><span class="line">    console.log(`name: $&#123;this.name&#125;,age: $&#123;age&#125;, sex: $&#123;sex&#125;`);</span><br><span class="line">    return age + sex;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var check = say.newCall(person, 18, &apos;ç”·&apos;);</span><br><span class="line">console.log(check); // 18ç”·</span><br></pre></td></tr></table></figure>
<p>apply å’Œ call çš„å®ç°åŸç†ï¼ŒåŸºæœ¬ç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äº apply çš„å‚æ•°æ˜¯ä»¥æ•°ç»„çš„å½¢å¼ä¼ å…¥</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Function.prototype.newApply = function(context, parameter) &#123;</span><br><span class="line">  if (typeof context === &apos;object&apos;) &#123;</span><br><span class="line">    context = context || window</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    context = Object.create(null)</span><br><span class="line">  &#125;</span><br><span class="line">  let fn = Symbol()</span><br><span class="line">  context[fn] = this;</span><br><span class="line">  var result = context[fn](...parameter);</span><br><span class="line">  delete context[fn];</span><br><span class="line">  return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/01/JSå°¾é€’å½’/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/01/JSå°¾é€’å½’/" itemprop="url">JSå°¾é€’å½’</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-12-01T19:11:17+08:00">
                2018-12-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="æºäºå‰ç«¯ç¾¤é‡Œé¢çš„ä¸€é“ç¤¾æ‹›ç¬”è¯•é¢˜"><a href="#æºäºå‰ç«¯ç¾¤é‡Œé¢çš„ä¸€é“ç¤¾æ‹›ç¬”è¯•é¢˜" class="headerlink" title="æºäºå‰ç«¯ç¾¤é‡Œé¢çš„ä¸€é“ç¤¾æ‹›ç¬”è¯•é¢˜"></a>æºäºå‰ç«¯ç¾¤é‡Œé¢çš„ä¸€é“ç¤¾æ‹›ç¬”è¯•é¢˜</h3><blockquote>
<p>å®ç°ä¸€ä¸ªæ–æ³¢æ‹‰å¥‘æ•°åˆ—ï¼Œ å·²çŸ¥ç¬¬ä¸€é¡¹ä¸º0ï¼Œç¬¬äºŒé¡¹ä¸º1ï¼Œç¬¬ä¸‰é¡¹ä¸º1ï¼Œåä¸€é¡¹æ˜¯å‰ä¸¤é¡¹ä¹‹å’Œ,å¦‚ä¸‹ï¼Œå³<code>f(n) = f(n - 1) + f(n -2)</code>ã€‚</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0, 1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144, 233, 377, 610, 987, ...</span><br></pre></td></tr></table></figure>
<p>æ‹¿åˆ°è¿™ä¸ªé¢˜ç›®ï¼ŒäºŒè¯æ²¡æƒ³å°±å†™äº†,æ‰”åˆ°ç¾¤é‡Œ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function f(n) &#123;</span><br><span class="line">    if(n === 0) return0;</span><br><span class="line">    if(n === 1) return1;</span><br><span class="line">    return f(n - 1) + f(n -2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ç¾¤é‡Œæœ‰å¤§ç¥æé†’è¿™ä¸ªé¢˜æ”¾åˆ°ç¤¾æ‹›é¢˜é‡Œé¢æ˜æ˜¾æ²¡è¿™ä¹ˆç®€å•ï¼Œæ¯æ¬¡é€’å½’è°ƒç”¨éƒ½ä¼šå‘ˆæŒ‡æ•°å¾€è°ƒç”¨æ ˆé‡Œå¢åŠ è®°å½•<code>è°ƒç”¨å¸§</code>ï¼Œè¿™æ ·åšï¼Œå½“é¡¹æ¯”è¾ƒå¤šï¼Œå°±ä¼šå‡ºç°<code>æ ˆæº¢å‡º</code>çš„ï¼ï¼ï¼</p>
<p>ä¹Ÿå°±æ˜¯ï¼Œä»¥ä¸ŠCodeåªèƒ½è¯´åˆšåˆšåŠæ ¼ï¼Œæ­£ç¡®å§¿åŠ¿åº”è¯¥ç”¨<strong>å°¾é€’å½’ä¼˜åŒ–</strong>ï¼Œ<code>è°ƒç”¨å¸§</code>ä¿æŒåªæœ‰ä¸€ä¸ªã€‚</p>
<blockquote>
<p>æ­£è§£å°±æ˜¯ï¼š</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function f(n, prev, next) &#123;</span><br><span class="line">    if(n &lt;= 1) &#123;</span><br><span class="line">        return next;</span><br><span class="line">    &#125;</span><br><span class="line">    return f(n - 1, next, prev + next);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢æ¥å¤ä¹ ä¸€ä¸‹çŸ¥è¯†ç‚¹ï¼šå°¾è°ƒç”¨å’Œå°¾é€’å½’ã€‚</p>
<h3 id="å°¾è°ƒä¼˜åŒ–"><a href="#å°¾è°ƒä¼˜åŒ–" class="headerlink" title="å°¾è°ƒä¼˜åŒ–"></a>å°¾è°ƒä¼˜åŒ–</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">// å°¾é€’å½’æ–¹å¼</span><br><span class="line">function factorial1(n,total) &#123;</span><br><span class="line">    if (n === 1) &#123;</span><br><span class="line">        return total;</span><br><span class="line">    &#125;</span><br><span class="line">    return factorial1(n - 1, n * total);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// æ™®é€šé€’å½’æ–¹å¼</span><br><span class="line">function factorial2(n) &#123;</span><br><span class="line">    if (n === 1) &#123;</span><br><span class="line">        return 1;</span><br><span class="line">    &#125;</span><br><span class="line">    return n * factorial2(n - 1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">console.log(factorial1(25,1)); // 1.5511210043330984e+25 </span><br><span class="line">console.log(factorial2(25)); // 1.5511210043330986e+25</span><br></pre></td></tr></table></figure>
<p>åœ¨çŸ¥é“å°¾é€’å½’ä¹‹å‰ï¼Œæˆ‘ä»¬è¦ç›´åˆ°ä»€ä¹ˆæ˜¯å°¾è°ƒç”¨ä¼˜åŒ–ï¼Œå› ä¸ºå°¾è°ƒç”¨ä¼˜åŒ–æ˜¯å°¾é€’å½’çš„åŸºç¡€ã€‚<br><strong>å°¾è°ƒç”¨å°±æ˜¯ï¼šåœ¨å‡½æ•°çš„æœ€åä¸€æ­¥è°ƒç”¨å¦ä¸€ä¸ªå‡½æ•°ã€‚</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function f() &#123;</span><br><span class="line">  return g()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p><strong>æœ€åä¸€æ­¥å¿…é¡»æ˜¯è°ƒç”¨å¦ä¸€å‡½æ•°ï¼Œè€Œä¸èƒ½æ˜¯ä¸€ä¸ªå¸¸é‡æˆ–æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå¦‚ <code>return y</code>æˆ– <code>return g() + 1</code></strong></p>
</blockquote>
<h4 id="å°¾è°ƒç”¨ä¼˜åŒ–çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#å°¾è°ƒç”¨ä¼˜åŒ–çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="å°¾è°ƒç”¨ä¼˜åŒ–çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"></a>å°¾è°ƒç”¨ä¼˜åŒ–çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>æŒ‰ç…§<a href="http://es6.ruanyifeng.com/#docs/function#%E5%B0%BE%E8%B0%83%E7%94%A8%E4%BC%98%E5%8C%96" target="_blank" rel="noopener">é˜®ä¸€å³°è€å¸ˆåœ¨es6çš„å‡½æ•°æ‰©å±•</a>ä¸­çš„è§£é‡Šå°±æ˜¯ï¼š</p>
<p>å°¾è°ƒç”¨ä¹‹æ‰€ä»¥ä¸å…¶ä»–è°ƒç”¨ä¸åŒï¼Œå°±åœ¨äºå®ƒçš„ç‰¹æ®Šçš„è°ƒç”¨ä½ç½®ã€‚</p>
<p><span style="border-bottom:2px solid red;">æˆ‘ä»¬çŸ¥é“ï¼Œå‡½æ•°è°ƒç”¨ä¼šåœ¨å†…å­˜å½¢æˆä¸€ä¸ªâ€œè°ƒç”¨è®°å½•â€ï¼Œåˆç§°â€œè°ƒç”¨å¸§â€ï¼ˆcall frameï¼‰ï¼Œä¿å­˜è°ƒç”¨ä½ç½®å’Œå†…éƒ¨å˜é‡ç­‰ä¿¡æ¯ã€‚å¦‚æœåœ¨å‡½æ•°Açš„å†…éƒ¨è°ƒç”¨å‡½æ•°Bï¼Œé‚£ä¹ˆåœ¨Açš„è°ƒç”¨å¸§ä¸Šæ–¹ï¼Œè¿˜ä¼šå½¢æˆä¸€ä¸ªBçš„è°ƒç”¨å¸§ã€‚ç­‰åˆ°Bè¿è¡Œç»“æŸï¼Œå°†ç»“æœè¿”å›åˆ°Aï¼ŒBçš„è°ƒç”¨å¸§æ‰ä¼šæ¶ˆå¤±ã€‚å¦‚æœå‡½æ•°Bå†…éƒ¨è¿˜è°ƒç”¨å‡½æ•°Cï¼Œé‚£å°±è¿˜æœ‰ä¸€ä¸ªCçš„è°ƒç”¨å¸§ï¼Œä»¥æ­¤ç±»æ¨ã€‚æ‰€æœ‰çš„è°ƒç”¨å¸§ï¼Œå°±å½¢æˆä¸€ä¸ªâ€œè°ƒç”¨æ ˆâ€ï¼ˆcall stackï¼‰ã€‚</span></p>
<p><font color="#dd0000"><strong> å°¾è°ƒç”¨ç”±äºæ˜¯å‡½æ•°çš„æœ€åä¸€æ­¥æ“ä½œï¼Œæ‰€ä»¥ä¸éœ€è¦ä¿ç•™å¤–å±‚å‡½æ•°çš„è°ƒç”¨å¸§ï¼Œå› ä¸ºè°ƒç”¨ä½ç½®ã€å†…éƒ¨å˜é‡ç­‰ä¿¡æ¯éƒ½ä¸ä¼šå†ç”¨åˆ°äº†ï¼Œåªè¦ç›´æ¥ç”¨å†…å±‚å‡½æ•°çš„è°ƒç”¨å¸§ï¼Œå–ä»£å¤–å±‚å‡½æ•°çš„è°ƒç”¨å¸§å°±å¯ä»¥äº†ã€‚</strong></font><br> </p>
<p>è¿™é‡Œçš„â€œè°ƒç”¨å¸§â€å’Œâ€œè°ƒç”¨æ ˆâ€ï¼Œè¯´çš„åº”è¯¥å°±æ˜¯â€œæ‰§è¡Œç¯å¢ƒâ€å’Œâ€œä½œç”¨åŸŸé“¾â€ã€‚å› ä¸ºå°¾è°ƒç”¨æ—¶å‡½æ•°çš„æœ€åä¸€éƒ¨æ“ä½œï¼Œæ‰€ä»¥ä¸å†éœ€è¦ä¿ç•™å¤–å±‚çš„è°ƒç”¨å¸§ï¼Œè€Œæ˜¯ç›´æ¥å–ä»£å¤–å±‚çš„è°ƒç”¨å¸§ï¼Œæ‰€ä»¥å¯ä»¥èµ·åˆ°ä¸€ä¸ªä¼˜åŒ–çš„ä½œç”¨ã€‚</p>
<h3 id="å°¾è°ƒç”¨"><a href="#å°¾è°ƒç”¨" class="headerlink" title="å°¾è°ƒç”¨"></a>å°¾è°ƒç”¨</h3><p>å°¾è°ƒç”¨æ˜¯æŒ‡æŸä¸ªå‡½æ•°çš„æœ€åä¸€æ­¥æ˜¯è°ƒç”¨å¦ä¸€ä¸ªå‡½æ•°ã€‚  </p>
<p>å°¾è°ƒç”¨ä¹‹æ‰€ä»¥ä¸å…¶ä»–è°ƒç”¨ä¸åŒï¼Œå°±åœ¨äºå®ƒçš„ç‰¹æ®Šçš„è°ƒç”¨ä½ç½®ã€‚</p>
<p>ä»¥ä¸‹ä¸‰ç§æƒ…å†µéƒ½ä¸æ˜¯å°¾è°ƒç”¨ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// æƒ…å†µä¸€</span><br><span class="line">function f(x) &#123;</span><br><span class="line">    let y = g(x);</span><br><span class="line">    return y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// æƒ…å†µäºŒ</span><br><span class="line">function f(x) &#123;</span><br><span class="line">    return g(x) + 1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// æƒ…å†µä¸‰</span><br><span class="line">function f(x) &#123;</span><br><span class="line">    g(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æƒ…å†µä¸€æ˜¯è°ƒç”¨å‡½æ•°<code>g</code>ä¹‹åï¼Œè¿˜æœ‰èµ‹å€¼æ“ä½œï¼Œæ‰€ä»¥ä¸å±äºå°¾è°ƒç”¨ï¼Œå³ä½¿è¯­ä¹‰å®Œå…¨ä¸€æ ·ã€‚æƒ…å†µäºŒä¹Ÿæ˜¯å±äºè°ƒç”¨åè¿˜æœ‰æ“ä½œã€‚æƒ…å†µä¸‰ç­‰åŒäºï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">g(x);</span><br><span class="line">return undefined;</span><br></pre></td></tr></table></figure></p>
<p>å‡½æ•°è°ƒç”¨ä¼šåœ¨å†…å­˜å½¢æˆä¸€ä¸ªâ€œè°ƒç”¨è®°å½•â€ï¼Œåˆç§°â€œè°ƒç”¨å¸§â€ï¼Œä¿å­˜è°ƒç”¨ä½ç½®å’Œå†…å­˜å˜é‡ç­‰ä¿¡æ¯ã€‚å¦‚æœåœ¨å‡½æ•°<code>A</code>çš„å†…éƒ¨è°ƒç”¨å‡½æ•°<code>B</code>ï¼Œé‚£ä¹ˆåœ¨<code>A</code>çš„è°ƒç”¨å¸§ä¸Šæ–¹ï¼Œè¿˜ä¼šå½¢æˆä¸€ä¸ª<code>B</code>çš„è°ƒç”¨å¸§ã€‚ç­‰åˆ°<code>B</code>è¿è¡Œç»“æŸï¼Œå°†ç»“æœè¿”å›åˆ°<code>A</code>ï¼Œ<code>B</code>çš„è°ƒç”¨å¸§æ‰ä¼šæ¶ˆå¤±ã€‚å¦‚æœå‡½æ•°<code>B</code>å†…éƒ¨è¿˜è°ƒç”¨å‡½æ•°<code>C</code>ï¼Œé‚£å°±è¿˜æœ‰ä¸€ä¸ª<code>C</code>çš„è°ƒç”¨å¸§ï¼Œä¾æ¬¡ç±»æ¨ã€‚æ‰€æœ‰çš„è°ƒç”¨å¸§ï¼Œå°±å½¢æˆä¸€ä¸ªâ€œè°ƒç”¨æ ˆâ€ã€‚</p>
<p>å°¾è°ƒç”¨ç”±äºæ˜¯å‡½æ•°çš„æœ€åä¸€æ­¥æ“ä½œï¼Œæ‰€æœ‰ä¸éœ€è¦ä¿ç•™å¤–å±‚å‡½æ•°çš„è°ƒç”¨å¸§ï¼Œå› ä¸ºè°ƒç”¨ä½ç½®ã€å†…éƒ¨å˜é‡ç­‰ä¿¡æ¯éƒ½ä¸ä¼šå†ç”¨åˆ°äº†ï¼Œåªè¦ç›´æ¥ç”¨å†…å±‚å‡½æ•°çš„è°ƒç”¨å¸§ï¼Œå–ä»£å¤–å±‚å‡½æ•°çš„è°ƒç”¨å¸§å°±å¯ä»¥äº†ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">function f() &#123;</span><br><span class="line">    let m = 1;</span><br><span class="line">    let n = 2;</span><br><span class="line">    return g(m + n);</span><br><span class="line">&#125;</span><br><span class="line">f();</span><br><span class="line"></span><br><span class="line">// ç­‰åŒäº</span><br><span class="line">function f() &#123;</span><br><span class="line">    return g(3);</span><br><span class="line">&#125;</span><br><span class="line">f();</span><br><span class="line"></span><br><span class="line">// ç­‰åŒäº</span><br><span class="line">g(3);</span><br></pre></td></tr></table></figure></p>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œå¦‚æœå‡½æ•°gä¸æ˜¯å°¾è°ƒç”¨ï¼Œå‡½æ•°få°±éœ€è¦ä¿å­˜å†…éƒ¨å˜é‡må’Œnçš„å€¼ã€gçš„è°ƒç”¨ä½ç½®ç­‰ä¿¡æ¯ã€‚ä½†ç”±äºè°ƒç”¨gä¹‹åï¼Œå‡½æ•°få°±ç»“æŸäº†ï¼Œæ‰€ä»¥æ‰§è¡Œåˆ°æœ€åä¸€æ­¥ï¼Œå®Œå…¨å¯ä»¥åˆ é™¤f(x)çš„è°ƒç”¨å¸§ï¼Œåªä¿ç•™g(3)çš„è°ƒç”¨å¸§ã€‚</p>
<p>è¿™å°±å«åšâ€œå°¾è°ƒç”¨ä¼˜åŒ–â€ï¼ˆTail call optimizationï¼‰ï¼Œå³åªä¿ç•™å†…å±‚å‡½æ•°çš„è°ƒç”¨å¸§ã€‚å¦‚æœæ‰€æœ‰å‡½æ•°éƒ½æ˜¯å°¾è°ƒç”¨ï¼Œé‚£ä¹ˆå®Œå…¨å¯ä»¥åšåˆ°æ¯æ¬¡æ‰§è¡Œæ—¶ï¼Œè°ƒç”¨å¸§åªæœ‰ä¸€é¡¹ï¼Œè¿™å°†å¤§å¤§èŠ‚çœå†…å­˜ã€‚è¿™å°±æ˜¯â€œå°¾è°ƒç”¨ä¼˜åŒ–â€çš„æ„ä¹‰ã€‚</p>
<p>å¦‚æœæ‰€æœ‰å‡½æ•°éƒ½æ˜¯å°¾è°ƒç”¨ï¼Œé‚£ä¹ˆå®Œå…¨å¯ä»¥åšåˆ°æ¯æ¬¡æ‰§è¡Œæ—¶ï¼Œè°ƒç”¨å¸§åªæœ‰ä¸€é¡¹ï¼Œè¿™å°†å¤§å¤§èŠ‚çœå†…å­˜ã€‚è¿™å°±æ˜¯â€œå°¾è°ƒç”¨ä¼˜åŒ–â€ã€‚</p>
<p><strong>æ³¨æ„</strong>:åªæœ‰ä¸å†ç”¨åˆ°å¤–å±‚å‡½æ•°çš„å†…éƒ¨å˜é‡ï¼Œå†…å±‚å‡½æ•°çš„è°ƒç”¨å¸§æ‰ä¼šå–ä»£å¤–å±‚å‡½æ•°çš„è°ƒç”¨å¸§ï¼Œå¦åˆ™å°±æ— æ³•è¿›è¡Œâ€œå°¾è°ƒç”¨ä¼˜åŒ–â€ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function addOne(a) &#123;</span><br><span class="line">    var one = 1;</span><br><span class="line">    function inner(b) &#123;</span><br><span class="line">        return b + one;</span><br><span class="line">    &#125;</span><br><span class="line">    return inner(a);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<table><tr><td bgcolor="#C0FF3E"><font color="#dd0000"> ä¸Šé¢çš„å‡½æ•°ä¸ä¼šè¿›è¡Œå°¾è°ƒç”¨ä¼˜åŒ–ï¼Œå› ä¸ºå†…å±‚å‡½æ•°innerç”¨åˆ°äº†å¤–å±‚å‡½æ•°addOneçš„å†…éƒ¨å˜é‡oneã€‚è¿™ä¸€æ˜¯é—­åŒ…å¸¸é©»å†…å­˜çš„åŸå› ï¼ï¼ï¼</font></td></tr></table>

<h3 id="å°¾é€’å½’"><a href="#å°¾é€’å½’" class="headerlink" title="å°¾é€’å½’"></a>å°¾é€’å½’</h3><p><span style="border-bottom:2px solid red;">å‡½æ•°è°ƒç”¨è‡ªèº«ï¼Œç§°ä¸ºé€’å½’ã€‚å¦‚æœå°¾è°ƒç”¨è‡ªèº«ï¼Œå°±ç§°ä¸ºå°¾é€’å½’ã€‚</span></p>
<p><span style="border-bottom:2px solid red;">é€’å½’éå¸¸è€—è´¹å†…å­˜ï¼Œå› ä¸ºéœ€è¦åŒæ—¶ä¿å­˜æˆç™¾ä¸Šåƒè°ƒç”¨å¸§ï¼Œå¾ˆå®¹æ˜“å‘ç”Ÿâ€œæ ˆæº¢å‡ºâ€é”™è¯¯ã€‚ä½†å¯¹äºå°¾é€’å½’æ¥è¯´ï¼Œç”±äºåªå­˜åœ¨ä¸€ä¸ªè°ƒç”¨å¸§ï¼Œæ‰€ä»¥æ°¸è¿œä¸ä¼šå‘ç”Ÿâ€œæ ˆæº¢å‡ºâ€é”™è¯¯ã€‚</span><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function factorial(n) &#123;</span><br><span class="line">    if (n === 1) return1;</span><br><span class="line">    return n * factorial(n - 1);</span><br><span class="line">&#125;</span><br><span class="line">console.log(factorial(5)); // 120</span><br></pre></td></tr></table></figure></p>
<p>ä¸Šé¢æœ€å¤šä¿å­˜<code>n</code>ä¸ªè°ƒç”¨è®°å½•ï¼Œå¤æ‚åº¦æ˜¯<code>O(n)</code>ã€‚</p>
<p>å¦‚æœæ”¹æˆå°¾é€’å½’ï¼Œåªä¿ç•™ä¸€ä¸ªè°ƒç”¨è®°å½•ï¼Œå¤æ‚åº¦<code>O(1)</code>ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function factorial(n, total) &#123;</span><br><span class="line">    if (n === 0) return total;</span><br><span class="line">    return factorial(n - 1, n * total);</span><br><span class="line">&#125;</span><br><span class="line">console.log(factorial(5, 1)); // 120</span><br></pre></td></tr></table></figure></p>
<p>ä¸‹é¢å›åˆ°æˆ‘ä»¬çš„ä¸»é¢˜ï¼Œè®¡ç®—Fibonacciæ•°åˆ—ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function fibonacci(n) &#123;</span><br><span class="line">    if(n &lt;= 1) return 1;</span><br><span class="line">    return fibonacci(n -1) + fibonacci(n -2);</span><br><span class="line">&#125;</span><br><span class="line">console.log(fibonacci(10)); // 89</span><br><span class="line">console.log(fibonacci(50)); // stack overflow</span><br></pre></td></tr></table></figure></p>
<p>ä¸Šé¢ä¸ä½¿ç”¨å°¾é€’å½’ï¼Œé¡¹æ•°ç¨å¤§ç‚¹å°±å‘ç”Ÿâ€æ ˆæº¢å‡ºâ€œäº†ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function fibonacci(n, prev, next) &#123;</span><br><span class="line">    if(n &lt;= 1) return next;</span><br><span class="line">    return fibonacci(n-1, next, prev + next);</span><br><span class="line">&#125;</span><br><span class="line">console.log(fibonacci(10, 1, 1)); // 89</span><br><span class="line">console.log(fibonacci(100, 1, 1)); // 573147844013817200000</span><br><span class="line">console.log(fibonacci(1000, 1, 1)); // 7.0330367711422765e+208</span><br></pre></td></tr></table></figure></p>
<p>ä¸Šé¢é¡¹æ•°å†å¤§éƒ½çŠ¶æ€è‰¯å¥½ã€‚</p>
<h3 id="æŸ¯ç†åŒ–æ”¹å†™"><a href="#æŸ¯ç†åŒ–æ”¹å†™" class="headerlink" title="æŸ¯ç†åŒ–æ”¹å†™"></a>æŸ¯ç†åŒ–æ”¹å†™</h3><p>å°¾é€’å½’çš„å®ç°ï¼Œå¾€å¾€éœ€è¦æ”¹å†™é€’å½’å‡½æ•°ï¼Œç¡®ä¿æœ€åä¸€æ­¥åªè°ƒç”¨è‡ªèº«ã€‚åšåˆ°è¿™ä¸€ç‚¹çš„æ–¹æ³•ï¼Œå°±æ˜¯æŠŠæ‰€æœ‰ç”¨åˆ°çš„å†…éƒ¨å˜é‡æ”¹å†™æˆå‡½æ•°çš„å‚æ•°ã€‚ä½†æ˜¯è¿™æ ·çš„è¯å°±ä¼šå¢åŠ åˆå§‹å…¥å‚ï¼Œæ¯”å¦‚<code>fibonacci(10, 1, 1)</code>ï¼Œåé¢çš„ä¸¤ä¸ªå‚æ•°<code>1</code>å’Œ<code>1</code>æ„æ€ä¸æ˜ç¡®ï¼Œç›´æ¥ç”¨<code>fibonacci(100)</code>æ‰æ˜¯ä¹ æƒ¯ç”¨æ³•ã€‚æ‰€ä»¥éœ€è¦åœ¨ä¸­é—´é¢„å…ˆè®¾ç½®å¥½åˆå§‹å…¥å‚ï¼Œå°†å¤šä¸ªå…¥å‚è½¬åŒ–æˆå•ä¸ªå…¥å‚çš„å½¢å¼ï¼Œå«åšå‡½æ•°æŸ¯ç†åŒ–ã€‚é€šç”¨æ–¹å¼ä¸ºï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function curry(fn) &#123;</span><br><span class="line">    var args = Array.prototype.slice.call(arguments, 1);</span><br><span class="line">    return function() &#123;</span><br><span class="line">        var innerArgs = Array.prototype.slice.call(arguments);</span><br><span class="line">        var finalArgs = innerArgs.concat(args);</span><br><span class="line">        return fn.apply(null, finalArgs);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ç”¨å‡½æ•°æŸ¯ç†åŒ–æ”¹å†™é˜¶ä¹˜<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function tailFactorial(n, total) &#123;</span><br><span class="line">    if(n === 1) return total;</span><br><span class="line">    return tailFactorial(n - 1, n * total);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var factorial = curry(tailFactorial, 1); </span><br><span class="line">console.log(factorial(5)); // 120</span><br></pre></td></tr></table></figure></p>
<p>åŒæ ·æ”¹å†™æ–æ³¢æ‹‰å¥‘æ•°åˆ—<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function tailFibonacci(n, prev, next) &#123;</span><br><span class="line">    if(n &lt;= 1) return next;</span><br><span class="line">    return tailFibonacci(n - 1, next, prev + next);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var fibonacci = curry(fibonacci, 1, 1);</span><br><span class="line">console.log(fibonacci(10)); // 89</span><br><span class="line">console.log(fibonacci(100)); // 573147844013817200000</span><br><span class="line">console.log(fibonacci(1000)); // 7.0330367711422765e+208</span><br></pre></td></tr></table></figure></p>
<h3 id="ES6æ”¹å†™"><a href="#ES6æ”¹å†™" class="headerlink" title="ES6æ”¹å†™"></a>ES6æ”¹å†™</h3><p>æŸ¯ç†åŒ–çš„è¿‡ç¨‹å…¶å®æ˜¯åˆå§‹åŒ–ä¸€äº›å‚æ•°çš„è¿‡ç¨‹ï¼Œåœ¨ES6ä¸­ï¼Œæ˜¯å¯ä»¥ç›´æ¥å‡½æ•°å‚æ•°é»˜è®¤èµ‹å€¼çš„ã€‚</p>
<p>ç”¨ES6æ”¹å†™é˜¶ä¹˜<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const factorial = (n, total = 1) =&gt; &#123;</span><br><span class="line">    if(n === 1) return total;</span><br><span class="line">    return factorial(n - 1, n * total);</span><br><span class="line">&#125;</span><br><span class="line">console.log(factorial(5)); // 120</span><br></pre></td></tr></table></figure></p>
<p>ç”¨ES6æ”¹å†™æ–æ³¢æ‹‰å¥‘æ•°åˆ—<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const fibonacci = (n, prev = 1, next = 1) =&gt; &#123;</span><br><span class="line">    if(n &lt;= 1) return next;</span><br><span class="line">    return fibonacci(n - 1, next, prev + next);</span><br><span class="line">&#125;</span><br><span class="line">console.log(fibonacci(10)); // 89</span><br><span class="line">console.log(fibonacci(100)); // 573147844013817200000 </span><br><span class="line">console.log(fibonacci(1000)); // 7.0330367711422765e+208</span><br></pre></td></tr></table></figure></p>
<p>ç”¨ES6æå¤§æ–¹ä¾¿äº†ç®—æ³•è¿ç”¨ï¼</p>
<h3 id="ä¸¥æ ¼æ¨¡å¼"><a href="#ä¸¥æ ¼æ¨¡å¼" class="headerlink" title="ä¸¥æ ¼æ¨¡å¼"></a>ä¸¥æ ¼æ¨¡å¼</h3><p>ES6 çš„å°¾è°ƒç”¨ä¼˜åŒ–åªåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹å¼€å¯ï¼Œæ­£å¸¸æ¨¡å¼æ˜¯æ— æ•ˆçš„ã€‚</p>
<p>è¿™æ˜¯å› ä¸ºåœ¨æ­£å¸¸æ¨¡å¼ä¸‹ï¼Œå‡½æ•°å†…éƒ¨æœ‰ä¸¤ä¸ªå˜é‡ï¼Œå¯ä»¥è·Ÿè¸ªå‡½æ•°çš„è°ƒç”¨æ ˆã€‚</p>
<ul>
<li>func.argumentsï¼šè¿”å›è°ƒç”¨æ—¶å‡½æ•°çš„å‚æ•°ã€‚</li>
<li>func.callerï¼šè¿”å›è°ƒç”¨å½“å‰å‡½æ•°çš„é‚£ä¸ªå‡½æ•°ã€‚</li>
</ul>
<p>å°¾è°ƒç”¨ä¼˜åŒ–å‘ç”Ÿæ—¶ï¼Œå‡½æ•°çš„è°ƒç”¨æ ˆä¼šæ”¹å†™ï¼Œå› æ­¤ä¸Šé¢ä¸¤ä¸ªå˜é‡å°±ä¼šå¤±çœŸã€‚ä¸¥æ ¼æ¨¡å¼ç¦ç”¨è¿™ä¸¤ä¸ªå˜é‡ï¼Œæ‰€ä»¥å°¾è°ƒç”¨æ¨¡å¼ä»…åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ç”Ÿæ•ˆã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function restricted() &#123;</span><br><span class="line">  &apos;use strict&apos;;</span><br><span class="line">  restricted.caller;    // æŠ¥é”™</span><br><span class="line">  restricted.arguments; // æŠ¥é”™</span><br><span class="line">&#125;</span><br><span class="line">restricted();</span><br></pre></td></tr></table></figure></p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ç»¼ä¸Šï¼Œè¿™ä¸ªé—®é¢˜è§£å†³çš„æ€è·¯æ˜¯ï¼š</p>
<ol>
<li>å°¾é€’å½’+å‡½æ•°æŸ¯ç†åŒ–ï¼›</li>
<li>å°¾é€’å½’+ES6é»˜è®¤èµ‹å€¼ï¼›</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/24/äºŒåˆ†æŸ¥æ‰¾-äºŒåˆ†è¾¹ç•ŒæŸ¥æ‰¾ç®—æ³•/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/24/äºŒåˆ†æŸ¥æ‰¾-äºŒåˆ†è¾¹ç•ŒæŸ¥æ‰¾ç®—æ³•/" itemprop="url">äºŒåˆ†æŸ¥æ‰¾,äºŒåˆ†è¾¹ç•ŒæŸ¥æ‰¾ç®—æ³•ï¼ŒindexOfæ–¹æ³•æ¨¡æ‹Ÿ</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-11-24T21:39:13+08:00">
                2018-11-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>äºŒåˆ†æŸ¥æ‰¾ä½œä¸ºç¨‹åºå‘˜çš„ä¸€é¡¹åŸºæœ¬æŠ€èƒ½ï¼Œæ˜¯é¢è¯•å®˜æœ€å¸¸ä½¿ç”¨æ¥è€ƒå¯Ÿç¨‹åºå‘˜åŸºæœ¬ç´ è´¨çš„ç®—æ³•ä¹‹ä¸€ï¼Œä¹Ÿæ˜¯è§£å†³å¾ˆå¤šæŸ¥æ‰¾ç±»é¢˜ç›®çš„å¸¸ç”¨æ–¹æ³•ï¼Œå®ƒå¯ä»¥è¾¾åˆ° <font color="#ff0000"><strong> O(log n) </strong></font>çš„æ—¶é—´å¤æ‚åº¦ã€‚  </p>
<p>ä¸€èˆ¬è€Œè¨€ï¼Œå½“ä¸€ä¸ªé¢˜ç›®å‡ºç°ä»¥ä¸‹ç‰¹æ€§æ—¶ï¼Œä½ å°±åº”è¯¥ç«‹å³è”æƒ³åˆ°å®ƒå¯èƒ½éœ€è¦ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾ï¼š</p>
<ol>
<li>å¾…æŸ¥æ‰¾çš„æ•°ç»„æœ‰åºæˆ–è€…éƒ¨åˆ†æœ‰åº</li>
<li>è¦æ±‚æ—¶é—´å¤æ‚åº¦ä½äºO(n)ï¼Œæˆ–è€…ç›´æ¥è¦æ±‚æ—¶é—´å¤æ‚åº¦ä¸ºO(log n)</li>
</ol>
<p>äºŒåˆ†æŸ¥æ‰¾æœ‰å¾ˆå¤šç§å˜ä½“ï¼Œä½¿ç”¨æ—¶éœ€è¦æ³¨æ„æŸ¥æ‰¾æ¡ä»¶ï¼Œåˆ¤æ–­æ¡ä»¶å’Œå·¦å³è¾¹ç•Œçš„æ›´æ–°æ–¹å¼ï¼Œä¸‰è€…é…åˆä¸å¥½å°±å¾ˆå®¹æ˜“å‡ºç°æ­»å¾ªç¯æˆ–è€…é—æ¼åŒºåŸŸï¼Œæœ¬ç¯‡ä¸­æˆ‘ä»¬å°†ä»‹ç»å¸¸è§çš„å‡ ç§æŸ¥æ‰¾æ–¹å¼çš„æ¨¡æ¿ä»£ç ï¼ŒåŒ…æ‹¬ï¼š</p>
<ol>
<li>æ ‡å‡†çš„äºŒåˆ†æŸ¥æ‰¾</li>
<li>äºŒåˆ†æŸ¥æ‰¾å·¦è¾¹ç•Œ</li>
<li>äºŒåˆ†æŸ¥æ‰¾å³è¾¹ç•Œ</li>
</ol>
<p>æœ¬æ–‡çš„å†…å®¹æ¥è‡ªäºç¬”è€…ä¸ªäººçš„æ€»ç»“ï¼Œäº‹å®ä¸ŠäºŒåˆ†æŸ¥æ‰¾æœ‰å¾ˆå¤šç§ç­‰ä»·çš„å†™æ³•ï¼Œæœ¬æ–‡åªæ˜¯åˆ—å‡ºäº†ç¬”è€…è®¤ä¸ºçš„æœ€å®¹æ˜“ç†è§£å’Œè®°å¿†çš„æ–¹æ³•ã€‚</p>
<h2 id="æ ‡å‡†äºŒåˆ†æŸ¥æ‰¾"><a href="#æ ‡å‡†äºŒåˆ†æŸ¥æ‰¾" class="headerlink" title="æ ‡å‡†äºŒåˆ†æŸ¥æ‰¾"></a>æ ‡å‡†äºŒåˆ†æŸ¥æ‰¾</h2><p>é¦–å…ˆç»™å‡ºæ ‡å‡†äºŒåˆ†æŸ¥æ‰¾çš„æ¨¡æ¿ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">function search(arr, target) &#123;</span><br><span class="line">	var left = 0;</span><br><span class="line">	var right = arr.length - 1;</span><br><span class="line">	while(left &lt;= right) &#123;</span><br><span class="line">		var mid = left + ((right - left) &gt;&gt; 1);</span><br><span class="line">		if(arr[mid] == target) &#123;</span><br><span class="line">			return mid;</span><br><span class="line">		&#125; else if(arr[mid] &gt; target) &#123;</span><br><span class="line">			right = mid - 1;</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			left = mid + 1;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	return -1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var index=search([1, 2, 3, 4, 5,6], 5);</span><br><span class="line">console.log(index)</span><br></pre></td></tr></table></figure></p>
<ul>
<li>å¾ªç¯æ¡ä»¶ï¼š <code>left &lt;= right</code></li>
<li>ä¸­é—´ä½ç½®è®¡ç®—ï¼š <code>mid = left + ((right -left) &gt;&gt; 1)</code></li>
<li>å·¦è¾¹ç•Œæ›´æ–°ï¼š<code>left = mid + 1</code></li>
<li>å³è¾¹ç•Œæ›´æ–°ï¼š <code>right = mid - 1</code></li>
<li>è¿”å›å€¼ï¼š <code>mid / -1</code></li>
</ul>
<p>è¿™é‡Œæœ‰å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š</p>
<ol>
<li>æˆ‘ä»¬çš„å¾ªç¯æ¡ä»¶ä¸­åŒ…å«äº† <code>left == right</code>çš„æƒ…å†µï¼Œåˆ™æˆ‘ä»¬å¿…é¡»åœ¨æ¯æ¬¡å¾ªç¯ä¸­æ”¹å˜ <code>left</code> å’Œ <code>right</code>çš„æŒ‡å‘ï¼Œä»¥é˜²æ­¢è¿›å…¥æ­»å¾ªç¯</li>
<li><p>å¾ªç¯ç»ˆæ­¢çš„æ¡ä»¶åŒ…æ‹¬ï¼š</p>
<ul>
<li>æ‰¾åˆ°äº†ç›®æ ‡å€¼</li>
<li><code>left &gt; right</code> ï¼ˆè¿™ç§æƒ…å†µå‘ç”Ÿäºå½“left, mid, rightæŒ‡å‘åŒä¸€ä¸ªæ•°æ—¶ï¼Œè¿™ä¸ªæ•°è¿˜ä¸æ˜¯ç›®æ ‡å€¼ï¼Œåˆ™æ•´ä¸ªæŸ¥æ‰¾ç»“æŸã€‚ï¼‰</li>
</ul>
</li>
</ol>
<p>3.<code>left + ((right -left) &gt;&gt; 1)</code> å…¶å®å’Œ <code>(left + right) / 2</code>æ˜¯ç­‰ä»·çš„ï¼Œè¿™æ ·å†™çš„ç›®çš„ä¸€ä¸ªæ˜¯ä¸ºäº†é˜²æ­¢ <code>(left + right)</code>å‡ºç°æº¢å‡ºï¼Œä¸€ä¸ªæ˜¯ç”¨å³ç§»æ“ä½œæ›¿ä»£é™¤æ³•æå‡æ€§èƒ½ã€‚<br>4.<code>left + ((right -left) &gt;&gt; 1)</code> å¯¹äºç›®æ ‡åŒºåŸŸé•¿åº¦ä¸ºå¥‡æ•°è€Œè¨€ï¼Œæ˜¯å¤„äºæ­£ä¸­é—´çš„ï¼Œå¯¹äºé•¿åº¦ä¸ºå¶æ•°è€Œè¨€ï¼Œæ˜¯ä¸­é—´åå·¦çš„ã€‚å› æ­¤å·¦å³è¾¹ç•Œç›¸é‡æ—¶ï¼Œåªä¼šæ˜¯ä»¥ä¸‹ä¸¤ç§æƒ…å†µï¼š</p>
<ul>
<li><code>left/mid</code> , <code>right</code> (left, mid æŒ‡å‘åŒä¸€ä¸ªæ•°ï¼ŒrightæŒ‡å‘å®ƒçš„ä¸‹ä¸€ä¸ªæ•°)</li>
<li><code>left/mid/right</code> ï¼ˆleft, mid, right æŒ‡å‘åŒä¸€ä¸ªæ•°ï¼‰   </li>
</ul>
<p>å³å› ä¸º<code>mid</code>å¯¹äºé•¿åº¦ä¸ºå¶æ•°çš„åŒºé—´æ€»æ˜¯åå·¦çš„ï¼Œæ‰€ä»¥å½“åŒºé—´é•¿åº¦å°äºç­‰äº2æ—¶ï¼Œ<code>mid</code> æ€»æ˜¯å’Œ <code>left</code>åœ¨åŒä¸€ä¾§ã€‚</p>
<h2 id="äºŒåˆ†æŸ¥æ‰¾å·¦è¾¹ç•Œ"><a href="#äºŒåˆ†æŸ¥æ‰¾å·¦è¾¹ç•Œ" class="headerlink" title="äºŒåˆ†æŸ¥æ‰¾å·¦è¾¹ç•Œ"></a>äºŒåˆ†æŸ¥æ‰¾å·¦è¾¹ç•Œ</h2><p>æ—¢ç„¶è¦å¯»æ‰¾å·¦è¾¹ç•Œï¼Œæœç´¢èŒƒå›´å°±éœ€è¦ä»å³è¾¹å¼€å§‹ï¼Œä¸æ–­å¾€å·¦è¾¹æ”¶ç¼©ï¼Œä¹Ÿå°±æ˜¯è¯´å³ä½¿æˆ‘ä»¬æ‰¾åˆ°äº†<code>nums[mid] == target</code>, è¿™ä¸ª<code>mid</code>çš„ä½ç½®ä¹Ÿä¸ä¸€å®šå°±æ˜¯æœ€å·¦ä¾§çš„é‚£ä¸ªè¾¹ç•Œï¼Œæˆ‘ä»¬è¿˜æ˜¯è¦å‘å·¦ä¾§æŸ¥æ‰¾ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨<code>nums[mid]</code>åå¤§æˆ–<code>è€…nums[mid]</code>å°±ç­‰äºç›®æ ‡å€¼çš„æ—¶å€™ï¼Œç»§ç»­æ”¶ç¼©å³è¾¹ç•Œï¼Œç®—æ³•æ¨¡æ¿å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">function search(arr, target) &#123;</span><br><span class="line">	var left = 0;</span><br><span class="line">	var right = arr.length - 1;</span><br><span class="line">	while(left &lt; right) &#123;</span><br><span class="line">		var mid = left + ((right - left) &gt;&gt; 1);</span><br><span class="line">		if(arr[mid] &lt; target) &#123;</span><br><span class="line">			left = mid + 1;</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			right = mid;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	console.log(left,right,mid)</span><br><span class="line">	return arr[left] == target ? left : -1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var index = search([1, 2, 3, 4, 5, 5, 5, 5, 5, 5, 6], 5);</span><br><span class="line">console.log(index)</span><br></pre></td></tr></table></figure>
<ul>
<li>å¾ªç¯æ¡ä»¶ï¼š <code>left &lt; right</code></li>
<li>ä¸­é—´ä½ç½®è®¡ç®—ï¼š <code>mid = left + ((right -left) &gt;&gt; 1)</code></li>
<li>å·¦è¾¹ç•Œæ›´æ–°ï¼š<code>left = mid + 1</code></li>
<li>å³è¾¹ç•Œæ›´æ–°ï¼š <code>right = mid</code></li>
<li>è¿”å›å€¼ï¼š <code>nums[left] == target ? left : -1</code></li>
</ul>
<p>ä¸æ ‡å‡†çš„äºŒåˆ†æŸ¥æ‰¾ä¸åŒï¼š</p>
<p>é¦–å…ˆï¼Œè¿™é‡Œçš„å³è¾¹ç•Œçš„æ›´æ–°æ˜¯<code>right = mid</code>ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦åœ¨æ‰¾åˆ°ç›®æ ‡å€¼åï¼Œç»§ç»­å‘å·¦å¯»æ‰¾å·¦è¾¹ç•Œã€‚</p>
<p>å…¶æ¬¡ï¼Œè¿™é‡Œçš„å¾ªç¯æ¡ä»¶æ˜¯<code>left &lt; right</code>ã€‚<br>å› ä¸ºåœ¨æœ€å<code>left</code>ä¸<code>right</code>ç›¸é‚»çš„æ—¶å€™ï¼Œ<code>mid</code>å’Œ<code>left</code>å¤„äºç›¸åŒçš„ä½ç½®(å‰é¢è¯´è¿‡ï¼Œ<code>mid</code>åå·¦)ï¼Œåˆ™ä¸‹ä¸€æ­¥ï¼Œæ— è®ºæ€æ ·ï¼Œ<code>left</code>, <code>mid</code>, <code>right</code>éƒ½å°†æŒ‡å‘åŒä¸€ä¸ªä½ç½®ï¼Œå¦‚æœæ­¤æ—¶å¾ªç¯çš„æ¡ä»¶æ˜¯<code>left &lt;= right</code>ï¼Œåˆ™æˆ‘ä»¬éœ€è¦å†è¿›å…¥ä¸€éå¾ªç¯ï¼Œæ­¤æ—¶ï¼Œå¦‚æœ<code>nums[mid] &lt; target</code>è¿˜å¥½è¯´ï¼Œå¾ªç¯æ­£å¸¸ç»ˆæ­¢ï¼›å¦åˆ™ï¼Œæˆ‘ä»¬ä¼šä»¤<code>right = mid</code>ï¼Œè¿™æ ·å¹¶æ²¡æœ‰æ”¹å˜<code>left</code>,<code>mid</code>,<code>right</code>çš„ä½ç½®ï¼Œå°†è¿›å…¥æ­»å¾ªç¯ã€‚</p>
<p>äº‹å®ä¸Šï¼Œæˆ‘ä»¬åªéœ€è¦éå†åˆ°<code>left</code>å’Œ<code>right</code>ç›¸é‚»çš„æƒ…å†µå°±è¡Œäº†ï¼Œå› ä¸ºè¿™ä¸€è½®å¾ªç¯åï¼Œæ— è®ºæ€æ ·ï¼Œ<code>left</code>,<code>mid</code>,<code>right</code>éƒ½ä¼šæŒ‡å‘åŒä¸€ä¸ªä½ç½®ï¼Œè€Œå¦‚æœè¿™ä¸ªä½ç½®çš„å€¼ç­‰äºç›®æ ‡å€¼ï¼Œåˆ™å®ƒå°±ä¸€å®šæ˜¯æœ€å·¦ä¾§çš„ç›®æ ‡å€¼ï¼›å¦‚æœä¸ç­‰äºç›®æ ‡å€¼ï¼Œåˆ™è¯´æ˜æ²¡æœ‰æ‰¾åˆ°ç›®æ ‡å€¼ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆè¿”å›å€¼æ˜¯<code>nums[left] == target ? left : -1</code>ã€‚</p>
<h2 id="äºŒåˆ†æŸ¥æ‰¾å³è¾¹ç•Œ"><a href="#äºŒåˆ†æŸ¥æ‰¾å³è¾¹ç•Œ" class="headerlink" title="äºŒåˆ†æŸ¥æ‰¾å³è¾¹ç•Œ"></a>äºŒåˆ†æŸ¥æ‰¾å³è¾¹ç•Œ</h2><p>æœ‰äº†å¯»æ‰¾å·¦è¾¹ç•Œçš„åˆ†æä¹‹åï¼Œå†æ¥çœ‹å¯»æ‰¾å³è¾¹ç•Œå°±å®¹æ˜“å¾ˆå¤šäº†ï¼Œæ¯•ç«Ÿå·¦å³ä¸¤ç§æƒ…å†µæ˜¯å¯¹ç§°çš„å˜›ï¼Œå…³äºä½¿ç”¨åœºæ™¯è¿™é‡Œå°±ä¸å†èµ˜è¿°äº†ï¼Œå¤§å®¶å¯¹ç§°ç€ç†è§£å°±å¥½ã€‚æˆ‘ä»¬ç›´æ¥ç»™å‡ºæ¨¡æ¿ä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">function search(arr, target) &#123;</span><br><span class="line">	var left = 0;</span><br><span class="line">	var right = arr.length - 1;</span><br><span class="line">	while(left &lt; right) &#123;</span><br><span class="line">		var mid = left + ((right - left) &gt;&gt; 1) + 1;</span><br><span class="line">		if(arr[mid] &gt; target) &#123;</span><br><span class="line">			right = mid - 1;</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			left = mid;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	console.log(left, right, mid)</span><br><span class="line">	return arr[right] == target ? right : -1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var index = search([1, 2, 3, 4, 5, 5, 5, 5, 5, 5, 6], 5);</span><br><span class="line">console.log(index)</span><br></pre></td></tr></table></figure>
<ul>
<li>å¾ªç¯æ¡ä»¶ï¼š <code>left &lt; right</code></li>
<li>ä¸­é—´ä½ç½®è®¡ç®—ï¼š <code>mid = left + ((right -left) &gt;&gt; 1) + 1</code></li>
<li>å·¦è¾¹ç•Œæ›´æ–°ï¼š<code>left = mid</code></li>
<li>å³è¾¹ç•Œæ›´æ–°ï¼š <code>right = mid - 1</code></li>
<li>è¿”å›å€¼ï¼š <code>nums[left] == target ? left : -1</code></li>
</ul>
<p>è¿™é‡Œå¤§éƒ¨åˆ†å’Œå¯»æ‰¾å·¦è¾¹ç•Œæ˜¯å¯¹ç§°ç€æ¥å†™çš„ï¼Œå”¯ç‹¬æœ‰ä¸€ç‚¹éœ€è¦å°¤å…¶æ³¨æ„â€”â€”ä¸­é—´ä½ç½®çš„è®¡ç®—å˜äº†ï¼Œæˆ‘ä»¬åœ¨æœ«å°¾å¤šåŠ äº†1ã€‚è¿™æ ·ï¼Œ<strong>æ— è®ºå¯¹äºå¥‡æ•°è¿˜æ˜¯å¶æ•°ï¼Œè¿™ä¸ªä¸­é—´çš„ä½ç½®éƒ½æ˜¯åå³çš„ã€‚</strong></p>
<p>å¯¹äºè¿™ä¸ªæ“ä½œçš„ç†è§£ï¼Œä»å¯¹ç§°çš„è§’åº¦çœ‹ï¼Œå¯»æ‰¾å·¦è¾¹ç•Œçš„æ—¶å€™ï¼Œä¸­é—´ä½ç½®æ˜¯åå·¦çš„ï¼Œé‚£å¯»æ‰¾å³è¾¹ç•Œçš„æ—¶å€™ï¼Œä¸­é—´ä½ç½®å°±åº”è¯¥åå³å‘—ï¼Œä½†æ˜¯è¿™æ˜¾ç„¶ä¸æ˜¯æ ¹æœ¬åŸå› ã€‚æ ¹æœ¬åŸå› æ˜¯ï¼Œåœ¨æœ€å<code>left</code>å’Œ<code>right</code>ç›¸é‚»æ—¶ï¼Œå¦‚æœ<code>mid</code>åå·¦ï¼Œåˆ™<code>left</code>, <code>mid</code>æŒ‡å‘åŒä¸€ä¸ªä½ç½®ï¼Œ<code>right</code>æŒ‡å‘å®ƒä»¬çš„ä¸‹ä¸€ä¸ªä½ç½®ï¼Œåœ¨<code>nums[left]</code>å·²ç»ç­‰äºç›®æ ‡å€¼çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸‰ä¸ªä½ç½®çš„å€¼éƒ½ä¸ä¼šæ›´æ–°ï¼Œä»è€Œè¿›å…¥äº†æ­»å¾ªç¯ã€‚æ‰€ä»¥æˆ‘ä»¬åº”è¯¥è®©<code>mid</code>åå³ï¼Œè¿™æ ·<code>left</code>å°±èƒ½å‘å³ç§»åŠ¨ã€‚è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¹‹å‰ä¸€ç›´å¼ºè°ƒæŸ¥æ‰¾æ¡ä»¶ï¼Œåˆ¤æ–­æ¡ä»¶å’Œå·¦å³è¾¹ç•Œçš„æ›´æ–°æ–¹å¼ä¸‰è€…ä¹‹é—´éœ€è¦é…åˆä½¿ç”¨ã€‚</p>
<p>å³è¾¹ç•Œçš„æŸ¥æ‰¾ä¸€èˆ¬æ¥è¯´ä¸ä¼šå•ç‹¬ä½¿ç”¨ï¼Œå¦‚æœ‰éœ€è¦ï¼Œä¸€èˆ¬æ˜¯éœ€è¦åŒæ—¶æŸ¥æ‰¾å·¦å³è¾¹ç•Œã€‚</p>
<h2 id="äºŒåˆ†æŸ¥æ‰¾å·¦å³è¾¹ç•Œ"><a href="#äºŒåˆ†æŸ¥æ‰¾å·¦å³è¾¹ç•Œ" class="headerlink" title="äºŒåˆ†æŸ¥æ‰¾å·¦å³è¾¹ç•Œ"></a>äºŒåˆ†æŸ¥æ‰¾å·¦å³è¾¹ç•Œ</h2><p>å‰é¢æˆ‘ä»¬ä»‹ç»äº†å·¦è¾¹ç•Œå’Œå³è¾¹ç•Œçš„æŸ¥æ‰¾ï¼Œé‚£ä¹ˆæŸ¥æ‰¾å·¦å³è¾¹ç•Œå°±å®¹æ˜“å¾ˆå¤šäº†â€”â€”åªè¦åˆ†åˆ«æŸ¥æ‰¾å·¦è¾¹ç•Œå’Œå³è¾¹ç•Œå°±è¡Œäº†ã€‚</p>
<h2 id="äºŒåˆ†æŸ¥æ‰¾æå€¼"><a href="#äºŒåˆ†æŸ¥æ‰¾æå€¼" class="headerlink" title="äºŒåˆ†æŸ¥æ‰¾æå€¼"></a>äºŒåˆ†æŸ¥æ‰¾æå€¼</h2><p>äºŒåˆ†æŸ¥æ‰¾è¿˜æœ‰ä¸€ç§æœ‰è¶£çš„å˜ä½“æ˜¯äºŒåˆ†æŸ¥æ‰¾æå€¼ç‚¹ï¼Œä¹‹å‰æˆ‘ä»¬ä½¿ç”¨<code>nums[mid]</code>å»æ¯”è¾ƒçš„æ—¶å€™ï¼Œå¸¸å¸¸æ˜¯å’Œç»™å®šçš„ç›®æ ‡å€¼<code>target</code>æ¯”ï¼Œæˆ–è€…å’Œå·¦å³è¾¹ç•Œæ¯”è¾ƒï¼Œåœ¨äºŒåˆ†æŸ¥æ‰¾æå€¼ç‚¹çš„åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬æ˜¯å’Œç›¸é‚»å…ƒç´ å»æ¯”ï¼Œä»¥å®ŒæˆæŸç§å•è°ƒæ€§çš„æ£€æµ‹ã€‚</p>
<h2 id="äºŒåˆ†æŸ¥æ‰¾ã€äºŒåˆ†è¾¹ç•ŒæŸ¥æ‰¾ç®—æ³•çš„æ¨¡æ¿ä»£ç æ€»ç»“"><a href="#äºŒåˆ†æŸ¥æ‰¾ã€äºŒåˆ†è¾¹ç•ŒæŸ¥æ‰¾ç®—æ³•çš„æ¨¡æ¿ä»£ç æ€»ç»“" class="headerlink" title="äºŒåˆ†æŸ¥æ‰¾ã€äºŒåˆ†è¾¹ç•ŒæŸ¥æ‰¾ç®—æ³•çš„æ¨¡æ¿ä»£ç æ€»ç»“"></a><a href="https://segmentfault.com/a/1190000016825704" target="_blank" rel="noopener">äºŒåˆ†æŸ¥æ‰¾ã€äºŒåˆ†è¾¹ç•ŒæŸ¥æ‰¾ç®—æ³•çš„æ¨¡æ¿ä»£ç æ€»ç»“</a></h2><h2 id="idnexOfæ¨¡æ‹Ÿ"><a href="#idnexOfæ¨¡æ‹Ÿ" class="headerlink" title="idnexOfæ¨¡æ‹Ÿ"></a>idnexOfæ¨¡æ‹Ÿ</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">var a=&apos;abcdefghijkl&apos;</span><br><span class="line">var b=&apos;ghi&apos;</span><br><span class="line">var aL=a.length;</span><br><span class="line">var bL=b.length;</span><br><span class="line"></span><br><span class="line">function indexOf(str,item)&#123;</span><br><span class="line">	for(var i=0;i&lt;=aL-bL;i++)&#123;</span><br><span class="line">		if(str.slice(i,bL+i)==item)&#123;</span><br><span class="line">			return i</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">console.log(indexOf(a,b))</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">var a = &apos;abcdefghijkl&apos;</span><br><span class="line">var b = &apos;ghi&apos;</span><br><span class="line"></span><br><span class="line">function indexOf(s,sub) &#123;</span><br><span class="line">	var sIndex=0,subIndex=0,sLength=s.length,subLength=sub.length;</span><br><span class="line">	while(sIndex &lt; sLength &amp;&amp; subIndex &lt; subLength) &#123;</span><br><span class="line">		if(s[sIndex] == sub[subIndex]) &#123;</span><br><span class="line">			subIndex++;</span><br><span class="line">			sIndex++;</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			sIndex = sIndex - subIndex + 1;</span><br><span class="line">			subIndex = 0;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	var index = subIndex == subLength ? (subLength &gt; 1 ? sIndex - subLength : sIndex - 1) : -1;</span><br><span class="line">	return index;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">console.log(indexOf(a,b))</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function idnexOf(a,b)&#123;</span><br><span class="line">	var reg=new RegExp(`$&#123;b&#125;`,&apos;gi&apos;);</span><br><span class="line">	var c=reg.exec(a);</span><br><span class="line">	console.log(c ? c.index : -1)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var a = &apos;abcdefghijkl&apos;</span><br><span class="line">var b = &apos;jkl&apos;</span><br><span class="line">idnexOf(a,b)</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/22/HTTPç¼“å­˜æœºåˆ¶-200è¿˜æ˜¯304/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/22/HTTPç¼“å­˜æœºåˆ¶-200è¿˜æ˜¯304/" itemprop="url">HTTPç¼“å­˜æœºåˆ¶(200è¿˜æ˜¯304)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-11-22T20:03:16+08:00">
                2018-11-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="f5åˆ°åº•åˆ·æ–°äº†ç‚¹ä»€ä¹ˆï¼Œä½ çŸ¥é“å—"><a href="#f5åˆ°åº•åˆ·æ–°äº†ç‚¹ä»€ä¹ˆï¼Œä½ çŸ¥é“å—" class="headerlink" title="f5åˆ°åº•åˆ·æ–°äº†ç‚¹ä»€ä¹ˆï¼Œä½ çŸ¥é“å—"></a><a href="https://juejin.im/post/5bfcd79e6fb9a04a08215cf3" target="_blank" rel="noopener">f5åˆ°åº•åˆ·æ–°äº†ç‚¹ä»€ä¹ˆï¼Œä½ çŸ¥é“å—</a></h2><h2 id="ç¼“å­˜ä»å…¥é—¨åˆ°æ”¾å¼ƒ"><a href="#ç¼“å­˜ä»å…¥é—¨åˆ°æ”¾å¼ƒ" class="headerlink" title="ç¼“å­˜ä»å…¥é—¨åˆ°æ”¾å¼ƒ"></a><a href="https://juejin.im/post/5bfe879a51882531b81b0891" target="_blank" rel="noopener">ç¼“å­˜ä»å…¥é—¨åˆ°æ”¾å¼ƒ</a></h2><p><img src="/2018/11/22/HTTPç¼“å­˜æœºåˆ¶-200è¿˜æ˜¯304/0.webp" alt=""><br>å½“æµè§ˆå™¨ç¬¬ä¸€æ¬¡åŠ è½½èµ„æºçš„æ—¶å€™ï¼Œè¿”å›ä¸€èˆ¬ä¸º200ï¼Œæ„æ€æ˜¯æˆåŠŸè·å–èµ„æºï¼Œå¹¶ä¼šåœ¨æµè§ˆå™¨çš„ç¼“å­˜ä¸­è®°å½•ä¸‹max-ageï¼Œç¬¬äºŒæ¬¡è®¿é—®çš„æ—¶å€™ï¼š å¦‚æœåªæ˜¯ç”¨æµè§ˆå™¨æ‰“å¼€ï¼Œé‚£ä¹ˆæµè§ˆå™¨ä¼šå»åˆ¤æ–­è¿™ä¸ªèµ„æºåœ¨ç¼“å­˜é‡Œæœ‰æ²¡æœ‰ï¼Œå¦‚æœæœ‰çš„è¯ï¼Œä¼šå»åˆ¤æ–­max-ageï¼Œçœ‹çœ‹è¿‡æœŸæ²¡æœ‰ï¼Œå¦‚æœæ²¡æœ‰è¿‡æœŸï¼Œåˆ™ç›´æ¥è¯»ç¼“å­˜ï¼Œæ ¹æœ¬ä¸ä¼šå’ŒæœåŠ¡å™¨è¿›è¡Œäº¤äº’ï¼Œæ¢å¥è¯è¯´ï¼Œæ–­ç½‘éƒ½èƒ½æ‰“å¼€ï¼Œå°±å’Œæœ¬åœ°è·‘ä¸€æ ·ï¼å¦‚æœå·²ç»è¿‡æœŸäº†ï¼Œé‚£å°±å»æœåŠ¡å™¨è¯·æ±‚ï¼Œç­‰å¾…æœåŠ¡å™¨å“åº”ï¼Œè¿™æ˜¯å¾ˆè´¹æ—¶é—´çš„ï¼ŒæœåŠ¡å™¨å¦‚æœå‘ç°èµ„æºæ²¡æœ‰æ”¹å˜è¿‡ï¼Œé‚£ä¹ˆå°±ä¼šè¿”å›304ï¼Œå‘Šè¯‰æµè§ˆå™¨ï¼Œæˆ‘æ²¡å˜è¿‡ï¼Œä½ å»è¯»ç¼“å­˜å§ï¼Œäºæ˜¯æµè§ˆå™¨ä¹Ÿä¸ç”¨ä»æœåŠ¡å™¨æ‹‰æ•°æ®äº†ï¼Œç„¶è€Œï¼Œç­‰å¾…æœåŠ¡å™¨å“åº”ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆè¦å‘½çš„é—®é¢˜ï¼Œåœ¨ç½‘é€Ÿå‘è¾¾çš„ä»Šå¤©ï¼Œç­‰ä¸€ä¸ªå“åº”ï¼Œæœ‰æ—¶æ¯”ä¸‹è½½è¿˜æ…¢ã€‚ å¦‚æœæ˜¯ç”¨æµè§ˆå™¨åˆ·æ–°çš„ï¼Œé‚£ä¹ˆæµè§ˆå™¨ä¸ä¼šå»åˆ¤æ–­max-ageäº†ï¼Œç›´æ¥å»æœåŠ¡å™¨æ‹¿ï¼Œå¦‚æœæœåŠ¡å™¨åˆ¤æ–­èµ„æºæ²¡å˜è¿‡ï¼Œåˆ™è¿˜æ˜¯ä¼šè¿”å›304ï¼Œå’Œä¸Šé¢æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥åˆ·æ–°ä¸€ä¸‹ï¼Œå…¶å®å¾ˆå¯æ€•ï¼Œç­‰äºæŠŠæ‰€æœ‰çš„èµ„æºéƒ½è¦å»æœåŠ¡å™¨è¯·æ±‚ä¸€è¾¹ï¼Œé—®é—®æœåŠ¡å™¨æˆ‘è¿‡æœŸäº†æ²¡æœ‰ã€‚</p>
<p>æµè§ˆå™¨åœ¨ç¬¬ä¸€æ¬¡è¯·æ±‚èµ„æºçš„æ—¶å€™ï¼ŒæœåŠ¡ç«¯å“åº”å¤´é‡Œå¯ä»¥è®¾ç½®expireså­—æ®µï¼Œè¯¥å­—æ®µè¡¨ç¤ºè¯¥èµ„æºçš„ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼Œç¬¬äºŒæ¬¡è¯·æ±‚çš„æ—¶å€™ï¼Œå¦‚æœæ—¶é—´è¿˜åœ¨è¯¥ç¼“å­˜æ—¶é—´ä¹‹å†…ï¼Œåˆ™ä¼šç›´æ¥ä½¿ç”¨ç¼“å­˜ï¼Œå¦åˆ™é‡æ–°åŠ è½½èµ„æºï¼Œ<strong> è¿™ä¸ªexpireså­—æ®µæœ‰ä¸ªç¼ºé™·ï¼Œå°±æ˜¯å®ƒå¿…é¡»æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„æ—¶é—´ä¸¥æ ¼åŒæ­¥æ‰èƒ½ç”Ÿæ•ˆï¼Œæ‰€ä»¥ç°åœ¨å¾ˆå¤šäººä¸ä¼šä½¿ç”¨æ”¹æ–¹æ¡ˆã€‚</strong> å¦å¤–ä¸€ç§æ–¹æ¡ˆæ˜¯ç¬¬ä¸€æ¬¡è¯·æ±‚èµ„æºçš„æ—¶å€™ï¼ŒæœåŠ¡ç«¯è®¾ç½®å“åº”å¤´cache-control: max-ageï¼Œè¿™æ ·è®¾ç½®çš„æ„æ€æ˜¯å‘Šè¯‰æµè§ˆå™¨ï¼Œè¿™ä¸ªèµ„æºä»€ä¹ˆæ—¶å€™è¿‡æœŸï¼Œç­‰ç¬¬äºŒæ¬¡è¯·æ±‚èµ„æºçš„æ—¶å€™ï¼Œåˆ¤æ–­æ˜¯å¦è¶…å‡ºäº†è¿‡æœŸæ—¶é—´ï¼Œå¦‚æœæ²¡è¶…å‡ºï¼Œç›´æ¥ä½¿ç”¨ç¼“å­˜ã€‚</p>
<h2 id="è®°ä¸€æ¬¡å‰ç«¯é¢è¯•çš„å…¨è¿‡ç¨‹"><a href="#è®°ä¸€æ¬¡å‰ç«¯é¢è¯•çš„å…¨è¿‡ç¨‹" class="headerlink" title="è®°ä¸€æ¬¡å‰ç«¯é¢è¯•çš„å…¨è¿‡ç¨‹"></a><a href="https://juejin.im/post/5bf8fe2ee51d452d705fee3d" target="_blank" rel="noopener">è®°ä¸€æ¬¡å‰ç«¯é¢è¯•çš„å…¨è¿‡ç¨‹</a></h2><h2 id="ç¼“å­˜çŠ¶æ€ç -200-OK-from-cache-ä¸-304-Not-Modified"><a href="#ç¼“å­˜çŠ¶æ€ç -200-OK-from-cache-ä¸-304-Not-Modified" class="headerlink" title="ç¼“å­˜çŠ¶æ€ç  200 OK (from cache) ä¸   304 Not Modified"></a>ç¼“å­˜çŠ¶æ€ç  200 OK (from cache) ä¸   304 Not Modified</h2><blockquote>
<p>200 OK (from cache)  æ˜¯æµè§ˆå™¨æ²¡æœ‰è·ŸæœåŠ¡å™¨ç¡®è®¤ï¼Œç›´æ¥ç”¨äº†æµè§ˆå™¨ç¼“å­˜ï¼›</p>
</blockquote>
<blockquote>
<p>304 Not Modified æ˜¯æµè§ˆå™¨å’ŒæœåŠ¡å™¨å¤šç¡®è®¤äº†ä¸€æ¬¡ç¼“å­˜æœ‰æ•ˆæ€§ï¼Œå†ç”¨çš„ç¼“å­˜ã€‚</p>
</blockquote>
<blockquote>
<p>304 Not Modifiedï¼šå®¢æˆ·ç«¯æœ‰ç¼“å†²çš„æ–‡ä»¶å¹¶å‘å‡ºäº†ä¸€ä¸ªæ¡ä»¶æ€§çš„è¯·æ±‚ï¼ˆä¸€èˆ¬æ˜¯æä¾›If-Modified-Sinceå¤´è¡¨ç¤ºå®¢æˆ·åªæƒ³æ¯”æŒ‡å®šæ—¥æœŸæ›´æ–°çš„æ–‡æ¡£ï¼‰ã€‚æœåŠ¡å™¨å‘Šè¯‰å®¢æˆ·ï¼ŒåŸæ¥ç¼“å†²çš„æ–‡æ¡£è¿˜å¯ä»¥ç»§ç»­ä½¿ç”¨ã€‚</p>
</blockquote>
<blockquote>
<p>304 Not Modified æ¯” 200 OK (from cache) æ…¢ï¼ŒæŒ‡çš„æ˜¯æµè§ˆå™¨è¿˜å‘æœåŠ¡å™¨ç¡®è®¤äº†ä¸‹ â€œIf-Not-Modifiedâ€ï¼Œæ‰ç”¨çš„ç¼“å­˜</p>
</blockquote>
<h2 id="å‚è€ƒhttp-200ã€301ã€304ç­‰çŠ¶æ€ç è¯¦è§£"><a href="#å‚è€ƒhttp-200ã€301ã€304ç­‰çŠ¶æ€ç è¯¦è§£" class="headerlink" title="å‚è€ƒhttp 200ã€301ã€304ç­‰çŠ¶æ€ç è¯¦è§£"></a>å‚è€ƒ<a href="https://www.jb51.net/article/119562.htm" target="_blank" rel="noopener">http 200ã€301ã€304ç­‰çŠ¶æ€ç è¯¦è§£</a></h2><h2 id="200å’Œ304ç‰¹ç‚¹"><a href="#200å’Œ304ç‰¹ç‚¹" class="headerlink" title="200å’Œ304ç‰¹ç‚¹"></a>200å’Œ304ç‰¹ç‚¹</h2><blockquote>
<p>çŠ¶æ€ç 200ï¼šè¯·æ±‚å·²æˆåŠŸï¼Œè¯·æ±‚æ‰€å¸Œæœ›çš„å“åº”å¤´æˆ–æ•°æ®ä½“å°†éšæ­¤å“åº”è¿”å›ã€‚å³è¿”å›çš„æ•°æ®ä¸ºå…¨é‡çš„æ•°æ®ï¼Œå¦‚æœæ–‡ä»¶ä¸é€šè¿‡GZIPå‹ç¼©çš„è¯ï¼Œæ–‡ä»¶æ˜¯å¤šå¤§ï¼Œåˆ™è¦æœ‰å¤šå¤§ä¼ è¾“é‡ã€‚</p>
</blockquote>
<blockquote>
<p>çŠ¶æ€ç 304ï¼šå¦‚æœå®¢æˆ·ç«¯å‘é€äº†ä¸€ä¸ªå¸¦æ¡ä»¶çš„ GET è¯·æ±‚ä¸”è¯¥è¯·æ±‚å·²è¢«å…è®¸ï¼Œè€Œæ–‡æ¡£çš„å†…å®¹ï¼ˆè‡ªä¸Šæ¬¡è®¿é—®ä»¥æ¥æˆ–è€…æ ¹æ®è¯·æ±‚çš„æ¡ä»¶ï¼‰å¹¶æ²¡æœ‰æ”¹å˜ï¼Œåˆ™æœåŠ¡å™¨åº”å½“è¿”å›è¿™ä¸ªçŠ¶æ€ç ã€‚å³å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯åªéœ€è¦ä¼ è¾“å¾ˆå°‘çš„æ•°æ®é‡æ¥åšæ–‡ä»¶çš„æ ¡éªŒï¼Œå¦‚æœæ–‡ä»¶æ²¡æœ‰ä¿®æ”¹è¿‡ï¼Œåˆ™ä¸éœ€è¦è¿”å›å…¨é‡çš„æ•°æ®ã€‚</p>
</blockquote>
<font color="#dd0000"> <strong> çŠ¶æ€ä¸º304çš„è¯·æ±‚è¦æ¯”çŠ¶æ€ä¸º200çš„è¯·æ±‚çš„æ•°æ®é‡å°å¾ˆå¤šï¼Œå› ä¸º304åªéœ€è¦è¿”å›å“åº”å¤´ï¼Œå¹¶ä¸éœ€è¦è¿”å›æ•´ä¸ªæ–‡ä»¶ï¼Œæ‰€ä»¥åªéœ€è¦å‡ å­—èŠ‚å°±å¯ä»¥äº†ï¼Œè¿™æ ·èƒ½å¤ŸèŠ‚çœå¤§é‡çš„ç½‘ç»œå¸¦å®½ï¼Œå¹¶å‡å°‘äº†é¡µé¢çš„æ¸²æŸ“æ—¶é—´ã€‚ </strong> </font>

<h2 id="ç¼“å­˜HTTPå¤´ä¿¡æ¯"><a href="#ç¼“å­˜HTTPå¤´ä¿¡æ¯" class="headerlink" title="ç¼“å­˜HTTPå¤´ä¿¡æ¯"></a>ç¼“å­˜HTTPå¤´ä¿¡æ¯</h2><p>Dateï¼šåŸæœåŠ¡å™¨å‘é€è¯¥èµ„æºå“åº”æŠ¥æ–‡çš„æ—¶é—´ï¼ˆGMTæ ¼å¼ï¼‰</p>
<p>Ageï¼šAgeè¡¨ç¤ºè¿™ä¸ªå“åº”å·²ç»å­˜æ´»äº†å¤šä¹…äº†(HTTP/1.0çš„å“åº”ä¸å¸¦Age)</p>
<p>Expiresï¼šå³åœ¨ HTTP å¤´ä¸­æŒ‡æ˜å…·ä½“å¤±æ•ˆçš„æ—¶é—´(HTTP/1.0)ï¼ŒExpires = HTTP-date</p>
<p>Pragmaï¼šno-cacheï¼Œæ¯æ¬¡è¯·æ±‚é¡µé¢æ—¶éƒ½ä¸è¦è¯»ç¼“å­˜ï¼Œå…¼å®¹HTTP/1.0ï¼Œä¼˜å…ˆçº§é«˜äºExpires(HTTP/1.0 + HTTP/1.1)</p>
<p>Cache Controlï¼šä¼˜å…ˆçº§é«˜äºPragmaã€Expires(HTTP/1.1)  <font color="#ff0000"><strong> ã€publicï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½å¯ä»¥ç¼“å­˜ï¼›privateï¼Œåªèƒ½å®¢æˆ·ç«¯ç¼“å­˜ï¼›no-storeï¼Œä¸ä½¿ç”¨ç¼“å­˜ï¼›no-cacheï¼Œä½¿ç”¨åå•†ç¼“å­˜ã€‚ã€‘ </strong></font></p>
<h3 id="Expires"><a href="#Expires" class="headerlink" title="Expires"></a>Expires</h3><ul>
<li>Expiresæ˜¯http1.0æå‡ºçš„ä¸€ä¸ªè¡¨ç¤ºèµ„æºè¿‡æœŸæ—¶é—´çš„headerï¼Œå®ƒæè¿°çš„æ˜¯ä¸€ä¸ªç»å¯¹æ—¶é—´ï¼Œç”±æœåŠ¡å™¨è¿”å›ã€‚</li>
<li>Expiresç¬¬äºŒæ¬¡è¯·æ±‚æ—¶ï¼Œå°†å’Œæœ¬åœ°æ—¶é—´æ¯”å¯¹ã€‚</li>
</ul>
<blockquote>
<p>Expires ç¬¬ä¸€æ¬¡è¯·æ±‚æœåŠ¡å™¨æ˜¯ï¼Œå“åº”å¤´ä¼šè¿”å›ä¸€ä¸ªExpiresçš„æ–‡ä»¶è¿‡æœŸæ—¶é—´ã€‚<br>Expires ç¬¬äºŒæ¬¡è¯·æ±‚ï¼Œå®¢æˆ·ç«¯ä½¿ç”¨æœ¬åœ°æ—¶é—´å’Œæ–‡ä»¶çš„è¿‡æœŸæ—¶é—´è¿›è¡Œæ¯”å¯¹ï¼Œå¦‚æœæ–‡ä»¶æœªè¿‡æœŸåˆ™ç›´æ¥ä½¿ç”¨æœ¬åœ°ç¼“å­˜ï¼Œè¿”å›çŠ¶æ€ç 200(from memory cache)æˆ–200(from disk cache)ã€‚</p>
</blockquote>
<h3 id="Expires-Cache-Control"><a href="#Expires-Cache-Control" class="headerlink" title="Expires Cache-Control"></a>Expires Cache-Control</h3><ul>
<li>Cache-Control: no-cache    å¿…é¡»å…ˆä¸ä»£ç†æœåŠ¡å™¨ç¡®è®¤æ˜¯å¦æ›´æ”¹ï¼Œç„¶ååœ¨åœ¨å†³å®šä½¿ç”¨ç¼“å­˜è¿˜æ˜¯è¯·æ±‚ï¼Œç±»ä¼¼äºåå•†ç¼“å­˜ï¼ˆ304ï¼‰</li>
<li>Cache-Control: no-store æ‰æ˜¯çœŸæ­£çš„ä¸ç¼“å­˜æ•°æ®åˆ°æœ¬åœ°</li>
<li>Cache-Control: public å¯ä»¥è¢«æ‰€æœ‰ç”¨æˆ·ç¼“å­˜ï¼ˆå¤šç”¨æˆ·å…±äº«ï¼‰ï¼ŒåŒ…æ‹¬ç»ˆç«¯å’ŒCDNç­‰ä¸­é—´ä»£ç†æœåŠ¡å™¨</li>
<li>Cache-Control: private åªèƒ½è¢«ç»ˆç«¯æµè§ˆå™¨ç¼“å­˜ï¼ˆè€Œä¸”æ˜¯ç§æœ‰ç¼“å­˜ï¼‰ï¼Œä¸å…è®¸ä¸­ç»§ç¼“å­˜æœåŠ¡å™¨è¿›è¡Œç¼“å­˜</li>
<li>Cache-Control: must-revalidateå¦‚æœç¼“å­˜å†…å®¹å¤±æ•ˆï¼Œè¯·æ±‚å¿…é¡»å‘é€æœåŠ¡å™¨è¿›è¡ŒéªŒè¯</li>
<li>Cache-Control: max-age=s    ç¼“å­˜å†…å®¹åœ¨sç§’åå¤±æ•ˆï¼Œä»…HTTP1.1å¯ç”¨</li>
</ul>
<blockquote>
<p>max-gae ç¬¬ä¸€æ¬¡è¯·æ±‚æœåŠ¡å™¨æ—¶ï¼Œå“åº”å¤´ä¼šè¿”å›ä¸€ä¸ª max-ageï¼Œæ˜¯æ–‡ä»¶å¤šå°‘æ—¶é—´åè¿‡æœŸã€‚<br>max-gae ç¬¬äºŒæ¬¡è¯·æ±‚ï¼Œå®¢æˆ·ç«¯ä¼šæ ¡éªŒæ–‡ä»¶æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœæ–‡ä»¶æœªè¿‡æœŸåˆ™ç›´æ¥ä½¿ç”¨æœ¬åœ°ç¼“å­˜ï¼Œè¿”å›çŠ¶æ€ç 200(from memory cache)æˆ–200(from disk cache)ã€‚ </p>
</blockquote>
<hr>
<p>æœ¬åœ°ç¼“å­˜ï¼Œæ˜¯æŒ‡åœ¨å®¢æˆ·ç«¯æœ¬åœ°æœºå™¨ä¸­çš„ç¼“å­˜ã€‚</p>
<p>å…±äº«ç¼“å­˜ï¼Œå¤„äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„ç¼“å­˜ï¼Œä¾‹å¦‚ï¼šCDNã€‚</p>
<p>è¯·æ±‚ Cache Control</p>
<table>
<thead>
<tr>
<th>â€“</th>
<th style="text-align:left">â€“</th>
</tr>
</thead>
<tbody>
<tr>
<td>max-age</td>
<td style="text-align:left">å¯ä»¥æ¥æ”¶ç¼“å­˜æœ€é•¿æ—¶é—´</td>
</tr>
<tr>
<td>max-stale</td>
<td style="text-align:left">å¯ä»¥æ¥æ”¶è¿‡æœŸçš„èµ„æºï¼Œä½†æ˜¯è¿‡æœŸæ—¶é—´å¿…é¡»å°äº max-stale å€¼</td>
</tr>
<tr>
<td>min-fresh</td>
<td style="text-align:left">å¯ä»¥æ¥æ”¶ä¸€ä¸ªæ›´æ–°è¿‡çš„èµ„æºï¼Œfreshç”Ÿå‘½æœŸå¤§äºå…¶å½“å‰ Age è·Ÿ min-fresh å€¼ä¹‹å’Œ</td>
</tr>
<tr>
<td>no-cache</td>
<td style="text-align:left">åœ¨æºæœåŠ¡å™¨è¿”å›æˆåŠŸçš„éªŒè¯ä¹‹å‰ä¸èƒ½ä½¿ç”¨ç¼“å­˜å“åº”</td>
</tr>
<tr>
<td>no-store</td>
<td style="text-align:left">ç›´æ¥ç¦æ­¢æµè§ˆå™¨å’Œæ‰€æœ‰ä¸­ç»§ç¼“å­˜å­˜å‚¨è¿”å›çš„ä»»ä½•ç‰ˆæœ¬çš„å“åº”</td>
</tr>
<tr>
<td>no-transform</td>
<td style="text-align:left">è·å–æ²¡æœ‰è¢«è½¬æ¢è¿‡ï¼ˆæ¯”å¦‚å‹ç¼©ï¼‰çš„èµ„æº</td>
</tr>
<tr>
<td>only-if-cached</td>
<td style="text-align:left">å¸Œæœ›è·å–ç¼“å­˜å†…å®¹è€Œä¸å‘èµ·è¯·æ±‚</td>
</tr>
</tbody>
</table>
<p>å“åº” Cache Control</p>
<table>
<thead>
<tr>
<th>â€“</th>
<th style="text-align:left">â€“</th>
</tr>
</thead>
<tbody>
<tr>
<td>no-cache</td>
<td style="text-align:left">ç¼“å­˜å¿…é¡»é‡æ–°æ ¡éªŒ</td>
</tr>
<tr>
<td>no-store</td>
<td style="text-align:left">ä¸å­˜å‚¨ç¼“å­˜</td>
</tr>
<tr>
<td>no-transform</td>
<td style="text-align:left">ç¼“å­˜å†…å®¹æ—¶ä¸èƒ½å¯¹æ”¹å˜ä»»ä½•æ•°æ®</td>
</tr>
<tr>
<td>public</td>
<td style="text-align:left">å“åº”å¯è¢«ä»»ä½•ç¼“å­˜åŒºç¼“å­˜</td>
</tr>
<tr>
<td>private</td>
<td style="text-align:left">åªåœ¨æœ¬åœ°ç¼“å­˜ï¼Œä¸å…è®¸ä»»ä½•ä¸­ç»§ç¼“å­˜å¯¹å…¶è¿›è¡Œç¼“å­˜ï¼ˆä¾‹å¦‚ï¼Œæµè§ˆå™¨å¯ä»¥ç¼“å­˜ï¼Œä½†æ˜¯CDNä¸èƒ½ç¼“å­˜ï¼‰</td>
</tr>
<tr>
<td>must-revalidate</td>
<td style="text-align:left">å¦‚æœç¼“å­˜çš„å†…å®¹å¤±æ•ˆï¼Œè¯·æ±‚å¿…é¡»å‘é€åˆ°æœåŠ¡å™¨ä»¥è¿›è¡Œé‡æ–°éªŒè¯ï¼ˆè¯·æ±‚å¤±è´¥è¿”å›504ï¼Œè€Œéä¸­é—´ç¼“å­˜CDNï¼‰</td>
</tr>
<tr>
<td>proxy-revalidate</td>
<td style="text-align:left">ä¸must-revalidateç±»ä¼¼ï¼Œä»…èƒ½ç”¨äºå…±äº«ç¼“å­˜ï¼ˆå¦‚ï¼šCDNï¼‰</td>
</tr>
<tr>
<td>max-age</td>
<td style="text-align:left">åªæ¥å— Age å€¼å°äº max-age å€¼ï¼Œå¹¶ä¸”æ²¡æœ‰è¿‡æœŸçš„èµ„æº</td>
</tr>
<tr>
<td>s-maxage</td>
<td style="text-align:left">ä»…èƒ½ç”¨äºå…±äº«ç¼“å­˜ï¼Œä¸€èˆ¬ç”¨åœ¨cacheæœåŠ¡å™¨ä¸Š(å¦‚ï¼šCDN)</td>
</tr>
</tbody>
</table>
<p>Cache Control Extensions</p>
<p>é€šè¿‡ä½¿ç”¨1ä¸ªæˆ–å¤šä¸ªcache-extension tokensæ‰©å±•ï¼ˆå¯é€‰ï¼‰å­—æ®µï¼ŒæœåŠ¡å™¨ä¸è¯†åˆ«åˆ™å¿½ç•¥æ‰<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cache-Control:private, community=&quot;UCI&quot;</span><br></pre></td></tr></table></figure></p>
<p>Cache-Control å…è®¸è‡ªç”±ç»„åˆå¯é€‰å€¼<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cache-Control: max-age=3600, must-revalidate</span><br></pre></td></tr></table></figure></p>
<p>Last-Modified/If-Modified-Sinceï¼šæ–‡ä»¶æœ€åä¸€æ¬¡ä¿®æ”¹çš„æ—¶é—´ï¼ˆç²¾åº¦æ˜¯ç§’ï¼ŒHTTP/1.0ï¼‰ï¼Œéœ€è¦Cache-Contralè¿‡æœŸ</p>
<p>Etagï¼šå½“å‰èµ„æºåœ¨æœåŠ¡å™¨çš„å”¯ä¸€æ ‡è¯†ï¼ˆç”Ÿæˆè§„åˆ™ç”±æœåŠ¡å™¨å†³å®šï¼‰ETagçš„å€¼ï¼Œé»˜è®¤æ˜¯å¯¹æ–‡ä»¶çš„ç´¢å¼•èŠ‚ï¼ˆINodeï¼‰ï¼Œå¤§å°ï¼ˆSizeï¼‰å’Œæœ€åä¿®æ”¹æ—¶é—´ï¼ˆMTimeï¼‰è¿›è¡ŒHashåå¾—åˆ°çš„ï¼Œä¼˜å…ˆçº§é«˜äºLast-Modifiedï¼›åœ¨åˆ†å¸ƒå¼çš„Webç³»ç»Ÿä¸­ï¼Œå½“è®¿é—®è½åœ¨ä¸åŒçš„ç‰©ç†æœºä¸Šæ—¶ä¼šè¿”å›ä¸åŒçš„ETagï¼Œè¿›è€Œå¯¼è‡´304å¤±æ•ˆï¼Œé™çº§ä¸º200è¯·æ±‚ï¼ˆHTTP/1.1ï¼‰ï¼Œéœ€è¦Cache-Contralè¿‡æœŸ</p>
<p>å¦‚æœ Last-Modified å’Œ ETag åŒæ—¶è¢«ä½¿ç”¨ï¼Œåˆ™è¦æ±‚å®ƒä»¬çš„éªŒè¯éƒ½å¿…é¡»é€šè¿‡æ‰ä¼šè¿”å›304ï¼Œå¦åˆ™è¿”å›200ã€‚</p>
<h2 id="Metaæ ‡ç­¾"><a href="#Metaæ ‡ç­¾" class="headerlink" title="Metaæ ‡ç­¾"></a>Metaæ ‡ç­¾</h2><p>metaæ˜¯ç”¨æ¥åœ¨HTMLæ–‡æ¡£ä¸­æ¨¡æ‹ŸHTTPåè®®çš„å“åº”å¤´æŠ¥æ–‡ã€‚åœ¨HTMLé¡µé¢åŠ ä¸Šmetaæ ‡ç­¾æ¥ç»™è¯·æ±‚æŠ¥å¤´åŠ ä¸Šè¯·æ±‚å­—æ®µã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta http-equiv=&quot;Expires&quot;content=&quot;0&quot;&gt;</span><br><span class="line">&lt;meta http-equiv=&quot;Pragma&quot;content=&quot;no-cache&quot;&gt;</span><br><span class="line">&lt;meta http-equiv=&quot;Cache-Control&quot;content=&quot;no-cache&quot;&gt;</span><br></pre></td></tr></table></figure></p>
<p>Pragmaçš„metaæ ‡ç­¾åªæœ‰IEèƒ½è¯†åˆ«</p>
<p><a href="https://support.microsoft.com/zh-cn/help/222064/-pragma-no-cache-tag-may-not-prevent-page-from-being-cached" target="_blank" rel="noopener">â€œPragma:No-cacheâ€æ ‡è®°å¯èƒ½æ— æ³•é˜²æ­¢é¡µé¢è¢«ç¼“å­˜</a></p>
<blockquote>
<p><strong>ä¼˜å…ˆçº§ï¼šCache-Control &gt; Pragma &gt; Expires </strong></p>
</blockquote>
<p>æ¸…é™¤æµè§ˆå™¨ä¸­çš„ç¼“å­˜ï¼Œå¿…é¡»ä»æœåŠ¡ç«¯è·å–æœ€æ–°å†…å®¹ï¼Œä½†ä¸æ˜¯æ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒ</p>
<h2 id="ç¼“å­˜æœºåˆ¶"><a href="#ç¼“å­˜æœºåˆ¶" class="headerlink" title="ç¼“å­˜æœºåˆ¶"></a>ç¼“å­˜æœºåˆ¶</h2><blockquote>
<p>Freshness</p>
</blockquote>
<p>å’Œæµè§ˆå™¨ç­–ç•¥ä»¥åŠCache Controlï¼ˆHTTP/1.1ï¼‰ä¸Expires(HTTP/1.0)æœ‰å…³</p>
<p>æœ€å¥½çš„è¯·æ±‚æ˜¯ä¸å¿…ä¸æœåŠ¡å™¨è¿›è¡Œé€šä¿¡çš„è¯·æ±‚ï¼šé€šè¿‡å“åº”çš„æœ¬åœ°ç¼“å­˜ï¼Œå¯ä»¥é¿å…æ‰€æœ‰çš„ç½‘ç»œå»¶è¿Ÿä»¥åŠæ•°æ®ä¼ è¾“çš„æ•°æ®æˆæœ¬ã€‚</p>
<p>æœåŠ¡å™¨ç»™å“åº”è®¾ç½®æ˜¾ç¤ºè¿‡æœŸæ—¶é—´ï¼ˆexplicit expiration timeï¼‰ï¼Œå½“è¯·æ±‚èµ„æºæ—¶ï¼Œåªéœ€è¦æ£€æµ‹èµ„æºçš„è¿‡æœŸçŠ¶æ€ï¼Œåˆ¤æ–­æ˜¯å¦ä½¿ç”¨ç¼“å­˜ã€‚</p>
<p>æœåŠ¡å™¨ä¸æä¾›ä¸€ä¸ªæ˜¾ç¤ºè¿‡æœŸæ—¶é—´ï¼ŒHTTPç¼“å­˜é€šå¸¸ä¼šè®¾ç½®ä¸€ä¸ªå¯å‘å¼è¿‡æœŸæ—¶é—´ï¼ˆheuristic expiration timeï¼‰ï¼Œé‡‡ç”¨ç®—æ³•é€šè¿‡å…¶ä»–å€¼ï¼ˆä¾‹å¦‚Last-Modifiedï¼‰ä¼°è®¡ä¸€ä¸ªåˆç†çš„æ—¶é—´ã€‚</p>
<p>å¦‚ä½•åˆ¤æ–­å“åº”æ˜¯å¦æ–°çš„ï¼Ÿ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response_is_fresh =(freshness_lifetime &gt; current_age)</span><br></pre></td></tr></table></figure></p>
<p>freshness_lifetimeè®¡ç®—ï¼ŒåŒæ—¶å­˜åœ¨å¤šä¸ªï¼ŒæŒ‰ä¼˜å…ˆçº§è·å–</p>
<ul>
<li><p>å¦‚æœæ˜¯å…±äº«ç¼“å­˜ï¼Œä½¿ç”¨s-maxage</p>
</li>
<li><p>å¦‚æœæœ‰max-ageå­—æ®µï¼Œä½¿ç”¨max-age</p>
</li>
<li><p>å¦‚æœæœ‰Expireså­—æ®µï¼Œä½¿ç”¨Expiresè¶…è¿‡Dateçš„æ—¶é—´æ•°</p>
</li>
<li><p>å¦‚æœæ²¡æœ‰æ˜¾ç¤ºè¿‡æœŸæ—¶é—´è®¾ç½®ï¼Œä½¿ç”¨æµè§ˆå™¨çš„å¯å‘å¼è¿‡æœŸæ—¶é—´ï¼ˆheuristic expiration timeï¼‰</p>
</li>
</ul>
<p>current_ageè®¡ç®—</p>
<ul>
<li><p>age_value Ageå­—æ®µçš„å€¼</p>
</li>
<li><p>date_value Dateå­—æ®µçš„å€¼</p>
</li>
<li><p>now å½“å‰æ—¶é—´</p>
</li>
<li><p>request_time è¯·æ±‚æ—¶é—´</p>
</li>
<li><p>response_time å“åº”æ—¶é—´</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">apparent_age = max(0, response_time - date_value);</span><br><span class="line">response_delay = response_time - request_time;</span><br><span class="line">corrected_age_value = age_value + response_delay;</span><br><span class="line">corrected_initial_age = max(apparent_age, corrected_age_value);</span><br><span class="line">resident_time = now - response_time;</span><br><span class="line">current_age = corrected_initial_age + resident_time;</span><br></pre></td></tr></table></figure>
<p>ç¼“å­˜ç­–ç•¥</p>
<p><img src="/2018/11/22/HTTPç¼“å­˜æœºåˆ¶-200è¿˜æ˜¯304/1.png" alt=""></p>
<p>HTML5 Boilerplate é¡¹ç›®<a href="https://github.com/h5bp/server-configs-nginx" target="_blank" rel="noopener">nginxé…ç½®æ–‡ä»¶æ ·ä¾‹</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># cache.appcache, your document html and data</span><br><span class="line">location ~* \.(?:manifest|appcache|html?|xml|json)$ &#123;</span><br><span class="line">  expires -1;</span><br><span class="line">&#125;</span><br><span class="line"># Feed</span><br><span class="line">location ~* \.(?:rss|atom)$ &#123;</span><br><span class="line">  expires 1h;</span><br><span class="line">&#125;</span><br><span class="line"># Media: images, icons, video, audio, HTC</span><br><span class="line">location ~* \.(?:jpg|jpeg|gif|png|ico|cur|gz|svg|svgz|mp4|ogg|ogv|webm|htc)$ &#123;</span><br><span class="line">  expires 1M;</span><br><span class="line">  access_log off;</span><br><span class="line">  add_header Cache-Control &quot;public&quot;;</span><br><span class="line">&#125;</span><br><span class="line"># CSS and Javascript</span><br><span class="line">location ~* \.(?:css|js)$ &#123;</span><br><span class="line">  expires 1y;</span><br><span class="line">  access_log off;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Validation</p>
</blockquote>
<p>æ£€æŸ¥ä¸€ä¸ªç¼“å­˜çš„å“åº”æ˜¯å¦ä»ç„¶å¯ç”¨ <code>Last-Modifiedå’ŒETagï¼ˆentity-tagï¼‰</code><br>é€šè¿‡éªŒè¯ä»¤ç‰Œå¯ä»¥è¿›è¡Œé«˜æ•ˆçš„èµ„æºæ›´æ–°æ£€æŸ¥ï¼šå¦‚æœèµ„æºæœªæ›´æ”¹ï¼Œåˆ™ä¸ä¼šä¼ è¾“ä»»ä½•æ•°æ®<br><img src="/2018/11/22/HTTPç¼“å­˜æœºåˆ¶-200è¿˜æ˜¯304/2.png" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Status Code:304 Not Modified</span><br><span class="line">Response Head</span><br><span class="line">ETag:&quot;578ba64c-7ddf&quot;</span><br><span class="line">Last-Modified:Sun, 17 Jul 2016 15:37:48 GMT</span><br><span class="line">Request Head</span><br><span class="line">If-Modified-Since:Sun, 17 Jul 2016 15:37:48 GMT</span><br><span class="line">If-None-Match:&quot;578ba64c-7ddf&quot;</span><br></pre></td></tr></table></figure></p>
<p><img src="/2018/11/22/HTTPç¼“å­˜æœºåˆ¶-200è¿˜æ˜¯304/3.png" alt=""></p>
<blockquote>
<p>Invalidation</p>
</blockquote>
<p>ç±»ä¼¼PUTã€POST å’Œ DELETEçš„â€éå®‰å…¨â€è¯·æ±‚å¯èƒ½ä¼šæ”¹å˜åŸæœåŠ¡ç«¯çŠ¶æ€ï¼Œåœ¨æ­¤æœŸé—´ç¼“å­˜ä¼šè®©å®ƒä»¬çš„å†…å®¹è¿‡æœŸå¤±æ•ˆã€‚</p>
<p>å½“ä¸€ä¸ªéå®‰å…¨çš„è¯·æ±‚æ”¶åˆ°éé”™è¯¯çš„è¿”å›çŠ¶æ€ç ï¼ˆ2xxæˆ–è€…3xxï¼‰ï¼Œç¼“å­˜å¿…é¡»ä½¿è¯·æ±‚URIçš„åŒ…æ‹¬å…¶ä»–ç›¸å…³URI(s)çš„Locationå’ŒContent-Locationå“åº”å¤´å­—æ®µå¤±æ•ˆã€‚</p>
<p>ä¸ºäº†é˜²æ­¢æœåŠ¡å™¨æ”»å‡»æ‹’ç»ï¼Œä¸€ä¸ªåŸºäºLocationæˆ–Content-Locationå¤´åŸŸé‡Œçš„URIçš„æ— æ•ˆæ€§å¤„ç†å¿…é¡»åªæœ‰åœ¨hostéƒ¨åˆ†å’Œè¯·æ±‚URIé‡Œçš„hostéƒ¨åˆ†ç›¸åŒæ—¶æ‰è¢«æ‰§è¡Œã€‚</p>
<p>æ³¨ï¼šåªè¯»è¯·æ±‚ï¼ˆGET/HEADï¼‰è®¤ä¸ºæ˜¯â€œå®‰å…¨â€çš„ï¼Œè¯¦ç»†å¯æŸ¥çœ‹<a href="http://httpwg.org/specs/rfc7231.html#safe.methods" target="_blank" rel="noopener">safe.methods</a>ã€‚</p>
<h2 id="200-or-304"><a href="#200-or-304" class="headerlink" title="200 or 304"></a>200 or 304</h2><p>åœ¨æ²¡æœ‰è®¾ç½®Cache-Contralçš„æƒ…å†µä¸‹ï¼Œè®¾ç½®Last-Modifiedå’ŒETagç¼“å­˜ï¼Œä¼šå‡ºç°æ—¶è€Œ200ï¼ˆfrom cacheï¼‰ï¼Œæ—¶è€Œ304 å‡ºç°çš„æƒ…å†µã€‚</p>
<p>chrome æµ‹è¯• åˆ·æ–° å’Œ è¾“å…¥URLå›è½¦ æµ‹è¯•å¹¶ä¸ä¼šå½±å“200ï¼ˆfrom cacheï¼‰å’Œ304 çš„å‡ºç°ã€‚</p>
<p>å¯èƒ½çš„æƒ…å†µï¼Œæ˜¯åœ¨æœåŠ¡å™¨æ²¡æœ‰è®¾ç½®æ˜¾ç¤ºç¼“å­˜æ—¶é—´çš„æƒ…å†µä¸‹ï¼Œfreshness_lifetimeæ˜¯æµè§ˆå™¨æŒ‰æŸç§ç®—æ³•è®¡ç®—å‡ºæ¥ï¼Œè¿™ä¸ªæ—¶é—´å¹¶ä¸é•¿ï¼Œæ‰€ä»¥ä¼šå‡ºç°è¿™ç§æƒ…å†µã€‚</p>
<p>è®¾ç½®Cache-Contral max-ageçš„æƒ…å†µä¸‹ï¼Œmax-ageè¿‡æœŸåé¦–æ¬¡åˆ·æ–°ä¼šå‡ºç°304(å¦‚æœæœ‰æ›´æ–°å†…å®¹ï¼Œåˆ™æ˜¯200)ï¼Œä¹‹ååœ¨max-ageç¼“å­˜è¿‡æœŸä¹‹å‰åˆ·æ–°éƒ½æ˜¯200ï¼ˆfrom cacheï¼‰ã€‚</p>
<h2 id="ç¼“å­˜æ–¹æ¡ˆ"><a href="#ç¼“å­˜æ–¹æ¡ˆ" class="headerlink" title="ç¼“å­˜æ–¹æ¡ˆ"></a>ç¼“å­˜æ–¹æ¡ˆ</h2><p>è¾ƒé•¿çš„è¿‡æœŸæ—¶é—´ï¼ŒèŠ‚çœå¸¦å®½ï¼Œæé«˜æ€§èƒ½ï¼›æ›´æ”¹èµ„æºçš„ç½‘å€ï¼Œå¼ºåˆ¶ç”¨æˆ·ä¸‹è½½æ–°å“åº”</p>
<p><img src="/2018/11/22/HTTPç¼“å­˜æœºåˆ¶-200è¿˜æ˜¯304/4.png" alt=""></p>
<p>æŒ‰éœ€æ›´æ–°ï¼Œç²¾ç¡®çš„ç¼“å­˜æ§åˆ¶</p>
<p>é™æ€èµ„æºCDNéƒ¨ç½²</p>
<p>æ›´èµ„æºå‘å¸ƒè·¯å¾„å®ç°éè¦†ç›–å¼å‘å¸ƒï¼ˆå¤šç‰ˆæœ¬å…±å­˜ï¼‰</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/21/Vue-Proxyè§‚å¯Ÿè€…æœºåˆ¶æ¢ç´¢/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/21/Vue-Proxyè§‚å¯Ÿè€…æœºåˆ¶æ¢ç´¢/" itemprop="url">Vue3 Proxyè§‚å¯Ÿè€…æœºåˆ¶æ¢ç´¢</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-11-21T20:23:22+08:00">
                2018-11-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="/2018/11/21/Vue-Proxyè§‚å¯Ÿè€…æœºåˆ¶æ¢ç´¢/1.png" alt=""></p>
<h3 id="ä¸ºä»€ä¹ˆProxyå¯ä»¥ä¼˜åŒ–vueçš„æ•°æ®ç›‘å¬æœºåˆ¶"><a href="#ä¸ºä»€ä¹ˆProxyå¯ä»¥ä¼˜åŒ–vueçš„æ•°æ®ç›‘å¬æœºåˆ¶" class="headerlink" title="ä¸ºä»€ä¹ˆProxyå¯ä»¥ä¼˜åŒ–vueçš„æ•°æ®ç›‘å¬æœºåˆ¶?"></a>ä¸ºä»€ä¹ˆProxyå¯ä»¥ä¼˜åŒ–vueçš„æ•°æ®ç›‘å¬æœºåˆ¶?</h3><h4 id="vue2-xä¸­çš„å®ç°"><a href="#vue2-xä¸­çš„å®ç°" class="headerlink" title="vue2.xä¸­çš„å®ç°"></a>vue2.xä¸­çš„å®ç°</h4><p>å…¶æœ¬è´¨æ˜¯<code>new Watcher(data, key, callback)</code>çš„æ–¹å¼ï¼Œè€Œåœ¨è°ƒç”¨ä¹‹å‰æ˜¯å…ˆå°†dataä¸­çš„æ‰€æœ‰å±æ€§è½¬åŒ–æˆå¯ç›‘å¬çš„å¯¹è±¡, å…¶ä¸»è¦å°±æ˜¯åˆ©ç”¨<code>Object.defineProperty</code>ï¼Œã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">class Watcher&#123;</span><br><span class="line">    constructor(data, key, cb)&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">//è½¬æ¢æˆå¯ç›‘å¬å¯¹è±¡functionobserve(data)&#123;</span><br><span class="line">    new Observer(data)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//ä¿®æ”¹æ•°æ®çš„getterå’ŒsetterfunctiondefineReactive(obj, key)&#123;</span><br><span class="line">    let value = obj[key];</span><br><span class="line">    Object.defineProperty(obj, key, &#123;</span><br><span class="line">        enumerable: true,</span><br><span class="line">        configurable: true,</span><br><span class="line">        get()&#123;</span><br><span class="line">            return value;</span><br><span class="line">        &#125;,</span><br><span class="line">        set(newVal)&#123;</span><br><span class="line">            value = newVal</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Observerçš„å®ç°å¾ˆç®€å•<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">class Observer&#123;</span><br><span class="line">    constructor(data)&#123;</span><br><span class="line">        this.walk(data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    walk(data)&#123;</span><br><span class="line">        for(var key in data) &#123;</span><br><span class="line">            // è¿™é‡Œä¸è€ƒè™‘åµŒå¥—çš„é—®é¢˜ï¼Œå¦åˆ™çš„è¯éœ€è¦é€’å½’è°ƒç”¨walk</span><br><span class="line">            defineReactive(data, key)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ç°åœ¨æ€ä¹ˆå°†watcherå’Œgetter/setterè”ç³»èµ·æ¥ï¼Œvueçš„æ–¹æ³•æ˜¯æ·»åŠ ä¸€ä¸ªä¾èµ–ç±»ï¼šDep<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">class Watcher&#123;</span><br><span class="line">    constructor(data, key, cb)&#123;</span><br><span class="line">        this.cb = cb;</span><br><span class="line">        Dep.target = this; //æ¯æ¬¡æ–°å»ºwatcherçš„æ—¶å€™è®²ç»™targetèµ‹å€¼ï¼Œå¯¹targetçš„ç®¡ç†è¿™é‡Œç®€åŒ–äº†vueçš„å®ç°</span><br><span class="line">        data[key];//è°ƒç”¨getterï¼Œæ‰§è¡ŒaddSub, å°†targetä¼ å…¥å¯¹åº”çš„dep; vueçš„å®ç°æœ¬è´¨å°±æ˜¯å¦‚æ­¤</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class Dep&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        this.subs = [];</span><br><span class="line">    &#125;</span><br><span class="line">    addSub(sub)&#123;</span><br><span class="line">        this.subs.push(sub);</span><br><span class="line">    &#125;</span><br><span class="line">    notify()&#123;</span><br><span class="line">        this.subs.forEach(sub =&gt; sub.cb())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">function defineReactive(obj, key)&#123;</span><br><span class="line">    let value = obj[key];</span><br><span class="line">    let dep = new Dep(); //æ¯ä¸€ä¸ªå±æ€§éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„depï¼Œä½œä¸ºé—­åŒ…ä¿å­˜Object.defineProperty(obj, key, &#123;</span><br><span class="line">        enumerable: true,</span><br><span class="line">        configurable: true,</span><br><span class="line">        get()&#123;</span><br><span class="line">            dep.addSub(Dep.target)</span><br><span class="line">            Dep.target = null;</span><br><span class="line">            return value;</span><br><span class="line">        &#125;,</span><br><span class="line">        set(newVal)&#123;</span><br><span class="line">            value = newVal</span><br><span class="line">            dep.notify();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä»¥ä¸Šå°±æ˜¯vueçš„æ€è·¯ï¼Œvue3ä¹‹æ‰€ä»¥è¦ä»æ–°å®ç°ï¼Œä¸»è¦æœ‰è¿™å‡ ä¸ªåŸå› ï¼š</p>
<ul>
<li><ol>
<li><code>Object.defineProperty</code>çš„æ€§èƒ½å¼€é”€ã€‚</li>
</ol>
</li>
<li><ol start="2">
<li><code>defineReactive</code>ä¸€å¼€å§‹å°±è¦å¯¹è¦ç›‘å¬çš„å¯¹è±¡æ‰€æœ‰å±æ€§éƒ½æ‰§è¡Œä¸€éï¼Œå› ä¸ºä¼ ç»Ÿæ–¹æ³•è¦å°†ä¸€ä¸ªå¯¹è±¡è½¬æ¢æˆå¯ç›‘å¬å¯¹è±¡ï¼Œåªèƒ½å¦‚æ­¤ã€‚</li>
</ol>
</li>
<li><ol start="3">
<li>æ·»åŠ åˆ é™¤å±æ€§çš„é—®é¢˜ã€‚</li>
</ol>
</li>
<li><ol start="4">
<li>è¿˜æœ‰ä¸€ç‚¹å°±æ˜¯è¿™ä¸ªæ¨¡å—è¢«è€¦åˆåˆ°äº†vueé‡Œé¢ï¼Œæ–°ç‰ˆæœ¬å¯ä»¥å•ç‹¬ä½œä¸ºä¸€ä¸ªåº“æ¥ä½¿ç”¨ã€‚</li>
</ol>
</li>
</ul>
<p>ç„¶åæˆ‘ä»¬æ¥çœ‹çœ‹åŒæ ·çš„åŠŸèƒ½é‡‡ç”¨Proxyä¼šæ€æ ·å®ç°ã€‚</p>
<h4 id="Proxyçš„å®ç°"><a href="#Proxyçš„å®ç°" class="headerlink" title="Proxyçš„å®ç°"></a>Proxyçš„å®ç°</h4><p>å°†ä¸€ä¸ªå¯¹è±¡è½¬æ¢æˆProxyçš„æ–¹å¼å¾ˆç®€å•ï¼Œåªéœ€è¦ä½œä¸ºå‚æ•°ä¼ ç»™proxyå³å¯ï¼›</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">class Watcher&#123;</span><br><span class="line">    constructor(proxy, key, cb) &#123;</span><br><span class="line">        this.cb = cb;</span><br><span class="line">        Dep.target = this;</span><br><span class="line">        this.value = proxy[key];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Dep&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        this.subs = []</span><br><span class="line">    &#125;</span><br><span class="line">    addSub(sub)&#123;</span><br><span class="line">        this.subs.push(sub);</span><br><span class="line">    &#125;</span><br><span class="line">    notify(newVal)&#123;</span><br><span class="line">        this.subs.forEach(sub =&gt; &#123;</span><br><span class="line">            sub.cb(newVal, sub.value);</span><br><span class="line">            sub.value = newVal;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const observe = (obj) =&gt; &#123;</span><br><span class="line">    const deps = &#123;&#125;;</span><br><span class="line">    returnnewProxy(obj, &#123;</span><br><span class="line">        get: function (target, key, receiver) &#123;</span><br><span class="line">            const dep = (deps[key] = deps[key] || new Dep);</span><br><span class="line">            Dep.target &amp;&amp; dep.addSub(Dep.target)</span><br><span class="line">            Dep.target = null;</span><br><span class="line">            returnReflect.get(target, key, receiver);</span><br><span class="line">        &#125;,</span><br><span class="line">        set: function (target, key, value, receiver) &#123;</span><br><span class="line">            const dep = (deps[key] = deps[key] || new Dep);</span><br><span class="line">            Promise.resolve().then(() =&gt; &#123;</span><br><span class="line">                dep.notify(value);</span><br><span class="line">            &#125;)</span><br><span class="line">            returnReflect.set(target, key, value, receiver);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var state = observe(&#123;x:0&#125;)</span><br><span class="line">new Watcher(state, &apos;x&apos;, function(n, o)&#123;</span><br><span class="line">    console.log(n, o)</span><br><span class="line">&#125;);</span><br><span class="line">new Watcher(state, &apos;y&apos;, function(n, o)&#123;</span><br><span class="line">    console.log(n, o)</span><br><span class="line">&#125;);</span><br><span class="line">state.x = 3;</span><br><span class="line">state.y = 3;</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿè®¸ä¸€å¼€å§‹æˆ‘ä»¬åªå…³å¿ƒ<code>x</code>å’Œ<code>y</code>ï¼Œé‚£ä¹ˆå°±ä¸ä¼šå¯¹å…¶ä»–çš„å±æ€§åšç›¸åº”çš„å¤„ç†ï¼Œé™¤éæ·»åŠ watcherï¼Œå…¶ä»–æ—¶é—´targetéƒ½æ˜¯null</p>
<hr>
<p>Vue 3 ä»¥ä¸‹æ–¹é¢å€¼å¾—æˆ‘ä»¬æœŸå¾… ï¼š</p>
<ul>
<li>æ›´å¿«</li>
<li>æ›´å°</li>
<li>æ›´æ˜“äºç»´æŠ¤</li>
<li>æ›´å¤šçš„åŸç”Ÿæ”¯æŒ</li>
<li>æ›´æ˜“äºå¼€å‘ä½¿ç”¨</li>
</ul>
<p>å­¦ä¸åŠ¨çš„åŒå­¦è¿˜å¯ä»¥ç¼“ç¼“ ^_^</p>
<h3 id="ä¸ºä»€ä¹ˆè¦å–ä»£Object-defineProperty"><a href="#ä¸ºä»€ä¹ˆè¦å–ä»£Object-defineProperty" class="headerlink" title="ä¸ºä»€ä¹ˆè¦å–ä»£Object.defineProperty"></a>ä¸ºä»€ä¹ˆè¦å–ä»£Object.defineProperty</h3><p>æ—¢ç„¶è¦å–ä»£Object.definePropertyï¼Œé‚£å®ƒè‚¯å®šæ˜¯æœ‰ä¸€äº›æ˜æ˜¾çš„ç¼ºç‚¹ï¼Œæ€»ç»“èµ·æ¥å¤§æ¦‚æ˜¯ä¸‹é¢ä¸¤ä¸ªï¼š</p>
<blockquote>
<p>Object.definePropertyæ— æ³•ç›‘æ§åˆ°æ•°ç»„ä¸‹æ ‡çš„å˜åŒ–ï¼Œå¯¼è‡´ç›´æ¥é€šè¿‡æ•°ç»„çš„ä¸‹æ ‡ç»™æ•°ç»„è®¾ç½®å€¼ï¼Œä¸èƒ½å®æ—¶å“åº”ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç»è¿‡vueå†…éƒ¨å¤„ç†åå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‡ ç§æ–¹æ³•æ¥ç›‘å¬æ•°ç»„</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">push()</span><br><span class="line">pop()</span><br><span class="line">shift()</span><br><span class="line">unshift()</span><br><span class="line">splice()</span><br><span class="line">sort()</span><br><span class="line">reverse()</span><br></pre></td></tr></table></figure>
<p>ç”±äºåªé’ˆå¯¹äº†ä»¥ä¸Šå…«ç§æ–¹æ³•è¿›è¡Œäº†hackå¤„ç†,æ‰€ä»¥å…¶ä»–æ•°ç»„çš„å±æ€§ä¹Ÿæ˜¯æ£€æµ‹ä¸åˆ°çš„ï¼Œè¿˜æ˜¯å…·æœ‰ä¸€å®šçš„å±€é™æ€§ã€‚</p>
<blockquote>
<p>Object.definePropertyåªèƒ½åŠ«æŒå¯¹è±¡çš„å±æ€§,å› æ­¤æˆ‘ä»¬éœ€è¦å¯¹æ¯ä¸ªå¯¹è±¡çš„æ¯ä¸ªå±æ€§è¿›è¡Œéå†ã€‚Vue 2.xé‡Œï¼Œæ˜¯é€šè¿‡ é€’å½’ + éå† data å¯¹è±¡æ¥å®ç°å¯¹æ•°æ®çš„ç›‘æ§çš„ï¼Œå¦‚æœå±æ€§å€¼ä¹Ÿæ˜¯å¯¹è±¡é‚£ä¹ˆéœ€è¦æ·±åº¦éå†,æ˜¾ç„¶å¦‚æœèƒ½åŠ«æŒä¸€ä¸ªå®Œæ•´çš„å¯¹è±¡æ˜¯æ‰æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚</p>
</blockquote>
<p>è€Œè¦å–ä»£å®ƒçš„Proxyæœ‰ä»¥ä¸‹ä¸¤ä¸ªä¼˜ç‚¹;</p>
<ul>
<li>å¯ä»¥åŠ«æŒæ•´ä¸ªå¯¹è±¡ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°å¯¹è±¡</li>
<li>æœ‰13ç§åŠ«æŒæ“ä½œ</li>
</ul>
<p>çœ‹åˆ°è¿™å¯èƒ½æœ‰åŒå­¦è¦é—®äº†ï¼Œæ—¢ç„¶Proxyèƒ½è§£å†³ä»¥ä¸Šä¸¤ä¸ªé—®é¢˜ï¼Œè€Œä¸”Proxyä½œä¸ºes6çš„æ–°å±æ€§åœ¨vue2.xä¹‹å‰å°±æœ‰äº†ï¼Œä¸ºä»€ä¹ˆvue2.xä¸ä½¿ç”¨Proxyå‘¢ï¼Ÿä¸€ä¸ªå¾ˆé‡è¦çš„åŸå› å°±æ˜¯ï¼š</p>
<blockquote>
<p>Proxyæ˜¯es6æä¾›çš„æ–°ç‰¹æ€§ï¼Œå…¼å®¹æ€§ä¸å¥½ï¼Œæœ€ä¸»è¦çš„æ˜¯è¿™ä¸ªå±æ€§æ— æ³•ç”¨polyfillæ¥å…¼å®¹</p>
</blockquote>
<p>å…³äºObject.definePropertyæ¥å®ç°è§‚å¯Ÿè€…æœºåˆ¶ï¼Œå¯ä»¥å‚ç…§<a href="https://link.juejin.im?target=https%3A%2F%2Fsegmentfault.com%2Fa%2F1190000006599500" target="_blank" rel="noopener">å‰–æVueåŸç†&amp;å®ç°åŒå‘ç»‘å®šMVVM</a>è¿™ç¯‡æ–‡ç« ï¼Œä¸‹é¢çš„å†…å®¹ä¸»è¦ä»‹ç»å¦‚ä½•åŸºäº Proxyæ¥å®ç°vueè§‚å¯Ÿè€…æœºåˆ¶ã€‚</p>
<h3 id="ä»€ä¹ˆæ˜¯Proxy-ECMAScript-6-å…¥é—¨"><a href="#ä»€ä¹ˆæ˜¯Proxy-ECMAScript-6-å…¥é—¨" class="headerlink" title="ä»€ä¹ˆæ˜¯Proxy , ECMAScript 6 å…¥é—¨"></a>ä»€ä¹ˆæ˜¯Proxy , <a href="http://es6.ruanyifeng.com/#docs/proxy" target="_blank" rel="noopener">ECMAScript 6 å…¥é—¨</a></h3><p>1.å«ä¹‰ï¼š</p>
<ul>
<li>Proxyæ˜¯ ES6 ä¸­æ–°å¢çš„ä¸€ä¸ªç‰¹æ€§ï¼Œç¿»è¯‘è¿‡æ¥æ„æ€æ˜¯â€ä»£ç†â€ï¼Œç”¨åœ¨è¿™é‡Œè¡¨ç¤ºç”±å®ƒæ¥â€œä»£ç†â€æŸäº›æ“ä½œã€‚</li>
<li>Proxy è®©æˆ‘ä»¬èƒ½å¤Ÿä»¥ç®€æ´æ˜“æ‡‚çš„æ–¹å¼æ§åˆ¶å¤–éƒ¨å¯¹å¯¹è±¡çš„è®¿é—®ã€‚å…¶åŠŸèƒ½éå¸¸ç±»ä¼¼äºè®¾è®¡æ¨¡å¼ä¸­çš„ä»£ç†æ¨¡å¼ã€‚</li>
<li>Proxy å¯ä»¥ç†è§£æˆï¼Œåœ¨ç›®æ ‡å¯¹è±¡ä¹‹å‰æ¶è®¾ä¸€å±‚â€œæ‹¦æˆªâ€ï¼Œå¤–ç•Œå¯¹è¯¥å¯¹è±¡çš„è®¿é—®ï¼Œéƒ½å¿…é¡»å…ˆé€šè¿‡è¿™å±‚æ‹¦æˆªï¼Œå› æ­¤æä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œå¯ä»¥å¯¹å¤–ç•Œçš„è®¿é—®è¿›è¡Œè¿‡æ»¤å’Œæ”¹å†™ã€‚</li>
<li>ä½¿ç”¨ Proxy çš„æ ¸å¿ƒä¼˜ç‚¹æ˜¯å¯ä»¥äº¤ç”±å®ƒæ¥å¤„ç†ä¸€äº›éæ ¸å¿ƒé€»è¾‘ï¼ˆå¦‚ï¼šè¯»å–æˆ–è®¾ç½®å¯¹è±¡çš„æŸäº›å±æ€§å‰è®°å½•æ—¥å¿—ï¼›è®¾ç½®å¯¹è±¡çš„æŸäº›å±æ€§å€¼å‰ï¼Œéœ€è¦éªŒè¯ï¼›æŸäº›å±æ€§çš„è®¿é—®æ§åˆ¶ç­‰ï¼‰ã€‚ ä»è€Œå¯ä»¥è®©å¯¹è±¡åªéœ€å…³æ³¨äºæ ¸å¿ƒé€»è¾‘ï¼Œè¾¾åˆ°å…³æ³¨ç‚¹åˆ†ç¦»ï¼Œé™ä½å¯¹è±¡å¤æ‚åº¦ç­‰ç›®çš„ã€‚</li>
</ul>
<p>Proxy å¯ä»¥ç†è§£æˆï¼Œåœ¨ç›®æ ‡å¯¹è±¡ä¹‹å‰æ¶è®¾ä¸€å±‚â€œæ‹¦æˆªâ€ï¼Œå¤–ç•Œå¯¹è¯¥å¯¹è±¡çš„è®¿é—®ï¼Œéƒ½å¿…é¡»å…ˆé€šè¿‡è¿™å±‚æ‹¦æˆªï¼Œå› æ­¤æä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œå¯ä»¥å¯¹å¤–ç•Œçš„è®¿é—®è¿›è¡Œè¿‡æ»¤å’Œæ”¹å†™ã€‚Proxy è¿™ä¸ªè¯çš„åŸæ„æ˜¯ä»£ç†ï¼Œç”¨åœ¨è¿™é‡Œè¡¨ç¤ºç”±å®ƒæ¥â€œä»£ç†â€æŸäº›æ“ä½œï¼Œå¯ä»¥è¯‘ä¸ºâ€œä»£ç†å™¨â€ã€‚</p>
<p>2.åŸºæœ¬ç”¨æ³•ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let p = new Proxy(target, handler);</span><br></pre></td></tr></table></figure></p>
<p>å‚æ•°ï¼š</p>
<ul>
<li><code>target</code> æ˜¯ç”¨ProxyåŒ…è£…çš„è¢«ä»£ç†å¯¹è±¡ï¼ˆå¯ä»¥æ˜¯ä»»ä½•ç±»å‹çš„å¯¹è±¡ï¼ŒåŒ…æ‹¬åŸç”Ÿæ•°ç»„ï¼Œå‡½æ•°ï¼Œç”šè‡³å¦ä¸€ä¸ªä»£ç†ï¼‰ã€‚</li>
<li><code>handler</code> æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶å£°æ˜äº†ä»£ç†target çš„ä¸€äº›æ“ä½œï¼Œå…¶å±æ€§æ˜¯å½“æ‰§è¡Œä¸€ä¸ªæ“ä½œæ—¶å®šä¹‰ä»£ç†çš„è¡Œä¸ºçš„å‡½æ•°ã€‚</li>
<li><code>p</code> æ˜¯ä»£ç†åçš„å¯¹è±¡ã€‚å½“å¤–ç•Œæ¯æ¬¡å¯¹ p è¿›è¡Œæ“ä½œæ—¶ï¼Œå°±ä¼šæ‰§è¡Œ handler å¯¹è±¡ä¸Šçš„ä¸€äº›æ–¹æ³•ã€‚Proxyå…±æœ‰13ç§åŠ«æŒæ“ä½œï¼Œhandlerä»£ç†çš„ä¸€äº›å¸¸ç”¨çš„æ–¹æ³•æœ‰å¦‚ä¸‹å‡ ä¸ªï¼š</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">getï¼šè¯»å–</span><br><span class="line">setï¼šä¿®æ”¹</span><br><span class="line">hasï¼šåˆ¤æ–­å¯¹è±¡æ˜¯å¦æœ‰è¯¥å±æ€§</span><br><span class="line">constructï¼šæ„é€ å‡½æ•°</span><br></pre></td></tr></table></figure>
<p>3.ç¤ºä¾‹ï¼š</p>
<p>ä¸‹é¢å°±ç”¨Proxyæ¥å®šä¹‰ä¸€ä¸ªå¯¹è±¡çš„getå’Œsetï¼Œä½œä¸ºä¸€ä¸ªåŸºç¡€demo<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">let obj = &#123;&#125;;</span><br><span class="line"> let handler = &#123;</span><br><span class="line">   get(target, property) &#123;</span><br><span class="line">    console.log(`$&#123;property&#125; è¢«è¯»å–`);</span><br><span class="line">    return property in target ? target[property] : 3;</span><br><span class="line">   &#125;,</span><br><span class="line">   set(target, property, value) &#123;</span><br><span class="line">    console.log(`$&#123;property&#125; è¢«è®¾ç½®ä¸º $&#123;value&#125;`);</span><br><span class="line">    target[property] = value;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> let p = new Proxy(obj, handler);</span><br><span class="line"> p.name = &apos;tom&apos; //name è¢«è®¾ç½®ä¸º tom</span><br><span class="line"> p.age; //age è¢«è¯»å– 3</span><br></pre></td></tr></table></figure></p>
<ul>
<li>p è¯»å–å±æ€§çš„å€¼æ—¶ï¼Œå®é™…ä¸Šæ‰§è¡Œçš„æ˜¯ handler.get() ï¼šåœ¨æ§åˆ¶å°è¾“å‡ºä¿¡æ¯ï¼Œå¹¶ä¸”è¯»å–è¢«ä»£ç†å¯¹è±¡ obj çš„å±æ€§ã€‚</li>
<li>p è®¾ç½®å±æ€§å€¼æ—¶ï¼Œå®é™…ä¸Šæ‰§è¡Œçš„æ˜¯ handler.set() ï¼šåœ¨æ§åˆ¶å°è¾“å‡ºä¿¡æ¯ï¼Œå¹¶ä¸”è®¾ç½®è¢«ä»£ç†å¯¹è±¡ obj çš„å±æ€§çš„å€¼ã€‚</li>
</ul>
<p>ä»¥ä¸Šä»‹ç»äº†ProxyåŸºæœ¬ç”¨æ³•ï¼Œå®é™…ä¸Šè¿™ä¸ªå±æ€§è¿˜æœ‰è®¸å¤šå†…å®¹ï¼Œå…·ä½“å¯å‚è€ƒ<a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FProxy" target="_blank" rel="noopener">Proxyæ–‡æ¡£</a></p>
<h3 id="åŸºäºProxyæ¥å®ç°åŒå‘ç»‘å®š"><a href="#åŸºäºProxyæ¥å®ç°åŒå‘ç»‘å®š" class="headerlink" title="åŸºäºProxyæ¥å®ç°åŒå‘ç»‘å®š"></a>åŸºäºProxyæ¥å®ç°åŒå‘ç»‘å®š</h3><p>è¯ä¸å¤šè¯´ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥ç”¨Proxyæ¥å®ç°ä¸€ä¸ªç»å…¸çš„åŒå‘ç»‘å®štodolistï¼Œé¦–å…ˆç®€å•çš„å†™ä¸€ç‚¹htmlç»“æ„ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=&quot;app&quot;&gt;</span><br><span class="line">     &lt;input type=&quot;text&quot; id=&quot;input&quot; /&gt;</span><br><span class="line">     &lt;div&gt;æ‚¨è¾“å…¥çš„æ˜¯ï¼š &lt;span id=&quot;title&quot;&gt;&lt;/span&gt;&lt;/div&gt;</span><br><span class="line">     &lt;button type=&quot;button&quot; name=&quot;button&quot; id=&quot;btn&quot;&gt;æ·»åŠ åˆ°todolist&lt;/button&gt;</span><br><span class="line">     &lt;ul id=&quot;list&quot;&gt;&lt;/ul&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure></p>
<p>å…ˆæ¥ä¸€ä¸ªProxyï¼Œå®ç°è¾“å…¥æ¡†çš„åŒå‘ç»‘å®šæ˜¾ç¤ºï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">const obj = &#123;&#125;;</span><br><span class="line">const input = document.getElementById(&quot;input&quot;);</span><br><span class="line">const title = document.getElementById(&quot;title&quot;);</span><br><span class="line"></span><br><span class="line">const newObj = new Proxy(obj, &#123;</span><br><span class="line">  get: function(target, key, receiver) &#123;</span><br><span class="line">    console.log(`getting $&#123;key&#125;!`);</span><br><span class="line">    return Reflect.get(target, key, receiver);</span><br><span class="line">  &#125;,</span><br><span class="line">  set: function(target, key, value, receiver) &#123;</span><br><span class="line">    console.log(target, key, value, receiver);</span><br><span class="line">    if (key === &quot;text&quot;) &#123;</span><br><span class="line">      input.value = value;</span><br><span class="line">      title.innerHTML = value;</span><br><span class="line">    &#125;</span><br><span class="line">    return Reflect.set(target, key, value, receiver);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">    </span><br><span class="line">input.addEventListener(&quot;keyup&quot;, function(e) &#123;</span><br><span class="line">  newObj.text = e.target.value;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>è¿™é‡Œä»£ç æ¶‰åŠåˆ°<code>Reflect</code>å±æ€§ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ªes6çš„æ–°ç‰¹æ€§ï¼Œè¿˜ä¸å¤ªäº†è§£çš„åŒå­¦å¯ä»¥å‚è€ƒ<a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FReflect" target="_blank" rel="noopener">Reflectæ–‡æ¡£</a>.<br>æ¥ä¸‹æ¥å°±æ˜¯æ·»åŠ todoliståˆ—è¡¨ï¼Œå…ˆæŠŠæ•°ç»„æ¸²æŸ“åˆ°é¡µé¢ä¸Šå»ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> // æ¸²æŸ“todoliståˆ—è¡¨</span><br><span class="line">const Render = &#123;</span><br><span class="line">  // åˆå§‹åŒ–</span><br><span class="line">  init: function(arr) &#123;</span><br><span class="line">    const fragment = document.createDocumentFragment();</span><br><span class="line">    for (let i = 0; i &lt; arr.length; i++) &#123;</span><br><span class="line">      const li = document.createElement(&quot;li&quot;);</span><br><span class="line">      li.textContent = arr[i];</span><br><span class="line">      fragment.appendChild(li);</span><br><span class="line">    &#125;</span><br><span class="line">    list.appendChild(fragment);</span><br><span class="line">  &#125;,</span><br><span class="line">  addList: function(val) &#123;</span><br><span class="line">    const li = document.createElement(&quot;li&quot;);</span><br><span class="line">    li.textContent = val;</span><br><span class="line">    list.appendChild(li);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>å†æ¥ä¸€ä¸ªProxyï¼Œå®ç°Todolistçš„æ·»åŠ ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">const arr = [];</span><br><span class="line">// ç›‘å¬æ•°ç»„</span><br><span class="line">const newArr = new Proxy(arr, &#123;</span><br><span class="line">  get: function(target, key, receiver) &#123;</span><br><span class="line">    return Reflect.get(target, key, receiver);</span><br><span class="line">  &#125;,</span><br><span class="line">  set: function(target, key, value, receiver) &#123;</span><br><span class="line">    console.log(target, key, value, receiver);</span><br><span class="line">    if (key !== &quot;length&quot;) &#123;</span><br><span class="line">      Render.addList(value);</span><br><span class="line">    &#125;</span><br><span class="line">    return Reflect.set(target, key, value, receiver);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">    </span><br><span class="line">// åˆå§‹åŒ–</span><br><span class="line">window.onload = function() &#123;</span><br><span class="line">  Render.init(arr);</span><br><span class="line">&#125;;</span><br><span class="line">    </span><br><span class="line">btn.addEventListener(&quot;click&quot;, function() &#123;</span><br><span class="line">  newArr.push(parseInt(newObj.text));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>è¿™æ ·å°±ç”¨ Proxyå®ç°äº†ä¸€ä¸ªç®€å•çš„åŒå‘ç»‘å®šTodolist,å…·ä½“ä»£ç å¯å‚è€ƒ<a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fnightzing%2Fvue3-Proxy%2Fblob%2Fmaster%2Fproxy.html" target="_blank" rel="noopener">proxy.html</a></p>
<h3 id="åŸºäºProxyæ¥å®ç°vueçš„è§‚å¯Ÿè€…æœºåˆ¶"><a href="#åŸºäºProxyæ¥å®ç°vueçš„è§‚å¯Ÿè€…æœºåˆ¶" class="headerlink" title="åŸºäºProxyæ¥å®ç°vueçš„è§‚å¯Ÿè€…æœºåˆ¶"></a>åŸºäºProxyæ¥å®ç°vueçš„è§‚å¯Ÿè€…æœºåˆ¶</h3><p>1.Proxyå®ç°observe<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">observe(data) &#123;</span><br><span class="line">    const that = this;</span><br><span class="line">    let handler = &#123;</span><br><span class="line">     get(target, property) &#123;</span><br><span class="line">        return target[property];</span><br><span class="line">      &#125;,</span><br><span class="line">      set(target, key, value) &#123;</span><br><span class="line">        let res = Reflect.set(target, key, value);</span><br><span class="line">        that.subscribe[key].map(item =&gt; &#123;</span><br><span class="line">          item.update();</span><br><span class="line">        &#125;);</span><br><span class="line">        return res;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    this.$data = new Proxy(data, handler);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿™æ®µä»£ç é‡ŒæŠŠä»£ç†å™¨è¿”å›çš„å¯¹è±¡ä»£ç†åˆ°<code>this.$data</code>ï¼Œå³<code>this.$data</code>æ˜¯ä»£ç†åçš„å¯¹è±¡ï¼Œå¤–éƒ¨æ¯æ¬¡å¯¹<code>this.$data</code>è¿›è¡Œæ“ä½œæ—¶ï¼Œå®é™…ä¸Šæ‰§è¡Œçš„æ˜¯è¿™æ®µä»£ç é‡Œhandlerå¯¹è±¡ä¸Šçš„æ–¹æ³•ã€‚</p>
<p>2.compileå’Œwatcher</p>
<ul>
<li>æ¯”è¾ƒç†Ÿæ‚‰vueçš„åŒå­¦éƒ½å¾ˆæ¸…æ¥šï¼Œvue2.xåœ¨ new Vue() ä¹‹åã€‚ Vue ä¼šè°ƒç”¨ _init å‡½æ•°è¿›è¡Œåˆå§‹åŒ–ï¼Œå®ƒä¼šåˆå§‹åŒ–ç”Ÿå‘½å‘¨æœŸã€äº‹ä»¶ã€ propsã€ methodsã€ dataã€ computed ä¸ watch ç­‰ã€‚å…¶ä¸­æœ€é‡è¦çš„æ˜¯é€šè¿‡ Object.defineProperty è®¾ç½® setter ä¸ getter å‡½æ•°ï¼Œç”¨æ¥å®ç°ã€Œå“åº”å¼ã€ä»¥åŠã€Œä¾èµ–æ”¶é›†ã€ã€‚ç±»ä¼¼äºä¸‹é¢è¿™ä¸ªå†…éƒ¨æµç¨‹å›¾ï¼š<br><img src="/2018/11/21/Vue-Proxyè§‚å¯Ÿè€…æœºåˆ¶æ¢ç´¢/2.png" alt=""></li>
<li>è€Œæˆ‘ä»¬ä¸Šé¢å·²ç»ç”¨Proxyå–ä»£äº†Object.definePropertyè¿™éƒ¨åˆ†è§‚å¯Ÿè€…æœºåˆ¶ï¼Œè€Œè¦å®ç°æ•´ä¸ªåŸºæœ¬mvvmåŒå‘ç»‘å®šæµç¨‹ï¼Œé™¤äº†observeè¿˜éœ€è¦compileå’Œwatcheç­‰ä¸€ç³»åˆ—æœºåˆ¶ï¼Œæˆ‘ä»¬è¿™é‡Œåƒæ¨¡æ¿ç¼–è¯‘çš„å·¥ä½œå°±ä¸å±•å¼€æè¿°äº†ï¼Œä¸ºäº†å®ç°åŸºäºProxyçš„vueæ·»åŠ Totolist,è¿™é‡Œåªå†™äº†</li>
<li>compileå’Œwatcheræ¥æ”¯æŒobserveçš„å·¥ä½œï¼Œå…·ä½“ä»£ç å‚è€ƒ<a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fnightzing%2Fvue3-Proxy%2Fblob%2Fmaster%2FproxyVue.html" target="_blank" rel="noopener">proxyVue</a>,è¿™ä¸ªä»£ç ç›¸å½“äºä¸€ä¸ªåŸºäºProxyçš„ä¸€ä¸ªç®€åŒ–ç‰ˆvueï¼Œä¸»è¦æ˜¯å®ç°åŒå‘ç»‘å®šè¿™ä¸ªåŠŸèƒ½ï¼Œä¸ºäº†æ–¹ä¾¿è¿™é‡ŒæŠŠjsæ”¾åˆ°äº†htmlé¡µé¢ä¸­ï¼Œå¤§å®¶æœ¬åœ°è¿è¡Œåå¯ä»¥å‘ç°ï¼Œç°åœ¨çš„æ•ˆæœå’Œç¬¬ä¸‰ç« çš„æ•ˆæœè¾¾åˆ°ä¸€è‡´äº†ï¼Œç­‰åˆ°æ˜å¹´vue3å‘å¸ƒï¼Œå®ƒæºç é‡ŒåŸºäº Proxyå®ç°çš„çš„è§‚å¯Ÿè€…æœºåˆ¶å¯èƒ½å’Œè¿™é‡Œçš„å®ç°ä¼šæœ‰å¾ˆå¤šä¸åŒï¼Œè¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯å¯¹ Proxyè¿™ä¸ªç‰¹æ€§åšäº†ä¸€äº›ä»‹ç»ä»¥åŠå®ƒçš„ä¸€äº›åº”ç”¨ï¼Œè€Œä½œè€…æœ¬äººä¹Ÿé€šè¿‡å¯¹Proxy çš„è§‚å¯Ÿè€…æœºåˆ¶æ¢ç´¢å­¦åˆ°äº†ä¸å°‘ä¸œè¥¿ï¼Œæ‰€ä»¥æ•´åˆèµ„æºï¼Œæ€»ç»“å‡ºäº†è¿™ç¯‡æ–‡ç« ï¼Œå¸Œæœ›èƒ½å’Œå¤§å®¶å…±å‹‰ä¹‹ï¼Œä»¥ä¸Šï¼Œæˆ‘ä»¬ä¸‹æ¬¡æœ‰ç¼˜å†è§ã€‚</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/16/å®ç°ä¸€ä¸ªå›åˆ°é¡¶éƒ¨/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/16/å®ç°ä¸€ä¸ªå›åˆ°é¡¶éƒ¨/" itemprop="url">å®ç°ä¸€ä¸ªå›åˆ°é¡¶éƒ¨</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-11-16T20:12:29+08:00">
                2018-11-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œç»å¸¸ç”¨åˆ°æ»šåŠ¨åˆ°é¡µé¢é¡¶éƒ¨æˆ–æŸä¸ªä½ç½®ï¼Œä¸€èˆ¬ç®€å•ç”¨é”šç‚¹å¤„ç†æˆ–ç”¨jså°†<code>document.body.scrollTop</code>è®¾ç½®ä¸º0ï¼Œç»“æœæ˜¯é¡µé¢ä¸€é—ªè€Œè¿‡æ»šåˆ°æŒ‡å®šä½ç½®ï¼Œä¸æ˜¯ç‰¹åˆ«å‹å¥½ã€‚æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœæ˜¯è¦æœ‰ç‚¹ç¼“å†²æ•ˆæœã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$(&apos;html,body&apos;).animate(&#123;</span><br><span class="line">   scrollTop: 0</span><br><span class="line">&#125;, 700);</span><br></pre></td></tr></table></figure></p>
<p>ç°ä»£æµè§ˆå™¨é™†ç»­æ„è¯†åˆ°äº†è¿™ç§éœ€æ±‚ï¼Œ<code>scrollIntoView</code>æ„æ€æ˜¯æ»šåŠ¨åˆ°å¯è§†ï¼Œcssä¸­æä¾›äº†<code>scroll-behavior</code>å±æ€§ï¼Œjsæœ‰<code>Element.scrollIntoView()</code>æ–¹æ³•ã€‚</p>
<blockquote>
<p>çº¯csså®ç°tabåˆ‡æ¢</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line"></span><br><span class="line">	&lt;head&gt;</span><br><span class="line">		&lt;meta charset=&quot;utf-8&quot;&gt;</span><br><span class="line">		&lt;title&gt;çº¯csså®ç°tabåˆ‡æ¢&lt;/title&gt;</span><br><span class="line">		&lt;style type=&quot;text/css&quot;&gt;</span><br><span class="line">			* &#123;</span><br><span class="line">				margin: 0;</span><br><span class="line">				padding: 0;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			.tab &#123;</span><br><span class="line">				width: 300px;</span><br><span class="line">				height: 150px;</span><br><span class="line">				margin-left: 30px;</span><br><span class="line">				margin-top: 30px;</span><br><span class="line">				border: 1px solid #eee;</span><br><span class="line">				position: relative;</span><br><span class="line">				overflow: hidden;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			input[type=&apos;radio&apos;] &#123;</span><br><span class="line">				display: none;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			.tab label &#123;</span><br><span class="line">				display: block;</span><br><span class="line">				cursor: pointer;</span><br><span class="line">				position: absolute;</span><br><span class="line">				width: 60px;</span><br><span class="line">				height: 30px;</span><br><span class="line">				line-height: 30px;</span><br><span class="line">				text-align: center;</span><br><span class="line">				border: 1px solid #eee;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			.label-1 &#123;</span><br><span class="line">				left: 0;</span><br><span class="line">				top: 0;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			.label-2 &#123;</span><br><span class="line">				left: 60px;</span><br><span class="line">				top: 0;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			input[type=&apos;radio&apos;]:checked~div[class^=&apos;mod&apos;] &#123;</span><br><span class="line">				display: block;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			input[type=&apos;radio&apos;]:checked~label &#123;</span><br><span class="line">				background: orange;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			[class^=&apos;mod&apos;] &#123;</span><br><span class="line">				position: absolute;</span><br><span class="line">				top: 40px;</span><br><span class="line">				left: 20px;</span><br><span class="line">				display: none;</span><br><span class="line">			&#125;</span><br><span class="line">		&lt;/style&gt;</span><br><span class="line">	&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">	&lt;body&gt;</span><br><span class="line">		&lt;div class=&quot;tab&quot;&gt;</span><br><span class="line">			&lt;div&gt;</span><br><span class="line">				&lt;input type=&quot;radio&quot; id=&quot;r-1&quot; name=&quot;tab&quot; checked&gt;</span><br><span class="line">				&lt;label for=&quot;r-1&quot; class=&quot;label-1&quot;&gt;ç¬¬ä¸€å¼ &lt;/label&gt;</span><br><span class="line">				&lt;div class=&quot;mod-1&quot;&gt;</span><br><span class="line">					&lt;ul&gt;</span><br><span class="line">						&lt;li&gt;275ä¸‡è´­æ˜Œå¹³é‚»é“ä¸‰å±…&lt;/li&gt;</span><br><span class="line">						&lt;li&gt;æ€»ä»·20ä¸‡ä¹°ä¸€å±…&lt;/li&gt;</span><br><span class="line">						&lt;li&gt;200ä¸‡å†…è´­äº”ç¯ä¸‰å±…&lt;/li&gt;</span><br><span class="line">						&lt;li&gt;åŒ—äº¬é¦–ç°é›¶é¦–ä»˜æ¥¼ç›˜&lt;/li&gt;</span><br><span class="line">					&lt;/ul&gt;</span><br><span class="line">				&lt;/div&gt;</span><br><span class="line">			&lt;/div&gt;</span><br><span class="line">			&lt;div&gt;</span><br><span class="line">				&lt;input type=&quot;radio&quot; id=&quot;r-2&quot; name=&quot;tab&quot;&gt;</span><br><span class="line">				&lt;label for=&quot;r-2&quot; class=&quot;label-2&quot;&gt;ç¬¬äºŒå¼ &lt;/label&gt;</span><br><span class="line">				&lt;div class=&quot;mod-2&quot;&gt;</span><br><span class="line">					&lt;ul&gt;</span><br><span class="line">						&lt;li&gt;æ–°ä¸­å¼çš„é…·è‰²æ¸©æƒ…&lt;/li&gt;</span><br><span class="line">						&lt;li&gt;æ·±åœ³æˆ¿ä»·å¤§è·Œ,æ¯å¹³8W&lt;/li&gt;</span><br><span class="line">						&lt;li&gt;800ä¸‡ä¹°æ²™äº•ä¸‰æˆ¿&lt;/li&gt;</span><br><span class="line">						&lt;li&gt;å®å®‰æˆ¿ä»·å¹³å‡900W&lt;/li&gt;</span><br><span class="line">					&lt;/ul&gt;</span><br><span class="line">				&lt;/div&gt;</span><br><span class="line">			&lt;/div&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">	&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>çº¯csså®ç°tabåˆ‡æ¢2</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line"></span><br><span class="line">	&lt;head&gt;</span><br><span class="line">		&lt;meta charset=&quot;utf-8&quot;&gt;</span><br><span class="line">		&lt;title&gt;cssTabåˆ‡æ¢2&lt;/title&gt;</span><br><span class="line">		&lt;style type=&quot;text/css&quot;&gt;</span><br><span class="line">			* &#123;</span><br><span class="line">				margin: 0;</span><br><span class="line">				padding: 0;</span><br><span class="line">				text-decoration: none;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			.tab &#123;</span><br><span class="line">				width: 300px;</span><br><span class="line">				height: 300px;</span><br><span class="line">				margin: 30px auto;</span><br><span class="line">				overflow: hidden;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			.nav &#123;</span><br><span class="line">				height: 30px</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			.content &#123;</span><br><span class="line">				height: 270px;</span><br><span class="line">				overflow: hidden;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			.cont &#123;</span><br><span class="line">				height: 270px;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			#the1 &#123;</span><br><span class="line">				background: green;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			#the2 &#123;</span><br><span class="line">				background: blue;</span><br><span class="line">			&#125;</span><br><span class="line">		&lt;/style&gt;</span><br><span class="line">	&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">	&lt;body&gt;</span><br><span class="line">		&lt;div class=&quot;tab&quot;&gt;</span><br><span class="line">			&lt;div class=&quot;nav&quot;&gt;</span><br><span class="line">				&lt;a href=&quot;#the1&quot;&gt;ONE&lt;/a&gt;</span><br><span class="line">				&lt;a href=&quot;#the2&quot;&gt;TWO&lt;/a&gt;</span><br><span class="line">			&lt;/div&gt;</span><br><span class="line">			&lt;div class=&quot;content&quot;&gt;</span><br><span class="line">				&lt;div id=&quot;the1&quot; class=&quot;cont&quot;&gt;ç¬¬ä¸€å¼ &lt;/div&gt;</span><br><span class="line">				&lt;div id=&quot;the2&quot; class=&quot;cont&quot;&gt;ç¬¬äºŒå¼ &lt;/div&gt;</span><br><span class="line">			&lt;/div&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">	&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h1 id="scroll-behavior"><a href="#scroll-behavior" class="headerlink" title="scroll-behavior"></a>scroll-behavior</h1><p><code>scroll-behavior</code>å±æ€§å¯å–å€¼ <code>auto</code> | <code>smooth</code> | <code>inherit</code> | <code>unset</code></p>
<p><code>scroll-behavior: smooth;</code>æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç¼“å†²æ•ˆæœã€‚åœ¨PCæµè§ˆå™¨ä¸­ï¼Œé¡µé¢é»˜è®¤æ»šåŠ¨æ˜¯åœ¨<code>&lt;html&gt;</code>æ ‡ç­¾ä¸Šï¼Œç§»åŠ¨ç«¯å¤§å¤šæ•°åœ¨<code>&lt;body&gt;</code>æ ‡ç­¾ä¸Šï¼Œåœ¨æˆ‘ä»¬æƒ³è¦å®ç°å¹³æ»‘â€œå›åˆ°é¡¶éƒ¨â€ï¼Œåªéœ€åœ¨è¿™ä¸¤ä¸ªæ ‡ç­¾ä¸Šéƒ½åŠ ä¸Šï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">html, body &#123;</span><br><span class="line">  scroll-behavior: smooth;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å‡†ç¡®çš„è¯´ï¼Œå†™åœ¨å®¹å™¨å…ƒç´ ä¸Šï¼Œå¯ä»¥è®©å®¹å™¨ï¼ˆéé¼ æ ‡æ‰‹åŠ¿è§¦å‘ï¼‰çš„æ»šåŠ¨å˜å¾—å¹³æ»‘ï¼Œè€Œä¸å±€é™äº<code>&lt;html&gt;</code>ï¼Œ<code>&lt;body&gt;</code>æ ‡ç­¾ã€‚</p>
<p>åˆ©ç”¨è¿™ä¸ªcsså±æ€§å¯ä»¥ä¸€æ­¥å°†åŸæ¥çº¯cssæ ‡ç­¾ç›´æ¥åˆ‡æ¢ï¼Œå˜æˆå¹³æ»‘è¿‡æ¸¡åˆ‡æ¢æ•ˆæœã€‚</p>
<blockquote>
<p>çº¯csså®ç°tabåˆ‡æ¢3</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line"></span><br><span class="line">	&lt;head&gt;</span><br><span class="line">		&lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">		&lt;title&gt;&lt;/title&gt;</span><br><span class="line">		&lt;style type=&quot;text/css&quot;&gt;</span><br><span class="line">			html,</span><br><span class="line">			body &#123;</span><br><span class="line">				scroll-behavior: smooth;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			.tab label &#123;</span><br><span class="line">				padding: 10px;</span><br><span class="line">				border: 1px solid #ccc;</span><br><span class="line">				margin-right: -1px;</span><br><span class="line">				text-align: center;</span><br><span class="line">				float: left;</span><br><span class="line">				overflow: hidden;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			.tab::after &#123;</span><br><span class="line">				content: &quot;&quot;;</span><br><span class="line">				display: table;</span><br><span class="line">				clear: both;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			.box &#123;</span><br><span class="line">				height: 200px;</span><br><span class="line">				border: 1px solid #ccc;</span><br><span class="line">				scroll-behavior: smooth;</span><br><span class="line">				overflow: hidden;</span><br><span class="line">				margin-top: 10px;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			.item &#123;</span><br><span class="line">				height: 100%;</span><br><span class="line">				position: relative;</span><br><span class="line">				overflow: hidden;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			.item input &#123;</span><br><span class="line">				position: absolute;</span><br><span class="line">				top: 0;</span><br><span class="line">				height: 100%;</span><br><span class="line">				width: 1px;</span><br><span class="line">				border: 0;</span><br><span class="line">				padding: 0;</span><br><span class="line">				margin: 0;</span><br><span class="line">				clip: rect(0 0 0 0);</span><br><span class="line">			&#125;</span><br><span class="line">		&lt;/style&gt;</span><br><span class="line">	&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">	&lt;body&gt;</span><br><span class="line">		&lt;h1&gt;çº¯CSSé€‰é¡¹å¡&lt;/h1&gt;</span><br><span class="line">		&lt;div class=&quot;tab&quot;&gt;</span><br><span class="line">			&lt;label for=&quot;tab1&quot;&gt;é€‰é¡¹å¡1&lt;/label&gt;</span><br><span class="line">			&lt;label for=&quot;tab2&quot;&gt;é€‰é¡¹å¡2&lt;/label&gt;</span><br><span class="line">			&lt;label for=&quot;tab3&quot;&gt;é€‰é¡¹å¡3&lt;/label&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">		&lt;div class=&quot;box&quot;&gt;</span><br><span class="line">			&lt;div class=&quot;item&quot;&gt;</span><br><span class="line">				&lt;input type=&quot;text&quot; id=&quot;tab1&quot;&gt;</span><br><span class="line">				&lt;p&gt;é€‰é¡¹å¡1å†…å®¹&lt;/p&gt;</span><br><span class="line">			&lt;/div&gt;</span><br><span class="line">			&lt;div class=&quot;item&quot;&gt;</span><br><span class="line">				&lt;input type=&quot;text&quot; id=&quot;tab2&quot;&gt;</span><br><span class="line">				&lt;p&gt;é€‰é¡¹å¡2å†…å®¹&lt;/p&gt;</span><br><span class="line">			&lt;/div&gt;</span><br><span class="line">			&lt;div class=&quot;item&quot;&gt;</span><br><span class="line">				&lt;input type=&quot;text&quot; id=&quot;tab3&quot;&gt;</span><br><span class="line">				&lt;p&gt;é€‰é¡¹å¡3å†…å®¹&lt;/p&gt;</span><br><span class="line">			&lt;/div&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">	&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p><img src="/2018/11/16/å®ç°ä¸€ä¸ªå›åˆ°é¡¶éƒ¨/1.gif" alt="css-tab"></p>
<p>å†æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªcsså±æ€§<a href="https://www.caniuse.com/#search=scroll-behavior" target="_blank" rel="noopener">scroll-behavior</a>åœ¨å„å¤§æµè§ˆå™¨ä¸­çš„æ”¯æŒæƒ…å†µ</p>
<p><img src="/2018/11/16/å®ç°ä¸€ä¸ªå›åˆ°é¡¶éƒ¨/2.png" alt="scroll-behavior-compatibility"></p>
<p>å‘ƒ~æ”¯æŒåº¦ä¸æ˜¯å¾ˆå¥½ï¼Œè¿™æ ·ä¸€è¡Œcssä»£ç èƒ½åº”ç”¨ä¸Šå½“ç„¶æ˜¯æœ€å¥½çš„ï¼Œä¸è¡Œå°±é€€åŒ–æˆä¸€é—ªè€Œè¿‡çš„æ•ˆæœå’¯ã€‚ä¸‹é¢å†çœ‹ä¸‹jsæä¾›çš„apiã€‚</p>
<h1 id="Element-scrollIntoView"><a href="#Element-scrollIntoView" class="headerlink" title="Element.scrollIntoView()"></a>Element.scrollIntoView()</h1><p><code>Element.scrollIntoView()</code> æ–¹æ³•è®©å½“å‰çš„å…ƒç´ æ»šåŠ¨åˆ°æµè§ˆå™¨çª—å£çš„å¯è§†åŒºåŸŸå†…ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">element.scrollIntoView();    // ç­‰åŒäºelement.scrollIntoView(true)</span><br><span class="line">element.scrollIntoView(alignToTop);      // Booleanå‹å‚æ•°</span><br><span class="line">element.scrollIntoView(scrollIntoViewOptions);     // Objectå‹å‚æ•°</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>ä¸€ä¸ªå¾ˆå®ç”¨çš„ç”¨æ³•ã€è§£å†³é”®ç›˜å¼¹å‡ºåæŒ¡è¡¨å•çš„é—®é¢˜ã€‘</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// è§£å†³é”®ç›˜å¼¹å‡ºåæŒ¡è¡¨å•çš„é—®é¢˜</span><br><span class="line">    window.addEventListener(&apos;resize&apos;, function() &#123;</span><br><span class="line">      if(</span><br><span class="line">        document.activeElement.tagName === &apos;INPUT&apos; ||</span><br><span class="line">        document.activeElement.tagName === &apos;TEXTAREA&apos;</span><br><span class="line">      ) &#123;</span><br><span class="line">        window.setTimeout(function() &#123;</span><br><span class="line">          if(&apos;scrollIntoView&apos; in document.activeElement) &#123;</span><br><span class="line">            document.activeElement.scrollIntoView();</span><br><span class="line">          &#125; else &#123;</span><br><span class="line">            document.activeElement.scrollIntoViewIfNeeded();</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;, 0);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<h2 id="å‚æ•°alignToTop"><a href="#å‚æ•°alignToTop" class="headerlink" title="å‚æ•°alignToTop"></a>å‚æ•°alignToTop</h2><p>ä¸€ä¸ª<code>Boolean</code>å€¼ï¼š</p>
<ul>
<li>å¦‚æœä¸º<code>true</code>ï¼Œå…ƒç´ çš„é¡¶ç«¯å°†å’Œå…¶æ‰€åœ¨æ»šåŠ¨åŒºçš„å¯è§†åŒºåŸŸçš„é¡¶ç«¯å¯¹é½ã€‚ç›¸åº”çš„<code>scrollIntoViewOptions: {block: &quot;start&quot;, inline: &quot;nearest&quot;}</code>ã€‚è¿™æ˜¯è¿™ä¸ªå‚æ•°çš„é»˜è®¤å€¼ã€‚</li>
<li>å¦‚æœä¸º<code>false</code>ï¼Œå…ƒç´ çš„åº•ç«¯å°†å’Œå…¶æ‰€åœ¨æ»šåŠ¨åŒºçš„å¯è§†åŒºåŸŸçš„åº•ç«¯å¯¹é½ã€‚ç›¸åº”çš„<code>scrollIntoViewOptions: {block: &quot;end&quot;, inline: &quot;nearest&quot;}</code>ã€‚</li>
</ul>
<h2 id="å‚æ•°scrollIntoViewOptions"><a href="#å‚æ•°scrollIntoViewOptions" class="headerlink" title="å‚æ•°scrollIntoViewOptions"></a>å‚æ•°scrollIntoViewOptions</h2><p>ä¸€ä¸ªå¸¦æœ‰é€‰é¡¹çš„ <code>object</code>ï¼š</p>
<pre><code>{
  behavior: &quot;auto&quot;  | &quot;instant&quot; | &quot;smooth&quot;,
  block:    &quot;start&quot; | &quot;end&quot;,
}
</code></pre><ul>
<li><code>behavior</code> å¯é€‰<br>å®šä¹‰ç¼“åŠ¨åŠ¨ç”»ï¼Œ â€œautoâ€, â€œinstantâ€, æˆ– â€œsmoothâ€ ä¹‹ä¸€ã€‚é»˜è®¤ä¸º â€œautoâ€ã€‚</li>
<li><code>block</code> å¯é€‰<br><code>&quot;start&quot;</code>, <code>&quot;center&quot;</code>, <code>&quot;end&quot;</code>, æˆ– <code>&quot;nearest&quot;</code>ä¹‹ä¸€ã€‚é»˜è®¤ä¸º <code>&quot;center&quot;</code>ã€‚</li>
<li><code>inline</code> å¯é€‰<br><code>&quot;start&quot;</code>, <code>&quot;center&quot;</code>, <code>&quot;end&quot;</code>, æˆ– <code>&quot;nearest&quot;</code>ä¹‹ä¸€ã€‚é»˜è®¤ä¸º <code>&quot;nearest&quot;</code>ã€‚</li>
</ul>
<p>æµè§ˆå™¨æ”¯æŒ</p>
<p><img src="/2018/11/16/å®ç°ä¸€ä¸ªå›åˆ°é¡¶éƒ¨/3.png" alt=""></p>
<p>å¯ä»¥çœ‹åˆ°å¯¹äºæ— å‚æ•°çš„æƒ…å†µæ”¯æŒè¿˜æ˜¯å¾ˆå¥½çš„ï¼Œæœ‰å‚æ•°çš„è¯¥APIåœ¨æµè§ˆå™¨ä¸­æ”¯æŒä¸æ˜¯å¾ˆå¥½ï¼Œæˆ‘ä»¬å¯ä»¥åŒæ—¶ç»“åˆCSSè®¾ç½®<code>scroll-behavior: smooth;</code>æ»šåŠ¨æ•ˆæœï¼Œåœ¨æ‰§è¡Œæ»šåŠ¨ä½¿ç”¨<code>target.scrollIntoView()</code>ï¼Œå³å¯è¾¾åˆ°â€œå®Œç¾æ»šåŠ¨â€ï¼ˆä¸å¤ªå®Œç¾ï¼‰æ•ˆæœã€‚</p>
<h1 id="å‘ä¸‹å…¼å®¹"><a href="#å‘ä¸‹å…¼å®¹" class="headerlink" title="å‘ä¸‹å…¼å®¹"></a>å‘ä¸‹å…¼å®¹</h1><p>è¦è¾¾åˆ°æ‰€æœ‰æµè§ˆå™¨éƒ½æœ‰ç›¸åŒï¼ˆç±»ä¼¼ï¼‰æ•ˆæœï¼Œé‚£å°±è¦æŠŠå‰©ä½™ä¸æ”¯æŒ<code>scroll-behavior</code>å±æ€§çš„æµè§ˆå™¨æªå‡ºæ¥ï¼Œç”¨jså»å®Œæˆä½¿å‘½äº†ã€‚</p>
<h2 id="åˆ¤æ–­æ˜¯å¦æ”¯æŒscroll-behaviorå±æ€§"><a href="#åˆ¤æ–­æ˜¯å¦æ”¯æŒscroll-behaviorå±æ€§" class="headerlink" title="åˆ¤æ–­æ˜¯å¦æ”¯æŒscroll-behaviorå±æ€§"></a>åˆ¤æ–­æ˜¯å¦æ”¯æŒ<code>scroll-behavior</code>å±æ€§</h2><p>å¾ˆç®€å•ï¼Œç”¨ä»¥ä¸‹è¿™ä¸€è¡Œä»£ç <br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">if(typeofwindow.getComputedStyle(document.body).scrollBehavior === &apos;undefined&apos;) &#123;</span><br><span class="line">  // å…¼å®¹jsä»£ç </span><br><span class="line">&#125; else &#123;</span><br><span class="line">  // åŸç”Ÿæ»šåŠ¨api</span><br><span class="line">  // Element.scrollIntoView()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>åˆ¤æ–­æ˜¯å¦æ”¯æŒ<code>scroll-behavior</code>å±æ€§ï¼Œç›´æ¥åˆ©ç”¨åŸç”Ÿ<code>Element.scrollIntoView()</code>æ»šåŠ¨ï¼Œå¦åˆ™å‘ä¸‹å…¼å®¹å¤„ç†ã€‚</p>
<h2 id="ç¼“å†²ç®—æ³•"><a href="#ç¼“å†²ç®—æ³•" class="headerlink" title="ç¼“å†²ç®—æ³•"></a>ç¼“å†²ç®—æ³•</h2><p>ç¼“å†²çš„ç›´è§‚æ•ˆæœæ˜¯è¶Šæ¥è¶Šæ…¢ï¼Œç›´åˆ°åœæ­¢ï¼Œä¹Ÿå°±æ˜¯åœ¨ç›¸åŒæ—¶é—´å†…è¿åŠ¨çš„è·ç¦»è¶Šæ¥è¶ŠçŸ­ã€‚è¿™æ ·å¯ä»¥è®¾ç½®ä¸€ä¸ªå®šæ—¶å™¨ï¼Œç§»åŠ¨åˆ°å½“å‰ç‚¹åˆ°ç›®æ ‡ç‚¹è·ç¦»çš„ç¼“å†²ç‡ï¼ˆæ¯”å¦‚1/2ï¼Œ1/3ï¼Œâ€¦ï¼‰å¤„ï¼Œæ¯”å¦‚ï¼Œç¼“å†²ç‡è®¾ä¸º2ï¼Œå½“å‰è·ç¦»ç›®æ ‡ç‚¹64pxï¼Œä¸‹ä¸€ç§’å°±æ˜¯32pxï¼Œç„¶å16pxï¼Œ8pxâ€¦ï¼Œåˆ°è¾¾æŸä¸ªé˜ˆå€¼ç»“æŸï¼Œä¹Ÿå°±æ˜¯ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var position = position + (destination - position) / n;</span><br></pre></td></tr></table></figure></p>
<p>ä¸‹é¢æ¥ç®€å•å®ç°ä¸€ä¸ªç‚¹å‡»å³ä¸‹æ–¹çš„â€å›åˆ°é¡¶éƒ¨â€œæŒ‰é’®ï¼Œé¡µé¢ç¼“åŠ¨æ»šåŠ¨åˆ°é¡¶éƒ¨çš„demoã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line"></span><br><span class="line">	&lt;head&gt;</span><br><span class="line">		&lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">		&lt;title&gt;&lt;/title&gt;</span><br><span class="line">		&lt;style type=&quot;text/css&quot;&gt;</span><br><span class="line">			.content &#123;</span><br><span class="line">				height: 3000px;</span><br><span class="line">				border: 1px solid #ccc;</span><br><span class="line">				box-shadow: 0 0 2px solid;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			.back-to-top &#123;</span><br><span class="line">				width: 18px;</span><br><span class="line">				padding: 10px;</span><br><span class="line">				border: 1px solid #ccc;</span><br><span class="line">				box-shadow: 0 0 2px #333;</span><br><span class="line">				position: fixed;</span><br><span class="line">				right: 20px;</span><br><span class="line">				bottom: 40px;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			.back-to-top:hover &#123;</span><br><span class="line">				cursor: pointer;</span><br><span class="line">			&#125;</span><br><span class="line">		&lt;/style&gt;</span><br><span class="line">	&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">	&lt;body&gt;</span><br><span class="line"></span><br><span class="line">		&lt;div class=&quot;content&quot;&gt;</span><br><span class="line">			&lt;p&gt;å¾ˆå¤šå†…å®¹ã€‚ã€‚ã€‚&lt;/p&gt;</span><br><span class="line">			...</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">		&lt;section class=&quot;back-to-top&quot;&gt;</span><br><span class="line">			å›åˆ°é¡¶éƒ¨</span><br><span class="line">		&lt;/section&gt;</span><br><span class="line"></span><br><span class="line">		&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">			var scrollTopSmooth = function(position) &#123;</span><br><span class="line">				// ä¸å­˜åœ¨åŸç”Ÿ`requestAnimationFrame`ï¼Œç”¨`setTimeout`æ¨¡æ‹Ÿæ›¿ä»£</span><br><span class="line">				if(!window.requestAnimationFrame) &#123;</span><br><span class="line">					window.requestAnimationFrame = function(cb) &#123;</span><br><span class="line">						return setTimeout(cb, 17);</span><br><span class="line">					&#125;;</span><br><span class="line">				&#125;</span><br><span class="line">				// å½“å‰æ»šåŠ¨é«˜åº¦</span><br><span class="line">				var scrollTop = document.documentElement.scrollTop || document.body.scrollTop;</span><br><span class="line">				// step</span><br><span class="line">				var step = function() &#123;</span><br><span class="line">					var distance = position - scrollTop;</span><br><span class="line">					scrollTop = scrollTop + distance / 5;</span><br><span class="line">					if(Math.abs(distance) &lt; 1) &#123;</span><br><span class="line">						window.scrollTo(0, position);</span><br><span class="line">					&#125; else &#123;</span><br><span class="line">						window.scrollTo(0, scrollTop);</span><br><span class="line">						requestAnimationFrame(step);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;;</span><br><span class="line">				step();</span><br><span class="line">			&#125;</span><br><span class="line">			$backToTop = document.querySelector(&apos;.back-to-top&apos;)</span><br><span class="line">			$backToTop.addEventListener(&apos;click&apos;, function() &#123;</span><br><span class="line">				scrollTopSmooth(0);</span><br><span class="line">			&#125;, false);</span><br><span class="line">		&lt;/script&gt;</span><br><span class="line">		&lt;/script&gt;</span><br><span class="line">	&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>
<p><img src="/2018/11/16/å®ç°ä¸€ä¸ªå›åˆ°é¡¶éƒ¨/4.gif" alt=""></p>
<h2 id="ç®€å•å°è£…"><a href="#ç®€å•å°è£…" class="headerlink" title="ç®€å•å°è£…"></a>ç®€å•å°è£…</h2><p>ä¸Šé¢çš„å°demoä¸­ï¼Œç¼“å†²ç®—æ³•å’Œå½“å‰æ»šåŠ¨ä¸šåŠ¡ä»£ç è€¦åˆåœ¨ä¸€èµ·äº†ï¼Œä¸‹é¢å•ç‹¬æ‹†è§£å‡ºå•ç‹¬ä¸€ä¸ªå‡½æ•°ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"> /**</span><br><span class="line"> * ç¼“å†²å‡½æ•°</span><br><span class="line"> * @param &#123;Number&#125; position å½“å‰æ»šåŠ¨ä½ç½®</span><br><span class="line"> * @param &#123;Number&#125; destination ç›®æ ‡ä½ç½®</span><br><span class="line"> * @param &#123;Number&#125; rate ç¼“åŠ¨ç‡</span><br><span class="line"> * @param &#123;Function&#125; callback ç¼“åŠ¨ç»“æŸå›è°ƒå‡½æ•° ä¸¤ä¸ªå‚æ•°åˆ†åˆ«æ˜¯å½“å‰ä½ç½®å’Œæ˜¯å¦ç»“æŸ</span><br><span class="line"> */</span><br><span class="line">var easeout = function (position, destination, rate, callback) &#123;</span><br><span class="line">   if (position === destination || typeof destination !== &apos;number&apos;) &#123;</span><br><span class="line">     returnfalse;</span><br><span class="line">   &#125;</span><br><span class="line">   destination = destination || 0;</span><br><span class="line">   rate = rate || 2;</span><br><span class="line"> </span><br><span class="line">   // ä¸å­˜åœ¨åŸç”Ÿ`requestAnimationFrame`ï¼Œç”¨`setTimeout`æ¨¡æ‹Ÿæ›¿ä»£</span><br><span class="line">   if (!window.requestAnimationFrame) &#123;</span><br><span class="line">     window.requestAnimationFrame = function (fn) &#123;</span><br><span class="line">       return setTimeout(fn, 17);</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   var step = function () &#123;</span><br><span class="line">     position = position + (destination - position) / rate;</span><br><span class="line">     if (Math.abs(destination - position) &lt; 1) &#123;</span><br><span class="line">       callback(destination, true);</span><br><span class="line">       return;</span><br><span class="line">     &#125;</span><br><span class="line">     callback(position, false);</span><br><span class="line">     requestAnimationFrame(step);</span><br><span class="line">   &#125;;</span><br><span class="line">   step();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p>
<p>æ‹†åˆ†åï¼Œè¿™ä¸ªå°ç¼“å†²ç®—æ³•å°±å¯ä»¥è¢«é‡å¤è°ƒç”¨å•¦ï¼Œè€Œä¸”ï¼Œé€‚ç”¨äºæ»šåŠ¨åˆ°æŒ‡å®šä½ç½®ï¼ˆä¸ä»…ä»…æ˜¯åˆ°é¡¶éƒ¨ï¼‰å’Œç¼“å†²ç‡ï¼ˆæ§åˆ¶æ»šåŠ¨å¿«æ…¢ï¼‰ï¼Œå½“å‰å°demoè°ƒç”¨ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">var scrollTopSmooth = function (position) &#123;</span><br><span class="line">  // å½“å‰æ»šåŠ¨é«˜åº¦</span><br><span class="line">  var scrollTop = document.documentElement.scrollTop || document.body.scrollTop;</span><br><span class="line">  easeout(scrollTop, position, 5, function (val) &#123;</span><br><span class="line">    window.scrollTo(0, val);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$backToTop = document.querySelector(&apos;.back-to-top&apos;)</span><br><span class="line">$backToTop.addEventListener(&apos;click&apos;, function () &#123;</span><br><span class="line">  scrollTopSmooth(200);</span><br><span class="line">&#125;, false);</span><br></pre></td></tr></table></figure></p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ç»¼åˆæ¥çœ‹ï¼Œç®€å•å®ç°ä¸€ä¸ªå®Œç¾æ»šåŠ¨æ³¨æ„ä»¥ä¸‹å³å¯</p>
<ol>
<li><code>&lt;html&gt;</code>ï¼Œ<code>&lt;body&gt;</code>æ ‡ç­¾åŠ ä¸Š<code>scroll-behavior: smooth;</code>å±æ€§ï¼›</li>
<li>åˆ¤æ–­å½“å‰æµè§ˆå™¨æ˜¯å¦æ”¯æŒ<code>scrollBehavior</code>å±æ€§ï¼›</li>
<li>å¦‚æœæ”¯æŒç›´æ¥ç”¨åŸç”Ÿæ»šåŠ¨api<code>Element.scrollIntoView()</code>ï¼›</li>
<li>å¦‚æœä¸æ”¯æŒåˆ™ç”¨jså°ç¼“å†²ç®—æ³•å…¼å®¹å¤„ç†ã€‚</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">/* æ»šåŠ¨æ¡åŠ¨ç”»ï¼š</span><br><span class="line"> * ç§»åŠ¨ç«¯:document.body.scrollTop</span><br><span class="line">   PCç«¯ï¼šdocument.documentElement.scrollTop</span><br><span class="line">   </span><br><span class="line">   //ä½¿ç”¨:gotoTop(400,callBack)</span><br><span class="line">   gotoTop(durations,  callback = undefined) &#123;</span><br><span class="line">      const doc = document.documentElement</span><br><span class="line">      const scrollTop = (window.pageYOffset || doc.scrollTop) - (doc.clientTop || 0)</span><br><span class="line">      for (var i = 60; i &gt;= 0; i--) &#123;</span><br><span class="line">        setTimeout((i =&gt; &#123;</span><br><span class="line">          return () =&gt; &#123;</span><br><span class="line">            doc.scrollTop = scrollTop * i / 60</span><br><span class="line">            if (i === 0 &amp;&amp; typeof callback === &apos;function&apos;) &#123;</span><br><span class="line">              callback()</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)(i), durations * (1 - i / 60))</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"> * */</span><br><span class="line"></span><br><span class="line">------------------------------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">var requestAnimFrame = (function() &#123;</span><br><span class="line">	return window.requestAnimationFrame ||</span><br><span class="line">		window.webkitRequestAnimationFrame ||</span><br><span class="line">		window.mozRequestAnimationFrame ||</span><br><span class="line">		function(callback) &#123;</span><br><span class="line">			window.setTimeout(callback, 1000 / 60);</span><br><span class="line">		&#125;;</span><br><span class="line">&#125;)();</span><br><span class="line">var cancelAnimationFrame = (function() &#123;</span><br><span class="line">	return window.cancelAnimationFrame ||</span><br><span class="line">		window.webkitCancelAnimationFrame ||</span><br><span class="line">		window.mozCancelAnimationFrame ||</span><br><span class="line">		window.oCancelAnimationFrame ||</span><br><span class="line">		function(id) &#123;</span><br><span class="line">			window.clearTimeout(id)</span><br><span class="line">		&#125;</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line">// Tweenä¸­çš„æ–¹æ³•æ¥å—4ä¸ªå‚æ•°t,b,c,d ã€‚tä¸ºåˆå§‹æ—¶é—´ bã€cã€dä¸‰ä¸ªå‚æ•°ï¼ˆå³åˆå§‹å€¼ï¼Œå˜åŒ–é‡ï¼ŒæŒç»­æ—¶é—´ï¼‰ã€‚è¿”å›å€¼ä¸ºå½“å‰ä½ç½®</span><br><span class="line">// t =&gt; time(åˆå§‹è®°æ­¥æ¬¡æ•°)  b =&gt; begin(åˆå§‹ä½ç½®)   c =&gt; change(å˜åŒ–é‡)   d =&gt; duration(æŒç»­æ¬¡æ•°)</span><br><span class="line"></span><br><span class="line">var tween = &#123;</span><br><span class="line">	linear: function(t, b, c, d) &#123;</span><br><span class="line">		return c * t / d + b;</span><br><span class="line">	&#125;,</span><br><span class="line">	easeIn: function(t, b, c, d) &#123;</span><br><span class="line">		return c * (t /= d) * t + b;</span><br><span class="line">	&#125;,</span><br><span class="line">	strongEaseIn: function(t, b, c, d) &#123;</span><br><span class="line">		return c * (t /= d) * t * t * t * t + b;</span><br><span class="line">	&#125;,</span><br><span class="line">	strongEaseOut: function(t, b, c, d) &#123;</span><br><span class="line">		return c * ((t = t / d - 1) * t * t * t * t + 1) + b;</span><br><span class="line">	&#125;,</span><br><span class="line">	sineaseIn: function(t, b, c, d) &#123;</span><br><span class="line">		return c * (t /= d) * t * t + b;</span><br><span class="line">	&#125;,</span><br><span class="line">	sineaseOut: function(t, b, c, d) &#123;</span><br><span class="line">		return c * ((t = t / d - 1) * t * t + 1) + b;</span><br><span class="line">	&#125;,</span><br><span class="line">	easeInOutQuad: function(t, b, c, d) &#123;</span><br><span class="line">		t /= d / 2;</span><br><span class="line">		if(t &lt; 1) return c / 2 * t * t + b;</span><br><span class="line">		t--;</span><br><span class="line">		return -c / 2 * (t * (t - 2) - 1) + b;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line">var myReq; </span><br><span class="line">//å›åˆ°é¡¶éƒ¨å…ƒç´ å…ƒç´ ï¼Œç»“æŸä½ç½®ï¼Œè€—æ—¶ï¼Œå›è°ƒï¼Œæ»šåŠ¨å‡½æ•°</span><br><span class="line">export var animatedScrollTo = function(element, to, duration, callback, Bzr = &apos;linear&apos;) &#123;</span><br><span class="line">	var start = element.scrollTop,</span><br><span class="line">		change = to - start,</span><br><span class="line">		animationStart = +new Date();</span><br><span class="line">	var animating = true;</span><br><span class="line">	var lastpos = null;</span><br><span class="line"></span><br><span class="line">	var animateScroll = function() &#123;</span><br><span class="line">		if(!animating) &#123;</span><br><span class="line">			return;</span><br><span class="line">		&#125;</span><br><span class="line">		myReq=requestAnimFrame(animateScroll);</span><br><span class="line">		var now = +new Date();</span><br><span class="line">		var val = Math.floor(tween[Bzr](now - animationStart, start, change, duration));</span><br><span class="line"></span><br><span class="line">		if(lastpos) &#123;</span><br><span class="line">			if(lastpos === element.scrollTop) &#123;</span><br><span class="line">				lastpos = val;</span><br><span class="line">				element.scrollTop = val;</span><br><span class="line">			&#125; else &#123;</span><br><span class="line">				animating = false;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			lastpos = val;</span><br><span class="line">			element.scrollTop = val;</span><br><span class="line">		&#125;</span><br><span class="line">		if(now &gt; animationStart + duration) &#123;</span><br><span class="line">			element.scrollTop = to;</span><br><span class="line">			animating = false;</span><br><span class="line">			cancelAnimationFrame(myReq);   //æ¸…é™¤å®šæ—¶å™¨åŠ¨ç”»</span><br><span class="line">			callback&amp;&amp;callback();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;;</span><br><span class="line">	myReq=requestAnimFrame(animateScroll);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/06/React-Hooks/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/06/React-Hooks/" itemprop="url">React Hooks</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-11-06T10:01:03+08:00">
                2018-11-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ä¸€å¥è¯æ€»ç»“ React Hooks å°±æ˜¯åœ¨ react å‡½æ•°ç»„ä»¶ä¸­ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç±»ç»„ä»¶ï¼ˆclasses componentsï¼‰çš„ state å’Œ ç»„ä»¶ç”Ÿå‘½å‘¨æœŸï¼Œè€Œä¸éœ€è¦åœ¨ mixinã€ å‡½æ•°ç»„ä»¶ã€HOCç»„ä»¶å’Œ render props ä¹‹é—´æ¥å›åˆ‡æ¢ï¼Œä½¿å¾—å‡½æ•°ç»„ä»¶çš„åŠŸèƒ½æ›´åŠ å®åœ¨ï¼Œæ›´åŠ æ–¹ä¾¿æˆ‘ä»¬åœ¨ä¸šåŠ¡ä¸­å®ç°ä¸šåŠ¡é€»è¾‘ä»£ç çš„åˆ†ç¦»å’Œç»„ä»¶çš„å¤ç”¨ã€‚</p>
<p>React ä¸€ç›´åœ¨è§£å†³ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä½•å®ç°åˆ†ç¦»ä¸šåŠ¡é€»è¾‘ä»£ç ï¼Œå®ç°ç»„ä»¶å†…éƒ¨ç›¸å…³ä¸šåŠ¡é€»è¾‘çš„å¤ç”¨ã€‚<br>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½æ˜¯é€šè¿‡ç»„ä»¶å’Œè‡ªä¸Šè€Œä¸‹ä¼ é€’çš„æ•°æ®æµå°†æˆ‘ä»¬é¡µé¢ä¸Šçš„å¤§å‹UIç»„ç»‡æˆä¸ºç‹¬ç«‹çš„å°å‹UIï¼Œå®ç°ç»„ä»¶çš„é‡ç”¨ã€‚ä½†æ˜¯æˆ‘ä»¬ç»å¸¸é‡åˆ°å¾ˆéš¾ä¾µå…¥ä¸€ä¸ªå¤æ‚çš„ç»„ä»¶ä¸­å®ç°é‡ç”¨ï¼Œå› ä¸ºç»„ä»¶çš„é€»è¾‘æ˜¯æœ‰çŠ¶æ€çš„ï¼Œæ— æ³•æå–åˆ°å‡½æ•°ç»„ä»¶å½“ä¸­ã€‚è¿™åœ¨å¤„ç†åŠ¨ç”»å’Œè¡¨å•çš„æ—¶å€™ï¼Œå°¤å…¶å¸¸è§ï¼Œå½“æˆ‘ä»¬åœ¨ç»„ä»¶ä¸­è¿æ¥å¤–éƒ¨çš„æ•°æ®æºï¼Œç„¶åå¸Œæœ›åœ¨ç»„ä»¶ä¸­æ‰§è¡Œæ›´å¤šå…¶ä»–çš„æ“ä½œçš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±ä¼šæŠŠç»„ä»¶æå¾—ç‰¹åˆ«ç³Ÿç³•ï¼š</p>
<ul>
<li>éš¾ä»¥é‡ç”¨å’Œå…±äº«ç»„ä»¶ä¸­çš„ä¸çŠ¶æ€ç›¸å…³çš„é€»è¾‘ï¼Œé€ æˆäº§ç”Ÿå¾ˆå¤šå·¨å¤§çš„ç»„ä»¶</li>
<li>é€»è¾‘å¤æ‚çš„ç»„ä»¶éš¾ä»¥å¼€å‘ä¸ç»´æŠ¤ï¼Œå½“æˆ‘ä»¬çš„ç»„ä»¶éœ€è¦å¤„ç†å¤šä¸ªäº’ä¸ç›¸å…³çš„ localstate æ—¶ï¼Œæ¯ä¸ªç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¸­å¯èƒ½ä¼šåŒ…å«ç€å„ç§äº’ä¸ç›¸å…³çš„é€»è¾‘åœ¨é‡Œé¢ã€‚</li>
<li>å¤æ‚çš„æ¨¡å¼ï¼Œå¦‚æ¸²æŸ“é“å…·å’Œé«˜é˜¶ç»„ä»¶ã€‚</li>
<li>ç”±äºä¸šåŠ¡å˜åŠ¨ï¼Œå‡½æ•°ç»„ä»¶ä¸å¾—ä¸æ”¹ä¸ºç±»ç»„ä»¶ã€‚</li>
</ul>
<p>è¿™æ—¶å€™ï¼ŒHookså°±æ´¾ä¸Šç”¨åœºäº†ã€‚ Hooks å…è®¸æˆ‘ä»¬å°†ç»„ä»¶å†…éƒ¨çš„é€»è¾‘ï¼Œç»„ç»‡æˆä¸ºä¸€ä¸ªå¯å¤ç”¨çš„éš”ç¦»æ¨¡å—ã€‚</p>
<h4 id="ç²—æš´ç‚¹æ€»ç»“React-Hooks-å°±æ˜¯åœ¨å‡½æ•°ç»„ä»¶-HOCç»„ä»¶å’Œé™æ€ç»„ä»¶æ‰¾åˆ°ä¸€ç§å¹³è¡¡çš„ç»„ä»¶å®ç°æ–¹å¼"><a href="#ç²—æš´ç‚¹æ€»ç»“React-Hooks-å°±æ˜¯åœ¨å‡½æ•°ç»„ä»¶-HOCç»„ä»¶å’Œé™æ€ç»„ä»¶æ‰¾åˆ°ä¸€ç§å¹³è¡¡çš„ç»„ä»¶å®ç°æ–¹å¼" class="headerlink" title=" ç²—æš´ç‚¹æ€»ç»“React Hooks:å°±æ˜¯åœ¨å‡½æ•°ç»„ä»¶,HOCç»„ä»¶å’Œé™æ€ç»„ä»¶æ‰¾åˆ°ä¸€ç§å¹³è¡¡çš„ç»„ä»¶å®ç°æ–¹å¼ "></a><font color="#ff0000"><strong> ç²—æš´ç‚¹æ€»ç»“React Hooks:å°±æ˜¯åœ¨å‡½æ•°ç»„ä»¶,HOCç»„ä»¶å’Œé™æ€ç»„ä»¶æ‰¾åˆ°ä¸€ç§å¹³è¡¡çš„ç»„ä»¶å®ç°æ–¹å¼ </strong></font></h4><h2 id="ä¸€ä¸ªæœ€ç®€å•çš„Hooks"><a href="#ä¸€ä¸ªæœ€ç®€å•çš„Hooks" class="headerlink" title="ä¸€ä¸ªæœ€ç®€å•çš„Hooks"></a>ä¸€ä¸ªæœ€ç®€å•çš„Hooks</h2><p>é¦–å…ˆè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ä¸€ä¸ªç®€å•çš„æœ‰çŠ¶æ€ç»„ä»¶ï¼š</p>
<pre><code>class Example extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      count: 0
    };
  }

  render() {
    return (
      &lt;div&gt;
        &lt;p&gt;You clicked {this.state.count} times&lt;/p&gt;
        &lt;button onClick={() =&gt; this.setState({ count: this.state.count + 1 })}&gt;
          Click me
        &lt;/button&gt;
      &lt;/div&gt;
    );
  }
}
</code></pre><p>æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹ä½¿ç”¨hooksåçš„ç‰ˆæœ¬ï¼š</p>
<pre><code>import { useState } from &apos;react&apos;;

function Example() {
  const [count, setCount] = useState(0);

  return (
    &lt;div&gt;
      &lt;p&gt;You clicked {count} times&lt;/p&gt;
      &lt;button onClick={() =&gt; setCount(count + 1)}&gt;
        Click me
      &lt;/button&gt;
    &lt;/div&gt;
  );
}
</code></pre><p>æ˜¯ä¸æ˜¯ç®€å•å¤šäº†ï¼å¯ä»¥çœ‹åˆ°ï¼Œ<code>Example</code>å˜æˆäº†ä¸€ä¸ªå‡½æ•°ï¼Œä½†è¿™ä¸ªå‡½æ•°å´æœ‰è‡ªå·±çš„çŠ¶æ€ï¼ˆcountï¼‰ï¼ŒåŒæ—¶å®ƒè¿˜å¯ä»¥æ›´æ–°è‡ªå·±çš„çŠ¶æ€ï¼ˆsetCountï¼‰ã€‚è¿™ä¸ªå‡½æ•°ä¹‹æ‰€ä»¥è¿™ä¹ˆäº†ä¸å¾—ï¼Œå°±æ˜¯å› ä¸ºå®ƒæ³¨å…¥äº†ä¸€ä¸ªhookâ€“<code>useState</code>ï¼Œå°±æ˜¯è¿™ä¸ªhookè®©æˆ‘ä»¬çš„å‡½æ•°å˜æˆäº†ä¸€ä¸ªæœ‰çŠ¶æ€çš„å‡½æ•°ã€‚</p>
<p>é™¤äº†<code>useState</code>è¿™ä¸ªhookå¤–ï¼Œè¿˜æœ‰å¾ˆå¤šåˆ«çš„hookï¼Œæ¯”å¦‚<code>useEffect</code>æä¾›äº†ç±»ä¼¼äº<code>componentDidMount</code>ç­‰ç”Ÿå‘½å‘¨æœŸé’©å­çš„åŠŸèƒ½ï¼Œ<code>useContext</code>æä¾›äº†ä¸Šä¸‹æ–‡ï¼ˆcontextï¼‰çš„åŠŸèƒ½ç­‰ç­‰ã€‚</p>
<p>Hooksæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ç±»ç‰¹æ®Šçš„å‡½æ•°ï¼Œå®ƒä»¬å¯ä»¥ä¸ºä½ çš„å‡½æ•°å‹ç»„ä»¶ï¼ˆfunction componentï¼‰æ³¨å…¥ä¸€äº›ç‰¹æ®Šçš„åŠŸèƒ½ã€‚å’¦ï¼Ÿè¿™å¬èµ·æ¥æœ‰ç‚¹åƒè¢«è¯Ÿç—…çš„Mixinså•Šï¼Ÿéš¾é“æ˜¯Mixinsè¦åœ¨reactä¸­æ­»ç°å¤ç‡ƒäº†å—ï¼Ÿå½“ç„¶ä¸ä¼šäº†ï¼Œç­‰ä¼šæˆ‘ä»¬å†æ¥è°ˆä¸¤è€…çš„åŒºåˆ«ã€‚æ€»è€Œè¨€ä¹‹ï¼Œè¿™äº›hooksçš„ç›®æ ‡å°±æ˜¯è®©ä½ ä¸å†å†™classï¼Œè®©functionä¸€ç»Ÿæ±Ÿæ¹–ã€‚</p>
<h2 id="Reactä¸ºä»€ä¹ˆè¦æä¸€ä¸ªHooksï¼Ÿ"><a href="#Reactä¸ºä»€ä¹ˆè¦æä¸€ä¸ªHooksï¼Ÿ" class="headerlink" title="Reactä¸ºä»€ä¹ˆè¦æä¸€ä¸ªHooksï¼Ÿ"></a>Reactä¸ºä»€ä¹ˆè¦æä¸€ä¸ªHooksï¼Ÿ</h2><h3 id="æƒ³è¦å¤ç”¨ä¸€ä¸ªæœ‰çŠ¶æ€çš„ç»„ä»¶å¤ªéº»çƒ¦äº†ï¼"><a href="#æƒ³è¦å¤ç”¨ä¸€ä¸ªæœ‰çŠ¶æ€çš„ç»„ä»¶å¤ªéº»çƒ¦äº†ï¼" class="headerlink" title="æƒ³è¦å¤ç”¨ä¸€ä¸ªæœ‰çŠ¶æ€çš„ç»„ä»¶å¤ªéº»çƒ¦äº†ï¼"></a>æƒ³è¦å¤ç”¨ä¸€ä¸ªæœ‰çŠ¶æ€çš„ç»„ä»¶å¤ªéº»çƒ¦äº†ï¼</h3><p>æˆ‘ä»¬éƒ½çŸ¥é“reactéƒ½æ ¸å¿ƒæ€æƒ³å°±æ˜¯ï¼Œå°†ä¸€ä¸ªé¡µé¢æ‹†æˆä¸€å †ç‹¬ç«‹çš„ï¼Œå¯å¤ç”¨çš„ç»„ä»¶ï¼Œå¹¶ä¸”ç”¨è‡ªä¸Šè€Œä¸‹çš„å•å‘æ•°æ®æµçš„å½¢å¼å°†è¿™äº›ç»„ä»¶ä¸²è”èµ·æ¥ã€‚ä½†å‡å¦‚ä½ åœ¨å¤§å‹çš„å·¥ä½œé¡¹ç›®ä¸­ç”¨reactï¼Œä½ ä¼šå‘ç°ä½ çš„é¡¹ç›®ä¸­å®é™…ä¸Šå¾ˆå¤šreactç»„ä»¶å†—é•¿ä¸”éš¾ä»¥å¤ç”¨ã€‚å°¤å…¶æ˜¯é‚£äº›å†™æˆclassçš„ç»„ä»¶ï¼Œå®ƒä»¬æœ¬èº«åŒ…å«äº†çŠ¶æ€ï¼ˆstateï¼‰ï¼Œæ‰€ä»¥å¤ç”¨è¿™ç±»ç»„ä»¶å°±å˜å¾—å¾ˆéº»çƒ¦ã€‚</p>
<p>é‚£ä¹‹å‰ï¼Œå®˜æ–¹æ¨èæ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼š<font color="#ff0000">æ¸²æŸ“å±æ€§ï¼ˆRender Propsï¼‰</font>å’Œ <font color="#ff0000">é«˜é˜¶ç»„ä»¶ï¼ˆHigher-Order Componentsï¼‰</font> ã€‚æˆ‘ä»¬å¯ä»¥ç¨å¾®è·‘ä¸‹é¢˜ç®€å•çœ‹ä¸€ä¸‹è¿™ä¸¤ç§æ¨¡å¼ã€‚</p>
<p>æ¸²æŸ“å±æ€§æŒ‡çš„æ˜¯ä½¿ç”¨ä¸€ä¸ªå€¼ä¸ºå‡½æ•°çš„propæ¥ä¼ é€’éœ€è¦åŠ¨æ€æ¸²æŸ“çš„nodesæˆ–ç»„ä»¶ã€‚å¦‚ä¸‹é¢çš„ä»£ç å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„<code>DataProvider</code>ç»„ä»¶åŒ…å«äº†æ‰€æœ‰è·ŸçŠ¶æ€ç›¸å…³çš„ä»£ç ï¼Œè€Œ<code>Cat</code>ç»„ä»¶åˆ™å¯ä»¥æ˜¯ä¸€ä¸ªå•çº¯çš„å±•ç¤ºå‹ç»„ä»¶ï¼Œè¿™æ ·ä¸€æ¥<code>DataProvider</code>å°±å¯ä»¥å•ç‹¬å¤ç”¨äº†ã€‚</p>
<pre><code>import Cat from &apos;components/cat&apos;
class DataProvider extends React.Component {
  constructor(props) {
    super(props);
    this.state = { target: &apos;Zac&apos; };
  }

  render() {
    return (
      &lt;div&gt;
        {this.props.render(this.state)}
      &lt;/div&gt;
    )
  }
}

&lt;DataProvider render={data =&gt; (
  &lt;Cat target={data.target} /&gt;
)}/&gt;
</code></pre><p>è™½ç„¶è¿™ä¸ªæ¨¡å¼å«Render Propsï¼Œä½†ä¸æ˜¯è¯´éç”¨ä¸€ä¸ªå«renderçš„propsä¸å¯ï¼Œä¹ æƒ¯ä¸Šå¤§å®¶æ›´å¸¸å†™æˆä¸‹é¢è¿™ç§ï¼š</p>
<pre><code>...
&lt;DataProvider&gt;
  {data =&gt; (
    &lt;Cat target={data.target} /&gt;
  )}
&lt;/DataProvider&gt;
</code></pre><p>é«˜é˜¶ç»„ä»¶è¿™ä¸ªæ¦‚å¿µå°±æ›´å¥½ç†è§£äº†ï¼Œè¯´ç™½äº†å°±æ˜¯ä¸€ä¸ªå‡½æ•°æ¥å—ä¸€ä¸ªç»„ä»¶ä½œä¸ºå‚æ•°ï¼Œç»è¿‡ä¸€ç³»åˆ—åŠ å·¥åï¼Œæœ€åè¿”å›ä¸€ä¸ªæ–°çš„ç»„ä»¶ã€‚çœ‹ä¸‹é¢çš„ä»£ç ç¤ºä¾‹ï¼Œ<code>withUser</code>å‡½æ•°å°±æ˜¯ä¸€ä¸ªé«˜é˜¶ç»„ä»¶ï¼Œå®ƒè¿”å›äº†ä¸€ä¸ªæ–°çš„ç»„ä»¶ï¼Œè¿™ä¸ªç»„ä»¶å…·æœ‰äº†å®ƒæä¾›çš„è·å–ç”¨æˆ·ä¿¡æ¯çš„åŠŸèƒ½ã€‚</p>
<pre><code>const withUser = WrappedComponent =&gt; {
  const user = sessionStorage.getItem(&quot;user&quot;);
  return props =&gt; &lt;WrappedComponent user={user} {...props} /&gt;;
};

const UserPage = props =&gt; (
  &lt;div class=&quot;user-container&quot;&gt;
    &lt;p&gt;My name is {props.user}!&lt;/p&gt;
  &lt;/div&gt;
);

export default withUser(UserPage);
</code></pre><p>ä»¥ä¸Šè¿™ä¸¤ç§æ¨¡å¼çœ‹ä¸Šå»éƒ½æŒºä¸é”™çš„ï¼Œå¾ˆå¤šåº“ä¹Ÿè¿ç”¨äº†è¿™ç§æ¨¡å¼ï¼Œæ¯”å¦‚æˆ‘ä»¬å¸¸ç”¨çš„React Routerã€‚ä½†æˆ‘ä»¬ä»”ç»†çœ‹è¿™ä¸¤ç§æ¨¡å¼ï¼Œä¼šå‘ç°å®ƒä»¬ä¼šå¢åŠ æˆ‘ä»¬ä»£ç çš„å±‚çº§å…³ç³»ã€‚æœ€ç›´è§‚çš„ä½“ç°ï¼Œæ‰“å¼€devtoolçœ‹çœ‹ä½ çš„ç»„ä»¶å±‚çº§åµŒå¥—æ˜¯ä¸æ˜¯å¾ˆå¤¸å¼ å§ã€‚è¿™æ—¶å€™å†å›è¿‡å¤´çœ‹æˆ‘ä»¬ä¸Šä¸€èŠ‚ç»™å‡ºçš„hooksä¾‹å­ï¼Œæ˜¯ä¸æ˜¯ç®€æ´å¤šäº†ï¼Œæ²¡æœ‰å¤šä½™çš„å±‚çº§åµŒå¥—ã€‚æŠŠå„ç§æƒ³è¦çš„åŠŸèƒ½å†™æˆä¸€ä¸ªä¸€ä¸ªå¯å¤ç”¨çš„è‡ªå®šä¹‰hookï¼Œå½“ä½ çš„ç»„ä»¶æƒ³ç”¨ä»€ä¹ˆåŠŸèƒ½æ—¶ï¼Œç›´æ¥åœ¨ç»„ä»¶é‡Œè°ƒç”¨è¿™ä¸ªhookå³å¯ã€‚</p>
<h3 id="ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°é‡Œçš„é€»è¾‘å¤ªä¹±äº†å§ï¼"><a href="#ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°é‡Œçš„é€»è¾‘å¤ªä¹±äº†å§ï¼" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°é‡Œçš„é€»è¾‘å¤ªä¹±äº†å§ï¼"></a>ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°é‡Œçš„é€»è¾‘å¤ªä¹±äº†å§ï¼</h3><p>æˆ‘ä»¬é€šå¸¸å¸Œæœ›ä¸€ä¸ªå‡½æ•°åªåšä¸€ä»¶äº‹æƒ…ï¼Œä½†æˆ‘ä»¬çš„ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°é‡Œé€šå¸¸åŒæ—¶åšäº†å¾ˆå¤šäº‹æƒ…ã€‚æ¯”å¦‚æˆ‘ä»¬éœ€è¦åœ¨<code>componentDidMount</code>ä¸­å‘èµ·ajaxè¯·æ±‚è·å–æ•°æ®ï¼Œç»‘å®šä¸€äº›äº‹ä»¶ç›‘å¬ç­‰ç­‰ã€‚åŒæ—¶ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬è¿˜éœ€è¦åœ¨<code>componentDidUpdate</code>åšä¸€éåŒæ ·çš„äº‹æƒ…ã€‚å½“é¡¹ç›®å˜å¤æ‚åï¼Œè¿™ä¸€å—çš„ä»£ç ä¹Ÿå˜å¾—ä¸é‚£ä¹ˆç›´è§‚ã€‚</p>
<h3 id="classesçœŸçš„å¤ªè®©äººå›°æƒ‘äº†ï¼"><a href="#classesçœŸçš„å¤ªè®©äººå›°æƒ‘äº†ï¼" class="headerlink" title="classesçœŸçš„å¤ªè®©äººå›°æƒ‘äº†ï¼"></a>classesçœŸçš„å¤ªè®©äººå›°æƒ‘äº†ï¼</h3><p>æˆ‘ä»¬ç”¨classæ¥åˆ›å»ºreactç»„ä»¶æ—¶ï¼Œè¿˜æœ‰ä¸€ä»¶å¾ˆéº»çƒ¦çš„äº‹æƒ…ï¼Œå°±æ˜¯thisçš„æŒ‡å‘é—®é¢˜ã€‚ä¸ºäº†ä¿è¯thisçš„æŒ‡å‘æ­£ç¡®ï¼Œæˆ‘ä»¬è¦ç»å¸¸å†™è¿™æ ·çš„ä»£ç ï¼š<code>this.handleClick = this.handleClick.bind(this)</code>ï¼Œæˆ–è€…æ˜¯è¿™æ ·çš„ä»£ç ï¼š<code>&lt;button onClick={() =&gt; this.handleClick(e)}&gt;</code>ã€‚ä¸€æ—¦æˆ‘ä»¬ä¸å°å¿ƒå¿˜äº†ç»‘å®šthisï¼Œå„ç§bugå°±éšä¹‹è€Œæ¥ï¼Œå¾ˆéº»çƒ¦ã€‚</p>
<p>è¿˜æœ‰ä¸€ä»¶è®©æˆ‘å¾ˆè‹¦æ¼çš„äº‹æƒ…ã€‚æˆ‘åœ¨ä¹‹å‰çš„reactç³»åˆ—æ–‡ç« å½“ä¸­æ›¾ç»è¯´è¿‡ï¼Œå°½å¯èƒ½æŠŠä½ çš„ç»„ä»¶å†™æˆæ— çŠ¶æ€ç»„ä»¶çš„å½¢å¼ï¼Œå› ä¸ºå®ƒä»¬æ›´æ–¹ä¾¿å¤ç”¨ï¼Œå¯ç‹¬ç«‹æµ‹è¯•ã€‚ç„¶è€Œå¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬ç”¨functionå†™äº†ä¸€ä¸ªç®€æ´å®Œç¾çš„æ— çŠ¶æ€ç»„ä»¶ï¼Œåæ¥å› ä¸ºéœ€æ±‚å˜åŠ¨è¿™ä¸ªç»„ä»¶å¿…é¡»å¾—æœ‰è‡ªå·±çš„stateï¼Œæˆ‘ä»¬åˆå¾—å¾ˆéº»çƒ¦çš„æŠŠfunctionæ”¹æˆclassã€‚</p>
<p>åœ¨è¿™æ ·çš„èƒŒæ™¯ä¸‹ï¼ŒHooksä¾¿æ¨ªç©ºå‡ºä¸–äº†ï¼</p>
<h2 id="ä»€ä¹ˆæ˜¯State-Hooksï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯State-Hooksï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯State Hooksï¼Ÿ"></a>ä»€ä¹ˆæ˜¯State Hooksï¼Ÿ</h2><p>å›åˆ°ä¸€å¼€å§‹æˆ‘ä»¬ç”¨çš„ä¾‹å­ï¼Œæˆ‘ä»¬åˆ†è§£æ¥çœ‹åˆ°åº•state hooksåšäº†ä»€ä¹ˆï¼š</p>
<pre><code>import { useState } from &apos;react&apos;;

function Example() {
  const [count, setCount] = useState(0);

  return (
    &lt;div&gt;
      &lt;p&gt;You clicked {count} times&lt;/p&gt;
      &lt;button onClick={() =&gt; setCount(count + 1)}&gt;
        Click me
      &lt;/button&gt;
    &lt;/div&gt;
  );
}
</code></pre><h3 id="å£°æ˜ä¸€ä¸ªçŠ¶æ€å˜é‡"><a href="#å£°æ˜ä¸€ä¸ªçŠ¶æ€å˜é‡" class="headerlink" title="å£°æ˜ä¸€ä¸ªçŠ¶æ€å˜é‡"></a>å£°æ˜ä¸€ä¸ªçŠ¶æ€å˜é‡</h3><pre><code>import { useState } from &apos;react&apos;;

function Example() {
  const [count, setCount] = useState(0);
</code></pre><p><code>useState</code>æ˜¯reactè‡ªå¸¦çš„ä¸€ä¸ªhookå‡½æ•°ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯ç”¨æ¥å£°æ˜çŠ¶æ€å˜é‡ã€‚<code>useState</code>è¿™ä¸ªå‡½æ•°æ¥æ”¶çš„å‚æ•°æ˜¯æˆ‘ä»¬çš„çŠ¶æ€åˆå§‹å€¼ï¼ˆinitial stateï¼‰ï¼Œå®ƒè¿”å›äº†ä¸€ä¸ªæ•°ç»„ï¼Œè¿™ä¸ªæ•°ç»„çš„ç¬¬<code>[0]</code>é¡¹æ˜¯å½“å‰å½“å‰çš„çŠ¶æ€å€¼ï¼Œç¬¬<code>[1]</code>é¡¹æ˜¯å¯ä»¥æ”¹å˜çŠ¶æ€å€¼çš„æ–¹æ³•å‡½æ•°ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬åšçš„äº‹æƒ…å…¶å®å°±æ˜¯ï¼Œå£°æ˜äº†ä¸€ä¸ªçŠ¶æ€å˜é‡countï¼ŒæŠŠå®ƒçš„åˆå§‹å€¼è®¾ä¸º0ï¼ŒåŒæ—¶æä¾›äº†ä¸€ä¸ªå¯ä»¥æ›´æ”¹countçš„å‡½æ•°setCountã€‚</p>
<p>ä¸Šé¢è¿™ç§è¡¨è¾¾å½¢å¼ï¼Œæ˜¯å€Ÿç”¨äº†<code>es6çš„æ•°ç»„è§£æ„</code> ï¼Œå®ƒå¯ä»¥è®©æˆ‘ä»¬çš„ä»£ç çœ‹èµ·æ¥æ›´ç®€æ´ã€‚</p>
<p>å¦‚æœä¸ç”¨æ•°ç»„è§£æ„çš„è¯ï¼Œå¯ä»¥å†™æˆä¸‹é¢è¿™æ ·ã€‚å®é™…ä¸Šæ•°ç»„è§£æ„æ˜¯ä¸€ä»¶å¼€é”€å¾ˆå¤§çš„äº‹æƒ…ï¼Œç”¨ä¸‹é¢è¿™ç§å†™æ³•ï¼Œæˆ–è€…æ”¹ç”¨å¯¹è±¡è§£æ„ï¼Œæ€§èƒ½ä¼šæœ‰å¾ˆå¤§çš„æå‡ã€‚å…·ä½“å¯ä»¥å»è¿™ç¯‡æ–‡ç« çš„åˆ†æ<a href="https://link.juejin.im?target=https%3A%2F%2Fdocs.google.com%2Fdocument%2Fd%2F1hWb-lQW4NSG9yRpyyiAA_9Ktytd5lypLnVLhPX9vamE%2Fedit%23" target="_blank" rel="noopener">Array destructuring for multi-value returns (in light of React hooks)</a>ï¼Œè¿™é‡Œä¸è¯¦ç»†å±•å¼€ï¼Œæˆ‘ä»¬å°±æŒ‰ç…§å®˜æ–¹æ¨èä½¿ç”¨æ•°ç»„è§£æ„å°±å¥½ã€‚</p>
<pre><code>let _useState = useState(0);
let count = _useState[0];
let setCount = _useState[1];
</code></pre><h3 id="è¯»å–çŠ¶æ€å€¼"><a href="#è¯»å–çŠ¶æ€å€¼" class="headerlink" title="è¯»å–çŠ¶æ€å€¼"></a>è¯»å–çŠ¶æ€å€¼</h3><pre><code>&lt;p&gt;You clicked {count} times&lt;/p&gt;
</code></pre><p>æ˜¯ä¸æ˜¯è¶…ç®€å•ï¼Ÿå› ä¸ºæˆ‘ä»¬çš„çŠ¶æ€countå°±æ˜¯ä¸€ä¸ªå•çº¯çš„å˜é‡è€Œå·²ï¼Œæˆ‘ä»¬å†ä¹Ÿä¸éœ€è¦å†™æˆ<code>{this.state.count}</code>è¿™æ ·äº†ã€‚</p>
<h3 id="æ›´æ–°çŠ¶æ€"><a href="#æ›´æ–°çŠ¶æ€" class="headerlink" title="æ›´æ–°çŠ¶æ€"></a>æ›´æ–°çŠ¶æ€</h3><pre><code>&lt;button onClick={() =&gt; setCount(count + 1)}&gt;
  Click me
&lt;/button&gt;
</code></pre><p>å½“ç”¨æˆ·ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œæˆ‘ä»¬è°ƒç”¨setCountå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ¥æ”¶çš„å‚æ•°æ˜¯ä¿®æ”¹è¿‡çš„æ–°çŠ¶æ€å€¼ã€‚æ¥ä¸‹æ¥çš„äº‹æƒ…å°±äº¤ç»™reactäº†ï¼Œreactå°†ä¼šé‡æ–°æ¸²æŸ“æˆ‘ä»¬çš„Exampleç»„ä»¶ï¼Œå¹¶ä¸”ä½¿ç”¨çš„æ˜¯æ›´æ–°åçš„æ–°çš„çŠ¶æ€ï¼Œå³count=1ã€‚è¿™é‡Œæˆ‘ä»¬è¦åœä¸‹æ¥æ€è€ƒä¸€ä¸‹ï¼ŒExampleæœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªæ™®é€šçš„å‡½æ•°ï¼Œä¸ºä»€ä¹ˆå®ƒå¯ä»¥è®°ä½ä¹‹å‰çš„çŠ¶æ€ï¼Ÿ</p>
<h3 id="ä¸€ä¸ªè‡³å…³é‡è¦çš„é—®é¢˜"><a href="#ä¸€ä¸ªè‡³å…³é‡è¦çš„é—®é¢˜" class="headerlink" title="ä¸€ä¸ªè‡³å…³é‡è¦çš„é—®é¢˜"></a>ä¸€ä¸ªè‡³å…³é‡è¦çš„é—®é¢˜</h3><p>è¿™é‡Œæˆ‘ä»¬å°±å‘ç°äº†é—®é¢˜ï¼Œé€šå¸¸æ¥è¯´æˆ‘ä»¬åœ¨ä¸€ä¸ªå‡½æ•°ä¸­å£°æ˜çš„å˜é‡ï¼Œå½“å‡½æ•°è¿è¡Œå®Œæˆåï¼Œè¿™ä¸ªå˜é‡ä¹Ÿå°±é”€æ¯äº†ï¼ˆè¿™é‡Œæˆ‘ä»¬å…ˆä¸è€ƒè™‘é—­åŒ…ç­‰æƒ…å†µï¼‰ï¼Œæ¯”å¦‚è€ƒè™‘ä¸‹é¢çš„ä¾‹å­ï¼š</p>
<pre><code>function add(n) {
    const result = 0;
    return result + 1;
}

add(1); //1
add(1); //1
</code></pre><p>ä¸ç®¡æˆ‘ä»¬åå¤è°ƒç”¨addå‡½æ•°å¤šå°‘æ¬¡ï¼Œç»“æœéƒ½æ˜¯1ã€‚å› ä¸ºæ¯ä¸€æ¬¡æˆ‘ä»¬è°ƒç”¨addæ—¶ï¼Œresultå˜é‡éƒ½æ˜¯ä»åˆå§‹å€¼0å¼€å§‹çš„ã€‚é‚£ä¸ºä»€ä¹ˆä¸Šé¢çš„Exampleå‡½æ•°æ¯æ¬¡æ‰§è¡Œçš„æ—¶å€™ï¼Œéƒ½æ˜¯æ‹¿çš„ä¸Šä¸€æ¬¡æ‰§è¡Œå®Œçš„çŠ¶æ€å€¼ä½œä¸ºåˆå§‹å€¼ï¼Ÿç­”æ¡ˆæ˜¯ï¼šæ˜¯reactå¸®æˆ‘ä»¬è®°ä½çš„ã€‚è‡³äºreactæ˜¯ç”¨ä»€ä¹ˆæœºåˆ¶è®°ä½çš„ï¼Œæˆ‘ä»¬å¯ä»¥å†æ€è€ƒä¸€ä¸‹ã€‚</p>
<h3 id="å‡å¦‚ä¸€ä¸ªç»„ä»¶æœ‰å¤šä¸ªçŠ¶æ€å€¼æ€ä¹ˆåŠï¼Ÿ"><a href="#å‡å¦‚ä¸€ä¸ªç»„ä»¶æœ‰å¤šä¸ªçŠ¶æ€å€¼æ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="å‡å¦‚ä¸€ä¸ªç»„ä»¶æœ‰å¤šä¸ªçŠ¶æ€å€¼æ€ä¹ˆåŠï¼Ÿ"></a>å‡å¦‚ä¸€ä¸ªç»„ä»¶æœ‰å¤šä¸ªçŠ¶æ€å€¼æ€ä¹ˆåŠï¼Ÿ</h3><p>é¦–å…ˆï¼ŒuseStateæ˜¯å¯ä»¥å¤šæ¬¡è°ƒç”¨çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å®Œå…¨å¯ä»¥è¿™æ ·å†™ï¼š</p>
<pre><code>function ExampleWithManyStates() {
  const [age, setAge] = useState(42);
  const [fruit, setFruit] = useState(&apos;banana&apos;);
  const [todos, setTodos] = useState([{ text: &apos;Learn Hooks&apos; }]);
</code></pre><p>å…¶æ¬¡ï¼ŒuseStateæ¥æ”¶çš„åˆå§‹å€¼æ²¡æœ‰è§„å®šä¸€å®šè¦æ˜¯string/number/booleanè¿™ç§ç®€å•æ•°æ®ç±»å‹ï¼Œå®ƒå®Œå…¨å¯ä»¥æ¥æ”¶å¯¹è±¡æˆ–è€…æ•°ç»„ä½œä¸ºå‚æ•°ã€‚å”¯ä¸€éœ€è¦æ³¨æ„çš„ç‚¹æ˜¯ï¼Œä¹‹å‰æˆ‘ä»¬çš„<code>this.setState</code>åšçš„æ˜¯åˆå¹¶çŠ¶æ€åè¿”å›ä¸€ä¸ªæ–°çŠ¶æ€ï¼Œè€Œ<code>useState</code>æ˜¯ç›´æ¥æ›¿æ¢è€çŠ¶æ€åè¿”å›æ–°çŠ¶æ€ã€‚æœ€åï¼Œreactä¹Ÿç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªuseReducerçš„hookï¼Œå¦‚æœä½ æ›´å–œæ¬¢reduxå¼çš„çŠ¶æ€ç®¡ç†æ–¹æ¡ˆçš„è¯ã€‚</p>
<p>ä»ExampleWithManyStateså‡½æ•°æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒuseStateæ— è®ºè°ƒç”¨å¤šå°‘æ¬¡ï¼Œç›¸äº’ä¹‹é—´æ˜¯ç‹¬ç«‹çš„ã€‚è¿™ä¸€ç‚¹è‡³å…³é‡è¦ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿ</p>
<p>å…¶å®æˆ‘ä»¬çœ‹hookçš„â€œå½¢æ€â€ï¼Œæœ‰ç‚¹ç±»ä¼¼ä¹‹å‰è¢«å®˜æ–¹å¦å®šæ‰çš„Mixinsè¿™ç§æ–¹æ¡ˆï¼Œéƒ½æ˜¯æä¾›ä¸€ç§â€œæ’æ‹”å¼çš„åŠŸèƒ½æ³¨å…¥â€çš„èƒ½åŠ›ã€‚è€Œmixinsä¹‹æ‰€ä»¥è¢«å¦å®šï¼Œæ˜¯å› ä¸ºMixinsæœºåˆ¶æ˜¯è®©å¤šä¸ªMixinså…±äº«ä¸€ä¸ªå¯¹è±¡çš„æ•°æ®ç©ºé—´ï¼Œè¿™æ ·å°±å¾ˆéš¾ç¡®ä¿ä¸åŒMixinsä¾èµ–çš„çŠ¶æ€ä¸å‘ç”Ÿå†²çªã€‚</p>
<p>è€Œç°åœ¨æˆ‘ä»¬çš„hookï¼Œä¸€æ–¹é¢å®ƒæ˜¯ç›´æ¥ç”¨åœ¨functionå½“ä¸­ï¼Œè€Œä¸æ˜¯classï¼›å¦ä¸€æ–¹é¢æ¯ä¸€ä¸ªhookéƒ½æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œä¸åŒç»„ä»¶è°ƒç”¨åŒä¸€ä¸ªhookä¹Ÿèƒ½ä¿è¯å„è‡ªçŠ¶æ€çš„ç‹¬ç«‹æ€§ã€‚è¿™å°±æ˜¯ä¸¤è€…çš„æœ¬è´¨åŒºåˆ«äº†ã€‚</p>
<h3 id="reactæ˜¯æ€ä¹ˆä¿è¯å¤šä¸ªuseStateçš„ç›¸äº’ç‹¬ç«‹çš„ï¼Ÿ"><a href="#reactæ˜¯æ€ä¹ˆä¿è¯å¤šä¸ªuseStateçš„ç›¸äº’ç‹¬ç«‹çš„ï¼Ÿ" class="headerlink" title="reactæ˜¯æ€ä¹ˆä¿è¯å¤šä¸ªuseStateçš„ç›¸äº’ç‹¬ç«‹çš„ï¼Ÿ"></a>reactæ˜¯æ€ä¹ˆä¿è¯å¤šä¸ªuseStateçš„ç›¸äº’ç‹¬ç«‹çš„ï¼Ÿ</h3><p>è¿˜æ˜¯çœ‹ä¸Šé¢ç»™å‡ºçš„ExampleWithManyStatesä¾‹å­ï¼Œæˆ‘ä»¬è°ƒç”¨äº†ä¸‰æ¬¡useStateï¼Œæ¯æ¬¡æˆ‘ä»¬ä¼ çš„å‚æ•°åªæ˜¯ä¸€ä¸ªå€¼ï¼ˆå¦‚42ï¼Œâ€˜bananaâ€™ï¼‰ï¼Œæˆ‘ä»¬æ ¹æœ¬æ²¡æœ‰å‘Šè¯‰reactè¿™äº›å€¼å¯¹åº”çš„keyæ˜¯å“ªä¸ªï¼Œé‚£reactæ˜¯æ€ä¹ˆä¿è¯è¿™ä¸‰ä¸ªuseStateæ‰¾åˆ°å®ƒå¯¹åº”çš„stateå‘¢ï¼Ÿ</p>
<p>ç­”æ¡ˆæ˜¯ï¼Œreactæ˜¯æ ¹æ®useStateå‡ºç°çš„é¡ºåºæ¥å®šçš„ã€‚æˆ‘ä»¬å…·ä½“æ¥çœ‹ä¸€ä¸‹ï¼š</p>
<pre><code>//ç¬¬ä¸€æ¬¡æ¸²æŸ“
useState(42);  //å°†ageåˆå§‹åŒ–ä¸º42
useState(&apos;banana&apos;);  //å°†fruitåˆå§‹åŒ–ä¸ºbanana
useState([{ text: &apos;Learn Hooks&apos; }]); //...

//ç¬¬äºŒæ¬¡æ¸²æŸ“
useState(42);  //è¯»å–çŠ¶æ€å˜é‡ageçš„å€¼ï¼ˆè¿™æ—¶å€™ä¼ çš„å‚æ•°42ç›´æ¥è¢«å¿½ç•¥ï¼‰
useState(&apos;banana&apos;);  //è¯»å–çŠ¶æ€å˜é‡fruitçš„å€¼ï¼ˆè¿™æ—¶å€™ä¼ çš„å‚æ•°bananaç›´æ¥è¢«å¿½ç•¥ï¼‰
useState([{ text: &apos;Learn Hooks&apos; }]); //...
</code></pre><p>å‡å¦‚æˆ‘ä»¬æ”¹ä¸€ä¸‹ä»£ç ï¼š</p>
<pre><code>let showFruit = true;
function ExampleWithManyStates() {
  const [age, setAge] = useState(42);

  if(showFruit) {
    const [fruit, setFruit] = useState(&apos;banana&apos;);
    showFruit = false;
  }

  const [todos, setTodos] = useState([{ text: &apos;Learn Hooks&apos; }]);
</code></pre><p>è¿™æ ·ä¸€æ¥ï¼Œ</p>
<pre><code>//ç¬¬ä¸€æ¬¡æ¸²æŸ“
useState(42);  //å°†ageåˆå§‹åŒ–ä¸º42
useState(&apos;banana&apos;);  //å°†fruitåˆå§‹åŒ–ä¸ºbanana
useState([{ text: &apos;Learn Hooks&apos; }]); //...

//ç¬¬äºŒæ¬¡æ¸²æŸ“
useState(42);  //è¯»å–çŠ¶æ€å˜é‡ageçš„å€¼ï¼ˆè¿™æ—¶å€™ä¼ çš„å‚æ•°42ç›´æ¥è¢«å¿½ç•¥ï¼‰
// useState(&apos;banana&apos;);  
useState([{ text: &apos;Learn Hooks&apos; }]); //è¯»å–åˆ°çš„å´æ˜¯çŠ¶æ€å˜é‡fruitçš„å€¼ï¼Œå¯¼è‡´æŠ¥é”™
</code></pre><p>é‰´äºæ­¤ï¼Œreactè§„å®šæˆ‘ä»¬å¿…é¡»æŠŠhookså†™åœ¨å‡½æ•°çš„æœ€å¤–å±‚ï¼Œä¸èƒ½å†™åœ¨ifelseç­‰æ¡ä»¶è¯­å¥å½“ä¸­ï¼Œæ¥ç¡®ä¿hooksçš„æ‰§è¡Œé¡ºåºä¸€è‡´ã€‚</p>
<h2 id="ä»€ä¹ˆæ˜¯Effect-Hooks"><a href="#ä»€ä¹ˆæ˜¯Effect-Hooks" class="headerlink" title="ä»€ä¹ˆæ˜¯Effect Hooks?"></a>ä»€ä¹ˆæ˜¯Effect Hooks?</h2><p>æˆ‘ä»¬åœ¨ä¸Šä¸€èŠ‚çš„ä¾‹å­ä¸­å¢åŠ ä¸€ä¸ªæ–°åŠŸèƒ½ï¼š</p>
<pre><code>import { useState, useEffect } from &apos;react&apos;;

function Example() {
  const [count, setCount] = useState(0);

  // ç±»ä¼¼äºcomponentDidMount å’Œ componentDidUpdate:
  useEffect(() =&gt; {
    // æ›´æ–°æ–‡æ¡£çš„æ ‡é¢˜
    document.title = `You clicked ${count}times`;
  });

  return (
    &lt;div&gt;
      &lt;p&gt;You clicked {count} times&lt;/p&gt;
      &lt;button onClick={() =&gt; setCount(count + 1)}&gt;
        Click me
      &lt;/button&gt;
    &lt;/div&gt;
  );
}
</code></pre><p>æˆ‘ä»¬å¯¹æ¯”ç€çœ‹ä¸€ä¸‹ï¼Œå¦‚æœæ²¡æœ‰hooksï¼Œæˆ‘ä»¬ä¼šæ€ä¹ˆå†™ï¼Ÿ</p>
<pre><code>class Example extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      count: 0
    };
  }

  componentDidMount() {
    document.title = `You clicked ${this.state.count}times`;
  }

  componentDidUpdate() {
    document.title = `You clicked ${this.state.count}times`;
  }

  render() {
    return (
      &lt;div&gt;
        &lt;p&gt;You clicked {this.state.count} times&lt;/p&gt;
        &lt;button onClick={() =&gt; this.setState({ count: this.state.count + 1 })}&gt;
          Click me
        &lt;/button&gt;
      &lt;/div&gt;
    );
  }
}
</code></pre><p>æˆ‘ä»¬å†™çš„æœ‰çŠ¶æ€ç»„ä»¶ï¼Œé€šå¸¸ä¼šäº§ç”Ÿå¾ˆå¤šçš„å‰¯ä½œç”¨ï¼ˆside effectï¼‰ï¼Œæ¯”å¦‚å‘èµ·ajaxè¯·æ±‚è·å–æ•°æ®ï¼Œæ·»åŠ ä¸€äº›ç›‘å¬çš„æ³¨å†Œå’Œå–æ¶ˆæ³¨å†Œï¼Œæ‰‹åŠ¨ä¿®æ”¹domç­‰ç­‰ã€‚æˆ‘ä»¬ä¹‹å‰éƒ½æŠŠè¿™äº›å‰¯ä½œç”¨çš„å‡½æ•°å†™åœ¨ç”Ÿå‘½å‘¨æœŸå‡½æ•°é’©å­é‡Œï¼Œæ¯”å¦‚componentDidMountï¼ŒcomponentDidUpdateå’ŒcomponentWillUnmountã€‚è€Œç°åœ¨çš„useEffectå°±ç›¸å½“ä¸è¿™äº›å£°æ˜å‘¨æœŸå‡½æ•°é’©å­çš„é›†åˆä½“ã€‚å®ƒä»¥ä¸€æŠµä¸‰ã€‚</p>
<p>åŒæ—¶ï¼Œç”±äºå‰æ–‡æ‰€è¯´hookså¯ä»¥åå¤å¤šæ¬¡ä½¿ç”¨ï¼Œç›¸äº’ç‹¬ç«‹ã€‚æ‰€ä»¥æˆ‘ä»¬åˆç†çš„åšæ³•æ˜¯ï¼Œç»™æ¯ä¸€ä¸ªå‰¯ä½œç”¨ä¸€ä¸ªå•ç‹¬çš„useEffecté’©å­ã€‚è¿™æ ·ä¸€æ¥ï¼Œè¿™äº›å‰¯ä½œç”¨ä¸å†ä¸€è‚¡è„‘å †åœ¨ç”Ÿå‘½å‘¨æœŸé’©å­é‡Œï¼Œä»£ç å˜å¾—æ›´åŠ æ¸…æ™°ã€‚</p>
<h3 id="useEffectåšäº†ä»€ä¹ˆï¼Ÿ"><a href="#useEffectåšäº†ä»€ä¹ˆï¼Ÿ" class="headerlink" title="useEffectåšäº†ä»€ä¹ˆï¼Ÿ"></a>useEffectåšäº†ä»€ä¹ˆï¼Ÿ</h3><p>æˆ‘ä»¬å†æ¢³ç†ä¸€éä¸‹é¢ä»£ç çš„é€»è¾‘ï¼š</p>
<pre><code>function Example() {
  const [count, setCount] = useState(0);

  useEffect(() =&gt; {
    document.title = `You clicked ${count}times`;
  });
</code></pre><p>é¦–å…ˆï¼Œæˆ‘ä»¬å£°æ˜äº†ä¸€ä¸ªçŠ¶æ€å˜é‡<code>count</code>ï¼Œå°†å®ƒçš„åˆå§‹å€¼è®¾ä¸º0ã€‚ç„¶åæˆ‘ä»¬å‘Šè¯‰reactï¼Œæˆ‘ä»¬çš„è¿™ä¸ªç»„ä»¶æœ‰ä¸€ä¸ªå‰¯ä½œç”¨ã€‚æˆ‘ä»¬ç»™<code>useEffect</code>hookä¼ äº†ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œè¿™ä¸ªåŒ¿åå‡½æ•°å°±æ˜¯æˆ‘ä»¬çš„å‰¯ä½œç”¨ã€‚åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œæˆ‘ä»¬çš„å‰¯ä½œç”¨æ˜¯è°ƒç”¨browser APIæ¥ä¿®æ”¹æ–‡æ¡£æ ‡é¢˜ã€‚å½“reactè¦æ¸²æŸ“æˆ‘ä»¬çš„ç»„ä»¶æ—¶ï¼Œå®ƒä¼šå…ˆè®°ä½æˆ‘ä»¬ç”¨åˆ°çš„å‰¯ä½œç”¨ã€‚ç­‰reactæ›´æ–°äº†DOMä¹‹åï¼Œå®ƒå†ä¾æ¬¡æ‰§è¡Œæˆ‘ä»¬å®šä¹‰çš„å‰¯ä½œç”¨å‡½æ•°ã€‚</p>
<p>è¿™é‡Œè¦æ³¨æ„å‡ ç‚¹ï¼š<br>ç¬¬ä¸€ï¼Œreacté¦–æ¬¡æ¸²æŸ“å’Œä¹‹åçš„æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šè°ƒç”¨ä¸€éä¼ ç»™useEffectçš„å‡½æ•°ã€‚è€Œä¹‹å‰æˆ‘ä»¬è¦ç”¨ä¸¤ä¸ªå£°æ˜å‘¨æœŸå‡½æ•°æ¥åˆ†åˆ«è¡¨ç¤ºé¦–æ¬¡æ¸²æŸ“ï¼ˆcomponentDidMountï¼‰ï¼Œå’Œä¹‹åçš„æ›´æ–°å¯¼è‡´çš„é‡æ–°æ¸²æŸ“ï¼ˆcomponentDidUpdateï¼‰ã€‚</p>
<p>ç¬¬äºŒï¼ŒuseEffectä¸­å®šä¹‰çš„å‰¯ä½œç”¨å‡½æ•°çš„æ‰§è¡Œä¸ä¼šé˜»ç¢æµè§ˆå™¨æ›´æ–°è§†å›¾ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™äº›å‡½æ•°æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼Œè€Œä¹‹å‰çš„componentDidMountæˆ–componentDidUpdateä¸­çš„ä»£ç åˆ™æ˜¯åŒæ­¥æ‰§è¡Œçš„ã€‚è¿™ç§å®‰æ’å¯¹å¤§å¤šæ•°å‰¯ä½œç”¨è¯´éƒ½æ˜¯åˆç†çš„ï¼Œä½†æœ‰çš„æƒ…å†µé™¤å¤–ï¼Œæ¯”å¦‚æˆ‘ä»¬æœ‰æ—¶å€™éœ€è¦å…ˆæ ¹æ®DOMè®¡ç®—å‡ºæŸä¸ªå…ƒç´ çš„å°ºå¯¸å†é‡æ–°æ¸²æŸ“ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å¸Œæœ›è¿™æ¬¡é‡æ–°æ¸²æŸ“æ˜¯åŒæ­¥å‘ç”Ÿçš„ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä¼šåœ¨æµè§ˆå™¨çœŸçš„å»ç»˜åˆ¶è¿™ä¸ªé¡µé¢å‰å‘ç”Ÿã€‚</p>
<h3 id="useEffectæ€ä¹ˆè§£ç»‘ä¸€äº›å‰¯ä½œç”¨"><a href="#useEffectæ€ä¹ˆè§£ç»‘ä¸€äº›å‰¯ä½œç”¨" class="headerlink" title="useEffectæ€ä¹ˆè§£ç»‘ä¸€äº›å‰¯ä½œç”¨"></a>useEffectæ€ä¹ˆè§£ç»‘ä¸€äº›å‰¯ä½œç”¨</h3><p>è¿™ç§åœºæ™¯å¾ˆå¸¸è§ï¼Œå½“æˆ‘ä»¬åœ¨componentDidMounté‡Œæ·»åŠ äº†ä¸€ä¸ªæ³¨å†Œï¼Œæˆ‘ä»¬å¾—é©¬ä¸Šåœ¨componentWillUnmountä¸­ï¼Œä¹Ÿå°±æ˜¯ç»„ä»¶è¢«æ³¨é”€ä¹‹å‰æ¸…é™¤æ‰æˆ‘ä»¬æ·»åŠ çš„æ³¨å†Œï¼Œå¦åˆ™å†…å­˜æ³„æ¼çš„é—®é¢˜å°±å‡ºç°äº†ã€‚</p>
<p>æ€ä¹ˆæ¸…é™¤å‘¢ï¼Ÿè®©æˆ‘ä»¬ä¼ ç»™useEffectçš„å‰¯ä½œç”¨å‡½æ•°è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°å³å¯ã€‚è¿™ä¸ªæ–°çš„å‡½æ•°å°†ä¼šåœ¨ç»„ä»¶ä¸‹ä¸€æ¬¡é‡æ–°æ¸²æŸ“ä¹‹åæ‰§è¡Œã€‚è¿™ç§æ¨¡å¼åœ¨ä¸€äº›pubsubæ¨¡å¼çš„å®ç°ä¸­å¾ˆå¸¸è§ã€‚çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p>
<pre><code>import { useState, useEffect } from &apos;react&apos;;

function FriendStatus(props) {
  const [isOnline, setIsOnline] = useState(null);

  function handleStatusChange(status) {
    setIsOnline(status.isOnline);
  }

  useEffect(() =&gt; {
    ChatAPI.subscribeToFriendStatus(props.friend.id, handleStatusChange);
    // ä¸€å®šæ³¨æ„ä¸‹è¿™ä¸ªé¡ºåºï¼šå‘Šè¯‰reactåœ¨ä¸‹æ¬¡é‡æ–°æ¸²æŸ“ç»„ä»¶ä¹‹åï¼ŒåŒæ—¶æ˜¯ä¸‹æ¬¡è°ƒç”¨ChatAPI.subscribeToFriendStatusä¹‹å‰æ‰§è¡Œcleanup
    returnfunctioncleanup() {
      ChatAPI.unsubscribeFromFriendStatus(props.friend.id, handleStatusChange);
    };
  });

  if (isOnline === null) {
    return&apos;Loading...&apos;;
  }
  return isOnline ? &apos;Online&apos; : &apos;Offline&apos;;
}
</code></pre><p>è¿™é‡Œæœ‰ä¸€ä¸ªç‚¹éœ€è¦é‡è§†ï¼è¿™ç§è§£ç»‘çš„æ¨¡å¼è·ŸcomponentWillUnmountä¸ä¸€æ ·ã€‚componentWillUnmountåªä¼šåœ¨ç»„ä»¶è¢«é”€æ¯å‰æ‰§è¡Œä¸€æ¬¡è€Œå·²ï¼Œè€ŒuseEffecté‡Œçš„å‡½æ•°ï¼Œæ¯æ¬¡ç»„ä»¶æ¸²æŸ“åéƒ½ä¼šæ‰§è¡Œä¸€éï¼ŒåŒ…æ‹¬å‰¯ä½œç”¨å‡½æ•°è¿”å›çš„è¿™ä¸ªæ¸…ç†å‡½æ•°ä¹Ÿä¼šé‡æ–°æ‰§è¡Œä¸€éã€‚æ‰€ä»¥æˆ‘ä»¬ä¸€èµ·æ¥çœ‹ä¸€ä¸‹ä¸‹é¢è¿™ä¸ªé—®é¢˜ã€‚</p>
<h3 id="ä¸ºä»€ä¹ˆè¦è®©å‰¯ä½œç”¨å‡½æ•°æ¯æ¬¡ç»„ä»¶æ›´æ–°éƒ½æ‰§è¡Œä¸€éï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦è®©å‰¯ä½œç”¨å‡½æ•°æ¯æ¬¡ç»„ä»¶æ›´æ–°éƒ½æ‰§è¡Œä¸€éï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦è®©å‰¯ä½œç”¨å‡½æ•°æ¯æ¬¡ç»„ä»¶æ›´æ–°éƒ½æ‰§è¡Œä¸€éï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦è®©å‰¯ä½œç”¨å‡½æ•°æ¯æ¬¡ç»„ä»¶æ›´æ–°éƒ½æ‰§è¡Œä¸€éï¼Ÿ</h3><p>æˆ‘ä»¬å…ˆçœ‹ä»¥å‰çš„æ¨¡å¼ï¼š</p>
<pre><code>componentDidMount() {
    ChatAPI.subscribeToFriendStatus(
      this.props.friend.id,
      this.handleStatusChange
    );
  }

  componentWillUnmount() {
    ChatAPI.unsubscribeFromFriendStatus(
      this.props.friend.id,
      this.handleStatusChange
    );
  }
</code></pre><p>å¾ˆæ¸…é™¤ï¼Œæˆ‘ä»¬åœ¨componentDidMountæ³¨å†Œï¼Œå†åœ¨componentWillUnmountæ¸…é™¤æ³¨å†Œã€‚ä½†å‡å¦‚è¿™æ—¶å€™<code>props.friend.id</code>å˜äº†æ€ä¹ˆåŠï¼Ÿæˆ‘ä»¬ä¸å¾—ä¸å†æ·»åŠ ä¸€ä¸ªcomponentDidUpdateæ¥å¤„ç†è¿™ç§æƒ…å†µï¼š</p>
<pre><code>...
  componentDidUpdate(prevProps) {
    // å…ˆæŠŠä¸Šä¸€ä¸ªfriend.idè§£ç»‘
    ChatAPI.unsubscribeFromFriendStatus(
      prevProps.friend.id,
      this.handleStatusChange
    );
    // å†é‡æ–°æ³¨å†Œæ–°ä½†friend.id
    ChatAPI.subscribeToFriendStatus(
      this.props.friend.id,
      this.handleStatusChange
    );
  }
...
</code></pre><p>çœ‹åˆ°äº†å—ï¼Ÿå¾ˆç¹çï¼Œè€Œæˆ‘ä»¬ä½†useEffectåˆ™æ²¡è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºå®ƒåœ¨æ¯æ¬¡ç»„ä»¶æ›´æ–°åéƒ½ä¼šé‡æ–°æ‰§è¡Œä¸€éã€‚æ‰€ä»¥ä»£ç çš„æ‰§è¡Œé¡ºåºæ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code>1.é¡µé¢é¦–æ¬¡æ¸²æŸ“
2.æ›¿friend.id=1çš„æœ‹å‹æ³¨å†Œ

3.çªç„¶friend.idå˜æˆäº†2
4.é¡µé¢é‡æ–°æ¸²æŸ“
5.æ¸…é™¤friend.id=1çš„ç»‘å®š
6.æ›¿friend.id=2çš„æœ‹å‹æ³¨å†Œ
...
</code></pre><h3 id="æ€ä¹ˆè·³è¿‡ä¸€äº›ä¸å¿…è¦çš„å‰¯ä½œç”¨å‡½æ•°"><a href="#æ€ä¹ˆè·³è¿‡ä¸€äº›ä¸å¿…è¦çš„å‰¯ä½œç”¨å‡½æ•°" class="headerlink" title="æ€ä¹ˆè·³è¿‡ä¸€äº›ä¸å¿…è¦çš„å‰¯ä½œç”¨å‡½æ•°"></a>æ€ä¹ˆè·³è¿‡ä¸€äº›ä¸å¿…è¦çš„å‰¯ä½œç”¨å‡½æ•°</h3><p>æŒ‰ç…§ä¸Šä¸€èŠ‚çš„æ€è·¯ï¼Œæ¯æ¬¡é‡æ–°æ¸²æŸ“éƒ½è¦æ‰§è¡Œä¸€éè¿™äº›å‰¯ä½œç”¨å‡½æ•°ï¼Œæ˜¾ç„¶æ˜¯ä¸ç»æµçš„ã€‚æ€ä¹ˆè·³è¿‡ä¸€äº›ä¸å¿…è¦çš„è®¡ç®—å‘¢ï¼Ÿæˆ‘ä»¬åªéœ€è¦ç»™useEffectä¼ ç¬¬äºŒä¸ªå‚æ•°å³å¯ã€‚ç”¨ç¬¬äºŒä¸ªå‚æ•°æ¥å‘Šè¯‰reactåªæœ‰å½“è¿™ä¸ªå‚æ•°çš„å€¼å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰æ‰§è¡Œæˆ‘ä»¬ä¼ çš„å‰¯ä½œç”¨å‡½æ•°ï¼ˆç¬¬ä¸€ä¸ªå‚æ•°ï¼‰ã€‚</p>
<pre><code>useEffect(() =&gt; {
  document.title = `You clicked ${count}times`;
}, [count]);     // åªæœ‰å½“countçš„å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰ä¼šé‡æ–°æ‰§è¡Œ`document.title`è¿™ä¸€å¥
</code></pre><p>å½“æˆ‘ä»¬ç¬¬äºŒä¸ªå‚æ•°ä¼ ä¸€ä¸ªç©ºæ•°ç»„[]æ—¶ï¼Œå…¶å®å°±ç›¸å½“äºåªåœ¨é¦–æ¬¡æ¸²æŸ“çš„æ—¶å€™æ‰§è¡Œã€‚ä¹Ÿå°±æ˜¯componentDidMountåŠ componentWillUnmountçš„æ¨¡å¼ã€‚ä¸è¿‡è¿™ç§ç”¨æ³•å¯èƒ½å¸¦æ¥bugï¼Œå°‘ç”¨ã€‚</p>
<h2 id="è¿˜æœ‰å“ªäº›è‡ªå¸¦çš„Effect-Hooks"><a href="#è¿˜æœ‰å“ªäº›è‡ªå¸¦çš„Effect-Hooks" class="headerlink" title="è¿˜æœ‰å“ªäº›è‡ªå¸¦çš„Effect Hooks?"></a>è¿˜æœ‰å“ªäº›è‡ªå¸¦çš„Effect Hooks?</h2><p>é™¤äº†ä¸Šæ–‡é‡ç‚¹ä»‹ç»çš„useStateå’ŒuseEffectï¼Œreactè¿˜ç»™æˆ‘ä»¬æä¾›æ¥å¾ˆå¤šæœ‰ç”¨çš„hooksï¼š</p>
<p>useContext<br>useReducer<br>useCallback<br>useMemo<br>useRef<br>useImperativeMethods<br>useMutationEffect<br>useLayoutEffect</p>
<p>æˆ‘ä¸å†ä¸€ä¸€ä»‹ç»ï¼Œå¤§å®¶è‡ªè¡Œå»æŸ¥é˜…å®˜æ–¹æ–‡æ¡£ã€‚</p>
<h2 id="æ€ä¹ˆå†™è‡ªå®šä¹‰çš„Effect-Hooks"><a href="#æ€ä¹ˆå†™è‡ªå®šä¹‰çš„Effect-Hooks" class="headerlink" title="æ€ä¹ˆå†™è‡ªå®šä¹‰çš„Effect Hooks?"></a>æ€ä¹ˆå†™è‡ªå®šä¹‰çš„Effect Hooks?</h2><p>ä¸ºä»€ä¹ˆè¦è‡ªå·±å»å†™ä¸€ä¸ªEffect Hooks? è¿™æ ·æˆ‘ä»¬æ‰èƒ½æŠŠå¯ä»¥å¤ç”¨çš„é€»è¾‘æŠ½ç¦»å‡ºæ¥ï¼Œå˜æˆä¸€ä¸ªä¸ªå¯ä»¥éšæ„æ’æ‹”çš„â€œæ’é”€â€ï¼Œå“ªä¸ªç»„ä»¶è¦ç”¨æ¥ï¼Œæˆ‘å°±æ’è¿›å“ªä¸ªç»„ä»¶é‡Œï¼Œso easyï¼çœ‹ä¸€ä¸ªå®Œæ•´çš„ä¾‹å­ï¼Œä½ å°±æ˜ç™½äº†ã€‚</p>
<p>æ¯”å¦‚æˆ‘ä»¬å¯ä»¥æŠŠä¸Šé¢å†™çš„FriendStatusç»„ä»¶ä¸­åˆ¤æ–­æœ‹å‹æ˜¯å¦åœ¨çº¿çš„åŠŸèƒ½æŠ½å‡ºæ¥ï¼Œæ–°å»ºä¸€ä¸ªuseFriendStatusçš„hookä¸“é—¨ç”¨æ¥åˆ¤æ–­æŸä¸ªidæ˜¯å¦åœ¨çº¿ã€‚</p>
<pre><code>import { useState, useEffect } from &apos;react&apos;;

function useFriendStatus(friendID) {
  const [isOnline, setIsOnline] = useState(null);

  function handleStatusChange(status) {
    setIsOnline(status.isOnline);
  }

  useEffect(() =&gt; {
    ChatAPI.subscribeToFriendStatus(friendID, handleStatusChange);
    return () =&gt; {
      ChatAPI.unsubscribeFromFriendStatus(friendID, handleStatusChange);
    };
  });

  return isOnline;
}
</code></pre><p>è¿™æ—¶å€™FriendStatusç»„ä»¶å°±å¯ä»¥ç®€å†™ä¸ºï¼š</p>
<pre><code>function FriendStatus(props) {
  const isOnline = useFriendStatus(props.friend.id);

  if (isOnline === null) {
    return &apos;Loading...&apos;;
  }
  return isOnline ? &apos;Online&apos; : &apos;Offline&apos;;
}
</code></pre><p>ç®€ç›´Perfectï¼å‡å¦‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬åˆæœ‰ä¸€ä¸ªæœ‹å‹åˆ—è¡¨ä¹Ÿéœ€è¦æ˜¾ç¤ºæ˜¯å¦åœ¨çº¿çš„ä¿¡æ¯ï¼š</p>
<pre><code>function FriendListItem(props) {
  const isOnline = useFriendStatus(props.friend.id);

  return (
    &lt;li style={{ color: isOnline ? 'green' : 'black' }}&gt;
      {props.friend.name}
    &lt;/li&gt;
  );
}
</code></pre><h2 id="DEMO"><a href="#DEMO" class="headerlink" title="DEMO"></a><a href="https://github.com/libin1991/webpack4-vue-more-page-cli/tree/master/React-Hooks" target="_blank" rel="noopener">DEMO</a></h2><p><img src="/2018/11/06/React-Hooks/1.png" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line">// import React from &apos;react&apos;;</span><br><span class="line">import logo from &apos;./logo.svg&apos;;</span><br><span class="line">import &apos;./App.css&apos;;</span><br><span class="line">import React, &#123;</span><br><span class="line">	// useHooks,</span><br><span class="line">	useState,</span><br><span class="line">	useEffect,</span><br><span class="line">	useContext,</span><br><span class="line">	useReducer,</span><br><span class="line">	useRef</span><br><span class="line">&#125; from &apos;react&apos;</span><br><span class="line"></span><br><span class="line">const ThemeContext = React.createContext(&#123;</span><br><span class="line">	background: &apos;#282c34&apos;,</span><br><span class="line">	color: &apos;#61dafb&apos;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * ç›‘æ§æµè§ˆå™¨å˜åŒ–</span><br><span class="line"> * @return &#123;number&#125; innerWidth è¿”å›å½“å‰çª—å£å®½åº¦</span><br><span class="line"> * **/</span><br><span class="line">const useWindowWith = () =&gt; &#123;</span><br><span class="line"></span><br><span class="line">	const [innerWidth, setInnerWidth] = useState(window.innerWidth);</span><br><span class="line"></span><br><span class="line">	const handleResize = () =&gt; setInnerWidth(window.innerWidth)</span><br><span class="line"></span><br><span class="line">	useEffect(() =&gt; &#123;</span><br><span class="line">		window.addEventListener(&apos;resize&apos;, handleResize)</span><br><span class="line">		return() =&gt; &#123;</span><br><span class="line">			window.removeEventListener(&apos;resize&apos;, handleResize)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;)</span><br><span class="line">	return innerWidth</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * è®¡æ•°</span><br><span class="line"> * @param  &#123;number&#125; initialState åˆå§‹å€¼</span><br><span class="line"> * @return &#123;number&#125; count å€¼</span><br><span class="line"> * @return &#123;function&#125; setCount æ”¹å˜å€¼çš„æ–¹æ³•</span><br><span class="line"> * */</span><br><span class="line">const useCount = (initialState) =&gt; &#123;</span><br><span class="line">	const [count, setCount] = useState(initialState);</span><br><span class="line">	useEffect(() =&gt; &#123;</span><br><span class="line">		console.log(&apos;change&apos;)</span><br><span class="line">	&#125;, [count])</span><br><span class="line">	return [count, setCount]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * count-reducer</span><br><span class="line"> * * */</span><br><span class="line"></span><br><span class="line">const initialState = &#123;</span><br><span class="line">	count: 0</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">function reducer(state, action) &#123;</span><br><span class="line">	switch(action.type) &#123;</span><br><span class="line">		case &apos;reset&apos;:</span><br><span class="line">			return initialState;</span><br><span class="line">		case &apos;increment&apos;:</span><br><span class="line">			return &#123;</span><br><span class="line">				count: state.count + 1</span><br><span class="line">			&#125;;</span><br><span class="line">		case &apos;decrement&apos;:</span><br><span class="line">			return &#123;</span><br><span class="line">				count: state.count - 1</span><br><span class="line">			&#125;;</span><br><span class="line">		default:</span><br><span class="line">			return state</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * ç‚¹å‡»è·å–ç„¦ç‚¹</span><br><span class="line"> * @param  &#123;number&#125; initial åˆå§‹å€¼</span><br><span class="line"> * @return &#123;object&#125; ref å½“å‰çš„refå¯¹è±¡</span><br><span class="line"> * @return &#123;function&#125; focusHandle ä½¿ç”¨è¯¥refå¯¹è±¡çš„å‡½æ•°</span><br><span class="line"> * */</span><br><span class="line">function useRefHandle(initial) &#123;</span><br><span class="line">	let ref = useRef(initial)</span><br><span class="line">	let focusHandle = () =&gt; ref.current.focus();</span><br><span class="line">	return [ref, focusHandle]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const App = (props) =&gt; &#123;</span><br><span class="line">	const innerWidth = useWindowWith()</span><br><span class="line">	const [count, setCount] = useCount(0);</span><br><span class="line">	const &#123;</span><br><span class="line">		color,</span><br><span class="line">		background</span><br><span class="line">	&#125; = useContext(ThemeContext);</span><br><span class="line">	const [state, dispatch] = useReducer(reducer, initialState)</span><br><span class="line">	let [inputEl, focusHandle] = useRefHandle(null);</span><br><span class="line">	console.log(&apos;render number&apos;)</span><br><span class="line">	return(</span><br><span class="line">		&lt;div className=&quot;App&quot;&gt;</span><br><span class="line">        &#123;/* useContext demo */&#125;</span><br><span class="line">        &lt;header className=&quot;App-header&quot; style=&#123;&#123;backgroundColor:background&#125;&#125;&gt;</span><br><span class="line">          &lt;img src=&#123;logo&#125; className=&quot;App-logo&quot; alt=&quot;logo&quot; /&gt;</span><br><span class="line">          &lt;p&gt;  react hook demo &lt;/p&gt;</span><br><span class="line"></span><br><span class="line">          &#123;/* useState demo */&#125;</span><br><span class="line">          &lt;p&gt;count:&#123;count&#125;&lt;/p&gt;</span><br><span class="line">          &lt;button onClick=&#123;()=&gt;setCount(count+1)&#125; className=&quot;App-button&quot;  &gt;ç‚¹å‡»&lt;/button&gt;</span><br><span class="line"></span><br><span class="line">          &#123;/* useReducer demo */&#125;</span><br><span class="line">          &lt;p&gt;reducer count:&#123;state.count&#125;&lt;/p&gt;</span><br><span class="line">          &lt;div  className=&quot;App-button-group&quot; &gt;</span><br><span class="line">            &lt;button  onClick=&#123;()=&gt;dispatch(&#123;type: &apos;increment&apos;&#125;)&#125; &gt;increment&lt;/button&gt;</span><br><span class="line">            &lt;button  onClick=&#123;()=&gt;dispatch(&#123;type: &apos;decrement&apos;&#125;)&#125; &gt;decrement&lt;/button&gt;</span><br><span class="line">            &lt;button  onClick=&#123;()=&gt;dispatch(&#123;type: &apos;reset&apos;&#125;)&#125; &gt;reset&lt;/button&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">          &#123;/* useEffect demo */&#125;</span><br><span class="line">          &lt;p&gt;å½“å‰å±å¹•å®½åº¦ï¼š&#123;innerWidth&#125;&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">          &#123;/* useRef demo */&#125;</span><br><span class="line">          &lt;p&gt;</span><br><span class="line">          useRef: &lt;input type=&apos;text&apos; ref=&#123;inputEl&#125;/&gt;&lt;button onClick=&#123;focusHandle&#125;&gt;æœç´¢&lt;/button&gt;</span><br><span class="line">          &lt;/p&gt;</span><br><span class="line">          </span><br><span class="line">          &#123;/* useContext demo */&#125;</span><br><span class="line">          &lt;a</span><br><span class="line">            className=&quot;App-link&quot;</span><br><span class="line">            href=&quot;https://reactjs.org&quot;</span><br><span class="line">            target=&quot;_blank&quot;</span><br><span class="line">            rel=&quot;noopener noreferrer&quot;</span><br><span class="line">            style=&#123;&#123;color:color&#125;&#125;</span><br><span class="line">          &gt;</span><br><span class="line">            Learn React</span><br><span class="line">          &lt;/a&gt;</span><br><span class="line">        &lt;/header&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">	);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default App</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/05/Reduxæºç åˆ†æ/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/05/Reduxæºç åˆ†æ/" itemprop="url">Reduxæºç åˆ†æ</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-11-05T20:24:30+08:00">
                2018-11-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æŠ›å¼€Reactä¸è°ˆï¼ŒReduxå…¶å®å°±åªæ˜¯ä¸€ä¸ªç®¡ç†çŠ¶æ€çš„æ•°æ®ä¸­å¿ƒï¼Œç„¶è€Œä½œä¸ºä¸€ä¸ªæ•°æ®ä¸­å¿ƒå®ƒçš„ç‰¹è‰²åœ¨äºæˆ‘ä»¬ä¸èƒ½å¤Ÿç›´æ¥ä¿®æ”¹æ•°æ®ä¸­å¿ƒé‡Œé¢çš„æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦è‡ªè¡Œå®šä¹‰æ“ä½œé€»è¾‘<code>reducer</code>ï¼Œä»¥åŠæ“ä½œç±»å‹<code>action</code>,é€šè¿‡åˆ†å‘ä¸åŒçš„<code>action</code>æ¥åŒ¹é…<code>reducer</code>é‡Œé¢å¯¹åº”çš„æ“ä½œï¼Œæ‰èƒ½è¾¾åˆ°ä¿®æ”¹æ•°æ®çš„ç›®çš„ã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´æˆ‘ä»¬ä¼šé€šè¿‡ä»¥ä¸‹æ–¹å¼æ¥åˆ›å»ºä¸€ä¸ªæ•°æ®ä¸­å¿ƒ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import &#123; createStore &#125; from&apos;redux&apos;</span><br><span class="line">const store = createStore(...blablabla)</span><br></pre></td></tr></table></figure></p>
<p>è¿™é‡Œæœ€ä¸ºå…³é”®çš„å°±æ˜¯<code>createStore</code>è¿™ä¸ªå‡½æ•°ï¼Œæ¥ä¸‹æ¥æˆ‘æƒ³è¯¦ç»†åœ°å¯¹å®ƒåšä¸ªåˆ†æã€‚</p>
<h2 id="createStoreæ–¹æ³•å‰–æ"><a href="#createStoreæ–¹æ³•å‰–æ" class="headerlink" title="createStoreæ–¹æ³•å‰–æ"></a>createStoreæ–¹æ³•å‰–æ</h2><p>createStore.jsè¿™ä¸ªæ–‡ä»¶çº¯ä»£ç çš„éƒ¨åˆ†å¤§æ¦‚æœ‰100å¤šè¡Œï¼Œå¦‚æœæŠŠä»–ä»¬å…¨éƒ¨è´´å‡ºæ¥å†ä¸€ä¸€åˆ†æå¹¶éæ˜æ™ºä¹‹ä¸¾ï¼Œæˆ‘è®¤ä¸ºåªå¯¹å…³é”®çš„éƒ¨åˆ†è¿›è¡Œåˆ†ææ˜¯æ›´æ°å½“çš„åšæ³•ã€‚<br><strong>è¦åˆ†æä¸€ä¸ªæ–¹æ³•æˆ‘è§‰å¾—æ¯”è¾ƒæœ‰æ„ä¹‰çš„æ˜¯çœ‹å®ƒæ¥æ”¶äº†ä»€ä¹ˆï¼Œä»¥åŠè¿”å›äº†ä»€ä¹ˆã€‚</strong></p>
<h3 id="æ¥æ”¶çš„å‚æ•°"><a href="#æ¥æ”¶çš„å‚æ•°" class="headerlink" title="æ¥æ”¶çš„å‚æ•°"></a>æ¥æ”¶çš„å‚æ•°</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export default function createStore(reducer, preloadedState, enhancer) &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ–¹æ³•æ¥å—ä¸‰ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯<code>reducer</code>, <code>preloadedState</code>, <code>enhancer</code>ã€‚ä»¥ä¸Šéƒ½åˆ†åˆ«å¯ä»¥ç”±å¼€å‘è€…è¿›è¡Œå®šä¹‰ï¼Œ<code>reducer</code>å°±æ˜¯ç”±å¼€å‘è€…å®šä¹‰çš„ä¸€ä¸ªæ“ä½œæ–¹æ³•ï¼Œå®ƒä¼šä»¥æ—§çš„çŠ¶æ€ä½œä¸ºå‚æ•°ï¼Œå¤„ç†è¿‡åè¿”å›ä¸€ä¸ªæ–°çš„çŠ¶æ€ã€‚<code>preloadedState</code>åˆ™å¯ä»¥ç†è§£æˆæ•°æ®ä¸­å¿ƒçš„åˆå§‹çŠ¶æ€ï¼Œå®ƒæ˜¯ä¸ªå¯é€‰å€¼ã€‚</p>
<p>æœ€åçš„<code>enhancer</code>åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä»å­—é¢ä¸Šç†è§£å®ƒæ˜¯ä¸€ä¸ªå¢å¼ºå™¨ï¼Œç”¨äºå¢å¼º<code>createStore</code>ã€‚ä»æºç çœ‹å®ƒçš„å·¥ä½œæ–¹å¼<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">export default function createStore(reducer, preloadedState, enhancer) &#123;</span><br><span class="line">  .....</span><br><span class="line">  if (typeof preloadedState === &apos;function&apos; &amp;&amp; typeof enhancer === &apos;undefined&apos;) &#123; // å‚æ•°å½’ä¸€</span><br><span class="line">    enhancer = preloadedState</span><br><span class="line">    preloadedState = undefined</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  if (typeof enhancer !== &apos;undefined&apos;) &#123;</span><br><span class="line">    if (typeof enhancer !== &apos;function&apos;) &#123;</span><br><span class="line">      throw new Error(&apos;Expected the enhancer to be a function.&apos;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return enhancer(createStore)(reducer, preloadedState) // ç›´æ¥è¿”å›ä¸€ä¸ªå¢å¼ºåçš„`createStore</span><br><span class="line">  &#125;</span><br><span class="line">  .....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å¯è§ï¼Œå®ƒæ¥æ”¶äº†åŸæ¥çš„<code>createStore</code>ä½œä¸ºå‚æ•°ï¼Œå¹¶ä¸”è¿”å›äº†ä¸€ä¸ªå¢å¼ºäº†çš„æ–¹æ³•ï¼Œæœ€åç”¨å¢å¼ºè¿‡çš„æ–¹æ³•æ¥è°ƒç”¨åŸæ¥ä¼ å…¥çš„å‚æ•°ã€‚äº†è§£åŸç†ä¹‹åæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°å†™å‡ºä¸€ä¸ª<code>çŠ¶æ€æ‰“å°å¢å¼ºå™¨</code>ï¼Œç”¨äºæ‰“å°<code>dispatch</code>å‰åçš„çŠ¶æ€ä¿¡æ¯ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">.....</span><br><span class="line">function enhancer(createStore) &#123;</span><br><span class="line">  return (reducer, initialState, enhancer) =&gt; &#123;</span><br><span class="line">    const store = createStore(reducer, initialState, enhancer)</span><br><span class="line"></span><br><span class="line">    function dispatch(action) &#123;</span><br><span class="line">      console.log(&apos;old&apos;, store.getState())</span><br><span class="line">      const res = store.dispatch(action);</span><br><span class="line">      console.log(&apos;new&apos;, store.getState())</span><br><span class="line">      return res</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // ç”¨å¿ƒçš„dispatchæ–¹æ³•æ¥æ›¿æ¢åŸæœ‰çš„dispatchæ–¹æ³•</span><br><span class="line">    return &#123;</span><br><span class="line">      ...store,</span><br><span class="line">      dispatch</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const store = createStore(reducers, undefined, enhancer)</span><br></pre></td></tr></table></figure></p>
<p>å¦å¤–ï¼Œä»Reduxçš„æºç å¯ä»¥çœ‹åˆ°<code>createStore</code>åšäº†ä¸€ç§å«åšå‚æ•°å½’ä¸€çš„å¤„ç†ï¼Œåœ¨è®¸å¤šJSåº“ä¸­éƒ½ä¼šé‡‡ç”¨è¿™ç§æ–¹å¼å…¼å®¹ä¸åŒæƒ…å†µä¸‹çš„å‚æ•°ä¼ å…¥ã€‚å½“æˆ‘ä»¬ä¸éœ€è¦ä¼ å…¥åˆå§‹çŠ¶æ€ï¼Œè€Œåªéœ€è¦ä½¿ç”¨<code>enhancer</code>å¢å¼ºå™¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æŠŠä»£ç å†™æˆè¿™æ ·<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const store = createStore(reducers, enhancer)</span><br></pre></td></tr></table></figure></p>
<h3 id="2-è¿”å›å€¼"><a href="#2-è¿”å›å€¼" class="headerlink" title="2) è¿”å›å€¼"></a>2) è¿”å›å€¼</h3><p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹è¿”å›å€¼ã€‚<code>createStore</code>æœ€ç»ˆä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«çš„ä¸œè¥¿å¦‚ä¸‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import $$observable from &apos;symbol-observable&apos;</span><br><span class="line"></span><br><span class="line">export default function createStore(reducer, preloadedState, enhancer) &#123;</span><br><span class="line">  .....</span><br><span class="line">  return &#123;</span><br><span class="line">    dispatch,</span><br><span class="line">    subscribe,</span><br><span class="line">    getState,</span><br><span class="line">    replaceReducer,</span><br><span class="line">    [$$observable]: observable</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿™äº›ä¾¿æ˜¯æˆ‘ä»¬æ•°æ®ä¸­å¿ƒä¸ºå¤–éƒ¨æä¾›çš„å…¨éƒ¨æ¥å£äº†ã€‚æœ€åä¸€ä¸ªçœ‹èµ·æ¥æœ‰ç‚¹å¥‡æ€ªï¼Œå…¶ä»–çš„ä»å­—é¢ä¸Šåº”è¯¥éƒ½æ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œå®¹è®¸è®¸æˆ‘ä¸€ä¸€åˆ†æã€‚</p>
<h4 id="a-getStateâ€“è¿”å›å½“å‰çŠ¶æ€"><a href="#a-getStateâ€“è¿”å›å½“å‰çŠ¶æ€" class="headerlink" title="a. getStateâ€“è¿”å›å½“å‰çŠ¶æ€"></a>a. getStateâ€“è¿”å›å½“å‰çŠ¶æ€</h4><p>Reduxçš„æ ¸å¿ƒç†å¿µä¹‹ä¸€å°±æ˜¯ä¸æ”¯æŒç›´æ¥ä¿®æ”¹çŠ¶æ€ï¼Œå®ƒæ˜¯é€šè¿‡é—­åŒ…æ¥å®ç°è¿™ä¸€ç‚¹ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">export default function createStore(reducer, preloadedState, enhancer) &#123;</span><br><span class="line">  let currentState = preloadedState</span><br><span class="line"></span><br><span class="line">  function getState() &#123;</span><br><span class="line">    .....</span><br><span class="line">    return currentState</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å®ƒå…ˆæ˜¯å®šä¹‰äº†ä¸€ä¸ªå†…éƒ¨çš„å˜é‡<code>currentState</code>ï¼Œç„¶åé€šè¿‡ä¸€ä¸ªåä¸º<code>getState</code>çš„æ–¹æ³•æ¥è¿”å›å®ƒçš„å€¼ã€‚è¿™å°±é€ æˆäº†<code>currentState</code>è¿™ä¸ªçŠ¶æ€å¯¹æˆ‘ä»¬è€Œè¨€æ˜¯åªè¯»çš„ï¼Œæˆ‘ä»¬æ²¡åŠæ³•ç›´æ¥ä¿®æ”¹å®ƒçš„å€¼ã€‚åœ¨ä»£ç é‡Œé¢æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>getState</code>è¿™ä¸ªæ–¹æ³•æ¥è¿”å›å½“å‰çŠ¶æ€<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">console.log(store.getState())</span><br></pre></td></tr></table></figure></p>
<h4 id="b-subscribeâ€“æ„é€ ç›‘å¬è€…é˜Ÿåˆ—"><a href="#b-subscribeâ€“æ„é€ ç›‘å¬è€…é˜Ÿåˆ—" class="headerlink" title="b. subscribeâ€“æ„é€ ç›‘å¬è€…é˜Ÿåˆ—"></a>b. subscribeâ€“æ„é€ ç›‘å¬è€…é˜Ÿåˆ—</h4><p>æ¯ä¸ª<code>store</code>æœ¬èº«ä¼šç»´æŠ¤ä¸€ä¸ªç›‘å¬è€…é˜Ÿåˆ—ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªæ–¹æ³•çš„é˜Ÿåˆ—ï¼Œåœ¨æ¯æ¬¡åˆ†å‘<code>action</code>çš„æ—¶å€™éƒ½ä¼šä¾æ¬¡è°ƒç”¨ç›‘å¬è€…é˜Ÿåˆ—ä¸­æ‰€æœ‰æ–¹æ³•ã€‚é€šè¿‡è¿™ä¸ª<code>subscribe</code>æ–¹æ³•å¯ä»¥æ‰‹åŠ¨åœ°æŠŠä¸€äº›å›è°ƒå‡½æ•°æ·»åŠ åˆ°ç›‘å¬è€…é˜Ÿåˆ—ä¸­<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">export default function createStore(reducer, preloadedState, enhancer) &#123;</span><br><span class="line">  ....</span><br><span class="line"></span><br><span class="line">  let currentListeners = []</span><br><span class="line">  let nextListeners = currentListeners</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  function ensureCanMutateNextListeners() &#123;</span><br><span class="line">    if (nextListeners === currentListeners) &#123;</span><br><span class="line">      nextListeners = currentListeners.slice()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  function subscribe(listener) &#123;</span><br><span class="line">    .....</span><br><span class="line"></span><br><span class="line">    let isSubscribed = true</span><br><span class="line"></span><br><span class="line">    ensureCanMutateNextListeners()</span><br><span class="line">    nextListeners.push(listener)</span><br><span class="line"></span><br><span class="line">    return function unsubscribe() &#123;</span><br><span class="line">      if (!isSubscribed) &#123;</span><br><span class="line">        return</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      ....</span><br><span class="line"></span><br><span class="line">      isSubscribed = false</span><br><span class="line"></span><br><span class="line">      ensureCanMutateNextListeners()</span><br><span class="line">      const index = nextListeners.indexOf(listener)</span><br><span class="line">      nextListeners.splice(index, 1)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>é€»è¾‘å…¶å®å¾ˆç®€å•ï¼Œä¸ºäº†å‡å°‘ç¯‡å¹…æˆ‘æŠŠä¸€äº›ç±»å‹æ£€æŸ¥çš„ä»£ç å»æ‰äº†ã€‚æ¯æ¬¡è°ƒç”¨<code>subscribe</code>çš„æ—¶å€™ä¼ å…¥ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œ<code>subscribe</code>ä¼šæŠŠå®ƒæ”¾åˆ°ä¸€ä¸ªç›‘å¬è€…é˜Ÿåˆ—ä¸­å»ï¼Œå¹¶è¿”å›ä¸€ä¸ª<code>unsubscribe</code>çš„æ–¹æ³•ã€‚è¿™ä¸ª<code>unsubscribe</code>æ–¹æ³•æ˜¯è®©å¼€å‘è€…å¯ä»¥æ–¹ä¾¿åœ°ä»åˆ—è¡¨ä¸­åˆ é™¤å¯¹åº”çš„å›è°ƒå‡½æ•°ï¼Œæ­¤å¤–è¯¥æ–¹æ³•è¿˜ç»´æŠ¤ç€ä¸€ä¸ª<code>isSubscribed</code>æ ‡è¯†è®¢é˜…çŠ¶æ€ã€‚</p>
<p>è¿™é‡Œé¢æœ‰ä¸€ä¸ªæ¯”è¾ƒæœ‰æ„æ€çš„<code>ensureCanMutateNextListeners</code>çš„æ–¹æ³•ï¼ŒæŒ‰ç…§ä»£ç çš„é€»è¾‘ï¼Œå®ƒæ˜¯è¦ä¿è¯ç›‘å¬è€…çš„æ·»åŠ ä¸åˆ é™¤å¹¶ä¸åœ¨<code>currentListeners</code>è¿™ä¸ªåŸå§‹çš„é˜Ÿåˆ—é‡Œé¢è¿›è¡Œç›´æ¥æ“ä½œï¼Œæˆ‘ä»¬æ“ä½œçš„åªæ˜¯å®ƒçš„ä¸€ä¸ªå‰¯æœ¬ã€‚ç›´åˆ°æˆ‘ä»¬è°ƒç”¨<code>dispatch</code>æ–¹æ³•è¿›è¡Œåˆ†å‘çš„æ—¶å€™ï¼Œ<code>currentListeners</code>ä¸<code>nextListeners</code>æ‰ä¼šå†ä¸€æ¬¡æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªåœ¨åé¢çš„ä»£ç é‡Œé¢ä¼šçœ‹åˆ°ã€‚</p>
<h4 id="c-dispatchâ€“ä½è°ƒçš„actionåˆ†å‘è€…"><a href="#c-dispatchâ€“ä½è°ƒçš„actionåˆ†å‘è€…" class="headerlink" title="c. dispatchâ€“ä½è°ƒçš„actionåˆ†å‘è€…"></a>c. dispatchâ€“ä½è°ƒçš„actionåˆ†å‘è€…</h4><p><code>dispatch</code>æ–¹æ³•æ˜¯ç”¨æ¥åˆ†å‘<code>action</code>çš„ï¼Œå¯ä»¥æŠŠå®ƒç†è§£æˆç”¨äºè§¦å‘æ•°æ®æ›´æ–°çš„æ–¹æ³•ã€‚å®ƒçš„æ ¸å¿ƒå®ç°ä¹Ÿæ¯”è¾ƒç®€å•</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">export default function createStore(reducer, preloadedState, enhancer) &#123;</span><br><span class="line">  ...</span><br><span class="line">  function dispatch(action) &#123;</span><br><span class="line">    ....</span><br><span class="line"></span><br><span class="line">    // è°ƒç”¨reducer</span><br><span class="line">    try &#123;</span><br><span class="line">      isDispatching = true</span><br><span class="line">      currentState = currentReducer(currentState, action)</span><br><span class="line">    &#125; finally &#123;</span><br><span class="line">      isDispatching = false</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // è°ƒç”¨ç›‘å¬è€…</span><br><span class="line">    const listeners = (currentListeners = nextListeners)</span><br><span class="line">    for (let i = 0; i &lt; listeners.length; i++) &#123;</span><br><span class="line">      const listener = listeners[i]</span><br><span class="line">      listener()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return action</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä¾æ—§æŠŠä¸€äº›ç±»å‹æ£€æŸ¥çš„ä»£ç å»æ‰ï¼Œé¦–å…ˆ<code>dispatch</code>æ–¹æ³•ä¼šä»¥å½“å‰çš„çŠ¶æ€<code>currentState</code>ä»¥åŠæˆ‘ä»¬å®šä¹‰çš„åŠ¨ä½œ<code>action</code>ä½œä¸ºå‚æ•°æ¥è°ƒç”¨å½“å‰çš„<code>reducer</code>æ–¹æ³•ã€‚å¦å¤–å®ƒä½¿ç”¨<code>isDispatching</code>å˜é‡æ¥è®°å½•åˆ†å‘çš„çŠ¶æ€ï¼Œæ­£åœ¨åˆ†å‘åˆ™è®¾ç½®ä¸º<code>true</code>ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯æˆ‘ä»¬çš„<code>reducer</code>æ–¹æ³•å°†ä¼šè¢«è®¾ç½®æˆä¸€ä¸ª<strong>çº¯å‡½æ•°</strong>â€“å®ƒä¸ä¼šäº§ç”Ÿå‰¯ä½œç”¨ï¼Œå¹¶ä¸”å¯¹äºåŒæ ·çš„è¾“å…¥å®ƒä¼šè¿”å›åŒæ ·çš„è¾“å‡ºã€‚æ¢å¥è¯è¯´å®ƒä¸ä¼šç›´æ¥åœ¨åŸæ¥çŠ¶æ€çš„åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹ï¼Œè€Œæ˜¯ä¼šç›´æ¥è¿”å›ä¸€ä¸ªæ–°çš„çŠ¶æ€ï¼Œå¹¶å¯¹åŸæœ‰çŠ¶æ€è¿›è¡Œæ›¿æ¢ã€‚</p>
<p>å®Œæˆäº†ä¸Šé¢è¿™äº›ä¹‹åæˆ‘ä»¬ä¼šä¾æ¬¡éå†æ‰€æœ‰çš„ç›‘å¬è€…ï¼Œå¹¶ä¸”æ‰‹åŠ¨è°ƒç”¨æ‰€æœ‰çš„å›è°ƒå‡½æ•°ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ä¹‹å‰æœ‰è®²è¿‡çš„ï¼Œè®¢é˜…/å–æ¶ˆè®¢é˜…çš„æ—¶å€™æˆ‘ä»¬ä¼šç”Ÿæˆä¸€ä¸ª<code>currentLIsteners</code>çš„å‰¯æœ¬<code>nextListeners</code>å¹¶åœ¨å®ƒä¸Šé¢æ·»åŠ /åˆ é™¤å›è°ƒå‡½æ•°ã€‚ç„¶è€Œåˆ°äº†<code>dispatch</code>è¿™ä¸€æ­¥ä»–ä»¬ä¼šåšä¸€æ¬¡åŒæ­¥ï¼Œè¿™æ ·ä»–ä»¬å°±åˆä¼šæŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡äº†ã€‚</p>
<h4 id="d-replaceReducerâ€“æ›¿æ¢å½“å‰çš„reducer"><a href="#d-replaceReducerâ€“æ›¿æ¢å½“å‰çš„reducer" class="headerlink" title="d. replaceReducerâ€“æ›¿æ¢å½“å‰çš„reducer"></a>d. replaceReducerâ€“æ›¿æ¢å½“å‰çš„reducer</h4><p><code>replaceReducer</code>è¿™ä¸ªæ–¹æ³•åšçš„äº‹æƒ…å…¶å®å¾ˆç®€å•ï¼Œå®ƒå¯ä»¥ç”¨æ–°çš„<code>reducer</code>æ›¿æ¢æ‰å½“å‰çš„<code>reducer</code>ï¼Œå¹¶ä¸”åˆ†å‘ä¸€ä¸ªæ›¿æ¢çš„<code>action</code>ï¼Œä¸‹é¢æ˜¯æºä»£ç </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">export default function createStore(reducer, preloadedState, enhancer) &#123;</span><br><span class="line">  .....</span><br><span class="line">  function replaceReducer(nextReducer) &#123;</span><br><span class="line">    .....</span><br><span class="line"></span><br><span class="line">    currentReducer = nextReducer</span><br><span class="line">    dispatch(&#123; type: ActionTypes.REPLACE &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ®è¯´è¿™ç§æ–¹å¼åœ¨è°ƒè¯•ç¯å¢ƒä¸‹ä¼šç”¨å¾—æ¯”è¾ƒå¤šã€‚åœ¨æ­£å¼ç¯å¢ƒä¸‹ä¸€èˆ¬éƒ½ä¸ä¼šåœ¨ä¸­é€”æ›´æ›¿<code>reducer</code>ï¼Œä»¥å…å¾—å¢åŠ ç»´æŠ¤æˆæœ¬ã€‚</p>
<h4 id="e-observableâ€“è§‚å¯Ÿè€…"><a href="#e-observableâ€“è§‚å¯Ÿè€…" class="headerlink" title="e. observableâ€“è§‚å¯Ÿè€…"></a>e. observableâ€“è§‚å¯Ÿè€…</h4><p>è¿™ä¸ªæ˜¯æ¯”è¾ƒè®©æˆ‘è´¹è§£çš„ä¸€ä¸ªåŠŸèƒ½äº†ï¼Œç„¶è€ŒReduxçš„æ•°æ®ä¸­å¿ƒå±…ç„¶æŠŠå®ƒä½œä¸ºapiå¼€æ”¾å‡ºæ¥ï¼Œå’±é—¨å…ˆè´´æºç <br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">export default function createStore(reducer, preloadedState, enhancer) &#123;</span><br><span class="line">  ....</span><br><span class="line">  function observable() &#123;</span><br><span class="line">    const outerSubscribe = subscribe</span><br><span class="line">    return &#123;</span><br><span class="line">      ...</span><br><span class="line">      subscribe(observer) &#123;</span><br><span class="line">        ....</span><br><span class="line">        function observeState() &#123;</span><br><span class="line">          if (observer.next) &#123;</span><br><span class="line">            observer.next(getState())</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        observeState()</span><br><span class="line">        const unsubscribe = outerSubscribe(observeState)</span><br><span class="line">        return &#123; unsubscribe &#125;</span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">      [$$observable]() &#123;</span><br><span class="line">        return this</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å¦‚æœç›´æ¥è°ƒç”¨è¿™ä¸ªæ¥å£ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè€Œå¯¹è±¡é‡Œé¢åŒ…å«äº†<code>subscribe</code>æ–¹æ³•ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥æŠŠä¸€ä¸ªåŒ…å«<code>next</code>å­—æ®µ(å®ƒæ˜¯ä¸€ä¸ªå‡½æ•°)çš„å¯¹è±¡ä½œä¸º<code>subscribe</code>æ–¹æ³•çš„å‚æ•°ï¼Œå°±å¯ä»¥åœ¨æ¯æ¬¡æ•°æ®å˜åŠ¨çš„æ—¶å€™ä»¥<strong>å½“å‰çŠ¶æ€<code>getState()</code></strong>ä½œä¸ºå‚æ•°è°ƒç”¨<code>next</code>æ‰€æºå¸¦çš„å‡½æ•°ã€‚</p>
<p>è¿™ä¹ˆè¯´æœ‰ç‚¹æ‹—å£ï¼Œå¯èƒ½ç»™ä¸ªä¾‹å­ä¼šæ¯”è¾ƒç›´è§‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import $$observable from &apos;symbol-observable&apos;</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line">const store = createStore(reducer)</span><br><span class="line"></span><br><span class="line">const subObject = store[$$observable]()</span><br><span class="line">subObject.subscribe(&#123;</span><br><span class="line">  next: (a) =&gt; &#123;</span><br><span class="line">    console.log(a)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å°±å¯ä»¥åšåˆ°æ¯æ¬¡åŠ¨ä½œè¢«åˆ†å‘çš„æ—¶å€™éƒ½ä¼šè°ƒç”¨<code>next</code>æ‰€æºå¸¦çš„æ–¹æ³•ï¼Œå¹¶æ‰“å°å‡º<code>getState()</code>çš„å€¼ã€‚è¿™ç§è§‚å¯Ÿè€…æ¨¡å¼çš„å†™æ³•æœ‰ä»€ä¹ˆç‰¹æ®Šçš„æ„ä¹‰æˆ‘ä¹Ÿè¿˜æ²¡æœ‰æ—¶é—´å»æ·±ç©¶ï¼Œä¼¼ä¹æ˜¯<a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Ftc39%2Fproposal-observable" target="_blank" rel="noopener">è‰æ¡ˆ</a>çš„ä¸€éƒ¨åˆ†ï¼Œä¼°è®¡ç›®å‰ç”¨çš„ä¹Ÿä¸å¤šï¼Œå…ˆä¸æ·±å…¥æ¢ç©¶äº†ã€‚</p>
<hr>
<h2 id="1-ä¸­é—´ä»¶"><a href="#1-ä¸­é—´ä»¶" class="headerlink" title="1. ä¸­é—´ä»¶"></a>1. ä¸­é—´ä»¶</h2><p><img src="/2018/11/05/Reduxæºç åˆ†æ/1.jpg" alt=""><br>ä¸­é—´ä»¶è¿™ä¸ªæ¦‚å¿µå­˜åœ¨äºè®¸å¤šæµè¡Œçš„Webæ¡†æ¶ä¸­ï¼Œå¯ä»¥æŠŠå®ƒæƒ³è±¡æˆæ˜¯è¯·æ±‚/å“åº”åˆ†å‘çš„ä¸­é—´å±‚ï¼Œç”¨äºå¯¹è¯·æ±‚/å“åº”åšè¿›ä¸€æ­¥çš„å¤„ç†ï¼Œè€Œæ— éœ€æ”¹å˜åŸæœ‰çš„ä»£ç é€»è¾‘ã€‚åœ¨<code>node.js</code>ç¤¾åŒºçš„<a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fkoajs%2Fkoa" target="_blank" rel="noopener">KOA</a>è½»é‡çº§æ¡†æ¶å¾ˆå‡ºè‰²åœ°ä½“ç°äº†è¿™ä¸€ç‚¹(å½“ç„¶å®ƒè‚¯å®šä¸æ˜¯ç¬¬ä¸€ä¸ªè¿™æ ·å¹²çš„äºº)ã€‚koaæœ¬èº«åªæä¾›äº†æœ€åŸºç¡€çš„è¯·æ±‚/å“åº”åŠŸèƒ½ï¼Œå¦‚æœæƒ³è¦æ›´å¼ºå¤§çš„åŠŸèƒ½(æ¯”å¦‚è¯´æ—¥å¿—ï¼Œæ—¶é—´è®°å½•ç­‰åŠŸèƒ½)åˆ™éœ€è¦è‡ªå·±æ·»åŠ ç›¸åº”çš„ä¸­é—´ä»¶ã€‚</p>
<p>Reduxç»§æ‰¿äº†è¿™ä¸€ç†å¿µï¼Œå®ƒæŠŠä¸­é—´ä»¶åº”ç”¨åˆ°äº†<code>dispatch</code>æ–¹æ³•çš„æ‰©å±•ä¸­ï¼Œè®©æˆ‘ä»¬å¯ä»¥ä¼˜é›…åœ°æ‰©å±•<code>dispatch</code>æ–¹æ³•ï¼Œè€Œä¸éœ€è¦é‡å†™åŸæœ‰çš„<code>dispatch</code>æ–¹æ³•ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å¥½å¥½ä½“ä¼šä¸€ä¸‹å®ƒçš„ç²¾å¦™ä¹‹å¤„ã€‚</p>
<h2 id="2-ä¸­é—´ä»¶åœ¨Reduxä¸­çš„åº”ç”¨"><a href="#2-ä¸­é—´ä»¶åœ¨Reduxä¸­çš„åº”ç”¨" class="headerlink" title="2. ä¸­é—´ä»¶åœ¨Reduxä¸­çš„åº”ç”¨"></a>2. ä¸­é—´ä»¶åœ¨Reduxä¸­çš„åº”ç”¨</h2><p>åœ¨åˆ†ææºç ä¹‹å‰å…ˆæ¥çœ‹çœ‹åœ¨Reduxé‡Œé¢å¦‚ä½•ä½¿ç”¨ä¸­é—´ä»¶ï¼Œæœ€å…³é”®çš„æ˜¯<code>applyMiddleware</code>è¿™ä¸ªæ–¹æ³•<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import &#123; createStore, applyMiddleware &#125; from &apos;redux&apos;</span><br><span class="line">// Add thunk</span><br><span class="line">import thunk from &apos;redux-thunk&apos;</span><br><span class="line">import logger from &apos;redux-logger&apos;</span><br><span class="line"></span><br><span class="line">const reducer = (state) =&gt; state</span><br><span class="line"></span><br><span class="line">let newCreateStore = applyMiddleware(</span><br><span class="line">  logger,</span><br><span class="line">  thunk</span><br><span class="line">)(createStore)</span><br><span class="line"></span><br><span class="line">// åˆ›å»ºstoreï¼Œæ•°æ®ä¸­å¿ƒ</span><br><span class="line">let store = newCreateStore(reducer)</span><br></pre></td></tr></table></figure></p>
<p>å…¶ä¸­<code>thunk</code>è·Ÿ<code>logger</code>å°±æ˜¯æˆ‘ä»¬æåˆ°çš„ä¸­é—´ä»¶ï¼Œä¾æ¬¡æŠŠå®ƒä»¬ä¼ å…¥<code>applyMiddleware</code>å‡½æ•°ä¸­ï¼Œå°±ä¼šè¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œç„¶åå†ç”¨è¿™ä¸ªå‡½æ•°å¤„ç†åŸå§‹çš„<code>createStore</code>æ–¹æ³•å°±ä¼šè¿”å›ä¸€ä¸ªå¢å¼ºè¿‡çš„<code>createStore</code>æ–¹æ³•ã€‚</p>
<p>å¦å¤–ï¼Œè¿˜è®°å¾—<code>createStore</code>å‡½æ•°å¯ä»¥æ¥æ”¶<code>enhancer</code>è¿™ä¸ªå‚æ•°ä¸ï¼Ÿå…¶å®<code>applyMiddleware</code>è¿™ä¸ªæ–¹æ³•ç»è¿‡è°ƒç”¨åæ‰€å¾—åˆ°çš„å°±æ˜¯ä¸€ä¸ªå¢å¼ºå™¨ã€‚ä¸ºæ­¤æˆ‘ä»¬è¿˜å¯ä»¥è¿™æ ·è°ƒç”¨<code>createStore</code>ï¼Œå¹¶ç”Ÿæˆ<code>store</code>ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">....</span><br><span class="line">let enhancer = applyMiddleware(</span><br><span class="line">  logger,</span><br><span class="line">  thunk</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">let store = createStore(reducer, enhancer)</span><br></pre></td></tr></table></figure></p>
<p>è¿™ç§åšæ³•è·Ÿå‰é¢çš„æ‰©å±•æ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚</p>
<h2 id="3-æºç åˆ†æ"><a href="#3-æºç åˆ†æ" class="headerlink" title="3. æºç åˆ†æ"></a>3. æºç åˆ†æ</h2><h3 id="1-ä¸­é—´ä»¶åŸç†"><a href="#1-ä¸­é—´ä»¶åŸç†" class="headerlink" title="1) ä¸­é—´ä»¶åŸç†"></a>1) ä¸­é—´ä»¶åŸç†</h3><p>åœ¨æºç åˆ†æä¹‹å‰ï¼Œå…ˆä¸¾ä¸ªä¾‹å­æ¥çœ‹çœ‹ä¸€ä¸ªç®€å•çš„<code>ä¸­é—´ä»¶</code>å†…éƒ¨åº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Œæˆ‘åˆ†åˆ«å®šä¹‰<code>middleware1</code>ï¼Œ<code>middleware2</code>ä¸¤ä¸ªä¸­é—´ä»¶(ä»–ä»¬æœ¬è´¨æ˜¯é«˜é˜¶å‡½æ•°)ï¼Œå¹¶ç”¨æ¥æ‰©å±•<code>originDispatch</code>å‡½æ•°</p>
<pre><code>let originDispatch = (...args) =&gt; {
  console.log(...args)
}

const middleware1 = (dispatch) =&gt; {
  return(...args) =&gt; {
    console.log(&apos;middleware1 before dispatch&apos;)
    dispatch(...args)
    console.log(&apos;middleware1 after dispatch&apos;)
  }
}

const middleware2 = (dispatch) =&gt; {
  return(...args) =&gt; {
    console.log(&apos;middleware2 before dispatch&apos;)
    dispatch(...args)
    console.log(&apos;middleware2 before dispatch&apos;)
  }
}

originDispatch = middleware2(middleware1(originDispatch))
originDispatch(&apos;ruby&apos;, &apos;cool&apos;, &apos;language&apos;)
</code></pre><p>ç»“æœå¦‚ä¸‹</p>
<pre><code>middleware2 before dispatch
middleware1 before dispatch
ruby cool language
middleware1 after dispatch
middleware2 before dispatch
</code></pre><p>æ˜¯ä¸æ˜¯è¿è¡Œè¿‡ç¨‹æ˜¯ä¸æ˜¯æœ‰ç‚¹åƒæ´‹è‘±ï¼Ÿæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸­é—´ä»¶æ¥å¯¹åŸæœ‰çš„æ–¹æ³•è¿›è¡Œå¢å¼ºï¼Œå¹¶è¿”å›ä¸€ä¸ªå¢å¼ºäº†çš„æ–¹æ³•ï¼Œç„¶åå†ç”¨å¦ä¸€ä¸ªä¸­é—´ä»¶æ¥å¯¹è¿™ä¸ªå·²ç»å¢å¼ºè¿‡çš„æ–¹æ³•å†è¿›ä¸€æ­¥å¢å¼ºï¼Œæ¨¡å‹ç¤ºæ„å›¾å¦‚ä¸‹<br><img src="/2018/11/05/Reduxæºç åˆ†æ/164250984dffa839.webp" alt=""></p>
<h3 id="2-composeâ€“æ–¹æ³•å°é“¾è¾…åŠ©å‡½æ•°"><a href="#2-composeâ€“æ–¹æ³•å°é“¾è¾…åŠ©å‡½æ•°" class="headerlink" title="2) composeâ€“æ–¹æ³•å°é“¾è¾…åŠ©å‡½æ•°"></a>2) composeâ€“æ–¹æ³•å°é“¾è¾…åŠ©å‡½æ•°</h3><p>ä»ä¸Šé¢çš„æ´‹è‘±æ¨¡å‹å¯ä»¥çœ‹å‡ºæˆ‘ä»¬å¦‚æœè¦å¢å¼ºä¸€ä¸ªæ–¹æ³•ï¼Œå®ƒçš„æ­¥éª¤å¦‚ä¸‹</p>
<pre><code>newFunc = f1(f2(func))
</code></pre><p>å¯ä»¥ç®€å•åœ°æŠŠ<code>f1</code>,<code>f2</code>ç†è§£æˆæˆ‘ä»¬éœ€è¦å„è‡ªå®šä¹‰çš„ä¸­é—´ä»¶å‡½æ•°ï¼Œç„¶è€Œå¦‚æœæˆ‘ä»¬æ¯æ¬¡éƒ½è¦æ‰‹åŠ¨è°ƒç”¨è¿™äº›æ–¹æ³•çš„è¯ä¼¼ä¹å¹¶ä¸å¤ªä¼˜é›…ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨<a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Freduxjs%2Fredux%2Fblob%2Fmaster%2Fsrc%2Fcompose.js" target="_blank" rel="noopener">compose</a>å‡½æ•°æ¥å®Œæˆè¿™ç§äº‹æƒ…ã€‚</p>
<p><code>compose</code>åœ¨ä¸­æ–‡é‡Œé¢æ˜¯ç»„åˆçš„æ„æ€ï¼ŒReduxæ‰€å®šä¹‰çš„<code>compose</code>å‡½æ•°å¯ä»¥æŠŠå‡½æ•°çš„å‚æ•°åˆ—è¡¨æ„é€ æˆä¾æ¬¡è°ƒç”¨çš„å½¢å¼ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°ã€‚å®ƒçš„æºç å¦‚ä¸‹</p>
<pre><code>export default functioncompose(...funcs) {
  ...
  // ä»¥ä¸Šéƒ½æ˜¯åˆ¤æ–­
  return funcs.reduce((a, b) =&gt; (...args) =&gt; a(b(...args)))
}
</code></pre><p>æ–‡å­—è§£é‡Šå¯èƒ½è¿˜ä¸å¦‚æµç¨‹å›¾æ¥å¾—ç›´è§‚ï¼Œä¸‹é¢ç®€å•åœ°åˆ†æä¸€ä¸‹<code>compose(f1, f2, f3, f4)</code>çš„è°ƒç”¨è¿‡ç¨‹</p>
<pre><code>a: f1, b: f2, return: (...args) =&gt; f1(f2(...args))
a: (...args) =&gt; f1(f2(...args)), b: f3, return: (...args) =&gt; f1(f2(f3(...args)))
a: (...args) =&gt; f1(f2(f3(...args))), b: f4, return: (...args) =&gt; f1(f2(f3(f4(...args))))
</code></pre><p>æŠŠè¿™ä¸ªæ–¹æ³•åº”ç”¨åœ¨æœ€åˆçš„ä¾‹å­ä¸­</p>
<pre><code>&gt; newfunc = compose(middleware2, middleware1)(originDispatch)
[Function]
&gt; newfunc(&apos;node&apos;, &apos;good&apos;, &apos;languate&apos;)

middleware2 before dispatch
middleware1 before dispatch
node good languate
middleware1 after dispatch
middleware2 before dispatch
</code></pre><p>ç»“æœæ˜¯ä¸€æ ·çš„ã€‚è€Œä¸”ä»è¿™ä¸ªä¾‹å­è¿˜å¯ä»¥çœ‹å‡ºåœ¨<code>compose</code>å‡½æ•°çš„å‚æ•°åˆ—è¡¨ä¸­è¶Šé åçš„å‡½æ•°ï¼Œåœ¨æ„é€ å®Œæˆä¹‹åï¼Œè·ç¦»åŸå§‹å‡½æ•°å°±è¶Šè¿‘ã€‚</p>
<h3 id="3-applyMiddlewareâ€“æ”¶é›†ä¸­é—´ä»¶ï¼Œæ‰©å±•createStore"><a href="#3-applyMiddlewareâ€“æ”¶é›†ä¸­é—´ä»¶ï¼Œæ‰©å±•createStore" class="headerlink" title="3) applyMiddlewareâ€“æ”¶é›†ä¸­é—´ä»¶ï¼Œæ‰©å±•createStore"></a>3) applyMiddlewareâ€“æ”¶é›†ä¸­é—´ä»¶ï¼Œæ‰©å±•createStore</h3><p>applyMiddleware.jsè¿™ä¸ªæ–‡ä»¶é‡Œé¢å°±åŒ…å«ç€å®ƒçš„æºç </p>
<pre><code>export default function applyMiddleware(...middlewares) {
  return createStore =&gt; (...args) =&gt; {
    const store = createStore(...args)
    let dispatch = () =&gt; {
      throw new Error(
        `Dispatching while constructing your middleware is not allowed. ` +
          `Other middleware would not be applied to this dispatch.`
      )
    }

    const middlewareAPI = {
      getState: store.getState,
      dispatch: (...args) =&gt; dispatch(...args)
    }

    // #1 ä¸­é—´ä»¶åº”è¯¥æ¥æ”¶store
    const chain = middlewares.map(middleware =&gt; middleware(middlewareAPI))

    // #2 è¿”å›çš„å‡½æ•°ç”¨äºå¤„ç†dispatchå‡½æ•°
    dispatch = compose(...chain)(store.dispatch)

    // #3 æ›¿æ¢dispatchreturn {
      ...store,
      dispatch
    }
  }
}
</code></pre><p>ä»£ç ç‰‡æ®µ<code>#2</code>ä¸­æˆ‘ä»¬ä¼ å…¥<code>compose</code>å‡½æ•°é‡Œçš„æ‰€æœ‰å‡½æ•°éƒ½æ˜¯ç”¨äºæ‰©å±•<code>dispatch</code>çš„ï¼Œè¿™äº›å‡½æ•°ä¼šè¢«å®šä¹‰ä¸ºè¿™ç§å½¢å¼</p>
<pre><code>(dispatch) =&gt; {
  return function(...args) {
    // do something before
    dispatch(...args)
    // do something after
  }
}
</code></pre><p>è¿™äº›å‡½æ•°ä¼šæ¥æ”¶ä¸€ä¸ª<code>dispatch</code>æ–¹æ³•ä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªå¢å¼ºçš„<code>dispatch</code>æ–¹æ³•ã€‚ç„¶è€Œæˆ‘ä»¬éœ€è¦ç¼–å†™çš„ä¸­é—´ä»¶å´ä¸ä»…å¦‚æ­¤ï¼Œæ¥ä¸‹æ¥å†çœ‹çœ‹ä»£ç ç‰‡æ®µ<code>#1</code>ï¼Œä»¥åŠç›¸å…³çš„ä¸Šä¸‹æ–‡é€»è¾‘</p>
<pre><code>export default function applyMiddleware(...middlewares) {
  ....
  const middlewareAPI = {
    getState: store.getState,
    dispatch: (...args) =&gt; dispatch(...args)
  }

  // #1 ä¸­é—´ä»¶åº”è¯¥æ¥æ”¶store
  const chain = middlewares.map(middleware =&gt; middleware(middlewareAPI))

  // #2 è¿”å›çš„å‡½æ•°ç”¨äºå¤„ç†dispatchå‡½æ•°
  dispatch = compose(...chain)(store.dispatch)
  ...
}
</code></pre><p>æˆ‘ä»¬é€šè¿‡<code>map</code>æ–¹æ³•æ¥å¤„ç†<code>applyMiddleware</code>æ‰€æ¥æ”¶çš„æ‰€æœ‰ä¸­é—´ä»¶ï¼Œè®©ä»–ä»¬åˆ†åˆ«ä»¥<code>middlewareAPI</code>è¿™ä¸ªå¯¹è±¡ä½œä¸ºå‚æ•°è°ƒç”¨è¿‡åä¼šè¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°åˆ—è¡¨ï¼Œè€Œè¿™ä¸ªå‡½æ•°åˆ—è¡¨æ‰æ˜¯çœŸæ­£ç”¨æ¥å¢å¼º<code>dispatch</code>çš„ã€‚</p>
<p><code>middlewareAPI</code>æ˜¯ä»…ä»…åŒ…å«äº†<code>getState</code>ä¸<code>dispatch</code>è¿™ä¸¤ä¸ªå­—æ®µçš„å¯¹è±¡ï¼Œå¯ä»¥æŠŠå®ƒçœ‹æˆæ˜¯ä¸€ä¸ªç²¾ç®€ç‰ˆçš„<code>store</code>ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦ç¼–å†™çš„ä¸­é—´ä»¶åº”è¯¥æ˜¯ä»¥<code>store</code>ä½œä¸ºå‚æ•°ï¼Œå¹¶ä¸”è¿”å›ä¸€ä¸ªç”¨äºå¢å¼º<code>dispatch</code>æ–¹æ³•çš„å‡½æ•°ï¼Œè€Œè¿™ä¸ª<code>store</code>æˆ‘ä»¬åªèƒ½å¤Ÿä½¿ç”¨<code>getState</code>ï¼Œ<code>dispatch</code>è¿™ä¸¤ä¸ªæ¥å£ã€‚å¬èµ·æ¥æœ‰ç‚¹æ‹—å£ï¼Œä¸‹é¢æˆ‘ä»¬è‡ªè¡Œç¼–å†™ä¸€ä¸ªç”¨äºæ‰“å°çŠ¶æ€æ—¥å¿—çš„ä¸­é—´ä»¶ã€‚</p>
<pre><code>const Logger = (store) =&gt; (dispatch) =&gt; {
  return function(...args) {
    const wrappedDispatch = store.dispatch
    const getState = store.getState

    console.log(&apos;before dispatch&apos;, getState())
    dispatch(...args)
    console.log(&apos;after dispatch&apos;, getState())

    console.info(dispatch)
    console.info(wrappedDispatch)
  }
}
</code></pre><p>å…¶ä¸­<code>dispatch</code>ä¸<code>wrappedDispatch</code>æ‰€æŒ‡ä»£çš„åˆ†å‘æ–¹æ³•æ˜¯ä¸ä¸€æ ·çš„ã€‚</p>
<p><code>dispatch</code>æ˜¯ä»å‚æ•°ä¸­ä¼ å…¥ï¼Œå¦‚æœå½“å‰ä¸­é—´ä»¶æ˜¯ç¬¬ä¸€ä¸ªå¯¹<code>dispatch</code>æ–¹æ³•è¿›è¡Œå¢å¼ºçš„ä¸­é—´ä»¶ï¼Œåˆ™å½“å‰çš„<code>dispatch</code>æ‰€æŒ‡å‘çš„å°±æ˜¯ReduxåŸç”Ÿå®šä¹‰çš„<code>dispatch</code>æ–¹æ³•ã€‚å¦‚æœå½“å‰ä¸­é—´ä»¶å‰é¢å·²ç»æœ‰è‹¥å¹²ä¸­é—´ä»¶çš„è°ƒç”¨ï¼Œåˆ™å½“å‰<code>dispatch</code>æ‰€æŒ‡ä»£çš„æ˜¯ç»è¿‡å‰é¢ä¸­é—´ä»¶åŠ å¼ºè¿‡çš„æ–°çš„<code>dispatch</code>æ–¹æ³•ã€‚æˆ‘ä»¬å¯ä»¥æ¥éªŒè¯ä¸€ä¸‹</p>
<pre><code>let enhancer = applyMiddleware(
  Logger, // æˆ‘ä»¬è‡ªå·±ç¼–å†™çš„Logger
  thunk
)
</code></pre><p><code>dispatch</code>çš„æ‰“å°ç»“æœå¦‚ä¸‹</p>
<pre><code>Æ’(action) {
  if (typeof action === &apos;function&apos;) {
    return action(dispatch, getState, extraArgument);
  }

  return next(action);
}
</code></pre><p>å¯è§ï¼Œè¿™æ˜¯ä¸€ä¸ªç»è¿‡<code>thunk</code>ä¸­é—´ä»¶å¤„ç†åè¿”å›çš„æ–¹æ³•ã€‚</p>
<p><code>wrappedDispatch</code>å› ä¸ºåŒ¿åå‡½æ•°<code>(...args) =&gt; dispatch(...args)</code>çš„å…³ç³»ï¼Œåœ¨<code>applyMiddleware</code>å‡½æ•°è¿è¡Œå®Œæˆå¹¶è¿”å›ä¹‹åï¼ŒåŒ¿åå‡½æ•°å†…éƒ¨çš„<code>dispatch</code>ä¼šå§‹ç»ˆæŒ‡å‘ç»è¿‡æˆ‘ä»¬å¢å¼ºçš„<code>dispatch</code>æ–¹æ³•ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨ä¸­é—´ä»¶é‡Œé¢æ‰§è¡Œ<code>store.dispatch</code>å°±ä¼šå§‹ç»ˆè¿è¡Œæœ€å¤–å±‚çš„è¢«å¢å¼ºè¿‡çš„<code>dispatch</code>æ–¹æ³•ã€‚æ¨¡å‹å¦‚ä¸‹<br><img src="/2018/11/05/Reduxæºç åˆ†æ/2.webp" alt=""><br><code>wrappedDispatch</code>æ‰“å°ç»“æœè™½ç„¶çœ‹ä¸å‡ºä»€ä¹ˆï¼Œä½†æˆ‘ä¹Ÿé¡ºæ‰‹è´´ä¸€ä¸‹å§</p>
<pre><code>Æ’ dispatch() {
  return _dispatch.apply(undefined, arguments);
}
</code></pre><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹<code>applyMiddleware</code>çš„è¿”å›å€¼ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šä»¥<code>createStore</code>ä½œä¸ºå‚æ•°ï¼Œå¤„ç†è¿‡åè¿”å›ä¸€ä¸ªæ–°çš„<code>createStore</code>æ–¹æ³•ï¼Œå®ƒçš„æ¨¡å¼å¤§æ¦‚æ˜¯è¿™æ ·å­</p>
<pre><code>(createStore) =&gt; (...args) =&gt; {

  // createStoreæ–¹æ³•ç”¨æ¥åˆ›å»ºstore
  return {
    ...
    getState: ...
    dispatch: ...
  }
}
</code></pre><p>è€Œåœ¨<code>applyMiddleware</code>ä¸­å®é™…ä¸Šæˆ‘ä»¬åªéœ€è¦å¢å¼º<code>dispatch</code>æ–¹æ³•ï¼Œä¸ºæ­¤æˆ‘ä»¬åªéœ€è¦ç”¨æ–°çš„<code>dispatch</code>æ–¹æ³•æ¥æ›¿æ¢åŸæ¥çš„ä¾¿å¯ã€‚ä»£ç ç‰‡æ®µ<code>#3</code>å°±æ˜¯ç”¨æ–°çš„<code>dispatch</code>æ–¹æ³•å–ä»£åŸæ¥<code>store</code>ä¸­çš„<code>dispatch</code>æ–¹æ³•ã€‚</p>
<pre><code>....
    return {
      ...store,
      dispatch
    }
....
</code></pre><hr>
<h2 id="1-æ¨¡å—åŒ–reducer"><a href="#1-æ¨¡å—åŒ–reducer" class="headerlink" title="1. æ¨¡å—åŒ–reducer"></a>1. æ¨¡å—åŒ–reducer</h2><p>æˆ‘ä»¬å†™ä»£ç çš„æ—¶å€™ä¹Ÿæœ‰è¿™ç§æƒ…å†µ<strong>å½“ä¸€ä¸ªæ–‡ä»¶åŒ…å«çš„ä»£ç å¤ªå¤šçš„æ—¶å€™æˆ‘ä»¬ä¼šè€ƒè™‘æŒ‰é€»è¾‘æŠŠå®ƒä»¬æ‹†åˆ†æˆå‡ ä¸ªæ¨¡å—ï¼Œè€Œå½“æˆ‘ä»¬é‡åˆ°ä¸€äº›ç»†ç²’åº¦åŒç±»æ¨¡å—çš„é›†åˆæ—¶ï¼Œåˆ™ä¼šè€ƒè™‘æŠŠä»–ä»¬æ±‡æ€»ä¸ºä¸€ä¸ªçš„æ¨¡å—ã€‚</strong>è‡³äºä»€ä¹ˆæ—¶å€™è¯¥æ‹†ï¼Œä»€ä¹ˆæ—¶å€™è¯¥åˆï¼Œå¯èƒ½ä¸åŒçš„é¢†åŸŸè‡ªæœ‰å®ƒçš„æƒè¡¡æ–¹å¼ã€‚</p>
<p>ä»Šå¤©ä¸»è¦è°ˆè°ˆReduxé‡Œé¢å¦‚ä½•æ¨¡å—åŒ–ç®¡ç†å¤šä¸ªreducerå‡½æ•°ã€‚åœ¨Reduxåº”ç”¨é‡Œreducerå‡½æ•°å¯ä»¥ç†è§£æˆä¸€ä¸ªå¤„ç†çŠ¶æ€çš„å‡½æ•°ï¼Œå®ƒæ¥å—ä¸€ä¸ªçŠ¶æ€ï¼Œä»¥åŠä¸€ä¸ªåŠ¨ä½œï¼Œå¤„ç†ä¹‹åè¿”å›ä¸€ä¸ªæ›´æ–°åçš„çŠ¶æ€ã€‚ä¸€ä¸ªç®€å•çš„reducerå‡½æ•°å¤§æ¦‚å¦‚ä¸‹</p>
<pre><code>function reducerExample(state={}, action) {
  switch (action.type) {
    case&apos;INCREMENT&apos;:
      return Object.assign({}, state, {counter: state.counter + 1})
    case&apos;DECREMENT&apos;:
      return Object.assign({}, state, {counter: state.counter - 1})
    default:
      return state
  }
}
</code></pre><p>ç„¶è€Œè¿™ä¸ªå‡½æ•°æ‰€åŒ…å«çš„é€»è¾‘ä»…ä»…æ˜¯å¯¹çŠ¶æ€çš„<code>counter</code>å­—æ®µè¿›è¡ŒåŠ ä¸€ä»¥åŠå‡ä¸€æ“ä½œã€‚Reduxæ˜¯æ•°æ®ä¸­å¿ƒï¼Œå®ƒæ‰€ç®¡ç†çš„çŠ¶æ€å¯èƒ½ä¼šåŒ…å«å¾ˆå¤šä¸ªå­—æ®µï¼Œå½“å­—æ®µç›¸å½“å¤šçš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦åœ¨<code>reducerExample</code>å‡½æ•°ä¸­å®šä¹‰çš„æ“ä½œä¹Ÿä¼šæ¸æ¸å¤šèµ·æ¥</p>
<pre><code>function reducerExample(state={}, action) {
  switch (action.type) {
    case&apos;INCREMENT&apos;:
      return Object.assign({}, state, {counter: state.counter + 1})
    case&apos;DECREMENT&apos;:
      return Object.assign({}, state, {counter: state.counter - 1})
    case&apos;MULTI&apos;:
      return Object.assign({}, state, {otherCounter: state.otherCounter * 2})
    ....
    // æ­¤å¤„çœç•¥100è¡Œä»£ç 
    ....
    default:
      return state
  }
}
</code></pre><p>éšç€çŠ¶æ€è¶Šæ¥è¶Šå¤šï¼Œæ“ä½œå‡½æ•°ä¹Ÿå°†ä¼šè¶Šæ¥è¶Šå¤æ‚ï¼Œå•ä¸€çš„reducerå‡½æ•°å¹¶éé•¿ä¹…ä¹‹è®¡ã€‚è¿™ä¹Ÿæ˜¯Reduxä¸ºä½•æä¾›<code>combineReducers</code>çš„åŸå› ï¼Œå®ƒä½¿å¾—æˆ‘ä»¬å¯ä»¥ä»¥æ¨¡å—çš„æ–¹å¼æ¥ç®¡ç†å¤šä¸ªreducerå‡½æ•°ã€‚</p>
<p>ç®€å•è®²è§£è¯¥å‡½æ•°çš„ä½¿ç”¨ï¼Œå‡è®¾Reduxç®¡ç†çš„åº”ç”¨çŠ¶æ€å¦‚ä¸‹</p>
<pre><code>{
  counter: 0,
  article: {
    title: &quot;&quot;,
    content: &quot;&quot;
  }
}
</code></pre><p>åˆ™æˆ‘ä»¬å¯ä»¥åˆ†åˆ«å®šä¹‰ä¸¤ä¸ªreducerå‡½æ•°<code>counterReducer</code>ä¸<code>articleReducer</code></p>
<pre><code>function counterReducer(counter=0, action) {
  ...
}


function articleReducer(article={}, action) {
  ...
}
</code></pre><p>åœ¨<code>counterReducer</code>é‡Œé¢åªå®šä¹‰ä¸<code>counter</code>å­—æ®µæœ‰å…³çš„æ•°æ®æ“ä½œï¼Œè€Œåœ¨<code>articleReducer</code>é‡Œé¢åªå®šä¹‰ä¸<code>article</code>å­—æ®µæœ‰å…³çš„æ•°æ®æ“ä½œï¼Œæœ€åé€šè¿‡<code>combineReducers</code>æ¥åˆå¹¶ä¸¤ä¸ªreducerå‡½æ•°ï¼Œå¹¶ç”Ÿæˆæ–°çš„å‡½æ•°<code>reducer</code>ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠè¿™ä¸ªæ–°çš„å‡½æ•°<code>reducer</code>ä¸ç³»ç»Ÿè¿›è¡Œé›†æˆå³å¯ã€‚</p>
<pre><code>const reducer = combineReducers({
  counter: counterReducer,
  article: articleReducer
})
</code></pre><p>æˆ‘ä»¬ç”šè‡³å¯ä»¥æŠŠ<code>counterReducer</code>ä¸<code>articleReducer</code>ä¸¤ä¸ªå‡½æ•°æ”¾åœ¨ä¸åŒçš„æ–‡ä»¶ä¸­ï¼Œç„¶ååœ¨åŒä¸€ä¸ªåœ°æ–¹æ±‡æ€»(é€šè¿‡<code>combineReducers</code>)ã€‚å½“æˆ‘ä»¬åˆ†å‘æŒ‡å®šçš„åŠ¨ä½œä¹‹ååªæœ‰å®šä¹‰äº†è¯¥åŠ¨ä½œçš„å‡½æ•°ä¼šæ”¹å˜å®ƒæ‰€å¯¹åº”å­—æ®µçš„çŠ¶æ€ä¿¡æ¯ã€‚</p>
<h2 id="2-æºç åˆ†æ"><a href="#2-æºç åˆ†æ" class="headerlink" title="2. æºç åˆ†æ"></a>2. æºç åˆ†æ</h2><p>æ¥ä¸‹æ¥åˆ†æä¸€ä¸‹<code>combineReducers</code>å‡½æ•°çš„å·¥ä½œåŸç†ã€‚<a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Freduxjs%2Fredux%2Fblob%2Fmaster%2Fsrc%2FcombineReducers.js" target="_blank" rel="noopener">combineReducers.js</a>è¿™ä¸ªæ–‡ä»¶ä»£ç åŠ æ³¨é‡Šå¤§æ¦‚100å¤šè¡Œï¼Œç„¶è€Œæˆ‘ä»¬çœŸæ­£éœ€è¦äº†è§£çš„æ ¸å¿ƒå°±ä»…ä»…æ˜¯è¯¥è„šæœ¬ä¸­éœ€è¦å¯¼å‡ºçš„<code>combineReducers</code>è¿™ä¸ªå‡½æ•°ï¼Œå…¶ä»–ä»£ç å¤§å¤šæ˜¯ç”¨äºæ–­è¨€ï¼Œæš‚ä¸”ç•¥è¿‡ä¸è°ˆã€‚</p>
<h3 id="1-æ”¶é›†reducers"><a href="#1-æ”¶é›†reducers" class="headerlink" title="1) æ”¶é›†reducers"></a>1) æ”¶é›†reducers</h3><p>æˆ‘ä»¬éƒ½çŸ¥é“å‡½æ•°æ¥æ”¶å¯¹è±¡çš„æ¯ä¸ªé”®æ‰€å¯¹åº”çš„å€¼éƒ½åº”è¯¥æ˜¯ä¸€ä¸ªå¯ä»¥ç”¨äºæ”¹å˜çŠ¶æ€çš„reducerå‡½æ•°ï¼Œä¸ºæ­¤æˆ‘ä»¬ä¼šå…ˆéå†<code>combineReducers</code>å‡½æ•°æ‰€æ¥æ”¶çš„å¯¹è±¡ï¼Œæ’é™¤å…¶ä¸­ä¸æ˜¯å‡½æ•°çš„å­—æ®µã€‚</p>
<pre><code>export default function combineReducers(reducers) {
  const reducerKeys = Object.keys(reducers)
  const finalReducers = {}
  for (let i = 0; i &lt; reducerKeys.length; i++) { // #1
    const key = reducerKeys[i]

    ....

    if (typeof reducers[key] === &apos;function&apos;) { // #2
      finalReducers[key] = reducers[key]
    }
  }

  ......
}
</code></pre><p>ä»£ç ç‰‡æ®µ<code>#1</code>éå†å‡½æ•°æ¥æ”¶çš„å¯¹è±¡çš„æ‰€æœ‰é”®ï¼Œä»£ç ç‰‡æ®µ<code>#2</code>åˆ¤æ–­è¯¥é”®åœ¨åŸå¯¹è±¡ä¸­æŒ‡å‘çš„å†…å®¹æ˜¯å¦æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚å¦‚æœæ˜¯å‡½æ•°çš„è¯ï¼Œåˆ™æŠŠè¯¥å‡½æ•°ä»¥åŒæ ·çš„é”®å­˜å‚¨åˆ°<code>finalReducers</code>è¿™ä¸ªå¯¹è±¡ä¸­ï¼Œç­‰å¾ªç¯ç»“æŸä»¥å<code>finalReducers</code>å¯¹è±¡çš„æ¯ä¸€ä¸ªé”®æ‰€å¯¹åº”çš„å€¼åˆ™éƒ½æ˜¯ä¸€ä¸ªå‡½æ•°äº†ã€‚</p>
<h3 id="2-è¿”å›ä¸€ä¸ªæ–°çš„reducerå‡½æ•°"><a href="#2-è¿”å›ä¸€ä¸ªæ–°çš„reducerå‡½æ•°" class="headerlink" title="2) è¿”å›ä¸€ä¸ªæ–°çš„reducerå‡½æ•°"></a>2) è¿”å›ä¸€ä¸ªæ–°çš„reducerå‡½æ•°</h3><p><code>combineReducers</code>å…¶å®æ˜¯ä¸€ä¸ªreducerå‡½æ•°çš„å·¥å‚ï¼Œåœ¨æ”¶é›†ä¸åŒæ¨¡å—çš„reducerå‡½æ•°ä¹‹åï¼Œå®ƒçš„è´£ä»»å°±æ˜¯è¿”å›ä¸€ä¸ªæ–°çš„reducerï¼Œè€Œè¿™ä¸ªæ–°çš„reducerå‡½æ•°èƒ½å¤Ÿè°ƒåº¦å…ˆå‰æ”¶é›†çš„æ‰€æœ‰reducerã€‚æˆ‘æŠŠåç»­æºç ä¸­çš„æ–­è¨€éƒ½å»æ‰ä¹‹åå°±å‰©ä¸‹ä¸‹åˆ—ä»£ç </p>
<pre><code>export default function combineReducers(reducers) {
  ...

  const finalReducerKeys = Object.keys(finalReducers) // # 1
    return function combination(state = {}, action) {
    .....

    let hasChanged = false
    const nextState = {}
    for (let i = 0; i &lt; finalReducerKeys.length; i++) {
      const key = finalReducerKeys[i]
      const reducer = finalReducers[key] // #2
      const previousStateForKey = state[key] // #3
      const nextStateForKey = reducer(previousStateForKey, action) // #4
      ....
      nextState[key] = nextStateForKey
      hasChanged = hasChanged || nextStateForKey !== previousStateForKey
    }
    return hasChanged ? nextState : state
  }
}
</code></pre><p>é¦–å…ˆä¼šåœ¨ä»£ç ç‰‡æ®µ<code>#1</code>è·å–å…ˆå‰è¿‡æ»¤å¥½çš„<code>finalReducers</code>å¯¹è±¡çš„æ‰€æœ‰é”®ï¼Œå¹¶å­˜å‚¨åˆ°<code>finalReducerKeys</code>ä¸­ã€‚ç„¶åå½“å‰å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªæ–°çš„reducerå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°èƒ½å¤Ÿè®¿é—®<code>finalReducers</code>å½¢æˆä¸€ä¸ªé—­åŒ…ã€‚</p>
<p>å½“è°ƒç”¨è¿™ä¸ªæ–°çš„reducerå‡½æ•°çš„æ—¶ï¼Œå®ƒä¼šéå†<code>finalReducerKeys</code>è¿™ä¸ªæ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªé”®ï¼Œåœ¨ä»£ç <code>#2</code>å¤„è·å–å½“å‰é”®æ‰€å¯¹åº”çš„reducerå‡½æ•°å¹¶å­˜å‚¨åˆ°å¸¸é‡<code>reducer</code>ï¼Œç„¶ååœ¨ä»£ç <code>#3</code>å¤„è·å–å½“å‰é”®æ‰€å¯¹åº”çš„çŠ¶æ€<code>previousStateForKey</code>ã€‚</p>
<p>æ¥ä¸‹æ¥åœ¨ä»£ç <code>#4</code>å¤„ä»¥å½“å‰çŠ¶æ€<code>previousStateForKey</code>ä»¥åŠ<code>action</code>ä½œä¸ºå‚æ•°æ¥è°ƒç”¨<code>reducer</code>å‡½æ•°ï¼Œè¿”å›è¯¥é”®æ‰€å¯¹åº”çš„æ–°çŠ¶æ€<code>nextStateForKey</code>ã€‚åœ¨æ¯æ¬¡è¿­ä»£ä¸­éƒ½ä¼šæŠŠå½“å‰é”®<code>key</code>ä½œä¸ºå­—æ®µï¼ŒæŠŠæ–°çš„çŠ¶æ€å­˜å‚¨åˆ°<code>nextState</code>è¿™ä¸ªå¯¹è±¡ä¸­å»ï¼Œå¾ªç¯ç»“æŸä¹‹åï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿä¿è¯<code>action</code>è¢«å……åˆ†è°ƒåº¦äº†ã€‚</p>
<p>å¦å¤–ï¼Œè¿˜è®°å¾—å’±é—¨ç¼–å†™reducerå‡½æ•°çš„æ—¶å€™ä¼šç»å¸¸ä½¿ç”¨è¿™ç§è¯­æ³•å—ï¼Ÿ</p>
<pre><code>Object.assign({}, state, {counter: state.counter + 1})
</code></pre><p>è¿™è¡¨æ˜äº†æˆ‘ä»¬ä¸ä¼šåœ¨åŸæ¥çš„<code>state</code>åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹æ“ä½œï¼Œè€Œæ˜¯ç”Ÿæˆäº†ä¸€ä¸ªæ–°çš„<code>state</code>ï¼ŒåŸç†å¤§æ¦‚å¦‚ä¸‹</p>
<pre><code>&gt; a = {}
{}
&gt; b = Object.assign(a, {counter: 1})
{ counter: 1 }
&gt; c = Object.assign({}, a, {counter: 1})
{ counter: 1 }
&gt; a === b
true
&gt; a === c
false
</code></pre><p>è€Œåœ¨Reduxä¸­ï¼Œæ­£å¸¸æƒ…å†µä¸‹å¦‚æœreduceræ–¹æ³•è¢«è°ƒç”¨åå¹¶æ²¡æœ‰äº§ç”Ÿæ–°çš„å¯¹è±¡ï¼Œè€Œåªæ˜¯åœ¨åŸæœ‰çš„å¯¹è±¡ä¸­è¿›è¡Œæ“ä½œçš„è¯ï¼Œåˆ™åœ¨ç»‘å®šç»„ä»¶çš„æ—¶å€™ï¼ŒçŠ¶æ€çš„ä¿®æ”¹å°†æœ‰å¯èƒ½ä¸ä¼šå¼•èµ·ç»„ä»¶çš„æ›´æ–°ã€‚reducerå‡½æ•°çš„å®šä½æ˜¯çº¯å‡½æ•°ï¼Œä¸åº”è¯¥é€ æˆä»»ä½•å‰¯ä½œç”¨ï¼Œä¸ºæ­¤ï¼Œreducerå‡½æ•°éƒ½åº”è¯¥è¦ç”Ÿæˆæ–°çš„å¯¹è±¡ã€‚</p>
<p>åœ¨<code>combineReducers</code>è¿™ä¸ªå‡½æ•°é‡Œä¹Ÿä¼šæœ‰ç›¸åº”çš„å¤„ç†ï¼Œè¿™é‡Œéœ€è¦ç€é‡å…³æ³¨<code>hasChanged</code>è¿™ä¸ªå˜é‡</p>
<pre><code>...
  return hasChanged ? nextState : state
...
</code></pre><p>å½“ä¸”ä»…å½“ï¼Œè¿™ä¸ªå˜é‡ä¸ºçœŸå€¼çš„æ—¶å€™æˆ‘ä»¬æ‰ä¼šè¿”å›æ–°çš„çŠ¶æ€ï¼Œä¸ç„¶çš„è¯ä¾æ—§è¿”å›åŸæœ‰çš„çŠ¶æ€ã€‚è¿™ä¸ª<code>hasChanged</code>æ˜¯ç”±ä»¥ä¸‹ä»£ç æ§åˆ¶çš„</p>
<pre><code>...
for (let i = 0; i &lt; finalReducerKeys.length; i++) {
  ....
  hasChanged = hasChanged || nextStateForKey !== previousStateForKey
}
</code></pre><p>ä¹Ÿå°±æ˜¯è¯´åœ¨æ‰€æœ‰çš„è¿­ä»£ä¸­è‡³å°‘æœ‰ä¸€æ¬¡è¿­ä»£ç¬¦åˆ<code>nextStateForKey !== previousStateForKey</code>è¿™ä¸ªæ¡ä»¶çš„æ—¶å€™(æ‰€å¯¹åº”çš„reducerè¿”å›äº†æ–°çš„å¯¹è±¡)<code>hasChanged</code>æ‰ä¼šä¸ºçœŸï¼Œæ–°çš„reducerå‡½æ•°æ‰ä¼šè¿”å›æ–°çš„çŠ¶æ€å¯¹è±¡<code>nextState</code>ã€‚å¦åˆ™å°†è¿”å›åŸæœ‰çš„çŠ¶æ€å¯¹è±¡<code>state</code>ï¼Œè¿™æ ·åœ¨ç»‘å®šReactç»„ä»¶çš„æ—¶å€™åˆ™æœ‰å¯èƒ½ä¼šå‡ºç°çŠ¶æ€æ•°æ®æ›´æ–°äº†ï¼Œç»„ä»¶å´æ²¡æœ‰å“åº”çš„æƒ…å†µã€‚</p>
<h2 id="ä¸ºä»€ä¹ˆRedux-éœ€è¦-reducersæ˜¯çº¯å‡½æ•°ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆRedux-éœ€è¦-reducersæ˜¯çº¯å‡½æ•°ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆRedux éœ€è¦ reducersæ˜¯çº¯å‡½æ•°ï¼Ÿ"></a><a href="http://localhost:4000/2018/07/31/%E4%B8%BA%E4%BB%80%E4%B9%88Redux-%E9%9C%80%E8%A6%81-reducers%E6%98%AF%E7%BA%AF%E5%87%BD%E6%95%B0%EF%BC%9F/" target="_blank" rel="noopener">ä¸ºä»€ä¹ˆRedux éœ€è¦ reducersæ˜¯çº¯å‡½æ•°ï¼Ÿ</a></h2><h2 id="1-ActionCreatoråˆ›å»ºåŠ¨ä½œ"><a href="#1-ActionCreatoråˆ›å»ºåŠ¨ä½œ" class="headerlink" title="1. ActionCreatoråˆ›å»ºåŠ¨ä½œ"></a>1. ActionCreatoråˆ›å»ºåŠ¨ä½œ</h2><p>åœ¨æ·±å…¥åˆ†ææºç ä¹‹å‰æˆ‘ä»¬å…ˆæ¥èŠèŠ<code>ActionCreator</code>ã€‚ä»å­—é¢ä¸Šç†è§£ï¼Œå®ƒæ˜¯ä¸€ä¸ªåŠ¨ä½œçš„åˆ›é€ è€…ï¼Œæˆ–è€…è¯´æ˜¯åŠ¨ä½œçš„å·¥å‚ã€‚å¦‚æœæˆ‘ä»¬æƒ³æ ¹æ®ä¸åŒçš„å‚æ•°æ¥ç”Ÿæˆä¸åŒæ­¥é•¿çš„è®¡æ•°å™¨åŠ¨ä½œï¼Œåˆ™å¯ä»¥æŠŠå·¥å‚å‡½æ•°å£°æ˜ä¸º</p>
<pre><code>const counterIncActionCreator = function(step) {
  return {
    type: &apos;INCREMENT&apos;,
    step: step || 1
  }
}
</code></pre><p>éšç€ä¸šåŠ¡é€»è¾‘è¶Šæ¥è¶Šå¤æ‚ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®šä¹‰æ›´åŠ å¤æ‚çš„å·¥å‚å‡½æ•°æ¥ç”Ÿæˆæ›´å¤šæ ·åŒ–çš„åŠ¨ä½œç±»å‹ã€‚</p>
<h2 id="2-bindActionCreatoré«˜é˜¶å‡½æ•°"><a href="#2-bindActionCreatoré«˜é˜¶å‡½æ•°" class="headerlink" title="2. bindActionCreatoré«˜é˜¶å‡½æ•°"></a>2. bindActionCreatoré«˜é˜¶å‡½æ•°</h2><p>ä»ä¸Šè¿°çš„ä¾‹å­å‡ºå‘ï¼Œå¦‚æœæˆ‘ä»¬æƒ³ç”Ÿäº§å‡ºä¸åŒæ­¥é•¿çš„è®¡æ•°å™¨åŠ¨ä½œï¼Œå¹¶åˆ†å‘ä»–ä»¬ï¼Œåˆ™éœ€è¦æŠŠä»£ç å†™æˆä¸‹é¢è¿™æ ·å­</p>
<pre><code>// ä¸ºäº†ç®€åŒ–ä»£ç æˆ‘æŠŠdispatchå‡½æ•°å®šä¹‰ä¸ºåªæœ‰æ‰“å°åŠŸèƒ½çš„å‡½æ•°
const dispatch = function(action) {
  console.log(action)
}

const action1 = counterIncActionCreator()
dispatch(action1) // { type: &apos;INCREMENT&apos;, step: 1 }

const action2 = counterIncActionCreator(2)
dispatch(action2) // { type: &apos;INCREMENT&apos;, step: 2 }

const action3 = counterIncActionCreator(3)
dispatch(action3) // { type: &apos;INCREMENT&apos;, step: 3 }
</code></pre><p>å¯è§æ¯æ¬¡åˆ†å‘åŠ¨ä½œä¹‹å‰æˆ‘ä»¬éƒ½å¾—æ‰‹åŠ¨è°ƒç”¨<code>counterIncActionCreator</code>æ¥ç”Ÿäº§ç›¸åº”çš„åŠ¨ä½œï¼Œè¿™ç§æ–¹å¼å¹¶ä¸æ˜¯é‚£ä¹ˆçš„ä¼˜é›…ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥é‡‡ç”¨<a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Freduxjs%2Fredux%2Fblob%2Fmaster%2Fsrc%2FbindActionCreators.js" target="_blank" rel="noopener">bindActionCreators</a>è¿™ä¸ªæ–‡ä»¶é‡Œé¢çš„<code>bindActionCreator</code>å·¥å…·å‡½æ•°æ¥ä¼˜åŒ–ä»£ç äº†ï¼Œè¯¥å‡½æ•°çš„æºç å¦‚ä¸‹</p>
<pre><code>function bindActionCreator(actionCreator, dispatch) {
  return function() {
    return dispatch(actionCreator.apply(this, arguments))
  }
}
</code></pre><p><code>bindActionCreator</code>å°†ä¼šè¿”å›ä¸€ä¸ªæ–°å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¼šç”¨è‡ªèº«æ‰€æ¥æ”¶çš„å‚æ•°æ¥è°ƒç”¨<code>actionCreator</code>å¹¶ç”Ÿæˆå¯¹åº”åŠ¨ä½œï¼Œå¹¶ä¸”è¿™ä¸ªç”Ÿæˆçš„åŠ¨ä½œå°†ä¼šä½œä¸º<code>dispatch</code>å‡½æ•°çš„å‚æ•°ã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬æŠŠ</p>
<ol>
<li>ç”ŸæˆåŠ¨ä½œ</li>
<li>è°ƒåº¦åŠ¨ä½œ</li>
</ol>
<p>è¿™ä¸¤ä¸ªæ­¥éª¤éƒ½å°è£…åˆ°ä¸€ä¸ªå‡½æ•°é‡Œé¢äº†ï¼Œäºæ˜¯ä¾¿å¾—åˆ°äº†æ›´ä¸ºä¼˜é›…çš„è°ƒåº¦è¿‡ç¨‹</p>
<pre><code>...
const increment = bindActionCreator(counterIncActionCreator, dispatch)

increment() // { type: &apos;INCREMENT&apos;, step: 1 }

increment(2) // { type: &apos;INCREMENT&apos;, step: 2 }

increment(3) // { type: &apos;INCREMENT&apos;, step: 3 }
</code></pre><h2 id="3-bindActionCreators"><a href="#3-bindActionCreators" class="headerlink" title="3. bindActionCreators"></a>3. bindActionCreators</h2><p>æ¥ä¸‹æ¥çœ‹çœ‹<code>bindActionCreators</code>è¿™ä¸ªå‡½æ•°ï¼Œå®ƒæ˜¯<code>bindActionCreator</code>å‡½æ•°çš„åŠ å¼ºç‰ˆã€‚åˆ æ‰ä¸€äº›æ–­è¨€è¯­å¥ä¹‹åæºç å¦‚ä¸‹</p>
<pre><code>export default functionbindActionCreators(actionCreators, dispatch) {
  if (typeof actionCreators === &apos;function&apos;) { // #1
     return bindActionCreator(actionCreators, dispatch) // #2
  }

  ....

  const keys = Object.keys(actionCreators)
  const boundActionCreators = {}
  for (let i = 0; i &lt; keys.length; i++) {
    const key = keys[i]
    const actionCreator = actionCreators[key]
    if (typeof actionCreator === &apos;function&apos;) { // #3
      boundActionCreators[key] = bindActionCreator(actionCreator, dispatch)
    }
  }
  return boundActionCreators
}
</code></pre><p>ä»£ç <code>#1</code>çš„åˆ¤æ–­è¯­å¥æ˜¯ä¸ºäº†åšå…¼å®¹å¤„ç†ï¼Œå½“æ¥æ”¶çš„å‚æ•°<code>actionCreators</code>ä¸ºä¸€ä¸ªå‡½æ•°çš„æ—¶å€™ï¼Œåˆ™è®¤ä¸ºå®ƒæ˜¯å•ä¸€çš„åŠ¨ä½œå·¥å‚ï¼Œä¾¿åœ¨ä»£ç <code>#2</code>å¤„ç›´æ¥è°ƒç”¨<code>bindActionCreator</code>å·¥å…·å‡½æ•°æ¥å°è£…è°ƒåº¦è¿‡ç¨‹ã€‚</p>
<p>å¦ä¸€æƒ…å†µæ˜¯å½“<code>actionCreators</code>å‚æ•°æ˜¯ä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œåˆ™éå†è¿™ä¸ªå¯¹è±¡ã€‚ä»£ç <code>#3</code>ä¼šåˆ¤æ–­æ¯ä¸ªé”®åœ¨åŸå§‹å¯¹è±¡ä¸­çš„å€¼æ˜¯å¦æ˜¯ä¸ªå‡½æ•°ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªå‡½æ•°åˆ™è®¤ä¸ºå®ƒæ˜¯ä¸€ä¸ªåŠ¨ä½œå·¥å‚ï¼Œå¹¶ä½¿ç”¨<code>bindActionCreator</code>å‡½æ•°æ¥å°è£…è°ƒåº¦è¿‡ç¨‹ï¼Œæœ€åæŠŠç”Ÿæˆçš„æ–°å‡½æ•°ä»¥åŒæ ·çš„é”®<code>key</code>å­˜å‚¨åˆ°<code>boundActionCreators</code>å¯¹è±¡ä¸­ã€‚åœ¨å‡½æ•°çš„æœ«å°¾ä¼šè¿”å›<code>boundActionCreators</code>å¯¹è±¡ã€‚</p>
<p>ä¸¾ä¸ªç®€å•åº”ç”¨ä¾‹å­ï¼Œé¦–å…ˆä½¿ç”¨ä¸€ä¸ªå¯¹è±¡æ¥å­˜å‚¨ä¸¤ä¸ªäº‹ä»¶å·¥å‚</p>
<pre><code>const MyActionCreators = {
  increment: function(step) {
    return {
      type: &apos;INCREMENT&apos;,
      step: step || 1
    }
  },

  decrement: function(step) {
    return {
      type: &apos;DECREMENT&apos;,
      step: - (step || 1)
    }
  }
}
</code></pre><p>ç„¶åé€šè¿‡<code>bindActionCreators</code>æ¥å°è£…è°ƒåº¦è¿‡ç¨‹ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„å¯¹è±¡</p>
<pre><code>const dispatch = function(action) {
  console.log(action)
}

const MyNewActionCreators = bindActionCreators(MyActionCreators, dispatch)
</code></pre><p>æœ€åæˆ‘ä»¬ä¾¿å¯ä»¥ç”¨æ–°çš„å¯¹è±¡æ¥ä¸»å¯¼è°ƒåº¦è¿‡ç¨‹äº†</p>
<pre><code>MyNewActionCreators.increment() // { type: &apos;INCREMENT&apos;, step: 1 }
MyNewActionCreators.increment(2) // { type: &apos;INCREMENT&apos;, step: 2 }
MyNewActionCreators.increment(3) // { type: &apos;INCREMENT&apos;, step: 3 }
MyNewActionCreators.decrement() // { type: &apos;DECREMENT&apos;, step: -1 }
MyNewActionCreators.decrement(2) // { type: &apos;DECREMENT&apos;, step: -2 }
MyNewActionCreators.decrement(3) // { type: &apos;DECREMENT&apos;, step: -3 }
</code></pre><p>è¿™ç§è°ƒåº¦æ–¹å¼æ˜¾ç„¶æ¯”åŸå§‹çš„ä¾æ¬¡è°ƒç”¨çš„æ–¹å¼æ›´ä¸ºä¼˜é›…</p>
<pre><code>// åŸå§‹çš„è°ƒåº¦æ–¹å¼
dispatch(MyActionCreators.increment()) // { type: &apos;INCREMENT&apos;, step: 1 }
dispatch(MyActionCreators.increment(2)) // { type: &apos;INCREMENT&apos;, step: 2 }
dispatch(MyActionCreators.increment(3)) // { type: &apos;INCREMENT&apos;, step: 3 }
dispatch(MyActionCreators.decrement()) // { type: &apos;DECREMENT&apos;, step: -1 }
dispatch(MyActionCreators.decrement(2)) // { type: &apos;DECREMENT&apos;, step: -2 }
dispatch(MyActionCreators.decrement(3)) // { type: &apos;DECREMENT&apos;, step: -3 }
</code></pre><hr>
<h2 id="é‡ç‚¹è¯´è¯´redux-middleware"><a href="#é‡ç‚¹è¯´è¯´redux-middleware" class="headerlink" title="é‡ç‚¹è¯´è¯´redux middleware"></a>é‡ç‚¹è¯´è¯´redux middleware</h2><h3 id="middleware-çš„ç”±æ¥"><a href="#middleware-çš„ç”±æ¥" class="headerlink" title="middleware çš„ç”±æ¥"></a>middleware çš„ç”±æ¥</h3><p>åœ¨ä¸šåŠ¡ä¸­éœ€è¦æ‰“å°æ¯ä¸€ä¸ª action ä¿¡æ¯æ¥è°ƒè¯•ï¼Œåˆæˆ–è€…å¸Œæœ› dispatch æˆ– reducer æ‹¥æœ‰å¼‚æ­¥è¯·æ±‚çš„åŠŸèƒ½ã€‚é¢å¯¹è¿™äº›åœºæ™¯æ—¶ï¼Œä¸€ä¸ªä¸ªä¿®æ”¹ dispatch æˆ– reducer ä»£ç æœ‰äº›ä¹åŠ›ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¯ç»„åˆçš„ã€è‡ªç”±å¢å‡çš„æ’ä»¶æœºåˆ¶ï¼ŒRedux å€Ÿé‰´äº† Koa ä¸­ middleware çš„æ€æƒ³ï¼Œåˆ©ç”¨å®ƒæˆ‘ä»¬å¯ä»¥åœ¨å‰ç«¯åº”ç”¨ä¸­ä¾¿æ·åœ°å®ç°å¦‚æ—¥å¿—æ‰“å°ã€å¼‚æ­¥è¯·æ±‚ç­‰åŠŸèƒ½ã€‚<br><img src="/2018/11/05/Reduxæºç åˆ†æ/3.webp" alt=""></p>
<p>æ¯”å¦‚åœ¨é¡¹ç›®ä¸­ï¼Œè¿›è¡Œäº†å¦‚ä¸‹è°ƒç”¨åï¼Œredux å°±é›†æˆäº† thunk å‡½æ•°è°ƒç”¨ä»¥åŠæ‰“å°æ—¥å¿—çš„åŠŸèƒ½ã€‚</p>
<pre><code>import thunk from&apos;redux-thunk&apos;
import logger from&apos;../middleware/logger&apos;
const enhancer = applyMiddleware(thunk, logger),  // ä»¥ redux-thunkã€logger ä¸­é—´ä»¶ä¸ºä¾‹ä»‹ç»ä¸­é—´ä»¶çš„ä½¿ç”¨
const store = createStore(rootReducer, enhancer)
</code></pre><p>ä¸‹é¢è¿½æœ¬æº¯æºï¼Œæ¥åˆ†æä¸‹æºç ã€‚</p>
<h3 id="applyMiddleware-è°ƒç”¨å…¥å£"><a href="#applyMiddleware-è°ƒç”¨å…¥å£" class="headerlink" title="applyMiddleware è°ƒç”¨å…¥å£"></a>applyMiddleware è°ƒç”¨å…¥å£</h3><pre><code>export default function createStore(reducer, preloadedState, enhancer) {
  // é€šè¿‡ä¸‹é¢ä»£ç å¯ä»¥å‘ç°ï¼Œå¦‚æœ createStore ä¼ å…¥ 2 ä¸ªå‚æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°ç›¸å½“äºå°±æ˜¯ enhancer
  if (typeof preloadedState === &apos;function&apos; &amp;&amp; typeof enhancer === &apos;undefined&apos;) {
    enhancer = preloadedState
    preloadedState = undefined
  }
  if (typeof enhancer !== &apos;undefined&apos;) {
    return enhancer(createStore)(reducer, preloadedState)
  }
  ...
}
</code></pre><p>ç”±ä¸Šè¿° createStore å‘ç°ï¼ŒapplyMiddleware ä¼šè¿›è¡Œ <code>applyMiddleware(thunk, logger)(createStore)(reducer, preloadedState)</code> çš„è°ƒç”¨ã€‚</p>
<p>applyMiddleware æºç   å¦‚ä¸‹</p>
<pre><code>export default function applyMiddleware(...middlewares) {
  return createStore =&gt; (...args) =&gt; {
    const store = createStore(...args)
    let dispatch = store.dispatch
    let chain = []

    const middlewareAPI = {
      getState: store.getState,                // è°ƒç”¨ redux åŸç”Ÿæ–¹æ³•ï¼Œè·å–çŠ¶æ€
      dispatch: (...args) =&gt; dispatch(...args) // è°ƒç”¨ redux åŸç”Ÿ dispatch æ–¹æ³•
    }
    // ä¸²è¡Œ middleware
    chain = middlewares.map(middleware =&gt; middleware(middlewareAPI))
    dispatch = compose(...chain)(store.dispatch)

    return {
      ...store,
      dispatch // è¿”å›åŠ å·¥è¿‡çš„ dispatch
    }
  }
}
</code></pre><p>å¯ä»¥å‘ç° applyMiddleware çš„ä½œç”¨å…¶å®å°±æ˜¯è¿”å›åŠ å·¥è¿‡çš„ dispatchï¼Œä¸‹é¢ä¼šç€é‡åˆ†æ middlewares æ˜¯å¦‚ä½•ä¸²è¡Œèµ·æ¥çš„ä»¥åŠ dispatch æ˜¯å¦‚ä½•è¢«åŠ å·¥çš„ã€‚</p>
<h3 id="ä¸²è¡Œ-middleware"><a href="#ä¸²è¡Œ-middleware" class="headerlink" title="ä¸²è¡Œ middleware"></a>ä¸²è¡Œ middleware</h3><pre><code>const middlewareAPI = {
  getState: store.getState,
  dispatch: (...args) =&gt; dispatch(...args)
}
chain = middlewares.map(middleware =&gt; middleware(middlewareAPI))
dispatch = compose(...chain)(store.dispatch)
</code></pre><p>è§‚å¯Ÿä¸Šè¿°ä»£ç åå‘ç°æ¯ä¸ª middleware éƒ½ä¼šä¼ å…¥å‚æ•° middlewareAPIï¼Œæ¥çœ‹ä¸‹ä¸­é—´ä»¶ <a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2FMuYunyun%2FreactSPA%2Fblob%2F274c00870853638fb0f77df8497f911eb560b617%2Fsrc%2Fclient%2Fmiddleware%2Flogger.js%23L1" target="_blank" rel="noopener">logger çš„æºç </a> ä»¥åŠ <a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fgaearon%2Fredux-thunk%2Fblob%2Fmaster%2Fsrc%2Findex.js" target="_blank" rel="noopener">redux-thunk çš„æºç </a>, å‘ç°ä¸­é—´ä»¶æ¥å—çš„ç¬¬ä¸€ä¸ªå‚æ•°æ­£æ˜¯ ({ dispatch, getState })</p>
<pre><code>// logger æºç 
export default ({ dispatch, getState }) =&gt; next =&gt; action =&gt; {
  console.log(action)
  return next(action) // ç» compose æºç åˆ†æï¼Œæ­¤å¤„ next ä¸º Store.dispatch
}


// redux-thunk æºç 
export default ({ dispatch, getState }) =&gt; next =&gt; action =&gt; {
  if (typeof action === &apos;function&apos;) {
    return action(dispatch,getState);
  }
  //è¿™é‡Œå¯ä»¥ç†è§£ä¸ºdispatch(action),æœ¬è´¨ä¸Šå°±æ˜¯è°ƒç”¨ middleware é“¾ä¸­ä¸‹ä¸€ä¸ª middleware çš„ dispatchã€‚
  return next(action) // æ­¤å¤„ next ä¸º logger ä¸­é—´ä»¶è¿”å›çš„ (actionï¼‰ =&gt; {} å‡½æ•°
}

//ä½¿ç”¨redux-thunk
const store = createStore(  
  reducer,
  applyMiddleware(thunk)
);

//ç„¶åæˆ‘ä»¬å®ç°ä¸€ä¸ªthunkActionCreator
//è¿‡ä¸€ç§’åŠ 1
export function thunkActionCreator(payload){
    return function(dispatch,getState){
        setTimeout(function(){
            dispatch({type:types.INCREMENT,payload:payload});
        },1000);
    }
},

//æœ€åï¼Œåœ¨ç»„ä»¶ä¸­dispatch thunk
this.dispatch(thunkActionCreator(payload));


DEMO:
export const getNav = () =&gt; async (dispatch, getState) =&gt; {
    try {
        let response = await instance.get(`book/navigation`)
        await dispatch(receiveNav(response.data))
    } catch (error) {
        console.log(&apos;error: &apos;, error)
    }
  }
</code></pre><h3 id="dispatch-æ˜¯å¦‚ä½•è¢«åŠ å·¥çš„"><a href="#dispatch-æ˜¯å¦‚ä½•è¢«åŠ å·¥çš„" class="headerlink" title="dispatch æ˜¯å¦‚ä½•è¢«åŠ å·¥çš„"></a>dispatch æ˜¯å¦‚ä½•è¢«åŠ å·¥çš„</h3><p>æ¥ç€ä¸Šä¸ªå°èŠ‚ï¼Œåœ¨ <code>dispatch = compose(...chain)(store.dispatch)</code> ä¸­å‘ç°äº† compose å‡½æ•°ï¼Œæ¥çœ‹ä¸‹ compose çš„æºç  </p>
<pre><code>export default function compose(...funcs) {
  // ...
  return funcs.reduce((a, b) =&gt; (...args) =&gt; a(b(...args)))
}
</code></pre><p>compose æºç ä¸­çš„ <code>funcs.reduce((a, b) =&gt; (...args) =&gt; a(b(...args)))</code> ç®—æ˜¯æ¯”è¾ƒé‡è¦çš„ä¸€å¥ï¼Œå®ƒçš„ä½œç”¨æ˜¯è¿”å›ç»„åˆå‚æ•°åçš„å‡½æ•°ï¼Œæ¯”å¦‚ compose(f, g, h) ç­‰ä»·äº (â€¦args) =&gt; f(g(h(â€¦args)))ï¼Œæ•ˆæœå›¾å¦‚ä¸‹æ‰€ç¤ºï¼Œè°ƒç”¨ this.props.dispatch() åï¼Œä¼šè°ƒç”¨ç›¸åº”çš„ä¸­é—´ä»¶ï¼Œæœ€ç»ˆä¼šè°ƒç”¨ redux åŸç”Ÿçš„ store.dispatch()ï¼Œå¹¶ä¸”å¯ä»¥çœ‹åˆ°ä¸­é—´ä»¶è°ƒç”¨çš„å½¢å¼ç±»ä¼¼æ•°æ®ç»“æ„ä¸­çš„æ ˆ(å…ˆè¿›åå‡º)ã€‚<br><img src="/2018/11/05/Reduxæºç åˆ†æ/4.webp" alt=""><br>æ‹¿ä¸Šä¸ªå°èŠ‚æåˆ°çš„ loggerã€redux-thunk ä¸­é—´ä»¶ä¸ºä¾‹ï¼Œå…¶ middleware çš„å†…éƒ¨ä¸²è¡Œè°ƒç”¨æ–¹å¼å¦‚ä¸‹ï¼Œä»è€Œå®Œæˆäº† dispatch åŠŸèƒ½çš„å¢å¼º(æ”¯æŒå¦‚ <code>this.props.dispatch(func)</code> çš„è°ƒç”¨ä»¥åŠæ—¥å¿—åŠŸèƒ½)ã€‚å…·ä½“å¯ä»¥çœ‹ <a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2FMuYunyun%2FreactSPA%2Fblob%2F274c00870853638fb0f77df8497f911eb560b617%2Fsrc%2Fcommon%2Fpages%2Fmusic%2Findex.js%23L35" target="_blank" rel="noopener">é¡¹ç›®ä¸­çš„è¿ç”¨</a></p>
<pre><code>action =&gt; {
  if (typeof action === &apos;function&apos;) {
    return action(dispatch)
  }
  return (action =&gt; {
    console.log(action)
    return store.dispatch(action)
  })(action)
}
</code></pre><h3 id="redux-promise"><a href="#redux-promise" class="headerlink" title="redux-promise"></a>redux-promise</h3><p>redux-promiseä¹Ÿæ˜¯å»¶è¿Ÿæ‰§è¡Œçš„è¡¨è¾¾å¼ï¼Œå®ƒæ˜¯è§£å†³å¼‚æ­¥çš„å¦å¤–ä¸€ç§æ–¹æ¡ˆã€‚</p>
<p>redux-thunkå’Œæ ¸å¿ƒæ€æƒ³æ˜¯æŠŠactionå˜æˆthunkï¼Œè€Œredux-promiseçš„æ ¸å¿ƒæ€æƒ³æ˜¯è®©actionè¿”å›ä¸€ä¸ªpromiseå¯¹è±¡ã€‚</p>
<p>è¿™ä¸ªä¸­é—´ä»¶ä½¿å¾—store.dispatchæ–¹æ³•å¯ä»¥æ¥æ”¶Promiseå¯¹è±¡ä½œä¸ºå‚æ•°ã€‚è¿™æ—¶ ï¼Œaction æœ‰ä¸¤ç§å†™æ³•:</p>
<p>å†™æ³•ä¸€ã€è¿”å›å€¼æ˜¯ä¸€ä¸ªPromiseå¯¹è±¡ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function promiseIncrement(payload)&#123;</span><br><span class="line"> //  return &#123;type:types.INCREMENT,payload:payload&#125;  ä»¥å‰æ˜¯è¿™ç§å†™æ³•</span><br><span class="line">    return new Promise(function(resolve,reject)&#123;</span><br><span class="line">      setTimeout(function()&#123;</span><br><span class="line">        resolve(&#123;type:types.INCREMENT,payload:payload&#125;);</span><br><span class="line">      &#125;,1000);</span><br><span class="line">    &#125;);</span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure></p>
<p>å†™æ³•äºŒï¼Œaction å¯¹è±¡çš„payloadå±æ€§æ˜¯ä¸€ä¸ªPromiseå¯¹è±¡ï¼Œè¿™éœ€è¦ä»<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function payloadIncrement()&#123;</span><br><span class="line">    return &#123;</span><br><span class="line">        type:types.INCREMENT,</span><br><span class="line">        payload: new Promise(function(resolve,reject)&#123;</span><br><span class="line">            setTimeout(function()&#123;</span><br><span class="line">                if(Math.random()&gt;.5)&#123;</span><br><span class="line">                    resolve(100);</span><br><span class="line">                &#125;else&#123;</span><br><span class="line">                    reject(-100);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,1000)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹ redux-promiseæ˜¯æ€ä¹ˆå®ç°çš„ï¼Œå°±ä¼šæ˜ç™½å®ƒå†…éƒ¨æ˜¯æ€ä¹ˆæ“ä½œçš„.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">let promise = (&#123;dispatch,getState&#125;)=&gt;next=&gt;action=&gt;&#123;</span><br><span class="line">    if(action.then &amp;&amp; typeof action.then == &apos;function&apos;)&#123;</span><br><span class="line">        action.then(dispatch);</span><br><span class="line">        // è¿™é‡Œçš„dispatchå°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œdispatch(action)&#123;state:reducer(state,action)&#125;;</span><br><span class="line">    &#125;else if(action.payload&amp;&amp; action.payload.then&amp;&amp; typeof action.payload.then == &apos;function&apos;)&#123;</span><br><span class="line">        action.payload.then(payload=&gt;dispatch(&#123;...action,payload&#125;),payload=&gt;dispatch(&#123;...action,payload&#125;));</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        next(action);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœActionæœ¬èº«å°±æ˜¯ä¸€ä¸ªPromiseï¼Œå®ƒresolveä»¥åçš„å€¼åº”è¯¥æ˜¯ä¸€ä¸ªActionå¯¹è±¡ï¼Œä¼šè¢«dispatchæ–¹æ³•é€å‡ºaction.then(dispatch)ï¼›å¦‚æœActionå¯¹è±¡çš„ payloadå±æ€§æ˜¯ä¸€ä¸ªPromiseå¯¹è±¡ï¼Œé‚£ä¹ˆæ— è®ºresolveå’Œreject,dispatch æ–¹æ³•éƒ½ä¼šå‘å‡ºActionã€‚</p>
<h2 id="ç†è§£-funcs-reduce-a-b-gt-args-gt-a-b-args"><a href="#ç†è§£-funcs-reduce-a-b-gt-args-gt-a-b-args" class="headerlink" title="ç†è§£ funcs.reduce((a, b) =&gt; (args) =&gt; a(b(args)))"></a>ç†è§£ funcs.reduce((a, b) =&gt; (args) =&gt; a(b(args)))</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line"></span><br><span class="line">	&lt;head&gt;</span><br><span class="line">		&lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">		&lt;title&gt;&lt;/title&gt;</span><br><span class="line">	&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">	&lt;body&gt;</span><br><span class="line">		&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">			function originDispatch(...args) &#123;</span><br><span class="line">				console.log(...args)</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			function middleware1(dispatch) &#123;</span><br><span class="line">				return (...args) =&gt; &#123;</span><br><span class="line">					console.log(&apos;middleware1 before dispatch&apos;)</span><br><span class="line">					dispatch(...args)</span><br><span class="line">					console.log(&apos;middleware1 after dispatch&apos;)</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			function middleware2(dispatch) &#123;</span><br><span class="line">				return (...args) =&gt; &#123;</span><br><span class="line">					console.log(&apos;middleware2 before dispatch&apos;)</span><br><span class="line">					dispatch(...args)</span><br><span class="line">					console.log(&apos;middleware2 after dispatch&apos;)</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			function middleware3(dispatch) &#123;</span><br><span class="line">				return (...args) =&gt; &#123;</span><br><span class="line">					console.log(&apos;middleware3 before dispatch&apos;)</span><br><span class="line">					dispatch(...args)</span><br><span class="line">					console.log(&apos;middleware3 after dispatch&apos;)</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			//			originDispatch = middleware2(middleware1(originDispatch))</span><br><span class="line">			//			originDispatch(&apos;redux&apos;, &apos;is&apos;, &apos;cool&apos;);</span><br><span class="line"></span><br><span class="line">			function compose(...funcs) &#123;</span><br><span class="line">				return funcs.reduce((a, b) =&gt; (args) =&gt; a(b(args)))</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">            //console.log(compose(middleware2, middleware1))</span><br><span class="line">               //(args) =&gt; middleware2(middleware1(args))  </span><br><span class="line">               //(originDispatch)=&gt;middleware2(middleware1(originDispatch))  </span><br><span class="line">               </span><br><span class="line">			compose(middleware2, middleware1)(originDispatch)(&apos;redux&apos;, &apos;is&apos;, &apos;cool&apos;);</span><br><span class="line">			</span><br><span class="line">		&lt;/script&gt;</span><br><span class="line">	&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>compose(middleware2, middleware1)</code>è¿”å›<code>(args) =&gt; middleware2(middleware1(args))</code>;</li>
<li><code>compose(middleware2, middleware1)(originDispatch)</code> è¿”å›<code>middleware2(middleware1(originDispatch))</code></li>
<li>å°†<code>middleware1(originDispatch)</code>å½“åšä¸€ä¸ªæ•´ä½“,<code>middleware2(middleware1(originDispatch))</code>ä¸­çš„<code>middleware2</code>è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œç­‰ç€æ¥å—<code>...args</code>;å½“<code>compose(middleware2, middleware1)(originDispatch)(&#39;redux&#39;, &#39;is&#39;, &#39;cool&#39;)</code>,<code>...args</code>ä¸º<code>(&#39;redux&#39;, &#39;is&#39;, &#39;cool&#39;)</code>ã€‚</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/01/Koa2å¯¹MongoDBè¿æ¥çš„å•ä¾‹æ¨¡å¼çš„å°è£…/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/01/Koa2å¯¹MongoDBè¿æ¥çš„å•ä¾‹æ¨¡å¼çš„å°è£…/" itemprop="url">Koa2å¯¹MongoDBè¿æ¥çš„å•ä¾‹æ¨¡å¼çš„å°è£…</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-11-01T10:08:41+08:00">
                2018-11-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>å•ä¾‹æ¨¡å¼æ˜¯æœ€å¸¸ç”¨åˆ°çš„è®¾è®¡æ¨¡å¼ä¹‹ä¸€ï¼Œç†Ÿæ‚‰è®¾è®¡æ¨¡å¼çš„æœ‹å‹å¯¹å•ä¾‹æ¨¡å¼éƒ½ä¸ä¼šé™Œç”Ÿã€‚ä¸€èˆ¬ä»‹ç»å•ä¾‹æ¨¡å¼çš„ä¹¦ç±éƒ½ä¼šæåˆ° é¥¿æ±‰å¼ å’Œ æ‡’æ±‰å¼ è¿™ä¸¤ç§å®ç°æ–¹å¼ã€‚ä½†æ˜¯é™¤äº†è¿™ä¸¤ç§æ–¹å¼ï¼Œæœ¬æ–‡è¿˜ä¼šä»‹ç»å…¶ä»–å‡ ç§å®ç°å•ä¾‹çš„æ–¹å¼ï¼Œè®©æˆ‘ä»¬æ¥ä¸€èµ·çœ‹çœ‹å§ã€‚</p>
<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>å•ä¾‹æ¨¡å¼æ˜¯ä¸€ç§å¸¸ç”¨çš„è½¯ä»¶è®¾è®¡æ¨¡å¼ï¼Œå…¶å®šä¹‰æ˜¯å•ä¾‹å¯¹è±¡çš„ç±»åªèƒ½å…è®¸ä¸€ä¸ªå®ä¾‹å­˜åœ¨ã€‚</p>
<p>è®¸å¤šæ—¶å€™æ•´ä¸ªç³»ç»Ÿåªéœ€è¦æ‹¥æœ‰ä¸€ä¸ªçš„å…¨å±€å¯¹è±¡ï¼Œè¿™æ ·æœ‰åˆ©äºæˆ‘ä»¬åè°ƒç³»ç»Ÿæ•´ä½“çš„è¡Œä¸ºã€‚æ¯”å¦‚åœ¨æŸä¸ªæœåŠ¡å™¨ç¨‹åºä¸­ï¼Œè¯¥æœåŠ¡å™¨çš„é…ç½®ä¿¡æ¯å­˜æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œè¿™äº›é…ç½®æ•°æ®ç”±ä¸€ä¸ªå•ä¾‹å¯¹è±¡ç»Ÿä¸€è¯»å–ï¼Œç„¶åæœåŠ¡è¿›ç¨‹ä¸­çš„å…¶ä»–å¯¹è±¡å†é€šè¿‡è¿™ä¸ªå•ä¾‹å¯¹è±¡è·å–è¿™äº›é…ç½®ä¿¡æ¯ã€‚è¿™ç§æ–¹å¼ç®€åŒ–äº†åœ¨å¤æ‚ç¯å¢ƒä¸‹çš„é…ç½®ç®¡ç†ã€‚</p>
<h2 id="åŸºæœ¬çš„å®ç°æ€è·¯"><a href="#åŸºæœ¬çš„å®ç°æ€è·¯" class="headerlink" title="åŸºæœ¬çš„å®ç°æ€è·¯"></a>åŸºæœ¬çš„å®ç°æ€è·¯</h2><p>å•ä¾‹æ¨¡å¼è¦æ±‚ç±»èƒ½å¤Ÿæœ‰è¿”å›å¯¹è±¡ä¸€ä¸ªå¼•ç”¨(æ°¸è¿œæ˜¯åŒä¸€ä¸ª)å’Œä¸€ä¸ªè·å¾—è¯¥å®ä¾‹çš„æ–¹æ³•ï¼ˆå¿…é¡»æ˜¯é™æ€æ–¹æ³•ï¼Œé€šå¸¸ä½¿ç”¨<code>ES6 class static</code>è¿™ä¸ªå…³é”®å­—ï¼‰ã€‚</p>
<p>å•ä¾‹çš„å®ç°ä¸»è¦æ˜¯é€šè¿‡ä»¥ä¸‹ä¸¤ä¸ªæ­¥éª¤ï¼š</p>
<blockquote>
<p>å°†è¯¥ç±»çš„æ„é€ æ–¹æ³•å®šä¹‰ä¸ºç§æœ‰æ–¹æ³•ï¼Œè¿™æ ·å…¶ä»–å¤„çš„ä»£ç å°±æ— æ³•é€šè¿‡è°ƒç”¨è¯¥ç±»çš„æ„é€ æ–¹æ³•æ¥å®ä¾‹åŒ–è¯¥ç±»çš„å¯¹è±¡ï¼Œåªæœ‰é€šè¿‡è¯¥ç±»æä¾›çš„é™æ€æ–¹æ³•æ¥å¾—åˆ°è¯¥ç±»çš„å”¯ä¸€å®ä¾‹ï¼›</p>
</blockquote>
<blockquote>
<p>åœ¨è¯¥ç±»å†…æä¾›ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œå½“æˆ‘ä»¬è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ—¶ï¼Œå¦‚æœç±»æŒæœ‰çš„å¼•ç”¨ä¸ä¸ºç©ºå°±è¿”å›è¿™ä¸ªå¼•ç”¨ï¼Œå¦‚æœç±»ä¿æŒçš„å¼•ç”¨ä¸ºç©ºå°±åˆ›å»ºè¯¥ç±»çš„å®ä¾‹å¹¶å°†å®ä¾‹çš„å¼•ç”¨èµ‹äºˆè¯¥ç±»ä¿æŒçš„å¼•ç”¨ã€‚</p>
</blockquote>
<h2 id="å•ä¾‹æ¨¡å¼ç‰¹ç‚¹ï¼š"><a href="#å•ä¾‹æ¨¡å¼ç‰¹ç‚¹ï¼š" class="headerlink" title="å•ä¾‹æ¨¡å¼ç‰¹ç‚¹ï¼š"></a>å•ä¾‹æ¨¡å¼ç‰¹ç‚¹ï¼š</h2><p>1ã€å•ä¾‹ç±»åªèƒ½æœ‰ä¸€ä¸ªå®ä¾‹ã€‚<br>2ã€å•ä¾‹ç±»å¿…é¡»è‡ªå·±åˆ›å»ºè‡ªå·±çš„å”¯ä¸€å®ä¾‹ã€‚<br>3ã€å•ä¾‹ç±»å¿…é¡»ç»™æ‰€æœ‰å…¶ä»–å¯¹è±¡æä¾›è¿™ä¸€å®ä¾‹ã€‚</p>
<p>å•ä¾‹æ¨¡å¼ä¿è¯äº†å…¨å±€å¯¹è±¡çš„å”¯ä¸€æ€§ï¼Œæ¯”å¦‚ç³»ç»Ÿå¯åŠ¨è¯»å–é…ç½®æ–‡ä»¶å°±éœ€è¦å•ä¾‹ä¿è¯é…ç½®çš„ä¸€è‡´æ€§ã€‚</p>
<h2 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h2><p>ç³»ç»Ÿå†…å­˜ä¸­è¯¥ç±»åªå­˜åœ¨ä¸€ä¸ªå¯¹è±¡ï¼ŒèŠ‚çœäº†ç³»ç»Ÿèµ„æºï¼Œå¯¹äºä¸€äº›éœ€è¦é¢‘ç¹åˆ›å»ºé”€æ¯çš„å¯¹è±¡ï¼Œä½¿ç”¨å•ä¾‹æ¨¡å¼å¯ä»¥æé«˜ç³»ç»Ÿæ€§èƒ½ã€‚</p>
<h2 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h2><p>å½“æƒ³å®ä¾‹åŒ–ä¸€ä¸ªå•ä¾‹ç±»çš„æ—¶å€™ï¼Œå¿…é¡»è¦è®°ä½ä½¿ç”¨ç›¸åº”çš„è·å–å¯¹è±¡çš„æ–¹æ³•ï¼Œè€Œä¸æ˜¯ä½¿ç”¨newï¼Œå¯èƒ½ä¼šç»™å…¶ä»–å¼€å‘äººå‘˜é€ æˆå›°æ‰°ï¼Œç‰¹åˆ«æ˜¯çœ‹ä¸åˆ°æºç çš„æ—¶å€™ã€‚</p>
<h2 id="é€‚ç”¨åœºåˆ"><a href="#é€‚ç”¨åœºåˆ" class="headerlink" title="é€‚ç”¨åœºåˆ"></a>é€‚ç”¨åœºåˆ</h2><ul>
<li>éœ€è¦é¢‘ç¹çš„è¿›è¡Œåˆ›å»ºå’Œé”€æ¯çš„å¯¹è±¡ï¼›</li>
<li>åˆ›å»ºå¯¹è±¡æ—¶è€—æ—¶è¿‡å¤šæˆ–è€—è´¹èµ„æºè¿‡å¤šï¼Œä½†åˆç»å¸¸ç”¨åˆ°çš„å¯¹è±¡ï¼›</li>
<li>å·¥å…·ç±»å¯¹è±¡ï¼›</li>
<li>é¢‘ç¹è®¿é—®æ•°æ®åº“æˆ–æ–‡ä»¶çš„å¯¹è±¡ã€‚</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"></span><br><span class="line"> * http://mongodb.github.io/node-mongodb-native</span><br><span class="line"></span><br><span class="line"> * http://mongodb.github.io/node-mongodb-native/3.0/api/</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">//DBåº“</span><br><span class="line">var MongoDB=require(&apos;mongodb&apos;);</span><br><span class="line">var MongoClient =MongoDB.MongoClient;</span><br><span class="line">const ObjectID = MongoDB.ObjectID;</span><br><span class="line"></span><br><span class="line">var Config=require(&apos;./config.js&apos;);</span><br><span class="line"></span><br><span class="line">class Db&#123;</span><br><span class="line"></span><br><span class="line">    static getInstance()&#123;   /*1ã€å•ä¾‹  å¤šæ¬¡å®ä¾‹åŒ–å®ä¾‹ä¸å…±äº«çš„é—®é¢˜*/</span><br><span class="line"></span><br><span class="line">        if(!Db.instance)&#123;</span><br><span class="line">            Db.instance=new Db();</span><br><span class="line">        &#125;</span><br><span class="line">        return  Db.instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    constructor()&#123;</span><br><span class="line"></span><br><span class="line">        this.dbClient=&apos;&apos;; /*å±æ€§ æ”¾dbå¯¹è±¡*/</span><br><span class="line">        this.connect();   /*å®ä¾‹åŒ–çš„æ—¶å€™å°±è¿æ¥æ•°æ®åº“*/</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    connect()&#123;  /*è¿æ¥æ•°æ®åº“*/</span><br><span class="line">      let _that=this;</span><br><span class="line">      return new Promise((resolve,reject)=&gt;&#123;</span><br><span class="line">          if(!_that.dbClient)&#123;         /*1ã€è§£å†³æ•°æ®åº“å¤šæ¬¡è¿æ¥çš„é—®é¢˜*/</span><br><span class="line">              MongoClient.connect(Config.dbUrl,(err,client)=&gt;&#123;</span><br><span class="line"></span><br><span class="line">                  if(err)&#123;</span><br><span class="line">                      reject(err)</span><br><span class="line"></span><br><span class="line">                  &#125;else&#123;</span><br><span class="line"></span><br><span class="line">                      _that.dbClient=client.db(Config.dbName);</span><br><span class="line">                      resolve(_that.dbClient)</span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;)</span><br><span class="line"></span><br><span class="line">          &#125;else&#123;</span><br><span class="line">              resolve(_that.dbClient);</span><br><span class="line"></span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    find(collectionName,json)&#123;</span><br><span class="line"></span><br><span class="line">       return new Promise((resolve,reject)=&gt;&#123;</span><br><span class="line"></span><br><span class="line">            this.connect().then((db)=&gt;&#123;</span><br><span class="line"></span><br><span class="line">                var result=db.collection(collectionName).find(json);</span><br><span class="line"></span><br><span class="line">                result.toArray(function(err,docs)&#123;</span><br><span class="line"></span><br><span class="line">                    if(err)&#123;</span><br><span class="line">                        reject(err);</span><br><span class="line">                        return;</span><br><span class="line">                    &#125;</span><br><span class="line">                    resolve(docs);</span><br><span class="line">                &#125;)</span><br><span class="line"></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    update(collectionName,json1,json2)&#123;</span><br><span class="line">        return new Promise((resolve,reject)=&gt;&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                this.connect().then((db)=&gt;&#123;</span><br><span class="line"></span><br><span class="line">                    //db.user.update(&#123;&#125;,&#123;$set:&#123;&#125;&#125;)</span><br><span class="line">                    db.collection(collectionName).updateOne(json1,&#123;</span><br><span class="line">                        $set:json2</span><br><span class="line">                    &#125;,(err,result)=&gt;&#123;</span><br><span class="line">                        if(err)&#123;</span><br><span class="line">                            reject(err);</span><br><span class="line">                        &#125;else&#123;</span><br><span class="line">                            resolve(result);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;)</span><br><span class="line"></span><br><span class="line">                &#125;)</span><br><span class="line"></span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    insert(collectionName,json)&#123;</span><br><span class="line">        return new  Promise((resolve,reject)=&gt;&#123;</span><br><span class="line">            this.connect().then((db)=&gt;&#123;</span><br><span class="line"></span><br><span class="line">                db.collection(collectionName).insertOne(json,function(err,result)&#123;</span><br><span class="line">                    if(err)&#123;</span><br><span class="line">                        reject(err);</span><br><span class="line">                    &#125;else&#123;</span><br><span class="line"></span><br><span class="line">                        resolve(result);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    remove(collectionName,json)&#123;</span><br><span class="line"></span><br><span class="line">        return new  Promise((resolve,reject)=&gt;&#123;</span><br><span class="line">            this.connect().then((db)=&gt;&#123;</span><br><span class="line"></span><br><span class="line">                db.collection(collectionName).removeOne(json,function(err,result)&#123;</span><br><span class="line">                    if(err)&#123;</span><br><span class="line">                        reject(err);</span><br><span class="line">                    &#125;else&#123;</span><br><span class="line"></span><br><span class="line">                        resolve(result);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    getObjectId(id)&#123;    /*mongodbé‡Œé¢æŸ¥è¯¢ _id æŠŠå­—ç¬¦ä¸²è½¬æ¢æˆå¯¹è±¡*/</span><br><span class="line"></span><br><span class="line">        return new ObjectID(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">module.exports=Db.getInstance();</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/13/">13</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/tx.jpg"
                alt="ææ–Œ" />
            
              <p class="site-author-name" itemprop="name">ææ–Œ</p>
              <p class="site-description motion-element" itemprop="description">æƒ³è¦é£å¾—é«˜ï¼Œé‚£å°±æŠŠåœ°å¹³çº¿å¿˜æ‰</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">124</span>
                  <span class="site-state-item-name">æ—¥å¿—</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">103</span>
                  <span class="site-state-item-name">æ ‡ç­¾</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/libin1991" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="3120217729@qq.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://juejin.im/user/57e737f6c4c971005f6bcd8d" target="_blank" title="juejin">
                      
                        <i class="fa fa-fw fa-spinner"></i>juejin</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ææ–Œ</span>

  
</div>


  <div class="powered-by">ç”± <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">ä¸»é¢˜ &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
<script type="text/javascript" src="/js/src/clicklove.js"></script>

