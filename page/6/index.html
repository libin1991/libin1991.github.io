<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="Blog">
<meta property="og:type" content="website">
<meta property="og:title" content="èˆåŠ¨ä¹¾å¤">
<meta property="og:url" content="http://yoursite.com/page/6/index.html">
<meta property="og:site_name" content="èˆåŠ¨ä¹¾å¤">
<meta property="og:description" content="Blog">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="èˆåŠ¨ä¹¾å¤">
<meta name="twitter:description" content="Blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/6/">





  <title>èˆåŠ¨ä¹¾å¤ - ç”·å„¿æ¬²é‚é’äº‘å¿—           éœ€ä¿¡äººé—´çº¢ç²‰ç©º</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband">
    	<div class="eevee"><div class="body"><div class="head"><div class="ears"><div class="ear"><div class="lobe"></div></div><div class="ear"><div class="lobe"></div></div></div><div class="face"><div class="eyes"><div class="eye"><div class="eyelid"></div></div><div class="eye"><div class="eyelid"></div></div></div><div class="nose"></div><div class="mouth"></div></div></div><div class="chest"><div class="fur"><div class="patch"></div></div><div class="fur"><div class="patch"></div></div><div class="fur"><div class="patch"></div></div></div><div class="legs"><div class="leg"><div class="inner-leg"></div></div><div class="leg"><div class="inner-leg"></div></div><div class="leg"><div class="inner-leg"></div></div><div class="leg"><div class="inner-leg"></div></div></div><div class="tail"><div class="tail"><div class="tail"><div class="tail"><div class="tail"><div class="tail -end"></div></div></div></div></div></div></div></div>
    </div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
    	<div id="sky">
				<div id="background" class="container">
			<!-- svg file -->
			<svg id="svgout" height="100%" width="100%" viewbox="0 0 550 400">
				<defs>
					<g id="bottomShadow">
						<path fill="#000000" stroke="none" d="
		M 270.5 225.95
		L 127.35 316.65 266.8 400 409.6 309.25 270.5 225.95 Z"/>
					</g>
					<g id="Layer52_0_FILL">
						<path class="topGrass" fill="#B9D668" stroke="none" d="
	M 397.85 229.3
	L 397.85 225.6 269.85 152 135.75 228.6 135.75 233.65 262.1 306.55 397.85 229.3 Z"/>
					</g>
					<g id="Layer51_0_FILL">
						<path class="leftSideGrass" fill="#6E9E4F" stroke="none" d="
	M 135.1 229.95
	L 135.1 256.85 262.1 328.4 262.1 301.85 135.1 229.95 Z"/>
					</g>
					<g id="Layer50_0_FILL">
						<path class="rightGrassTop" fill="#8CB154" stroke="none" d="
	M 397.85 225.95
	L 395.8 225.95 261.75 301.55 261.75 328.4 397.85 251.15 397.85 225.95 Z"/>
					</g>
					<g id="Layer48_0_FILL">
						<path class="crustLeftTop" fill="#955541" stroke="none" d="
	M 135.45 282.4
	L 135.75 298.15 262.1 372.1 261.75 355.65 135.45 282.4 Z"/>
					</g>
					<g id="Layer47_0_FILL">
						<path class="middleLeftCrust" fill="#C77E61" stroke="none" d="
	M 135.1 270.3
	L 135.1 283.05 275.9 364.35 271.85 348.9 135.1 270.3 Z"/>
					</g>
					<g id="Layer46_0_FILL">
						<path class="crustLeftTop" fill="#955541" stroke="none" d="
	M 135.1 255.15
	L 135.1 270.3 262.1 343.55 262.1 328.05 135.1 255.15 Z"/>
					</g>
					<g id="Layer45_0_FILL">
						<path class="topRightCrust" fill="#A47237" stroke="none" d="
	M 397.5 294.5
	L 397.5 277 261.75 355.3 261.75 372.75 397.5 294.5 Z"/>
					</g>
					<g id="Layer44_0_FILL">
						<path class="middleRightCrust" fill="#C89451" stroke="none" d="
	M 397.5 269.95
	L 397.15 266.6 262.1 343.2 262.1 355.95 397.5 279.7 397.5 269.95 Z"/>
					</g>
					<g id="Layer43_0_FILL">
						<path class="topRightCrust" fill="#A47237" stroke="none" d="
	M 397.5 266.6
	L 397.5 250.45 261.75 328.4 261.75 343.85 397.5 266.6 Z"/>
					</g>
					<g id="Layer41_0_FILL">
						<path class="greyRoad" fill="#B2B2B1" stroke="none" d="
	M 295.05 283.05
	Q 299.05 280.35 308.45 275.3 317.85 269.95 323.6 266.9
	L 268.8 233.65 338.05 191.35 309.15 174.55 177.75 254.5
	Q 191.55 262.2 198.25 266.25 204.65 269.95 209.7 271.95
	L 241.6 250.45 295.05 283.05 Z"/>
					</g>
					<g id="Layer40_0_FILL">
						<path fill="#FFFFFF" stroke="none" d="
	M 199.95 256.85
	Q 194.55 261.2 191.9 262.2
	L 194.9 263.9 200.95 259.2 199.95 256.85
	M 225.8 243.75
	L 224.8 241.75 211.05 250.8 212.05 252.8 225.8 243.75
	M 308.15 275.65
	L 296.7 266.6 295.35 268.6 306.8 277.7 308.15 275.65
	M 275.9 253.5
	L 274.55 255.5 285.95 264.55 287.3 262.55 275.9 253.5
	M 251.7 227.3
	L 250.7 225.25 236.9 234.35 237.9 236.35 251.7 227.3
	M 257.05 240.7
	L 254.05 240.7 268.8 249.8 269.5 247.75 257.05 240.7
	M 277.2 207.8
	L 263.45 216.85 264.45 218.9 278.25 209.8 277.2 207.8
	M 305.1 192.65
	L 304.1 190.65 290.3 199.75 291.35 201.75 305.1 192.65 Z"/>
					</g>
					<g id="Layer38_0_FILL">
						<path class="frontFascia" fill="#ECB27B" stroke="none" d="
	M 359.25 187.95
	L 346.4 174.95 333.85 202.9 359.25 187.95 Z"/>
					</g>
					<g id="Layer37_0_FILL">
						<path class="frontWall" fill="#EFA258" stroke="none" d="
	M 334 201.05
	L 334.35 232 359.2 217.55 359.25 187.95 334 201.05 Z"/>
					</g>
					<g id="Layer36_0_FILL">
						<path class="leftWall" fill="#C57F42" stroke="none" d="
	M 334.35 232.3
	L 334.35 205.1 305.1 191.35 305.1 216.85 334.35 232.3 Z"/>
					</g>
					<g id="Layer35_0_FILL">
						<path class="rightRoof" fill="#EF4427" stroke="none" d="
	M 329.7 167.9
	L 331.05 167.9 344.55 176.7 347.85 176.7 363 192.25 363.15 189.55 350.65 176.7 350.55 176.7 334.25 167.5 334.25 159.1 329.7 159.1 329.7 164.9 322.65 160.95 322.3 162.15 329.7 167 329.7 167.9 Z"/>
					</g>
					<g id="Layer34_0_FILL">
						<path class="leftRoof" fill="#F2563B" stroke="none" d="
	M 334.05 207.05
	L 350.65 176.7 322.1 160.45 302.1 192.05 334.05 207.05 Z"/>
					</g>
					<g id="Layer30_0_FILL">
						<path id="windowFour" class="windows" stroke="none" fill="#975A42" d="
	M 341.35 203.3
	Q 340.9 203.45 340.5 203.8 340.1 204.2 339.85 204.75 339.7 205 339.7 205.3 339.6 205.75 339.7 206.1 339.7 206.15 339.7 206.2 339.8 206.5 340 206.8 340.55 207.4 341.45 207.4 342.35 207.4 343 206.8 343.4 206.5 343.65 206.1 343.85 205.75 343.95 205.3 344.05 204.4 343.55 203.8 343.3 203.45 343 203.3 342.65 203.15 342.2 203.15 341.8 203.15 341.35 203.3
	M 355.85 198.45
	Q 355.8 198.2 355.6 198 355.1 197.4 354.2 197.4 353.35 197.4 352.6 198 351.85 198.65 351.7 199.55 351.7 199.7 351.7 199.85 351.6 200.5 352 201.05 352.55 201.65 353.45 201.65 354.3 201.65 355.05 201.05 355.45 200.7 355.7 200.25 355.8 200.05 355.9 199.85 355.95 199.7 355.95 199.55 356.05 198.95 355.85 198.45 Z"/>
						<path class="door" fill="#B65041" stroke="none" d="
	M 351.95 211.2
	L 351.8 211.2 346.05 215.1 346.05 225.2 351.95 221.6 351.95 211.2
	M 351.2 211.2
	L 351.35 211.2 351.35 211.1 351.2 211.2 Z"/>
					</g>
					<g>
						<path id="Layer30_0_FILL" fill="#000000" fill-opacity="1" stroke="none" d="
	M 183.7 215.3
	L 183.7 215.6
	Q 187.25 231.75 212.25 234.35
	L 183.7 215.3 Z"/>
					</g>
					<g id="Layer29_0_FILL">
						<path fill="#000000" fill-opacity="0.4" stroke="none" d="
	M 305.1 216.85
	L 305.15 217.2
	Q 309.45 233.2 334.35 232.3
	L 305.1 216.85 Z"/>
					</g>
					<g id="Layer27_0_FILL">
						<path class="vegetation" fill="#78A950" stroke="none" d="
	M 177.45 231.65
	Q 175.75 235.35 181.8 239.35 185.5 235.7 185.15 231.3 182.8 230.65 181.45 234 179.45 231.3 177.45 231.65
	M 236.9 266.6
	Q 235.2 270.3 241.25 274.3 244.95 270.6 244.65 266.25 242.3 265.6 240.95 268.95 238.9 266.25 236.9 266.6
	M 254.7 277
	Q 253.05 280.7 259.1 284.75 262.75 281.05 262.45 276.65 260.1 276 258.75 279.35 256.7 276.65 254.7 277
	M 315.5 245.75
	Q 313.5 243.05 311.5 243.4 309.8 247.1 315.85 251.15 319.55 247.45 319.2 243.05 316.85 242.4 315.5 245.75
	M 295.35 232.65
	Q 293.7 236.35 299.75 240.4 303.45 236.7 303.1 232.3 300.75 231.65 299.4 235 297.4 232.3 295.35 232.65
	M 277.2 171.85
	Q 275.55 175.55 281.6 179.55 285.3 175.85 284.95 171.5 282.6 170.85 281.25 174.2 279.25 171.5 277.2 171.85 Z"/>
					</g>
					<g id="Layer26_0_FILL">
						<path class="treeWood" fill="#AE663D" stroke="none" d="
	M 175.1 177.55
	L 172.05 177.55 172.05 191.1 159.3 172.85
	Q 154.6 171.5 172.05 195.7
	L 172.05 212.5 175.1 212.5 175.1 177.55
	M 252.7 151.35
	L 249 151.35 249 176.9 252.7 176.9 252.7 151.35 Z"/>
					</g>
					<g id="Layer25_0_FILL">
						<path class="vegetation" fill="#77A951" stroke="none" d="
	M 192.55 179.55
	Q 200.95 173.5 200.95 165.1 200.95 156.4 192.55 150 184.15 144.3 172.05 144.3 160.3 144.3 151.9 150 143.15 156.4 143.15 165.1 143.15 173.5 151.9 179.55 160.3 185.95 172.05 185.95 184.15 185.95 192.55 179.55
	M 236.25 106.65
	Q 230.2 116.05 230.2 129.15 230.2 142.25 236.25 151.35 242.3 160.75 250.7 160.75 258.75 160.75 264.8 151.35 270.85 142.25 270.85 129.15 270.85 116.05 264.8 106.65 258.75 97.6 250.7 97.6 242.3 97.6 236.25 106.65 Z"/>
					</g>
					<g id="Layer24_0_FILL">
						<path class="vegetation" fill="#77A951" stroke="none" d="
	M 158.3 221.9
	Q 160.65 221.9 161.95 220.2 163 219.55 163.3 218.55 164.65 218.9 166.35 218.9 170.05 218.9 172.4 216.2 175.1 213.85 175.1 210.15 175.1 206.45 172.4 203.75 170.05 201.4 166.35 201.4 162.65 201.4 159.95 203.75 157.6 206.45 157.6 210.15 157.6 210.8 157.6 211.15 155.95 211.5 154.6 212.5 152.9 214.15 152.9 216.55 152.9 218.9 154.6 220.2 156.25 221.9 158.3 221.9
	M 338.35 240.05
	Q 341.05 237.7 341.05 234 341.05 230.3 338.35 227.6 336 225.25 332.3 225.25 328.65 225.25 325.95 227.6 323.6 230.3 323.6 234 323.6 237.7 325.95 240.05 328.65 242.75 332.3 242.75 336 242.75 338.35 240.05 Z"/>
					</g>
					<g id="Layer22_0_FILL">
						<path class="rightRoof" fill="#D05041" stroke="none" d="
	M 220 173.85
	L 236.8 186.7 264.35 171.15 244.5 159.55 220 173.85 Z"/>
					</g>
					<g id="Layer21_0_FILL">
						<path class="leftWall" fill="#C57F42" stroke="none" d="
	M 212.25 191.35
	L 183.35 172.3 183.7 215.3 212.25 234.35 212.25 191.35 Z"/>
					</g>
					<g id="Layer20_0_FILL">
						<path class="rightRoof" fill="#EF4427" stroke="none" d="
	M 192.1 149.85
	L 236.45 174.8 243.1 171.4
	Q 220.05 150.55 196.3 139.95
	L 192.1 149.85 Z"/>
					</g>
					<g id="Layer19_0_FILL">
						<path class="frontFascia" fill="#EBB17B" stroke="none" d="
	M 226.85 160.95
	L 212 190.6 229.75 192.6 239.75 172.85 226.85 160.95 Z"/>
					</g>
					<g id="Layer18_0_FILL">
						<path class="frontWall" fill="#EFA258" stroke="none" d="
	M 240.15 172.65
	L 211.9 191.6 212.25 233.65 264.35 201.7 264.35 170.8 240.8 184.45 240.15 172.65 Z"/>
					</g>
					<g id="Layer17_0_FILL">
						<path class="rightRoof" fill="#EF4427" stroke="none" d="
	M 210.9 142.2
	L 205.9 142.2 205.9 152.65 210.9 152.65 210.9 142.2 Z"/>
					</g>
					<g>
						<path id="Layer16_0_FILL" class="leftRoof" fill="#F2563B" stroke="none" d="
	M 210.25 195.5
	L 227.4 160.95 195.45 141.35 177.65 175.85 210.25 195.5 Z"/>
					</g>
					<g>
						<path id="sun" fill="#E3BD0E" stroke="none" d="
	M 257.05 15.95
	Q 251.7 15.95 248 19.65 244.3 23.35 244.3 28.7 244.3 34.1 248 37.8 251.7 41.5 257.05 41.5 262.45 41.5 266.15 37.8 269.85 34.1 269.85 28.7 269.85 23.35 266.15 19.65 262.45 15.95 257.05 15.95 Z"/>
					</g>
					<g id="Layer8_0_FILL">
						<path fill="#975A42" stroke="none" d="
	M 238.45 189.65
	Q 238.295703125 189.362109375 238.05 189.1 237.35 188.3 236.2 188.3 235.05 188.3 234.15 189.1 233.3 189.9 233.2 191.05 233.1 192.2 233.8 193 234.55 193.8 235.7 193.8 236.85 193.8 237.7 193 238.1970703125 192.558203125 238.45 192 238.6552734375 191.56484375 238.7 191.05 238.7671875 190.276953125 238.45 189.65
	M 220.55 197.55
	Q 220 197.55 219.5 197.75 218.95 197.95 218.5 198.35 217.933203125 198.8833984375 217.7 199.55 217.5833984375 199.916796875 217.55 200.3 217.4923828125 200.96171875 217.7 201.5 217.852734375 201.9103515625 218.15 202.25 218.95 203.05 220.1 203.05 221.25 203.05 222.05 202.25 222.95 201.45 223.05 200.3 223.15 199.15 222.4 198.35 222.05 197.95 221.65 197.75 221.15 197.55 220.55 197.55 Z"/>
					</g>
					<g id="Layer7_0_FILL">
						<path class="door" fill="#B65041" stroke="none" d="
	M 233.55 206.75
	L 225.9 211.95 226.25 225.5 233.95 220.35 233.55 206.75 Z"/>
					</g>
					<g>
						<path id="windowOne" class="windows" fill="#975A42" stroke="none" d="
	M 188.65 198.4
	L 188.8 204.1 198.65 210.45 198.55 204.75 188.65 198.4
	M 208.45 216.8
	L 208.35 211.1 198.55 204.75 198.65 210.45 208.45 216.8
	M 188.8 204.1
	L 188.95 209.8 198.8 216.15 198.65 210.45 188.8 204.1
	M 208.6 222.5
	L 208.45 216.8 198.65 210.45 198.8 216.15 208.6 222.5 Z"/>
					</g>
					<g>
						<path id="windowThree" class="windows" fill="#975A42" stroke="none" d="
	M 311.7 214.1
	L 318.55 217.55 318.45 211.9 311.6 208.45 311.7 214.1
	M 325.4 221
	L 325.25 215.35 318.45 211.9 318.55 217.55 325.4 221
	M 318.4 206.2
	L 311.5 202.75 311.6 208.45 318.45 211.9 318.4 206.2
	M 325.25 215.35
	L 325.2 209.7 318.4 206.2 318.45 211.9 325.25 215.35 Z"/>
					</g>
					<g id="Layer2_0_FILL">
						<path class="door" fill="#B65041" stroke="none" d="
	M 259.7 183.25
	L 244.6 191.9 244.6 213.8 259.7 204.55 259.7 183.25 Z"/>
					</g>
					<path id="windowTwo" fill="#975A42" class="windows" stroke-width="1" stroke-linejoin="round" stroke-linecap="round" d="
	M 223.05 200.3
	Q 222.95 201.45 222.05 202.25 221.25 203.05 220.1 203.05 218.95 203.05 218.15 202.25 217.852734375 201.9103515625 217.7 201.5 217.4923828125 200.96171875 217.55 200.3 217.5833984375 199.916796875 217.7 199.575 217.933203125 198.8833984375 218.5 198.35 218.95 197.95 219.5 197.75 220 197.55 220.55 197.55 221.15 197.55 221.65 197.75 222.05 197.95 222.4 198.35 223.15 199.15 223.05 200.3 Z
	M 238.7 191.05
	Q 238.6552734375 191.56484375 238.45 192 238.1970703125 192.558203125 237.7 193 236.85 193.8 235.7 193.8 234.55 193.8 233.8 193 233.1 192.2 233.2 191.05 233.3 189.9 234.15 189.1 235.05 188.3 236.2 188.3 237.35 188.3 238.05 189.1 238.295703125 189.362109375 238.45 189.65 238.7671875 190.276953125 238.7 191.05 Z"/>
					<path fill="#F2563B" stroke="none" d=" M 351.95 211.2 L 351.8 211.2 346.05 215.1 346.05 225.2 351.95 221.6 351.95 211.2 Z"/>
					<path id="Layer6_0_1_STROKES" class="windowRims" stroke="#AE663D" stroke-width="1" stroke-linejoin="round" stroke-linecap="round" fill="none" d="
	M 198.55 204.75
	L 208.35 211.1 208.45 216.8 208.6 222.5 198.8 216.15 188.95 209.8 188.8 204.1 188.65 198.4 198.55 204.75 198.65 210.45 208.45 216.8
	M 198.8 216.15
	L 198.65 210.45 188.8 204.1"/>
					<path id="Layer5_0_1_STROKES" class="windowRims" stroke="#AE663D" stroke-width="1" stroke-linejoin="round" stroke-linecap="round" fill="none" d="
	M 325.25 215.35
	L 325.4 221 318.55 217.55 311.7 214.1 311.6 208.45 311.5 202.75 318.4 206.2 325.2 209.7 325.25 215.35 318.45 211.9 318.55 217.55
	M 318.4 206.2
	L 318.45 211.9 311.6 208.45"/>
				</defs>
				<g id="shadow">
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use xlink:href="#bottomShadow"/>
					</g>
				</g>
				<g transform="matrix( 1, 0, 0, 1, 0,0) ">
					<use xlink:href="#sun"/>
				</g>
				<g id="earth">
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer52_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer51_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer50_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer48_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer47_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer46_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer45_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer44_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer43_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer41_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer40_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer38_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer37_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer36_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer35_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer34_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#windowFour"/>
						<use class="element" xlink:href="#Layer32_0_1_STROKES"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer30_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer27_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer26_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer25_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer24_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer22_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer21_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer20_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer19_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer18_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer17_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer16_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer8_0_FILL"/>
						<use class="element" xlink:href="#windowTwo"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer7_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#windowOne"/>
						<use class="element" xlink:href="#Layer6_0_1_STROKES"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#windowThree"/>
						<use class="element" xlink:href="#Layer5_0_1_STROKES"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer2_0_FILL"/>
					</g>
				</g>
			</svg>
			<! -- End of SVG file -->
			<! -- Moon/Sun Toggle -->
			<div id="toggleButton" class="day-toggle">
				<div class="sun-icon"></div>
				<label class="switch">
            <input id="toggleCheckbox" type="checkbox">
            <div class="slider"></div>
        </label>
				<div class="cloud-icon"></div>
			</div>
			<! -- Moon/Sun Toggle -->
			<! -- End of Container -->
		</div>
			</div>
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">èˆåŠ¨ä¹¾å¤</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">ç”·å„¿æ¬²é‚é’äº‘å¿—           éœ€ä¿¡äººé—´çº¢ç²‰ç©º</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            æ ‡ç­¾
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            å…³äº
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            æœç´¢
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="æœç´¢..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/30/JSç»§æ‰¿/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="èˆåŠ¨ä¹¾å¤">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/30/JSç»§æ‰¿/" itemprop="url">JSç»§æ‰¿</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-03-30T20:16:47+08:00">
                2018-03-30
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="/2018/03/30/JSç»§æ‰¿/1.webp" alt=""><br><img src="/2018/03/30/JSç»§æ‰¿/2.webp" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;  </span><br><span class="line">&lt;html&gt;  </span><br><span class="line">  </span><br><span class="line">    &lt;head&gt;  </span><br><span class="line">        &lt;meta charset=&quot;UTF-8&quot;&gt;  </span><br><span class="line">        &lt;title&gt;&lt;/title&gt;  </span><br><span class="line">        &lt;script type=&quot;text/javascript&quot;&gt;  </span><br><span class="line">            function MAN(name, sex, age) &#123;  </span><br><span class="line">                this.name = name;  </span><br><span class="line">                this.sex = sex;  </span><br><span class="line">                this.age = age;  </span><br><span class="line">                this.say = function(school, zhuanye) &#123;  </span><br><span class="line">                    console.log(this.name + &quot;,&quot; + this.sex + &quot;,ä»Šå¹´&quot; + this.age + &quot;å²ï¼åœ¨&quot; + school + &quot;å­¦ä¹ &quot; + zhuanye);  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125;  </span><br><span class="line">            MAN.prototype.cao = function() &#123;  </span><br><span class="line">                console.log(this.name + &quot;,&quot; + this.sex + &quot;,éƒ½å·²ç»&quot; + this.age + &quot;äº†,å†ä¸ç–¯ç‹‚æˆ‘ä»¬å°±è€äº†ï¼&quot;)  </span><br><span class="line">            &#125;  </span><br><span class="line">  </span><br><span class="line">            function WOMAN(name, sex, age) &#123;  </span><br><span class="line">                //æ–¹æ³•1ï¼šå¯¹è±¡å†’å……  </span><br><span class="line">                //this.man = MAN;   </span><br><span class="line">                //this.man(name, sex, age);  </span><br><span class="line">                //æ–¹æ³•2ï¼šcall  </span><br><span class="line">                //MAN.call(this,name, sex, age);  </span><br><span class="line">                //æ–¹æ³•3ï¼šapply  </span><br><span class="line">                //MAN.apply(this,[name, sex, age]);  </span><br><span class="line">                //æ–¹æ³•4ï¼šbind  </span><br><span class="line">                //MAN.bind(this)(name, sex, age);  </span><br><span class="line">                MAN.bind(this)(name, sex, age);  </span><br><span class="line">            &#125;  </span><br><span class="line">            //æ–¹æ³•5ï¼šprototype  </span><br><span class="line">            WOMAN.prototype = new MAN();  </span><br><span class="line">              </span><br><span class="line">              </span><br><span class="line">            //æ³¨æ„ï¼šæ–¹æ³•1,2,3,4åªèƒ½ç»§æ‰¿this.XXX=XXXçš„å±æ€§,ä¸èƒ½ç»§æ‰¿XXX.prototype.xxx==function()&#123;&#125;,æ³¨é‡Šæ‰æ–¹æ³•5å¯ä»¥çœ‹åˆ°  </span><br><span class="line">            //æ–¹æ³•5åªèƒ½ç»§æ‰¿XXX.prototype.xxx==function()&#123;&#125;çš„å±æ€§ï¼Œä¸èƒ½ç»§æ‰¿this.XXX=XXXçš„å±æ€§ï¼Œæ³¨é‡Šæ‰æ–¹æ³•1,2,3,4å¯ä»¥çœ‹åˆ°  </span><br><span class="line">              </span><br><span class="line">            var man = new MAN(&quot;å¼ ä¸‰&quot;, &quot;ç”·&quot;, 26);  </span><br><span class="line">            man.say(&apos;è“ç¿”æŠ€æ ¡&apos;, &apos;ç”µæ°”ç„Š&apos;);  </span><br><span class="line">            man.cao();  </span><br><span class="line">            var woman = new WOMAN(&quot;å°çº¢&quot;, &quot;å¥³&quot;, 18);  </span><br><span class="line">            woman.say(&apos;æ¸…åå¤§å­¦&apos;, &apos;æŒ–æ˜æœº&apos;);  </span><br><span class="line">            woman.cao();  </span><br><span class="line">        &lt;/script&gt;  </span><br><span class="line">    &lt;/head&gt;  </span><br><span class="line">  </span><br><span class="line">    &lt;body&gt;  </span><br><span class="line">    &lt;/body&gt;  </span><br><span class="line">  </span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>
<p><img src="/2018/03/30/JSç»§æ‰¿/3.webp" alt=""><br>ä¼—æ‰€å‘¨çŸ¥ï¼Œåœ¨ ES 6 ä¹‹å‰æ²¡æœ‰ç±»çš„æ¦‚å¿µï¼Œæ‰€ä»¥ä¸èƒ½åƒ Java ä¸­ä¸€ä¸ª extends å…³é”®å­—å°±æå®šäº†ç»§æ‰¿å…³ç³»ï¼Œéœ€è¦ä¸€äº› tricks æ¥å®ç°ï¼Œä¸‹é¢å°±ä»‹ç»ä¸€äº›æ¯”è¾ƒå¸¸ç”¨çš„æ–¹æ³•ã€‚</p>
<h2 id="ä¸€-åŸå‹é“¾ç»§æ‰¿ï¼š"><a href="#ä¸€-åŸå‹é“¾ç»§æ‰¿ï¼š" class="headerlink" title="(ä¸€) åŸå‹é“¾ç»§æ‰¿ï¼š"></a>(ä¸€) åŸå‹é“¾ç»§æ‰¿ï¼š</h2><pre><code>function Parent(name) { 
    this.name = name;
}
Parent.prototype.sayName = function() {
    console.log(&apos;parent name:&apos;, this.name);
}
function Child(name) {
    this.name = name;
}

Child.prototype = new Parent(&apos;father&apos;);
Child.prototype.constructor = Child;

Child.prototype.sayName = function() {
    console.log(&apos;child name:&apos;, this.name);
}

var child = new Child(&apos;son&apos;);
child.sayName();    // child name: son
</code></pre><p>åªè¦æ˜¯åŸå‹é“¾ä¸­å‡ºç°è¿‡çš„åŸå‹ï¼Œéƒ½å¯ä»¥è¯´æ˜¯è¯¥åŸå‹é“¾æ´¾ç”Ÿçš„å®ä¾‹çš„åŸå‹ã€‚</p>
<p>è¿™ç§æ–¹æ³•å­˜åœ¨ä¸¤ä¸ªç¼ºç‚¹ï¼š</p>
<ol>
<li>å­ç±»å‹æ— æ³•ç»™è¶…ç±»å‹ä¼ é€’å‚æ•°ï¼Œåœ¨é¢å‘å¯¹è±¡çš„ç»§æ‰¿ä¸­ï¼Œæˆ‘ä»¬æ€»å¸Œæœ›é€šè¿‡ var child = new Child(â€˜sonâ€™, â€˜fatherâ€™); è®©å­ç±»å»è°ƒç”¨çˆ¶ç±»çš„æ„é€ å™¨æ¥å®Œæˆç»§æ‰¿ã€‚è€Œä¸æ˜¯é€šè¿‡åƒè¿™æ · new Parent(â€˜fatherâ€™) å»è°ƒç”¨çˆ¶ç±»ã€‚</li>
<li>Child.prototype.sayName å¿…é¡»å†™åœ¨ Child.prototype = new Parent(â€˜fatherâ€™); ä¹‹åï¼Œä¸ç„¶å°±ä¼šè¢«è¦†ç›–æ‰ã€‚</li>
</ol>
<h2 id="äºŒ-ç±»å¼ç»§æ‰¿ï¼š"><a href="#äºŒ-ç±»å¼ç»§æ‰¿ï¼š" class="headerlink" title="(äºŒ) ç±»å¼ç»§æ‰¿ï¼š"></a>(äºŒ) ç±»å¼ç»§æ‰¿ï¼š</h2><pre><code>function Parent(name) { 
    this.name = name;
}
Parent.prototype.sayName = function() {
    console.log(&apos;parent name:&apos;, this.name);
}
Parent.prototype.doSomthing = function() {
    console.log(&apos;parent do something!&apos;);
}
function Child(name, parentName) {
    Parent.call(this, parentName);
    this.name = name;
}

Child.prototype.sayName = function() {
    console.log(&apos;child name:&apos;, this.name);
}

var child = new Child(&apos;son&apos;);
child.sayName();      // child name: son
child.doSomthing();   // TypeError: child.doSomthing is not a function
</code></pre><p>ç›¸å½“äº Parent è¿™ä¸ªå‡½æ•°åœ¨ Child å‡½æ•°ä¸­æ‰§è¡Œäº†ä¸€éï¼Œå¹¶ä¸”å°†æ‰€æœ‰ä¸ this ç»‘å®šçš„å˜é‡éƒ½åˆ‡æ¢åˆ°äº† Child ä¸Šï¼Œè¿™æ ·å°±å…‹æœäº†ç¬¬ä¸€ç§æ–¹å¼å¸¦æ¥çš„é—®é¢˜ã€‚</p>
<p>ç¼ºç‚¹ï¼š</p>
<ol>
<li>æ²¡æœ‰åŸå‹ï¼Œæ¯æ¬¡åˆ›å»ºä¸€ä¸ª Child å®ä¾‹å¯¹è±¡æ—¶å€™éƒ½éœ€è¦æ‰§è¡Œä¸€é Parent å‡½æ•°ï¼Œæ— æ³•å¤ç”¨ä¸€äº›å…¬ç”¨å‡½æ•°ã€‚</li>
</ol>
<h2 id="ä¸‰-ç»„åˆå¼ç»§æ‰¿ï¼šå‰ä¸¤ç§æ–¹å¼çš„ç»“åˆ"><a href="#ä¸‰-ç»„åˆå¼ç»§æ‰¿ï¼šå‰ä¸¤ç§æ–¹å¼çš„ç»“åˆ" class="headerlink" title="(ä¸‰) ç»„åˆå¼ç»§æ‰¿ï¼šå‰ä¸¤ç§æ–¹å¼çš„ç»“åˆ"></a>(ä¸‰) ç»„åˆå¼ç»§æ‰¿ï¼šå‰ä¸¤ç§æ–¹å¼çš„ç»“åˆ</h2><pre><code>function Parent(name) { 
    this.name = name;
}

Parent.prototype.sayName = function() {
    console.log(&apos;parent name:&apos;, this.name);
}
Parent.prototype.doSomething = function() {
    console.log(&apos;parent do something!&apos;);
}
function Child(name, parentName) {
    Parent.call(this, parentName);
    this.name = name;
}

Child.prototype.sayName = function() {
    console.log(&apos;child name:&apos;, this.name);
}

Child.prototype = new Parent();      
Child.prototype.construtor = Child;

var child = new Child(&apos;son&apos;);
child.sayName();       // child name: son
child.doSomething();   // parent do something!
</code></pre><p>ç»„åˆå¼ç»§æ‰¿æ˜¯æ¯”è¾ƒå¸¸ç”¨çš„ä¸€ç§ç»§æ‰¿æ–¹æ³•ï¼Œå…¶èƒŒåçš„æ€è·¯æ˜¯ä½¿ç”¨åŸå‹é“¾å®ç°å¯¹åŸå‹å±æ€§å’Œæ–¹æ³•çš„ç»§æ‰¿ï¼Œè€Œé€šè¿‡å€Ÿç”¨æ„é€ å‡½æ•°æ¥å®ç°å¯¹å®ä¾‹å±æ€§çš„ç»§æ‰¿ã€‚</p>
<p>è¿™æ ·ï¼Œæ—¢é€šè¿‡åœ¨åŸå‹ä¸Šå®šä¹‰æ–¹æ³•å®ç°äº†å‡½æ•°å¤ç”¨ï¼Œåˆä¿è¯æ¯ä¸ªå®ä¾‹éƒ½æœ‰å®ƒè‡ªå·±çš„å±æ€§ã€‚</p>
<p>ç»„åˆå¼ç»§æ‰¿æ˜¯ JS æœ€å¸¸ç”¨çš„ç»§æ‰¿æ¨¡å¼ï¼Œä½†ç»„åˆç»§æ‰¿ä½¿ç”¨è¿‡ç¨‹ä¸­ä¼šè¢«è°ƒç”¨ä¸¤æ¬¡ï¼šä¸€æ¬¡æ˜¯åˆ›å»ºå­ç±»å‹çš„æ—¶å€™ï¼Œå¦ä¸€æ¬¡æ˜¯åœ¨å­ç±»å‹æ„é€ å‡½æ•°çš„å†…éƒ¨ã€‚</p>
<pre><code>function Parent(name) { 
    this.name = name;
}
Parent.prototype.sayName = function() {
    console.log(&apos;parent name:&apos;, this.name);
}
Parent.prototype.doSomething = function() {
    console.log(&apos;parent do something!&apos;);
}
function Child(name, parentName) {
    Parent.call(this, parentName);      // ç¬¬äºŒæ¬¡è°ƒç”¨
    this.name = name;
}

Child.prototype.sayName = function() {
    console.log(&apos;child name:&apos;, this.name);
}

Child.prototype = new Parent();         // ç¬¬ä¸€æ¬¡è°ƒç”¨
Child.prototype.construtor = Child;

var child = new Child(&apos;son&apos;);
child.sayName();      
child.doSomething();   
</code></pre><p>æ˜¾ç„¶ä»ä¸Šè¿°çš„ä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨æ„é€ å‡½æ•°æ˜¾ç„¶æ˜¯æ²¡æœ‰å¿…è¦çš„ï¼Œå› ä¸ºç¬¬ä¸€æ¬¡è°ƒç”¨æ„é€ å‡½æ•°æ—¶å€™ä¸éœ€è¦å‡½æ•°å†…éƒ¨çš„é‚£äº›å®ä¾‹å±æ€§ï¼Œè¿™ä¹ˆå†™åªæ˜¯æƒ³è·å¾—å…¶åŸå‹ä¸Šçš„æ–¹æ³•ç½¢äº†ï¼Œæ‰€ä»¥è¿™æ—¶å€™ä½ å¯èƒ½ä¼šè¿™æ ·å†™ï¼š</p>
<pre><code>Child.prototype = Parent.prototype;
</code></pre><p>è¿™æ ·å†™æ˜¾ç„¶æ˜¯ä¸å¯¹çš„ï¼š</p>
<ol>
<li>é¦–å…ˆï¼Œä½ è¿™æ ·å†™çš„è¯ç›¸å½“äºæ˜¯å­ç±»å’Œçˆ¶ç±»éƒ½æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ï¼Œè¿™æ—¶å€™å¦‚æœä½ æ·»åŠ äº†æ–°çš„æ–¹æ³•ç»™ Child ä½†å®é™…ä¸Š Parent å¹¶ä¸éœ€è¦ï¼Œç›¸å½“äºå¼ºè¡Œç»™ Parent æ·»åŠ äº†ä¸€ä¸ªæœªçŸ¥çš„æ–¹æ³•ã€‚</li>
<li>å…¶æ¬¡ï¼Œä»”ç»†æƒ³æƒ³ï¼Œè¿™æ ·ä½“ç°ä¸å‡ºç»§æ‰¿çš„å¤šæ€æ€§ï¼Œæ¯”å¦‚æ­¤æ—¶å­ç±»æƒ³è¦é‡å†™çˆ¶ç±»çš„ getName çš„æ–¹æ³•ï¼Œé‚£ä¹ˆçˆ¶ç±»çš„æ–¹æ³•ä¹Ÿå°±ä¼šéšä¹‹ä¿®æ”¹ï¼Œè¿™æ˜¾ç„¶è¿èƒŒäº†å¤šæ€æ€§ã€‚</li>
</ol>
<p>ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ç¬¬ä¸€æ¬¡è°ƒç”¨æ„é€ å‡½æ•°çš„æ—¶å€™ï¼Œå…¶å®æ˜¯ä¸ç®¡æ„é€ å‡½æ•°é‡Œé¢çš„å†…å®¹ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½•ä¸ new ä¸€ä¸ªç©ºå‡½æ•°ï¼Œå°†å…¶ prototype æŒ‡å‘ Parent.prototypeï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<h2 id="å››-å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿ï¼š"><a href="#å››-å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿ï¼š" class="headerlink" title="(å››) å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿ï¼š"></a>(å››) å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿ï¼š</h2><pre><code>function Parent(name) {
    this.name = name;
}
Parent.prototype.sayName = function() {
    console.log(&apos;parent name:&apos;, this.name);
}

function Child(name, parentName) {
    Parent.call(this, parentName);  
    this.name = name;    
}

function create(proto) {
    function F(){}
    F.prototype = proto;
    F.prototype.construtor = F;
    return new F();
}

Child.prototype = create(Parent.prototype);
Child.prototype.sayName = function() {
    console.log(&apos;child name:&apos;, this.name);
}
Child.prototype.construtor = Child;

var parent = new Parent(&apos;father&apos;);
parent.sayName();    // parent name: father


var child = new Child(&apos;son&apos;, &apos;father&apos;);
child.sayName();     // child name: son
</code></pre><p>è¿™å°±æ˜¯æ‰€è°“çš„å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿æ–¹å¼ï¼Œè·Ÿç»„åˆå¼ç»§æ‰¿çš„åŒºåˆ«åœ¨äºï¼Œä»–ä¸éœ€è¦åœ¨ä¸€æ¬¡å®ä¾‹ä¸­è°ƒç”¨ä¸¤æ¬¡çˆ¶ç±»çš„æ„é€ å‡½æ•°ï¼Œå‡å¦‚è¯´çˆ¶ç±»çš„æ„é€ å™¨ä»£ç å¾ˆå¤šï¼Œè¿˜éœ€è¦è°ƒç”¨ä¸¤æ¬¡çš„è¯å¯¹ç³»ç»Ÿè‚¯å®šä¼šæœ‰å½±å“ï¼Œå¯„ç”Ÿç»„åˆå¼ç»§æ‰¿çš„æ€æƒ³åœ¨äºï¼šç”¨ä¸€ä¸ª F ç©ºçš„æ„é€ å‡½æ•°å»å–ä»£æ‰§è¡Œäº† Parent è¿™ä¸ªæ„é€ å‡½æ•°ã€‚</p>
<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬æ‰‹åŠ¨åˆ›å»ºäº†ä¸€ä¸ª create å‡½æ•°ï¼Œä½†æ˜¯å…¶å®æ˜¯å­˜åœ¨äº Object å¯¹è±¡ä¸­ï¼Œä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å»åˆ›å»ºï¼Œæ‰€ä»¥ä¸Šé¢çš„ä»£ç å¯ä»¥æ”¹ä¸ºï¼š</p>
<pre><code>function Parent(name) {
    this.name = name;
}
Parent.prototype.sayName = function() {
    console.log(&apos;parent name:&apos;, this.name);
}

function Child(name, parentName) {
    Parent.call(this, parentName);  
    this.name = name;    
}

function inheritPrototype(Parent, Child) {
    Child.prototype = Object.create(Parent.prototype);   //ä¿®æ”¹
    Child.prototype.construtor = Child;
}

inheritPrototype(Parent, Child);

Child.prototype.sayName = function() {
    console.log(&apos;child name:&apos;, this.name);
}

var parent = new Parent(&apos;father&apos;);
parent.sayName();      // parent name: father

var child = new Child(&apos;son&apos;, &apos;father&apos;);
child.sayName();       // child name: son
</code></pre><h2 id="äº”-ES-6-ç»§æ‰¿ï¼š"><a href="#äº”-ES-6-ç»§æ‰¿ï¼š" class="headerlink" title="(äº”) ES 6 ç»§æ‰¿ï¼š"></a>(äº”) ES 6 ç»§æ‰¿ï¼š</h2><p>å½“ç„¶ï¼Œå¦‚æœä½ å­¦ä¹ è¿‡ ES 6ï¼Œé‚£ä¹ˆå†™ç»§æ‰¿å…³ç³»å°±ä¼šç‰¹åˆ«ç®€å•ï¼Œå¦‚æœä½ å­¦è¿‡ Java å°±ä¼šå‘ç°ï¼ŒES 6 ä¸­çš„ç»§æ‰¿è·Ÿ Java å¤ªåƒäº†ï¼Œä¸Šè¿°çš„ä»£ç å¯æ”¹ä¸ºï¼š</p>
<pre><code>class Parent {
    constructor(name) {
    this.name = name;
    }
    doSomething() {
    console.log(&apos;parent do something!&apos;);
    }
    sayName() {
    console.log(&apos;parent name:&apos;, this.name);
    }
}

class Child extends Parent {
    constructor(name, parentName) {
    super(parentName);
    this.name = name;
    }
    sayName() {
     console.log(&apos;child name:&apos;, this.name);
    }
}

const child = new Child(&apos;son&apos;, &apos;father&apos;);
child.sayName();            // child name: son
child.doSomething();        // parent do something!

const parent = new Parent(&apos;father&apos;);
parent.sayName();           // parent name: father
</code></pre><p>JavaScriptå‰ç«¯å¼€å‘</p>
<p>JavaScript(ES5)ä¸­æ²¡æœ‰åƒJavaé‚£æ ·ç±»çš„æ¦‚å¿µï¼Œå†™æ³•è·Ÿä¼ ç»Ÿçš„é¢å‘å¯¹è±¡è¯­è¨€ï¼ˆæ¯”å¦‚C++å’ŒJavaï¼‰å·®å¼‚å¾ˆå¤§ï¼Œå¾ˆå®¹æ˜“è®©æ–°å­¦ä¹ è¿™é—¨è¯­è¨€çš„ç¨‹åºå‘˜æ„Ÿåˆ°å›°æƒ‘ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡åŸå‹é“¾prototypeæ¥æ¨¡æ‹Ÿç±»ï¼Œå»å®ç°ç»§æ‰¿çš„ç›¸å…³åŠŸèƒ½ã€‚ä¸‹é¢æ¥çœ‹çœ‹ES5ä¸­å®ç°ç»§æ‰¿å¸¸è§çš„ä¸‰ç§æ–¹æ³•ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code>/**
 * JavaScript(ES5)ä¸­å®ç°ç»§æ‰¿çš„å‡ ç§æ–¹æ³•
 */

// å®šä¹‰åŸºç±»Person
function Person(name, age) {
  this.name = name;
  this.age = age;
}

// å…±äº«æ•°æ®
Person.prototype.LEGS_NUM = 2;

// å…±äº«æ–¹æ³•
Person.prototype.info = function () {
  console.log(&apos;My name is &apos; + this.name + &apos; .I\&apos;m &apos; + this.age + &apos; years old now&apos;);
};

Person.prototype.walk = function () {
  console.log(this.name + &apos; is walking...&apos;);
};

// Studentå­ç±»
function Student(name, age, className) {
  // è°ƒç”¨çˆ¶ç±»
  Person.call(this, name, age);
  this.className = className;
}

// 1âƒ£ï¸ æ–¹æ³•ä¸€ï¼šPerson.prototypeç›´æ¥èµ‹å€¼ç»™Student.prototype
// Student.prototype = Person.prototype;

// 2âƒ£ï¸ æ–¹æ³•äºŒï¼šStudent.prototypeä¸ºPersonçš„å®ä¾‹
// Student.prototype = new Person();

// 3âƒ£ï¸ æ–¹æ³•ä¸‰ï¼šåˆ›å»ºä¸€ä¸ªç©ºå¯¹è±¡ï¼Œå¯¹è±¡çš„åŸå‹æŒ‡å‘Person.prototypeï¼Œèµ‹å€¼ç»™Student.prototype
Student.prototype = Object.create(Person.prototype);

Student.prototype.constructor = Student;

// è¦†ç›–çˆ¶ç±»çš„infoæ–¹æ³•
Student.prototype.info = function () {
  console.log(&apos;My name is &apos; + this.name + &apos;,I\&apos;m &apos; + this.age + &apos; years old now, and from class &apos; + this.className + &apos;.&apos;);
};

// Studentç±»çš„å…±äº«æ–¹æ³•
Student.prototype.learn = function (subject) {
  console.log(this.name + &apos; is learning &apos; + subject + &apos;.&apos;);
};

// æµ‹è¯•,åˆ›å»ºä¸€ä¸ªStudentçš„å®ä¾‹
var microzz = new Student(&apos;Microzz&apos;, 22, 5);
microzz.info(); // My name is Microzz,I&apos;m 22 years old now, and from class 5.
console.log(microzz.LEGS_NUM); // 2
microzz.walk(); // Microzz is walking...
microzz.learn(&apos;JavaScript&apos;); // Microzz is learning JavaScript.
console.log(microzz.__proto__.__proto__ === Person.prototype); // true
console.log(microzz.__proto__ === Student.prototype); // true
console.log(microzz.__proto__.constructor === Student); // true
</code></pre><p>ä¸‰ç§æ–¹æ³•æ¯”è¾ƒ</p>
<p>ä¸Šé¢ä»£ç ä¸­æœ‰ä¸‰ç§æ–¹æ³•å®ç°ç»§æ‰¿ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥æ¥åˆ†æä¸€ä¸‹è¿™å‡ ç§æ–¹æ³•ã€‚<br>è¿™ç§æ–¹æ³•ä¸­ï¼ŒPerson.prototypeç›´æ¥èµ‹å€¼ç»™Student.prototypeï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªå¾ˆä¸¥é‡çš„é—®é¢˜ï¼Œå¦‚æœå­ç±»prototypeæ·»åŠ æ–°çš„ä¸œè¥¿çš„è¯ä¹Ÿä¼šæ”¹å†™çˆ¶ç±»ã€‚æ‰€ä»¥è¿™ç§æ–¹æ³•ä¸æ¨èã€‚<br>ç¬¬äºŒç§æ–¹æ³•Student.prototypeä¸ºPersonçš„å®ä¾‹ï¼Œè¿™ä¹Ÿæ˜¯å¯ä»¥å®ç°çš„ã€‚ä½†æ˜¯Personæ„é€ å‡½æ•°æœ‰å‚æ•°åº”è¯¥ä¼ ä»€ä¹ˆå‘¢ï¼Ÿä¼ ä»»ä½•ä¸€ä¸ªéƒ½æ˜¯å¾ˆå¥‡æ€ªçš„ã€‚æ‰€ä»¥ä¹Ÿä¸æ¨èã€‚<br>ç¬¬ä¸‰ç§æ–¹æ³•æ˜¯æ¯”è¾ƒç†æƒ³çš„ï¼Œåˆ›å»ºä¸€ä¸ªç©ºå¯¹è±¡ï¼Œå¯¹è±¡çš„åŸå‹æŒ‡å‘Person.prototypeï¼Œèµ‹å€¼ç»™Student.prototypeã€‚ä½†æ˜¯Object.createä¹Ÿæœ‰ä¸€ç‚¹å°ç‘•ç–µï¼Œå› ä¸ºå®ƒæ˜¯ES5ä¹‹åæ‰æ”¯æŒçš„ï¼Œä¸è¿‡æˆ‘ä»¬å¯ä»¥é€šè¿‡æ¨¡æ‹Ÿå®ç°Object.createæ–¹æ³•ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code>if (!Object.create) {
  Object.prototype.create = function (proto) {
    function F() {}
    F.prototype = proto;
    return new F;
  }
}
</code></pre><p>è¿™æ ·åœ¨ES5ä¸­å°±å®Œç¾å®ç°äº†ç»§æ‰¿ğŸ˜„</p>
<h2 id="ES6ä¸­çš„å®ç°"><a href="#ES6ä¸­çš„å®ç°" class="headerlink" title="ES6ä¸­çš„å®ç°"></a>ES6ä¸­çš„å®ç°</h2><p>æ¦‚è¿°</p>
<p>ES6æä¾›äº†æ›´æ¥è¿‘ä¼ ç»Ÿè¯­è¨€â€ç±»â€çš„å†™æ³•ï¼Œå¼•å…¥äº†Classï¼ˆç±»ï¼‰è¿™ä¸ªæ¦‚å¿µï¼Œä½œä¸ºå¯¹è±¡çš„æ¨¡æ¿ã€‚é€šè¿‡classå…³é”®å­—ï¼Œå¯ä»¥å®šä¹‰ç±»ã€‚åŸºæœ¬ä¸Šï¼ŒES6çš„classå¯ä»¥çœ‹ä½œåªæ˜¯ä¸€ä¸ªè¯­æ³•ç³–ï¼Œå®ƒçš„ç»å¤§éƒ¨åˆ†åŠŸèƒ½ï¼ŒES5éƒ½å¯ä»¥åšåˆ°ï¼Œæ–°çš„classå†™æ³•åªæ˜¯è®©å¯¹è±¡åŸå‹çš„å†™æ³•æ›´åŠ æ¸…æ™°ã€æ›´åƒé¢å‘å¯¹è±¡ç¼–ç¨‹çš„è¯­æ³•è€Œå·²ã€‚ä¸‹é¢æˆ‘ä»¬ç”¨ES6çš„è¯­æ³•å®ç°ç±»çš„ç»§æ‰¿ã€‚</p>
<p>ä»£ç </p>
<pre><code>// åŸºç±» Person
class Person {
  // çˆ¶ç±»çš„æ„é€ æ–¹æ³•
  constructor(name, age) {
    this.name = name;
    this.age = age;
    // å…±äº«å˜é‡
    this.LEGS_NUM = 2;
  }
  // çˆ¶ç±»çš„infoæ–¹æ³•
  info() {
    console.log(`My name is ${this.name}, I\&apos;m ${this.age} years old now.`);
  }

  // çˆ¶ç±»çš„walkæ–¹æ³•
  walk() {
    console.log(this.name + &apos; is walking...&apos;);
  }

}

// å­ç±» Student
class Student extends Person {
  constructor(name, age, className) {
    // è°ƒç”¨åŸºç±»çš„æ„é€ æ–¹æ³•
    super(name, age);
    this.className = className;
  }

  // è¦†ç›–çˆ¶ç±»çš„infoæ–¹æ³•
  info() {
    console.log(`My name is ${this.name}, I\&apos;m ${this.age} years old, and from class ${this.className}.`);
  }
}

// å®ä¾‹åŒ–ä¸€ä¸ªStudentçš„å®ä¾‹
let stu = new Student(&apos;Zhaohui&apos;, 22, 5);
stu.info(); // My name is Zhaohui, I&apos;m 22 years old, and from class 5.
stu.walk(); // Zhaohui is walking...
console.log(stu.LEGS_NUM); // 2
console.log(stu instanceof Student); // true
console.log(stu instanceof Person); // true
</code></pre><p>è¿™æ ·æˆ‘ä»¬å°±é€šè¿‡ES6ä¸­çš„classå®ç°äº†â€œç±»â€çš„ç»§æ‰¿äº†</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/27/Koa2ä½¿ç”¨koa-bodyå®ç°æ–‡ä»¶ä¸Šä¼ /">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="èˆåŠ¨ä¹¾å¤">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/27/Koa2ä½¿ç”¨koa-bodyå®ç°æ–‡ä»¶ä¸Šä¼ /" itemprop="url">Koa2ä½¿ç”¨koa-bodyå®ç°æ–‡ä»¶ä¸Šä¼ (Nodeå¯è¯»æµå¯å†™æµ)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-03-27T20:22:47+08:00">
                2018-03-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="koa-bodyæ–‡ä»¶ä¸Šä¼ è‡ªå®šä¹‰æ–‡ä»¶å¤¹åŠæ–‡ä»¶åç§°"><a href="#koa-bodyæ–‡ä»¶ä¸Šä¼ è‡ªå®šä¹‰æ–‡ä»¶å¤¹åŠæ–‡ä»¶åç§°" class="headerlink" title="koa-bodyæ–‡ä»¶ä¸Šä¼ è‡ªå®šä¹‰æ–‡ä»¶å¤¹åŠæ–‡ä»¶åç§°"></a><a href="http://www.ptbird.cn/koa-body-diy-upload-dir-and-filename.html" target="_blank" rel="noopener">koa-bodyæ–‡ä»¶ä¸Šä¼ è‡ªå®šä¹‰æ–‡ä»¶å¤¹åŠæ–‡ä»¶åç§°</a></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line">const Koa = require(&apos;koa&apos;),</span><br><span class="line">	//bodyParser = require(&apos;koa-bodyparser&apos;),</span><br><span class="line">	router = require(&apos;koa-router&apos;)(),</span><br><span class="line">	stc = require(&apos;koa-static&apos;),</span><br><span class="line">	render = require(&apos;koa-art-template&apos;),</span><br><span class="line">	fs = require(&apos;fs&apos;),</span><br><span class="line">	path = require(&apos;path&apos;);</span><br><span class="line">const koaBody = require(&apos;koa-body&apos;);</span><br><span class="line"></span><br><span class="line">//å¼•å…¥å­æ¨¡å—</span><br><span class="line"></span><br><span class="line">var admin = require(&apos;./routes/admin.js&apos;);</span><br><span class="line">var api = require(&apos;./routes/api.js&apos;);</span><br><span class="line">var index = require(&apos;./routes/index.js&apos;);</span><br><span class="line"></span><br><span class="line">var app = new Koa();</span><br><span class="line">//é…ç½®koa-art-template æ¨¡æ¿å¼•æ“</span><br><span class="line">render(app, &#123;</span><br><span class="line">	root: path.join(__dirname, &apos;views&apos;),</span><br><span class="line">	extname: &apos;.html&apos;,</span><br><span class="line">	debug: process.env.NODE_ENV !== &apos;production&apos;,</span><br><span class="line">	minimize: true,</span><br><span class="line">	htmlMinifierOptions: &#123;</span><br><span class="line">		collapseWhitespace: true,</span><br><span class="line">		minifyCSS: true,</span><br><span class="line">		minifyJS: true,</span><br><span class="line">		// automatically merged at runtime: rules.map(rule =&gt; rule.test)</span><br><span class="line">		ignoreCustomFragments: []</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br><span class="line">//app.use(bodyParser());</span><br><span class="line">app.use(stc(</span><br><span class="line">	path.join(__dirname, &apos;./statics&apos;)</span><br><span class="line">))</span><br><span class="line">app.use(stc(</span><br><span class="line">	path.join(__dirname, &apos;./public&apos;)</span><br><span class="line">))</span><br><span class="line">//koaBody</span><br><span class="line">app.use(koaBody(&#123;</span><br><span class="line">	multipart: true, // æ”¯æŒæ–‡ä»¶ä¸Šä¼ </span><br><span class="line">	encoding: &apos;gzip&apos;,</span><br><span class="line">	formidable: &#123;</span><br><span class="line">		uploadDir: path.join(__dirname, &apos;public/upload/&apos;), // è®¾ç½®æ–‡ä»¶ä¸Šä¼ ç›®å½•</span><br><span class="line">		keepExtensions: true, // ä¿æŒæ–‡ä»¶çš„åç¼€</span><br><span class="line">		maxFieldsSize: 2 * 1024 * 1024, // æ–‡ä»¶ä¸Šä¼ å¤§å°</span><br><span class="line">		onFileBegin: (name, file) =&gt; &#123; // æ–‡ä»¶ä¸Šä¼ å‰çš„è®¾ç½®</span><br><span class="line">			// console.log(`name: $&#123;name&#125;`);</span><br><span class="line">			// console.log(file);</span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;));</span><br><span class="line">//é…ç½®è·¯ç”±</span><br><span class="line">router.use(index);</span><br><span class="line">/*</span><br><span class="line">  /admin   é…ç½®å­è·¯ç”±  å±‚çº§è·¯ç”±</span><br><span class="line"></span><br><span class="line"> /admin/user</span><br><span class="line"> */</span><br><span class="line">router.use(&apos;/admin&apos;, admin);</span><br><span class="line">/*</span><br><span class="line"> /api/newslist   æ–°é—»åˆ—è¡¨çš„api</span><br><span class="line"> */</span><br><span class="line">router.use(&apos;/api&apos;, api); /*åœ¨æ¨¡å—é‡Œé¢æš´éœ²è·¯ç”±å¹¶ä¸”å¯åŠ¨è·¯ç”±*/</span><br><span class="line"></span><br><span class="line">router.post(&apos;/getData&apos;, async(ctx, next) =&gt; &#123;</span><br><span class="line"></span><br><span class="line">	let request = ctx.request;</span><br><span class="line">	let req_query = request.query;</span><br><span class="line">	let req_querystring = request.querystring;</span><br><span class="line">	console.log(request, req_query, req_querystring);</span><br><span class="line">	console.log(ctx.request.body)</span><br><span class="line">	console.log(ctx.request.files);</span><br><span class="line"> </span><br><span class="line">	ctx.cookies.set(</span><br><span class="line">		&apos;MyName&apos;, &apos;Koa2&apos;, &#123;</span><br><span class="line">			domain: &apos;127.0.0.1&apos;, // å†™cookieæ‰€åœ¨çš„åŸŸå</span><br><span class="line">			path: &apos;/&apos;, // å†™cookieæ‰€åœ¨çš„è·¯å¾„</span><br><span class="line">			maxAge: 1000 * 60 * 60 * 24, // cookieæœ‰æ•ˆæ—¶é•¿</span><br><span class="line">			expires: new Date(&apos;2018-12-31&apos;), // cookieå¤±æ•ˆæ—¶é—´</span><br><span class="line">			httpOnly: false, // æ˜¯å¦åªç”¨äºhttpè¯·æ±‚ä¸­è·å–</span><br><span class="line">			overwrite: false // æ˜¯å¦å…è®¸é‡å†™</span><br><span class="line">		&#125;</span><br><span class="line">	);</span><br><span class="line">	//ctx.status = 200</span><br><span class="line">	return ctx.body = &#123;</span><br><span class="line">		code: 200,</span><br><span class="line">		data: &#123;</span><br><span class="line">			arr: [1, 2, 3, 4]</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.post(&apos;/uploadPic&apos;, async(ctx, next) =&gt; &#123;</span><br><span class="line"></span><br><span class="line">	const file = ctx.request.files.file; // ä¸Šä¼ çš„æ–‡ä»¶åœ¨ctx.request.files.file</span><br><span class="line">	// åˆ›å»ºå¯è¯»æµ</span><br><span class="line">	const reader = fs.createReadStream(file.path);</span><br><span class="line">	// ä¿®æ”¹æ–‡ä»¶çš„åç§°</span><br><span class="line">	var myDate = new Date();</span><br><span class="line">	var newFilename = file.name.split(&apos;.&apos;)[0] + &apos;_&apos; + myDate.getTime() + &apos;.&apos; + file.name.split(&apos;.&apos;)[1];</span><br><span class="line">	var targetPath = path.join(__dirname, &apos;./public/upload/&apos;) + `/$&#123;newFilename&#125;`;</span><br><span class="line">	//åˆ›å»ºå¯å†™æµ</span><br><span class="line">	const upStream = fs.createWriteStream(targetPath);</span><br><span class="line">	// å¯è¯»æµé€šè¿‡ç®¡é“å†™å…¥å¯å†™æµ</span><br><span class="line">	reader.pipe(upStream);</span><br><span class="line">	//ctx.redirect(&apos;/&apos;)</span><br><span class="line">	//è¿”å›ä¿å­˜çš„è·¯å¾„</span><br><span class="line">	return ctx.body = &#123;</span><br><span class="line">		code: 200,</span><br><span class="line">		data: &#123;</span><br><span class="line">			url: &apos;http://&apos; + ctx.headers.host + &apos;/upload/&apos; + newFilename</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">//å¯åŠ¨è·¯ç”±</span><br><span class="line">app.use(router.routes()).use(router.allowedMethods());</span><br><span class="line"></span><br><span class="line">app.listen(12300);</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/02/21/JSå‰ç«¯é”™è¯¯ç›‘æ§ä¸ä¸ŠæŠ¥/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="èˆåŠ¨ä¹¾å¤">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/21/JSå‰ç«¯é”™è¯¯ç›‘æ§ä¸ä¸ŠæŠ¥/" itemprop="url">JSå‰ç«¯é”™è¯¯ç›‘æ§ä¸ä¸ŠæŠ¥</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-02-21T21:13:50+08:00">
                2018-02-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="æˆ‘ä»¬çš„ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#æˆ‘ä»¬çš„ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="æˆ‘ä»¬çš„ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Ÿ"></a>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>å°†ç”¨æˆ·åœ¨ä½¿ç”¨ç½‘é¡µæœåŠ¡æ—¶äº§ç”Ÿçš„å½±å“ç”¨æˆ·ä½“éªŒçš„å¼‚å¸¸é€šè¿‡ç½‘ç»œè¯·æ±‚ä¼ å›æœåŠ¡å™¨ï¼Œå¹¶è¿›è¡Œå¯è§†åŒ–çš„å±•ç°ï¼Œæ•´ä¸ªè¿‡ç¨‹è¦æ±‚æˆ‘ä»¬å›ä¼ çš„é”™è¯¯ä¿¡æ¯åŒ…å«é”™è¯¯ç±»å‹ã€è°ƒç”¨å †æ ˆç­‰é”™è¯¯ä¿¡æ¯ä»¥ä¾¿å¼€å‘äººå‘˜å®šä½é”™è¯¯ã€‚</p>
<h3 id="éœ€ä¸ŠæŠ¥çš„é”™è¯¯ç±»å‹æœ‰å‡ ç§ï¼Ÿ"><a href="#éœ€ä¸ŠæŠ¥çš„é”™è¯¯ç±»å‹æœ‰å‡ ç§ï¼Ÿ" class="headerlink" title="éœ€ä¸ŠæŠ¥çš„é”™è¯¯ç±»å‹æœ‰å‡ ç§ï¼Ÿ"></a>éœ€ä¸ŠæŠ¥çš„é”™è¯¯ç±»å‹æœ‰å‡ ç§ï¼Ÿ</h3><ol>
<li>é™æ€èµ„æºåŠ è½½å¤±è´¥</li>
<li>AJAXè¯·æ±‚å¤±è´¥</li>
<li>JavaScriptå¼‚å¸¸<ul>
<li>è¿è¡Œæ—¶æŠ¥é”™<ul>
<li>åŒæ­¥é”™è¯¯</li>
<li>å¼‚æ­¥é”™è¯¯</li>
</ul>
</li>
<li>è¯­æ³•é”™è¯¯</li>
</ul>
</li>
<li>promiseå¼‚å¸¸</li>
</ol>
<h3 id="æ•è·é”™è¯¯æœ‰å‡ ç§æ–¹å¼ï¼Ÿ"><a href="#æ•è·é”™è¯¯æœ‰å‡ ç§æ–¹å¼ï¼Ÿ" class="headerlink" title="æ•è·é”™è¯¯æœ‰å‡ ç§æ–¹å¼ï¼Ÿ"></a>æ•è·é”™è¯¯æœ‰å‡ ç§æ–¹å¼ï¼Ÿ</h3><p>è¿™é‡Œæˆ‘æ€»ç»“äº†å‡ ç§ï¼Œåˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li>onerrorå…¨å±€ç›‘å¬</li>
<li>addEventListenerå…¨å±€ç›‘å¬</li>
<li>tryâ€¦catchä¸»åŠ¨æ•è·</li>
<li>promiseâ€¦catchä¸»åŠ¨æ•è·</li>
<li>é‡å†™<code>XMLHttpRequest</code>å¯¹è±¡æ–¹æ³•</li>
<li>MVVMæ¡†æ¶ä¾‹å¦‚VUEå’ŒReactä¸­çš„å®˜æ–¹é”™è¯¯å¤„ç†æ–¹æ³•</li>
</ul>
<p>ä¸‹é¢åˆ†åˆ«ä»‹ç»ï¼š</p>
<h4 id="try-catch"><a href="#try-catch" class="headerlink" title="try catch"></a>try catch</h4><p>ä½¿ç”¨æ–¹æ³•å¤§å®¶åº”è¯¥éƒ½çŸ¥é“ï¼Œä½¿ç”¨tryâ€¦catchå¯ä»¥ä¸»åŠ¨çš„å¤„ç†å¼‚å¸¸ï¼Œå…»æˆåœ¨å…³é”®æ“ä½œå¤„å†™tryâ€¦catchçš„ä¹ æƒ¯å¯ä»¥éå¸¸å¥½çš„å¸®åŠ©åç»­åˆ¤æ–­çº¿ä¸Šé‡åˆ°çš„å„ç§å¼‚å¸¸ã€‚</p>
<p>è¿™é‡Œéœ€è¦æŒ‡å‡ºtry catchéœ€è¦æ³¨æ„çš„å‡ ç‚¹ï¼š</p>
<ol>
<li><p>try-catch åªèƒ½æ•è·åˆ°åŒæ­¥çš„è¿è¡Œæ—¶é”™è¯¯ï¼Œå…¶ä»–ç±»å‹æ— æ³•æ•è·</p>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong> onerroréƒ½å¯ä»¥æ•è·åˆ°è¿è¡Œæ—¶çš„åŒæ­¥/å¼‚æ­¥é”™è¯¯</p>
</li>
</ol>
<h4 id="onerror"><a href="#onerror" class="headerlink" title="onerror"></a>onerror</h4><blockquote>
<p>å½“JavaScriptè¿è¡Œæ—¶é”™è¯¯ï¼ˆåŒ…æ‹¬è¯­æ³•é”™è¯¯ï¼‰å‘ç”Ÿæ—¶ï¼Œwindowä¼šè§¦å‘ä¸€ä¸ªErrorEventæ¥å£çš„erroräº‹ä»¶ï¼Œå¹¶æ‰§è¡Œwindow.onerror()ã€‚</p>
</blockquote>
<p>window.errorå¯ä»¥ç”¨äºå…¨å±€æ•è·JavaScriptäº§ç”Ÿçš„é”™è¯¯ï¼Œä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.onerror = <span class="function"><span class="keyword">function</span>(<span class="params">message, source, lineno, colno, error</span>) </span>&#123; </span><br><span class="line">   <span class="comment">// messageï¼šé”™è¯¯ä¿¡æ¯ï¼ˆå­—ç¬¦ä¸²ï¼‰ã€‚</span></span><br><span class="line">   <span class="comment">// sourceï¼šå‘ç”Ÿé”™è¯¯çš„è„šæœ¬URLï¼ˆå­—ç¬¦ä¸²ï¼‰</span></span><br><span class="line">   <span class="comment">// linenoï¼šå‘ç”Ÿé”™è¯¯çš„è¡Œå·ï¼ˆæ•°å­—ï¼‰</span></span><br><span class="line">   <span class="comment">// colnoï¼šå‘ç”Ÿé”™è¯¯çš„åˆ—å·ï¼ˆæ•°å­—ï¼‰</span></span><br><span class="line">   <span class="comment">// errorï¼šErrorå¯¹è±¡ï¼ˆå¯¹è±¡ï¼‰</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯ä½¿ç”¨æ—¶éœ€è¦æ³¨æ„å‡ ç‚¹ï¼š</p>
<ol>
<li><p><strong>Script Error</strong> </p>
<p>åœ¨å•é¡µé¢åº”ç”¨ä¸­ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨scriptæ ‡ç­¾å¼•å…¥äº†JSæ–‡ä»¶ï¼Œå½“è¯¥JSæ–‡ä»¶çš„æ¥æºåŸŸåå’Œç½‘é¡µçš„åŸŸåä¸åŒæ—¶ï¼Œè¿™æ—¶å¦‚æœè¯¥JSæ–‡ä»¶å†…éƒ¨æŠ¥é”™ï¼Œåˆ™æˆ‘ä»¬åªèƒ½æ•è·åˆ°Script Errorï¼Œè€Œä¸æ˜¯è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ï¼Œè¿™æ˜¯ç”±äºæµè§ˆå™¨çš„è·¨åŸŸé™åˆ¶ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<ul>
<li>éœ€è¦åœ¨è·¨åŸŸçš„scriptæ ‡ç­¾ä¸­åŠ å…¥<code>crossorigin</code>å±æ€§ï¼Œä¾‹å¦‚<code>&lt;script type=&quot;text/javascript&quot; src=&quot;example.js&quot; crossorigin&gt;&lt;/script&gt;</code></li>
<li>éœ€è¦ç»™è·¨åŸŸèµ„æºçš„æœåŠ¡å™¨çš„response headerè®¾ç½®å…è®¸è·¨åŸŸï¼š<code>Access-Control-Allow-Origin:*</code></li>
</ul>
</li>
<li><p>ä¸èƒ½å…¨å±€æ•è·åˆ°èµ„æºï¼ˆå¦‚å›¾ç‰‡æˆ–è„šæœ¬ï¼‰çš„åŠ è½½å¤±è´¥</p>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong> ä½¿ç”¨<code>window.addEventListener</code>æ•è·ã€‚</p>
</li>
<li><p>onerroræ— æ³•æ•è·è¯­æ³•é”™è¯¯</p>
</li>
<li><p>onerroræœ€å¥½å†™åœ¨æ‰€æœ‰ JS è„šæœ¬çš„å‰é¢ï¼Œå¦åˆ™æœ‰å¯èƒ½æ•è·ä¸åˆ°é”™è¯¯</p>
</li>
</ol>
<h4 id="addEventListener"><a href="#addEventListener" class="headerlink" title="addEventListener"></a>addEventListener</h4><blockquote>
<p>å½“ä¸€é¡¹èµ„æºï¼ˆå¦‚å›¾ç‰‡æˆ–è„šæœ¬ï¼‰åŠ è½½å¤±è´¥ï¼ŒåŠ è½½èµ„æºçš„å…ƒç´ ä¼šè§¦å‘ä¸€ä¸ªEventæ¥å£çš„erroräº‹ä»¶ï¼Œå¹¶æ‰§è¡Œè¯¥å…ƒç´ ä¸Šçš„onerror()å¤„ç†å‡½æ•°ã€‚è¿™äº›erroräº‹ä»¶ä¸ä¼šå‘ä¸Šå†’æ³¡åˆ°windowï¼Œä¸è¿‡ï¼ˆè‡³å°‘åœ¨Firefoxä¸­ï¼‰èƒ½è¢«å•ä¸€çš„window.addEventListeneræ•è·ã€‚</p>
</blockquote>
<p>ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'error'</span>, (error) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(error);</span><br><span class="line">&#125;, <span class="literal">true</span>)</span><br></pre></td></tr></table></figure>
<p><code>window.addEventListener</code>åœ¨è¿è¡Œæ—¶é”™è¯¯å’Œèµ„æºåŠ è½½é”™è¯¯æ—¶è¿”å›çš„é”™è¯¯å¯¹è±¡ä¸åŒï¼Œå¯ä»¥å‚è€ƒä¸‹é¢ä¸¤å›¾ï¼š</p>
<p>è¿è¡Œæ—¶é”™è¯¯ï¼š</p>
<p><img src="/2018/02/21/JSå‰ç«¯é”™è¯¯ç›‘æ§ä¸ä¸ŠæŠ¥/1.jpg" alt=""></p>
<p>èµ„æºåŠ è½½é”™è¯¯ï¼š</p>
<p><img src="/2018/02/21/JSå‰ç«¯é”™è¯¯ç›‘æ§ä¸ä¸ŠæŠ¥/2.jpg" alt=""></p>
<p>ä½¿ç”¨æ—¶éœ€è¦æ³¨æ„çš„ç‚¹ï¼š</p>
<ol>
<li>ä¸åŒæµè§ˆå™¨ä¸‹è¿”å›çš„errorå¯¹è±¡å¯èƒ½ä¸åŒï¼Œéœ€è¦æ³¨æ„å…¼å®¹å¤„ç†ã€‚</li>
<li>éœ€è¦æ³¨æ„é¿å…addEventListeneré‡å¤ç›‘å¬ã€‚</li>
</ol>
<h4 id="promise-catch"><a href="#promise-catch" class="headerlink" title="promise catch"></a>promise catch</h4><p>åœ¨promiseä¸­ä½¿ç”¨catchå¯ä»¥éå¸¸æ–¹ä¾¿çš„æ•è·åˆ°å¼‚æ­¥errorï¼Œä½¿ç”¨æ–¹æ³•å¤§å®¶ä¹Ÿåº”è¯¥éƒ½äº†è§£äº†ã€‚</p>
<p>è¿™é‡Œè¯´ä¸€ä¸‹éœ€è¦æ³¨æ„çš„ç‚¹:</p>
<p>æ²¡æœ‰å†™catchçš„Promiseä¸­æŠ›å‡ºçš„é”™è¯¯æ— æ³•è¢«onerror æˆ– try-catchæ•è·åˆ°ï¼Œæ‰€ä»¥æˆ‘ä»¬åŠ¡å¿…è¦åœ¨Promiseä¸­ä¸è¦å¿˜è®°å†™catchå¤„ç†æŠ›å‡ºçš„å¼‚å¸¸ã€‚</p>
<p>   <strong>è§£å†³æ–¹æ¡ˆï¼š</strong> ä¸ºäº†é˜²æ­¢æœ‰æ¼æ‰çš„Promiseå¼‚å¸¸ï¼Œå»ºè®®åœ¨å…¨å±€å¢åŠ ä¸€ä¸ªå¯¹<code>unhandledrejection</code>çš„ç›‘å¬ï¼Œç”¨æ¥å…¨å±€ç›‘å¬Uncaught Promise Errorã€‚ä½¿ç”¨æ–¹å¼ï¼š</p>
   <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">"unhandledrejection"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123; </span><br><span class="line">	<span class="built_in">console</span>.log(e);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="é‡å†™XMLHttpRequestå¯¹è±¡çš„æ–¹æ³•"><a href="#é‡å†™XMLHttpRequestå¯¹è±¡çš„æ–¹æ³•" class="headerlink" title="é‡å†™XMLHttpRequestå¯¹è±¡çš„æ–¹æ³•"></a>é‡å†™<code>XMLHttpRequest</code>å¯¹è±¡çš„æ–¹æ³•</h4><p>è¯¥æ–¹æ³•ä¸»è¦é’ˆå¯¹AJAXè¯·æ±‚å¼‚å¸¸,é™„ä¸Šå‚è€ƒä»£ç ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> _self = <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é‡å†™ open</span></span><br><span class="line">        XMLHttpRequest.prototype.open = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="comment">// å…ˆåœ¨æ­¤å¤„å–å¾—è¯·æ±‚çš„urlã€method</span></span><br><span class="line">            _self.reqUrl = <span class="built_in">arguments</span>[<span class="number">1</span>];</span><br><span class="line">            _self.reqMethod = <span class="built_in">arguments</span>[<span class="number">0</span>];</span><br><span class="line">            <span class="comment">// åœ¨è°ƒç”¨åŸç”Ÿ open å®ç°é‡å†™</span></span><br><span class="line">            _self.xhrOpen.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é‡å†™ send</span></span><br><span class="line">        XMLHttpRequest.prototype.send = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="comment">// è®°å½•xhr</span></span><br><span class="line">            <span class="keyword">var</span> xhrmsg = &#123;</span><br><span class="line">                <span class="string">'url'</span>: _self.reqUrl,</span><br><span class="line">                <span class="string">'type'</span>: _self.reqMethod,</span><br><span class="line">                <span class="comment">// æ­¤å¤„å¯ä»¥å–å¾— ajax çš„è¯·æ±‚å‚æ•°</span></span><br><span class="line">                <span class="string">'data'</span>: <span class="built_in">arguments</span>[<span class="number">0</span>] || &#123;&#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">this</span>.addEventListener(<span class="string">'readystatechange'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">this</span>.readyState === <span class="number">4</span>) &#123;</span><br><span class="line">                    <span class="comment">// æ­¤å¤„å¯ä»¥å–å¾—ä¸€äº›å“åº”ä¿¡æ¯</span></span><br><span class="line">                    <span class="comment">// å“åº”ä¿¡æ¯</span></span><br><span class="line">                    xhrmsg[<span class="string">'res'</span>] = <span class="keyword">this</span>.response;</span><br><span class="line">                    xhrmsg[<span class="string">'status'</span>] = <span class="keyword">this</span>.status;</span><br><span class="line">                    <span class="keyword">this</span>.status &gt;= <span class="number">200</span> &amp;&amp; <span class="keyword">this</span>.status &lt; <span class="number">400</span> ?</span><br><span class="line">                        xhrmsg[<span class="string">'level'</span>] = <span class="string">'success'</span> : xhrmsg[<span class="string">'level'</span>] = <span class="string">'error'</span>;</span><br><span class="line">                    xhrArray.push(xhrmsg);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            _self.xhrSend.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="MVVMæ¡†æ¶æä¾›çš„é”™è¯¯å¤„ç†é’©å­"><a href="#MVVMæ¡†æ¶æä¾›çš„é”™è¯¯å¤„ç†é’©å­" class="headerlink" title="MVVMæ¡†æ¶æä¾›çš„é”™è¯¯å¤„ç†é’©å­"></a>MVVMæ¡†æ¶æä¾›çš„é”™è¯¯å¤„ç†é’©å­</h4><p>VUEå’ŒReactéƒ½åˆ†åˆ«æä¾›äº†å¯¹åº”çš„é”™è¯¯å¤„ç†é’©å­ï¼Œç”±äºç¬”è€…ä½¿ç”¨VUEå¤šä¸€äº›ï¼Œè¿™é‡Œä»‹ç»ä¸€ä¸‹VUEçš„é”™è¯¯å¤„ç†ï¼š</p>
<p><strong>VUEå®˜æ–¹æ–‡æ¡£ä»‹ç»ï¼š</strong></p>
<blockquote>
<p>æŒ‡å®šç»„ä»¶çš„æ¸²æŸ“å’Œè§‚å¯ŸæœŸé—´æœªæ•è·é”™è¯¯çš„å¤„ç†å‡½æ•°ã€‚è¿™ä¸ªå¤„ç†å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œå¯è·å–é”™è¯¯ä¿¡æ¯å’Œ Vue å®ä¾‹ã€‚</p>
<p> ä» 2.2.0 èµ·ï¼Œè¿™ä¸ªé’©å­ä¹Ÿä¼šæ•è·ç»„ä»¶ç”Ÿå‘½å‘¨æœŸé’©å­é‡Œçš„é”™è¯¯ã€‚åŒæ ·çš„ï¼Œå½“è¿™ä¸ªé’©å­æ˜¯ <code>undefined</code> æ—¶ï¼Œè¢«æ•è·çš„é”™è¯¯ä¼šé€šè¿‡ <code>console.error</code> è¾“å‡ºè€Œé¿å…åº”ç”¨å´©æºƒã€‚</p>
<p> ä» 2.4.0 èµ·è¿™ä¸ªé’©å­ä¹Ÿä¼šæ•è· Vue è‡ªå®šä¹‰äº‹ä»¶å¤„ç†å‡½æ•°å†…éƒ¨çš„é”™è¯¯äº†ã€‚</p>
</blockquote>
<p>ä¸‹é¢æˆ‘ä»¬çœ‹ä¸€ä¸‹å®é™…æƒ…å†µï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div @click=<span class="string">"clickerror"</span>&gt;error&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>template&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  mounted() &#123;</span><br><span class="line">    <span class="keyword">this</span>.mounterror();</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    mounterror() &#123;</span><br><span class="line">    	<span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"æŠ›å‡ºmounté”™è¯¯"</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    clickerror() &#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"æŠ›å‡ºclické”™è¯¯"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Vue.config.errorHandler = <span class="function">(<span class="params">err, vm, info</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.error(<span class="string">'é€šè¿‡vue errorHandleræ•è·çš„é”™è¯¯'</span>);</span><br><span class="line">  <span class="built_in">console</span>.error(err);</span><br><span class="line">  <span class="built_in">console</span>.error(vm);</span><br><span class="line">  <span class="built_in">console</span>.error(info);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2018/02/21/JSå‰ç«¯é”™è¯¯ç›‘æ§ä¸ä¸ŠæŠ¥/3.jpg" alt=""></p>
<p>å¯ä»¥çœ‹åˆ°ç”Ÿå‘½å‘¨æœŸé’©å­é‡Œçš„é”™è¯¯æ˜¯å¯ä»¥è¢«errorHandleræ•è·åˆ°ï¼Œä½†æ˜¯å½“æˆ‘ä»¬ä¸»åŠ¨ç‚¹å‡»divè§¦å‘clickerroræ—¶ï¼Œä¼šå‘ç°è¿™æ—¶é”™è¯¯å¹¶æ²¡æœ‰è¢«errorHandleræ•è·åˆ°ï¼Œæ§åˆ¶å°è¾“å‡ºçš„æ˜¯Uncaught Errorï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰è¢«æ•è·åˆ°çš„é”™è¯¯ï¼Œæ‰€ä»¥éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒerrorHandleræ–¹æ³•ç›®å‰è¿˜æ•è·ä¸åˆ°ç»‘å®šç›‘å¬äº‹ä»¶è§¦å‘çš„å¼‚å¸¸ï¼Œä½†æ˜¯å¯ä»¥æ•è·åˆ°åœ¨ç”Ÿå‘½å‘¨æœŸé’©å­ä¸­è°ƒç”¨çš„æ–¹æ³•çš„é”™è¯¯ã€‚</p>
<blockquote>
<p>åœ¨Reactä¸­ï¼Œå¯ä»¥ä½¿ç”¨ErrorBoundaryç»„ä»¶åŒ…æ‹¬ä¸šåŠ¡ç»„ä»¶çš„æ–¹å¼è¿›è¡Œå¼‚å¸¸æ•è·ï¼Œé…åˆReact 16.0+æ–°å‡ºçš„componentDidCatch APIï¼Œå¯ä»¥å®ç°ç»Ÿä¸€çš„å¼‚å¸¸æ•è·å’Œæ—¥å¿—ä¸ŠæŠ¥ã€‚</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">class ErrorBoundary extends React.Component &#123;</span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    super(props);</span><br><span class="line">    this.state = &#123; hasError: false &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentDidCatch(error, info) &#123;</span><br><span class="line">    // Display fallback UI</span><br><span class="line">    this.setState(&#123; hasError: true &#125;);</span><br><span class="line">    // You can also log the error to an error reporting service</span><br><span class="line">    logErrorToMyService(error, info);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    if (this.state.hasError) &#123;</span><br><span class="line">      // You can render any custom fallback UI</span><br><span class="line">      return &lt;h1&gt;Something went wrong.&lt;/h1&gt;;</span><br><span class="line">    &#125;</span><br><span class="line">    return this.props.children;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;ErrorBoundary&gt;</span><br><span class="line">  &lt;MyWidget /&gt;</span><br><span class="line">&lt;/ErrorBoundary&gt;</span><br></pre></td></tr></table></figure>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong> ï¼šä½¿ç”¨window.onerror</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.onerror = <span class="function"><span class="keyword">function</span> (<span class="params">message, source, lineno, colno, error</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.error(<span class="string">'é€šè¿‡onerroræ•è·åˆ°çš„é”™è¯¯'</span>);</span><br><span class="line">  <span class="built_in">console</span>.error(message);</span><br><span class="line">  <span class="built_in">console</span>.error(source);</span><br><span class="line">  <span class="built_in">console</span>.error(lineno);</span><br><span class="line">  <span class="built_in">console</span>.error(colno);</span><br><span class="line">  <span class="built_in">console</span>.error(error);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨MVVMæ¡†æ¶ä¸­ä½¿ç”¨onerrorç›‘å¬å…¨å±€å¼‚å¸¸ä¼šå‘ç°å¹¶ä¸èƒ½æ•è·åˆ°ç»‘å®šäº‹ä»¶çš„è¯¦ç»†é”™è¯¯ä¿¡æ¯ï¼Œåªä¼šè¾“å‡ºScript Errorï¼Œ</p>
<p><img src="/2018/02/21/JSå‰ç«¯é”™è¯¯ç›‘æ§ä¸ä¸ŠæŠ¥/4.jpg" alt=""></p>
<p>è¿™æ—¶æˆ‘ä»¬å¯ä»¥å°è¯•è¿›å…¥webpacké…ç½®ï¼Œè®¾ç½®<code>devtool:&quot;source-map&quot;</code>,è¿™æ—¶åœ¨æ§åˆ¶å°å†æ¬¡æ‰“å°å¯ä»¥çœ‹è§æˆåŠŸæ•è·åˆ°ç»‘å®šäº‹ä»¶çš„é”™è¯¯ã€‚</p>
<p><img src="/2018/02/21/JSå‰ç«¯é”™è¯¯ç›‘æ§ä¸ä¸ŠæŠ¥/5.jpg" alt=""></p>
<h3 id="é”™è¯¯ä¸ŠæŠ¥"><a href="#é”™è¯¯ä¸ŠæŠ¥" class="headerlink" title="é”™è¯¯ä¸ŠæŠ¥"></a>é”™è¯¯ä¸ŠæŠ¥</h3><p>ä¸¤ç§ä¸»æµä¸ŠæŠ¥æ–¹å¼ï¼š</p>
<ol>
<li><p>é€šè¿‡Ajaxå‘é€æ•°æ®</p>
<p>å› ä¸ºAjaxè¯·æ±‚æœ¬èº«ä¹Ÿæœ‰å¯èƒ½ä¼šå‘ç”Ÿå¼‚å¸¸ï¼Œè€Œä¸”æœ‰å¯èƒ½ä¼šå¼•å‘è·¨åŸŸé—®é¢˜ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æ›´æ¨èä½¿ç”¨åŠ¨æ€åˆ›å»ºimgæ ‡ç­¾çš„å½¢å¼è¿›è¡Œä¸ŠæŠ¥ã€‚</p>
</li>
<li><p>åŠ¨æ€åˆ›å»º img æ ‡ç­¾çš„å½¢å¼</p>
</li>
</ol>
<p><code>new Image().src = reportUrl + &#39;?msg=&#39; + msg;</code></p>
<h3 id="å‰ç«¯æ€§èƒ½ä¸å¼‚å¸¸ä¸ŠæŠ¥"><a href="#å‰ç«¯æ€§èƒ½ä¸å¼‚å¸¸ä¸ŠæŠ¥" class="headerlink" title="å‰ç«¯æ€§èƒ½ä¸å¼‚å¸¸ä¸ŠæŠ¥"></a><a href="https://github.com/xingbofeng/xingbofeng.github.io/issues/36" target="_blank" rel="noopener">å‰ç«¯æ€§èƒ½ä¸å¼‚å¸¸ä¸ŠæŠ¥</a></h3><h3 id="å‰ç«¯æ€§èƒ½ç›‘æ§ï¼šwindow-performance"><a href="#å‰ç«¯æ€§èƒ½ç›‘æ§ï¼šwindow-performance" class="headerlink" title="å‰ç«¯æ€§èƒ½ç›‘æ§ï¼šwindow.performance"></a><a href="https://libin1991.github.io/2016/04/23/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%EF%BC%9Awindow-performance/" target="_blank" rel="noopener">å‰ç«¯æ€§èƒ½ç›‘æ§ï¼šwindow.performance</a></h3>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/02/03/æˆ‘ä¹Ÿæ¥å®ç°ä¸€æŠŠMVVM/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="èˆåŠ¨ä¹¾å¤">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/03/æˆ‘ä¹Ÿæ¥å®ç°ä¸€æŠŠMVVM/" itemprop="url">æˆ‘ä¹Ÿæ¥å®ç°ä¸€æŠŠMVVM</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-02-03T00:20:32+08:00">
                2018-02-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>å¤§å®¶éƒ½çŸ¥é“ï¼Œvueæ˜¯ä¸ªMVVMæ¡†æ¶ï¼Œèƒ½å¤Ÿå®ç°viewå’Œmodelçš„åŒå‘ç»‘å®šï¼Œä¸åƒbackboneé‚£æ ·ï¼Œmodelæ”¹å˜éœ€è¦æ‰‹åŠ¨å»é€šçŸ¥viewæ›´æ–°ï¼Œè€Œvueå®ç°çš„åŸç†å°±æ˜¯é€šè¿‡Object.definePropertyå®ç°æ•°æ®æŒŸæŒï¼Œå®šä¹‰setterï¼Œç„¶åæ•°æ®æ”¹å˜çš„æ—¶å€™é€šçŸ¥è§†å›¾æ›´æ–°ã€‚</p>
<p>ä¸‹é¢æ˜¯ç½‘ä¸Švueçš„å®ç°åŸç†å›¾ï¼š</p>
<p> <img src="https://user-gold-cdn.xitu.io/2018/4/10/162ad3d5be3e5105?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="image"></p>
<h3 id="å®ç°æ•ˆæœ"><a href="#å®ç°æ•ˆæœ" class="headerlink" title="å®ç°æ•ˆæœ"></a>å®ç°æ•ˆæœ</h3><p><img src="https://user-gold-cdn.xitu.io/2018/8/15/1653b294cd1b80e3?imageslim" alt=""></p>
<h4 id="1ã€MVVM"><a href="#1ã€MVVM" class="headerlink" title="1ã€MVVM"></a>1ã€MVVM</h4><p>å…¥å£æ–‡ä»¶ï¼Œåœ¨è¿™é‡Œå¯¹vueå½“ä¸­çš„$elã€methodsã€$dataè¿›è¡Œåˆå§‹åŒ–ï¼Œè°ƒç”¨observeréå†$dataçš„æ•°æ®å¹¶è¿›è¡ŒæŒŸæŒï¼Œè°ƒç”¨compileéå†$elä¸‹çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œè§£ææŒ‡ä»¤å’Œå–å€¼æ“ä½œã€‚éå†$dataçš„æ•°æ®ï¼Œé€šè¿‡Object.definePropertyçš„getterå’Œsetterå®ç°å¯¹$dataçš„ä»£ç†ã€‚</p>
<h4 id="2ã€Observer"><a href="#2ã€Observer" class="headerlink" title="2ã€Observer"></a>2ã€Observer</h4><p>éå†dataï¼Œé€šè¿‡Object.definePropertyè®¾ç½®getterå’Œsetterï¼Œåœ¨setterçŸ¥é“æ•°æ®å‘ç”Ÿäº†æ”¹å˜ï¼Œç„¶åé€šçŸ¥Wacherå»æ›´æ–°viewã€‚</p>
<h4 id="3ã€Compile"><a href="#3ã€Compile" class="headerlink" title="3ã€Compile"></a>3ã€Compile</h4><p>éå†$elä¸‹çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œè§£ææŒ‡ä»¤å’Œå–å€¼æ“ä½œç­‰ï¼Œä¸ºæ¯ä¸ªèŠ‚ç‚¹ç»‘å®šæ›´æ–°å‡½æ•°ï¼ˆä¸ºä»€ä¹ˆåœ¨compileè¿™é‡Œç»‘å®šå‘¢ï¼Ÿå› ä¸ºè¿™é‡Œåˆšå¥½æ˜¯éå†çš„èŠ‚ç‚¹â˜ºï¼‰ï¼Œç»‘å®šäº‹ä»¶å’Œmethodçš„å…³ç³»ï¼ŒåŒæ—¶ä¹Ÿæ·»åŠ è®¢é˜…è€…ï¼Œå½“æ¥å—åˆ°è§†å›¾æ›´æ–°çš„è®¢é˜…æ¶ˆæ¯åï¼Œè°ƒç”¨æ›´æ–°å‡½æ•°ï¼Œå®ç°è§†å›¾æ›´æ–°ã€‚åŒæ—¶åœ¨æ·»åŠ è®¢é˜…è€…çš„æ—¶å€™ï¼Œåˆå§‹åŒ–æ¸²æŸ“è§†å›¾ã€‚</p>
<h4 id="4ã€Watcher"><a href="#4ã€Watcher" class="headerlink" title="4ã€Watcher"></a>4ã€Watcher</h4><p>Watcherä½œä¸ºè®¢é˜…è€…ï¼Œå……å½“Observerå’ŒCompileçš„ä¸­é—´æ¡¥æ¢ï¼ŒåŒ…å«updateæ–¹æ³•ï¼Œupdateæ–¹æ³•è°ƒç”¨Compileä¸­ç»‘å®šçš„äº‹ä»¶æ›´æ–°å‡½æ•°ï¼Œå®ç°å¯¹è§†å›¾çš„åˆå§‹åŒ–å’Œæ›´æ–°æ“ä½œã€‚</p>
<h3 id="MVVMçš„å®ç°"><a href="#MVVMçš„å®ç°" class="headerlink" title="MVVMçš„å®ç°"></a>MVVMçš„å®ç°</h3><p>MVVMå®Œæˆåˆå§‹åŒ–æ“ä½œï¼Œå¹¶ä¸”è°ƒç”¨observerå’Œcompileã€‚å¯¹$dataè¿›è¡Œä»£ç†ï¼Œå¦‚æ­¤ä¾¿å¯ä»¥é€šè¿‡this.attributeæ¥ä»£ç†this.$data.attributeã€‚å› ä¸ºä¸€ä¸ªå±æ€§å¯èƒ½å¯¹åº”å¤šä¸ªæŒ‡ä»¤ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ª_bindingå±æ€§æ¥å­˜æ”¾å±æ€§å¯¹åº”çš„æ‰€æœ‰è®¢é˜…è€…ï¼Œè¿™æ ·å±æ€§ä¸€æ”¹å˜ï¼Œå°±å¯ä»¥å–å‡ºæ‰€æœ‰çš„è®¢é˜…è€…å»æ›´æ–°è§†å›¾ã€‚</p>
<pre><code>function MVVM(options) {
  // åˆå§‹åŒ–
  this.$data = options.data;
  this.$methods = options.methods;
  this.$el = options.el;
  // ä¿å­˜dataçš„æ¯ä¸ªå±æ€§å¯¹åº”çš„æ‰€æœ‰watcher
  this._binding  = {};
  // è°ƒç”¨observerå’Œcompile
  this._observer(options.data);
  this._compile();
  // this.xxx ä»£ç†this.$data.xxx
  this.proxyAttribute();
}
</code></pre><h3 id="Observerçš„å®ç°"><a href="#Observerçš„å®ç°" class="headerlink" title="Observerçš„å®ç°"></a>Observerçš„å®ç°</h3><p>Observeréå†$dataï¼Œé€šè¿‡Object.definePropertyçš„setterçš„æŒŸæŒæ•°æ®æ”¹å˜ï¼Œç›‘å¬åˆ°æ•°æ®æ”¹å˜åå–å‡ºæ‰€æœ‰è¯¥å±æ€§å¯¹åº”çš„è®¢é˜…è€…ï¼Œç„¶åé€šçŸ¥æ›´æ–°å‡½æ•°æ›´æ–°è§†å›¾ã€‚</p>
<p>æ³¨æ„ï¼šè¿™é‡Œæœ‰å¾ªç¯ï¼Œä¸”é—­åŒ…ï¼ˆgetterå’Œsetterï¼‰é‡Œé¢éœ€è¦ä¾èµ–å¾ªç¯é¡¹ï¼ˆvalueå’Œkeyï¼‰ï¼Œæ‰€ä»¥ç”¨ç«‹å³æ‰§è¡Œå‡½æ•°è§£å†³å¾ªç¯é¡¹è·å–ä¸å¯¹çš„é—®é¢˜ã€‚</p>
<pre><code>MVVM.prototype._observer = function(data) {
  var self = this;
  for(var key in this.$data) {
    if (this.$data.hasOwnProperty(key)) {
      // åˆå§‹åŒ–å±æ€§å¯¹åº”çš„è®¢é˜…è€…å®¹å™¨ï¼ˆæ•°ç»„ï¼‰
      this._binding[key] = {
        _directives: [],
        _texts: []
      };

      if(typeof this.$data[key] === &quot;object&quot;) {
        return this._observer(this.$data[key]);
      }
      var val = data[key];
      // ç«‹å³æ‰§è¡Œå‡½æ•°è·å–æ­£ç¡®çš„å¾ªç¯é¡¹
      (function(value, key) {
        Object.defineProperty(self.$data, key, {
          enumerable: true,
          configurable: true,
          get: function() {
            return value;
          },
          set(newval) {
            if(newval === value) {
              return;
            }
            value = newval;
            // ç›‘å¬åˆ°æ•°æ®æ”¹å˜åå–å‡ºæ‰€æœ‰è¯¥å±æ€§å¯¹åº”çš„è®¢é˜…è€…ï¼Œé€šçŸ¥viewæ›´æ–°-å±æ€§
            if(self._binding[key]._directives) {
              self._binding[key]._directives.forEach(function(watcher) {
                watcher.update();
              }, self);
            }
            // ç›‘å¬åˆ°æ•°æ®æ”¹å˜åå–å‡ºæ‰€æœ‰è¯¥å±æ€§å¯¹åº”çš„è®¢é˜…è€…ï¼Œé€šçŸ¥viewæ›´æ–°-æ–‡æœ¬
            if(self._binding[key]._texts) {
              self._binding[key]._texts.forEach(function(watcher) {
                watcher.update();
              }, self);
            }
          }
        });
      })(val, key);
    }
  }
}
</code></pre><h3 id="Compileçš„å®ç°"><a href="#Compileçš„å®ç°" class="headerlink" title="Compileçš„å®ç°"></a>Compileçš„å®ç°</h3><p>Compileéå†æ‰€æœ‰çš„èŠ‚ç‚¹ï¼Œè§£ææŒ‡ä»¤ï¼Œä¸ºæ¯ä¸ªèŠ‚ç‚¹ç»‘å®šæ›´æ–°å‡½æ•°ï¼Œä¸”æ·»åŠ è®¢é˜…è€…ï¼Œå½“è®¢é˜…è€…é€šçŸ¥viewæ›´æ–°çš„æ—¶å€™ï¼Œè°ƒç”¨æ›´æ–°å‡½æ•°ï¼Œå®ç°å¯¹è§†å›¾çš„æ›´æ–°ã€‚</p>
<p>è¿™é‡ŒåŒæ ·éœ€è¦ä½¿ç”¨ç«‹å³æ‰§è¡Œå‡½æ•°æ¥è§£å†³é—­åŒ…ä¾èµ–çš„å¾ªç¯é¡¹é—®é¢˜ã€‚</p>
<p>è¿˜æœ‰ä¸€ç‚¹éœ€è¦è§£å†³çš„æ˜¯ï¼Œå¦‚æœèŠ‚ç‚¹çš„innerTextä¾èµ–å¤šä¸ªå±æ€§çš„è¯ï¼Œå¦‚ä½•åšåˆ°åªæ›¿æ¢æ”¹å˜å±æ€§å¯¹åº”çš„æ–‡æœ¬é—®é¢˜ã€‚</p>
<p>æ¯”å¦‚ï¼šå·²ç»è¢«ç¼–è¯‘è§£ææˆâ€œæ¬¢è¿ï¼š é¸£äººâ€ï¼Œå¦‚æœmessageæ”¹å˜ä¸ºâ€œä½ å¥½â€ï¼Œæ€ä¹ˆè®©ä½¿å¾—â€œæ¬¢è¿ï¼šé¸£äººâ€æ”¹ä¸ºâ€œä½ å¥½ï¼šé¸£äººâ€ã€‚</p>
<pre><code>MVVM.prototype._compile = function() {
  var dom = document.querySelector(this.$el);
  var children = dom.children;
  var self = this;
  var i = 0, j = 0;
  // æ›´æ–°å‡½æ•°ï¼Œä½†observerä¸­modelçš„æ•°æ®æ”¹å˜çš„æ—¶å€™ï¼Œé€šè¿‡Watcherçš„updateè°ƒç”¨æ›´æ–°å‡½æ•°ï¼Œä»è€Œæ›´æ–°dom
  var updater = null;
  for(; i &lt; children.length; i++) {
    var node = children[i];
    (function(node) {
      // è§£æ{{}}é‡Œé¢çš„å†…å®¹
      // ä¿å­˜æŒ‡ä»¤åŸå§‹å†…å®¹ï¼Œä¸ç„¶æ•°æ®æ›´æ–°æ—¶æ— æ³•å®Œæˆæ›¿æ¢
      var text = node.innerText;
      var matches = text.match(/{{([^{}]+)}}/g);
      if(matches &amp;&amp; matches.length &gt; 0) {
        // ä¿å­˜å’Œnodeç»‘å®šçš„æ‰€æœ‰å±æ€§
        node.bindingAttributes = [];
        for(j = 0; j &lt; matches.length; j++) {
          // dataæŸä¸ªå±æ€§
          var attr = matches[j].match(/{{([^{}]+)}}/)[1];
          // å°†å’Œè¯¥nodeç»‘å®šçš„dataå±æ€§ä¿å­˜èµ·æ¥
          node.bindingAttributes.push(attr);
          (function(attr) {
            updater = function() {
              // æ”¹å˜çš„å±æ€§å€¼å¯¹åº”çš„æ–‡æœ¬è¿›è¡Œæ›¿æ¢
              var innerText = text.replace(new RegExp(&quot;{{" + attr + "}}&quot;, &quot;g&quot;), self.$data[attr]);
              // å¦‚æœè¯¥nodeç»‘å®šå¤šä¸ªå±æ€§ eg:&lt;div&gt;{{title}}{{description}}&lt;/div&gt;
              for(var k = 0; k &lt; node.bindingAttributes.length; k++) {
                if(node.bindingAttributes[k] !== attr) {
                  // æ¢å¤åŸæ¥æ²¡æ”¹å˜çš„å±æ€§å¯¹åº”çš„æ–‡æœ¬
                  innerText = innerText.replace(&quot;{{" + node.bindingAttributes[k] + "}}&quot;, self.$data[node.bindingAttributes[k]]);
                }
              }
              node.innerText = innerText;
            }
            self._binding[attr]._texts.push(new Watcher(self, attr, updater));
          })(attr);
        }
      }

      // è§£ævueæŒ‡ä»¤
      var attributes = node.getAttributeNames();
      for(j = 0; j &lt; attributes.length; j++) {
        // vueæŒ‡ä»¤
        var attribute = attributes[j];
        // DOM attribute
        var domAttr = null;
        // ç»‘å®šçš„dataå±æ€§
        var vmDataAttr = node.getAttribute(attribute);

        if(/v-bind:([^=]+)/.test(attribute)) {
          // è§£æv-bind
          domAttr = RegExp.$1;
          // æ›´æ–°å‡½æ•°
          updater = function(val) {
            node[domAttr] = val;
          }
          // dataå±æ€§ç»‘å®šå¤šä¸ªwatcher
          self._binding[vmDataAttr]._directives.push(
            new Watcher(self, vmDataAttr, updater)
          )
        } elseif(attribute === &quot;v-model&quot; &amp;&amp; (node.tagName = &apos;INPUT&apos; || node.tagName == &apos;TEXTAREA&apos;)) {
          // è§£æv-model
          // æ›´æ–°å‡½æ•°
          updater = function(val) {
            node.value = val;
          }
          // dataå±æ€§ç»‘å®šå¤šä¸ªwatcher
          self._binding[vmDataAttr]._directives.push(
            new Watcher(self, vmDataAttr, updater)
          )
          // ç›‘å¬input/textareaçš„æ•°æ®å˜åŒ–ï¼ŒåŒæ­¥åˆ°modelå»ï¼Œå®ç°åŒå‘ç»‘å®š
          node.addEventListener(&quot;input&quot;, function(evt) {
            var $el = evt.currentTarget;
            self.$data[vmDataAttr] = $el.value;
          });
        } elseif(/v-on:([^=]+)/.test(attribute)) {
          // è§£æv-on
          var event = RegExp.$1;
          var method = vmDataAttr;
          node.addEventListener(event, function(evt) {
            self.$methods[method] &amp;&amp; self.$methods[method].call(self, evt);
          });
        }
      }
    })(node);
  }

}
</code></pre><h3 id="Watcherçš„å®ç°"><a href="#Watcherçš„å®ç°" class="headerlink" title="Watcherçš„å®ç°"></a>Watcherçš„å®ç°</h3><p>Watcherå……å½“è®¢é˜…è€…çš„è§’è‰²ï¼Œæ¶èµ·äº†Observerå’ŒCompileçš„æ¡¥æ¢ï¼ŒObserverç›‘å¬åˆ°æ•°æ®å˜åŒ–åï¼Œé€šçŸ¥Wathceræ›´æ–°è§†å›¾(è°ƒç”¨Wathcerçš„updateæ–¹æ³•)ï¼ŒWatcherå†å‘Šè¯‰Compileå»è°ƒç”¨æ›´æ–°å‡½æ•°ï¼Œå®ç°domçš„æ›´æ–°ã€‚åŒæ—¶é¡µé¢çš„åˆå§‹åŒ–æ¸²æŸ“ä¹Ÿäº¤ç»™äº†Watcherï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥æ”¾åˆ°Compileè¿›è¡Œï¼‰ã€‚</p>
<pre><code>function Watcher(vm, attr, cb) {
  this.vm = vm; // viewmodel
  this.attr = attr; // dataçš„å±æ€§ï¼Œä¸€ä¸ªwatcherè®¢é˜…ä¸€ä¸ªdataå±æ€§
  this.cb = cb; // æ›´æ–°å‡½æ•°ï¼Œåœ¨compileé‚£è¾¹å®šä¹‰
  // åˆå§‹åŒ–æ¸²æŸ“è§†å›¾
  this.update();
}

Watcher.prototype.update = function() {
  // é€šçŸ¥comileä¸­çš„æ›´æ–°å‡½æ•°æ›´æ–°dom 
  this.cb(this.vm.$data[this.attr]);
}
</code></pre><h3 id="å…¨éƒ¨ä»£ç "><a href="#å…¨éƒ¨ä»£ç " class="headerlink" title="å…¨éƒ¨ä»£ç "></a>å…¨éƒ¨ä»£ç </h3><p>gitåœ°å€ï¼š<a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2FVikiLee%2FMVVM.git" target="_blank" rel="noopener">github.com/VikiLee/MVVâ€¦</a></p>
<p>é¸£è°¢ï¼š<a href="https://link.juejin.im?target=https%3A%2F%2Fjuejin.im%2Fpost%2F5acc17cb51882555745a03f8" target="_blank" rel="noopener">juejin.im/post/5acc17â€¦</a></p>
<h3 id="ä½¿ç”¨ä¾‹å­"><a href="#ä½¿ç”¨ä¾‹å­" class="headerlink" title="ä½¿ç”¨ä¾‹å­"></a>ä½¿ç”¨ä¾‹å­</h3><pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
  &lt;meta charset=&quot;UTF-8&quot;&gt;
  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
  &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;
  &lt;title&gt;Document&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div id=&quot;view&quot;&gt;
    &lt;div v-bind:id=&quot;id&quot;&gt;
      {{message}}:{{name}}
    &lt;/div&gt;
    &lt;input type=&quot;text&quot; v-model=&quot;name&quot;/&gt;
    &lt;button v-on:click=&quot;handleClick&quot;&gt;è·å–è¾“å…¥å€¼&lt;/button&gt;
  &lt;/div&gt;
&lt;/body&gt;
&lt;script src=&quot;js/MVVM.js&quot;type=&quot;text/javascript&quot;&gt;&lt;/script&gt;
&lt;script&gt;
  var vue = new MVVM({
    el: &quot;#view&quot;,
    data: {
      message: &quot;æ¬¢è¿å…‰ä¸´&quot;,
      name: &quot;é¸£äºº&quot;,
      id: &quot;id&quot;
    },
    methods: {
      handleClick: function() {
        alert(this.message + &quot;:&quot; + this.name + &quot;, ç‚¹å‡»ç¡®å®šè·¯é£ä¼šå‡ºæ¥&quot;);
        this.name = &apos;è·¯é£&apos;;
      }
    }
  })

  setTimeout(function() {
    vue.message = &quot;ä½ å¥½&quot;;
  }, 1000);
&lt;/script&gt;
&lt;/html&gt;
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/23/Web-å®‰å…¨æ”»é˜²æ€»ç»“/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="èˆåŠ¨ä¹¾å¤">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/23/Web-å®‰å…¨æ”»é˜²æ€»ç»“/" itemprop="url">Web å®‰å…¨æ”»é˜²æ€»ç»“</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-01-23T20:02:04+08:00">
                2018-01-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Web å®‰å…¨çš„å¯¹äº Web ä»ä¸šäººå‘˜æ¥è¯´æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„è¯¾é¢˜ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œæ€»ç»“ä¸€ä¸‹ Web ç›¸å…³çš„å®‰å…¨æ”»é˜²çŸ¥è¯†ï¼Œå¸Œæœ›ä»¥åä¸è¦å†è¸©é›·ï¼Œä¹Ÿå¸Œæœ›å¯¹çœ‹åˆ°è¿™ç¯‡æ–‡ç« çš„åŒå­¦æœ‰æ‰€å¸®åŠ©ã€‚ä»Šå¤©è¿™è¾¹æ–‡ç« ä¸»è¦çš„å†…å®¹å°±æ˜¯åˆ†æå‡ ç§å¸¸è§çš„æ”»å‡»çš„ç±»å‹ä»¥åŠé˜²å¾¡çš„æ–¹æ³•ã€‚</p>
<blockquote>
<p>ä¹Ÿè®¸ä½ å¯¹æ‰€æœ‰çš„å®‰å…¨é—®é¢˜éƒ½æœ‰ä¸€å®šçš„è®¤è¯†ï¼Œä½†æœ€ä¸»è¦çš„è¿˜æ˜¯åœ¨ç¼–ç è®¾è®¡çš„è¿‡ç¨‹ä¸­æ—¶åˆ»ç»·ç´§å®‰å…¨é‚£æ ¹å¼¦ï¼Œéœ€è¦åå¤æ¨æ•²æ¯ä¸ªå®ç°ç»†èŠ‚ï¼Œå®‰å…¨æ— å°äº‹ã€‚</p>
<p>æœ¬æ–‡ä»£ç  Demo éƒ½æ˜¯åŸºäº Node.js è®²è§£ï¼Œå…¶ä»–æœåŠ¡ç«¯è¯­è¨€åŒæ ·å¯ä»¥å‚è€ƒã€‚</p>
</blockquote>
<h2 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h2><p>é¦–å…ˆè¯´ä¸‹æœ€å¸¸è§çš„ XSS æ¼æ´ï¼ŒXSS (Cross Site Script)ï¼Œè·¨ç«™è„šæœ¬æ”»å‡»ï¼Œå› ä¸ºç¼©å†™å’Œ CSS (Cascading Style Sheets) é‡å ï¼Œæ‰€ä»¥åªèƒ½å« XSSã€‚</p>
<p>XSS çš„åŸç†æ˜¯æ¶æ„æ”»å‡»è€…å¾€ Web é¡µé¢é‡Œæ’å…¥æ¶æ„å¯æ‰§è¡Œç½‘é¡µè„šæœ¬ä»£ç ï¼Œå½“ç”¨æˆ·æµè§ˆè¯¥é¡µä¹‹æ—¶ï¼ŒåµŒå…¥å…¶ä¸­ Web é‡Œé¢çš„è„šæœ¬ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»è€Œå¯ä»¥è¾¾åˆ°æ”»å‡»è€…ç›—å–ç”¨æˆ·ä¿¡æ¯æˆ–å…¶ä»–ä¾µçŠ¯ç”¨æˆ·å®‰å…¨éšç§çš„ç›®çš„ã€‚XSS çš„æ”»å‡»æ–¹å¼åƒå˜ä¸‡åŒ–ï¼Œä½†è¿˜æ˜¯å¯ä»¥å¤§è‡´ç»†åˆ†ä¸ºå‡ ç§ç±»å‹ã€‚</p>
<h3 id="éæŒä¹…å‹-XSS"><a href="#éæŒä¹…å‹-XSS" class="headerlink" title="éæŒä¹…å‹ XSS"></a>éæŒä¹…å‹ XSS</h3><p>éæŒä¹…å‹ XSS æ¼æ´ï¼Œä¹Ÿå«åå°„å‹ XSS æ¼æ´ï¼Œä¸€èˆ¬æ˜¯é€šè¿‡ç»™åˆ«äººå‘é€å¸¦æœ‰æ¶æ„è„šæœ¬ä»£ç å‚æ•°çš„ URLï¼Œå½“ URL åœ°å€è¢«æ‰“å¼€æ—¶ï¼Œç‰¹æœ‰çš„æ¶æ„ä»£ç å‚æ•°è¢« HTML è§£æã€æ‰§è¡Œã€‚<br><img src="/2018/01/23/Web-å®‰å…¨æ”»é˜²æ€»ç»“/xss1.jpg" alt="éæŒä¹…å‹ XSS"><br>ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œæ¯”å¦‚ä½ çš„ Web é¡µé¢ä¸­åŒ…å«æœ‰ä»¥ä¸‹ä»£ç ï¼š</p>
<pre><code>&lt;select&gt;
    &lt;script&gt;
        document.write(&apos;&apos;
                + &apos;&lt;optionvalue=1&gt;&apos;
                +     location.href.substring(location.href.indexOf(&apos;default=&apos;) + 8)
                + &apos;&lt;/option&gt;&apos;
            );
            document.write(&apos;&lt;optionvalue=2&gt;English&lt;/option&gt;&apos;);
    &lt;/script&gt;
&lt;/select&gt;
</code></pre><p>æ”»å‡»è€…å¯ä»¥ç›´æ¥é€šè¿‡ URL (ç±»ä¼¼ï¼š </p>
<pre><code>https://xx.com/xx?default=&lt;script&gt;alert(document.cookie)&lt;/script&gt;
</code></pre><p>æ³¨å…¥å¯æ‰§è¡Œçš„è„šæœ¬ä»£ç ã€‚</p>
<p>éæŒä¹…å‹ XSS æ¼æ´æ”»å‡»æœ‰ä»¥ä¸‹å‡ ç‚¹<strong>ç‰¹å¾</strong>ï¼š</p>
<ul>
<li>å³æ—¶æ€§ï¼Œä¸ç»è¿‡æœåŠ¡å™¨å­˜å‚¨ï¼Œç›´æ¥é€šè¿‡ HTTP çš„ GET å’Œ POST è¯·æ±‚å°±èƒ½å®Œæˆä¸€æ¬¡æ”»å‡»ï¼Œæ‹¿åˆ°ç”¨æˆ·éšç§æ•°æ®ã€‚</li>
<li>æ”»å‡»è€…éœ€è¦è¯±éª—ç‚¹å‡»</li>
<li>åé¦ˆç‡ä½ï¼Œæ‰€ä»¥è¾ƒéš¾å‘ç°å’Œå“åº”ä¿®å¤</li>
<li>ç›—å–ç”¨æˆ·æ•æ„Ÿä¿å¯†ä¿¡æ¯</li>
</ul>
<p>ä¸ºäº†<strong>é˜²æ­¢å‡ºç°éæŒä¹…å‹ XSS æ¼æ´</strong>ï¼Œéœ€è¦ç¡®ä¿è¿™ä¹ˆå‡ ä»¶äº‹æƒ…ï¼š</p>
<ul>
<li>Web é¡µé¢æ¸²æŸ“çš„æ‰€æœ‰å†…å®¹æˆ–è€…æ¸²æŸ“çš„æ•°æ®éƒ½å¿…é¡»æ¥è‡ªäºæœåŠ¡ç«¯ã€‚</li>
<li>å°½é‡ä¸è¦ä» URLï¼Œ<code>document.referrer</code>ï¼Œ<code>document.forms</code> ç­‰è¿™ç§ DOM API ä¸­è·å–æ•°æ®ç›´æ¥æ¸²æŸ“ã€‚</li>
<li>å°½é‡ä¸è¦ä½¿ç”¨ <code>eval</code>, <code>new Function()</code>ï¼Œ<code>document.write()</code>ï¼Œ<code>document.writeln()</code>ï¼Œ<code>window.setInterval()</code>ï¼Œ<code>window.setTimeout()</code>ï¼Œ<code>innerHTML</code>ï¼Œ<code>document.creteElement()</code> ç­‰å¯æ‰§è¡Œå­—ç¬¦ä¸²çš„æ–¹æ³•ã€‚</li>
<li>å¦‚æœåšä¸åˆ°ä»¥ä¸Šå‡ ç‚¹ï¼Œä¹Ÿå¿…é¡»å¯¹æ¶‰åŠ DOM æ¸²æŸ“çš„æ–¹æ³•ä¼ å…¥çš„å­—ç¬¦ä¸²å‚æ•°åš escape è½¬ä¹‰ã€‚</li>
<li>å‰ç«¯æ¸²æŸ“çš„æ—¶å€™å¯¹ä»»ä½•çš„å­—æ®µéƒ½éœ€è¦åš escape è½¬ä¹‰ç¼–ç ã€‚</li>
</ul>
<blockquote>
<p>escape è½¬ä¹‰çš„ç›®çš„æ˜¯å°†ä¸€äº›æ„æˆ HTML æ ‡ç­¾çš„å…ƒç´ è½¬ä¹‰ï¼Œæ¯”å¦‚ <code>&lt;</code>ï¼Œ<code>&gt;</code>ï¼Œ<code>ç©ºæ ¼</code> ç­‰ï¼Œè½¬ä¹‰æˆ <code>&amp;lt;</code>ï¼Œ<code>&amp;gt;</code>ï¼Œ<code>&amp;nbsp;</code> ç­‰æ˜¾ç¤ºè½¬ä¹‰å­—ç¬¦ã€‚æœ‰å¾ˆå¤šå¼€æºçš„å·¥å…·å¯ä»¥ååŠ©æˆ‘ä»¬åš escape è½¬ä¹‰ã€‚</p>
</blockquote>
<h3 id="æŒä¹…å‹-XSS"><a href="#æŒä¹…å‹-XSS" class="headerlink" title="æŒä¹…å‹ XSS"></a>æŒä¹…å‹ XSS</h3><p>æŒä¹…å‹ XSS æ¼æ´ï¼Œä¹Ÿè¢«ç§°ä¸ºå­˜å‚¨å‹ XSS æ¼æ´ï¼Œä¸€èˆ¬å­˜åœ¨äº Form è¡¨å•æäº¤ç­‰äº¤äº’åŠŸèƒ½ï¼Œå¦‚å‘å¸–ç•™è¨€ï¼Œæäº¤æ–‡æœ¬ä¿¡æ¯ç­‰ï¼Œé»‘å®¢åˆ©ç”¨çš„ XSS æ¼æ´ï¼Œå°†å†…å®¹ç»æ­£å¸¸åŠŸèƒ½æäº¤è¿›å…¥æ•°æ®åº“æŒä¹…ä¿å­˜ï¼Œå½“å‰ç«¯é¡µé¢è·å¾—åç«¯ä»æ•°æ®åº“ä¸­è¯»å‡ºçš„æ³¨å…¥ä»£ç æ—¶ï¼Œæ°å¥½å°†å…¶æ¸²æŸ“æ‰§è¡Œã€‚</p>
<p>ä¸»è¦æ³¨å…¥é¡µé¢æ–¹å¼å’ŒéæŒä¹…å‹ XSS æ¼æ´ç±»ä¼¼ï¼Œåªä¸è¿‡æŒä¹…å‹çš„ä¸æ˜¯æ¥æºäº URLï¼Œreffererï¼Œforms ç­‰ï¼Œè€Œæ˜¯æ¥æºäºåç«¯ä»æ•°æ®åº“ä¸­è¯»å‡ºæ¥çš„æ•°æ®ã€‚æŒä¹…å‹ XSS æ”»å‡»ä¸éœ€è¦è¯±éª—ç‚¹å‡»ï¼Œé»‘å®¢åªéœ€è¦åœ¨æäº¤è¡¨å•çš„åœ°æ–¹å®Œæˆæ³¨å…¥å³å¯ï¼Œä½†æ˜¯è¿™ç§ XSS æ”»å‡»çš„æˆæœ¬ç›¸å¯¹è¿˜æ˜¯å¾ˆé«˜ã€‚æ”»å‡»æˆåŠŸéœ€è¦åŒæ—¶æ»¡è¶³ä»¥ä¸‹å‡ ä¸ªæ¡ä»¶ï¼š</p>
<ul>
<li>POST è¯·æ±‚æäº¤è¡¨å•åç«¯æ²¡åšè½¬ä¹‰ç›´æ¥å…¥åº“ã€‚</li>
<li>åç«¯ä»æ•°æ®åº“ä¸­å–å‡ºæ•°æ®æ²¡åšè½¬ä¹‰ç›´æ¥è¾“å‡ºç»™å‰ç«¯ã€‚</li>
<li>å‰ç«¯æ‹¿åˆ°åç«¯æ•°æ®æ²¡åšè½¬ä¹‰ç›´æ¥æ¸²æŸ“æˆ DOMã€‚</li>
</ul>
<p>æŒä¹…å‹ XSS æœ‰ä»¥ä¸‹å‡ ä¸ª<strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>æŒä¹…æ€§ï¼Œæ¤å…¥åœ¨æ•°æ®åº“ä¸­</li>
<li>å±å®³é¢å¹¿ï¼Œç”šè‡³å¯ä»¥è®©ç”¨æˆ·æœºå™¨å˜æˆ DDoS æ”»å‡»çš„è‚‰é¸¡ã€‚</li>
<li>ç›—å–ç”¨æˆ·æ•æ„Ÿç§å¯†ä¿¡æ¯</li>
</ul>
<p>ä¸ºäº†<strong>é˜²æ­¢æŒä¹…å‹ XSS æ¼æ´</strong>ï¼Œéœ€è¦å‰åç«¯å…±åŒåŠªåŠ›ï¼š</p>
<ul>
<li>åç«¯åœ¨å…¥åº“å‰åº”è¯¥é€‰æ‹©ä¸ç›¸ä¿¡ä»»ä½•å‰ç«¯æ•°æ®ï¼Œå°†æ‰€æœ‰çš„å­—æ®µç»Ÿä¸€è¿›è¡Œè½¬ä¹‰å¤„ç†ã€‚</li>
<li>åç«¯åœ¨è¾“å‡ºç»™å‰ç«¯æ•°æ®ç»Ÿä¸€è¿›è¡Œè½¬ä¹‰å¤„ç†ã€‚</li>
<li>å‰ç«¯åœ¨æ¸²æŸ“é¡µé¢ DOM çš„æ—¶å€™åº”è¯¥é€‰æ‹©ä¸ç›¸ä¿¡ä»»ä½•åç«¯æ•°æ®ï¼Œä»»ä½•å­—æ®µéƒ½éœ€è¦åšè½¬ä¹‰å¤„ç†ã€‚</li>
</ul>
<h3 id="åŸºäºå­—ç¬¦é›†çš„-XSS"><a href="#åŸºäºå­—ç¬¦é›†çš„-XSS" class="headerlink" title="åŸºäºå­—ç¬¦é›†çš„ XSS"></a>åŸºäºå­—ç¬¦é›†çš„ XSS</h3><p>å…¶å®ç°åœ¨å¾ˆå¤šçš„æµè§ˆå™¨ä»¥åŠå„ç§å¼€æºçš„åº“éƒ½ä¸“é—¨é’ˆå¯¹äº† XSS è¿›è¡Œè½¬ä¹‰å¤„ç†ï¼Œå°½é‡é»˜è®¤æŠµå¾¡ç»å¤§å¤šæ•° XSS æ”»å‡»ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰å¾ˆå¤šæ–¹å¼å¯ä»¥ç»•è¿‡è½¬ä¹‰è§„åˆ™ï¼Œè®©äººé˜²ä¸èƒœé˜²ã€‚æ¯”å¦‚ã€ŒåŸºäºå­—ç¬¦é›†çš„ XSS æ”»å‡»ã€å°±æ˜¯ç»•è¿‡è¿™äº›è½¬ä¹‰å¤„ç†çš„ä¸€ç§æ”»å‡»æ–¹å¼ï¼Œæ¯”å¦‚æœ‰äº› Web é¡µé¢å­—ç¬¦é›†ä¸å›ºå®šï¼Œç”¨æˆ·è¾“å…¥éæœŸæœ›å­—ç¬¦é›†çš„å­—ç¬¦ï¼Œæœ‰æ—¶ä¼šç»•è¿‡è½¬ä¹‰è¿‡æ»¤è§„åˆ™ã€‚</p>
<p>ä»¥åŸºäº utf-7 çš„ XSS ä¸ºä¾‹</p>
<p>utf-7 æ˜¯å¯ä»¥å°†æ‰€æœ‰çš„ unicode é€šè¿‡ 7bit æ¥è¡¨ç¤ºçš„ä¸€ç§å­—ç¬¦é›† (ä½†ç°åœ¨å·²ç»ä» Unicode è§„æ ¼ä¸­ç§»é™¤)ã€‚</p>
<p>è¿™ä¸ªå­—ç¬¦é›†ä¸ºäº†é€šè¿‡ 7bit æ¥è¡¨ç¤ºæ‰€æœ‰çš„æ–‡å­—, é™¤å»æ•°å­—å’Œä¸€éƒ¨åˆ†çš„ç¬¦å·,å…¶å®ƒçš„éƒ¨åˆ†å°†éƒ½ä»¥ base64 ç¼–ç ä¸ºåŸºç¡€çš„æ–¹å¼å‘ˆç°ã€‚</p>
<pre><code>&lt;script&gt;alert(&quot;xss&quot;)&lt;/script&gt;
      å¯ä»¥è¢«è§£é‡Šä¸ºï¼š
+ADw-script+AD4-alert(+ACI-xss+ACI-)+ADw-/script+AD4-
</code></pre><p>å¯ä»¥å½¢æˆã€ŒåŸºäºå­—ç¬¦é›†çš„ XSS æ”»å‡»ã€çš„åŸå› æ˜¯ç”±äºæµè§ˆå™¨åœ¨ meta æ²¡æœ‰æŒ‡å®š charset çš„æ—¶å€™æœ‰è‡ªåŠ¨è¯†åˆ«ç¼–ç çš„æœºåˆ¶ï¼Œæ‰€ä»¥è¿™ç±»æ”»å‡»é€šå¸¸å°±æ˜¯å‘ç”Ÿåœ¨æ²¡æœ‰æŒ‡å®šæˆ–è€…æ²¡æ¥å¾—åŠæŒ‡å®š meta æ ‡ç­¾çš„ charset çš„æƒ…å†µä¸‹ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬æœ‰ä»€ä¹ˆåŠæ³•é¿å…è¿™ç§ XSS å‘¢ï¼Ÿ</p>
<ul>
<li>è®°ä½æŒ‡å®š <code>&lt;meta charset=&quot;utf-8&quot;&gt;</code></li>
<li>XML ä¸­ä¸ä»…è¦æŒ‡å®šå­—ç¬¦é›†ä¸º utf-8ï¼Œè€Œä¸”æ ‡ç­¾è¦é—­åˆ</li>
<li>ç‰›æ–‡æ¨èï¼š<a href="http://drops.wooyun.org/papers/1327" target="_blank" rel="noopener">http://drops.wooyun.org/papers/1327</a> ï¼ˆè¿™ä¸ªè®²çš„å¾ˆè¯¦ç»†ï¼‰</li>
</ul>
<h3 id="åŸºäº-Flash-çš„è·¨ç«™-XSS"><a href="#åŸºäº-Flash-çš„è·¨ç«™-XSS" class="headerlink" title="åŸºäº Flash çš„è·¨ç«™ XSS"></a>åŸºäº Flash çš„è·¨ç«™ XSS</h3><p>åŸºäº Flash çš„è·¨ç«™ XSS ä¹Ÿæ˜¯å±äºåå°„å‹ XSS çš„ä¸€ç§ï¼Œè™½ç„¶ç°åœ¨å¼€å‘ ActionScript çš„äº§å“çº¿å‡ ä¹æ²¡æœ‰äº†ï¼Œä½†è¿˜æ˜¯æä¸€å¥å§ï¼ŒAS è„šæœ¬å¯ä»¥æ¥å—ç”¨æˆ·è¾“å…¥å¹¶æ“ä½œ cookieï¼Œæ”»å‡»è€…å¯ä»¥é…åˆå…¶ä»– XSSï¼ˆæŒä¹…å‹æˆ–è€…éæŒä¹…å‹ï¼‰æ–¹æ³•å°†æ¶æ„ swf æ–‡ä»¶åµŒå…¥é¡µé¢ä¸­ã€‚ä¸»è¦æ˜¯å› ä¸º AS æœ‰æ—¶å€™éœ€è¦å’Œ JS ä¼ å‚äº¤äº’ï¼Œæ”»å‡»è€…ä¼šé€šè¿‡æ¶æ„çš„ XSS æ³¨å…¥ç¯¡æ”¹å‚æ•°ï¼Œçªƒå–å¹¶æ“ä½œcookieã€‚</p>
<p>é¿å…æ–¹æ³•ï¼š</p>
<ul>
<li>ä¸¥æ ¼ç®¡ç† cookie çš„è¯»å†™æƒé™</li>
<li>å¯¹ Flash èƒ½æ¥å—ç”¨æˆ·è¾“å…¥çš„å‚æ•°è¿›è¡Œè¿‡æ»¤ escape è½¬ä¹‰å¤„ç†</li>
</ul>
<h3 id="æœªç»éªŒè¯çš„è·³è½¬-XSS"><a href="#æœªç»éªŒè¯çš„è·³è½¬-XSS" class="headerlink" title="æœªç»éªŒè¯çš„è·³è½¬ XSS"></a>æœªç»éªŒè¯çš„è·³è½¬ XSS</h3><p>æœ‰ä¸€äº›åœºæ™¯æ˜¯åç«¯éœ€è¦å¯¹ä¸€ä¸ªä¼ è¿›æ¥çš„å¾…è·³è½¬çš„ URL å‚æ•°è¿›è¡Œä¸€ä¸ª 302 è·³è½¬ï¼Œå¯èƒ½å…¶ä¸­ä¼šå¸¦æœ‰ä¸€äº›ç”¨æˆ·çš„æ•æ„Ÿï¼ˆcookieï¼‰ä¿¡æ¯ã€‚å¦‚æœæœåŠ¡å™¨ç«¯åš302 è·³è½¬ï¼Œè·³è½¬çš„åœ°å€æ¥è‡ªç”¨æˆ·çš„è¾“å…¥ï¼Œæ”»å‡»è€…å¯ä»¥è¾“å…¥ä¸€ä¸ªæ¶æ„çš„è·³è½¬åœ°å€æ¥æ‰§è¡Œè„šæœ¬ã€‚</p>
<p>è¿™æ—¶å€™éœ€è¦é€šè¿‡ä»¥ä¸‹æ–¹å¼æ¥é˜²æ­¢è¿™ç±»æ¼æ´ï¼š</p>
<ul>
<li>å¯¹å¾…è·³è½¬çš„ URL å‚æ•°åšç™½åå•æˆ–è€…æŸç§è§„åˆ™è¿‡æ»¤</li>
<li>åç«¯æ³¨æ„å¯¹æ•æ„Ÿä¿¡æ¯çš„ä¿æŠ¤, æ¯”å¦‚ cookie ä½¿ç”¨æ¥æºéªŒè¯ã€‚</li>
</ul>
<h2 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a>CSRF</h2><p>CSRFï¼ˆCross-Site Request Forgeryï¼‰ï¼Œä¸­æ–‡åç§°ï¼šè·¨ç«™è¯·æ±‚ä¼ªé€ æ”»å‡»</p>
<p>é‚£ä¹ˆ CSRF åˆ°åº•èƒ½å¤Ÿå¹²å˜›å‘¢ï¼Ÿä½ å¯ä»¥è¿™æ ·ç®€å•çš„ç†è§£ï¼šæ”»å‡»è€…å¯ä»¥ç›—ç”¨ä½ çš„ç™»é™†ä¿¡æ¯ï¼Œä»¥ä½ çš„èº«ä»½æ¨¡æ‹Ÿå‘é€å„ç§è¯·æ±‚ã€‚æ”»å‡»è€…åªè¦å€ŸåŠ©å°‘è®¸çš„ç¤¾ä¼šå·¥ç¨‹å­¦çš„è¯¡è®¡ï¼Œä¾‹å¦‚é€šè¿‡ QQ ç­‰èŠå¤©è½¯ä»¶å‘é€çš„é“¾æ¥(æœ‰äº›è¿˜ä¼ªè£…æˆçŸ­åŸŸåï¼Œç”¨æˆ·æ— æ³•åˆ†è¾¨)ï¼Œæ”»å‡»è€…å°±èƒ½è¿«ä½¿ Web åº”ç”¨çš„ç”¨æˆ·å»æ‰§è¡Œæ”»å‡»è€…é¢„è®¾çš„æ“ä½œã€‚ä¾‹å¦‚ï¼Œå½“ç”¨æˆ·ç™»å½•ç½‘ç»œé“¶è¡Œå»æŸ¥çœ‹å…¶å­˜æ¬¾ä½™é¢ï¼Œåœ¨ä»–æ²¡æœ‰é€€å‡ºæ—¶ï¼Œå°±ç‚¹å‡»äº†ä¸€ä¸ª QQ å¥½å‹å‘æ¥çš„é“¾æ¥ï¼Œé‚£ä¹ˆè¯¥ç”¨æˆ·é“¶è¡Œå¸æˆ·ä¸­çš„èµ„é‡‘å°±æœ‰å¯èƒ½è¢«è½¬ç§»åˆ°æ”»å‡»è€…æŒ‡å®šçš„å¸æˆ·ä¸­ã€‚</p>
<p>æ‰€ä»¥é‡åˆ° CSRF æ”»å‡»æ—¶ï¼Œå°†å¯¹ç»ˆç«¯ç”¨æˆ·çš„æ•°æ®å’Œæ“ä½œæŒ‡ä»¤æ„æˆä¸¥é‡çš„å¨èƒã€‚å½“å—æ”»å‡»çš„ç»ˆç«¯ç”¨æˆ·å…·æœ‰ç®¡ç†å‘˜å¸æˆ·çš„æ—¶å€™ï¼ŒCSRF æ”»å‡»å°†å±åŠæ•´ä¸ª Web åº”ç”¨ç¨‹åºã€‚</p>
<h3 id="CSRF-åŸç†"><a href="#CSRF-åŸç†" class="headerlink" title="CSRF åŸç†"></a>CSRF åŸç†</h3><p>ä¸‹å›¾å¤§æ¦‚æè¿°äº† CSRF æ”»å‡»çš„åŸç†ï¼Œå¯ä»¥ç†è§£ä¸ºæœ‰ä¸€ä¸ªå°å·åœ¨ä½ é…é’¥åŒ™çš„åœ°æ–¹å¾—åˆ°äº†ä½ å®¶çš„é’¥åŒ™ï¼Œç„¶åæ‹¿ç€è¦æ˜¯å»ä½ å®¶æƒ³å·ä»€ä¹ˆå·ä»€ä¹ˆã€‚<br><img src="/2018/01/23/Web-å®‰å…¨æ”»é˜²æ€»ç»“/csrf.jpg" alt="csrfåŸç†"><br>å®Œæˆ CSRF æ”»å‡»å¿…é¡»è¦æœ‰ä¸‰ä¸ªæ¡ä»¶ï¼š</p>
<ol>
<li>ç”¨æˆ·å·²ç»ç™»å½•äº†ç«™ç‚¹ Aï¼Œå¹¶åœ¨æœ¬åœ°è®°å½•äº† cookie</li>
<li>åœ¨ç”¨æˆ·æ²¡æœ‰ç™»å‡ºç«™ç‚¹ A çš„æƒ…å†µä¸‹ï¼ˆä¹Ÿå°±æ˜¯ cookie ç”Ÿæ•ˆçš„æƒ…å†µä¸‹ï¼‰ï¼Œè®¿é—®äº†æ¶æ„æ”»å‡»è€…æä¾›çš„å¼•è¯±å±é™©ç«™ç‚¹ B (B ç«™ç‚¹è¦æ±‚è®¿é—®ç«™ç‚¹A)ã€‚</li>
<li>ç«™ç‚¹ A æ²¡æœ‰åšä»»ä½• CSRF é˜²å¾¡</li>
</ol>
<p>ä½ ä¹Ÿè®¸ä¼šé—®ï¼šã€Œå¦‚æœæˆ‘ä¸æ»¡è¶³ä»¥ä¸Šä¸‰ä¸ªæ¡ä»¶ä¸­çš„ä»»æ„ä¸€ä¸ªï¼Œå°±ä¸ä¼šå—åˆ° CSRF çš„æ”»å‡»ã€ã€‚å…¶å®å¯ä»¥è¿™ä¹ˆè¯´çš„ï¼Œä½†ä½ ä¸èƒ½ä¿è¯ä»¥ä¸‹æƒ…å†µä¸ä¼šå‘ç”Ÿï¼š</p>
<ul>
<li>ä½ ä¸èƒ½ä¿è¯ä½ ç™»å½•äº†ä¸€ä¸ªç½‘ç«™åï¼Œä¸å†æ‰“å¼€ä¸€ä¸ª tab é¡µé¢å¹¶è®¿é—®å¦å¤–çš„ç½‘ç«™ï¼Œç‰¹åˆ«ç°åœ¨æµè§ˆå™¨éƒ½æ˜¯æ”¯æŒå¤š tab çš„ã€‚</li>
<li>ä½ ä¸èƒ½ä¿è¯ä½ å…³é—­æµè§ˆå™¨äº†åï¼Œä½ æœ¬åœ°çš„ cookie ç«‹åˆ»è¿‡æœŸï¼Œä½ ä¸Šæ¬¡çš„ä¼šè¯å·²ç»ç»“æŸã€‚</li>
<li>ä¸Šå›¾ä¸­æ‰€è°“çš„æ”»å‡»ç½‘ç«™ Bï¼Œå¯èƒ½æ˜¯ä¸€ä¸ªå­˜åœ¨å…¶ä»–æ¼æ´çš„å¯ä¿¡ä»»çš„ç»å¸¸è¢«äººè®¿é—®çš„ç½‘ç«™ã€‚</li>
</ul>
<h3 id="é¢„é˜²-CSRF"><a href="#é¢„é˜²-CSRF" class="headerlink" title="é¢„é˜² CSRF"></a>é¢„é˜² CSRF</h3><p>CSRF çš„é˜²å¾¡å¯ä»¥ä»æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¸¤æ–¹é¢ç€æ‰‹ï¼Œé˜²å¾¡æ•ˆæœæ˜¯ä»æœåŠ¡ç«¯ç€æ‰‹æ•ˆæœæ¯”è¾ƒå¥½ï¼Œç°åœ¨ä¸€èˆ¬çš„ CSRF é˜²å¾¡ä¹Ÿéƒ½åœ¨æœåŠ¡ç«¯è¿›è¡Œã€‚æœåŠ¡ç«¯çš„é¢„é˜² CSRF æ”»å‡»çš„æ–¹å¼æ–¹æ³•æœ‰å¤šç§ï¼Œä½†æ€è·¯ä¸Šéƒ½æ˜¯å·®ä¸å¤šçš„ï¼Œä¸»è¦ä»ä»¥ä¸‹ä¸¤ä¸ªæ–¹é¢å…¥æ‰‹ï¼š</p>
<ul>
<li>æ­£ç¡®ä½¿ç”¨ GETï¼ŒPOST è¯·æ±‚å’Œ cookie</li>
<li>åœ¨é GET è¯·æ±‚ä¸­å¢åŠ  token</li>
</ul>
<p>ä¸€èˆ¬è€Œè¨€ï¼Œæ™®é€šçš„ Web åº”ç”¨éƒ½æ˜¯ä»¥ GETã€POST è¯·æ±‚ä¸ºä¸»ï¼Œè¿˜æœ‰ä¸€ç§è¯·æ±‚æ˜¯ cookie æ–¹å¼ã€‚æˆ‘ä»¬ä¸€èˆ¬éƒ½æ˜¯æŒ‰ç…§å¦‚ä¸‹è§„åˆ™è®¾è®¡åº”ç”¨çš„è¯·æ±‚ï¼š</p>
<ul>
<li>GET è¯·æ±‚å¸¸ç”¨åœ¨æŸ¥çœ‹ï¼Œåˆ—ä¸¾ï¼Œå±•ç¤ºç­‰ä¸éœ€è¦æ”¹å˜èµ„æºå±æ€§çš„æ—¶å€™ï¼ˆæ•°æ®åº“ query æŸ¥è¯¢çš„æ—¶å€™ï¼‰</li>
<li>POST è¯·æ±‚å¸¸ç”¨åœ¨ From è¡¨å•æäº¤ï¼Œæ”¹å˜ä¸€ä¸ªèµ„æºçš„å±æ€§æˆ–è€…åšå…¶ä»–ä¸€äº›äº‹æƒ…çš„æ—¶å€™ï¼ˆæ•°æ®åº“æœ‰ insertã€updateã€delete çš„æ—¶å€™ï¼‰</li>
</ul>
<p>å½“æ­£ç¡®çš„ä½¿ç”¨äº† GET å’Œ POST è¯·æ±‚ä¹‹åï¼Œå‰©ä¸‹çš„å°±æ˜¯åœ¨é GET æ–¹å¼çš„è¯·æ±‚ä¸­å¢åŠ éšæœºæ•°ï¼Œè¿™ä¸ªå¤§æ¦‚æœ‰ä¸‰ç§æ–¹å¼æ¥è¿›è¡Œï¼š</p>
<ul>
<li><p><strong>ä¸ºæ¯ä¸ªç”¨æˆ·ç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„ cookie token</strong>ï¼Œæ‰€æœ‰è¡¨å•éƒ½åŒ…å«åŒä¸€ä¸ªä¼ªéšæœºå€¼ï¼Œè¿™ç§æ–¹æ¡ˆæœ€ç®€å•ï¼Œå› ä¸ºæ”»å‡»è€…ä¸èƒ½è·å¾—ç¬¬ä¸‰æ–¹çš„ cookie(ç†è®ºä¸Š)ï¼Œæ‰€ä»¥è¡¨å•ä¸­çš„æ•°æ®ä¹Ÿå°±æ„é€ å¤±è´¥ï¼Œä½†æ˜¯ç”±äºç”¨æˆ·çš„ cookie å¾ˆå®¹æ˜“ç”±äºç½‘ç«™çš„ XSS æ¼æ´è€Œè¢«ç›—å–ï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ¡ˆå¿…é¡»è¦åœ¨æ²¡æœ‰ XSS çš„æƒ…å†µä¸‹æ‰å®‰å…¨ã€‚</p>
</li>
<li><p><strong>æ¯ä¸ª POST è¯·æ±‚ä½¿ç”¨éªŒè¯ç </strong>ï¼Œè¿™ä¸ªæ–¹æ¡ˆç®—æ˜¯æ¯”è¾ƒå®Œç¾çš„ï¼Œä½†æ˜¯éœ€è¦ç”¨æˆ·å¤šæ¬¡è¾“å…¥éªŒè¯ç ï¼Œç”¨æˆ·ä½“éªŒæ¯”è¾ƒå·®ï¼Œæ‰€ä»¥ä¸é€‚åˆåœ¨ä¸šåŠ¡ä¸­å¤§é‡è¿ç”¨ã€‚</p>
</li>
<li><p><strong>æ¸²æŸ“è¡¨å•çš„æ—¶å€™ï¼Œä¸ºæ¯ä¸€ä¸ªè¡¨å•åŒ…å«ä¸€ä¸ª csrfToken</strong>ï¼Œæäº¤è¡¨å•çš„æ—¶å€™ï¼Œå¸¦ä¸Š csrfTokenï¼Œç„¶ååœ¨åç«¯åš csrfToken éªŒè¯ã€‚</p>
</li>
</ul>
<p>CSRF çš„é˜²å¾¡å¯ä»¥æ ¹æ®åº”ç”¨åœºæ™¯çš„ä¸åŒè‡ªè¡Œé€‰æ‹©ã€‚CSRF çš„é˜²å¾¡å·¥ä½œç¡®å®ä¼šåœ¨æ­£å¸¸ä¸šåŠ¡é€»è¾‘çš„åŸºç¡€ä¸Šå¸¦æ¥å¾ˆå¤šé¢å¤–çš„å¼€å‘é‡ï¼Œä½†æ˜¯è¿™ç§å·¥ä½œé‡æ˜¯å€¼å¾—çš„ï¼Œæ¯•ç«Ÿç”¨æˆ·éšç§ä»¥åŠè´¢äº§å®‰å…¨æ˜¯äº§å“æœ€åŸºç¡€çš„æ ¹æœ¬ã€‚</p>
<h2 id="SQL-æ³¨å…¥"><a href="#SQL-æ³¨å…¥" class="headerlink" title="SQL æ³¨å…¥"></a>SQL æ³¨å…¥</h2><p>SQL æ³¨å…¥æ¼æ´ï¼ˆSQL Injectionï¼‰æ˜¯ Web å¼€å‘ä¸­æœ€å¸¸è§çš„ä¸€ç§å®‰å…¨æ¼æ´ã€‚å¯ä»¥ç”¨å®ƒæ¥ä»æ•°æ®åº“è·å–æ•æ„Ÿä¿¡æ¯ï¼Œæˆ–è€…åˆ©ç”¨æ•°æ®åº“çš„ç‰¹æ€§æ‰§è¡Œæ·»åŠ ç”¨æˆ·ï¼Œå¯¼å‡ºæ–‡ä»¶ç­‰ä¸€ç³»åˆ—æ¶æ„æ“ä½œï¼Œç”šè‡³æœ‰å¯èƒ½è·å–æ•°æ®åº“ä¹ƒè‡³ç³»ç»Ÿç”¨æˆ·æœ€é«˜æƒé™ã€‚</p>
<p>è€Œé€ æˆ SQL æ³¨å…¥çš„åŸå› æ˜¯å› ä¸ºç¨‹åºæ²¡æœ‰æœ‰æ•ˆçš„è½¬ä¹‰è¿‡æ»¤ç”¨æˆ·çš„è¾“å…¥ï¼Œä½¿æ”»å‡»è€…æˆåŠŸçš„å‘æœåŠ¡å™¨æäº¤æ¶æ„çš„ SQL æŸ¥è¯¢ä»£ç ï¼Œç¨‹åºåœ¨æ¥æ”¶åé”™è¯¯çš„å°†æ”»å‡»è€…çš„è¾“å…¥ä½œä¸ºæŸ¥è¯¢è¯­å¥çš„ä¸€éƒ¨åˆ†æ‰§è¡Œï¼Œå¯¼è‡´åŸå§‹çš„æŸ¥è¯¢é€»è¾‘è¢«æ”¹å˜ï¼Œé¢å¤–çš„æ‰§è¡Œäº†æ”»å‡»è€…ç²¾å¿ƒæ„é€ çš„æ¶æ„ä»£ç ã€‚</p>
<p>å¾ˆå¤š Web å¼€å‘è€…æ²¡æœ‰æ„è¯†åˆ° SQL æŸ¥è¯¢æ˜¯å¯ä»¥è¢«ç¯¡æ”¹çš„ï¼Œä»è€ŒæŠŠ SQL æŸ¥è¯¢å½“ä½œå¯ä¿¡ä»»çš„å‘½ä»¤ã€‚æ®Šä¸çŸ¥ï¼ŒSQL æŸ¥è¯¢æ˜¯å¯ä»¥ç»•å¼€è®¿é—®æ§åˆ¶ï¼Œä»è€Œç»•è¿‡èº«ä»½éªŒè¯å’Œæƒé™æ£€æŸ¥çš„ã€‚æ›´æœ‰ç”šè€…ï¼Œæœ‰å¯èƒ½é€šè¿‡ SQL æŸ¥è¯¢å»è¿è¡Œä¸»æœºç³»ç»Ÿçº§çš„å‘½ä»¤ã€‚</p>
<h3 id="SQL-æ³¨å…¥åŸç†"><a href="#SQL-æ³¨å…¥åŸç†" class="headerlink" title="SQL æ³¨å…¥åŸç†"></a>SQL æ³¨å…¥åŸç†</h3><p>ä¸‹é¢å°†é€šè¿‡ä¸€äº›çœŸå®çš„ä¾‹å­æ¥è¯¦ç»†è®²è§£ SQL æ³¨å…¥çš„æ–¹å¼çš„åŸç†ã€‚</p>
<p>è€ƒè™‘ä»¥ä¸‹ç®€å•çš„ç®¡ç†å‘˜ç™»å½•è¡¨å•ï¼š</p>
<pre><code>&lt;formaction=&quot;/login&quot;method=&quot;POST&quot;&gt;
&lt;p&gt;Username: &lt;inputtype=&quot;text&quot;name=&quot;username&quot; /&gt;&lt;/p&gt;
&lt;p&gt;Password: &lt;inputtype=&quot;password&quot;name=&quot;password&quot; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;inputtype=&quot;submit&quot;value=&quot;ç™»é™†&quot; /&gt;&lt;/p&gt;
&lt;/form&gt;
</code></pre><p>åç«¯çš„ SQL è¯­å¥å¯èƒ½æ˜¯å¦‚ä¸‹è¿™æ ·çš„ï¼š</p>
<pre><code>let querySQL = `
    SELECT *
    FROM user
    WHERE username=&apos;${username}&apos;
    AND psw=&apos;${password}&apos;
`;
// æ¥ä¸‹æ¥å°±æ˜¯æ‰§è¡Œ sql è¯­å¥...
</code></pre><p>ç›®çš„å°±æ˜¯æ¥éªŒè¯ç”¨æˆ·åå’Œå¯†ç æ˜¯ä¸æ˜¯æ­£ç¡®ï¼ŒæŒ‰ç†è¯´ä¹ä¸€çœ‹ä¸Šé¢çš„ SQL è¯­å¥ä¹Ÿæ²¡ä»€ä¹ˆæ¯›ç—…ï¼Œç¡®å®æ˜¯èƒ½å¤Ÿè¾¾åˆ°æˆ‘ä»¬çš„ç›®çš„ï¼Œå¯æ˜¯ä½ åªæ˜¯ç«™åœ¨ç”¨æˆ·ä¼šè€è€å®å®æŒ‰ç…§ä½ çš„è®¾è®¡æ¥è¾“å…¥çš„è§’åº¦æ¥çœ‹é—®é¢˜ï¼Œå¦‚æœæœ‰ä¸€ä¸ªæ¶æ„æ”»å‡»è€…è¾“å…¥çš„ç”¨æˆ·åæ˜¯ <code>zoumiaojiang&#39; OR 1 = 1 --</code>ï¼Œå¯†ç éšæ„è¾“å…¥ï¼Œå°±å¯ä»¥ç›´æ¥ç™»å…¥ç³»ç»Ÿäº†ã€‚WFT!</p>
<p>å†·é™ä¸‹æ¥æ€è€ƒä¸€ä¸‹ï¼Œæˆ‘ä»¬ä¹‹å‰é¢„æƒ³çš„çœŸå® SQL è¯­å¥æ˜¯:</p>
<pre><code>SELECT * FROMuserWHERE username=&apos;zoumiaojiang&apos;AND psw=&apos;mypassword&apos;
</code></pre><p>å¯ä»¥æ¶æ„æ”»å‡»è€…çš„å¥‡æ€ªç”¨æˆ·åå°†ä½ çš„ SQL è¯­å¥å˜æˆäº†å¦‚ä¸‹å½¢å¼ï¼š</p>
<pre><code>SELECT * FROMuserWHERE username=&apos;zoumiaojiang&apos;OR1 = 1--&apos; AND psw=&apos;xxxx&apos;
</code></pre><p>åœ¨ SQL ä¸­ï¼Œ<code>--</code> æ˜¯æ³¨é‡Šåé¢çš„å†…å®¹çš„æ„æ€ï¼Œæ‰€ä»¥æŸ¥è¯¢è¯­å¥å°±å˜æˆäº†ï¼š</p>
<pre><code>SELECT * FROMuserWHERE username=&apos;zoumiaojiang&apos;OR1 = 1
</code></pre><p>è¿™æ¡ SQL è¯­å¥çš„æŸ¥è¯¢æ¡ä»¶æ°¸è¿œä¸ºçœŸï¼Œæ‰€ä»¥æ„æ€å°±æ˜¯æ¶æ„æ”»å‡»è€…ä¸ç”¨æˆ‘çš„å¯†ç ï¼Œå°±å¯ä»¥ç™»å½•è¿›æˆ‘çš„è´¦å·ï¼Œç„¶åå¯ä»¥åœ¨é‡Œé¢ä¸ºæ‰€æ¬²ä¸ºï¼Œç„¶è€Œè¿™è¿˜åªæ˜¯æœ€ç®€å•çš„æ³¨å…¥ï¼Œç‰›é€¼çš„ SQL æ³¨å…¥é«˜æ‰‹ç”šè‡³å¯ä»¥é€šè¿‡ SQL æŸ¥è¯¢å»è¿è¡Œä¸»æœºç³»ç»Ÿçº§çš„å‘½ä»¤ï¼Œå°†ä½ ä¸»æœºé‡Œçš„å†…å®¹ä¸€è§ˆæ— ä½™ï¼Œè¿™é‡Œæˆ‘ä¹Ÿæ²¡æœ‰è¿™ä¸ªèƒ½åŠ›è®²è§£çš„å¤ªæ·±å…¥ï¼Œæ¯•ç«Ÿä¸æ˜¯ä¸“ä¸šç ”ç©¶è¿™ç±»æ”»å‡»çš„ï¼Œä½†æ˜¯é€šè¿‡ä»¥ä¸Šçš„ä¾‹å­ï¼Œå·²ç»äº†è§£äº† SQL æ³¨å…¥çš„åŸç†ï¼Œæˆ‘ä»¬åŸºæœ¬å·²ç»èƒ½æ‰¾åˆ°é˜²å¾¡ SQL æ³¨å…¥çš„æ–¹æ¡ˆäº†ã€‚</p>
<h3 id="å¦‚ä½•é¢„é˜²-SQL-æ³¨å…¥"><a href="#å¦‚ä½•é¢„é˜²-SQL-æ³¨å…¥" class="headerlink" title="å¦‚ä½•é¢„é˜² SQL æ³¨å…¥"></a>å¦‚ä½•é¢„é˜² SQL æ³¨å…¥</h3><p>é˜²æ­¢ SQL æ³¨å…¥ä¸»è¦æ˜¯ä¸èƒ½å…è®¸ç”¨æˆ·è¾“å…¥çš„å†…å®¹å½±å“æ­£å¸¸çš„ SQL è¯­å¥çš„é€»è¾‘ï¼Œå½“ç”¨æˆ·çš„è¾“å…¥çš„ä¿¡æ¯å°†è¦ç”¨æ¥æ‹¼æ¥ SQL è¯­å¥çš„è¯ï¼Œæˆ‘ä»¬åº”è¯¥æ°¸è¿œé€‰æ‹©ä¸ç›¸ä¿¡ï¼Œä»»ä½•å†…å®¹éƒ½å¿…é¡»è¿›è¡Œè½¬ä¹‰è¿‡æ»¤ï¼Œå½“ç„¶åšåˆ°è¿™ä¸ªè¿˜æ˜¯ä¸å¤Ÿçš„ï¼Œä¸‹é¢åˆ—å‡ºé˜²å¾¡ SQL æ³¨å…¥çš„å‡ ç‚¹æ³¨æ„äº‹é¡¹ï¼š</p>
<ul>
<li><p><strong>ä¸¥æ ¼é™åˆ¶Webåº”ç”¨çš„æ•°æ®åº“çš„æ“ä½œæƒé™</strong>ï¼Œç»™æ­¤ç”¨æˆ·æä¾›ä»…ä»…èƒ½å¤Ÿæ»¡è¶³å…¶å·¥ä½œçš„æœ€ä½æƒé™ï¼Œä»è€Œæœ€å¤§é™åº¦çš„å‡å°‘æ³¨å…¥æ”»å‡»å¯¹æ•°æ®åº“çš„å±å®³</p>
</li>
<li><p><strong>åç«¯ä»£ç æ£€æŸ¥è¾“å…¥çš„æ•°æ®æ˜¯å¦ç¬¦åˆé¢„æœŸ</strong>ï¼Œä¸¥æ ¼é™åˆ¶å˜é‡çš„ç±»å‹ï¼Œä¾‹å¦‚ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œä¸€äº›åŒ¹é…å¤„ç†ã€‚</p>
</li>
<li><p><strong>å¯¹è¿›å…¥æ•°æ®åº“çš„ç‰¹æ®Šå­—ç¬¦ï¼ˆ<code>&#39;</code>ï¼Œ<code>&quot;</code>ï¼Œ<code>\</code>ï¼Œ<code>&lt;</code>ï¼Œ<code>&gt;</code>ï¼Œ<code>&amp;</code>ï¼Œ<code>*</code>ï¼Œ<code>;</code> ç­‰ï¼‰è¿›è¡Œè½¬ä¹‰å¤„ç†</strong>ï¼Œæˆ–ç¼–ç è½¬æ¢ã€‚åŸºæœ¬ä¸Šæ‰€æœ‰çš„åç«¯è¯­è¨€éƒ½æœ‰å¯¹å­—ç¬¦ä¸²è¿›è¡Œè½¬ä¹‰å¤„ç†çš„æ–¹æ³•ï¼Œæ¯”å¦‚ lodash çš„ <code>lodash._escapehtmlchar</code> åº“ã€‚</p>
</li>
<li><p><strong>æ‰€æœ‰çš„æŸ¥è¯¢è¯­å¥å»ºè®®ä½¿ç”¨æ•°æ®åº“æä¾›çš„å‚æ•°åŒ–æŸ¥è¯¢æ¥å£</strong>ï¼Œå‚æ•°åŒ–çš„è¯­å¥ä½¿ç”¨å‚æ•°è€Œä¸æ˜¯å°†ç”¨æˆ·è¾“å…¥å˜é‡åµŒå…¥åˆ° SQL è¯­å¥ä¸­ï¼Œå³ä¸è¦ç›´æ¥æ‹¼æ¥ SQL è¯­å¥ã€‚ä¾‹å¦‚ Node.js ä¸­çš„ mysqljs åº“çš„ <code>query</code> æ–¹æ³•ä¸­çš„ <code>?</code> å ä½å‚æ•°ã€‚</p>
</li>
</ul>
<pre><code>mysql.query(`SELECT * FROM user WHERE username = ? AND psw = ?`, [username, psw]);
</code></pre><ul>
<li><p><strong>åœ¨åº”ç”¨å‘å¸ƒä¹‹å‰å»ºè®®ä½¿ç”¨ä¸“ä¸šçš„ SQL æ³¨å…¥æ£€æµ‹å·¥å…·è¿›è¡Œæ£€æµ‹</strong>ï¼Œä»¥åŠæ—¶ä¿®è¡¥è¢«å‘ç°çš„ SQL æ³¨å…¥æ¼æ´ã€‚ç½‘ä¸Šæœ‰å¾ˆå¤šè¿™æ–¹é¢çš„å¼€æºå·¥å…·ï¼Œä¾‹å¦‚ sqlmapã€SQLninja ç­‰ã€‚</p>
</li>
<li><p><strong>é¿å…ç½‘ç«™æ‰“å°å‡º SQL é”™è¯¯ä¿¡æ¯</strong>ï¼Œæ¯”å¦‚ç±»å‹é”™è¯¯ã€å­—æ®µä¸åŒ¹é…ç­‰ï¼ŒæŠŠä»£ç é‡Œçš„ SQL è¯­å¥æš´éœ²å‡ºæ¥ï¼Œä»¥é˜²æ­¢æ”»å‡»è€…åˆ©ç”¨è¿™äº›é”™è¯¯ä¿¡æ¯è¿›è¡Œ SQL æ³¨å…¥ã€‚</p>
</li>
<li><p><strong>ä¸è¦è¿‡äºç»†åŒ–è¿”å›çš„é”™è¯¯ä¿¡æ¯</strong>ï¼Œå¦‚æœç›®çš„æ˜¯æ–¹ä¾¿è°ƒè¯•ï¼Œå°±å»ä½¿ç”¨åç«¯æ—¥å¿—ï¼Œä¸è¦åœ¨æ¥å£ä¸Šè¿‡å¤šçš„æš´éœ²å‡ºé”™ä¿¡æ¯ï¼Œæ¯•ç«ŸçœŸæ­£çš„ç”¨æˆ·ä¸å…³å¿ƒå¤ªå¤šçš„æŠ€æœ¯ç»†èŠ‚ï¼Œåªè¦è¯æœ¯åˆç†å°±è¡Œã€‚</p>
</li>
</ul>
<p>ç¢°åˆ°è¦æ“ä½œçš„æ•°æ®åº“çš„ä»£ç ï¼Œä¸€å®šè¦æ…é‡ï¼Œå°å¿ƒä½¿å¾—ä¸‡å¹´èˆ¹ï¼Œå¤šæ‰¾å‡ ä¸ªäººå¤šæ¥å‡ æ¬¡ code reviewï¼Œå°†é—®é¢˜éƒ½æš´éœ²å‡ºæ¥ï¼Œè€Œä¸”è¦å–„äºåˆ©ç”¨å·¥å…·ï¼Œæ“ä½œæ•°æ®åº“ç›¸å…³çš„ä»£ç å±äºæœºå¯†ï¼Œæ²¡äº‹ä¸è¦å»å„ç§è®ºå›æ™’è‡ªå®¶ç«™ç‚¹çš„ SQL è¯­å¥ï¼Œä¸‡ä¸€è¢«äººç›¯ä¸Šäº†å‘¢ï¼Ÿ</p>
<h2 id="å‘½ä»¤è¡Œæ³¨å…¥"><a href="#å‘½ä»¤è¡Œæ³¨å…¥" class="headerlink" title="å‘½ä»¤è¡Œæ³¨å…¥"></a>å‘½ä»¤è¡Œæ³¨å…¥</h2><p>å‘½ä»¤è¡Œæ³¨å…¥æ¼æ´ï¼ŒæŒ‡çš„æ˜¯æ”»å‡»è€…èƒ½å¤Ÿé€šè¿‡ HTTP è¯·æ±‚ç›´æ¥ä¾µå…¥ä¸»æœºï¼Œæ‰§è¡Œæ”»å‡»è€…é¢„è®¾çš„ shell å‘½ä»¤ï¼Œå¬èµ·æ¥å¥½åƒåŒªå¤·æ‰€æ€ï¼Œè¿™å¾€å¾€æ˜¯ Web å¼€å‘è€…æœ€å®¹æ˜“å¿½è§†ä½†æ˜¯å´æ˜¯æœ€å±é™©çš„ä¸€ä¸ªæ¼æ´ä¹‹ä¸€ï¼Œçœ‹ä¸€ä¸ªå®ä¾‹ï¼š</p>
<p>å‡å¦‚ç°åœ¨éœ€è¦å®ç°ä¸€ä¸ªéœ€æ±‚ï¼šç”¨æˆ·æäº¤ä¸€äº›å†…å®¹åˆ°æœåŠ¡å™¨ï¼Œç„¶ååœ¨æœåŠ¡å™¨æ‰§è¡Œä¸€äº›ç³»ç»Ÿå‘½ä»¤å»äº§å‡ºä¸€ä¸ªç»“æœè¿”å›ç»™ç”¨æˆ·ï¼Œæ¥å£çš„éƒ¨åˆ†å®ç°å¦‚ä¸‹ï¼š</p>
<pre><code>// ä»¥ Node.js ä¸ºä¾‹ï¼Œå‡å¦‚åœ¨æ¥å£ä¸­éœ€è¦ä» github ä¸‹è½½ç”¨æˆ·æŒ‡å®šçš„ repo
const exec = require(&apos;mz/child_process&apos;).exec;
let params = {/* ç”¨æˆ·è¾“å…¥çš„å‚æ•° */};

exec(`git clone ${params.repo} /some/path`);
</code></pre><p>è¿™æ®µä»£ç ç¡®å®èƒ½å¤Ÿæ»¡è¶³ä¸šåŠ¡éœ€æ±‚ï¼Œæ­£å¸¸çš„ç”¨æˆ·ä¹Ÿç¡®å®èƒ½ä»æŒ‡å®šçš„ git repo ä¸Šä¸‹è½½åˆ°æƒ³è¦çš„ä»£ç ï¼Œå¯æ˜¯å’Œ SQL æ³¨å…¥ä¸€æ ·ï¼Œè¿™æ®µä»£ç åœ¨æ¶æ„æ”»å‡»è€…çœ¼ä¸­ï¼Œç®€ç›´å°±æ˜¯é¦™é¥½é¥½ã€‚</p>
<p>å¦‚æœ <code>params.repo</code> ä¼ å…¥çš„æ˜¯ <code>https://github.com/zoumiaojiang/zoumiaojiang.github.io.git</code> å½“ç„¶æ²¡é—®é¢˜äº†ã€‚</p>
<p>å¯æ˜¯å¦‚æœ <code>params.repo</code> ä¼ å…¥çš„æ˜¯ <code>https://github.com/xx/xx.git &amp;&amp; rm -rf /* &amp;&amp;</code> æ°å¥½ä½ çš„æœåŠ¡æ˜¯ç”¨ root æƒé™èµ·çš„å°±æƒ¨äº†ã€‚</p>
<p>å…·ä½“æ¶æ„æ”»å‡»è€…èƒ½ç”¨å‘½ä»¤è¡Œæ³¨å…¥å¹²ä»€ä¹ˆä¹Ÿåƒ SQL æ³¨å…¥ä¸€æ ·ï¼Œæ‰‹æ³•æ˜¯åƒå˜ä¸‡åŒ–çš„ï¼Œæ¯”å¦‚ã€Œ<a href="http://wiki.bash-hackers.org/howto/redirection_tutorial" target="_blank" rel="noopener">åå¼¹ shell æ³¨å…¥</a>ã€ç­‰ï¼Œä½†åŸç†éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬ç»å¯¹æœ‰èƒ½åŠ›é˜²æ­¢å‘½ä»¤è¡Œæ³¨å…¥å‘ç”Ÿã€‚é˜²æ­¢å‘½ä»¤è¡Œæ³¨å…¥éœ€è¦åšåˆ°ä»¥ä¸‹å‡ ä»¶äº‹æƒ…ï¼š</p>
<ul>
<li>åç«¯å¯¹å‰ç«¯æäº¤å†…å®¹éœ€è¦å®Œå…¨é€‰æ‹©ä¸ç›¸ä¿¡ï¼Œå¹¶ä¸”å¯¹å…¶è¿›è¡Œè§„åˆ™é™åˆ¶ï¼ˆæ¯”å¦‚æ­£åˆ™è¡¨è¾¾å¼ï¼‰ã€‚</li>
<li>åœ¨è°ƒç”¨ç³»ç»Ÿå‘½ä»¤å‰å¯¹æ‰€æœ‰ä¼ å…¥å‚æ•°è¿›è¡Œå‘½ä»¤è¡Œå‚æ•°è½¬ä¹‰è¿‡æ»¤ã€‚</li>
<li>ä¸è¦ç›´æ¥æ‹¼æ¥å‘½ä»¤è¯­å¥ï¼Œå€ŸåŠ©ä¸€äº›å·¥å…·åšæ‹¼æ¥ã€è½¬ä¹‰é¢„å¤„ç†ï¼Œä¾‹å¦‚ Node.js çš„ <code>shell-escape</code> npm åŒ…ã€‚</li>
</ul>
<p>è¿˜æ˜¯å‰é¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥åšåˆ°å¦‚ä¸‹ï¼š</p>
<pre><code>const exec = require(&apos;mz/child_process&apos;).exec;

// å€ŸåŠ© shell-escape npm åŒ…è§£å†³å‚æ•°è½¬ä¹‰è¿‡æ»¤é—®é¢˜
const shellescape = require(&apos;shell-escape&apos;);

let params = {/* ç”¨æˆ·è¾“å…¥çš„å‚æ•° */};

// å…ˆè¿‡æ»¤ä¸€ä¸‹å‚æ•°ï¼Œè®©å‚æ•°ç¬¦åˆé¢„æœŸ
if (!/æ­£ç¡®çš„è¡¨è¾¾å¼/.test(params.repo)) {
return;
}

let cmd = shellescape([
&apos;git&apos;,
&apos;clone&apos;,
    params.repo,
&apos;/some/path&apos;
]);

// cmd çš„å€¼: git clone &apos;https://github.com/xx/xx.git &amp;&amp; rm -rf / &amp;&amp;&apos; /some/path
// è¿™æ ·å°±ä¸ä¼šè¢«æ³¨å…¥æˆåŠŸäº†ã€‚
exec(cmd);
</code></pre><blockquote>
<p>æ— è®ºæ˜¯åœ¨ä½•ç§åç«¯è¯­è¨€ç¯å¢ƒä¸­ï¼Œå‡¡æ˜¯æ¶‰åŠåˆ°ä»£ç è°ƒç”¨ç³»ç»Ÿ shell å‘½ä»¤çš„æ—¶å€™éƒ½ä¸€å®šè¦è°¨æ…ã€‚</p>
</blockquote>
<h2 id="DDoS-æ”»å‡»"><a href="#DDoS-æ”»å‡»" class="headerlink" title="DDoS æ”»å‡»"></a>DDoS æ”»å‡»</h2><p>DDoS åˆå«åˆ†å¸ƒå¼æ‹’ç»æœåŠ¡ï¼Œå…¨ç§° Distributed Denial of Serviceï¼Œå…¶åŸç†å°±æ˜¯åˆ©ç”¨å¤§é‡çš„è¯·æ±‚é€ æˆèµ„æºè¿‡è½½ï¼Œå¯¼è‡´æœåŠ¡ä¸å¯ç”¨ï¼Œè¿™ä¸ªæ”»å‡»åº”è¯¥ä¸èƒ½ç®—æ˜¯å®‰å…¨é—®é¢˜ï¼Œè¿™åº”è¯¥ç®—æ˜¯ä¸€ä¸ªå¦ç±»çš„å­˜åœ¨ï¼Œå› ä¸ºè¿™ç§æ”»å‡»æ ¹æœ¬å°±æ˜¯è€æµæ°“çš„å­˜åœ¨ï¼Œã€Œä¼¤æ•Œä¸€åƒï¼Œè‡ªæŸå…«ç™¾ã€çš„è¡Œä¸ºã€‚å‡ºäºä¿æŠ¤ Web App ä¸å—æ”»å‡»çš„æ”»é˜²è§’åº¦ï¼Œè¿˜æ˜¯ä»‹ç»ä¸€ä¸‹ DDoS æ”»å‡»å§ï¼Œæ¯•ç«Ÿä¹Ÿæ˜¯æŒºå¸¸è§çš„ã€‚</p>
<p>DDoS æ”»å‡»å¯ä»¥ç†è§£ä¸ºï¼šã€Œä½ å¼€äº†ä¸€å®¶åº—ï¼Œéš”å£å®¶ç‚¹çœ‹ä¸æƒ¯ï¼Œå°±é›‡äº†ä¸€å¤§å †é»‘ç¤¾ä¼šäººå‘˜è¿›ä½ åº—é‡Œå¹²åç€ï¼Œä¹Ÿä¸æ¶ˆè´¹ï¼Œå…¶ä»–å®¢äººä¹Ÿè¿›ä¸æ¥ï¼Œå¯¼è‡´ä½ è¥ä¸šæƒ¨æ·¡ã€ã€‚ä¸ºå•¥è¯´ DDoS æ˜¯ä¸ªã€Œä¼¤æ•Œä¸€åƒï¼Œè‡ªæŸå…«ç™¾ã€çš„è¡Œä¸ºå‘¢ï¼Ÿæ¯•ç«Ÿéš”å£åº—è¿˜æ˜¯èŠ±äº†ä¸å°‘é’±é›‡é»‘ç¤¾ä¼šä½†æ˜¯å•¥ä¹Ÿæ²¡å¾—åˆ°ä¸æ˜¯ï¼ŸDDoS æ”»å‡»çš„ç›®çš„åŸºæœ¬ä¸Šå°±ä»¥ä¸‹å‡ ä¸ªï¼š</p>
<ul>
<li>æ·±ä»‡å¤§æ¨ï¼Œå°±æ˜¯è¦å¹²æ­»ä½ </li>
<li>æ•²è¯ˆä½ ï¼Œä¸ç»™é’±å°±å¹²ä½ </li>
<li>å¿½æ‚ ä½ ï¼Œä¸ä¹°æˆ‘é˜²ç«å¢™æœåŠ¡å°±ä¼šæœ‰â€œäººâ€ç»§ç»­å¹²ä½ </li>
</ul>
<p>ä¹Ÿè®¸ä½ çš„ç«™ç‚¹é­å—è¿‡ DDoS æ”»å‡»ï¼Œå…·ä½“ä»€ä¹ˆåŸå› æ€ä¹ˆè§£è¯»è§ä»è§æ™ºã€‚DDos æ”»å‡»ä»å±‚æ¬¡ä¸Šå¯åˆ†ä¸ºç½‘ç»œå±‚æ”»å‡»ä¸åº”ç”¨å±‚æ”»å‡»ï¼Œä»æ”»å‡»æ‰‹æ³•ä¸Šå¯åˆ†ä¸ºå¿«å‹æµé‡æ”»å‡»ä¸æ…¢å‹æµé‡æ”»å‡»ï¼Œä½†å…¶åŸç†éƒ½æ˜¯é€ æˆèµ„æºè¿‡è½½ï¼Œå¯¼è‡´æœåŠ¡ä¸å¯ç”¨ã€‚</p>
<h3 id="ç½‘ç»œå±‚-DDoS"><a href="#ç½‘ç»œå±‚-DDoS" class="headerlink" title="ç½‘ç»œå±‚ DDoS"></a>ç½‘ç»œå±‚ DDoS</h3><p>ç½‘ç»œå±‚ DDos æ”»å‡»åŒ…æ‹¬ <code>SYN Flood</code>ã€<code>ACK Flood</code>ã€<code>UDP Flood</code>ã€<code>ICMP Flood</code> ç­‰ã€‚</p>
<p><strong>SYN Flood æ”»å‡»</strong></p>
<p>SYN flood æ”»å‡»ä¸»è¦åˆ©ç”¨äº† TCP ä¸‰æ¬¡æ¡æ‰‹è¿‡ç¨‹ä¸­çš„ Bugï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ TCP ä¸‰æ¬¡æ¡æ‰‹è¿‡ç¨‹æ˜¯è¦å»ºç«‹è¿æ¥çš„åŒæ–¹å‘é€ SYNï¼ŒSYN + ACKï¼ŒACK æ•°æ®åŒ…ï¼Œè€Œå½“æ”»å‡»æ–¹éšæ„æ„é€ æº IP å»å‘é€ SYN åŒ…æ—¶ï¼ŒæœåŠ¡å™¨è¿”å›çš„ SYN + ACK å°±ä¸èƒ½å¾—åˆ°åº”ç­”ï¼ˆå› ä¸º IP æ˜¯éšæ„æ„é€ çš„ï¼‰ï¼Œæ­¤æ—¶æœåŠ¡å™¨å°±ä¼šå°è¯•é‡æ–°å‘é€ï¼Œå¹¶ä¸”ä¼šæœ‰è‡³å°‘ 30s çš„ç­‰å¾…æ—¶é—´ï¼Œå¯¼è‡´èµ„æºé¥±å’ŒæœåŠ¡ä¸å¯ç”¨ï¼Œæ­¤æ”»å‡»å±äºæ…¢å‹ DDoS æ”»å‡»ã€‚</p>
<p><strong>ACK Flood æ”»å‡»</strong></p>
<p>ACK Flood æ”»å‡»æ˜¯åœ¨ TCP è¿æ¥å»ºç«‹ä¹‹åï¼Œæ‰€æœ‰çš„æ•°æ®ä¼ è¾“ TCP æŠ¥æ–‡éƒ½æ˜¯å¸¦æœ‰ ACK æ ‡å¿—ä½çš„ï¼Œä¸»æœºåœ¨æ¥æ”¶åˆ°ä¸€ä¸ªå¸¦æœ‰ ACK æ ‡å¿—ä½çš„æ•°æ®åŒ…çš„æ—¶å€™ï¼Œéœ€è¦æ£€æŸ¥è¯¥æ•°æ®åŒ…æ‰€è¡¨ç¤ºçš„è¿æ¥å››å…ƒç»„æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨åˆ™æ£€æŸ¥è¯¥æ•°æ®åŒ…æ‰€è¡¨ç¤ºçš„çŠ¶æ€æ˜¯å¦åˆæ³•ï¼Œç„¶åå†å‘åº”ç”¨å±‚ä¼ é€’è¯¥æ•°æ®åŒ…ã€‚å¦‚æœåœ¨æ£€æŸ¥ä¸­å‘ç°è¯¥æ•°æ®åŒ…ä¸åˆæ³•ï¼Œä¾‹å¦‚è¯¥æ•°æ®åŒ…æ‰€æŒ‡å‘çš„ç›®çš„ç«¯å£åœ¨æœ¬æœºå¹¶æœªå¼€æ”¾ï¼Œåˆ™ä¸»æœºæ“ä½œç³»ç»Ÿåè®®æ ˆä¼šå›åº” RST åŒ…å‘Šè¯‰å¯¹æ–¹æ­¤ç«¯å£ä¸å­˜åœ¨ã€‚</p>
<p><strong>UDP Flood æ”»å‡»</strong></p>
<p>UDP flood æ”»å‡»æ˜¯ç”±äº UDP æ˜¯ä¸€ç§æ— è¿æ¥çš„åè®®ï¼Œå› æ­¤æ”»å‡»è€…å¯ä»¥ä¼ªé€ å¤§é‡çš„æº IP åœ°å€å»å‘é€ UDP åŒ…ï¼Œæ­¤ç§æ”»å‡»å±äºå¤§æµé‡æ”»å‡»ã€‚æ­£å¸¸åº”ç”¨æƒ…å†µä¸‹ï¼ŒUDP åŒ…åŒå‘æµé‡ä¼šåŸºæœ¬ç›¸ç­‰ï¼Œå› æ­¤å‘èµ·è¿™ç§æ”»å‡»çš„æ”»å‡»è€…åœ¨æ¶ˆè€—å¯¹æ–¹èµ„æºçš„æ—¶å€™ä¹Ÿåœ¨æ¶ˆè€—è‡ªå·±çš„èµ„æºã€‚</p>
<p><strong>ICMP Flood æ”»å‡»</strong></p>
<p>ICMP Flood æ”»å‡»å±äºå¤§æµé‡æ”»å‡»ï¼Œå…¶åŸç†å°±æ˜¯ä¸æ–­å‘é€ä¸æ­£å¸¸çš„ ICMP åŒ…ï¼ˆæ‰€è°“ä¸æ­£å¸¸å°±æ˜¯ ICMP åŒ…å†…å®¹å¾ˆå¤§ï¼‰ï¼Œå¯¼è‡´ç›®æ ‡å¸¦å®½è¢«å ç”¨ï¼Œä½†å…¶æœ¬èº«èµ„æºä¹Ÿä¼šè¢«æ¶ˆè€—ã€‚ç›®å‰å¾ˆå¤šæœåŠ¡å™¨éƒ½æ˜¯ç¦ ping çš„ï¼ˆåœ¨é˜²ç«å¢™åœ¨å¯ä»¥å±è”½ ICMP åŒ…ï¼‰ï¼Œå› æ­¤è¿™ç§æ”»å‡»æ–¹å¼å·²ç»è½ä¼ã€‚</p>
<h3 id="ç½‘ç»œå±‚-DDoS-é˜²å¾¡"><a href="#ç½‘ç»œå±‚-DDoS-é˜²å¾¡" class="headerlink" title="ç½‘ç»œå±‚ DDoS é˜²å¾¡"></a>ç½‘ç»œå±‚ DDoS é˜²å¾¡</h3><p>ç½‘ç»œå±‚çš„ DDoS æ”»å‡»ç©¶å…¶æœ¬è´¨å…¶å®æ˜¯æ— æ³•é˜²å¾¡çš„ï¼Œæˆ‘ä»¬èƒ½åšå¾—å°±æ˜¯ä¸æ–­ä¼˜åŒ–æœåŠ¡æœ¬èº«éƒ¨ç½²çš„ç½‘ç»œæ¶æ„ï¼Œä»¥åŠæå‡ç½‘ç»œå¸¦å®½ã€‚å½“ç„¶ï¼Œè¿˜æ˜¯åšå¥½ä»¥ä¸‹å‡ ä»¶äº‹ä¹Ÿæ˜¯æœ‰åŠ©äºç¼“è§£ç½‘ç»œå±‚ DDoS æ”»å‡»çš„å†²å‡»ï¼š</p>
<ul>
<li>ç½‘ç»œæ¶æ„ä¸Šåšå¥½ä¼˜åŒ–ï¼Œé‡‡ç”¨è´Ÿè½½å‡è¡¡åˆ†æµã€‚</li>
<li>ç¡®ä¿æœåŠ¡å™¨çš„ç³»ç»Ÿæ–‡ä»¶æ˜¯æœ€æ–°çš„ç‰ˆæœ¬ï¼Œå¹¶åŠæ—¶æ›´æ–°ç³»ç»Ÿè¡¥ä¸ã€‚</li>
<li>æ·»åŠ æŠ— DDos è®¾å¤‡ï¼Œè¿›è¡Œæµé‡æ¸…æ´—ã€‚</li>
<li>é™åˆ¶åŒæ—¶æ‰“å¼€çš„ SYN åŠè¿æ¥æ•°ç›®ï¼Œç¼©çŸ­ SYN åŠè¿æ¥çš„ Timeout æ—¶é—´ã€‚</li>
<li>é™åˆ¶å• IP è¯·æ±‚é¢‘ç‡ã€‚</li>
<li>é˜²ç«å¢™ç­‰é˜²æŠ¤è®¾ç½®ç¦æ­¢ ICMP åŒ…ç­‰ã€‚</li>
<li>ä¸¥æ ¼é™åˆ¶å¯¹å¤–å¼€æ”¾çš„æœåŠ¡å™¨çš„å‘å¤–è®¿é—®ã€‚</li>
<li>è¿è¡Œç«¯å£æ˜ å°„ç¨‹åºæˆ–ç«¯å£æ‰«æç¨‹åºï¼Œè¦è®¤çœŸæ£€æŸ¥ç‰¹æƒç«¯å£å’Œéç‰¹æƒç«¯å£ã€‚</li>
<li>å…³é—­ä¸å¿…è¦çš„æœåŠ¡ã€‚</li>
<li>è®¤çœŸæ£€æŸ¥ç½‘ç»œè®¾å¤‡å’Œä¸»æœº/æœåŠ¡å™¨ç³»ç»Ÿçš„æ—¥å¿—ã€‚åªè¦æ—¥å¿—å‡ºç°æ¼æ´æˆ–æ˜¯æ—¶é—´å˜æ›´,é‚£è¿™å°æœºå™¨å°±å¯èƒ½é­åˆ°äº†æ”»å‡»ã€‚</li>
<li>é™åˆ¶åœ¨é˜²ç«å¢™å¤–ä¸ç½‘ç»œæ–‡ä»¶å…±äº«ã€‚è¿™æ ·ä¼šç»™é»‘å®¢æˆªå–ç³»ç»Ÿæ–‡ä»¶çš„æœºä¼šï¼Œä¸»æœºçš„ä¿¡æ¯æš´éœ²ç»™é»‘å®¢ï¼Œæ— ç–‘æ˜¯ç»™äº†å¯¹æ–¹å…¥ä¾µçš„æœºä¼šã€‚</li>
<li>åŠ é’±å †æœºå™¨ã€‚ã€‚</li>
<li>æŠ¥è­¦ã€‚ã€‚</li>
</ul>
<h3 id="åº”ç”¨å±‚-DDoS"><a href="#åº”ç”¨å±‚-DDoS" class="headerlink" title="åº”ç”¨å±‚ DDoS"></a>åº”ç”¨å±‚ DDoS</h3><p>åº”ç”¨å±‚ DDoS æ”»å‡»ä¸æ˜¯å‘ç”Ÿåœ¨ç½‘ç»œå±‚ï¼Œæ˜¯å‘ç”Ÿåœ¨ TCP å»ºç«‹æ¡æ‰‹æˆåŠŸä¹‹åï¼Œåº”ç”¨ç¨‹åºå¤„ç†è¯·æ±‚çš„æ—¶å€™ï¼Œç°åœ¨å¾ˆå¤šå¸¸è§çš„ DDoS æ”»å‡»éƒ½æ˜¯åº”ç”¨å±‚æ”»å‡»ã€‚åº”ç”¨å±‚æ”»å‡»åƒå˜ä¸‡åŒ–ï¼Œç›®çš„å°±æ˜¯åœ¨ç½‘ç»œåº”ç”¨å±‚è€—å°½ä½ çš„å¸¦å®½ï¼Œä¸‹é¢åˆ—å‡ºé›†ä¸­å…¸å‹çš„æ”»å‡»ç±»å‹ã€‚</p>
<p><strong>CC æ”»å‡»</strong></p>
<p>å½“æ—¶ç»¿ç›Ÿä¸ºäº†é˜²å¾¡ DDoS æ”»å‡»ç ”å‘äº†ä¸€æ¬¾å«åš <code>Collapasar</code> çš„äº§å“ï¼Œèƒ½å¤Ÿæœ‰æ•ˆçš„é˜²å¾¡ SYN Flood æ”»å‡»ã€‚é»‘å®¢ä¸ºäº†æŒ‘è¡…ï¼Œç ”å‘äº†ä¸€æ¬¾ <code>Challenge Collapasar</code> æ”»å‡»å·¥å…·ï¼ˆç®€ç§° CCï¼‰ã€‚</p>
<p>CC æ”»å‡»çš„åŸç†ï¼Œå°±æ˜¯é’ˆå¯¹æ¶ˆè€—èµ„æºæ¯”è¾ƒå¤§çš„é¡µé¢ä¸æ–­å‘èµ·ä¸æ­£å¸¸çš„è¯·æ±‚ï¼Œå¯¼è‡´èµ„æºè€—å°½ã€‚å› æ­¤åœ¨å‘é€ CC æ”»å‡»å‰ï¼Œæˆ‘ä»¬éœ€è¦å¯»æ‰¾åŠ è½½æ¯”è¾ƒæ…¢ï¼Œæ¶ˆè€—èµ„æºæ¯”è¾ƒå¤šçš„ç½‘é¡µï¼Œæ¯”å¦‚éœ€è¦æŸ¥è¯¢æ•°æ®åº“çš„é¡µé¢ã€è¯»å†™ç¡¬ç›˜æ–‡ä»¶çš„ç­‰ã€‚é€šè¿‡ CC æ”»å‡»ï¼Œä½¿ç”¨çˆ¬è™«å¯¹æŸäº›åŠ è½½éœ€è¦æ¶ˆè€—å¤§é‡èµ„æºçš„é¡µé¢å‘èµ· HTTP è¯·æ±‚ã€‚</p>
<p><strong>DNS Flood</strong></p>
<p>DNS Flood æ”»å‡»é‡‡ç”¨çš„æ–¹æ³•æ˜¯å‘è¢«æ”»å‡»çš„æœåŠ¡å™¨å‘é€å¤§é‡çš„åŸŸåè§£æè¯·æ±‚ï¼Œé€šå¸¸è¯·æ±‚è§£æçš„åŸŸåæ˜¯éšæœºç”Ÿæˆæˆ–è€…æ˜¯ç½‘ç»œä¸–ç•Œä¸Šæ ¹æœ¬ä¸å­˜åœ¨çš„åŸŸåï¼Œè¢«æ”»å‡»çš„DNS æœåŠ¡å™¨åœ¨æ¥æ”¶åˆ°åŸŸåè§£æè¯·æ±‚çš„æ—¶å€™é¦–å…ˆä¼šåœ¨æœåŠ¡å™¨ä¸ŠæŸ¥æ‰¾æ˜¯å¦æœ‰å¯¹åº”çš„ç¼“å­˜ï¼Œå¦‚æœæŸ¥æ‰¾ä¸åˆ°å¹¶ä¸”è¯¥åŸŸåæ— æ³•ç›´æ¥ç”±æœåŠ¡å™¨è§£æçš„æ—¶å€™ï¼ŒDNS æœåŠ¡å™¨ä¼šå‘å…¶ä¸Šå±‚ DNS æœåŠ¡å™¨é€’å½’æŸ¥è¯¢åŸŸåä¿¡æ¯ã€‚åŸŸåè§£æçš„è¿‡ç¨‹ç»™æœåŠ¡å™¨å¸¦æ¥äº†å¾ˆå¤§çš„è´Ÿè½½ï¼Œæ¯ç§’é’ŸåŸŸåè§£æè¯·æ±‚è¶…è¿‡ä¸€å®šçš„æ•°é‡å°±ä¼šé€ æˆ DNS æœåŠ¡å™¨è§£æåŸŸåè¶…æ—¶ã€‚</p>
<p>æ ¹æ®å¾®è½¯çš„ç»Ÿè®¡æ•°æ®ï¼Œä¸€å° DNS æœåŠ¡å™¨æ‰€èƒ½æ‰¿å—çš„åŠ¨æ€åŸŸåæŸ¥è¯¢çš„ä¸Šé™æ˜¯æ¯ç§’é’Ÿ 9000 ä¸ªè¯·æ±‚ã€‚è€Œæˆ‘ä»¬çŸ¥é“ï¼Œåœ¨ä¸€å° P3 çš„ PC æœºä¸Šå¯ä»¥è½»æ˜“åœ°æ„é€ å‡ºæ¯ç§’é’Ÿå‡ ä¸‡ä¸ªåŸŸåè§£æè¯·æ±‚ï¼Œè¶³ä»¥ä½¿ä¸€å°ç¡¬ä»¶é…ç½®æé«˜çš„ DNS æœåŠ¡å™¨ç˜«ç—ªï¼Œç”±æ­¤å¯è§ DNS æœåŠ¡å™¨çš„è„†å¼±æ€§ã€‚</p>
<p><strong>HTTP æ…¢é€Ÿè¿æ¥æ”»å‡»</strong></p>
<p>é’ˆå¯¹ HTTP åè®®ï¼Œå…ˆå»ºç«‹èµ· HTTP è¿æ¥ï¼Œè®¾ç½®ä¸€ä¸ªè¾ƒå¤§çš„ Conetnt-Lengthï¼Œæ¯æ¬¡åªå‘é€å¾ˆå°‘çš„å­—èŠ‚ï¼Œè®©æœåŠ¡å™¨ä¸€ç›´ä»¥ä¸º HTTP å¤´éƒ¨æ²¡æœ‰ä¼ è¾“å®Œæˆï¼Œè¿™æ ·è¿æ¥ä¸€å¤šå°±å¾ˆå¿«ä¼šå‡ºç°è¿æ¥è€—å°½ã€‚</p>
<h3 id="åº”ç”¨å±‚-DDoS-é˜²å¾¡"><a href="#åº”ç”¨å±‚-DDoS-é˜²å¾¡" class="headerlink" title="åº”ç”¨å±‚ DDoS é˜²å¾¡"></a>åº”ç”¨å±‚ DDoS é˜²å¾¡</h3><ul>
<li>åˆ¤æ–­ User-Agent å­—æ®µï¼ˆä¸å¯é ï¼Œå› ä¸ºå¯ä»¥éšæ„æ„é€ ï¼‰</li>
<li>é’ˆå¯¹ IP + cookieï¼Œé™åˆ¶è®¿é—®é¢‘ç‡ï¼ˆç”±äº cookie å¯ä»¥æ›´æ”¹ï¼ŒIP å¯ä»¥ä½¿ç”¨ä»£ç†ï¼Œæˆ–è€…è‚‰é¸¡ï¼Œä¹Ÿä¸å¯é )</li>
<li>å…³é—­æœåŠ¡å™¨æœ€å¤§è¿æ¥æ•°ç­‰ï¼Œåˆç†é…ç½®ä¸­é—´ä»¶ï¼Œç¼“è§£ DDoS æ”»å‡»ã€‚</li>
<li>è¯·æ±‚ä¸­æ·»åŠ éªŒè¯ç ï¼Œæ¯”å¦‚è¯·æ±‚ä¸­æœ‰æ•°æ®åº“æ“ä½œçš„æ—¶å€™ã€‚</li>
<li>ç¼–å†™ä»£ç æ—¶ï¼Œå°½é‡å®ç°ä¼˜åŒ–ï¼Œå¹¶åˆç†ä½¿ç”¨ç¼“å­˜æŠ€æœ¯ï¼Œå‡å°‘æ•°æ®åº“çš„è¯»å–æ“ä½œã€‚</li>
<li>åŠ é’±å †æœºå™¨ã€‚ã€‚</li>
<li>æŠ¥è­¦ã€‚ã€‚</li>
</ul>
<p>åº”ç”¨å±‚çš„é˜²å¾¡æœ‰æ—¶æ¯”ç½‘ç»œå±‚çš„æ›´éš¾ï¼Œå› ä¸ºå¯¼è‡´åº”ç”¨å±‚è¢« DDoS æ”»å‡»çš„å› ç´ éå¸¸å¤šï¼Œæœ‰æ—¶å¾€å¾€æ˜¯å› ä¸ºç¨‹åºå‘˜çš„å¤±è¯¯ï¼Œå¯¼è‡´æŸä¸ªé¡µé¢åŠ è½½éœ€è¦æ¶ˆè€—å¤§é‡èµ„æºï¼Œæœ‰æ—¶æ˜¯å› ä¸ºä¸­é—´ä»¶é…ç½®ä¸å½“ç­‰ç­‰ã€‚è€Œåº”ç”¨å±‚ DDoS é˜²å¾¡çš„æ ¸å¿ƒå°±æ˜¯åŒºåˆ†äººä¸æœºå™¨ï¼ˆçˆ¬è™«ï¼‰ï¼Œå› ä¸ºå¤§é‡çš„è¯·æ±‚ä¸å¯èƒ½æ˜¯äººä¸ºçš„ï¼Œè‚¯å®šæ˜¯æœºå™¨æ„é€ çš„ã€‚å› æ­¤å¦‚æœèƒ½æœ‰æ•ˆçš„åŒºåˆ†äººä¸çˆ¬è™«è¡Œä¸ºï¼Œåˆ™å¯ä»¥å¾ˆå¥½åœ°é˜²å¾¡æ­¤æ”»å‡»ã€‚</p>
<h3 id="å…¶ä»–-DDoS-æ”»å‡»"><a href="#å…¶ä»–-DDoS-æ”»å‡»" class="headerlink" title="å…¶ä»– DDoS æ”»å‡»"></a>å…¶ä»– DDoS æ”»å‡»</h3><p>å‘èµ· DDoS ä¹Ÿæ˜¯éœ€è¦å¤§é‡çš„å¸¦å®½èµ„æºçš„ï¼Œä½†æ˜¯äº’è”ç½‘å°±åƒæ£®æ—ï¼Œæ—å­å¤§äº†ä»€ä¹ˆé¸Ÿéƒ½æœ‰ï¼ŒDDoS æ”»å‡»è€…ä¹Ÿèƒ½æ‰¾åˆ°å…¶ä»–çš„æ–¹å¼å‘èµ·å»‰ä»·å¹¶ä¸”æå…·æ€ä¼¤åŠ›çš„ DDoS æ”»å‡»ã€‚</p>
<p><strong>åˆ©ç”¨ XSS</strong></p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœ 12306 é¡µé¢æœ‰ä¸€ä¸ª XSS æŒä¹…å‹æ¼æ´è¢«æ¶æ„æ”»å‡»è€…å‘ç°ï¼Œåªéœ€åœ¨æ˜¥èŠ‚æŠ¢ç¥¨æœŸé—´åœ¨è¿™ä¸ªæ¼æ´ä¸­æ‰§è¡Œè„šæœ¬ä½¿å¾—å¾€æŸä¸€ä¸ªå°ç«™ç‚¹éšä¾¿å‘ç‚¹ä»€ä¹ˆè¯·æ±‚ï¼Œç„¶åéšç€ç”¨æˆ·è®¿é—®çš„å¢å¤šï¼Œæ„ŸæŸ“ç”¨æˆ·å¢å¤šï¼Œè¢«æ”»å‡»çš„ç«™ç‚¹è‡ªç„¶å°±ä¼šè¿…é€Ÿç˜«ç—ªäº†ã€‚è¿™ç§ DDoS ç®€ç›´å°±æ˜¯æ— æœ¬ä¸‡åˆ©ï¼Œä¸ç”¨æƒŠè®¶ï¼Œç°åœ¨å¤§ç«™æœ‰ XSS æ¼æ´çš„ä¸è¦å¤ªå¤šã€‚</p>
<p><strong>æ¥è‡ª P2P ç½‘ç»œæ”»å‡»</strong></p>
<p>å¤§å®¶éƒ½çŸ¥é“ï¼Œäº’è”ç½‘ä¸Šçš„ P2P ç”¨æˆ·å’Œæµé‡éƒ½æ˜¯ä¸€ä¸ªæä¸ºåºå¤§çš„æ•°å­—ã€‚å¦‚æœä»–ä»¬éƒ½å»ä¸€ä¸ªæŒ‡å®šçš„åœ°æ–¹ä¸‹è½½æ•°æ®ï¼Œæˆåƒä¸Šä¸‡çš„çœŸå® IP åœ°å€è¿æ¥è¿‡æ¥ï¼Œæ²¡æœ‰å“ªä¸ªè®¾å¤‡èƒ½å¤Ÿæ”¯æ’‘ä½ã€‚æ‹¿ BT ä¸‹è½½æ¥è¯´ï¼Œä¼ªé€ ä¸€äº›çƒ­é—¨è§†é¢‘çš„ç§å­ï¼Œå‘å¸ƒåˆ°æœç´¢å¼•æ“ï¼Œå°±è¶³ä»¥éª—åˆ°è®¸å¤šç”¨æˆ·å’Œæµé‡äº†ï¼Œä½†æ˜¯è¿™åªæ˜¯åŸºç¡€æ”»å‡»ã€‚</p>
<p>é«˜çº§çš„ P2P æ”»å‡»ï¼Œæ˜¯ç›´æ¥æ¬ºéª—èµ„æºç®¡ç†æœåŠ¡å™¨ã€‚å¦‚è¿…é›·å®¢æˆ·ç«¯ä¼šæŠŠè‡ªå·±å‘ç°çš„èµ„æºä¸Šä¼ åˆ°èµ„æºç®¡ç†æœåŠ¡å™¨ï¼Œç„¶åæ¨é€ç»™å…¶å®ƒéœ€è¦ä¸‹è½½ç›¸åŒèµ„æºçš„ç”¨æˆ·ï¼Œè¿™æ ·ï¼Œä¸€ä¸ªé“¾æ¥å°±å‘å¸ƒå‡ºå»ã€‚é€šè¿‡åè®®é€†å‘ï¼Œæ”»å‡»è€…ä¼ªé€ å‡ºå¤§æ‰¹é‡çš„çƒ­é—¨èµ„æºä¿¡æ¯é€šè¿‡èµ„æºç®¡ç†ä¸­å¿ƒåˆ†å‘å‡ºå»ï¼Œç¬é—´å°±å¯ä»¥ä¼ éæ•´ä¸ª P2P ç½‘ç»œã€‚æ›´ä¸ºææ€–çš„æ˜¯ï¼Œè¿™ç§æ”»å‡»æ˜¯æ— æ³•åœæ­¢çš„ï¼Œå³ä½¿æ˜¯æ”»å‡»è€…è‡ªèº«ä¹Ÿæ— æ³•åœæ­¢ï¼Œæ”»å‡»ä¸€ç›´æŒç»­åˆ° P2P å®˜æ–¹å‘ç°é—®é¢˜æ›´æ–°æœåŠ¡å™¨ä¸”ä¸‹è½½ç”¨æˆ·é‡å¯ä¸‹è½½è½¯ä»¶ä¸ºæ­¢ã€‚</p>
<blockquote>
<p>æœ€åæ€»ç»“ä¸‹ï¼ŒDDoS ä¸å¯èƒ½é˜²çš„ä½ï¼Œå°±å¥½æ¯”ä½ çš„åº—åªèƒ½å®¹çº³ 50 äººï¼Œé»‘ç¤¾ä¼šæœ‰ 100 äººï¼Œä½ å°±æ¢ä¸€å®¶å¤§åº—ï¼Œèƒ½å®¹çº³ 500 äººï¼Œç„¶åé»‘ç¤¾ä¼šåˆæ‰¾æ¥äº† 1000 äººï¼Œè¿™ç§å †äººå¤´çš„åšæ³•å°±æ˜¯ DDoS æœ¬è´¨ä¸Šçš„æ”»é˜²ä¹‹é“ï¼Œã€Œé“é«˜ä¸€å°ºï¼Œé­”é«˜ä¸€ä¸ˆï¼Œé­”é«˜ä¸€å°ºï¼Œé“é«˜ä¸€ä¸ˆã€ï¼Œè®²çœŸï¼Œå¿…è¦çš„æ—¶å€™å°±ç­”åº”å‹’ç´¢ä½ çš„äººçš„æ¡ä»¶å§ï¼Œå®åœ¨ä¸è¡Œå°±æŠ¥è­¦å§ã€‚</p>
</blockquote>
<h2 id="æµé‡åŠ«æŒ"><a href="#æµé‡åŠ«æŒ" class="headerlink" title="æµé‡åŠ«æŒ"></a>æµé‡åŠ«æŒ</h2><p>æµé‡åŠ«æŒåº”è¯¥ç®—æ˜¯é»‘äº§è¡Œä¸šçš„ä¸€å¤§ç»æµæ”¯æŸ±äº†å§ï¼Ÿç®€ç›´æ˜¯è®©äººæ¶å¿ƒåˆ°åï¼Œä¸åæ§½äº†ï¼Œè¿˜æ˜¯ç»§ç»­è°ˆå¹²è´§å§ï¼Œæµé‡åŠ«æŒåŸºæœ¬åˆ†ä¸¤ç§ï¼š<code>DNS åŠ«æŒ</code> å’Œ <code>HTTP åŠ«æŒ</code>ï¼Œç›®çš„éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå°±æ˜¯å½“ç”¨æˆ·è®¿é—® <a href="https://zoumiaojiang.com" target="_blank" rel="noopener">zoumiaojiang.com</a> çš„æ—¶å€™ï¼Œç»™ä½ å±•ç¤ºçš„å¹¶ä¸æ˜¯æˆ–è€…ä¸å®Œå…¨æ˜¯ <a href="https://zoumiaojiang.com" target="_blank" rel="noopener">zoumiaojiang.com</a> æä¾›çš„ â€œå†…å®¹â€ã€‚</p>
<h3 id="DNS-åŠ«æŒ"><a href="#DNS-åŠ«æŒ" class="headerlink" title="DNS åŠ«æŒ"></a>DNS åŠ«æŒ</h3><p>DNS åŠ«æŒï¼Œä¹Ÿå«åšåŸŸååŠ«æŒï¼Œå¯ä»¥è¿™ä¹ˆç†è§£ï¼Œã€Œ<strong>ä½ æ‰“äº†ä¸€è¾†è½¦æƒ³å»å•†åœºåƒé¥­ï¼Œç»“æœä½ æ‰“çš„è½¦æ˜¯å°ä½œåŠæ´¾æ¥çš„ï¼Œç›´æ¥ç»™ä½ æ‹‰åˆ°å°ä½œåŠå»äº†</strong>ã€ï¼ŒDNS çš„ä½œç”¨æ˜¯æŠŠç½‘ç»œåœ°å€åŸŸåå¯¹åº”åˆ°çœŸå®çš„è®¡ç®—æœºèƒ½å¤Ÿè¯†åˆ«çš„ IP åœ°å€ï¼Œä»¥ä¾¿è®¡ç®—æœºèƒ½å¤Ÿè¿›ä¸€æ­¥é€šä¿¡ï¼Œä¼ é€’ç½‘å€å’Œå†…å®¹ç­‰ã€‚å¦‚æœå½“ç”¨æˆ·é€šè¿‡æŸä¸€ä¸ªåŸŸåè®¿é—®ä¸€ä¸ªç«™ç‚¹çš„æ—¶å€™ï¼Œè¢«ç¯¡æ”¹çš„ DNS æœåŠ¡å™¨è¿”å›çš„æ˜¯ä¸€ä¸ªæ¶æ„çš„é’“é±¼ç«™ç‚¹çš„ IPï¼Œç”¨æˆ·å°±è¢«åŠ«æŒåˆ°äº†æ¶æ„é’“é±¼ç«™ç‚¹ï¼Œç„¶åç»§è€Œä¼šè¢«é’“é±¼è¾“å…¥å„ç§è´¦å·å¯†ç ä¿¡æ¯ï¼Œæ³„æ¼éšç§ã€‚<br><img src="/2018/01/23/Web-å®‰å…¨æ”»é˜²æ€»ç»“/dns.jpg" alt="dnsåŠ«æŒ"><br>è¿™ç±»åŠ«æŒï¼Œè¦ä¸å°±æ˜¯ç½‘ç»œè¿è¥å•†æçš„é¬¼ï¼Œä¸€èˆ¬å°çš„ç½‘ç»œè¿è¥å•†ä¸é»‘äº§å‹¾ç»“ä¼šåŠ«æŒ DNSï¼Œè¦ä¸å°±æ˜¯ç”µè„‘ä¸­æ¯’ï¼Œè¢«æ¶æ„ç¯¡æ”¹äº†è·¯ç”±å™¨çš„ DNS é…ç½®ï¼ŒåŸºæœ¬ä¸Šåšä¸ºå¼€å‘è€…æˆ–ç«™é•¿å´æ˜¯å¾ˆéš¾å¯Ÿè§‰çš„ï¼Œé™¤éæœ‰ç”¨æˆ·åé¦ˆï¼Œç°åœ¨å‡çº§ç‰ˆçš„ DNS åŠ«æŒè¿˜å¯ä»¥å¯¹ç‰¹å®šç”¨æˆ·ã€ç‰¹å®šåŒºåŸŸç­‰ä½¿ç”¨äº†ç”¨æˆ·ç”»åƒè¿›è¡Œç­›é€‰ç”¨æˆ·åŠ«æŒçš„åŠæ³•ï¼Œå¦å¤–è¿™ç±»å¹¿å‘Šæ˜¾ç¤ºæ›´åŠ éšæœºæ›´å°ï¼Œä¸€èˆ¬ç«™é•¿é™¤éç”¨æˆ·æŠ•è¯‰å¦åˆ™å¾ˆéš¾è§‰å¯Ÿåˆ°ï¼Œå°±ç®—è§‰å¯Ÿåˆ°äº†å–è¯ä¸¾æŠ¥æ›´éš¾ã€‚æ— è®ºå¦‚ä½•ï¼Œå¦‚æœæ¥åˆ°æœ‰ DNS åŠ«æŒçš„åé¦ˆï¼Œä¸€å®šè¦åšå¥½ä»¥ä¸‹å‡ ä»¶äº‹ï¼š</p>
<ul>
<li>å–è¯å¾ˆé‡è¦ï¼Œæ—¶é—´ã€åœ°ç‚¹ã€IPã€æ‹¨å·è´¦æˆ·ã€æˆªå±ã€URL åœ°å€ç­‰ä¸€å®šè¦æœ‰ã€‚</li>
<li>å¯ä»¥è·ŸåŠ«æŒåŒºåŸŸçš„ç”µä¿¡è¿è¥å•†è¿›è¡ŒæŠ•è¯‰åé¦ˆã€‚</li>
<li>å¦‚æœæŠ•è¯‰åé¦ˆæ— æ•ˆï¼Œç›´æ¥å»å·¥ä¿¡éƒ¨æŠ•è¯‰ï¼Œä¸€èˆ¬æ¥è¯´ä¼šåŠ ç™½ä½ çš„åŸŸåã€‚</li>
</ul>
<h3 id="HTTP-åŠ«æŒ"><a href="#HTTP-åŠ«æŒ" class="headerlink" title="HTTP åŠ«æŒ"></a>HTTP åŠ«æŒ</h3><p>HTTP åŠ«æŒæ‚¨å¯ä»¥è¿™ä¹ˆç†è§£ï¼Œã€Œ<strong>ä½ æ‰“äº†ä¸€è¾†è½¦æƒ³å»å•†åœºåƒé¥­ï¼Œç»“æœå¸æœºè·Ÿä½ ä¸€è·¯ç»™ä½ é€’å°ä½œåŠçš„å¹¿å‘Š</strong>ã€ï¼ŒHTTP åŠ«æŒä¸»è¦æ˜¯å½“ç”¨æˆ·è®¿é—®æŸä¸ªç«™ç‚¹çš„æ—¶å€™ä¼šç»è¿‡è¿è¥å•†ç½‘ç»œï¼Œè€Œä¸æ³•è¿è¥å•†å’Œé»‘äº§å‹¾ç»“èƒ½å¤Ÿæˆªè· HTTP è¯·æ±‚è¿”å›å†…å®¹ï¼Œå¹¶ä¸”èƒ½å¤Ÿç¯¡æ”¹å†…å®¹ï¼Œç„¶åå†è¿”å›ç»™ç”¨æˆ·ï¼Œä»è€Œå®ç°åŠ«æŒé¡µé¢ï¼Œè½»åˆ™æ’å…¥å°å¹¿å‘Šï¼Œé‡åˆ™ç›´æ¥ç¯¡æ”¹æˆé’“é±¼ç½‘ç«™é¡µé¢éª—ç”¨æˆ·éšç§ã€‚èƒ½å¤Ÿå®æ–½æµé‡åŠ«æŒçš„æ ¹æœ¬åŸå› ï¼Œæ˜¯ HTTP åè®®æ²¡æœ‰åŠæ³•å¯¹é€šä¿¡å¯¹æ–¹çš„èº«ä»½è¿›è¡Œæ ¡éªŒä»¥åŠå¯¹æ•°æ®å®Œæ•´æ€§è¿›è¡Œæ ¡éªŒã€‚å¦‚æœèƒ½è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåˆ™æµé‡åŠ«æŒå°†æ— æ³•è½»æ˜“å‘ç”Ÿã€‚æ‰€ä»¥é˜²æ­¢ HTTP åŠ«æŒçš„æ–¹æ³•åªæœ‰å°†å†…å®¹åŠ å¯†ï¼Œè®©åŠ«æŒè€…æ— æ³•ç ´è§£ç¯¡æ”¹ï¼Œè¿™æ ·å°±å¯ä»¥é˜²æ­¢ HTTP åŠ«æŒäº†ã€‚</p>
<p>HTTPS åè®®å°±æ˜¯ä¸€ç§åŸºäº SSL åè®®çš„å®‰å…¨åŠ å¯†ç½‘ç»œåº”ç”¨å±‚åè®®ï¼Œå¯ä»¥å¾ˆå¥½çš„é˜²æ­¢ HTTP åŠ«æŒã€‚è¿™é‡Œæœ‰ç¯‡ <a href="https://www.jianshu.com/p/13a1b955d095" target="_blank" rel="noopener">æ–‡ç« </a> è®²çš„ä¸é”™ã€‚HTTPS åœ¨è¿™å°±ä¸æ·±è®²äº†ï¼Œåé¢æœ‰æœºä¼šæˆ‘ä¼šå•ç‹¬å¥½å¥½è®²è®² HTTPSã€‚å¦‚æœä¸æƒ³ç«™ç‚¹è¢« HTTP åŠ«æŒï¼Œèµ¶ç´§å°†ä½ çš„ç«™ç‚¹å…¨ç«™æ”¹é€ æˆ HTTPS å§ã€‚</p>
<h2 id="æœåŠ¡å™¨æ¼æ´"><a href="#æœåŠ¡å™¨æ¼æ´" class="headerlink" title="æœåŠ¡å™¨æ¼æ´"></a>æœåŠ¡å™¨æ¼æ´</h2><p>æœåŠ¡å™¨é™¤äº†ä»¥ä¸Šæåˆ°çš„é‚£äº›å¤§åé¼é¼çš„æ¼æ´å’Œè‡­åæ˜­è‘—çš„æ”»å‡»ä»¥å¤–ï¼Œå…¶å®è¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„æ¼æ´ï¼Œå¾€å¾€ä¹Ÿå¾ˆå®¹æ˜“è¢«å¿½è§†ï¼Œåœ¨è¿™ä¸ªå°èŠ‚ä¹Ÿç¨å¾®ä»‹ç»å‡ ç§ã€‚</p>
<h3 id="è¶Šæƒæ“ä½œæ¼æ´"><a href="#è¶Šæƒæ“ä½œæ¼æ´" class="headerlink" title="è¶Šæƒæ“ä½œæ¼æ´"></a>è¶Šæƒæ“ä½œæ¼æ´</h3><p>å¦‚æœä½ çš„ç³»ç»Ÿæ˜¯æœ‰ç™»å½•æ§åˆ¶çš„ï¼Œé‚£å°±è¦æ ¼å¤–å°å¿ƒäº†ï¼Œå› ä¸ºå¾ˆæœ‰å¯èƒ½ä½ çš„ç³»ç»Ÿè¶Šæƒæ“ä½œæ¼æ´ï¼Œè¶Šæƒæ“ä½œæ¼æ´å¯ä»¥ç®€å•çš„æ€»ç»“ä¸º ã€Œ<strong>A ç”¨æˆ·èƒ½çœ‹åˆ°æˆ–è€…æ“ä½œ B ç”¨æˆ·çš„éšç§å†…å®¹</strong>ã€ï¼Œå¦‚æœä½ çš„ç³»ç»Ÿä¸­è¿˜æœ‰æƒé™æ§åˆ¶å°±æ›´åŠ éœ€è¦å°å¿ƒäº†ã€‚æ‰€ä»¥æ¯ä¸€ä¸ªè¯·æ±‚éƒ½éœ€è¦åš userid çš„åˆ¤æ–­</p>
<p>ä»¥ä¸‹æ˜¯ä¸€æ®µæœ‰æ¼æ´çš„åç«¯ç¤ºæ„ä»£ç ï¼š</p>
<pre><code>// ctx ä¸ºè¯·æ±‚çš„ context ä¸Šä¸‹æ–‡
let msgId = ctx.params.msgId;

mysql.query(
&apos;SELECT * FROM msg_table WHERE msg_id = ?&apos;,
    [msgId]
);
</code></pre><p>ä»¥ä¸Šä»£ç æ˜¯ä»»ä½•äººéƒ½å¯ä»¥æŸ¥è¯¢åˆ°ä»»ä½•ç”¨æˆ·çš„æ¶ˆæ¯ï¼Œåªè¦æœ‰ msg_id å°±å¯ä»¥ï¼Œè¿™å°±æ˜¯æ¯”è¾ƒå…¸å‹çš„è¶Šæƒæ¼æ´ï¼Œéœ€è¦å¦‚ä¸‹è¿™ä¹ˆæ”¹è¿›ä¸€ä¸‹ï¼š</p>
<pre><code>// ctx ä¸ºè¯·æ±‚çš„ context ä¸Šä¸‹æ–‡
let msgId = ctx.params.msgId;
let userId = ctx.session.userId; // ä»ä¼šè¯ä¸­å–å‡ºå½“å‰ç™»é™†çš„ userId

mysql.query(
&apos;SELECT * FROM msg_table WHERE msg_id = ? AND user_id = ?&apos;,
    [msgId, userId]
);
</code></pre><p>å—¯ï¼Œå¤§æ¦‚å°±æ˜¯è¿™ä¸ªæ„æ€ï¼Œå¦‚æœæœ‰æ›´ä¸¥æ ¼çš„æƒé™æ§åˆ¶ï¼Œé‚£åœ¨æ¯ä¸ªè¯·æ±‚ä¸­å‡¡æ˜¯æ¶‰åŠåˆ°æ•°æ®åº“çš„æ“ä½œéƒ½éœ€è¦å…ˆè¿›è¡Œä¸¥æ ¼çš„éªŒè¯ï¼Œå¹¶ä¸”åœ¨è®¾è®¡æ•°æ®åº“è¡¨çš„æ—¶å€™éœ€è¦è€ƒè™‘è¿› userId çš„è´¦å·å…³è”ä»¥åŠæƒé™å…³è”ã€‚</p>
<h3 id="ç›®å½•éå†æ¼æ´"><a href="#ç›®å½•éå†æ¼æ´" class="headerlink" title="ç›®å½•éå†æ¼æ´"></a>ç›®å½•éå†æ¼æ´</h3><p>ç›®å½•éå†æ¼æ´æŒ‡é€šè¿‡åœ¨ URL æˆ–å‚æ•°ä¸­æ„é€  <code>../</code>ï¼Œ<code>./</code> å’Œç±»ä¼¼çš„è·¨çˆ¶ç›®å½•å­—ç¬¦ä¸²çš„ ASCII ç¼–ç ã€unicode ç¼–ç ç­‰ï¼Œå®Œæˆç›®å½•è·³è½¬ï¼Œè¯»å–æ“ä½œç³»ç»Ÿå„ä¸ªç›®å½•ä¸‹çš„æ•æ„Ÿæ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ç§°ä½œã€Œä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ã€ã€‚</p>
<p>ç›®å½•éå†æ¼æ´åŸç†ï¼šç¨‹åºæ²¡æœ‰å……åˆ†è¿‡æ»¤ç”¨æˆ·è¾“å…¥çš„ <code>../</code> ä¹‹ç±»çš„ç›®å½•è·³è½¬ç¬¦ï¼Œå¯¼è‡´ç”¨æˆ·å¯ä»¥é€šè¿‡æäº¤ç›®å½•è·³è½¬æ¥éå†æœåŠ¡å™¨ä¸Šçš„ä»»æ„æ–‡ä»¶ã€‚ä½¿ç”¨å¤šä¸ª<code>..</code> ç¬¦å·ï¼Œä¸æ–­å‘ä¸Šè·³è½¬ï¼Œæœ€ç»ˆåœç•™åœ¨æ ¹ <code>/</code>ï¼Œé€šè¿‡ç»å¯¹è·¯å¾„å»è¯»å–ä»»æ„æ–‡ä»¶ã€‚</p>
<p>ç›®å½•éå†æ¼æ´å‡ ä¸ªç¤ºä¾‹å’Œæµ‹è¯•ï¼Œä¸€èˆ¬æ„é€  URL ç„¶åä½¿ç”¨æµè§ˆå™¨ç›´æ¥è®¿é—®ï¼Œæˆ–è€…ä½¿ç”¨ Web æ¼æ´æ‰«æå·¥å…·æ£€æµ‹ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥è‡ªå†™ç¨‹åºæµ‹è¯•ã€‚</p>
<pre><code>http://somehost.com/../../../../../../../../../etc/passwd
http://somehost.com/some/path?file=../../Windows/system.ini

# å€ŸåŠ© %00 ç©ºå­—ç¬¦æˆªæ–­æ˜¯ä¸€ä¸ªæ¯”è¾ƒç»å…¸çš„æ”»å‡»æ‰‹æ³•
http://somehost.com/some/path?file=../../Windows/system.ini%00.js

# ä½¿ç”¨äº† IIS çš„è„šæœ¬ç›®å½•æ¥ç§»åŠ¨ç›®å½•å¹¶æ‰§è¡ŒæŒ‡ä»¤
http://somehost.com/scripts/..%5c../Windows/System32/cmd.exe?/c+dir+c:\
</code></pre><p><strong>é˜²å¾¡</strong> æ–¹æ³•å°±æ˜¯éœ€è¦å¯¹ URL æˆ–è€…å‚æ•°è¿›è¡Œ <code>../</code>ï¼Œ<code>./</code> ç­‰å­—ç¬¦çš„è½¬ä¹‰è¿‡æ»¤ã€‚</p>
<h3 id="ç‰©ç†è·¯å¾„æ³„æ¼"><a href="#ç‰©ç†è·¯å¾„æ³„æ¼" class="headerlink" title="ç‰©ç†è·¯å¾„æ³„æ¼"></a>ç‰©ç†è·¯å¾„æ³„æ¼</h3><p>ç‰©ç†è·¯å¾„æ³„éœ²å±äºä½é£é™©ç­‰çº§ç¼ºé™·ï¼Œå®ƒçš„å±å®³ä¸€èˆ¬è¢«æè¿°ä¸ºã€Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´å¾—åˆ°ä¿¡æ¯ï¼Œæ¥å¯¹ç³»ç»Ÿè¿›ä¸€æ­¥åœ°æ”»å‡»ã€ï¼Œé€šå¸¸éƒ½æ˜¯ç³»ç»ŸæŠ¥é”™ 500 çš„é”™è¯¯ä¿¡æ¯ç›´æ¥è¿”å›åˆ°é¡µé¢å¯è§å¯¼è‡´çš„æ¼æ´ã€‚å¾—åˆ°ç‰©ç†è·¯å¾„æœ‰äº›æ—¶å€™å®ƒèƒ½ç»™æ”»å‡»è€…å¸¦æ¥ä¸€äº›æœ‰ç”¨çš„ä¿¡æ¯ï¼Œæ¯”å¦‚è¯´ï¼šå¯ä»¥å¤§è‡´äº†è§£ç³»ç»Ÿçš„æ–‡ä»¶ç›®å½•ç»“æ„ï¼›å¯ä»¥çœ‹å‡ºç³»ç»Ÿæ‰€ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹è½¯ä»¶ï¼›ä¹Ÿè¯´ä¸å®šä¼šå¾—åˆ°ä¸€ä¸ªåˆæ³•çš„ç”¨æˆ·åï¼ˆå› ä¸ºå¾ˆå¤šäººæŠŠè‡ªå·±çš„ç”¨æˆ·åä½œä¸ºç½‘ç«™çš„ç›®å½•åï¼‰ã€‚</p>
<p>é˜²æ­¢è¿™ç§æ³„æ¼çš„æ–¹æ³•å°±æ˜¯åšå¥½åç«¯ç¨‹åºçš„å‡ºé”™å¤„ç†ï¼Œå®šåˆ¶ç‰¹æ®Šçš„ 500 æŠ¥é”™é¡µé¢ã€‚</p>
<h3 id="æºç æš´éœ²æ¼æ´"><a href="#æºç æš´éœ²æ¼æ´" class="headerlink" title="æºç æš´éœ²æ¼æ´"></a>æºç æš´éœ²æ¼æ´</h3><p>å’Œç‰©ç†è·¯å¾„æ³„éœ²ç±»ä¼¼ï¼Œå°±æ˜¯æ”»å‡»è€…å¯ä»¥é€šè¿‡è¯·æ±‚ç›´æ¥è·å–åˆ°ä½ ç«™ç‚¹çš„åç«¯æºä»£ç ï¼Œç„¶åå°±å¯ä»¥å¯¹ç³»ç»Ÿè¿›ä¸€æ­¥ç ”ç©¶æ”»å‡»ã€‚é‚£ä¹ˆå¯¼è‡´æºä»£ç æš´éœ²çš„åŸå› æ˜¯ä»€ä¹ˆå‘¢ï¼ŸåŸºæœ¬ä¸Šå°±æ˜¯å‘ç”Ÿåœ¨æœåŠ¡å™¨é…ç½®ä¸Šäº†ï¼ŒæœåŠ¡å™¨å¯ä»¥è®¾ç½®å“ªäº›è·¯å¾„çš„æ–‡ä»¶æ‰å¯ä»¥è¢«ç›´æ¥è®¿é—®çš„ï¼Œè¿™é‡Œç»™ä¸€ä¸ª koa æœåŠ¡èµ·çš„ä¾‹å­ï¼Œæ­£å¸¸çš„ koa æœåŠ¡å™¨å¯ä»¥é€šè¿‡ koa-static ä¸­é—´ä»¶å»æŒ‡å®šé™æ€èµ„æºçš„ç›®å½•ï¼Œå¥½è®©é™æ€èµ„æºå¯ä»¥é€šè¿‡è·¯å¾„çš„è·¯ç”±è®¿é—®ã€‚æ¯”å¦‚ä½ çš„ç³»ç»Ÿæºä»£ç ç›®å½•æ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code>|- project
    |- src
    |- static
    |- ...
|- server.js
</code></pre><p>ä½ æƒ³è¦å°† static çš„æ–‡ä»¶å¤¹é…æˆé™æ€èµ„æºç›®å½•ï¼Œä½ åº”è¯¥ä¼šåœ¨ <code>server.js</code> åšå¦‚ä¸‹é…ç½®ï¼š</p>
<pre><code>const Koa = require(&apos;koa&apos;);
const serve = require(&apos;koa-static&apos;);
const app = new Koa();

app.use(serve(__dirname + &apos;/project/static&apos;));
</code></pre><p>ä½†æ˜¯å¦‚æœé…é”™äº†é™æ€èµ„æºçš„ç›®å½•ï¼Œå¯èƒ½å°±å‡ºå¤§äº‹äº†ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code>// ...
app.use(serve(__dirname + &apos;/project&apos;));
</code></pre><p>è¿™æ ·æ‰€æœ‰çš„æºä»£ç éƒ½å¯ä»¥é€šè¿‡è·¯ç”±è®¿é—®åˆ°äº†ï¼Œæ‰€æœ‰çš„æœåŠ¡å™¨éƒ½æä¾›äº†é™æ€èµ„æºæœºåˆ¶ï¼Œæ‰€ä»¥åœ¨é€šè¿‡æœåŠ¡å™¨é…ç½®é™æ€èµ„æºç›®å½•å’Œè·¯å¾„çš„æ—¶å€™ï¼Œä¸€å®šè¦æ³¨æ„æ£€éªŒï¼Œä¸ç„¶å¾ˆå¯èƒ½äº§ç”Ÿæ¼æ´ã€‚</p>
<p>æœ€åï¼Œå¸Œæœ› Web å¼€å‘è€…ä»¬èƒ½å¤Ÿç®¡ç†å¥½è‡ªå·±çš„ä»£ç éšç§ï¼Œæ³¨æ„ä»£ç å®‰å…¨é—®é¢˜ï¼Œæ¯”å¦‚ä¸è¦å°†äº§å“çš„å«æœ‰æ•æ„Ÿä¿¡æ¯çš„ä»£ç æ”¾åˆ°ç¬¬ä¸‰æ–¹å¤–éƒ¨ç«™ç‚¹æˆ–è€…æš´éœ²ç»™å¤–éƒ¨ç”¨æˆ·ï¼Œå°¤å…¶æ˜¯å‰ç«¯ä»£ç ï¼Œç§é’¥ç±»ä¼¼çš„ä¿å¯†æ€§çš„ä¸œè¥¿ä¸è¦ç›´æ¥è¾“å‡ºåœ¨ä»£ç é‡Œæˆ–è€…é¡µé¢ä¸­ã€‚ä¹Ÿè®¸è¿˜æœ‰å¾ˆå¤šå€¼å¾—æ³¨æ„çš„ç‚¹ï¼Œä½†æ˜¯å½’æ ¹ç»“åº•è¿˜æ˜¯ç»·ä½å®‰å…¨é‚£æ ¹å¼¦ï¼Œå¯¹å¾…æ¯ä¸€è¡Œä»£ç éƒ½è¦å¤šå¤šæ¨æ•²ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/08/KOA2æ¡†æ¶åŸç†è§£æå’Œå®ç°/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="èˆåŠ¨ä¹¾å¤">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/08/KOA2æ¡†æ¶åŸç†è§£æå’Œå®ç°/" itemprop="url">KOA2æ¡†æ¶åŸç†è§£æå’Œå®ç°</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-01-08T20:08:28+08:00">
                2018-01-08
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="ä»€ä¹ˆæ˜¯koaæ¡†æ¶ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯koaæ¡†æ¶ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯koaæ¡†æ¶ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯koaæ¡†æ¶ï¼Ÿ</h3><p>koaæ˜¯ä¸€ä¸ªåŸºäºnodeå®ç°çš„ä¸€ä¸ªæ–°çš„webæ¡†æ¶ï¼Œå®ƒæ˜¯ç”±expressæ¡†æ¶çš„åŸç­äººé©¬æ‰“é€ çš„ã€‚å®ƒçš„ç‰¹ç‚¹æ˜¯ä¼˜é›…ã€ç®€æ´ã€è¡¨è¾¾åŠ›å¼ºã€è‡ªç”±åº¦é«˜ã€‚å®ƒæ›´expressç›¸æ¯”ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ›´è½»é‡çš„nodeæ¡†æ¶ï¼Œå› ä¸ºå®ƒæ‰€æœ‰åŠŸèƒ½éƒ½é€šè¿‡æ’ä»¶å®ç°ï¼Œè¿™ç§æ’æ‹”å¼çš„æ¶æ„è®¾è®¡æ¨¡å¼ï¼Œå¾ˆç¬¦åˆunixå“²å­¦ã€‚</p>
<p>koaæ¡†æ¶ç°åœ¨æ›´æ–°åˆ°äº†2.xç‰ˆæœ¬ï¼Œæœ¬æ–‡ä»é›¶å¼€å§‹ï¼Œå¾ªåºæ¸è¿›ï¼Œè®²è§£koa2çš„æ¡†æ¶æºç ç»“æ„å’Œå®ç°åŸç†ï¼Œå±•ç¤ºå’Œè¯¦è§£koa2æ¡†æ¶æºç ä¸­çš„å‡ ä¸ªæœ€é‡è¦çš„æ¦‚å¿µï¼Œç„¶åæ‰‹æŠŠæ‰‹æ•™å¤§å®¶äº²è‡ªå®ç°ä¸€ä¸ªç®€æ˜“çš„koa2æ¡†æ¶ï¼Œå¸®åŠ©å¤§å®¶å­¦ä¹ å’Œæ›´æ·±å±‚æ¬¡çš„ç†è§£koa2ï¼Œçœ‹å®Œæœ¬æ–‡ä»¥åï¼Œå†å»å¯¹ç…§koa2çš„æºç è¿›è¡ŒæŸ¥çœ‹ï¼Œç›¸ä¿¡ä½ çš„æ€è·¯å°†ä¼šéå¸¸çš„é¡ºç•…ã€‚</p>
<p>æœ¬æ–‡æ‰€ç”¨çš„æ¡†æ¶æ˜¯koa2ï¼Œå®ƒè·Ÿkoa1ä¸åŒï¼Œkoa1ä½¿ç”¨çš„æ˜¯generator+co.jsçš„æ‰§è¡Œæ–¹å¼ï¼Œè€Œkoa2ä¸­ä½¿ç”¨äº†async/awaitï¼Œå› æ­¤æœ¬æ–‡çš„ä»£ç å’Œdemoéœ€è¦è¿è¡Œåœ¨node 8ç‰ˆæœ¬åŠå…¶ä»¥ä¸Šï¼Œå¦‚æœè¯»è€…çš„nodeç‰ˆæœ¬è¾ƒä½ï¼Œå»ºè®®å‡çº§æˆ–è€…å®‰è£…babel-cliï¼Œç”¨å…¶ä¸­çš„babel-nodeæ¥è¿è¡Œæœ¬æ–‡æ¶‰åŠåˆ°çš„ä»£ç ã€‚</p>
<h3 id="koaæºç ç»“æ„"><a href="#koaæºç ç»“æ„" class="headerlink" title="koaæºç ç»“æ„"></a>koaæºç ç»“æ„</h3><p><img src="/2018/01/08/KOA2æ¡†æ¶åŸç†è§£æå’Œå®ç°/166f12b8563436a3.webp" alt=""><br>ä¸Šå›¾æ˜¯koa2çš„æºç ç›®å½•ç»“æ„çš„libæ–‡ä»¶å¤¹ï¼Œlibæ–‡ä»¶å¤¹ä¸‹æ”¾ç€å››ä¸ªkoa2çš„æ ¸å¿ƒæ–‡ä»¶ï¼šapplication.jsã€context.jsã€request.jsã€response.jsã€‚</p>
<h4 id="application-js"><a href="#application-js" class="headerlink" title="application.js"></a>application.js</h4><p>application.jsæ˜¯koaçš„å…¥å£æ–‡ä»¶ï¼Œå®ƒå‘å¤–å¯¼å‡ºäº†åˆ›å»ºclasså®ä¾‹çš„æ„é€ å‡½æ•°ï¼Œå®ƒç»§æ‰¿äº†eventsï¼Œè¿™æ ·å°±ä¼šèµ‹äºˆæ¡†æ¶äº‹ä»¶ç›‘å¬å’Œäº‹ä»¶è§¦å‘çš„èƒ½åŠ›ã€‚applicationè¿˜æš´éœ²äº†ä¸€äº›å¸¸ç”¨çš„apiï¼Œæ¯”å¦‚toJSONã€listenã€useç­‰ç­‰ã€‚</p>
<p>listençš„å®ç°åŸç†å…¶å®å°±æ˜¯å¯¹http.createServerè¿›è¡Œäº†ä¸€ä¸ªå°è£…ï¼Œé‡ç‚¹æ˜¯è¿™ä¸ªå‡½æ•°ä¸­ä¼ å…¥çš„callbackï¼Œå®ƒé‡Œé¢åŒ…å«äº†ä¸­é—´ä»¶çš„åˆå¹¶ï¼Œä¸Šä¸‹æ–‡çš„å¤„ç†ï¼Œå¯¹resçš„ç‰¹æ®Šå¤„ç†ã€‚</p>
<p>useæ˜¯æ”¶é›†ä¸­é—´ä»¶ï¼Œå°†å¤šä¸ªä¸­é—´ä»¶æ”¾å…¥ä¸€ä¸ªç¼“å­˜é˜Ÿåˆ—ä¸­ï¼Œç„¶åé€šè¿‡koa-composeè¿™ä¸ªæ’ä»¶è¿›è¡Œé€’å½’ç»„åˆè°ƒç”¨è¿™ä¸€äº›åˆ—çš„ä¸­é—´ä»¶ã€‚</p>
<h4 id="context-js"><a href="#context-js" class="headerlink" title="context.js"></a>context.js</h4><p>è¿™éƒ¨åˆ†å°±æ˜¯koaçš„åº”ç”¨ä¸Šä¸‹æ–‡ctx,å…¶å®å°±ä¸€ä¸ªç®€å•çš„å¯¹è±¡æš´éœ²ï¼Œé‡Œé¢çš„é‡ç‚¹åœ¨delegateï¼Œè¿™ä¸ªå°±æ˜¯ä»£ç†ï¼Œè¿™ä¸ªå°±æ˜¯ä¸ºäº†å¼€å‘è€…æ–¹ä¾¿è€Œè®¾è®¡çš„ï¼Œæ¯”å¦‚æˆ‘ä»¬è¦è®¿é—®ctx.repsponse.statusä½†æ˜¯æˆ‘ä»¬é€šè¿‡delegateï¼Œå¯ä»¥ç›´æ¥è®¿é—®ctx.statusè®¿é—®åˆ°å®ƒã€‚</p>
<h4 id="request-jsã€response-js"><a href="#request-jsã€response-js" class="headerlink" title="request.jsã€response.js"></a>request.jsã€response.js</h4><p>è¿™ä¸¤éƒ¨åˆ†å°±æ˜¯å¯¹åŸç”Ÿçš„resã€reqçš„ä¸€äº›æ“ä½œäº†ï¼Œå¤§é‡ä½¿ç”¨es6çš„getå’Œsetçš„ä¸€äº›è¯­æ³•ï¼Œå»å–headersæˆ–è€…è®¾ç½®headersã€è¿˜æœ‰è®¾ç½®bodyç­‰ç­‰ï¼Œè¿™äº›å°±ä¸è¯¦ç»†ä»‹ç»äº†ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥è‡ªè¡Œçœ‹æºç ã€‚</p>
<h3 id="å®ç°koa2çš„å››å¤§æ¨¡å—"><a href="#å®ç°koa2çš„å››å¤§æ¨¡å—" class="headerlink" title="å®ç°koa2çš„å››å¤§æ¨¡å—"></a>å®ç°koa2çš„å››å¤§æ¨¡å—</h3><p>ä¸Šæ–‡ç®€è¿°äº†koa2æºç çš„å¤§ä½“æ¡†æ¶ç»“æ„ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥å®ç°ä¸€ä¸ªkoa2çš„æ¡†æ¶ï¼Œç¬”è€…è®¤ä¸ºç†è§£å’Œå®ç°ä¸€ä¸ªkoaæ¡†æ¶éœ€è¦å®ç°å››ä¸ªå¤§æ¨¡å—ï¼Œåˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li><p>å°è£…node http serverã€åˆ›å»ºKoaç±»æ„é€ å‡½æ•°</p>
</li>
<li><p>æ„é€ requestã€responseã€contextå¯¹è±¡</p>
</li>
<li><p>ä¸­é—´ä»¶æœºåˆ¶å’Œå‰¥æ´‹è‘±æ¨¡å‹çš„å®ç°</p>
</li>
<li><p>é”™è¯¯æ•è·å’Œé”™è¯¯å¤„ç†</p>
</li>
</ul>
<p>ä¸‹é¢æˆ‘ä»¬å°±é€ä¸€åˆ†æå’Œå®ç°ã€‚</p>
<h4 id="æ¨¡å—ä¸€ï¼šå°è£…node-http-serverå’Œåˆ›å»ºKoaç±»æ„é€ å‡½æ•°"><a href="#æ¨¡å—ä¸€ï¼šå°è£…node-http-serverå’Œåˆ›å»ºKoaç±»æ„é€ å‡½æ•°" class="headerlink" title="æ¨¡å—ä¸€ï¼šå°è£…node http serverå’Œåˆ›å»ºKoaç±»æ„é€ å‡½æ•°"></a>æ¨¡å—ä¸€ï¼šå°è£…node http serverå’Œåˆ›å»ºKoaç±»æ„é€ å‡½æ•°</h4><p>é˜…è¯»koa2çš„æºç å¾—çŸ¥ï¼Œå®ç°koaçš„æœåŠ¡å™¨åº”ç”¨å’Œç«¯å£ç›‘å¬ï¼Œå…¶å®å°±æ˜¯åŸºäºnodeçš„åŸç”Ÿä»£ç è¿›è¡Œäº†å°è£…ï¼Œå¦‚ä¸‹å›¾çš„ä»£ç å°±æ˜¯é€šè¿‡nodeåŸç”Ÿä»£ç å®ç°çš„æœåŠ¡å™¨ç›‘å¬ã€‚</p>
<pre><code>let http = require(&apos;http&apos;);
let server = http.createServer((req, res) =&gt; {
    res.writeHead(200);
    res.end(&apos;hello world&apos;);
});
server.listen(3000, () =&gt; {    
    console.log(&apos;listenning on 3000&apos;);
});
</code></pre><p>æˆ‘ä»¬éœ€è¦å°†ä¸Šé¢çš„nodeåŸç”Ÿä»£ç å°è£…å®ç°æˆkoaçš„æ¨¡å¼ï¼š</p>
<pre><code>const http = require(&apos;http&apos;);
const Koa = require(&apos;koa&apos;);
const app = new Koa();
app.listen(3000);
</code></pre><p>å®ç°koaçš„ç¬¬ä¸€æ­¥å°±æ˜¯å¯¹ä»¥ä¸Šçš„è¿™ä¸ªè¿‡ç¨‹è¿›è¡Œå°è£…ï¼Œä¸ºæ­¤æˆ‘ä»¬éœ€è¦åˆ›å»ºapplication.jså®ç°ä¸€ä¸ªApplicationç±»çš„æ„é€ å‡½æ•°ï¼š</p>
<pre><code>let http = require(&apos;http&apos;);
class Application{    
    constructor() {        
        this.callbackFunc;
    }
    listen(port) {        
        let server = http.createServer(this.callback());
        server.listen(port);
    }
    use(fn) {
        this.callbackFunc = fn;
    }
    callback() {
        return(req, res) =&gt; {
            this.callbackFunc(req, res);
        };
    }
}
module.exports = Application;
</code></pre><p>ç„¶ååˆ›å»ºexample.jsï¼Œå¼•å…¥application.jsï¼Œè¿è¡ŒæœåŠ¡å™¨å®ä¾‹å¯åŠ¨ç›‘å¬ä»£ç ï¼š</p>
<pre><code>let Koa = require(&apos;./application&apos;);
let app = new Koa();
app.use((req, res) =&gt; {
    res.writeHead(200);
    res.end(&apos;hello world&apos;);
});
app.listen(3000, () =&gt; {
    console.log(&apos;listening on 3000&apos;);
});
</code></pre><p>ç°åœ¨åœ¨æµè§ˆå™¨è¾“å…¥localhost:3000å³å¯çœ‹åˆ°æµè§ˆå™¨é‡Œæ˜¾ç¤ºâ€œhello worldâ€ã€‚ç°åœ¨ç¬¬ä¸€æ­¥æˆ‘ä»¬å·²ç»å®Œæˆäº†ï¼Œå¯¹http serverè¿›è¡Œäº†ç®€å•çš„å°è£…å’Œåˆ›å»ºäº†ä¸€ä¸ªå¯ä»¥ç”Ÿæˆkoaå®ä¾‹çš„ç±»classï¼Œè¿™ä¸ªç±»é‡Œè¿˜å®ç°äº†app.useç”¨æ¥æ³¨å†Œä¸­é—´ä»¶å’Œæ³¨å†Œå›è°ƒå‡½æ•°ï¼Œapp.listenç”¨æ¥å¼€å¯æœåŠ¡å™¨å®ä¾‹å¹¶ä¼ å…¥callbackå›è°ƒå‡½æ•°ï¼Œç¬¬ä¸€æ¨¡å—ä¸»è¦æ˜¯å®ç°å…¸å‹çš„koaé£æ ¼å’Œæ­å¥½äº†ä¸€ä¸ªkoaçš„ç®€å•çš„æ¶å­ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹ç¼–å†™å’Œè®²è§£ç¬¬äºŒæ¨¡å—ã€‚</p>
<h5 id="æ¨¡å—äºŒï¼šæ„é€ requestã€responseã€contextå¯¹è±¡"><a href="#æ¨¡å—äºŒï¼šæ„é€ requestã€responseã€contextå¯¹è±¡" class="headerlink" title="æ¨¡å—äºŒï¼šæ„é€ requestã€responseã€contextå¯¹è±¡"></a>æ¨¡å—äºŒï¼šæ„é€ requestã€responseã€contextå¯¹è±¡</h5><p>é˜…è¯»koa2çš„æºç å¾—çŸ¥ï¼Œå…¶ä¸­context.jsã€request.jsã€response.jsä¸‰ä¸ªæ–‡ä»¶åˆ†åˆ«æ˜¯requestã€responseã€contextä¸‰ä¸ªæ¨¡å—çš„ä»£ç æ–‡ä»¶ã€‚contextå°±æ˜¯æˆ‘ä»¬å¹³æ—¶å†™koaä»£ç æ—¶çš„ctxï¼Œå®ƒç›¸å½“äºä¸€ä¸ªå…¨å±€çš„koaå®ä¾‹ä¸Šä¸‹æ–‡thisï¼Œå®ƒè¿æ¥äº†requestã€responseä¸¤ä¸ªåŠŸèƒ½æ¨¡å—ï¼Œå¹¶ä¸”æš´éœ²ç»™koaçš„å®ä¾‹å’Œä¸­é—´ä»¶ç­‰å›è°ƒå‡½æ•°çš„å‚æ•°ä¸­ï¼Œèµ·åˆ°æ‰¿ä¸Šå¯ä¸‹çš„ä½œç”¨ã€‚</p>
<p>requestã€responseä¸¤ä¸ªåŠŸèƒ½æ¨¡å—åˆ†åˆ«å¯¹nodeçš„åŸç”Ÿrequestã€responseè¿›è¡Œäº†ä¸€ä¸ªåŠŸèƒ½çš„å°è£…ï¼Œä½¿ç”¨äº†getterå’Œsetterå±æ€§ï¼ŒåŸºäºnodeçš„å¯¹è±¡req/reså¯¹è±¡å°è£…koaçš„request/responseå¯¹è±¡ã€‚æˆ‘ä»¬åŸºäºè¿™ä¸ªåŸç†ç®€å•å®ç°ä¸€ä¸‹request.jsã€response.jsï¼Œé¦–å…ˆåˆ›å»ºrequest.jsæ–‡ä»¶ï¼Œç„¶åå†™å…¥ä»¥ä¸‹ä»£ç ï¼š</p>
<pre><code>let url = require(&apos;url&apos;);
module.exports = {
    get query() {
        return url.parse(this.req.url, true).query;
    }
};
</code></pre><p>è¿™æ ·å½“ä½ åœ¨koaå®ä¾‹é‡Œä½¿ç”¨ctx.queryçš„æ—¶å€™ï¼Œå°±ä¼šè¿”å›url.parse(this.req.url, true).queryçš„å€¼ã€‚çœ‹æºç å¯çŸ¥ï¼ŒåŸºäºgetterå’Œsetterï¼Œåœ¨request.jsé‡Œè¿˜å°è£…äº†headerã€urlã€originã€pathç­‰æ–¹æ³•ï¼Œéƒ½æ˜¯å¯¹åŸç”Ÿçš„requestä¸Šç”¨getterå’Œsetterè¿›è¡Œäº†å°è£…ï¼Œç¬”è€…ä¸å†è¿™é‡Œä¸€ä¸€å®ç°ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å®ç°response.jsæ–‡ä»¶ä»£ç æ¨¡å—ï¼Œå®ƒå’ŒrequeståŸç†ä¸€æ ·ï¼Œä¹Ÿæ˜¯åŸºäºgetterå’Œsetterå¯¹åŸç”Ÿresponseè¿›è¡Œäº†å°è£…ï¼Œé‚£æˆ‘ä»¬æ¥ä¸‹æ¥é€šè¿‡å¯¹å¸¸ç”¨çš„ctx.bodyå’Œctx.statusè¿™ä¸ªä¸¤ä¸ªè¯­å¥å½“åšä¾‹å­ç®€è¿°ä¸€ä¸‹å¦‚æœå®ç°koaçš„responseçš„æ¨¡å—ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºå¥½response.jsæ–‡ä»¶ï¼Œç„¶åè¾“å…¥ä¸‹é¢çš„ä»£ç ï¼š</p>
<pre><code>module.exports = {
    get body() {
        returnthis._body;
    },
    set body(data) {
        this._body = data;
    },
    get status() {
        returnthis.res.statusCode;
    },
    set status(statusCode) {
        if (typeof statusCode !== &apos;number&apos;) {
            thrownewError(&apos;something wrong!&apos;);
        }
        this.res.statusCode = statusCode;
    }
};
</code></pre><p>ä»¥ä¸Šä»£ç å®ç°äº†å¯¹koaçš„statusçš„è¯»å–å’Œè®¾ç½®ï¼Œè¯»å–çš„æ—¶å€™è¿”å›çš„æ˜¯åŸºäºåŸç”Ÿçš„responseå¯¹è±¡çš„statusCodeå±æ€§ï¼Œè€Œbodyçš„è¯»å–åˆ™æ˜¯å¯¹this._bodyè¿›è¡Œè¯»å†™å’Œæ“ä½œã€‚è¿™é‡Œå¯¹bodyè¿›è¡Œæ“ä½œå¹¶æ²¡æœ‰ä½¿ç”¨åŸç”Ÿçš„this.res.endï¼Œå› ä¸ºåœ¨æˆ‘ä»¬ç¼–å†™koaä»£ç çš„æ—¶å€™ï¼Œä¼šå¯¹bodyè¿›è¡Œå¤šæ¬¡çš„è¯»å–å’Œä¿®æ”¹ï¼Œæ‰€ä»¥çœŸæ­£è¿”å›æµè§ˆå™¨ä¿¡æ¯çš„æ“ä½œæ˜¯åœ¨application.jsé‡Œè¿›è¡Œå°è£…å’Œæ“ä½œã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬å·²ç»å®ç°äº†request.jsã€response.jsï¼Œè·å–åˆ°äº†requestã€responseå¯¹è±¡å’Œä»–ä»¬çš„å°è£…çš„æ–¹æ³•ï¼Œç„¶åæˆ‘ä»¬å¼€å§‹å®ç°context.jsï¼Œcontextçš„ä½œç”¨å°±æ˜¯å°†requestã€responseå¯¹è±¡æŒ‚è½½åˆ°ctxçš„ä¸Šé¢ï¼Œè®©koaå®ä¾‹å’Œä»£ç èƒ½æ–¹ä¾¿çš„ä½¿ç”¨åˆ°requestã€responseå¯¹è±¡ä¸­çš„æ–¹æ³•ã€‚ç°åœ¨æˆ‘ä»¬åˆ›å»ºcontext.jsæ–‡ä»¶ï¼Œè¾“å…¥å¦‚ä¸‹ä»£ç ï¼š</p>
<pre><code>let proto = {};

function delegateSet(property, name) {
    proto.__defineSetter__(name, function (val) {
        this[property][name] = val;
    });
}

function delegateGet(property, name) {
    proto.__defineGetter__(name, function () {
        returnthis[property][name];
    });
}

let requestSet = [];
let requestGet = [&apos;query&apos;];

let responseSet = [&apos;body&apos;, &apos;status&apos;];
let responseGet = responseSet;

requestSet.forEach(ele =&gt; {
    delegateSet(&apos;request&apos;, ele);
});

requestGet.forEach(ele =&gt; {
    delegateGet(&apos;request&apos;, ele);
});

responseSet.forEach(ele =&gt; {
    delegateSet(&apos;response&apos;, ele);
});

responseGet.forEach(ele =&gt; {
    delegateGet(&apos;response&apos;, ele);
});

module.exports = proto;
</code></pre><p>context.jsæ–‡ä»¶ä¸»è¦æ˜¯å¯¹å¸¸ç”¨çš„requestå’Œresponseæ–¹æ³•è¿›è¡ŒæŒ‚è½½å’Œä»£ç†ï¼Œé€šè¿‡context.queryç›´æ¥ä»£ç†äº†context.request.queryï¼Œcontext.bodyå’Œcontext.statusä»£ç†äº†context.response.bodyä¸context.response.statusã€‚è€Œcontext.requestï¼Œcontext.responseåˆ™ä¼šåœ¨application.jsä¸­æŒ‚è½½</p>
<p>æœ¬æ¥å¯ä»¥ç”¨ç®€å•çš„setterå’Œgetterå»è®¾ç½®æ¯ä¸€ä¸ªæ–¹æ³•ï¼Œä½†æ˜¯ç”±äºcontextå¯¹è±¡å®šä¹‰æ–¹æ³•æ¯”è¾ƒç®€å•å’Œè§„èŒƒï¼Œåœ¨koaæºç é‡Œå¯ä»¥çœ‹åˆ°ï¼Œkoaæºç ç”¨çš„æ˜¯<strong>defineSetter</strong>å’Œ<strong>defineSetter</strong>æ¥ä»£æ›¿setter/getteræ¯ä¸€ä¸ªå±æ€§çš„è¯»å–è®¾ç½®ï¼Œè¿™æ ·åšä¸»è¦æ˜¯æ–¹ä¾¿æ‹“å±•å’Œç²¾ç®€äº†å†™æ³•ï¼Œå½“æˆ‘ä»¬éœ€è¦ä»£ç†æ›´å¤šçš„reså’Œreqçš„æ–¹æ³•çš„æ—¶å€™ï¼Œå¯ä»¥å‘context.jsæ–‡ä»¶é‡Œé¢çš„æ•°ç»„å¯¹è±¡é‡Œé¢æ·»åŠ å¯¹åº”çš„æ–¹æ³•åå’Œå±æ€§åå³å¯ã€‚</p>
<p>ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»å¾—åˆ°äº†requestã€responseã€contextä¸‰ä¸ªæ¨¡å—å¯¹è±¡äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å°†requestã€responseæ‰€æœ‰æ–¹æ³•æŒ‚è½½åˆ°contextä¸‹ï¼Œè®©contextå®ç°å®ƒçš„æ‰¿ä¸Šå¯ä¸‹çš„ä½œç”¨ï¼Œä¿®æ”¹application.jsæ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p>
<pre><code>let http = require(&apos;http&apos;);
let context = require(&apos;./context&apos;);
let request = require(&apos;./request&apos;);
let response = require(&apos;./response&apos;);

createContext(req, res) {       
   let ctx = Object.create(this.context);
   ctx.request = Object.create(this.request);
   ctx.response = Object.create(this.response);
   ctx.req = ctx.request.req = req;
   ctx.res = ctx.response.res = res; 
   return ctx;
}
</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬æ·»åŠ äº†createContextè¿™ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯å…³é”®ï¼Œå®ƒé€šè¿‡Object.createåˆ›å»ºäº†ctxï¼Œå¹¶å°†requestå’ŒresponseæŒ‚è½½åˆ°äº†ctxä¸Šé¢ï¼Œå°†åŸç”Ÿçš„reqå’ŒresæŒ‚è½½åˆ°äº†ctxçš„å­å±æ€§ä¸Šï¼Œå¾€å›çœ‹ä¸€ä¸‹context/request/response.jsæ–‡ä»¶ï¼Œå°±èƒ½çŸ¥é“å½“æ—¶ä½¿ç”¨çš„this.resæˆ–è€…this.responseä¹‹ç±»çš„æ˜¯ä»å“ªé‡Œæ¥çš„äº†ï¼ŒåŸæ¥æ˜¯åœ¨è¿™ä¸ªcreateContextæ–¹æ³•ä¸­æŒ‚è½½åˆ°äº†å¯¹åº”çš„å®ä¾‹ä¸Šï¼Œæ„å»ºäº†è¿è¡Œæ—¶ä¸Šä¸‹æ–‡ctxä¹‹åï¼Œæˆ‘ä»¬çš„app.useå›è°ƒå‡½æ•°å‚æ•°å°±éƒ½åŸºäºctxäº†ã€‚</p>
<h4 id="æ¨¡å—ä¸‰ï¼šä¸­é—´ä»¶æœºåˆ¶å’Œå‰¥æ´‹è‘±æ¨¡å‹çš„å®ç°"><a href="#æ¨¡å—ä¸‰ï¼šä¸­é—´ä»¶æœºåˆ¶å’Œå‰¥æ´‹è‘±æ¨¡å‹çš„å®ç°" class="headerlink" title="æ¨¡å—ä¸‰ï¼šä¸­é—´ä»¶æœºåˆ¶å’Œå‰¥æ´‹è‘±æ¨¡å‹çš„å®ç°"></a>æ¨¡å—ä¸‰ï¼šä¸­é—´ä»¶æœºåˆ¶å’Œå‰¥æ´‹è‘±æ¨¡å‹çš„å®ç°</h4><p>ç›®å‰ä¸ºæ­¢æˆ‘ä»¬å·²ç»æˆåŠŸå®ç°äº†ä¸Šä¸‹æ–‡contextå¯¹è±¡ã€ è¯·æ±‚requestå¯¹è±¡å’Œå“åº”responseå¯¹è±¡æ¨¡å—ï¼Œè¿˜å·®ä¸€ä¸ªæœ€é‡è¦çš„æ¨¡å—ï¼Œå°±æ˜¯koaçš„ä¸­é—´ä»¶æ¨¡å—ï¼Œkoaçš„ä¸­é—´ä»¶æœºåˆ¶æ˜¯ä¸€ä¸ªå‰¥æ´‹è‘±å¼çš„æ¨¡å‹ï¼Œå¤šä¸ªä¸­é—´ä»¶é€šè¿‡useæ”¾è¿›ä¸€ä¸ªæ•°ç»„é˜Ÿåˆ—ç„¶åä»å¤–å±‚å¼€å§‹æ‰§è¡Œï¼Œé‡åˆ°nextåè¿›å…¥é˜Ÿåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ï¼Œæ‰€æœ‰ä¸­é—´ä»¶æ‰§è¡Œå®Œåå¼€å§‹å›å¸§ï¼Œæ‰§è¡Œé˜Ÿåˆ—ä¸­ä¹‹å‰ä¸­é—´ä»¶ä¸­æœªæ‰§è¡Œçš„ä»£ç éƒ¨åˆ†ï¼Œè¿™å°±æ˜¯å‰¥æ´‹è‘±æ¨¡å‹ï¼Œkoaçš„ä¸­é—´ä»¶æœºåˆ¶ã€‚</p>
<p>koaçš„å‰¥æ´‹è‘±æ¨¡å‹åœ¨koa1ä¸­ä½¿ç”¨çš„æ˜¯generator + co.jså»å®ç°çš„ï¼Œkoa2åˆ™ä½¿ç”¨äº†async/await + Promiseå»å®ç°çš„ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬åŸºäºasync/await + Promiseå»å®ç°koa2ä¸­çš„ä¸­é—´ä»¶æœºåˆ¶ã€‚é¦–å…ˆï¼Œå‡è®¾å½“koaçš„ä¸­é—´ä»¶æœºåˆ¶å·²ç»åšå¥½äº†ï¼Œé‚£ä¹ˆå®ƒæ˜¯èƒ½æˆåŠŸè¿è¡Œä¸‹é¢ä»£ç çš„ï¼š</p>
<pre><code>let Koa = require(&apos;../src/application&apos;);

let app = new Koa();

app.use(async (ctx, next) =&gt; {
    console.log(1);
    await next();
    console.log(6);
});

app.use(async (ctx, next) =&gt; {
    console.log(2);
    await next();
    console.log(5);
});

app.use(async (ctx, next) =&gt; {
    console.log(3);
    ctx.body = &quot;hello world&quot;;
    console.log(4);
});

app.listen(3000, () =&gt; {
    console.log(&apos;listenning on 3000&apos;);
});
</code></pre><p>è¿è¡ŒæˆåŠŸåä¼šåœ¨ç»ˆç«¯è¾“å‡º123456ï¼Œé‚£å°±èƒ½éªŒè¯æˆ‘ä»¬çš„koaçš„å‰¥æ´‹è‘±æ¨¡å‹æ˜¯æ­£ç¡®çš„ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹å®ç°ï¼Œä¿®æ”¹application.jsæ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p>
<pre><code>compose() {
    return async ctx =&gt; {
        function createNext(middleware, oldNext) {
            return async () =&gt; {
                await middleware(ctx, oldNext);
            }
        }
        let len = this.middlewares.length;
        let next = async () =&gt; {
            return Promise.resolve();
        };
        for (let i = len - 1; i &gt;= 0; i--) {
            let currentMiddleware = this.middlewares[i];
            next = createNext(currentMiddleware, next);
        }
        await next();
    };
}

callback() {
    return(req, res) =&gt; {
        let ctx = this.createContext(req, res);
        let respond = () =&gt;this.responseBody(ctx);
        let onerror = (err) =&gt;this.onerror(err, ctx);
        let fn = this.compose();
        return fn(ctx);
    };
}
</code></pre><p>koaé€šè¿‡useå‡½æ•°ï¼ŒæŠŠæ‰€æœ‰çš„ä¸­é—´ä»¶pushåˆ°ä¸€ä¸ªå†…éƒ¨æ•°ç»„é˜Ÿåˆ—this.middlewaresä¸­ï¼Œå‰¥æ´‹è‘±æ¨¡å‹èƒ½è®©æ‰€æœ‰çš„ä¸­é—´ä»¶ä¾æ¬¡æ‰§è¡Œï¼Œæ¯æ¬¡æ‰§è¡Œå®Œä¸€ä¸ªä¸­é—´ä»¶ï¼Œé‡åˆ°next()å°±ä¼šå°†æ§åˆ¶æƒä¼ é€’åˆ°ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ï¼Œä¸‹ä¸€ä¸ªä¸­é—´ä»¶çš„nextå‚æ•°ï¼Œå‰¥æ´‹è‘±æ¨¡å‹çš„æœ€å…³é”®ä»£ç æ˜¯composeè¿™ä¸ªå‡½æ•°ï¼š</p>
<pre><code>compose() {
        return async ctx =&gt; {
            function createNext(middleware, oldNext) {
                returnasync () =&gt; {
                    await middleware(ctx, oldNext);
                }
            }
            let len = this.middlewares.length;
            let next = async () =&gt; {
                return Promise.resolve();
            };
            for (let i = len - 1; i &gt;= 0; i--) {
                let currentMiddleware = this.middlewares[i];
                next = createNext(currentMiddleware, next);
            }
            await next();
        };
    }
</code></pre><p>createNextå‡½æ•°çš„ä½œç”¨å°±æ˜¯å°†ä¸Šä¸€ä¸ªä¸­é—´ä»¶çš„nextå½“åšå‚æ•°ä¼ ç»™ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ï¼Œå¹¶ä¸”å°†ä¸Šä¸‹æ–‡ctxç»‘å®šå½“å‰ä¸­é—´ä»¶ï¼Œå½“ä¸­é—´ä»¶æ‰§è¡Œå®Œï¼Œè°ƒç”¨next()çš„æ—¶å€™ï¼Œå…¶å®å°±æ˜¯å»æ‰§è¡Œä¸‹ä¸€ä¸ªä¸­é—´ä»¶ã€‚</p>
<pre><code>for (let i = len - 1; i &gt;= 0; i--) {
        let currentMiddleware = this.middlewares[i];
        next = createNext(currentMiddleware, next);
 }
</code></pre><p>ä¸Šé¢è¿™æ®µä»£ç å…¶å®å°±æ˜¯ä¸€ä¸ªé“¾å¼åå‘é€’å½’æ¨¡å‹çš„å®ç°ï¼Œiæ˜¯ä»æœ€å¤§æ•°å¼€å§‹å¾ªç¯çš„ï¼Œå°†ä¸­é—´ä»¶ä»æœ€åä¸€ä¸ªå¼€å§‹å°è£…ï¼Œæ¯ä¸€æ¬¡éƒ½æ˜¯å°†è‡ªå·±çš„æ‰§è¡Œå‡½æ•°å°è£…æˆnextå½“åšä¸Šä¸€ä¸ªä¸­é—´ä»¶çš„nextå‚æ•°ï¼Œè¿™æ ·å½“å¾ªç¯åˆ°ç¬¬ä¸€ä¸ªä¸­é—´ä»¶çš„æ—¶å€™ï¼Œåªéœ€è¦æ‰§è¡Œä¸€æ¬¡next()ï¼Œå°±èƒ½é“¾å¼çš„é€’å½’è°ƒç”¨æ‰€æœ‰ä¸­é—´ä»¶ï¼Œè¿™ä¸ªå°±æ˜¯koaå‰¥æ´‹è‘±çš„æ ¸å¿ƒä»£ç æœºåˆ¶ã€‚</p>
<p>åˆ°è¿™é‡Œæˆ‘ä»¬æ€»ç»“ä¸€ä¸‹ä¸Šé¢æ‰€æœ‰å‰¥æ´‹è‘±æ¨¡å‹ä»£ç çš„æµç¨‹ï¼Œé€šè¿‡useä¼ è¿›æ¥çš„ä¸­é—´ä»¶æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå›è°ƒå‡½æ•°çš„å‚æ•°æ˜¯ctxä¸Šä¸‹æ–‡å’Œnextï¼Œnextå…¶å®å°±æ˜¯æ§åˆ¶æƒçš„äº¤æ¥æ£’ï¼Œnextçš„ä½œç”¨æ˜¯åœæ­¢è¿è¡Œå½“å‰ä¸­é—´ä»¶ï¼Œå°†æ§åˆ¶æƒäº¤ç»™ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ï¼Œæ‰§è¡Œä¸‹ä¸€ä¸ªä¸­é—´ä»¶çš„next()ä¹‹å‰çš„ä»£ç ï¼Œå½“ä¸‹ä¸€ä¸ªä¸­é—´ä»¶è¿è¡Œçš„ä»£ç é‡åˆ°äº†next()ï¼Œåˆä¼šå°†ä»£ç æ‰§è¡Œæƒäº¤ç»™ä¸‹ä¸‹ä¸ªä¸­é—´ä»¶ï¼Œå½“æ‰§è¡Œåˆ°æœ€åä¸€ä¸ªä¸­é—´ä»¶çš„æ—¶å€™ï¼Œæ§åˆ¶æƒå‘ç”Ÿåè½¬ï¼Œå¼€å§‹å›å¤´å»æ‰§è¡Œä¹‹å‰æ‰€æœ‰ä¸­é—´ä»¶ä¸­å‰©ä¸‹æœªæ‰§è¡Œçš„ä»£ç ï¼Œè¿™æ•´ä¸ªæµç¨‹æœ‰ç‚¹åƒä¸€ä¸ªä¼ªé€’å½’ï¼Œå½“æœ€ç»ˆæ‰€æœ‰ä¸­é—´ä»¶å…¨éƒ¨æ‰§è¡Œå®Œåï¼Œä¼šè¿”å›ä¸€ä¸ªPromiseå¯¹è±¡ï¼Œå› ä¸ºæˆ‘ä»¬çš„composeå‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ªasyncçš„å‡½æ•°ï¼Œasyncå‡½æ•°æ‰§è¡Œå®Œåä¼šè¿”å›ä¸€ä¸ªPromiseï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½å°†æ‰€æœ‰çš„ä¸­é—´ä»¶å¼‚æ­¥æ‰§è¡ŒåŒæ­¥åŒ–ï¼Œé€šè¿‡thenå°±å¯ä»¥æ‰§è¡Œå“åº”å‡½æ•°å’Œé”™è¯¯å¤„ç†å‡½æ•°ã€‚</p>
<p>å½“ä¸­é—´ä»¶æœºåˆ¶ä»£ç å†™å¥½äº†ä»¥åï¼Œè¿è¡Œæˆ‘ä»¬çš„ä¸Šé¢çš„ä¾‹å­ï¼Œå·²ç»èƒ½è¾“å‡º123456äº†ï¼Œè‡³æ­¤ï¼Œæˆ‘ä»¬çš„koaçš„åŸºæœ¬æ¡†æ¶å·²ç»åŸºæœ¬åšå¥½äº†ï¼Œä¸è¿‡ä¸€ä¸ªæ¡†æ¶ä¸èƒ½åªå®ç°åŠŸèƒ½ï¼Œä¸ºäº†æ¡†æ¶å’ŒæœåŠ¡å™¨å®ä¾‹çš„å¥å£®ï¼Œè¿˜éœ€è¦åŠ ä¸Šé”™è¯¯å¤„ç†æœºåˆ¶ã€‚</p>
<h4 id="æ¨¡å—å››ï¼šé”™è¯¯æ•è·å’Œé”™è¯¯å¤„ç†"><a href="#æ¨¡å—å››ï¼šé”™è¯¯æ•è·å’Œé”™è¯¯å¤„ç†" class="headerlink" title="æ¨¡å—å››ï¼šé”™è¯¯æ•è·å’Œé”™è¯¯å¤„ç†"></a>æ¨¡å—å››ï¼šé”™è¯¯æ•è·å’Œé”™è¯¯å¤„ç†</h4><p>è¦å®ç°ä¸€ä¸ªåŸºç¡€æ¡†æ¶ï¼Œé”™è¯¯å¤„ç†å’Œæ•è·å¿…ä¸å¯å°‘ï¼Œä¸€ä¸ªå¥å£®çš„æ¡†æ¶ï¼Œå¿…é¡»ä¿è¯åœ¨å‘ç”Ÿé”™è¯¯çš„æ—¶å€™ï¼Œèƒ½å¤Ÿæ•è·åˆ°é”™è¯¯å’ŒæŠ›å‡ºçš„å¼‚å¸¸ï¼Œå¹¶åé¦ˆå‡ºæ¥ï¼Œå°†é”™è¯¯ä¿¡æ¯å‘é€åˆ°ç›‘æ§ç³»ç»Ÿä¸Šè¿›è¡Œåé¦ˆï¼Œç›®å‰æˆ‘ä»¬å®ç°çš„ç®€æ˜“koaæ¡†æ¶è¿˜æ²¡æœ‰èƒ½å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬æ¥ä¸‹åŠ ä¸Šé”™è¯¯å¤„ç†å’Œæ•è·çš„æœºåˆ¶ã€‚</p>
<pre><code>throw new Error(&apos;oooops&apos;);
</code></pre><p>åŸºäºç°åœ¨çš„æ¡†æ¶ï¼Œå¦‚æœä¸­é—´ä»¶ä»£ç ä¸­å‡ºç°å¦‚ä¸Šé”™è¯¯å¼‚å¸¸æŠ›å‡ºï¼Œæ˜¯æ•è·ä¸åˆ°é”™è¯¯çš„ï¼Œè¿™æ—¶å€™æˆ‘ä»¬çœ‹ä¸€ä¸‹application.jsä¸­çš„callbackå‡½æ•°çš„returnè¿”å›ä»£ç ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code>return fn(ctx).then(respond);
</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œfnæ˜¯ä¸­é—´ä»¶çš„æ‰§è¡Œå‡½æ•°ï¼Œæ¯ä¸€ä¸ªä¸­é—´ä»¶ä»£ç éƒ½æ˜¯ç”±asyncåŒ…è£¹ç€çš„ï¼Œè€Œä¸”ä¸­é—´ä»¶çš„æ‰§è¡Œå‡½æ•°composeè¿”å›çš„ä¹Ÿæ˜¯ä¸€ä¸ªasyncå‡½æ•°ï¼Œæˆ‘ä»¬æ ¹æ®es7çš„è§„èŒƒçŸ¥é“ï¼Œasyncè¿”å›çš„æ˜¯ä¸€ä¸ªpromiseçš„å¯¹è±¡å®ä¾‹ï¼Œæˆ‘ä»¬å¦‚æœæƒ³è¦æ•è·promiseçš„é”™è¯¯ï¼Œåªéœ€è¦ä½¿ç”¨promiseçš„catchæ–¹æ³•ï¼Œå°±å¯ä»¥æŠŠæ‰€æœ‰çš„ä¸­é—´ä»¶çš„å¼‚å¸¸å…¨éƒ¨æ•è·åˆ°ï¼Œä¿®æ”¹åcallbackçš„è¿”å›ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code>return fn(ctx).then(respond).catch(onerror);
</code></pre><p>ç°åœ¨æˆ‘ä»¬å·²ç»å®ç°äº†ä¸­é—´ä»¶çš„é”™è¯¯å¼‚å¸¸æ•è·ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜ç¼ºå°‘æ¡†æ¶å±‚å‘ç”Ÿé”™è¯¯çš„æ•è·æœºåˆ¶ï¼Œæˆ‘ä»¬å¸Œæœ›æˆ‘ä»¬çš„æœåŠ¡å™¨å®ä¾‹èƒ½æœ‰é”™è¯¯äº‹ä»¶çš„ç›‘å¬æœºåˆ¶ï¼Œé€šè¿‡onçš„ç›‘å¬å‡½æ•°å°±èƒ½è®¢é˜…å’Œç›‘å¬æ¡†æ¶å±‚é¢ä¸Šçš„é”™è¯¯ï¼Œå®ç°è¿™ä¸ªæœºåˆ¶ä¸éš¾ï¼Œä½¿ç”¨nodejsåŸç”Ÿeventsæ¨¡å—å³å¯ï¼Œeventsæ¨¡å—ç»™æˆ‘ä»¬æä¾›äº†äº‹ä»¶ç›‘å¬onå‡½æ•°å’Œäº‹ä»¶è§¦å‘emitè¡Œä¸ºå‡½æ•°ï¼Œä¸€ä¸ªå‘å°„äº‹ä»¶ï¼Œä¸€ä¸ªè´Ÿè´£æ¥æ”¶äº‹ä»¶ï¼Œæˆ‘ä»¬åªéœ€è¦å°†koaçš„æ„é€ å‡½æ•°ç»§æ‰¿eventsæ¨¡å—å³å¯ï¼Œæ„é€ åçš„ä¼ªä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code>let EventEmitter = require(&apos;events&apos;);
class Application extends EventEmitter{}
</code></pre><p>ç»§æ‰¿äº†eventsæ¨¡å—åï¼Œå½“æˆ‘ä»¬åˆ›å»ºkoaå®ä¾‹çš„æ—¶å€™ï¼ŒåŠ ä¸Šonç›‘å¬å‡½æ•°ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code>let app = new Koa();

app.on(&apos;error&apos;, err =&gt; {
    console.log(&apos;error happends: &apos;, err.stack);
});
</code></pre><p>è¿™æ ·æˆ‘ä»¬å°±å®ç°äº†æ¡†æ¶å±‚é¢ä¸Šçš„é”™è¯¯çš„æ•è·å’Œç›‘å¬æœºåˆ¶äº†ã€‚æ€»ç»“ä¸€ä¸‹ï¼Œé”™è¯¯å¤„ç†å’Œæ•è·ï¼Œåˆ†ä¸­é—´ä»¶çš„é”™è¯¯å¤„ç†æ•è·å’Œæ¡†æ¶å±‚çš„é”™è¯¯å¤„ç†æ•è·ï¼Œä¸­é—´ä»¶çš„é”™è¯¯å¤„ç†ç”¨promiseçš„catchï¼Œæ¡†æ¶å±‚é¢çš„é”™è¯¯å¤„ç†ç”¨nodejsçš„åŸç”Ÿæ¨¡å—eventsï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æŠŠä¸€ä¸ªæœåŠ¡å™¨å®ä¾‹ä¸Šçš„æ‰€æœ‰çš„é”™è¯¯å¼‚å¸¸å…¨éƒ¨æ•è·åˆ°äº†ã€‚è‡³æ­¤ï¼Œæˆ‘ä»¬å°±å®Œæ•´å®ç°äº†ä¸€ä¸ªè½»é‡ç‰ˆçš„koaæ¡†æ¶äº†ã€‚</p>
<h3 id="ç»“å°¾"><a href="#ç»“å°¾" class="headerlink" title="ç»“å°¾"></a>ç»“å°¾</h3><p>å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»å®ç°äº†ä¸€ä¸ªè½»é‡ç‰ˆçš„koaæ¡†æ¶äº†ï¼Œæˆ‘ä»¬å®ç°äº†å°è£…node http serverã€åˆ›å»ºKoaç±»æ„é€ å‡½æ•°ã€æ„é€ requestã€responseã€contextå¯¹è±¡ã€ä¸­é—´ä»¶æœºåˆ¶å’Œå‰¥æ´‹è‘±æ¨¡å‹çš„å®ç°ã€é”™è¯¯æ•è·å’Œé”™è¯¯å¤„ç†è¿™å››ä¸ªå¤§æ¨¡å—ï¼Œç†è§£äº†è¿™ä¸ªè½»é‡ç‰ˆkoaçš„å®ç°åŸç†ï¼Œå†å»çœ‹koa2çš„æºç ï¼Œä½ å°±ä¼šå‘ç°ä¸€åˆ‡éƒ½è±ç„¶å¼€æœ—ï¼Œkoa2çš„æºç æ— éå°±æ˜¯åœ¨è¿™ä¸ªè½»é‡ç‰ˆåŸºç¡€ä¸ŠåŠ äº†å¾ˆå¤šå·¥å…·å‡½æ•°å’Œç»†èŠ‚çš„å¤„ç†ï¼Œé™äºç¯‡å¹…ç¬”è€…å°±ä¸å†ä¸€ä¸€ä»‹ç»äº†ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/07/vue2ç»„ä»¶æ‡’åŠ è½½/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="èˆåŠ¨ä¹¾å¤">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/07/vue2ç»„ä»¶æ‡’åŠ è½½/" itemprop="url">vue2ç»„ä»¶æ‡’åŠ è½½</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-01-07T20:04:56+08:00">
                2018-01-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="ä»€ä¹ˆæ˜¯æ‡’åŠ è½½"><a href="#ä»€ä¹ˆæ˜¯æ‡’åŠ è½½" class="headerlink" title="ä»€ä¹ˆæ˜¯æ‡’åŠ è½½"></a>ä»€ä¹ˆæ˜¯æ‡’åŠ è½½</h3><p>æ‡’åŠ è½½ä¹Ÿå«å»¶è¿ŸåŠ è½½ï¼Œå³åœ¨éœ€è¦çš„æ—¶å€™è¿›è¡ŒåŠ è½½ï¼Œéšç”¨éšè½½ã€‚</p>
<h3 id="ä¸ºä»€ä¹ˆéœ€è¦æ‡’åŠ è½½"><a href="#ä¸ºä»€ä¹ˆéœ€è¦æ‡’åŠ è½½" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦æ‡’åŠ è½½"></a>ä¸ºä»€ä¹ˆéœ€è¦æ‡’åŠ è½½</h3><p>åœ¨å•é¡µåº”ç”¨ä¸­ï¼Œå¦‚æœæ²¡æœ‰åº”ç”¨æ‡’åŠ è½½ï¼Œè¿ç”¨webpackæ‰“åŒ…åçš„æ–‡ä»¶å°†ä¼šå¼‚å¸¸çš„å¤§ï¼Œé€ æˆè¿›å…¥é¦–é¡µæ—¶ï¼Œéœ€è¦åŠ è½½çš„å†…å®¹è¿‡å¤šï¼Œå»¶æ—¶è¿‡é•¿ï¼Œä¸åˆ©äºç”¨æˆ·ä½“éªŒï¼Œè€Œè¿ç”¨æ‡’åŠ è½½åˆ™å¯ä»¥å°†é¡µé¢è¿›è¡Œåˆ’åˆ†ï¼Œéœ€è¦çš„æ—¶å€™åŠ è½½é¡µé¢ï¼Œå¯ä»¥æœ‰æ•ˆçš„åˆ†æ‹…é¦–é¡µæ‰€æ‰¿æ‹…çš„åŠ è½½å‹åŠ›ï¼Œå‡å°‘é¦–é¡µåŠ è½½ç”¨æ—¶</p>
<h3 id="å¦‚ä½•ä¸webpacké…åˆå®ç°ç»„ä»¶æ‡’åŠ è½½"><a href="#å¦‚ä½•ä¸webpacké…åˆå®ç°ç»„ä»¶æ‡’åŠ è½½" class="headerlink" title="å¦‚ä½•ä¸webpacké…åˆå®ç°ç»„ä»¶æ‡’åŠ è½½"></a>å¦‚ä½•ä¸webpacké…åˆå®ç°ç»„ä»¶æ‡’åŠ è½½</h3><p>ã€€ã€€1ã€åœ¨webpacké…ç½®æ–‡ä»¶ä¸­çš„outputè·¯å¾„é…ç½®chunkFilenameå±æ€§<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">output: &#123;</span><br><span class="line">        path: resolve(__dirname, &apos;dist&apos;),</span><br><span class="line">        filename: options.dev ? &apos;[name].js&apos; : &apos;[name].js?[chunkhash]&apos;,</span><br><span class="line">        chunkFilename: &apos;chunk[id].js?[chunkhash]&apos;,</span><br><span class="line">        publicPath: options.dev ? &apos;/assets/&apos; : publicPath</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure></p>
<p>chunkFilenameè·¯å¾„å°†ä¼šä½œä¸ºç»„ä»¶æ‡’åŠ è½½çš„è·¯å¾„</p>
<p>2ã€é…åˆwebpackæ”¯æŒçš„å¼‚æ­¥åŠ è½½æ–¹æ³•</p>
<ul>
<li>resolve =&gt; require([URL], resolve), æ”¯æŒæ€§å¥½</li>
<li>() =&gt; system.import(URL) , webpack2å®˜ç½‘ä¸Šå·²ç»å£°æ˜å°†é€æ¸åºŸé™¤, ä¸æ¨èä½¿ç”¨</li>
<li>() =&gt; import(URL), webpack2å®˜ç½‘æ¨èä½¿ç”¨, å±äºes7èŒƒç•´, éœ€è¦é…åˆbabelçš„syntax-dynamic-importæ’ä»¶ä½¿ç”¨, å…·ä½“ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev babel-core babel-loader babel-plugin-syntax-dynamic-import babel-preset-es2015</span><br><span class="line"></span><br><span class="line">use: [&#123;</span><br><span class="line">        loader: &apos;babel-loader&apos;,</span><br><span class="line">        options: &#123;</span><br><span class="line">          presets: [[&apos;es2015&apos;, &#123;modules: false&#125;]],</span><br><span class="line">          plugins: [&apos;syntax-dynamic-import&apos;]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;]</span><br></pre></td></tr></table></figure>
<h3 id="å…·ä½“å®ä¾‹ä¸­å®ç°æ‡’åŠ è½½"><a href="#å…·ä½“å®ä¾‹ä¸­å®ç°æ‡’åŠ è½½" class="headerlink" title="å…·ä½“å®ä¾‹ä¸­å®ç°æ‡’åŠ è½½"></a>å…·ä½“å®ä¾‹ä¸­å®ç°æ‡’åŠ è½½</h3><h4 id="è·¯ç”±ä¸­é…ç½®å¼‚æ­¥ç»„ä»¶"><a href="#è·¯ç”±ä¸­é…ç½®å¼‚æ­¥ç»„ä»¶" class="headerlink" title="è·¯ç”±ä¸­é…ç½®å¼‚æ­¥ç»„ä»¶"></a>è·¯ç”±ä¸­é…ç½®å¼‚æ­¥ç»„ä»¶</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">export default new Router(&#123;</span><br><span class="line">    routes: [</span><br><span class="line">        &#123;</span><br><span class="line">            mode: &apos;history&apos;,</span><br><span class="line">            path: &apos;/my&apos;,</span><br><span class="line">            name: &apos;my&apos;,</span><br><span class="line">            component:  resolve =&gt; require([&apos;../page/my/my.vue&apos;], resolve),//æ‡’åŠ è½½</span><br><span class="line">        &#125;,</span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="å®ä¾‹ä¸­é…ç½®å¼‚æ­¥ç»„ä»¶"><a href="#å®ä¾‹ä¸­é…ç½®å¼‚æ­¥ç»„ä»¶" class="headerlink" title="å®ä¾‹ä¸­é…ç½®å¼‚æ­¥ç»„ä»¶"></a>å®ä¾‹ä¸­é…ç½®å¼‚æ­¥ç»„ä»¶</h4><blockquote>
<p>æ¨è<code>historyTab: () =&gt; import(&#39;../../component/historyTab/historyTab.vue&#39;)</code></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">components: &#123;</span><br><span class="line">        historyTab: resolve =&gt; &#123;require([&apos;../../component/historyTab/historyTab.vue&apos;], resolve)&#125;,//æ‡’åŠ è½½</span><br><span class="line">        //historyTab: () =&gt; import(&apos;../../component/historyTab/historyTab.vue&apos;)</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>
<h4 id="å…¨å±€æ³¨å†Œå¼‚æ­¥ç»„ä»¶"><a href="#å…¨å±€æ³¨å†Œå¼‚æ­¥ç»„ä»¶" class="headerlink" title="å…¨å±€æ³¨å†Œå¼‚æ­¥ç»„ä»¶"></a>å…¨å±€æ³¨å†Œå¼‚æ­¥ç»„ä»¶</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Vue.component(&apos;mideaHeader&apos;, () =&gt; &#123;</span><br><span class="line">    System.import(&apos;./component/header/header.vue&apos;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/02/å…³äºViewportä¸device-widthçš„ä¸€ç‚¹ç†è§£/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="èˆåŠ¨ä¹¾å¤">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/02/å…³äºViewportä¸device-widthçš„ä¸€ç‚¹ç†è§£/" itemprop="url">å…³äºViewportä¸device-widthçš„ä¸€ç‚¹ç†è§£</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-01-02T16:55:37+08:00">
                2018-01-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="å†è¿›è¡Œç§»åŠ¨webå¼€å‘çš„æ—¶å€™éƒ½è¦åŠ ä¸€å¥ï¼š"><a href="#å†è¿›è¡Œç§»åŠ¨webå¼€å‘çš„æ—¶å€™éƒ½è¦åŠ ä¸€å¥ï¼š" class="headerlink" title="å†è¿›è¡Œç§»åŠ¨webå¼€å‘çš„æ—¶å€™éƒ½è¦åŠ ä¸€å¥ï¼š"></a>å†è¿›è¡Œç§»åŠ¨webå¼€å‘çš„æ—¶å€™éƒ½è¦åŠ ä¸€å¥ï¼š</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no&quot; /&gt;</span><br></pre></td></tr></table></figure>
<ol>
<li>æˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">é‡Œçš„viewportç©¶ç«Ÿæ˜¯ä»€ä¹ˆæ„æ€ï¼Œè¿™é‡Œçš„device-widthè·Ÿæˆ‘ä»¬ç”¨JSè·å–åˆ°çš„å±å®½çš„åŒºåˆ«ä¸è”ç³»åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆå»æ‰<meta>æ ‡ç­¾åé¡µé¢ä¼šå˜å¾—å¾ˆå°å¾ˆå°ï¼Ÿ</li>
<li>ä¸ºä»€ä¹ˆå¾ˆå¤šåˆ†è¾¨ç‡å¾ˆå¤§çš„å±å¹•å®½åº¦å…¶å®å¹¶ä¸å¤§ï¼Œå±å¹•åˆ†è¾¨ç‡ä¸ç”¨JSè·å–åˆ°çš„å±å®½çš„åŒºåˆ«ä¸è”ç³»åˆ†åˆ«åˆæ˜¯ä»€ä¹ˆï¼Ÿ</li>
</ol>
<h3 id="è§†å£-viewport"><a href="#è§†å£-viewport" class="headerlink" title="è§†å£ viewport"></a>è§†å£ viewport</h3><h4 id="viewport-åŸºç¡€"><a href="#viewport-åŸºç¡€" class="headerlink" title="viewport åŸºç¡€"></a>viewport åŸºç¡€</h4><p>viewport è§£é‡Šä¸ºä¸­æ–‡å°±æ˜¯â€˜è§†å£â€™çš„æ„æ€ï¼Œä¹Ÿå°±æ˜¯æµè§ˆå™¨ä¸­ç”¨äºæ˜¾ç¤ºç½‘é¡µçš„åŒºåŸŸã€‚åœ¨ PC ç«¯ï¼Œå…¶å¤§å°ä¹Ÿå°±æ˜¯æµè§ˆå™¨å¯è§†åŒºåŸŸçš„å¤§å°ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿä¸ä¼šå¤ªå…³æ³¨æ­¤æ¦‚å¿µï¼›è€Œåœ¨ç§»åŠ¨ç«¯ï¼Œç»å¤§å¤šæ•°æƒ…å†µä¸‹ viewport éƒ½å¤§äºæµè§ˆå™¨å¯è§†åŒºï¼Œä¿è¯ PC é¡µé¢åœ¨ç§»åŠ¨æµè§ˆå™¨ä¸Šé¢çš„å¯è§†æ€§ã€‚ä¸ºæå‡å¯è§†æ€§ä½“éªŒï¼Œé’ˆå¯¹ç§»åŠ¨ç«¯æœ‰äº†å¯¹ viewport çš„æ·±å…¥ç ”ç©¶ã€‚</p>
<h4 id="viewport-è¯¦è§£"><a href="#viewport-è¯¦è§£" class="headerlink" title="viewport è¯¦è§£"></a>viewport è¯¦è§£</h4><p>åœ¨ç§»åŠ¨ç«¯æœ‰ä¸‰ç§ç±»å‹çš„ viewport: layoutviewportã€visualviewportã€idealviewportã€‚å…·ä½“è§£é‡Šå¦‚ä¸‹ï¼š</p>
<ul>
<li>layoutviewport:  å¤§äºå®é™…å±å¹•ï¼Œ å…ƒç´ çš„å®½åº¦ç»§æ‰¿äº layoutviewportï¼Œç”¨äºä¿è¯ç½‘ç«™çš„å¤–è§‚ç‰¹æ€§ä¸æ¡Œé¢æµè§ˆå™¨ä¸€æ ·ã€‚layoutviewport åˆ°åº•å¤šå®½ï¼Œæ¯ä¸ªæµè§ˆå™¨ä¸åŒã€‚iPhone çš„ safari ä¸º 980pxï¼Œé€šè¿‡ document.document.clientWidth è·å–ã€‚</li>
<li>visualviewport: å½“å‰æ˜¾ç¤ºåœ¨å±å¹•ä¸Šçš„é¡µé¢ï¼Œå³æµè§ˆå™¨å¯è§†åŒºåŸŸçš„å®½åº¦ã€‚</li>
<li>idealviewport: ä¸ºæµè§ˆå™¨å®šä¹‰çš„å¯å®Œç¾é€‚é…ç§»åŠ¨ç«¯çš„ç†æƒ³ viewportï¼Œå›ºå®šä¸å˜ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯è®¾å¤‡è§†å£å®½åº¦ã€‚æ¯”å¦‚ iphone 7 ä¸º 375px, iphone 7p ä¸º 414pxã€‚</li>
</ul>
<h4 id="viewport-è®¾ç½®"><a href="#viewport-è®¾ç½®" class="headerlink" title="viewport è®¾ç½®"></a>viewport è®¾ç½®</h4><p>æˆ‘ä»¬é€šè¿‡å¯¹å‡ ç§ viewport è®¾ç½®å¯ä»¥å¯¹ç½‘é¡µçš„å±•ç¤ºè¿›è¡Œæœ‰æ•ˆçš„æ§åˆ¶ï¼Œåœ¨ç§»åŠ¨ç«¯æˆ‘ä»¬ç»å¸¸ä¼šåœ¨ head æ ‡ç­¾ä¸­çœ‹åˆ°è¿™æ®µä»£ç ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta name=&apos;viewport&apos; content=&apos;width=device-width,initial-scale=1,user-scale=no&apos; /&gt;</span><br></pre></td></tr></table></figure></p>
<p><img src="/2018/01/02/å…³äºViewportä¸device-widthçš„ä¸€ç‚¹ç†è§£/1.webp" alt=""></p>
<h4 id="1pxçš„ç‰©ç†åƒç´ çš„è§£å†³æ–¹æ¡ˆ"><a href="#1pxçš„ç‰©ç†åƒç´ çš„è§£å†³æ–¹æ¡ˆ" class="headerlink" title="1pxçš„ç‰©ç†åƒç´ çš„è§£å†³æ–¹æ¡ˆ"></a>1pxçš„ç‰©ç†åƒç´ çš„è§£å†³æ–¹æ¡ˆ</h4><p>ä»ç¬¬ä¸€éƒ¨åˆ†çš„è®¨è®ºå¯çŸ¥ viewport çš„ initial-scale å…·æœ‰ç¼©æ”¾é¡µé¢çš„æ•ˆæœã€‚å¯¹äº dpr=2 çš„å±å¹•ï¼Œ1pxå‹ç¼©ä¸€åŠä¾¿å¯ä¸1pxçš„è®¾å¤‡åƒç´ æ¯”åŒ¹é…ï¼Œè¿™å°±å¯ä»¥é€šè¿‡å°†ç¼©æ”¾æ¯” initial-scale è®¾ç½®ä¸º 0.5=1/2 è€Œå®ç°ã€‚ä»¥æ­¤ç±»æ¨ dpr=3çš„å±å¹•å¯ä»¥å°† initial-scaleè®¾ç½®ä¸º 0.33=1/3 æ¥å®ç°ã€‚</p>
<pre><code>(function (baseFontSize) {
    const _baseFontSize = baseFontSize || 75;
    const ua = navigator.userAgent;
    const matches = ua.match(/Android[\S\s]+AppleWebkit\/(\d{3})/i);
    const isIos = navigator.appVersion.match(/(iphone|ipad|ipod)/gi);
    const dpr = window.devicePixelRatio || 1;
    if (!isIos &amp;&amp; !(matches &amp;&amp; matches[1] &gt; 534)) {
        // å¦‚æœéiOS, éAndroid4.3ä»¥ä¸Š, dprè®¾ä¸º1;
        dpr = 1;
    }
    const scale = 1 / dpr;
    const metaEl = document.querySelector(&apos;meta[name=&quot;viewport&quot;]&apos;);
    if (!metaEl) {
        metaEl = document.createElement(&apos;meta&apos;);
        metaEl.setAttribute(&apos;name&apos;, &apos;viewport&apos;);
        window.document.head.appendChild(metaEl);
    }
    metaEl.setAttribute(&apos;content&apos;, &apos;width=device-width,user-scalable=no,initial-scale=&apos; + scale + &apos;,maximum-scale=&apos; + scale + &apos;,minimum-scale=&apos; + scale);

    document.documentElement.style.fontSize = document.documentElement.clientWidth / (750 / _baseFontSize) + &apos;px&apos;;
})();

</code></pre><hr>
<p>è¦è¯´è¿™ä¸ªï¼Œå…ˆæ¥äº†è§£ä¸‹ä¸€äº›ç§»åŠ¨ç«¯åŸºç¡€çŸ¥è¯†ï¼š</p>
<h3 id="1ã€ç‰©ç†åƒç´ -è®¾å¤‡åƒç´ ï¼Œåˆ†è¾¨ç‡"><a href="#1ã€ç‰©ç†åƒç´ -è®¾å¤‡åƒç´ ï¼Œåˆ†è¾¨ç‡" class="headerlink" title="1ã€ç‰©ç†åƒç´ (è®¾å¤‡åƒç´ ï¼Œåˆ†è¾¨ç‡)"></a>1ã€ç‰©ç†åƒç´ (è®¾å¤‡åƒç´ ï¼Œåˆ†è¾¨ç‡)</h3><p>è®¾å¤‡åƒç´ ï¼Œåœ¨åŒä¸€ä¸ªè®¾å¤‡ä¸Šï¼Œå®ƒçš„ç‰©ç†åƒç´ æ˜¯å›ºå®šçš„ï¼Œè¿™æ˜¯å‚å•†åœ¨å‡ºå‚æ—¶å°±è®¾ç½®å¥½äº†çš„ï¼Œå³ä¸€ä¸ªè®¾å¤‡çš„åˆ†è¾¨ç‡æ˜¯å›ºå®šçš„ã€‚</p>
<h3 id="2ã€é€»è¾‘åƒç´ -CSSåƒç´ "><a href="#2ã€é€»è¾‘åƒç´ -CSSåƒç´ " class="headerlink" title="2ã€é€»è¾‘åƒç´ (CSSåƒç´ )"></a>2ã€é€»è¾‘åƒç´ (CSSåƒç´ )</h3><p>CSSåƒç´ ï¼Œviewportä¸­çš„ä¸€ä¸ªå°æ–¹æ ¼ï¼ŒCSSæ ·å¼ä»£ç ä¸­ä½¿ç”¨çš„æ˜¯é€»è¾‘åƒç´ ã€‚å¦‚æœåœ¨ä¸€ä¸ªè®¾å¤‡ä¸­ï¼Œç‰©ç†åƒç´ ä¸é€»è¾‘åƒç´ ç›¸ç­‰ï¼Œå°†ä¸ä¼šäº§ç”Ÿä»»ä½•é—®é¢˜ã€‚ä½†æ˜¯ï¼Œåœ¨iphone 4ä¸­ï¼Œç‰©ç†åƒç´ æ˜¯640px<em>960pxï¼Œè€Œé€»è¾‘åƒç´ æ•°ä¸º320</em>480pxã€‚å› æ­¤ï¼Œéœ€è¦ä½¿ç”¨å¤§çº¦4ä¸ªç‰©ç†åƒç´ æ¥æ˜¾ç¤ºä¸€ä¸ªCSSåƒç´ ã€‚</p>
<h3 id="3ã€åƒç´ æ¯”"><a href="#3ã€åƒç´ æ¯”" class="headerlink" title="3ã€åƒç´ æ¯”"></a>3ã€åƒç´ æ¯”</h3><p>ç‰©ç†åƒç´ ä¸é€»è¾‘åƒç´ ä¹‹é—´çš„æ¯”ä¾‹ã€‚å½“åƒç´ æ¯”ä¸º1:1æ—¶ï¼Œä½¿ç”¨1ä¸ªç‰©ç†åƒç´ æ˜¾ç¤º1ä¸ªé€»è¾‘åƒç´ ï¼›å½“åƒç´ æ¯”ä¸º2:1æ—¶ï¼Œä½¿ç”¨4ä¸ªç‰©ç†åƒç´ æ˜¾ç¤º1ä¸ªé€»è¾‘åƒç´ ã€‚</p>
<h3 id="4ã€CSSä¸­çš„1pxå¹¶ä¸ç­‰äºè®¾å¤‡çš„1px"><a href="#4ã€CSSä¸­çš„1pxå¹¶ä¸ç­‰äºè®¾å¤‡çš„1px" class="headerlink" title="4ã€CSSä¸­çš„1pxå¹¶ä¸ç­‰äºè®¾å¤‡çš„1px"></a>4ã€CSSä¸­çš„1pxå¹¶ä¸ç­‰äºè®¾å¤‡çš„1px</h3><p>åœ¨CSSä¸­ä¸€èˆ¬ä½¿ç”¨pxä½œä¸ºå•ä½ï¼Œåœ¨Webæµè§ˆå™¨ä¸­CSSçš„1ä¸ªåƒç´ å¾€å¾€éƒ½æ˜¯å¯¹åº”ç€ç”µè„‘å±å¹•çš„1ä¸ªç‰©ç†åƒç´ ï¼Œè¿™å¯èƒ½ä¼šé€ æˆä¸€ä¸ªé”™è§‰ï¼Œé‚£å°±æ˜¯CSSä¸­çš„åƒç´ å°±æ˜¯è®¾å¤‡çš„ç‰©ç†åƒç´ ã€‚ä½†å®é™…æƒ…å†µå´å¹¶éå¦‚æ­¤ï¼ŒCSSä¸­çš„åƒç´ åªæ˜¯ä¸€ä¸ªæŠ½è±¡çš„å•ä½ï¼Œåœ¨ä¸åŒçš„è®¾å¤‡æˆ–ä¸åŒçš„ç¯å¢ƒä¸­ï¼ŒCSSä¸­çš„1pxæ‰€ä»£è¡¨çš„è®¾å¤‡ç‰©ç†åƒç´ æ˜¯ä¸åŒçš„ã€‚<br>åœ¨æ—©å…ˆçš„ç§»åŠ¨è®¾å¤‡ä¸­ï¼Œå±å¹•åƒç´ å¯†åº¦éƒ½æ¯”è¾ƒä½ï¼Œå¦‚iphone3ï¼Œå®ƒçš„åˆ†è¾¨ç‡ä¸º320<em>480ï¼Œåœ¨iphone3ä¸Šï¼Œ1ä¸ªCSSåƒç´ ç¡®å®æ˜¯ç­‰äº1ä¸ªç‰©ç†åƒç´ çš„ã€‚åæ¥éšç€æŠ€æœ¯çš„å‘å±•ï¼Œç§»åŠ¨è®¾å¤‡çš„åƒç´ è¶Šæ¥è¶Šé«˜ï¼Œä»iphone4å¼€å§‹ï¼Œæ¨å‡ºäº†æ‰€è°“çš„Retinaå±ï¼Œåˆ†è¾¨ç‡æé«˜äº†ä¸€å€ï¼Œå˜æˆ640</em>960ï¼Œä½†å±å¹•å°ºå¯¸å´æ²¡å˜åŒ–ï¼Œè¿™å°±æ„å‘³ç€åŒæ ·å¤§å°çš„å±å¹•ä¸Šï¼Œåƒç´ å´å¤šäº†ä¸€å€ï¼Œè¿™æ—¶ï¼Œ1ä¸ªCSSåƒç´ æ˜¯ç­‰äº4ä¸ªç‰©ç†åƒç´ çš„ã€‚</p>
<h3 id="5ã€å®ç°çœŸæ­£çš„1ç‰©ç†åƒç´ "><a href="#5ã€å®ç°çœŸæ­£çš„1ç‰©ç†åƒç´ " class="headerlink" title="5ã€å®ç°çœŸæ­£çš„1ç‰©ç†åƒç´ "></a>5ã€å®ç°çœŸæ­£çš„1ç‰©ç†åƒç´ </h3><p>å½“viewportçš„å±æ€§initial-scaleä¸º1æ—¶ï¼Œé¡µé¢å¤§å°æ­£å¸¸ï¼Œä½†initial-scaleä¸º0.5æ—¶ï¼Œé¡µé¢è¢«ç¼©å°äº†1å€ï¼Œåƒç´ æ¯”ä¸º2:1çš„è®¾å¤‡æœ¬æ¥1ä¸ªCSSåƒç´ å®½åº¦å 2ä¸ªç‰©ç†åƒç´ å®½åº¦ï¼Œç¼©å°åçš„1ä¸ªCSSåƒç´ å®½åº¦å°±åªå 1ä¸ªç‰©ç†åƒç´ ï¼Œå³å®ç°äº†çœŸæ­£çš„1ç‰©ç†åƒç´ ã€‚<br><code>egï¼šborder-width:1px</code>å¹¶ä¸æ˜¯æœ€å°è¾¹æ¡†ï¼Œæµè§ˆå™¨å¯ä»¥æ˜¾ç¤ºçš„æœ€å°ç²’åº¦æ¯”1pxè¿˜è¦å°ã€‚ä¸ºä»€ä¹ˆä¼šå‡ºç°æ¯”border-width:1pxæ›´ç»†çš„è¾¹æ¡†ï¼Ÿ<br>å±å¹•èƒ½å¤Ÿæ˜¾ç¤ºçš„æœ€å°ç²’åº¦æ˜¯1ä¸ªç‰©ç†åƒç´ ï¼ŒiPhone4çš„åƒç´ æ¯”ä¸º2ï¼Œè®¾ç½®border-width:1pxåï¼Œè¾¹æ¡†å äº†4ä¸ªç‰©ç†åƒç´ ï¼Œå¦‚æœèƒ½è®©è¾¹æ¡†çš„å®½åº¦ä¸º1ç‰©ç†åƒç´ ï¼Œé‚£ä¹ˆå®ƒå°±æ¯”1ä¸ªCSSåƒç´ è¦ç»†ï¼Œè¿™å¯ä»¥é€šè¿‡è®¾ç½®<code>&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=0.5&quot;&gt;</code>ã€‚</p>
<h2 id="CSS-pixelä¸device-pixels-css-pxä¸device-px"><a href="#CSS-pixelä¸device-pixels-css-pxä¸device-px" class="headerlink" title="CSS pixelä¸device pixels (css pxä¸device px)"></a>CSS pixelä¸device pixels (css pxä¸device px)</h2><p>é¦–å…ˆäº†è§£ä¸‹ä»€ä¹ˆæ˜¯CSS pixelsï¼Œä»€ä¹ˆæ˜¯device pixelsï¼›</p>
<p>1ï¼CSS pixelså¯ä»¥ç†è§£ä¸º<code>cssåƒç´ </code>ï¼Œæ˜¯æµè§ˆå™¨ä½¿ç”¨çš„æŠ½è±¡å•ä½ï¼Œä¸»è¦ç”¨æ¥åœ¨ç½‘é¡µä¸Šç»˜åˆ¶å†…å®¹ã€‚ä¹Ÿå¯ä»¥è¯´css pxæ˜¯ä¸“é—¨ä¸ºwebå¼€å‘è€…æå‡ºçš„ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µï¼Œä¹Ÿåªè·Ÿæˆ‘ä»¬å¹³æ—¶å†™çš„cssæ ·å¼æœ‰å…³ï¼Œä¸åˆ†è¾¨ç‡ï¼ˆæ¯”å¦‚720px*1280pxï¼‰é‡Œçš„pxæ²¡å…³ç³»ã€‚</p>
<p>2ï¼ device pixelså¯ä»¥ç†è§£ä¸ºæ˜¯è®¾å¤‡åƒç´ ï¼Œå®˜æ–¹çš„è§£é‡Šæ˜¯ï¼šæ˜¾ç¤ºå±å¹•çš„æœ€å°ç‰©ç†å•ä½ï¼Œæ¯ä¸ªdpåŒ…å«è‡ªå·±çš„é¢œè‰²ã€é«˜å®½ç­‰ã€‚</p>
<p>å¯¹äºæˆ‘ä»¬åšwebå¼€å‘çš„äººæ¥è¯´ï¼Œæˆ‘ä»¬ç”¨åˆ°çš„æœ€å¤šçš„åœ°æ–¹æ˜¯â€œcssåƒç´ â€ï¼Œå³ç±»ä¼¼width:300px;font-size:14px;è¿™ç±»çš„cssè¯­å¥é‡Œç”¨åˆ°çš„ã€‚å®ƒè·Ÿè®¾å¤‡è‡ªèº«çš„pxæ˜¯æ²¡å…³ç³»çš„ã€‚ä¹Ÿå°±æ˜¯è¯´1ä¸ªCSS åƒç´ å å¤šå°‘ä¸ªç‰©ç†åƒç´ æ˜¯ä¸ç¡®å®šçš„ï¼Œè¿™ä¸ªé—®é¢˜é€šè¿‡é¡µé¢çš„æ”¾ç¼©æ¯”è¾ƒå®¹æ˜“ç†è§£ã€‚æ¯”å¦‚ä¸€ä¸ªæ™®é€šçš„htmlé¡µé¢ä¸Šï¼Œæœ‰ä¸€ä¸ª300pxçš„å…ƒç´ ï¼›å¦‚æœæˆ‘ä»¬æ”¾å¤§é¡µé¢ï¼Œå…ƒç´ ä¼šå æ®æ›´å¤šçš„è®¾å¤‡åƒç´ ï¼ˆå³device pixelsï¼‰ï¼Œä½†å®ƒçš„CSS pixelsä¸å˜ï¼Œä¾ç„¶æ˜¯300pxï¼›ç¼©å°é¡µé¢ä¹Ÿæ˜¯åŒæ ·çš„é“ç†ï¼Œå æ®äº†æ›´å°‘çš„device pixelsï¼Œä½†å®ƒçš„CSS pixelsä¸å˜ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå…ƒç´ å æ®äº†å¤šå°‘device pixelsï¼Œæ˜¯ç”±å½“å‰é¡µé¢çš„æ”¾ç¼©æ¯”ä¾‹è€Œå®šçš„ã€‚</p>
<p>ä¸è¿‡ï¼Œé¡µé¢çš„ç¼©æ”¾å¯¹æˆ‘ä»¬webå¼€å‘æ¥è¯´æ˜¯å¥½åƒæ²¡æœ‰ä»»ä½•æ„ä¹‰çš„ã€‚ä½†æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¼€å‘å‡ºæ¥çš„é¡µé¢æ˜¯æƒ³è¦åœ¨å„ä¸ªå±å¹•ä¸ªä»¥æœ€ä½³çš„æ ·å¼å±•ç¤ºå‡ºæ¥çš„ï¼Œæˆ‘ä»¬ä¸èƒ½è®©é¡µé¢é‡Œå­˜åœ¨ä¸èƒ½æ§åˆ¶çš„å…ƒç´ ã€‚æ‰€ä»¥å°±å‡ºç°äº†å®ƒï¼š<code>&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0&quot; /&gt;</code> ä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨è¿›è¡Œwebå¼€å‘çš„æ—¶å€™ç»å¸¸ç”¨åˆ°çš„viewportã€‚é‚£ä¹ˆviewportåˆ°åº•æ˜¯ä¸ªä»€ä¹ˆç©æ„å„¿å‘¢ï¼Œè€Œä¸”contenté‡Œé¢widthä¸ºä»€ä¹ˆè¦ç­‰äºdevice-widthå‘¢ï¼Œdevice-widthåˆæ˜¯ä¸ªä»€ä¹ˆæ¦‚å¿µå‘¢ï¼Ÿä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒä»¬å“¥ä¿©å„¿æ˜¯ä»€ä¹ˆã€‚</p>
<h2 id="Viewport-ä¸-device-width"><a href="#Viewport-ä¸-device-width" class="headerlink" title="Viewport ä¸ device-width"></a>Viewport ä¸ device-width</h2><p>åœ¨è§£é‡Šè¿™ä¸¤ä¸ªæ¦‚å¿µä¹‹å‰ï¼Œå…ˆè¯´ä¸€ä¸ªå¤§å®¶éƒ½çŸ¥é“ï¼Œä½†ä¸æ˜ç™½ä¸ºä»€ä¹ˆçš„æƒ…å†µï¼šæŠŠä¸€ä¸ªæ™®é€šçš„åœ¨PCä¸Šå¼€å‘çš„HTMLé¡µé¢ç›´æ¥æ”¾æ‰‹æœºä¸Šï¼Œä½ ä¼šå‘ç°ä¸ç®¡å¤šå¤§çš„é¡µé¢éƒ½å¯ä»¥åœ¨å°å°çš„æ‰‹æœºå±å¹•ä¸Šæ˜¾ç¤ºï¼Œä½†æ˜¯å›¾æ–‡éƒ½ä¼šæ˜¾ç¤ºçš„ç‰¹åˆ«å°ï¼›å¦‚æœä½ ç”¨jsè·å–ä¸‹é¡µé¢å®½åº¦ï¼Œä½ ä¼šå‘ç°ï¼Œå¤§å¤šæ•°çš„é¡µé¢å®½åº¦éƒ½æ˜¯980pxçš„ï¼Œè¿™ä¸ªå°±è·Ÿviewportæœ‰å…³ã€‚</p>
<p>Viewportèµ·æºäºè‹¹æœï¼Œä½†ç°åœ¨å·²ç»è¢«å¤§å¤šæ•°æµè§ˆå™¨æ”¯æŒã€‚å…³äºviewportæœ‰ä¸¤ä¸ªæ¦‚å¿µvisual viewportè·Ÿlayout viewportã€‚è¿™é‡Œvisual viewportä¹Ÿå°±æ˜¯è§†è§‰ä¸Šçš„çª—å£ï¼Œå¯ä»¥ç†è§£ä¸ºè®¾å¤‡è‡ªå·±çš„å®½åº¦ã€‚è¿™æ—¶ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ªé•¿960çš„é¡µé¢ï¼Œæœ‰ä¸€ä¸ªå…ƒç´ æ˜¯20%ï¼ˆå®é™…è§£æå‡ºæ¥å°±æ˜¯192pxï¼‰ã€‚ä½†å¦‚æœæˆ‘ç”¨å®½ä¸º320pxçš„å±å¹•æ‰“å¼€å‘¢ï¼Œè¿™ä¸ªå…ƒç´ å°±æˆäº†64pxï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™æˆ‘è®¾ç½®çš„å­—ä½“å¤§å°æ˜¯12pxï¼Œåœ¨320pxçš„å±å¹•ä¸Šå°±åªèƒ½æ˜¾ç¤º64/12ä¸ªå­—äº†ï½</p>
<p>é‰´äºè¿™ä¸ªé—®é¢˜ï¼Œè‹¹æœæ‰¾åˆ°ä¸€ç§è§£å†³æ–¹æ³•ï¼Œåœ¨ç§»åŠ¨ç‰ˆçš„safariä¸­å®šä¹‰äº†viewport metaæ ‡ç­¾ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿçš„çª—å£ï¼ˆviewportï¼‰ï¼Œè¿™ä¸ªè™šæ‹Ÿçš„çª—å£å°±æ˜¯layout viewportåˆ†è¾¨ç‡æ¥è¿‘æ¡Œé¢æ˜¾ç¤ºå™¨ï¼Œappleå°†å…¶å®šä½ä¸º980pxã€‚åœ¨æ‰‹æœºä¸Šï¼Œå¯ä»¥é€šè¿‡document.documentElement.clientWidthæ¥è·å–ã€‚</p>
<p>å…¶ä»–æµè§ˆå™¨å‚å•†ä¹Ÿæœ‰ä¸åŒçš„è§£å†³åŠæ³•ï¼Œä¾‹å¦‚UCwebæ˜¯ä½¿ç”¨çš„ä¸­é—´æŠ€æœ¯ã€‚</p>
<p>å¦å¤–æ®è¯´ï¼Œä¸åŒæµè§ˆå™¨å‚å•†å¯¹äºlayout viewportçš„å¤§å°éƒ½æœ‰è‡ªå·±çš„å®šä¹‰ã€‚ä½†æ˜¯ï¼Œæˆ‘ç”¨æ‰‹ä¸Šä¸å¤šçš„å‡ ä¸ªæ‰‹æœºï¼ˆå°ç±³2sã€SONYã€é‡‘ç«‹ã€ipadï¼‰æµ‹è¯•çš„ç»“æœï¼Œéƒ½æ˜¯980pxã€‚å…¶ä¸­åœ¨å°ç±³2sä¸Šæµ‹è¯•äº†å°ç±³è‡ªå¸¦æµè§ˆå™¨ã€QQæµè§ˆå™¨ã€UCæµè§ˆå™¨ã€è°·æ­Œæµè§ˆå™¨ï¼Œè¿˜æœ‰operaæµè§ˆå™¨ï¼Œç»“æœéƒ½ä¸€æ ·ï¼›å…¶ä»–çš„æ‰‹æœºä¸Šé¢ä¸ç®¡è£…äº†ä»€ä¹ˆæµè§ˆå™¨ï¼Œéƒ½æµ‹è¯•äº†ï¼Œç»“æœéƒ½æ˜¯980pxã€‚ä½†æ˜¯è¿™ä¸ªå€¼å¯¹äºæˆ‘ä»¬webå¼€å‘æ¥è¯´ï¼Œå¥½åƒä¹Ÿæ²¡æœ‰ä»€ä¹ˆç”¨å¤„ã€‚</p>
<p>å› ä¸ºå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œ<code>&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width&quot; /&gt;</code>è¿™ä¸ªæ ‡ç­¾å¯¹æˆ‘ä»¬æ¥è¯´æ˜¯æœ€ç»™åŠ›çš„ï¼Œå¯ä»¥è®©æˆ‘ä»¬çš„é¡µé¢é‡Œçš„å›¾æ–‡æ˜¾ç¤ºçš„æ˜¯æ­£å¸¸çš„ï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šæé«˜äº†é¡µé¢çš„å¯è¯»æ€§ã€‚è€Œè¿™ä¸€metaæ ‡ç­¾çš„åŠŸèƒ½å°±æ˜¯è®¾ç½®layout viewportä¸ºdevice-widthçš„å®½åº¦ã€‚ä½†æ˜¯device-widthå…·ä½“æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<blockquote>
<font color="#ff0000">ç¬¬ä¸€ä»£iphoneçš„æ—¶å€™ï¼Œåˆ†è¾¨ç‡ä¸º320<em>480ï¼Œå±å¹•å°ºå¯¸ä¸º3.5å¯¸<span style="border-bottom:2px solid blue;">ï¼ˆæ³¨æ„ï¼Œè¿™ä¸ª3.5å¯¸è¯´çš„æ˜¯å±å¹•çš„å¯¹è§’çº¿å®½ï¼‰</span>ï¼Œè¿™æ—¶å€™device-widthå°±æ˜¯320pxï¼Œä¹Ÿæ˜¯æ‰‹æœºçš„åˆ†è¾¨ç‡å®½ï¼Œæ­¤æ—¶device-widthå°±æ˜¯è®¾å¤‡å®½ã€‚ä½†ç¬¬äºŒä»£çš„iphoneåˆ†è¾¨ç‡æé«˜ä¸ºäº†480</em>960ï¼Œå±å¹•å°ºå¯¸ä¸ºä¾ç„¶ä¸º3.5å¯¸ï¼Œå¦‚æœdevice-widthè¿˜æ˜¯è®¾å¤‡å®½ï¼Œé‚£ä¹ˆåŒæ ·æ˜¯320pxçš„é¡µé¢æ”¾480*960çš„æ‰‹æœºå±ä¸Šï¼Œå›¾æ–‡å°±ä¼šå˜å¾—æ¯”è¾ƒå°ï¼Œåˆä¼šå½±å“å…¶å¯è¯»æ€§ã€‚<span style="border-bottom:2px solid blue;">å› æ­¤iphoneçš„device-widthä¸€ç›´ç»´æŒåœ¨320pxï¼Œipadä¸€ç›´ç»´æŒåœ¨1024px</span>ã€‚è¿™ä¸ªæ—¶å€™ï¼Œdevice-widthå°±ä¸æ˜¯è®¾å¤‡å®½äº†ï¼ˆä¹Ÿå°±ä¸æ˜¯åˆ†è¾¨ç‡çš„å®½äº†ï¼‰ï¼Œæ˜¯ä¸€ä¸ªä¸­é—´å±‚ã€‚Androidé‡‡ç”¨çš„ä¹Ÿæ˜¯è¿™ä¸€æ¦‚å¿µï¼Œå…¶device-widthå€¼ä»¥360å±…å¤šï¼Œä½†ä¹Ÿä¸ä¹æœ‰åƒ540pxå’Œ600pxè¿™æ ·çš„å¥‡è‘©ã€‚åœ¨è®¾ç½®äº†<meta>æ ‡ç­¾ä»¥åï¼Œdevice-widthå€¼å¯ä»¥ç”¨window.innerWidthæ¥è·å–device-widthå€¼ã€‚</font>
</blockquote>
<h2 id="æœ‰å…³DPI"><a href="#æœ‰å…³DPI" class="headerlink" title="æœ‰å…³DPI"></a>æœ‰å…³DPI</h2><p>dpi(Dots Per Inch)ï¼Œæœ‰æ—¶ä¹Ÿå«åšppi(Point Per Inch)ï¼Œç¿»è¯‘è¿‡æ¥ä¹Ÿå«åƒç´ å¯†åº¦ï¼Œè¡¨ç¤ºè®¾å¤‡æ¯è‹±å¯¸æ‰€å æœ‰çš„åƒç´ æ•°ï¼›æ•°å€¼è¶Šé«˜ï¼Œå³ä»£è¡¨æ˜¾ç¤ºå±èƒ½å¤Ÿä»¥è¶Šé«˜çš„å¯†åº¦æ˜¾ç¤ºå›¾åƒã€‚ï¼ˆæ³¨ï¼šè¿™é‡Œçš„åƒç´ ï¼ŒæŒ‡çš„æ˜¯device pixelsã€‚ï¼‰DPIçš„è®¡ç®—å…¬å¼ï¼š</p>
<p><img src="/2018/01/02/å…³äºViewportä¸device-widthçš„ä¸€ç‚¹ç†è§£/201157547867064.jpg" alt=""></p>
<p>æœ‰æ„æ€çš„æ˜¯ï¼Œè¿™ä¸ªå€¼æ¯”è‹¹æœå®˜ç½‘ä¸Šå…¬å¸ƒçš„326è¿˜æœ‰é«˜ä¸€ç‚¹ç‚¹ã€‚</p>
<p><img src="/2018/01/02/å…³äºViewportä¸device-widthçš„ä¸€ç‚¹ç†è§£/201158077397288.jpg" alt=""></p>
<p>å…¶ä¸­ï¼ŒPPIåœ¨120-160ä¹‹é—´çš„æ‰‹æœºè¢«å½’ä¸ºä½å¯†åº¦æ‰‹æœºï¼Œ160-240è¢«å½’ä¸ºä¸­å¯†åº¦ï¼Œ240-320è¢«å½’ä¸ºé«˜å¯†åº¦ï¼Œ320ä»¥ä¸Šè¢«å½’ä¸ºè¶…é«˜å¯†åº¦ï¼ˆAppleç»™äº†å®ƒä¸€ä¸ªä¸Šæµçš„åå­—â€”â€”retinaï¼‰ã€‚</p>
<p>è¿™äº›å¯†åº¦å¯¹åº”ç€ä¸€ä¸ªç‰¹å®šçš„ç¼©æ”¾æ¯”ä¾‹å€¼ï¼Œæ‹¿æˆ‘ä»¬æœ€ç†Ÿæ‚‰çš„iphone4æˆ–4sæ¥è¯´ï¼Œå®ƒä»¬çš„PPIæ˜¯326ï¼Œå±äºè¶…é«˜å¯†åº¦çš„æ‰‹æœºã€‚å½“æˆ‘ä»¬ä¹¦å†™ä¸€ä¸ªå®½åº¦ä¸º320pxçš„é¡µé¢æ”¾åˆ°iphoneä¸­æ˜¾ç¤ºï¼Œä½ ä¼šå‘ç°ï¼Œå®ƒç«Ÿç„¶æ˜¯æ»¡å®½çš„ã€‚è¿™æ˜¯å› ä¸ºï¼Œé¡µé¢è¢«é»˜è®¤æ”¾å¤§äº†ä¸¤å€ï¼Œä¹Ÿå°±æ˜¯640pxï¼Œè€Œiphone4æˆ–4sçš„å®½ï¼Œæ­£æ˜¯640pxã€‚    </p>
<h2 id="DevicePixelRadio"><a href="#DevicePixelRadio" class="headerlink" title="DevicePixelRadio"></a>DevicePixelRadio</h2><p>DevicePixelRadioï¼Œå®šä¹‰ï¼š<code>window.devicePixelRatio</code>æ˜¯è®¾å¤‡ä¸Šç‰©ç†åƒç´ ï¼ˆä¹Ÿå°±æ˜¯device-widthï¼‰å’Œè®¾å¤‡ç‹¬ç«‹åƒç´ ï¼ˆdevice-independent pixelsï¼Œå³dipsï¼‰çš„æ¯”ä¾‹ã€‚å…¬å¼è¡¨ç¤ºå°±æ˜¯ï¼šwindow.devicePixelRatio = ç‰©ç†åƒç´ /dips</p>
<p>Android å’Œ iPhone ä¸­ï¼Œéƒ½æœ‰ä¸€ä¸ªå æ•´ä¸ªå±å¹•å¤§å°çš„æ¢ç®—å•ä½ï¼Œ<font color="#ff0000"><strong> Android ä¸­å« dip æˆ– dpï¼ŒiPhone ä¸­å« point </strong></font>ã€‚Dipï¼Œå°±æ˜¯device independent pixelsï¼Œè®¾å¤‡ç‹¬ç«‹åƒç´ ã€‚è€Œè®¾å¤‡çš„ç‰©ç†åƒç´ å’Œ dip çš„æ¯”ä¾‹å°±æ˜¯ devicePixelRatioï¼Œæ­¤å€¼å¯ä»¥é€šè¿‡ window.devicePixelRatio å±æ€§è·å–ã€‚</p>
<p>æ®æˆ‘æŸ¥æ‰¾åˆ°çš„ä¸€äº›èµ„æ–™æ˜¾ç¤ºï¼Œè¿™é‡Œçš„ç‹¬ç«‹åƒç´ çš„å€¼å…¶å®å°±æ˜¯device-widthå€¼ã€‚è¿™ä¸ªå€¼ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¹³æ—¶åœ¨æ‰‹æœºä¸Šå¸ƒå±€ç”¨çš„å®½åº¦ï¼Œå½“ç„¶æ˜¯åœ¨è®¾ç½®äº†<meta>æ ‡ç­¾çš„å‰æä¸‹ã€‚</p>
<h3 id="è¿™é‡Œä¸ºä»€ä¹ˆæåˆ°devicePixelRatioè¿™ä¸ªæ¦‚å¿µå‘¢ï¼Ÿ"><a href="#è¿™é‡Œä¸ºä»€ä¹ˆæåˆ°devicePixelRatioè¿™ä¸ªæ¦‚å¿µå‘¢ï¼Ÿ" class="headerlink" title="è¿™é‡Œä¸ºä»€ä¹ˆæåˆ°devicePixelRatioè¿™ä¸ªæ¦‚å¿µå‘¢ï¼Ÿ"></a>è¿™é‡Œä¸ºä»€ä¹ˆæåˆ°devicePixelRatioè¿™ä¸ªæ¦‚å¿µå‘¢ï¼Ÿ</h3><p>å› ä¸ºå½“devicePixelRatio=1.5çš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯è¯´å½“å±å¹•åˆ†è¾¨ç‡å®½ä¸device-widthçš„æ¯”å€¼ä¸º1.5æ—¶ï¼ŒæŸäº›æ‰‹æœºè‡ªå¸¦çš„æµè§ˆå™¨ï¼ˆç‰¹åˆ«æ˜¯ä¸‰æ˜Ÿæ‰‹æœºå‡ºç°åœ¨æœ€å¤šï¼‰ä¼šå‡ºç°1pxçš„çº¿è§£ææˆ2pxçš„bugï¼Œä½†æ˜¯ç»æµ‹è¯•åŒä¸€éƒ¨æ‰‹æœºä¸Šå®‰è£…çš„UCæµè§ˆå™¨ä¸€èˆ¬ä¸ä¼šæœ‰è¿™ä¸ªbugã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/01/æµ…è°ˆ-instanceof-å’Œ-typeof-çš„å®ç°åŸç†/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="èˆåŠ¨ä¹¾å¤">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/01/æµ…è°ˆ-instanceof-å’Œ-typeof-çš„å®ç°åŸç†/" itemprop="url">æµ…è°ˆ instanceof å’Œ typeof çš„å®ç°åŸç†</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-01-01T13:17:32+08:00">
                2018-01-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="typeof-å®ç°åŸç†"><a href="#typeof-å®ç°åŸç†" class="headerlink" title="typeof å®ç°åŸç†"></a>typeof å®ç°åŸç†</h3><p><code>typeof</code> ä¸€èˆ¬è¢«ç”¨äºåˆ¤æ–­ä¸€ä¸ªå˜é‡çš„ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ <code>typeof</code> æ¥åˆ¤æ–­<code>number</code>, <code>string</code>, <code>object</code>, <code>boolean</code>, <code>function</code>, <code>undefined</code>,<code>symbol</code> è¿™ä¸ƒç§ç±»å‹ï¼Œè¿™ç§åˆ¤æ–­èƒ½å¸®åŠ©æˆ‘ä»¬æå®šä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚åœ¨åˆ¤æ–­ä¸æ˜¯ object ç±»å‹çš„æ•°æ®çš„æ—¶å€™ï¼Œ<code>typeof</code>èƒ½æ¯”è¾ƒæ¸…æ¥šçš„å‘Šè¯‰æˆ‘ä»¬å…·ä½“æ˜¯å“ªä¸€ç±»çš„ç±»å‹ã€‚ä½†æ˜¯ï¼Œå¾ˆé—æ†¾çš„ä¸€ç‚¹æ˜¯ï¼Œ<code>typeof</code> åœ¨åˆ¤æ–­ä¸€ä¸ª objectçš„æ•°æ®çš„æ—¶å€™åªèƒ½å‘Šè¯‰æˆ‘ä»¬è¿™ä¸ªæ•°æ®æ˜¯ object, è€Œä¸èƒ½ç»†è‡´çš„å…·ä½“åˆ°æ˜¯å“ªä¸€ç§ object, æ¯”å¦‚ğŸ‘‰</p>
<pre><code>let s =newString(&apos;abc&apos;);
typeof s ===&apos;object&apos;// true
s instanceofString// true
</code></pre><p>è¦æƒ³åˆ¤æ–­ä¸€ä¸ªæ•°æ®å…·ä½“æ˜¯å“ªä¸€ç§ object çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦åˆ©ç”¨ <code>instanceof</code> è¿™ä¸ªæ“ä½œç¬¦æ¥åˆ¤æ–­ï¼Œè¿™ä¸ªæˆ‘ä»¬åé¢ä¼šè¯´åˆ°ã€‚</p>
<p>æ¥è°ˆè°ˆå…³äº <code>typeof</code> çš„åŸç†å§ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆæƒ³ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„é—®é¢˜ï¼Œjs åœ¨åº•å±‚æ˜¯æ€ä¹ˆå­˜å‚¨æ•°æ®çš„ç±»å‹ä¿¡æ¯å‘¢ï¼Ÿæˆ–è€…è¯´ï¼Œä¸€ä¸ª js çš„å˜é‡ï¼Œåœ¨å®ƒçš„åº•å±‚å®ç°ä¸­ï¼Œå®ƒçš„ç±»å‹ä¿¡æ¯æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿ</p>
<p>å…¶å®ï¼Œjs åœ¨åº•å±‚å­˜å‚¨å˜é‡çš„æ—¶å€™ï¼Œä¼šåœ¨å˜é‡çš„æœºå™¨ç çš„ä½ä½1-3ä½å­˜å‚¨å…¶ç±»å‹ä¿¡æ¯ğŸ‘‰<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">000ï¼šå¯¹è±¡</span><br><span class="line"></span><br><span class="line">010ï¼šæµ®ç‚¹æ•°</span><br><span class="line"></span><br><span class="line">100ï¼šå­—ç¬¦ä¸²</span><br><span class="line"></span><br><span class="line">110ï¼šå¸ƒå°”</span><br></pre></td></tr></table></figure></p>
<ul>
<li>1ï¼šæ•´æ•°</li>
</ul>
<p>but, å¯¹äº <code>undefined</code> å’Œ <code>null</code> æ¥è¯´ï¼Œè¿™ä¸¤ä¸ªå€¼çš„ä¿¡æ¯å­˜å‚¨æ˜¯æœ‰ç‚¹ç‰¹æ®Šçš„ã€‚</p>
<p><code>null</code>ï¼šæ‰€æœ‰æœºå™¨ç å‡ä¸º0</p>
<p><code>undefined</code>ï¼šç”¨ âˆ’2^30 æ•´æ•°æ¥è¡¨ç¤º</p>
<p>æ‰€ä»¥ï¼Œ<code>typeof</code> åœ¨åˆ¤æ–­ <code>null</code> çš„æ—¶å€™å°±å‡ºç°é—®é¢˜äº†ï¼Œç”±äº <code>null</code> çš„æ‰€æœ‰æœºå™¨ç å‡ä¸º0ï¼Œå› æ­¤ç›´æ¥è¢«å½“åšäº†å¯¹è±¡æ¥çœ‹å¾…ã€‚</p>
<p>ç„¶è€Œç”¨ <code>instanceof</code> æ¥åˆ¤æ–­çš„è¯ğŸ‘‰</p>
<pre><code>nullinstanceofnull// TypeError: Right-hand side of &apos;instanceof&apos; is not an object
</code></pre><p><code>null</code> ç›´æ¥è¢«åˆ¤æ–­ä¸ºä¸æ˜¯ objectï¼Œè¿™ä¹Ÿæ˜¯ JavaScript çš„å†å²é—ç•™bugï¼Œå¯ä»¥å‚è€ƒtypeofã€‚</p>
<p>å› æ­¤åœ¨ç”¨ <code>typeof</code> æ¥åˆ¤æ–­å˜é‡ç±»å‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦æ³¨æ„ï¼Œæœ€å¥½æ˜¯ç”¨ <code>typeof</code> æ¥åˆ¤æ–­åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆåŒ…æ‹¬<code>symbol</code>ï¼‰ï¼Œé¿å…å¯¹ null çš„åˆ¤æ–­ã€‚</p>
<p>è¿˜æœ‰ä¸€ä¸ªä¸é”™çš„åˆ¤æ–­ç±»å‹çš„æ–¹æ³•ï¼Œå°±æ˜¯<strong><font color="#dd0000">Object.prototype.toString</font></strong>ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ–¹æ³•æ¥å¯¹ä¸€ä¸ªå˜é‡çš„ç±»å‹æ¥è¿›è¡Œæ¯”è¾ƒå‡†ç¡®çš„åˆ¤æ–­</p>
<pre><code>Object.prototype.toString.call(1)// &quot;[object Number]&quot;
Object.prototype.toString.call(&apos;hi&apos;)// &quot;[object String]&quot;
Object.prototype.toString.call({a:&apos;hi&apos;})// &quot;[object Object]&quot;
Object.prototype.toString.call([1,&apos;a&apos;])// &quot;[object Array]&quot;
Object.prototype.toString.call(true)// &quot;[object Boolean]&quot;
Object.prototype.toString.call(()=&gt;{})// &quot;[object Function]&quot;
Object.prototype.toString.call(null)// &quot;[object Null]&quot;
Object.prototype.toString.call(undefined)// &quot;[object Undefined]&quot;
Object.prototype.toString.call(Symbol(1))// &quot;[object Symbol]&quot;
</code></pre><h3 id="instanceof-æ“ä½œç¬¦çš„å®ç°åŸç†"><a href="#instanceof-æ“ä½œç¬¦çš„å®ç°åŸç†" class="headerlink" title="instanceof æ“ä½œç¬¦çš„å®ç°åŸç†"></a>instanceof æ“ä½œç¬¦çš„å®ç°åŸç†</h3><p>ä¹‹å‰æˆ‘ä»¬æåˆ°äº† <code>instanceof</code> æ¥åˆ¤æ–­å¯¹è±¡çš„å…·ä½“ç±»å‹ï¼Œå…¶å® <code>instanceof</code> ä¸»è¦çš„ä½œç”¨å°±æ˜¯åˆ¤æ–­ä¸€ä¸ªå®ä¾‹æ˜¯å¦å±äºæŸç§ç±»å‹</p>
<pre><code>let person =function(){
}
let nicole =new person()
nicole instanceof person // true
</code></pre><p>å½“ç„¶ï¼Œ<code>instanceof</code> ä¹Ÿå¯ä»¥åˆ¤æ–­ä¸€ä¸ªå®ä¾‹æ˜¯å¦æ˜¯å…¶çˆ¶ç±»å‹æˆ–è€…ç¥–å…ˆç±»å‹çš„å®ä¾‹ã€‚</p>
<pre><code>let person =function(){
}
let programmer =function(){
}
programmer.prototype =new person()
let nicole =new programmer()
nicole instanceof person // true
nicole instanceof programmer // true
</code></pre><p>è¿™æ˜¯ <code>instanceof</code> çš„ç”¨æ³•ï¼Œä½†æ˜¯ <code>instanceof</code> çš„åŸç†æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæ ¹æ® ECMAScript è¯­è¨€è§„èŒƒï¼Œæˆ‘æ¢³ç†äº†ä¸€ä¸‹å¤§æ¦‚çš„æ€è·¯ï¼Œç„¶åæ•´ç†äº†ä¸€æ®µä»£ç å¦‚ä¸‹</p>
<pre><code>function new_instance_of(leftVaule, rightVaule){
    let rightProto = rightVaule.prototype;// å–å³è¡¨è¾¾å¼çš„ prototype å€¼
    leftVaule = leftVaule.__proto__;// å–å·¦è¡¨è¾¾å¼çš„__proto__å€¼
    while(true){
        if(leftVaule ===null){
            returnfalse;    
        }
        if(leftVaule === rightProto){
            returntrue;    
        }
        leftVaule = leftVaule.__proto__ 
    }
}
</code></pre><p><font color="#dd0000">å…¶å® <code>instanceof</code> ä¸»è¦çš„å®ç°åŸç†å°±æ˜¯åªè¦å³è¾¹å˜é‡çš„ <code>prototype</code> åœ¨å·¦è¾¹å˜é‡çš„åŸå‹é“¾ä¸Šå³å¯ã€‚å› æ­¤ï¼Œ<code>instanceof</code> åœ¨æŸ¥æ‰¾çš„è¿‡ç¨‹ä¸­ä¼šéå†å·¦è¾¹å˜é‡çš„åŸå‹é“¾ï¼Œç›´åˆ°æ‰¾åˆ°å³è¾¹å˜é‡çš„ <code>prototype</code>ï¼Œå¦‚æœæŸ¥æ‰¾å¤±è´¥ï¼Œåˆ™ä¼šè¿”å› falseï¼Œå‘Šè¯‰æˆ‘ä»¬å·¦è¾¹å˜é‡å¹¶éæ˜¯å³è¾¹å˜é‡çš„å®ä¾‹ã€‚<br></font><br><br>çœ‹å‡ ä¸ªå¾ˆæœ‰è¶£çš„ä¾‹å­</p>
<pre><code>functionFoo(){
}
Object instanceof Object// true
Function instanceof Function// true
Function instanceof Object// true
Foo instanceof Foo// false
Foo instanceof Object// true
Foo instanceof Function// true
</code></pre><p>è¦æƒ³å…¨éƒ¨ç†è§£ <code>instanceof</code> çš„åŸç†ï¼Œé™¤äº†æˆ‘ä»¬åˆšåˆšæåˆ°çš„å®ç°åŸç†ï¼Œæˆ‘ä»¬è¿˜éœ€è¦çŸ¥é“ JavaScript çš„åŸå‹ç»§æ‰¿åŸç†ã€‚</p>
<p>å…³äºåŸå‹ç»§æ‰¿çš„åŸç†ï¼Œæˆ‘ç®€å•ç”¨ä¸€å¼ å›¾æ¥è¡¨ç¤º</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/meG6Vo0MevjCzDE6dwt2qtltaDsSluC9M8KmmeZsLSJnFTgdTtcCRToR3zWJFYicViaUlvyAGdfwEzADj8Jk8kzQ/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt=""><br>æˆ‘ä»¬çŸ¥é“æ¯ä¸ª JavaScript å¯¹è±¡å‡æœ‰ä¸€ä¸ªéšå¼çš„ <code>__proto__</code> åŸå‹å±æ€§ï¼Œè€Œæ˜¾å¼çš„åŸå‹å±æ€§æ˜¯ <code>prototype</code>ï¼Œåªæœ‰ <code>Object.prototype.__proto__</code> å±æ€§åœ¨æœªä¿®æ”¹çš„æƒ…å†µä¸‹ä¸º null å€¼ã€‚æ ¹æ®å›¾ä¸Šçš„åŸç†ï¼Œæˆ‘ä»¬æ¥æ¢³ç†ä¸Šé¢æåˆ°çš„å‡ ä¸ªæœ‰è¶£çš„ <code>instanceof</code> ä½¿ç”¨çš„ä¾‹å­ã€‚</p>
<p><code>Object instanceof Object</code></p>
<p>ç”±å›¾å¯çŸ¥ï¼ŒObject çš„ <code>prototype</code> å±æ€§æ˜¯ <code>Object.prototype</code>, è€Œç”±äº Object æœ¬èº«æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç”± Function æ‰€åˆ›å»ºï¼Œæ‰€ä»¥ <code>Object.__proto__</code> çš„å€¼æ˜¯ <code>Function.prototype</code>ï¼Œè€Œ <code>Function.prototype</code> çš„ <code>__proto__</code> å±æ€§æ˜¯ <code>Object.prototype</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ¤æ–­å‡ºï¼Œ<code>Object instanceof Object</code> çš„ç»“æœæ˜¯ true ã€‚ç”¨ä»£ç ç®€å•çš„è¡¨ç¤ºä¸€ä¸‹</p>
<pre><code>leftValue =Object.__proto__ =Function.prototype;
rightValue =Object.prototype;
// ç¬¬ä¸€æ¬¡åˆ¤æ–­
leftValue != rightValue
leftValue =Function.prototype.__proto__ =Object.prototype
// ç¬¬äºŒæ¬¡åˆ¤æ–­
leftValue === rightValue
// è¿”å› true
</code></pre><p><code>Function instanceof Function</code> å’Œ <code>Function instanceof Object</code> çš„è¿è¡Œè¿‡ç¨‹ä¸ <code>Object instanceof Object</code> ç±»ä¼¼ï¼Œæ•…ä¸å†è¯¦è¯´ã€‚</p>
<p><code>Foo instanceof Foo</code></p>
<p>Foo å‡½æ•°çš„ <code>prototype</code> å±æ€§æ˜¯ <code>Foo.prototype</code>ï¼Œè€Œ Foo çš„ <code>__proto__</code> å±æ€§æ˜¯ <code>Function.prototype</code>ï¼Œç”±å›¾å¯çŸ¥ï¼ŒFoo çš„åŸå‹é“¾ä¸Šå¹¶æ²¡æœ‰ <code>Foo.prototype</code> ï¼Œå› æ­¤ <code>Foo instanceof Foo</code> ä¹Ÿå°±è¿”å› false ã€‚</p>
<p>æˆ‘ä»¬ç”¨ä»£ç ç®€å•çš„è¡¨ç¤ºä¸€ä¸‹</p>
<pre><code>leftValue =Foo, rightValue =Foo
leftValue =Foo.__proto =Function.prototype
rightValue =Foo.prototype
// ç¬¬ä¸€æ¬¡åˆ¤æ–­
leftValue != rightValue
leftValue =Function.prototype.__proto__ =Object.prototype
// ç¬¬äºŒæ¬¡åˆ¤æ–­
leftValue != rightValue
leftValue =Object.prototype =null
// ç¬¬ä¸‰æ¬¡åˆ¤æ–­
leftValue ===null
// è¿”å› false
</code></pre><p><code>Foo instanceof Object</code></p>
<pre><code>leftValue =Foo, rightValue =Object
leftValue =Foo.__proto__ =Function.prototype
rightValue =Object.prototype
// ç¬¬ä¸€æ¬¡åˆ¤æ–­
leftValue != rightValue
leftValue =Function.prototype.__proto__ =Object.prototype
// ç¬¬äºŒæ¬¡åˆ¤æ–­
leftValue === rightValue
// è¿”å› true 
</code></pre><p><code>Foo instanceof Function</code></p>
<pre><code>leftValue =Foo, rightValue =Function
leftValue =Foo.__proto__ =Function.prototype
rightValue =Function.prototype
// ç¬¬ä¸€æ¬¡åˆ¤æ–­
leftValue === rightValue
// è¿”å› true 
</code></pre><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ç®€å•æ¥è¯´ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>typeof</code> æ¥åˆ¤æ–­åŸºæœ¬æ•°æ®ç±»å‹æ˜¯ ok çš„ï¼Œä¸è¿‡éœ€è¦æ³¨æ„å½“ç”¨ <code>typeof</code> æ¥åˆ¤æ–­ <code>null</code> ç±»å‹æ—¶çš„é—®é¢˜ï¼Œå¦‚æœæƒ³è¦åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡çš„å…·ä½“ç±»å‹å¯ä»¥è€ƒè™‘ç”¨ <code>instanceof</code>ï¼Œä½†æ˜¯ <code>instanceof</code> ä¹Ÿå¯èƒ½åˆ¤æ–­ä¸å‡†ç¡®ï¼Œæ¯”å¦‚ä¸€ä¸ªæ•°ç»„ï¼Œä»–å¯ä»¥è¢« <code>instanceof</code> åˆ¤æ–­ä¸º Objectã€‚æ‰€ä»¥æˆ‘ä»¬è¦æƒ³æ¯”è¾ƒå‡†ç¡®çš„åˆ¤æ–­å¯¹è±¡å®ä¾‹çš„ç±»å‹æ—¶ï¼Œå¯ä»¥é‡‡å– <code>Object.prototype.toString.call</code> æ–¹æ³•ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/01/è·¨åŸŸä¹‹ç”±Request-Method-OPTIONSåˆçª¥CORS/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="èˆåŠ¨ä¹¾å¤">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/01/è·¨åŸŸä¹‹ç”±Request-Method-OPTIONSåˆçª¥CORS/" itemprop="url">è·¨åŸŸä¹‹ç”±Request Method:OPTIONSåˆçª¥CORS</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-01-01T00:09:02+08:00">
                2018-01-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="è·¨åŸŸèµ„æºå…±äº«â€”â€”CORS"><a href="#è·¨åŸŸèµ„æºå…±äº«â€”â€”CORS" class="headerlink" title="è·¨åŸŸèµ„æºå…±äº«â€”â€”CORS"></a><a href="https://juejin.im/post/5bfa5f8e6fb9a049a7117b67" target="_blank" rel="noopener">è·¨åŸŸèµ„æºå…±äº«â€”â€”CORS</a></h2><h2 id="ä¸€ç¯‡æ–‡ç« ææ˜ç™½CORSè·¨åŸŸ"><a href="#ä¸€ç¯‡æ–‡ç« ææ˜ç™½CORSè·¨åŸŸ" class="headerlink" title="ä¸€ç¯‡æ–‡ç« ææ˜ç™½CORSè·¨åŸŸ"></a><a href="https://segmentfault.com/a/1190000017149446" target="_blank" rel="noopener">ä¸€ç¯‡æ–‡ç« ææ˜ç™½CORSè·¨åŸŸ</a></h2><h2 id="ä¸å°±æ˜¯è·¨åŸŸä¹ˆ-æ…Œä¸ªXX-æ˜é‡‘"><a href="#ä¸å°±æ˜¯è·¨åŸŸä¹ˆ-æ…Œä¸ªXX-æ˜é‡‘" class="headerlink" title="ä¸å°±æ˜¯è·¨åŸŸä¹ˆ?æ…Œä¸ªXX - æ˜é‡‘"></a><a href="https://link.zhihu.com/?target=https%3A//juejin.im/post/5a2f92c65188253e2470f16d" target="_blank" rel="noopener">ä¸å°±æ˜¯è·¨åŸŸä¹ˆ?æ…Œä¸ªXX - æ˜é‡‘</a></h2><p>é¢è¯•é—®åˆ°æ•°æ®äº¤äº’çš„æ—¶å€™ï¼Œç»å¸¸ä¼šé—®è·¨åŸŸå¦‚ä½•å¤„ç†ã€‚å¤§éƒ¨åˆ†äººéƒ½ä¼šå›ç­”JSONPï¼Œç„¶åé¢è¯•å®˜ç´§æ¥ç€å°±ä¼šé—®ï¼šâ€œJSONPç¼ºç‚¹æ˜¯ä»€ä¹ˆå•Šï¼Ÿâ€è¿™ä¸ªæ—¶å€™å‘å°±æ¥äº†ï¼Œå¦‚æœé¢è¯•è€…è¯´å®ƒæ”¯æŒGETæ–¹å¼ï¼Œç„¶åé¢è¯•å®˜å°±ä¼šè¿½é—®ï¼Œé‚£å¦‚æœPOSTæ–¹å¼å‘é€è¯·æ±‚æ€ä¹ˆåŠï¼ŸåŸºç¡€æ‰å®ä¸€äº›çš„é¢è¯•è€…ä¼šè¯´ï¼Œä½¿ç”¨CORSè·¨åŸŸï¼Œä¸æ‰å®çš„å¯èƒ½å°±æ‘‡æ‘‡å¤´äº†ã€‚</p>
<p>è¿™è¿˜æ²¡ç»“æŸï¼Œå¦‚æœå…¬å¸æ¯”è¾ƒæ­£è§„æˆ–è€…å¾ˆåœ¨ä¹æŠ€æœ¯åŠŸåº•ï¼Œä½ é¢è¯•çš„åˆæ˜¯é‡è¦å²—ä½ï¼ŒHRè¿˜æƒ³ç ä½ çš„å·¥èµ„ï¼Œå°±ä¼šå†è¡¥ä¸€åˆ€ï¼ŒCORSè·¨åŸŸæœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿè¿™æ—¶å€™èƒ½å›ç­”ä¸Šæ¥çš„å°±æ²¡å‡ ä¸ªäº†ï¼Œå°±ç®—æ˜¯ä½ ç­”å‡ºæ¥å…¼å®¹æ€§ä¸å¥½ï¼Œéœ€è¦IE10+æµè§ˆå™¨,å¯¹æ–¹ä¾ç„¶æœ‰è¯è¯´ï¼Œé‚£å…¼å®¹æ€§æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿåº”è¯•è€…å°±æ²¡è¯äº†ï¼Œè¦ä¹ˆè¢«Passæ‰ï¼Œå³ä¾¿ç•™ä¸‹æ¥ï¼Œè°ˆå·¥èµ„çš„æ—¶å€™å°±æ²¡åº•æ°”äº†ã€‚</p>
<p>CORSè·¨åŸŸå®åœ¨æ˜¯é¢è¯•å®˜passä¸€ä¸ªäººçš„åˆ©å™¨ã€‚</p>
<p>ä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Ÿ</p>
<ul>
<li><p>1.é‡åˆ°CORSè¯·æ±‚çš„æƒ…å†µä¸å¤šï¼Œå¼€å‘è€…ä½¿ç”¨è¿™ä¸ªåœºæ™¯çš„å¾ˆå°‘ï¼Œå¤§éƒ¨åˆ†éƒ½JSONPæå®šäº†ã€‚</p>
</li>
<li><p>2.å¼€å‘è€…è‡ªèº«æŠ€èƒ½ä¸æ‰å®ï¼Œå·æ‡’å¿ƒæ€ï¼Œå¹³å¸¸æ²¡æœ‰æ„è¯†å’Œæ„æ„¿å»æå‡è‡ªå·±çš„æŠ€æœ¯æ°´å¹³ã€‚</p>
</li>
<li><p>3.ç›¸å…³çš„å­¦ä¹ èµ„æ–™å°‘ã€çº¯å‰ç«¯å°ç™½æ­å»ºå¯æµ‹è¯•çš„ç¯å¢ƒéš¾åº¦å¤§ã€‚</p>
</li>
</ul>
<p>é¢å¯¹è¿™æ¡æ‹¦è·¯è™ï¼Œæˆ‘ä»¬ä»Šå¤©å°±å½»åº•è§£å†³æ‰å®ƒï¼Œè®©å®ƒä¸å†æ˜¯æˆ‘ä»¬çš„è½¯è‚‹ï¼Œè€Œæ˜¯å½°æ˜¾æˆ‘ä»¬æŠ€æœ¯å®åŠ›çš„äº®ç‚¹ã€‚</p>
<h2 id="é¦–å…ˆï¼Œä»€ä¹ˆæ˜¯CORS"><a href="#é¦–å…ˆï¼Œä»€ä¹ˆæ˜¯CORS" class="headerlink" title="é¦–å…ˆï¼Œä»€ä¹ˆæ˜¯CORS?"></a>é¦–å…ˆï¼Œä»€ä¹ˆæ˜¯CORS?</h2><blockquote>
<p>CORSæ˜¯ä¸€ä¸ªW3Cæ ‡å‡†ï¼Œå…¨ç§°æ˜¯â€è·¨åŸŸèµ„æºå…±äº«â€ï¼ˆCross-origin resource sharingï¼‰ã€‚<br>    å®ƒå…è®¸æµè§ˆå™¨å‘è·¨æºæœåŠ¡å™¨ï¼Œå‘å‡ºXMLHttpRequestè¯·æ±‚ï¼Œä»è€Œå…‹æœäº†AJAXåªèƒ½åŒæºä½¿ç”¨çš„é™åˆ¶ã€‚</p>
</blockquote>
<p>ä¼˜ç¼ºç‚¹</p>
<p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>1.æ”¯æŒPOSTä»¥åŠæ‰€æœ‰HTTPè¯·æ±‚</li>
<li>2.å®‰å…¨æ€§ç›¸å¯¹JSOPæ›´é«˜</li>
<li>3.å‰ç«¯è¦åšçš„äº‹å„¿æ¯”è¾ƒå°‘</li>
</ul>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>1.ä¸å…¼å®¹è€ç‰ˆæœ¬æµè§ˆå™¨ï¼Œå¦‚IE9åŠå…¶ä»¥ä¸‹</li>
<li>2.éœ€è¦æœåŠ¡ç«¯æ”¯æŒ</li>
<li>3.ä½¿ç”¨èµ·æ¥ç¨å¾®å¤æ‚äº†äº›</li>
</ul>
<p>æ€ä¹ˆç”¨ï¼Ÿ</p>
<p>å‰ç«¯éƒ¨åˆ†ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;</span><br><span class="line">    &lt;title&gt;CORSè·¨åŸŸè¯·æ±‚&lt;/title&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        function createCORSRequest(method, url) &#123;</span><br><span class="line">            var xhr = new XMLHttpRequest();</span><br><span class="line">            if (&quot;withCredentials&quot; in xhr) &#123;</span><br><span class="line">                xhr.open(method, url, true);</span><br><span class="line">            &#125; else if (typeof XDomainRequest != &quot;undefined&quot;) &#123;</span><br><span class="line">                xhr = new XDomainRequest();</span><br><span class="line">                xhr.open(method, url);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                xhr = null;</span><br><span class="line">            &#125;</span><br><span class="line">            return xhr;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        window.onload = function () &#123;</span><br><span class="line">            var oBtn = document.getElementById(&apos;btn1&apos;);</span><br><span class="line">            oBtn.onclick = function () &#123;</span><br><span class="line">                var xhr = createCORSRequest(&quot;get&quot;, &quot;http://wpdic.com/cors.php&quot;);</span><br><span class="line">                if (xhr) &#123;</span><br><span class="line">                    xhr.onload = function () &#123;</span><br><span class="line">                        var json = JSON.parse(xhr.responseText);</span><br><span class="line">                        alert(json.a);</span><br><span class="line">                    &#125;;</span><br><span class="line">                    xhr.onerror = function () &#123;</span><br><span class="line">                        alert(&apos;è¯·æ±‚å¤±è´¥.&apos;);</span><br><span class="line">                    &#125;;</span><br><span class="line">                    xhr.send();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;input type=&quot;button&quot; value=&quot;è·å–æ•°æ®&quot; id=&quot;btn1&quot;&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>
<p>æ³¨æ„ç‚¹ï¼š</p>
<p>1.ä¸Šé¢ä»£ç å…¼å®¹IE8,å› ä¸ºç”¨äº†XDomainRequest</p>
<p>2.å…¶å®ƒä»£ç ä½ å°±å½“æˆXMLHttpRequsetç”¨ï¼Œåˆ«è€ƒè™‘ä»€ä¹ˆ2.0ä¸2.0çš„</p>
<p>3.å¦‚æœä½ æƒ³postæ•°æ®ï¼Œå¯ä»¥å¾€ xhr.send()é‡Œé¢æ</p>
<p>4.è¿™é‡Œä¸å»ºè®®å¤§å®¶ç ”ç©¶â€simple methdodâ€ä¹‹ç±»çš„çŸ¥è¯†ï¼Œä»£ç å¼„æ‡‚äº†ä¼šç”¨å°±è¡Œï¼Œé‡åˆ°é—®é¢˜äº†å†æŸ¥ä¹Ÿä¸æ™š</p>
<p>åå°éƒ¨åˆ†ï¼š</p>
<pre><code>&lt;?php
header(&apos;content-type:application:json;charset=utf8&apos;);
header(&apos;Access-Control-Allow-Origin:*&apos;);
header(&apos;Access-Control-Allow-Methods:GET,POST&apos;);
header(&apos;Access-Control-Allow-Credentials: true&apos;);
header(&apos;Access-Control-Allow-Headers:x-requested-with,content-type&apos;);
$str = &apos;{&quot;a&quot;:1,&quot;b&quot;:2,&quot;c&quot;:3,&quot;d&quot;:4,&quot;e&quot;:5}&apos;; 
echo $str;
?&gt;
</code></pre><p>æ³¨æ„ç‚¹ï¼š</p>
<p>1.Access-Control-Allow-Origin:<em> è¡¨ç¤ºå…è®¸ä»»ä½•åŸŸåè·¨åŸŸè®¿é—®ï¼Œå¦‚æœéœ€è¦æŒ‡å®šæŸåŸŸåæ‰å…è®¸è·¨åŸŸè®¿é—®ï¼Œåªéœ€æŠŠAccess-Control-Allow-Origin:</em>æ”¹ä¸ºAccess-Control-Allow-Origin:å…è®¸çš„åŸŸå,å®é™…å·¥ä½œä¹Ÿè¦è¿™ä¹ˆåš2.Access-Control-Allow-Methods:GET,POST  è§„å®šå…è®¸çš„æ–¹æ³•ï¼Œå»ºè®®æ§åˆ¶ä¸¥æ ¼äº›ï¼Œä¸è¦éšæ„æ”¾å¼€DELETEä¹‹ç±»çš„æƒé™</p>
<p>2.Access-Control-Allow-Credentials</p>
<p>è¯¥å­—æ®µå¯é€‰ã€‚å®ƒçš„å€¼æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦å…è®¸å‘é€Cookieã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒCookieä¸åŒ…æ‹¬åœ¨CORSè¯·æ±‚ä¹‹ä¸­ã€‚è®¾ä¸ºtrueï¼Œå³è¡¨ç¤ºæœåŠ¡å™¨æ˜ç¡®è®¸å¯ï¼ŒCookieå¯ä»¥åŒ…å«åœ¨è¯·æ±‚ä¸­ï¼Œä¸€èµ·å‘ç»™æœåŠ¡å™¨ã€‚è¿™ä¸ªå€¼ä¹Ÿåªèƒ½è®¾ä¸ºtrueï¼Œå¦‚æœæœåŠ¡å™¨ä¸è¦æµè§ˆå™¨å‘é€Cookieï¼Œåˆ é™¤è¯¥å­—æ®µå³å¯ã€‚</p>
<p>æœ€åï¼Œé¢è¯•å¸¸è€ƒé—®é¢˜ï¼š</p>
<p>CORSå’ŒJSONPçš„åº”ç”¨åœºæ™¯åŒºåˆ«ï¼Ÿ</p>
<blockquote>
<p>CORSè¦æ±‚æµè§ˆå™¨(&gt;IE10)å’ŒæœåŠ¡å™¨çš„åŒæ—¶æ”¯æŒï¼Œæ˜¯è·¨åŸŸçš„æ ¹æœ¬è§£å†³æ–¹æ³•ï¼Œç”±æµè§ˆå™¨è‡ªåŠ¨å®Œæˆã€‚ä¼˜ç‚¹åœ¨äºåŠŸèƒ½æ›´åŠ å¼ºå¤§æ”¯æŒå„ç§HTTP Methodï¼Œç¼ºç‚¹æ˜¯å…¼å®¹æ€§ä¸å¦‚JSONPã€‚</p>
</blockquote>
<hr>
<p>åˆšæ¥è§¦å‰ç«¯çš„æ—¶å€™ï¼Œä»¥ä¸ºHTTPçš„Request Methodåªæœ‰GETä¸POSTä¸¤ç§ï¼Œåæ¥æ‰äº†è§£åˆ°ï¼ŒåŸæ¥è¿˜æœ‰HEADã€PUTã€DELETEã€OPTIONSâ€¦â€¦</p>
<p>ç›®å‰çš„å·¥ä½œä¸­ï¼ŒHEADã€PUTã€DELETEæˆ‘æ˜¯çœŸçš„æ²¡æœ‰è§è¿‡â€¦â€¦ä½†æ˜¯OPTIONSå‡ ä¹å¤©å¤©éƒ½ä¼šé‡åˆ°ã€‚æœ¬åœ°ç¯å¢ƒè·‘å…¬å¸é¡¹ç›®çš„æ—¶å€™ï¼Œæ¯æ¬¡POSTä¹‹å‰ï¼Œä¸ºå•¥æµè§ˆå™¨è¿˜å·å·ç»™æˆ‘æ¥ä¸€æ¬¡æ²¡æœ‰è¿”å›çš„OPTIONSè¯·æ±‚ï¼Ÿ</p>
<blockquote>
<p>åŸæ¥ï¼Œæµè§ˆå™¨åœ¨æŸäº›è¯·æ±‚ä¸­ï¼Œåœ¨æ­£å¼é€šä¿¡å‰ä¼šå¢åŠ ä¸€æ¬¡HTTPæŸ¥è¯¢è¯·æ±‚ï¼Œç§°ä¸ºâ€é¢„æ£€â€è¯·æ±‚ï¼ˆpreflightï¼‰ã€‚OPTIONSæ–¹æ³•æ˜¯ç”¨äºè¯·æ±‚è·å¾—ç”±Request-URIæ ‡è¯†çš„èµ„æºåœ¨è¯·æ±‚/å“åº”çš„é€šä¿¡è¿‡ç¨‹ä¸­å¯ä»¥ä½¿ç”¨çš„åŠŸèƒ½é€‰é¡¹ã€‚é€šè¿‡è¿™ä¸ªæ–¹æ³•ï¼Œå®¢æˆ·ç«¯å¯ä»¥åœ¨é‡‡å–å…·ä½“èµ„æºè¯·æ±‚ä¹‹å‰ï¼Œå†³å®šå¯¹è¯¥èµ„æºé‡‡å–ä½•ç§å¿…è¦æªæ–½ï¼Œæˆ–è€…äº†è§£æœåŠ¡å™¨çš„æ€§èƒ½ã€‚è¯¥è¯·æ±‚æ–¹æ³•çš„å“åº”ä¸èƒ½ç¼“å­˜ã€‚æµè§ˆå™¨å…ˆè¯¢é—®æœåŠ¡å™¨ï¼Œå½“å‰ç½‘é¡µæ‰€åœ¨çš„åŸŸåæ˜¯å¦åœ¨æœåŠ¡å™¨çš„è®¸å¯åå•ä¹‹ä¸­ï¼Œä»¥åŠå¯ä»¥ä½¿ç”¨å“ªäº›HTTPåŠ¨è¯å’Œå¤´ä¿¡æ¯å­—æ®µã€‚åªæœ‰å¾—åˆ°è‚¯å®šç­”å¤ï¼Œæµè§ˆå™¨æ‰ä¼šå‘å‡ºæ­£å¼çš„XMLHttpRequestè¯·æ±‚ï¼Œå¦åˆ™å°±æŠ¥é”™ã€‚</p>
</blockquote>
<p>å¦‚æœè¿™ä¸ªOPTIONSè¯·æ±‚åŒ…å«ä¸€ä¸ªæ­£æ–‡ï¼ˆæœ‰Content-Lengthæˆ–Transfer-Encodingå­˜åœ¨ï¼‰ï¼Œåˆ™å¿…é¡»æœ‰Content-Typeæ¥æŒ‡å®šåª’ä½“ç±»å‹ã€‚è™½ç„¶è§„èŒƒé‡Œæ²¡æœ‰å®šä¹‰è¿™ç§æ­£æ–‡çš„ç”¨æ³•ï¼Œä½†æ˜¯HTTPå°†æ¥çš„æ‰©å±•å¯èƒ½ä¼šç”¨å®ƒæ¥æŸ¥è¯¢æœåŠ¡å™¨ä¸Šæ›´è¯¦ç»†çš„ä¿¡æ¯ã€‚ä¸æ”¯æŒè¯¥æ‰©å±•çš„æœåŠ¡å™¨å¯ä»¥å¿½ç•¥è¯¥è¯·æ±‚æ­£æ–‡ã€‚</p>
<p>å¦‚æœè¯¥URIæ˜¯ä¸€ä¸ªæ˜Ÿå·ï¼ˆâ€œ<em>â€ï¼‰ï¼ŒOPTIONSè¯·æ±‚å°†è¯•å›¾åº”ç”¨äºæœåŠ¡å™¨ï¼Œè€Œä¸æ˜¯æŸä¸ªæŒ‡å®šèµ„æºã€‚ç”±äºæœåŠ¡å™¨çš„é€šä¿¡é€‰é¡¹é€šå¸¸ä¾èµ–äºèµ„æºï¼Œæ‰€ä»¥æ­¤â€œ</em>â€è¯·æ±‚åªèƒ½ä½œä¸ºâ€œpingâ€æˆ–è€…â€œno-opâ€æ–¹æ³•ï¼›æˆ–è€…ç”¨æ¥æµ‹è¯•æœåŠ¡å™¨çš„æ€§èƒ½ã€‚ä¾‹å¦‚ï¼Œç”¨æ¥æµ‹è¯•HTTP/1.1ä»£ç†ã€‚</p>
<p>å¦‚æœè¯¥URIä¸æ˜¯æ˜Ÿå·ï¼Œåˆ™åªèƒ½ç”¨æ¥è·å–è¯¥èµ„æºé€šä¿¡ä¸­å¯ç”¨çš„é€‰é¡¹ã€‚</p>
<p>å¾—åˆ°çš„200å“åº”åº”è¯¥åŒ…å«ä¸€ä¸ªå¤´åŸŸï¼ŒæŒ‡æ˜æœåŠ¡å™¨å®ç°çš„å’Œé€‚ç”¨äºè¯¥èµ„æºçš„å¯é€‰ç‰¹å¾ï¼ˆå¦‚ï¼šAllowï¼‰ï¼Œå¯èƒ½è¿˜åŒ…æ‹¬è¯¥è§„èŒƒå°šæœªå®šä¹‰çš„æ‰©å±•ã€‚å¦‚æœæœ‰å“åº”æ­£æ–‡ï¼Œåˆ™åº”åŒ…å«å…³äºé€šä¿¡é€‰é¡¹çš„ä¿¡æ¯ã€‚æœ¬è§„èŒƒæ²¡æœ‰å®šä¹‰è¯¥æ­£æ–‡æ ¼å¼ï¼Œä½†å¯èƒ½åœ¨HTTOå°†æ¥çš„æ‰©å±•ä¸­å®šä¹‰ã€‚å¯ä»¥åˆ©ç”¨å†…å®¹åå•†æ¥é€‰æ‹©åˆé€‚çš„å“åº”æ ¼å¼ã€‚å¦‚æœæ²¡æœ‰å“åº”æ­£æ–‡ï¼Œå“åº”å¿…é¡»åŒ…å«Content-Lengthï¼Œå¹¶ä¸”å€¼ä¸ºâ€œ0â€ã€‚</p>
<p>è¯·æ±‚å¤´çš„Max-Forwardsç”¨æ¥è¯·æ±‚ç‰¹å®šä»£ç†ã€‚å½“ä»£ç†æ”¶åˆ°ä¸€ä¸ªå…è®¸URIè½¬å‘çš„OPTIONSè¯·æ±‚ï¼Œåˆ™æ£€æŸ¥Max-Forwardsã€‚å¦‚æœMax-Forwardså€¼ä¸º0ï¼Œåˆ™ä¸èƒ½è½¬å‘è¯¥æ¶ˆæ¯ï¼›ç›¸åï¼Œä»£ç†ä¼šå°†è‡ªå·±çš„é€šä¿¡é€‰é¡¹å»å“åº”ã€‚å¦‚æœMax-Forwardsæ˜¯æ­£æ•´æ•°ï¼Œä»£ç†è½¬å‘è¯·æ±‚çš„æ—¶å€™ä¼šå°†è¯¥å€¼å‡1ã€‚å¦‚æœè¯·æ±‚ä¸­æ²¡æœ‰Max-Forwardsï¼Œè½¬å‘çš„è¯·æ±‚ä¹Ÿä¸ä¼šæœ‰ã€‚</p>
<h2 id="ç®€è€Œè¨€ä¹‹"><a href="#ç®€è€Œè¨€ä¹‹" class="headerlink" title="ç®€è€Œè¨€ä¹‹"></a>ç®€è€Œè¨€ä¹‹</h2><p>OPTIONSè¯·æ±‚æ–¹æ³•çš„ä¸»è¦ç”¨é€”æœ‰ä¸¤ä¸ªï¼š</p>
<p>1ã€è·å–æœåŠ¡å™¨æ”¯æŒçš„HTTPè¯·æ±‚æ–¹æ³•ï¼›ä¹Ÿæ˜¯é»‘å®¢ç»å¸¸ä½¿ç”¨çš„æ–¹æ³•ã€‚</p>
<p>2ã€ç”¨æ¥æ£€æŸ¥æœåŠ¡å™¨çš„æ€§èƒ½ã€‚ä¾‹å¦‚ï¼šAJAXè¿›è¡Œè·¨åŸŸè¯·æ±‚æ—¶çš„é¢„æ£€ï¼Œéœ€è¦å‘å¦å¤–ä¸€ä¸ªåŸŸåçš„èµ„æºå‘é€ä¸€ä¸ªHTTP OPTIONSè¯·æ±‚å¤´ï¼Œç”¨ä»¥åˆ¤æ–­å®é™…å‘é€çš„è¯·æ±‚æ˜¯å¦å®‰å…¨ã€‚<br><img src="https://pic3.zhimg.com/v2-8f8d34a757502c306d82fa44f4645068_b.jpg" alt=""><img src="https://pic3.zhimg.com/80/v2-8f8d34a757502c306d82fa44f4645068_hd.jpg" alt=""><img src="https://pic3.zhimg.com/v2-38b8f2ec0da0115511cee8a1b604c6a4_b.jpg" alt=""><img src="https://pic3.zhimg.com/80/v2-38b8f2ec0da0115511cee8a1b604c6a4_hd.jpg" alt=""><br>å¦‚ä¸Šä¸¤å¼ å›¾ç‰‡ï¼Œå›¾2å°±æ˜¯æœ¬åœ°ç¯å¢ƒï¼Œæœ¬åœ°ç¯å¢ƒè¯·æ±‚æ¥å£çš„æ—¶å€™ï¼Œæ¯æ¬¡è¯·æ±‚æ¥å£ä¹‹å‰éƒ½ä¼šå¤šä¸€æ¬¡OPTIONSè¯·æ±‚ã€‚</p>
<p><img src="https://pic4.zhimg.com/v2-31c4436fae8e077e9d935ac58bd861d6_b.jpg" alt=""><img src="https://pic4.zhimg.com/80/v2-31c4436fae8e077e9d935ac58bd861d6_hd.jpg" alt=""></p>
<h2 id="CORS"><a href="#CORS" class="headerlink" title="CORS"></a>CORS</h2><p>CORSæ˜¯ä¸€ä¸ªW3Cæ ‡å‡†ï¼Œå…¨ç§°æ˜¯â€è·¨åŸŸèµ„æºå…±äº«â€ï¼ˆCross-origin resource sharingï¼‰ã€‚</p>
<p>å®ƒå…è®¸æµè§ˆå™¨å‘è·¨æºæœåŠ¡å™¨ï¼Œå‘å‡º<a href="https://link.zhihu.com/?target=http%3A//www.ruanyifeng.com/blog/2012/09/xmlhttprequest_level_2.html" target="_blank" rel="noopener">XMLHttpRequest</a>è¯·æ±‚ï¼Œä»è€Œå…‹æœäº†AJAXåªèƒ½<a href="https://link.zhihu.com/?target=http%3A//www.ruanyifeng.com/blog/2016/04/same-origin-policy.html" target="_blank" rel="noopener">åŒæº</a>ä½¿ç”¨çš„é™åˆ¶ã€‚</p>
<blockquote>
<p>CORSéœ€è¦æµè§ˆå™¨å’ŒæœåŠ¡å™¨åŒæ—¶æ”¯æŒã€‚ç›®å‰ï¼Œæ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒè¯¥åŠŸèƒ½ï¼ŒIEæµè§ˆå™¨ä¸èƒ½ä½äºIE10ã€‚<br>æ•´ä¸ªCORSé€šä¿¡è¿‡ç¨‹ï¼Œéƒ½æ˜¯æµè§ˆå™¨è‡ªåŠ¨å®Œæˆï¼Œä¸éœ€è¦ç”¨æˆ·å‚ä¸ã€‚å¯¹äºå¼€å‘è€…æ¥è¯´ï¼ŒCORSé€šä¿¡ä¸åŒæºçš„AJAXé€šä¿¡æ²¡æœ‰å·®åˆ«ï¼Œä»£ç å®Œå…¨ä¸€æ ·ã€‚æµè§ˆå™¨ä¸€æ—¦å‘ç°AJAXè¯·æ±‚è·¨æºï¼Œå°±ä¼šè‡ªåŠ¨æ·»åŠ ä¸€äº›é™„åŠ çš„å¤´ä¿¡æ¯ï¼Œæœ‰æ—¶è¿˜ä¼šå¤šå‡ºä¸€æ¬¡é™„åŠ çš„è¯·æ±‚ï¼Œä½†ç”¨æˆ·ä¸ä¼šæœ‰æ„Ÿè§‰ã€‚<br>å› æ­¤ï¼Œå®ç°CORSé€šä¿¡çš„å…³é”®æ˜¯æœåŠ¡å™¨ã€‚åªè¦æœåŠ¡å™¨å®ç°äº†CORSæ¥å£ï¼Œå°±å¯ä»¥è·¨æºé€šä¿¡ã€‚</p>
</blockquote>
<h2 id="ä¸¤ç§è¯·æ±‚"><a href="#ä¸¤ç§è¯·æ±‚" class="headerlink" title="ä¸¤ç§è¯·æ±‚"></a>ä¸¤ç§è¯·æ±‚</h2><p>æµè§ˆå™¨å°†CORSè¯·æ±‚åˆ†ä¸ºä¸¤ç±»ï¼šç®€å•è¯·æ±‚ï¼ˆsimple requestï¼‰å’Œéç®€å•è¯·æ±‚ï¼ˆnot-so-simple requestï¼‰ã€‚</p>
<p>åŒæ—¶æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼Œå°±æ˜¯ç®€å•è¯·æ±‚ï¼š</p>
<blockquote>
<p>ï¼ˆ1) è¯·æ±‚æ–¹æ³•æ˜¯ä»¥ä¸‹ä¸‰ç§æ–¹æ³•ä¹‹ä¸€ï¼š</p>
</blockquote>
<ul>
<li>HEAD</li>
<li>GET</li>
<li>POST</li>
</ul>
<p>ï¼ˆ2ï¼‰HTTPçš„å¤´ä¿¡æ¯ä¸è¶…å‡ºä»¥ä¸‹å‡ ç§å­—æ®µï¼š</p>
<ul>
<li>Accept</li>
<li>Accept-Language</li>
<li>Content-Language</li>
<li>Last-Event-ID</li>
<li>Content-Typeï¼šåªé™äºä¸‰ä¸ªå€¼application/x-www-form-urlencodedã€multipart/form-dataã€text/plain</li>
</ul>
<h2 id="ç®€å•è¯·æ±‚"><a href="#ç®€å•è¯·æ±‚" class="headerlink" title="ç®€å•è¯·æ±‚"></a>ç®€å•è¯·æ±‚</h2><p>å¯¹äºç®€å•è¯·æ±‚ï¼Œæµè§ˆå™¨ç›´æ¥å‘å‡ºCORSè¯·æ±‚ã€‚å…·ä½“æ¥è¯´ï¼Œå°±æ˜¯åœ¨å¤´ä¿¡æ¯ä¹‹ä¸­ï¼Œå¢åŠ ä¸€ä¸ªOriginå­—æ®µã€‚</p>
<p>Originå­—æ®µç”¨æ¥è¯´æ˜ï¼Œæœ¬æ¬¡è¯·æ±‚æ¥è‡ªå“ªä¸ªæºï¼ˆåè®® + åŸŸå + ç«¯å£ï¼‰ã€‚æœåŠ¡å™¨æ ¹æ®è¿™ä¸ªå€¼ï¼Œå†³å®šæ˜¯å¦åŒæ„è¿™æ¬¡è¯·æ±‚ã€‚</p>
<p>å¦‚æœOriginæŒ‡å®šçš„æºï¼Œä¸åœ¨è®¸å¯èŒƒå›´å†…ï¼ŒæœåŠ¡å™¨ä¼šè¿”å›ä¸€ä¸ªæ­£å¸¸çš„HTTPå›åº”ã€‚æµè§ˆå™¨å‘ç°ï¼Œè¿™ä¸ªå›åº”çš„å¤´ä¿¡æ¯æ²¡æœ‰åŒ…å«Access-Control-Allow-Originå­—æ®µï¼ˆè¯¦è§ä¸‹æ–‡ï¼‰ï¼Œå°±çŸ¥é“å‡ºé”™äº†ï¼Œä»è€ŒæŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œè¢«XMLHttpRequestçš„onerrorå›è°ƒå‡½æ•°æ•è·ã€‚æ³¨æ„ï¼Œè¿™ç§é”™è¯¯æ— æ³•é€šè¿‡çŠ¶æ€ç è¯†åˆ«ï¼Œå› ä¸ºHTTPå›åº”çš„çŠ¶æ€ç æœ‰å¯èƒ½æ˜¯200ã€‚</p>
<p>å¦‚æœOriginæŒ‡å®šçš„åŸŸååœ¨è®¸å¯èŒƒå›´å†…ï¼ŒæœåŠ¡å™¨è¿”å›çš„å“åº”ï¼Œä¼šå¤šå‡ºå‡ ä¸ªå¤´ä¿¡æ¯å­—æ®µã€‚éƒ½ä»¥Access-Control- å¼€å¤´ï¼š</p>
<p>ï¼ˆ1ï¼‰Access-Control-Allow-Origin</p>
<p>è¯¥å­—æ®µæ˜¯å¿…é¡»çš„ã€‚å®ƒçš„å€¼è¦ä¹ˆæ˜¯è¯·æ±‚æ—¶Originå­—æ®µçš„å€¼ï¼Œè¦ä¹ˆæ˜¯ä¸€ä¸ª*ï¼Œè¡¨ç¤ºæ¥å—ä»»æ„åŸŸåçš„è¯·æ±‚ã€‚</p>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœè¦å‘é€Cookieï¼ŒAccess-Control-Allow-Originå°±ä¸èƒ½è®¾ä¸ºæ˜Ÿå·ï¼Œå¿…é¡»æŒ‡å®šæ˜ç¡®çš„ã€ä¸è¯·æ±‚ç½‘é¡µä¸€è‡´çš„åŸŸåã€‚åŒæ—¶ï¼ŒCookieä¾ç„¶éµå¾ªåŒæºæ”¿ç­–ï¼Œåªæœ‰ç”¨æœåŠ¡å™¨åŸŸåè®¾ç½®çš„Cookieæ‰ä¼šä¸Šä¼ ï¼Œå…¶ä»–åŸŸåçš„Cookieå¹¶ä¸ä¼šä¸Šä¼ ï¼Œä¸”ï¼ˆè·¨æºï¼‰åŸç½‘é¡µä»£ç ä¸­çš„document.cookieä¹Ÿæ— æ³•è¯»å–æœåŠ¡å™¨åŸŸåä¸‹çš„Cookieã€‚</p>
</blockquote>
<p>ï¼ˆ2ï¼‰Access-Control-Allow-Credentials</p>
<p>è¯¥å­—æ®µå¯é€‰ã€‚å®ƒçš„å€¼æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦å…è®¸å‘é€Cookieã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒCookieä¸åŒ…æ‹¬åœ¨CORSè¯·æ±‚ä¹‹ä¸­ã€‚è®¾ä¸ºtrueï¼Œå³è¡¨ç¤ºæœåŠ¡å™¨æ˜ç¡®è®¸å¯ï¼ŒCookieå¯ä»¥åŒ…å«åœ¨è¯·æ±‚ä¸­ï¼Œä¸€èµ·å‘ç»™æœåŠ¡å™¨ã€‚è¿™ä¸ªå€¼ä¹Ÿåªèƒ½è®¾ä¸ºtrueï¼Œå¦‚æœæœåŠ¡å™¨ä¸è¦æµè§ˆå™¨å‘é€Cookieï¼Œåˆ é™¤è¯¥å­—æ®µå³å¯ã€‚</p>
<p>ï¼ˆ3ï¼‰Access-Control-Expose-Headers</p>
<p>è¯¥å­—æ®µå¯é€‰ã€‚CORSè¯·æ±‚æ—¶ï¼ŒXMLHttpRequestå¯¹è±¡çš„getResponseHeader()æ–¹æ³•åªèƒ½æ‹¿åˆ°6ä¸ªåŸºæœ¬å­—æ®µï¼šCache-Controlã€Content-Languageã€Content-Typeã€Expiresã€Last-Modifiedã€Pragmaã€‚å¦‚æœæƒ³æ‹¿åˆ°å…¶ä»–å­—æ®µï¼Œå°±å¿…é¡»åœ¨Access-Control-Expose-Headersé‡Œé¢æŒ‡å®šã€‚</p>
<h2 id="éç®€å•è¯·æ±‚"><a href="#éç®€å•è¯·æ±‚" class="headerlink" title="éç®€å•è¯·æ±‚"></a>éç®€å•è¯·æ±‚</h2><p>éç®€å•è¯·æ±‚æ˜¯é‚£ç§å¯¹æœåŠ¡å™¨æœ‰ç‰¹æ®Šè¦æ±‚çš„è¯·æ±‚ï¼Œæ¯”å¦‚è¯·æ±‚æ–¹æ³•æ˜¯PUTæˆ–DELETEï¼Œæˆ–è€…Content-Typeå­—æ®µçš„ç±»å‹æ˜¯application/jsonã€‚</p>
<p>æˆ‘å·¥ä½œä¸­å†™çš„æ‰€æœ‰é¡µé¢æ‹‰çš„æ¥å£éƒ½æ˜¯éç®€å•è¯·æ±‚ã€‚<br><img src="https://pic1.zhimg.com/v2-6749c6523db660ed4e194e16779c5fa3_b.jpg" alt=""><img src="https://pic1.zhimg.com/80/v2-6749c6523db660ed4e194e16779c5fa3_hd.jpg" alt=""><br>éç®€å•è¯·æ±‚çš„CORSè¯·æ±‚ï¼Œä¼šåœ¨æ­£å¼é€šä¿¡ä¹‹å‰ï¼Œå¢åŠ ä¸€æ¬¡HTTPæŸ¥è¯¢è¯·æ±‚ï¼Œç§°ä¸ºâ€é¢„æ£€â€è¯·æ±‚ï¼ˆpreflightï¼‰ã€‚</p>
<p>æµè§ˆå™¨å…ˆè¯¢é—®æœåŠ¡å™¨ï¼Œå½“å‰ç½‘é¡µæ‰€åœ¨çš„åŸŸåæ˜¯å¦åœ¨æœåŠ¡å™¨çš„è®¸å¯åå•ä¹‹ä¸­ï¼Œä»¥åŠå¯ä»¥ä½¿ç”¨å“ªäº›HTTPåŠ¨è¯å’Œå¤´ä¿¡æ¯å­—æ®µã€‚åªæœ‰å¾—åˆ°è‚¯å®šç­”å¤ï¼Œæµè§ˆå™¨æ‰ä¼šå‘å‡ºæ­£å¼çš„XMLHttpRequestè¯·æ±‚ï¼Œå¦åˆ™å°±æŠ¥é”™ã€‚</p>
<p>åœ¨é¡µé¢åŸŸåä¸æ¥å£åŸŸåä¸ä¸€è‡´çš„æƒ…å†µä¸‹ï¼Œå°±å‡ºç°äº†æ¯æ¬¡è¯·æ±‚å‰å…ˆå‘é€ä¸€ä¸ªoptionsè¯·æ±‚çš„é—®é¢˜ã€‚</p>
<p>OPTIONSè¯·æ±‚å¤´ä¿¡æ¯ä¸­ï¼Œé™¤äº†Originå­—æ®µï¼Œè¿˜è‡³å°‘ä¼šå¤šä¸¤ä¸ªç‰¹æ®Šå­—æ®µï¼š</p>
<p>ï¼ˆ1ï¼‰Access-Control-Request-Method</p>
<p>è¯¥å­—æ®µæ˜¯å¿…é¡»çš„ï¼Œç”¨æ¥åˆ—å‡ºæµè§ˆå™¨çš„CORSè¯·æ±‚ä¼šç”¨åˆ°å“ªäº›HTTPæ–¹æ³•ã€‚</p>
<p>ï¼ˆ2ï¼‰Access-Control-Request-Headers</p>
<p>è¯¥å­—æ®µæ˜¯ä¸€ä¸ªé€—å·åˆ†éš”çš„å­—ç¬¦ä¸²ï¼ŒæŒ‡å®šæµè§ˆå™¨CORSè¯·æ±‚ä¼šé¢å¤–å‘é€çš„å¤´ä¿¡æ¯å­—æ®µã€‚</p>
<p><img src="https://pic3.zhimg.com/v2-da5ae04890068d4ffc9f4714e48719dd_b.jpg" alt=""><img src="https://pic3.zhimg.com/80/v2-da5ae04890068d4ffc9f4714e48719dd_hd.jpg" alt=""><br>è‡³äºå…¶ä»–ä¹±ä¸ƒå…«ç³Ÿçš„å­—æ®µï¼Œç°åœ¨çš„æˆ‘è¿˜ç”¨ä¸åˆ°ä¹Ÿä¸æ‡‚ï¼Œå°†ä¼šæ…¢æ…¢æ·±å…¥äº†è§£ã€‚</p>
<p>æœåŠ¡å™¨æ”¶åˆ°é¢„æ£€è¯·æ±‚åï¼Œæ£€æŸ¥äº†Originã€Access-Control-Request-Methodå’ŒAccess-Control-Request-Headerså­—æ®µä»¥åï¼Œç¡®è®¤å…è®¸è·¨æºè¯·æ±‚ï¼Œå°±å¯ä»¥åšå‡ºå›åº”ã€‚</p>
<p>ä¸Šé¢çš„HTTPå›åº”ä¸­ï¼Œå…³é”®çš„æ˜¯Access-Control-Allow-Originå­—æ®µï¼Œè¡¨ç¤º<a href="https://link.zhihu.com/?target=http%3A//lizard.qa.nt.ctripcorp.com" target="_blank" rel="noopener">http://lizard.qa.nt.ctripcorp.com</a>å¯ä»¥è¯·æ±‚æ•°æ®ã€‚è¯¥å­—æ®µä¹Ÿå¯ä»¥è®¾ä¸ºæ˜Ÿå·ï¼Œè¡¨ç¤ºåŒæ„ä»»æ„è·¨æºè¯·æ±‚ã€‚</p>
<p>å¦‚æœæµè§ˆå™¨å¦å®šäº†â€é¢„æ£€â€è¯·æ±‚ï¼Œä¼šè¿”å›ä¸€ä¸ªæ­£å¸¸çš„HTTPå›åº”ï¼Œä½†æ˜¯æ²¡æœ‰ä»»ä½•CORSç›¸å…³çš„å¤´ä¿¡æ¯å­—æ®µã€‚è¿™æ—¶ï¼Œæµè§ˆå™¨å°±ä¼šè®¤å®šï¼ŒæœåŠ¡å™¨ä¸åŒæ„é¢„æ£€è¯·æ±‚ï¼Œå› æ­¤è§¦å‘ä¸€ä¸ªé”™è¯¯ï¼Œè¢«XMLHttpRequestå¯¹è±¡çš„onerrorå›è°ƒå‡½æ•°æ•è·ã€‚æ§åˆ¶å°ä¼šæ‰“å°å‡ºå¦‚ä¸‹çš„æŠ¥é”™ä¿¡æ¯ã€‚</p>
<p>XMLHttpRequest cannot load <a href="https://link.zhihu.com/?target=http%3A//lizard.qa.nt.ctripcorp.com" target="_blank" rel="noopener">http://lizard.qa.nt.ctripcorp.com</a><br>Origin <a href="https://link.zhihu.com/?target=http%3A//lizard.qa.nt.ctripcorp.com" target="_blank" rel="noopener">http://lizard.qa.nt.ctripcorp.com</a> is not allowed by Access-Control-Allow-Origin.</p>
<p>å…¶ä»–å­—æ®µä¸­Access-Control-Max-Age ç”¨æ¥æŒ‡å®šæœ¬æ¬¡é¢„æ£€è¯·æ±‚çš„æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºç§’ã€‚è¯¥å­—æ®µå¯é€‰ã€‚</p>
<h2 id="ä¸JSONPçš„å¯¹æ¯”"><a href="#ä¸JSONPçš„å¯¹æ¯”" class="headerlink" title="ä¸JSONPçš„å¯¹æ¯”"></a>ä¸JSONPçš„å¯¹æ¯”</h2><p>CORSä¸JSONPçš„ä½¿ç”¨ç›®çš„ç›¸åŒï¼Œä½†æ˜¯æ¯”JSONPæ›´å¼ºå¤§ã€‚</p>
<p>JSONPåªæ”¯æŒGETè¯·æ±‚ï¼ŒJSONPçš„ä¼˜åŠ¿åœ¨äºæ”¯æŒè€æ—§æµè§ˆå™¨ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/5/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/14/">14</a><a class="extend next" rel="next" href="/page/7/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/tx.jpg" alt="ææ–Œ">
            
              <p class="site-author-name" itemprop="name">ææ–Œ</p>
              <p class="site-description motion-element" itemprop="description">æƒ³è¦é£å¾—é«˜ï¼Œé‚£å°±æŠŠåœ°å¹³çº¿å¿˜æ‰</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">136</span>
                  <span class="site-state-item-name">æ—¥å¿—</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">106</span>
                  <span class="site-state-item-name">æ ‡ç­¾</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/libin1991" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://juejin.im/user/57e737f6c4c971005f6bcd8d" target="_blank" title="juejin">
                      
                        <i class="fa fa-fw fa-spinner"></i>juejin</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ææ–Œ</span>

  
</div>


  <div class="powered-by">ç”± <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">ä¸»é¢˜ &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
<script type="text/javascript" src="/js/src/clicklove.js"></script>

