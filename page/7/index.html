<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="Blog">
<meta property="og:type" content="website">
<meta property="og:title" content="LuckDay">
<meta property="og:url" content="http://yoursite.com/page/7/index.html">
<meta property="og:site_name" content="LuckDay">
<meta property="og:description" content="Blog">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="LuckDay">
<meta name="twitter:description" content="Blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/7/"/>





  <title>LuckDay - æƒ³è¦é£å¾—é«˜ï¼Œé‚£å°±æŠŠåœ°å¹³çº¿å¿˜æ‰</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband">
    	<div class="eevee"><div class="body"><div class="head"><div class="ears"><div class="ear"><div class="lobe"></div></div><div class="ear"><div class="lobe"></div></div></div><div class="face"><div class="eyes"><div class="eye"><div class="eyelid"></div></div><div class="eye"><div class="eyelid"></div></div></div><div class="nose"></div><div class="mouth"></div></div></div><div class="chest"><div class="fur"><div class="patch"></div></div><div class="fur"><div class="patch"></div></div><div class="fur"><div class="patch"></div></div></div><div class="legs"><div class="leg"><div class="inner-leg"></div></div><div class="leg"><div class="inner-leg"></div></div><div class="leg"><div class="inner-leg"></div></div><div class="leg"><div class="inner-leg"></div></div></div><div class="tail"><div class="tail"><div class="tail"><div class="tail"><div class="tail"><div class="tail -end"></div></div></div></div></div></div></div></div>
    </div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
    	<div class="sky">
	<div class="clouds_one"></div>
	<div class="clouds_two"></div>
	<div class="clouds_three"></div>
</div>
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">LuckDay</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">æƒ³è¦é£å¾—é«˜ï¼Œé‚£å°±æŠŠåœ°å¹³çº¿å¿˜æ‰</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            æ ‡ç­¾
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            å…³äº
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            æœç´¢
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="æœç´¢..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/02/vueæ–‡ä»¶çš„ä¸€ä¸ªå°ç»†èŠ‚/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/02/vueæ–‡ä»¶çš„ä¸€ä¸ªå°ç»†èŠ‚/" itemprop="url">.vueæ–‡ä»¶çš„ä¸€ä¸ªå°ç»†èŠ‚</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-03-02T23:06:11+08:00">
                2018-03-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>top.vue</p>
<pre><code>&lt;template&gt;
    &lt;div class=&quot;ds&quot;&gt;
        &lt;div class=&quot;left&quot;&gt;
            &lt;p&gt;SX&lt;/p&gt;
        &lt;/div&gt;
        &lt;div class=&quot;right&quot;&gt;
            &lt;p&gt;SB&lt;/p&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
    console.log(&quot;-------------------------&quot;);     //åªæ‰§è¡Œä¸€æ¬¡


    export default {
        props: [],
        data() {
            return {}
        },
        components: {

        },
        methods: {

        },
        created() {

        },
        mounted() {
            console.log(&quot;$$$$$$$$$$$$$$$$$$$$$$$&quot;)ï¼›  //æ‰§è¡Œå¤šæ¬¡
        }
    };
&lt;/script&gt;

&lt;style lang=&quot;scss&quot; scoped=&quot;scoped&quot;&gt;
    .guize {
        box-sizing: border-box;
        padding: 0 0.4rem;
        margin-top: -0.3rem;
        width: 100%;
        height: 1.2rem;
        font-size: 0.24rem;
        color: white;
        position: relative;
        .left {
            color: #abc4ed;
            float: left;
            transform:scale(0.85);
            transform-origin:0 0; 
            p {
                font-size: 0.24rem;
                line-height: 2;
            }
        }
        .right {
            float: left;
            width: 1.6rem;
            height: 0.44rem;
            line-height: 0.44rem;
            border: 1px solid white;
            color: white;
            border-radius: 0.24rem;
            text-align: center;
            position: absolute;
            right: 0.4rem;
            bottom: 0.04rem;
        }
    }
&lt;/style&gt;
</code></pre><p><img src="https://pic3.zhimg.com/v2-57add9333368254c8b108fdd00160585_b.jpg" alt=""><img src="https://pic3.zhimg.com/80/v2-57add9333368254c8b108fdd00160585_hd.jpg" alt=""><img src="https://pic4.zhimg.com/v2-2ac46bc7c3c82fdde73c1f53cf8e39d5_b.jpg" alt=""><img src="https://pic4.zhimg.com/80/v2-2ac46bc7c3c82fdde73c1f53cf8e39d5_hd.jpg" alt=""></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/02/JS-ç»§æ‰¿/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/02/JS-ç»§æ‰¿/" itemprop="url">JS ç»§æ‰¿</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-03-02T22:49:01+08:00">
                2018-03-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ä¼—æ‰€å‘¨çŸ¥ï¼Œåœ¨ ES 6 ä¹‹å‰æ²¡æœ‰ç±»çš„æ¦‚å¿µï¼Œæ‰€ä»¥ä¸èƒ½åƒ Java ä¸­ä¸€ä¸ª extends å…³é”®å­—å°±æå®šäº†ç»§æ‰¿å…³ç³»ï¼Œéœ€è¦ä¸€äº› tricks æ¥å®ç°ï¼Œä¸‹é¢å°±ä»‹ç»ä¸€äº›æ¯”è¾ƒå¸¸ç”¨çš„æ–¹æ³•ã€‚</p>
<h2 id="ä¸€-åŸå‹é“¾ç»§æ‰¿ï¼š"><a href="#ä¸€-åŸå‹é“¾ç»§æ‰¿ï¼š" class="headerlink" title="(ä¸€) åŸå‹é“¾ç»§æ‰¿ï¼š"></a>(ä¸€) åŸå‹é“¾ç»§æ‰¿ï¼š</h2><pre><code>function Parent(name) { 
    this.name = name;
}
Parent.prototype.sayName = function() {
    console.log(&apos;parent name:&apos;, this.name);
}
function Child(name) {
    this.name = name;
}

Child.prototype = new Parent(&apos;father&apos;);
Child.prototype.constructor = Child;

Child.prototype.sayName = function() {
    console.log(&apos;child name:&apos;, this.name);
}

var child = new Child(&apos;son&apos;);
child.sayName();    // child name: son
</code></pre><p>åªè¦æ˜¯åŸå‹é“¾ä¸­å‡ºç°è¿‡çš„åŸå‹ï¼Œéƒ½å¯ä»¥è¯´æ˜¯è¯¥åŸå‹é“¾æ´¾ç”Ÿçš„å®ä¾‹çš„åŸå‹ã€‚</p>
<p>è¿™ç§æ–¹æ³•å­˜åœ¨ä¸¤ä¸ªç¼ºç‚¹ï¼š</p>
<ol>
<li>å­ç±»å‹æ— æ³•ç»™è¶…ç±»å‹ä¼ é€’å‚æ•°ï¼Œåœ¨é¢å‘å¯¹è±¡çš„ç»§æ‰¿ä¸­ï¼Œæˆ‘ä»¬æ€»å¸Œæœ›é€šè¿‡ var child = new Child(â€˜sonâ€™, â€˜fatherâ€™); è®©å­ç±»å»è°ƒç”¨çˆ¶ç±»çš„æ„é€ å™¨æ¥å®Œæˆç»§æ‰¿ã€‚è€Œä¸æ˜¯é€šè¿‡åƒè¿™æ · new Parent(â€˜fatherâ€™) å»è°ƒç”¨çˆ¶ç±»ã€‚</li>
<li>Child.prototype.sayName å¿…é¡»å†™åœ¨ Child.prototype = new Parent(â€˜fatherâ€™); ä¹‹åï¼Œä¸ç„¶å°±ä¼šè¢«è¦†ç›–æ‰ã€‚</li>
</ol>
<h2 id="äºŒ-ç±»å¼ç»§æ‰¿ï¼š"><a href="#äºŒ-ç±»å¼ç»§æ‰¿ï¼š" class="headerlink" title="(äºŒ) ç±»å¼ç»§æ‰¿ï¼š"></a>(äºŒ) ç±»å¼ç»§æ‰¿ï¼š</h2><pre><code>function Parent(name) { 
    this.name = name;
}
Parent.prototype.sayName = function() {
    console.log(&apos;parent name:&apos;, this.name);
}
Parent.prototype.doSomthing = function() {
    console.log(&apos;parent do something!&apos;);
}
function Child(name, parentName) {
    Parent.call(this, parentName);
    this.name = name;
}

Child.prototype.sayName = function() {
    console.log(&apos;child name:&apos;, this.name);
}

var child = new Child(&apos;son&apos;);
child.sayName();      // child name: son
child.doSomthing();   // TypeError: child.doSomthing is not a function
</code></pre><p>ç›¸å½“äº Parent è¿™ä¸ªå‡½æ•°åœ¨ Child å‡½æ•°ä¸­æ‰§è¡Œäº†ä¸€éï¼Œå¹¶ä¸”å°†æ‰€æœ‰ä¸ this ç»‘å®šçš„å˜é‡éƒ½åˆ‡æ¢åˆ°äº† Child ä¸Šï¼Œè¿™æ ·å°±å…‹æœäº†ç¬¬ä¸€ç§æ–¹å¼å¸¦æ¥çš„é—®é¢˜ã€‚</p>
<p>ç¼ºç‚¹ï¼š</p>
<ol>
<li>æ²¡æœ‰åŸå‹ï¼Œæ¯æ¬¡åˆ›å»ºä¸€ä¸ª Child å®ä¾‹å¯¹è±¡æ—¶å€™éƒ½éœ€è¦æ‰§è¡Œä¸€é Parent å‡½æ•°ï¼Œæ— æ³•å¤ç”¨ä¸€äº›å…¬ç”¨å‡½æ•°ã€‚</li>
</ol>
<h2 id="ä¸‰-ç»„åˆå¼ç»§æ‰¿ï¼šå‰ä¸¤ç§æ–¹å¼çš„ç»“åˆ"><a href="#ä¸‰-ç»„åˆå¼ç»§æ‰¿ï¼šå‰ä¸¤ç§æ–¹å¼çš„ç»“åˆ" class="headerlink" title="(ä¸‰) ç»„åˆå¼ç»§æ‰¿ï¼šå‰ä¸¤ç§æ–¹å¼çš„ç»“åˆ"></a>(ä¸‰) ç»„åˆå¼ç»§æ‰¿ï¼šå‰ä¸¤ç§æ–¹å¼çš„ç»“åˆ</h2><pre><code>function Parent(name) { 
    this.name = name;
}

Parent.prototype.sayName = function() {
    console.log(&apos;parent name:&apos;, this.name);
}
Parent.prototype.doSomething = function() {
    console.log(&apos;parent do something!&apos;);
}
function Child(name, parentName) {
    Parent.call(this, parentName);
    this.name = name;
}

Child.prototype.sayName = function() {
    console.log(&apos;child name:&apos;, this.name);
}

Child.prototype = new Parent();      
Child.prototype.construtor = Child;

var child = new Child(&apos;son&apos;);
child.sayName();       // child name: son
child.doSomething();   // parent do something!
</code></pre><p>ç»„åˆå¼ç»§æ‰¿æ˜¯æ¯”è¾ƒå¸¸ç”¨çš„ä¸€ç§ç»§æ‰¿æ–¹æ³•ï¼Œå…¶èƒŒåçš„æ€è·¯æ˜¯ä½¿ç”¨åŸå‹é“¾å®ç°å¯¹åŸå‹å±æ€§å’Œæ–¹æ³•çš„ç»§æ‰¿ï¼Œè€Œé€šè¿‡å€Ÿç”¨æ„é€ å‡½æ•°æ¥å®ç°å¯¹å®ä¾‹å±æ€§çš„ç»§æ‰¿ã€‚</p>
<p>è¿™æ ·ï¼Œæ—¢é€šè¿‡åœ¨åŸå‹ä¸Šå®šä¹‰æ–¹æ³•å®ç°äº†å‡½æ•°å¤ç”¨ï¼Œåˆä¿è¯æ¯ä¸ªå®ä¾‹éƒ½æœ‰å®ƒè‡ªå·±çš„å±æ€§ã€‚</p>
<p>ç»„åˆå¼ç»§æ‰¿æ˜¯ JS æœ€å¸¸ç”¨çš„ç»§æ‰¿æ¨¡å¼ï¼Œä½†ç»„åˆç»§æ‰¿ä½¿ç”¨è¿‡ç¨‹ä¸­ä¼šè¢«è°ƒç”¨ä¸¤æ¬¡ï¼šä¸€æ¬¡æ˜¯åˆ›å»ºå­ç±»å‹çš„æ—¶å€™ï¼Œå¦ä¸€æ¬¡æ˜¯åœ¨å­ç±»å‹æ„é€ å‡½æ•°çš„å†…éƒ¨ã€‚</p>
<pre><code>function Parent(name) { 
    this.name = name;
}
Parent.prototype.sayName = function() {
    console.log(&apos;parent name:&apos;, this.name);
}
Parent.prototype.doSomething = function() {
    console.log(&apos;parent do something!&apos;);
}
function Child(name, parentName) {
    Parent.call(this, parentName);      // ç¬¬äºŒæ¬¡è°ƒç”¨
    this.name = name;
}

Child.prototype.sayName = function() {
    console.log(&apos;child name:&apos;, this.name);
}

Child.prototype = new Parent();         // ç¬¬ä¸€æ¬¡è°ƒç”¨
Child.prototype.construtor = Child;

var child = new Child(&apos;son&apos;);
child.sayName();      
child.doSomething();   
</code></pre><p>æ˜¾ç„¶ä»ä¸Šè¿°çš„ä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨æ„é€ å‡½æ•°æ˜¾ç„¶æ˜¯æ²¡æœ‰å¿…è¦çš„ï¼Œå› ä¸ºç¬¬ä¸€æ¬¡è°ƒç”¨æ„é€ å‡½æ•°æ—¶å€™ä¸éœ€è¦å‡½æ•°å†…éƒ¨çš„é‚£äº›å®ä¾‹å±æ€§ï¼Œè¿™ä¹ˆå†™åªæ˜¯æƒ³è·å¾—å…¶åŸå‹ä¸Šçš„æ–¹æ³•ç½¢äº†ï¼Œæ‰€ä»¥è¿™æ—¶å€™ä½ å¯èƒ½ä¼šè¿™æ ·å†™ï¼š</p>
<pre><code>Child.prototype = Parent.prototype;
</code></pre><p>è¿™æ ·å†™æ˜¾ç„¶æ˜¯ä¸å¯¹çš„ï¼š</p>
<ol>
<li>é¦–å…ˆï¼Œä½ è¿™æ ·å†™çš„è¯ç›¸å½“äºæ˜¯å­ç±»å’Œçˆ¶ç±»éƒ½æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ï¼Œè¿™æ—¶å€™å¦‚æœä½ æ·»åŠ äº†æ–°çš„æ–¹æ³•ç»™ Child ä½†å®é™…ä¸Š Parent å¹¶ä¸éœ€è¦ï¼Œç›¸å½“äºå¼ºè¡Œç»™ Parent æ·»åŠ äº†ä¸€ä¸ªæœªçŸ¥çš„æ–¹æ³•ã€‚</li>
<li>å…¶æ¬¡ï¼Œä»”ç»†æƒ³æƒ³ï¼Œè¿™æ ·ä½“ç°ä¸å‡ºç»§æ‰¿çš„å¤šæ€æ€§ï¼Œæ¯”å¦‚æ­¤æ—¶å­ç±»æƒ³è¦é‡å†™çˆ¶ç±»çš„ getName çš„æ–¹æ³•ï¼Œé‚£ä¹ˆçˆ¶ç±»çš„æ–¹æ³•ä¹Ÿå°±ä¼šéšä¹‹ä¿®æ”¹ï¼Œè¿™æ˜¾ç„¶è¿èƒŒäº†å¤šæ€æ€§ã€‚</li>
</ol>
<p>ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ç¬¬ä¸€æ¬¡è°ƒç”¨æ„é€ å‡½æ•°çš„æ—¶å€™ï¼Œå…¶å®æ˜¯ä¸ç®¡æ„é€ å‡½æ•°é‡Œé¢çš„å†…å®¹ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½•ä¸ new ä¸€ä¸ªç©ºå‡½æ•°ï¼Œå°†å…¶ prototype æŒ‡å‘ Parent.prototypeï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<h2 id="å››-å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿ï¼š"><a href="#å››-å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿ï¼š" class="headerlink" title="(å››) å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿ï¼š"></a>(å››) å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿ï¼š</h2><pre><code>function Parent(name) {
    this.name = name;
}
Parent.prototype.sayName = function() {
    console.log(&apos;parent name:&apos;, this.name);
}

function Child(name, parentName) {
    Parent.call(this, parentName);  
    this.name = name;    
}

function create(proto) {
    function F(){}
    F.prototype = proto;
    F.prototype.construtor = F;
    return new F();
}

Child.prototype = create(Parent.prototype);
Child.prototype.sayName = function() {
    console.log(&apos;child name:&apos;, this.name);
}
Child.prototype.construtor = Child;

var parent = new Parent(&apos;father&apos;);
parent.sayName();    // parent name: father


var child = new Child(&apos;son&apos;, &apos;father&apos;);
child.sayName();     // child name: son
</code></pre><p>è¿™å°±æ˜¯æ‰€è°“çš„å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿æ–¹å¼ï¼Œè·Ÿç»„åˆå¼ç»§æ‰¿çš„åŒºåˆ«åœ¨äºï¼Œä»–ä¸éœ€è¦åœ¨ä¸€æ¬¡å®ä¾‹ä¸­è°ƒç”¨ä¸¤æ¬¡çˆ¶ç±»çš„æ„é€ å‡½æ•°ï¼Œå‡å¦‚è¯´çˆ¶ç±»çš„æ„é€ å™¨ä»£ç å¾ˆå¤šï¼Œè¿˜éœ€è¦è°ƒç”¨ä¸¤æ¬¡çš„è¯å¯¹ç³»ç»Ÿè‚¯å®šä¼šæœ‰å½±å“ï¼Œå¯„ç”Ÿç»„åˆå¼ç»§æ‰¿çš„æ€æƒ³åœ¨äºï¼šç”¨ä¸€ä¸ª F ç©ºçš„æ„é€ å‡½æ•°å»å–ä»£æ‰§è¡Œäº† Parent è¿™ä¸ªæ„é€ å‡½æ•°ã€‚</p>
<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬æ‰‹åŠ¨åˆ›å»ºäº†ä¸€ä¸ª create å‡½æ•°ï¼Œä½†æ˜¯å…¶å®æ˜¯å­˜åœ¨äº Object å¯¹è±¡ä¸­ï¼Œä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å»åˆ›å»ºï¼Œæ‰€ä»¥ä¸Šé¢çš„ä»£ç å¯ä»¥æ”¹ä¸ºï¼š</p>
<pre><code>function Parent(name) {
    this.name = name;
}
Parent.prototype.sayName = function() {
    console.log(&apos;parent name:&apos;, this.name);
}

function Child(name, parentName) {
    Parent.call(this, parentName);  
    this.name = name;    
}

function inheritPrototype(Parent, Child) {
    Child.prototype = Object.create(Parent.prototype);   //ä¿®æ”¹
    Child.prototype.construtor = Child;
}

inheritPrototype(Parent, Child);

Child.prototype.sayName = function() {
    console.log(&apos;child name:&apos;, this.name);
}

var parent = new Parent(&apos;father&apos;);
parent.sayName();      // parent name: father

var child = new Child(&apos;son&apos;, &apos;father&apos;);
child.sayName();       // child name: son
</code></pre><h2 id="äº”-ES-6-ç»§æ‰¿ï¼š"><a href="#äº”-ES-6-ç»§æ‰¿ï¼š" class="headerlink" title="(äº”) ES 6 ç»§æ‰¿ï¼š"></a>(äº”) ES 6 ç»§æ‰¿ï¼š</h2><p>å½“ç„¶ï¼Œå¦‚æœä½ å­¦ä¹ è¿‡ ES 6ï¼Œé‚£ä¹ˆå†™ç»§æ‰¿å…³ç³»å°±ä¼šç‰¹åˆ«ç®€å•ï¼Œå¦‚æœä½ å­¦è¿‡ Java å°±ä¼šå‘ç°ï¼ŒES 6 ä¸­çš„ç»§æ‰¿è·Ÿ Java å¤ªåƒäº†ï¼Œä¸Šè¿°çš„ä»£ç å¯æ”¹ä¸ºï¼š</p>
<pre><code>class Parent {
    constructor(name) {
    this.name = name;
    }
    doSomething() {
    console.log(&apos;parent do something!&apos;);
    }
    sayName() {
    console.log(&apos;parent name:&apos;, this.name);
    }
}

class Child extends Parent {
    constructor(name, parentName) {
    super(parentName);
    this.name = name;
    }
    sayName() {
     console.log(&apos;child name:&apos;, this.name);
    }
}

const child = new Child(&apos;son&apos;, &apos;father&apos;);
child.sayName();            // child name: son
child.doSomething();        // parent do something!

const parent = new Parent(&apos;father&apos;);
parent.sayName();           // parent name: father
</code></pre><p>JavaScriptå‰ç«¯å¼€å‘</p>
<p>JavaScript(ES5)ä¸­æ²¡æœ‰åƒJavaé‚£æ ·ç±»çš„æ¦‚å¿µï¼Œå†™æ³•è·Ÿä¼ ç»Ÿçš„é¢å‘å¯¹è±¡è¯­è¨€ï¼ˆæ¯”å¦‚C++å’ŒJavaï¼‰å·®å¼‚å¾ˆå¤§ï¼Œå¾ˆå®¹æ˜“è®©æ–°å­¦ä¹ è¿™é—¨è¯­è¨€çš„ç¨‹åºå‘˜æ„Ÿåˆ°å›°æƒ‘ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡åŸå‹é“¾prototypeæ¥æ¨¡æ‹Ÿç±»ï¼Œå»å®ç°ç»§æ‰¿çš„ç›¸å…³åŠŸèƒ½ã€‚ä¸‹é¢æ¥çœ‹çœ‹ES5ä¸­å®ç°ç»§æ‰¿å¸¸è§çš„ä¸‰ç§æ–¹æ³•ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code>/**
 * JavaScript(ES5)ä¸­å®ç°ç»§æ‰¿çš„å‡ ç§æ–¹æ³•
 */

// å®šä¹‰åŸºç±»Person
function Person(name, age) {
  this.name = name;
  this.age = age;
}

// å…±äº«æ•°æ®
Person.prototype.LEGS_NUM = 2;

// å…±äº«æ–¹æ³•
Person.prototype.info = function () {
  console.log(&apos;My name is &apos; + this.name + &apos; .I\&apos;m &apos; + this.age + &apos; years old now&apos;);
};

Person.prototype.walk = function () {
  console.log(this.name + &apos; is walking...&apos;);
};

// Studentå­ç±»
function Student(name, age, className) {
  // è°ƒç”¨çˆ¶ç±»
  Person.call(this, name, age);
  this.className = className;
}

// 1âƒ£ï¸ æ–¹æ³•ä¸€ï¼šPerson.prototypeç›´æ¥èµ‹å€¼ç»™Student.prototype
// Student.prototype = Person.prototype;

// 2âƒ£ï¸ æ–¹æ³•äºŒï¼šStudent.prototypeä¸ºPersonçš„å®ä¾‹
// Student.prototype = new Person();

// 3âƒ£ï¸ æ–¹æ³•ä¸‰ï¼šåˆ›å»ºä¸€ä¸ªç©ºå¯¹è±¡ï¼Œå¯¹è±¡çš„åŸå‹æŒ‡å‘Person.prototypeï¼Œèµ‹å€¼ç»™Student.prototype
Student.prototype = Object.create(Person.prototype);

Student.prototype.constructor = Student;

// è¦†ç›–çˆ¶ç±»çš„infoæ–¹æ³•
Student.prototype.info = function () {
  console.log(&apos;My name is &apos; + this.name + &apos;,I\&apos;m &apos; + this.age + &apos; years old now, and from class &apos; + this.className + &apos;.&apos;);
};

// Studentç±»çš„å…±äº«æ–¹æ³•
Student.prototype.learn = function (subject) {
  console.log(this.name + &apos; is learning &apos; + subject + &apos;.&apos;);
};

// æµ‹è¯•,åˆ›å»ºä¸€ä¸ªStudentçš„å®ä¾‹
var microzz = new Student(&apos;Microzz&apos;, 22, 5);
microzz.info(); // My name is Microzz,I&apos;m 22 years old now, and from class 5.
console.log(microzz.LEGS_NUM); // 2
microzz.walk(); // Microzz is walking...
microzz.learn(&apos;JavaScript&apos;); // Microzz is learning JavaScript.
console.log(microzz.__proto__.__proto__ === Person.prototype); // true
console.log(microzz.__proto__ === Student.prototype); // true
console.log(microzz.__proto__.constructor === Student); // true
</code></pre><p>ä¸‰ç§æ–¹æ³•æ¯”è¾ƒ</p>
<p>ä¸Šé¢ä»£ç ä¸­æœ‰ä¸‰ç§æ–¹æ³•å®ç°ç»§æ‰¿ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥æ¥åˆ†æä¸€ä¸‹è¿™å‡ ç§æ–¹æ³•ã€‚<br>1âƒ£ï¸è¿™ç§æ–¹æ³•ä¸­ï¼ŒPerson.prototypeç›´æ¥èµ‹å€¼ç»™Student.prototypeï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªå¾ˆä¸¥é‡çš„é—®é¢˜ï¼Œå¦‚æœå­ç±»prototypeæ·»åŠ æ–°çš„ä¸œè¥¿çš„è¯ä¹Ÿä¼šæ”¹å†™çˆ¶ç±»ã€‚æ‰€ä»¥è¿™ç§æ–¹æ³•ä¸æ¨èã€‚<br>2âƒ£ï¸ç¬¬äºŒç§æ–¹æ³•Student.prototypeä¸ºPersonçš„å®ä¾‹ï¼Œè¿™ä¹Ÿæ˜¯å¯ä»¥å®ç°çš„ã€‚ä½†æ˜¯Personæ„é€ å‡½æ•°æœ‰å‚æ•°åº”è¯¥ä¼ ä»€ä¹ˆå‘¢ï¼Ÿä¼ ä»»ä½•ä¸€ä¸ªéƒ½æ˜¯å¾ˆå¥‡æ€ªçš„ã€‚æ‰€ä»¥ä¹Ÿä¸æ¨èã€‚<br>3âƒ£ï¸ç¬¬ä¸‰ç§æ–¹æ³•æ˜¯æ¯”è¾ƒç†æƒ³çš„ï¼Œåˆ›å»ºä¸€ä¸ªç©ºå¯¹è±¡ï¼Œå¯¹è±¡çš„åŸå‹æŒ‡å‘Person.prototypeï¼Œèµ‹å€¼ç»™Student.prototypeã€‚ä½†æ˜¯Object.createä¹Ÿæœ‰ä¸€ç‚¹å°ç‘•ç–µï¼Œå› ä¸ºå®ƒæ˜¯ES5ä¹‹åæ‰æ”¯æŒçš„ï¼Œä¸è¿‡æˆ‘ä»¬å¯ä»¥é€šè¿‡æ¨¡æ‹Ÿå®ç°Object.createæ–¹æ³•ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code>if (!Object.create) {
  Object.prototype.create = function (proto) {
    function F() {}
    F.prototype = proto;
    return new F;
  }
}
</code></pre><p>è¿™æ ·åœ¨ES5ä¸­å°±å®Œç¾å®ç°äº†ç»§æ‰¿ğŸ˜„</p>
<h2 id="ES6ä¸­çš„å®ç°"><a href="#ES6ä¸­çš„å®ç°" class="headerlink" title="ES6ä¸­çš„å®ç°"></a>ES6ä¸­çš„å®ç°</h2><p>æ¦‚è¿°</p>
<p>ES6æä¾›äº†æ›´æ¥è¿‘ä¼ ç»Ÿè¯­è¨€â€ç±»â€çš„å†™æ³•ï¼Œå¼•å…¥äº†Classï¼ˆç±»ï¼‰è¿™ä¸ªæ¦‚å¿µï¼Œä½œä¸ºå¯¹è±¡çš„æ¨¡æ¿ã€‚é€šè¿‡classå…³é”®å­—ï¼Œå¯ä»¥å®šä¹‰ç±»ã€‚åŸºæœ¬ä¸Šï¼ŒES6çš„classå¯ä»¥çœ‹ä½œåªæ˜¯ä¸€ä¸ªè¯­æ³•ç³–ï¼Œå®ƒçš„ç»å¤§éƒ¨åˆ†åŠŸèƒ½ï¼ŒES5éƒ½å¯ä»¥åšåˆ°ï¼Œæ–°çš„classå†™æ³•åªæ˜¯è®©å¯¹è±¡åŸå‹çš„å†™æ³•æ›´åŠ æ¸…æ™°ã€æ›´åƒé¢å‘å¯¹è±¡ç¼–ç¨‹çš„è¯­æ³•è€Œå·²ã€‚ä¸‹é¢æˆ‘ä»¬ç”¨ES6çš„è¯­æ³•å®ç°ç±»çš„ç»§æ‰¿ã€‚</p>
<p>ä»£ç </p>
<pre><code>// åŸºç±» Person
class Person {
  // çˆ¶ç±»çš„æ„é€ æ–¹æ³•
  constructor(name, age) {
    this.name = name;
    this.age = age;
    // å…±äº«å˜é‡
    this.LEGS_NUM = 2;
  }
  // çˆ¶ç±»çš„infoæ–¹æ³•
  info() {
    console.log(`My name is ${this.name}, I\&apos;m ${this.age} years old now.`);
  }

  // çˆ¶ç±»çš„walkæ–¹æ³•
  walk() {
    console.log(this.name + &apos; is walking...&apos;);
  }

}

// å­ç±» Student
class Student extends Person {
  constructor(name, age, className) {
    // è°ƒç”¨åŸºç±»çš„æ„é€ æ–¹æ³•
    super(name, age);
    this.className = className;
  }

  // è¦†ç›–çˆ¶ç±»çš„infoæ–¹æ³•
  info() {
    console.log(`My name is ${this.name}, I\&apos;m ${this.age} years old, and from class ${this.className}.`);
  }
}

// å®ä¾‹åŒ–ä¸€ä¸ªStudentçš„å®ä¾‹
let stu = new Student(&apos;Zhaohui&apos;, 22, 5);
stu.info(); // My name is Zhaohui, I&apos;m 22 years old, and from class 5.
stu.walk(); // Zhaohui is walking...
console.log(stu.LEGS_NUM); // 2
console.log(stu instanceof Student); // true
console.log(stu instanceof Person); // true
</code></pre><p>è¿™æ ·æˆ‘ä»¬å°±é€šè¿‡ES6ä¸­çš„classå®ç°äº†â€œç±»â€çš„ç»§æ‰¿äº†ğŸ˜„</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/08/KOA2æ¡†æ¶åŸç†è§£æå’Œå®ç°/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/08/KOA2æ¡†æ¶åŸç†è§£æå’Œå®ç°/" itemprop="url">KOA2æ¡†æ¶åŸç†è§£æå’Œå®ç°</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-01-08T20:08:28+08:00">
                2018-01-08
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="ä»€ä¹ˆæ˜¯koaæ¡†æ¶ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯koaæ¡†æ¶ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯koaæ¡†æ¶ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯koaæ¡†æ¶ï¼Ÿ</h3><p>koaæ˜¯ä¸€ä¸ªåŸºäºnodeå®ç°çš„ä¸€ä¸ªæ–°çš„webæ¡†æ¶ï¼Œå®ƒæ˜¯ç”±expressæ¡†æ¶çš„åŸç­äººé©¬æ‰“é€ çš„ã€‚å®ƒçš„ç‰¹ç‚¹æ˜¯ä¼˜é›…ã€ç®€æ´ã€è¡¨è¾¾åŠ›å¼ºã€è‡ªç”±åº¦é«˜ã€‚å®ƒæ›´expressç›¸æ¯”ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ›´è½»é‡çš„nodeæ¡†æ¶ï¼Œå› ä¸ºå®ƒæ‰€æœ‰åŠŸèƒ½éƒ½é€šè¿‡æ’ä»¶å®ç°ï¼Œè¿™ç§æ’æ‹”å¼çš„æ¶æ„è®¾è®¡æ¨¡å¼ï¼Œå¾ˆç¬¦åˆunixå“²å­¦ã€‚</p>
<p>koaæ¡†æ¶ç°åœ¨æ›´æ–°åˆ°äº†2.xç‰ˆæœ¬ï¼Œæœ¬æ–‡ä»é›¶å¼€å§‹ï¼Œå¾ªåºæ¸è¿›ï¼Œè®²è§£koa2çš„æ¡†æ¶æºç ç»“æ„å’Œå®ç°åŸç†ï¼Œå±•ç¤ºå’Œè¯¦è§£koa2æ¡†æ¶æºç ä¸­çš„å‡ ä¸ªæœ€é‡è¦çš„æ¦‚å¿µï¼Œç„¶åæ‰‹æŠŠæ‰‹æ•™å¤§å®¶äº²è‡ªå®ç°ä¸€ä¸ªç®€æ˜“çš„koa2æ¡†æ¶ï¼Œå¸®åŠ©å¤§å®¶å­¦ä¹ å’Œæ›´æ·±å±‚æ¬¡çš„ç†è§£koa2ï¼Œçœ‹å®Œæœ¬æ–‡ä»¥åï¼Œå†å»å¯¹ç…§koa2çš„æºç è¿›è¡ŒæŸ¥çœ‹ï¼Œç›¸ä¿¡ä½ çš„æ€è·¯å°†ä¼šéå¸¸çš„é¡ºç•…ã€‚</p>
<p>æœ¬æ–‡æ‰€ç”¨çš„æ¡†æ¶æ˜¯koa2ï¼Œå®ƒè·Ÿkoa1ä¸åŒï¼Œkoa1ä½¿ç”¨çš„æ˜¯generator+co.jsçš„æ‰§è¡Œæ–¹å¼ï¼Œè€Œkoa2ä¸­ä½¿ç”¨äº†async/awaitï¼Œå› æ­¤æœ¬æ–‡çš„ä»£ç å’Œdemoéœ€è¦è¿è¡Œåœ¨node 8ç‰ˆæœ¬åŠå…¶ä»¥ä¸Šï¼Œå¦‚æœè¯»è€…çš„nodeç‰ˆæœ¬è¾ƒä½ï¼Œå»ºè®®å‡çº§æˆ–è€…å®‰è£…babel-cliï¼Œç”¨å…¶ä¸­çš„babel-nodeæ¥è¿è¡Œæœ¬æ–‡æ¶‰åŠåˆ°çš„ä»£ç ã€‚</p>
<h3 id="koaæºç ç»“æ„"><a href="#koaæºç ç»“æ„" class="headerlink" title="koaæºç ç»“æ„"></a>koaæºç ç»“æ„</h3><p><img src="/2018/01/08/KOA2æ¡†æ¶åŸç†è§£æå’Œå®ç°/166f12b8563436a3.webp" alt=""><br>ä¸Šå›¾æ˜¯koa2çš„æºç ç›®å½•ç»“æ„çš„libæ–‡ä»¶å¤¹ï¼Œlibæ–‡ä»¶å¤¹ä¸‹æ”¾ç€å››ä¸ªkoa2çš„æ ¸å¿ƒæ–‡ä»¶ï¼šapplication.jsã€context.jsã€request.jsã€response.jsã€‚</p>
<h4 id="application-js"><a href="#application-js" class="headerlink" title="application.js"></a>application.js</h4><p>application.jsæ˜¯koaçš„å…¥å£æ–‡ä»¶ï¼Œå®ƒå‘å¤–å¯¼å‡ºäº†åˆ›å»ºclasså®ä¾‹çš„æ„é€ å‡½æ•°ï¼Œå®ƒç»§æ‰¿äº†eventsï¼Œè¿™æ ·å°±ä¼šèµ‹äºˆæ¡†æ¶äº‹ä»¶ç›‘å¬å’Œäº‹ä»¶è§¦å‘çš„èƒ½åŠ›ã€‚applicationè¿˜æš´éœ²äº†ä¸€äº›å¸¸ç”¨çš„apiï¼Œæ¯”å¦‚toJSONã€listenã€useç­‰ç­‰ã€‚</p>
<p>listençš„å®ç°åŸç†å…¶å®å°±æ˜¯å¯¹http.createServerè¿›è¡Œäº†ä¸€ä¸ªå°è£…ï¼Œé‡ç‚¹æ˜¯è¿™ä¸ªå‡½æ•°ä¸­ä¼ å…¥çš„callbackï¼Œå®ƒé‡Œé¢åŒ…å«äº†ä¸­é—´ä»¶çš„åˆå¹¶ï¼Œä¸Šä¸‹æ–‡çš„å¤„ç†ï¼Œå¯¹resçš„ç‰¹æ®Šå¤„ç†ã€‚</p>
<p>useæ˜¯æ”¶é›†ä¸­é—´ä»¶ï¼Œå°†å¤šä¸ªä¸­é—´ä»¶æ”¾å…¥ä¸€ä¸ªç¼“å­˜é˜Ÿåˆ—ä¸­ï¼Œç„¶åé€šè¿‡koa-composeè¿™ä¸ªæ’ä»¶è¿›è¡Œé€’å½’ç»„åˆè°ƒç”¨è¿™ä¸€äº›åˆ—çš„ä¸­é—´ä»¶ã€‚</p>
<h4 id="context-js"><a href="#context-js" class="headerlink" title="context.js"></a>context.js</h4><p>è¿™éƒ¨åˆ†å°±æ˜¯koaçš„åº”ç”¨ä¸Šä¸‹æ–‡ctx,å…¶å®å°±ä¸€ä¸ªç®€å•çš„å¯¹è±¡æš´éœ²ï¼Œé‡Œé¢çš„é‡ç‚¹åœ¨delegateï¼Œè¿™ä¸ªå°±æ˜¯ä»£ç†ï¼Œè¿™ä¸ªå°±æ˜¯ä¸ºäº†å¼€å‘è€…æ–¹ä¾¿è€Œè®¾è®¡çš„ï¼Œæ¯”å¦‚æˆ‘ä»¬è¦è®¿é—®ctx.repsponse.statusä½†æ˜¯æˆ‘ä»¬é€šè¿‡delegateï¼Œå¯ä»¥ç›´æ¥è®¿é—®ctx.statusè®¿é—®åˆ°å®ƒã€‚</p>
<h4 id="request-jsã€response-js"><a href="#request-jsã€response-js" class="headerlink" title="request.jsã€response.js"></a>request.jsã€response.js</h4><p>è¿™ä¸¤éƒ¨åˆ†å°±æ˜¯å¯¹åŸç”Ÿçš„resã€reqçš„ä¸€äº›æ“ä½œäº†ï¼Œå¤§é‡ä½¿ç”¨es6çš„getå’Œsetçš„ä¸€äº›è¯­æ³•ï¼Œå»å–headersæˆ–è€…è®¾ç½®headersã€è¿˜æœ‰è®¾ç½®bodyç­‰ç­‰ï¼Œè¿™äº›å°±ä¸è¯¦ç»†ä»‹ç»äº†ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥è‡ªè¡Œçœ‹æºç ã€‚</p>
<h3 id="å®ç°koa2çš„å››å¤§æ¨¡å—"><a href="#å®ç°koa2çš„å››å¤§æ¨¡å—" class="headerlink" title="å®ç°koa2çš„å››å¤§æ¨¡å—"></a>å®ç°koa2çš„å››å¤§æ¨¡å—</h3><p>ä¸Šæ–‡ç®€è¿°äº†koa2æºç çš„å¤§ä½“æ¡†æ¶ç»“æ„ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥å®ç°ä¸€ä¸ªkoa2çš„æ¡†æ¶ï¼Œç¬”è€…è®¤ä¸ºç†è§£å’Œå®ç°ä¸€ä¸ªkoaæ¡†æ¶éœ€è¦å®ç°å››ä¸ªå¤§æ¨¡å—ï¼Œåˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li><p>å°è£…node http serverã€åˆ›å»ºKoaç±»æ„é€ å‡½æ•°</p>
</li>
<li><p>æ„é€ requestã€responseã€contextå¯¹è±¡</p>
</li>
<li><p>ä¸­é—´ä»¶æœºåˆ¶å’Œå‰¥æ´‹è‘±æ¨¡å‹çš„å®ç°</p>
</li>
<li><p>é”™è¯¯æ•è·å’Œé”™è¯¯å¤„ç†</p>
</li>
</ul>
<p>ä¸‹é¢æˆ‘ä»¬å°±é€ä¸€åˆ†æå’Œå®ç°ã€‚</p>
<h4 id="æ¨¡å—ä¸€ï¼šå°è£…node-http-serverå’Œåˆ›å»ºKoaç±»æ„é€ å‡½æ•°"><a href="#æ¨¡å—ä¸€ï¼šå°è£…node-http-serverå’Œåˆ›å»ºKoaç±»æ„é€ å‡½æ•°" class="headerlink" title="æ¨¡å—ä¸€ï¼šå°è£…node http serverå’Œåˆ›å»ºKoaç±»æ„é€ å‡½æ•°"></a>æ¨¡å—ä¸€ï¼šå°è£…node http serverå’Œåˆ›å»ºKoaç±»æ„é€ å‡½æ•°</h4><p>é˜…è¯»koa2çš„æºç å¾—çŸ¥ï¼Œå®ç°koaçš„æœåŠ¡å™¨åº”ç”¨å’Œç«¯å£ç›‘å¬ï¼Œå…¶å®å°±æ˜¯åŸºäºnodeçš„åŸç”Ÿä»£ç è¿›è¡Œäº†å°è£…ï¼Œå¦‚ä¸‹å›¾çš„ä»£ç å°±æ˜¯é€šè¿‡nodeåŸç”Ÿä»£ç å®ç°çš„æœåŠ¡å™¨ç›‘å¬ã€‚</p>
<pre><code>let http = require(&apos;http&apos;);
let server = http.createServer((req, res) =&gt; {
    res.writeHead(200);
    res.end(&apos;hello world&apos;);
});
server.listen(3000, () =&gt; {    
    console.log(&apos;listenning on 3000&apos;);
});
</code></pre><p>æˆ‘ä»¬éœ€è¦å°†ä¸Šé¢çš„nodeåŸç”Ÿä»£ç å°è£…å®ç°æˆkoaçš„æ¨¡å¼ï¼š</p>
<pre><code>const http = require(&apos;http&apos;);
const Koa = require(&apos;koa&apos;);
const app = new Koa();
app.listen(3000);
</code></pre><p>å®ç°koaçš„ç¬¬ä¸€æ­¥å°±æ˜¯å¯¹ä»¥ä¸Šçš„è¿™ä¸ªè¿‡ç¨‹è¿›è¡Œå°è£…ï¼Œä¸ºæ­¤æˆ‘ä»¬éœ€è¦åˆ›å»ºapplication.jså®ç°ä¸€ä¸ªApplicationç±»çš„æ„é€ å‡½æ•°ï¼š</p>
<pre><code>let http = require(&apos;http&apos;);
class Application{    
    constructor() {        
        this.callbackFunc;
    }
    listen(port) {        
        let server = http.createServer(this.callback());
        server.listen(port);
    }
    use(fn) {
        this.callbackFunc = fn;
    }
    callback() {
        return(req, res) =&gt; {
            this.callbackFunc(req, res);
        };
    }
}
module.exports = Application;
</code></pre><p>ç„¶ååˆ›å»ºexample.jsï¼Œå¼•å…¥application.jsï¼Œè¿è¡ŒæœåŠ¡å™¨å®ä¾‹å¯åŠ¨ç›‘å¬ä»£ç ï¼š</p>
<pre><code>let Koa = require(&apos;./application&apos;);
let app = new Koa();
app.use((req, res) =&gt; {
    res.writeHead(200);
    res.end(&apos;hello world&apos;);
});
app.listen(3000, () =&gt; {
    console.log(&apos;listening on 3000&apos;);
});
</code></pre><p>ç°åœ¨åœ¨æµè§ˆå™¨è¾“å…¥localhost:3000å³å¯çœ‹åˆ°æµè§ˆå™¨é‡Œæ˜¾ç¤ºâ€œhello worldâ€ã€‚ç°åœ¨ç¬¬ä¸€æ­¥æˆ‘ä»¬å·²ç»å®Œæˆäº†ï¼Œå¯¹http serverè¿›è¡Œäº†ç®€å•çš„å°è£…å’Œåˆ›å»ºäº†ä¸€ä¸ªå¯ä»¥ç”Ÿæˆkoaå®ä¾‹çš„ç±»classï¼Œè¿™ä¸ªç±»é‡Œè¿˜å®ç°äº†app.useç”¨æ¥æ³¨å†Œä¸­é—´ä»¶å’Œæ³¨å†Œå›è°ƒå‡½æ•°ï¼Œapp.listenç”¨æ¥å¼€å¯æœåŠ¡å™¨å®ä¾‹å¹¶ä¼ å…¥callbackå›è°ƒå‡½æ•°ï¼Œç¬¬ä¸€æ¨¡å—ä¸»è¦æ˜¯å®ç°å…¸å‹çš„koaé£æ ¼å’Œæ­å¥½äº†ä¸€ä¸ªkoaçš„ç®€å•çš„æ¶å­ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹ç¼–å†™å’Œè®²è§£ç¬¬äºŒæ¨¡å—ã€‚</p>
<h5 id="æ¨¡å—äºŒï¼šæ„é€ requestã€responseã€contextå¯¹è±¡"><a href="#æ¨¡å—äºŒï¼šæ„é€ requestã€responseã€contextå¯¹è±¡" class="headerlink" title="æ¨¡å—äºŒï¼šæ„é€ requestã€responseã€contextå¯¹è±¡"></a>æ¨¡å—äºŒï¼šæ„é€ requestã€responseã€contextå¯¹è±¡</h5><p>é˜…è¯»koa2çš„æºç å¾—çŸ¥ï¼Œå…¶ä¸­context.jsã€request.jsã€response.jsä¸‰ä¸ªæ–‡ä»¶åˆ†åˆ«æ˜¯requestã€responseã€contextä¸‰ä¸ªæ¨¡å—çš„ä»£ç æ–‡ä»¶ã€‚contextå°±æ˜¯æˆ‘ä»¬å¹³æ—¶å†™koaä»£ç æ—¶çš„ctxï¼Œå®ƒç›¸å½“äºä¸€ä¸ªå…¨å±€çš„koaå®ä¾‹ä¸Šä¸‹æ–‡thisï¼Œå®ƒè¿æ¥äº†requestã€responseä¸¤ä¸ªåŠŸèƒ½æ¨¡å—ï¼Œå¹¶ä¸”æš´éœ²ç»™koaçš„å®ä¾‹å’Œä¸­é—´ä»¶ç­‰å›è°ƒå‡½æ•°çš„å‚æ•°ä¸­ï¼Œèµ·åˆ°æ‰¿ä¸Šå¯ä¸‹çš„ä½œç”¨ã€‚</p>
<p>requestã€responseä¸¤ä¸ªåŠŸèƒ½æ¨¡å—åˆ†åˆ«å¯¹nodeçš„åŸç”Ÿrequestã€responseè¿›è¡Œäº†ä¸€ä¸ªåŠŸèƒ½çš„å°è£…ï¼Œä½¿ç”¨äº†getterå’Œsetterå±æ€§ï¼ŒåŸºäºnodeçš„å¯¹è±¡req/reså¯¹è±¡å°è£…koaçš„request/responseå¯¹è±¡ã€‚æˆ‘ä»¬åŸºäºè¿™ä¸ªåŸç†ç®€å•å®ç°ä¸€ä¸‹request.jsã€response.jsï¼Œé¦–å…ˆåˆ›å»ºrequest.jsæ–‡ä»¶ï¼Œç„¶åå†™å…¥ä»¥ä¸‹ä»£ç ï¼š</p>
<pre><code>let url = require(&apos;url&apos;);
module.exports = {
    get query() {
        return url.parse(this.req.url, true).query;
    }
};
</code></pre><p>è¿™æ ·å½“ä½ åœ¨koaå®ä¾‹é‡Œä½¿ç”¨ctx.queryçš„æ—¶å€™ï¼Œå°±ä¼šè¿”å›url.parse(this.req.url, true).queryçš„å€¼ã€‚çœ‹æºç å¯çŸ¥ï¼ŒåŸºäºgetterå’Œsetterï¼Œåœ¨request.jsé‡Œè¿˜å°è£…äº†headerã€urlã€originã€pathç­‰æ–¹æ³•ï¼Œéƒ½æ˜¯å¯¹åŸç”Ÿçš„requestä¸Šç”¨getterå’Œsetterè¿›è¡Œäº†å°è£…ï¼Œç¬”è€…ä¸å†è¿™é‡Œä¸€ä¸€å®ç°ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å®ç°response.jsæ–‡ä»¶ä»£ç æ¨¡å—ï¼Œå®ƒå’ŒrequeståŸç†ä¸€æ ·ï¼Œä¹Ÿæ˜¯åŸºäºgetterå’Œsetterå¯¹åŸç”Ÿresponseè¿›è¡Œäº†å°è£…ï¼Œé‚£æˆ‘ä»¬æ¥ä¸‹æ¥é€šè¿‡å¯¹å¸¸ç”¨çš„ctx.bodyå’Œctx.statusè¿™ä¸ªä¸¤ä¸ªè¯­å¥å½“åšä¾‹å­ç®€è¿°ä¸€ä¸‹å¦‚æœå®ç°koaçš„responseçš„æ¨¡å—ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºå¥½response.jsæ–‡ä»¶ï¼Œç„¶åè¾“å…¥ä¸‹é¢çš„ä»£ç ï¼š</p>
<pre><code>module.exports = {
    get body() {
        returnthis._body;
    },
    set body(data) {
        this._body = data;
    },
    get status() {
        returnthis.res.statusCode;
    },
    set status(statusCode) {
        if (typeof statusCode !== &apos;number&apos;) {
            thrownewError(&apos;something wrong!&apos;);
        }
        this.res.statusCode = statusCode;
    }
};
</code></pre><p>ä»¥ä¸Šä»£ç å®ç°äº†å¯¹koaçš„statusçš„è¯»å–å’Œè®¾ç½®ï¼Œè¯»å–çš„æ—¶å€™è¿”å›çš„æ˜¯åŸºäºåŸç”Ÿçš„responseå¯¹è±¡çš„statusCodeå±æ€§ï¼Œè€Œbodyçš„è¯»å–åˆ™æ˜¯å¯¹this._bodyè¿›è¡Œè¯»å†™å’Œæ“ä½œã€‚è¿™é‡Œå¯¹bodyè¿›è¡Œæ“ä½œå¹¶æ²¡æœ‰ä½¿ç”¨åŸç”Ÿçš„this.res.endï¼Œå› ä¸ºåœ¨æˆ‘ä»¬ç¼–å†™koaä»£ç çš„æ—¶å€™ï¼Œä¼šå¯¹bodyè¿›è¡Œå¤šæ¬¡çš„è¯»å–å’Œä¿®æ”¹ï¼Œæ‰€ä»¥çœŸæ­£è¿”å›æµè§ˆå™¨ä¿¡æ¯çš„æ“ä½œæ˜¯åœ¨application.jsé‡Œè¿›è¡Œå°è£…å’Œæ“ä½œã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬å·²ç»å®ç°äº†request.jsã€response.jsï¼Œè·å–åˆ°äº†requestã€responseå¯¹è±¡å’Œä»–ä»¬çš„å°è£…çš„æ–¹æ³•ï¼Œç„¶åæˆ‘ä»¬å¼€å§‹å®ç°context.jsï¼Œcontextçš„ä½œç”¨å°±æ˜¯å°†requestã€responseå¯¹è±¡æŒ‚è½½åˆ°ctxçš„ä¸Šé¢ï¼Œè®©koaå®ä¾‹å’Œä»£ç èƒ½æ–¹ä¾¿çš„ä½¿ç”¨åˆ°requestã€responseå¯¹è±¡ä¸­çš„æ–¹æ³•ã€‚ç°åœ¨æˆ‘ä»¬åˆ›å»ºcontext.jsæ–‡ä»¶ï¼Œè¾“å…¥å¦‚ä¸‹ä»£ç ï¼š</p>
<pre><code>let proto = {};

function delegateSet(property, name) {
    proto.__defineSetter__(name, function (val) {
        this[property][name] = val;
    });
}

function delegateGet(property, name) {
    proto.__defineGetter__(name, function () {
        returnthis[property][name];
    });
}

let requestSet = [];
let requestGet = [&apos;query&apos;];

let responseSet = [&apos;body&apos;, &apos;status&apos;];
let responseGet = responseSet;

requestSet.forEach(ele =&gt; {
    delegateSet(&apos;request&apos;, ele);
});

requestGet.forEach(ele =&gt; {
    delegateGet(&apos;request&apos;, ele);
});

responseSet.forEach(ele =&gt; {
    delegateSet(&apos;response&apos;, ele);
});

responseGet.forEach(ele =&gt; {
    delegateGet(&apos;response&apos;, ele);
});

module.exports = proto;
</code></pre><p>context.jsæ–‡ä»¶ä¸»è¦æ˜¯å¯¹å¸¸ç”¨çš„requestå’Œresponseæ–¹æ³•è¿›è¡ŒæŒ‚è½½å’Œä»£ç†ï¼Œé€šè¿‡context.queryç›´æ¥ä»£ç†äº†context.request.queryï¼Œcontext.bodyå’Œcontext.statusä»£ç†äº†context.response.bodyä¸context.response.statusã€‚è€Œcontext.requestï¼Œcontext.responseåˆ™ä¼šåœ¨application.jsä¸­æŒ‚è½½</p>
<p>æœ¬æ¥å¯ä»¥ç”¨ç®€å•çš„setterå’Œgetterå»è®¾ç½®æ¯ä¸€ä¸ªæ–¹æ³•ï¼Œä½†æ˜¯ç”±äºcontextå¯¹è±¡å®šä¹‰æ–¹æ³•æ¯”è¾ƒç®€å•å’Œè§„èŒƒï¼Œåœ¨koaæºç é‡Œå¯ä»¥çœ‹åˆ°ï¼Œkoaæºç ç”¨çš„æ˜¯<strong>defineSetter</strong>å’Œ<strong>defineSetter</strong>æ¥ä»£æ›¿setter/getteræ¯ä¸€ä¸ªå±æ€§çš„è¯»å–è®¾ç½®ï¼Œè¿™æ ·åšä¸»è¦æ˜¯æ–¹ä¾¿æ‹“å±•å’Œç²¾ç®€äº†å†™æ³•ï¼Œå½“æˆ‘ä»¬éœ€è¦ä»£ç†æ›´å¤šçš„reså’Œreqçš„æ–¹æ³•çš„æ—¶å€™ï¼Œå¯ä»¥å‘context.jsæ–‡ä»¶é‡Œé¢çš„æ•°ç»„å¯¹è±¡é‡Œé¢æ·»åŠ å¯¹åº”çš„æ–¹æ³•åå’Œå±æ€§åå³å¯ã€‚</p>
<p>ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»å¾—åˆ°äº†requestã€responseã€contextä¸‰ä¸ªæ¨¡å—å¯¹è±¡äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å°†requestã€responseæ‰€æœ‰æ–¹æ³•æŒ‚è½½åˆ°contextä¸‹ï¼Œè®©contextå®ç°å®ƒçš„æ‰¿ä¸Šå¯ä¸‹çš„ä½œç”¨ï¼Œä¿®æ”¹application.jsæ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p>
<pre><code>let http = require(&apos;http&apos;);
let context = require(&apos;./context&apos;);
let request = require(&apos;./request&apos;);
let response = require(&apos;./response&apos;);

createContext(req, res) {       
   let ctx = Object.create(this.context);
   ctx.request = Object.create(this.request);
   ctx.response = Object.create(this.response);
   ctx.req = ctx.request.req = req;
   ctx.res = ctx.response.res = res; 
   return ctx;
}
</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬æ·»åŠ äº†createContextè¿™ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯å…³é”®ï¼Œå®ƒé€šè¿‡Object.createåˆ›å»ºäº†ctxï¼Œå¹¶å°†requestå’ŒresponseæŒ‚è½½åˆ°äº†ctxä¸Šé¢ï¼Œå°†åŸç”Ÿçš„reqå’ŒresæŒ‚è½½åˆ°äº†ctxçš„å­å±æ€§ä¸Šï¼Œå¾€å›çœ‹ä¸€ä¸‹context/request/response.jsæ–‡ä»¶ï¼Œå°±èƒ½çŸ¥é“å½“æ—¶ä½¿ç”¨çš„this.resæˆ–è€…this.responseä¹‹ç±»çš„æ˜¯ä»å“ªé‡Œæ¥çš„äº†ï¼ŒåŸæ¥æ˜¯åœ¨è¿™ä¸ªcreateContextæ–¹æ³•ä¸­æŒ‚è½½åˆ°äº†å¯¹åº”çš„å®ä¾‹ä¸Šï¼Œæ„å»ºäº†è¿è¡Œæ—¶ä¸Šä¸‹æ–‡ctxä¹‹åï¼Œæˆ‘ä»¬çš„app.useå›è°ƒå‡½æ•°å‚æ•°å°±éƒ½åŸºäºctxäº†ã€‚</p>
<h4 id="æ¨¡å—ä¸‰ï¼šä¸­é—´ä»¶æœºåˆ¶å’Œå‰¥æ´‹è‘±æ¨¡å‹çš„å®ç°"><a href="#æ¨¡å—ä¸‰ï¼šä¸­é—´ä»¶æœºåˆ¶å’Œå‰¥æ´‹è‘±æ¨¡å‹çš„å®ç°" class="headerlink" title="æ¨¡å—ä¸‰ï¼šä¸­é—´ä»¶æœºåˆ¶å’Œå‰¥æ´‹è‘±æ¨¡å‹çš„å®ç°"></a>æ¨¡å—ä¸‰ï¼šä¸­é—´ä»¶æœºåˆ¶å’Œå‰¥æ´‹è‘±æ¨¡å‹çš„å®ç°</h4><p>ç›®å‰ä¸ºæ­¢æˆ‘ä»¬å·²ç»æˆåŠŸå®ç°äº†ä¸Šä¸‹æ–‡contextå¯¹è±¡ã€ è¯·æ±‚requestå¯¹è±¡å’Œå“åº”responseå¯¹è±¡æ¨¡å—ï¼Œè¿˜å·®ä¸€ä¸ªæœ€é‡è¦çš„æ¨¡å—ï¼Œå°±æ˜¯koaçš„ä¸­é—´ä»¶æ¨¡å—ï¼Œkoaçš„ä¸­é—´ä»¶æœºåˆ¶æ˜¯ä¸€ä¸ªå‰¥æ´‹è‘±å¼çš„æ¨¡å‹ï¼Œå¤šä¸ªä¸­é—´ä»¶é€šè¿‡useæ”¾è¿›ä¸€ä¸ªæ•°ç»„é˜Ÿåˆ—ç„¶åä»å¤–å±‚å¼€å§‹æ‰§è¡Œï¼Œé‡åˆ°nextåè¿›å…¥é˜Ÿåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ï¼Œæ‰€æœ‰ä¸­é—´ä»¶æ‰§è¡Œå®Œåå¼€å§‹å›å¸§ï¼Œæ‰§è¡Œé˜Ÿåˆ—ä¸­ä¹‹å‰ä¸­é—´ä»¶ä¸­æœªæ‰§è¡Œçš„ä»£ç éƒ¨åˆ†ï¼Œè¿™å°±æ˜¯å‰¥æ´‹è‘±æ¨¡å‹ï¼Œkoaçš„ä¸­é—´ä»¶æœºåˆ¶ã€‚</p>
<p>koaçš„å‰¥æ´‹è‘±æ¨¡å‹åœ¨koa1ä¸­ä½¿ç”¨çš„æ˜¯generator + co.jså»å®ç°çš„ï¼Œkoa2åˆ™ä½¿ç”¨äº†async/await + Promiseå»å®ç°çš„ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬åŸºäºasync/await + Promiseå»å®ç°koa2ä¸­çš„ä¸­é—´ä»¶æœºåˆ¶ã€‚é¦–å…ˆï¼Œå‡è®¾å½“koaçš„ä¸­é—´ä»¶æœºåˆ¶å·²ç»åšå¥½äº†ï¼Œé‚£ä¹ˆå®ƒæ˜¯èƒ½æˆåŠŸè¿è¡Œä¸‹é¢ä»£ç çš„ï¼š</p>
<pre><code>let Koa = require(&apos;../src/application&apos;);

let app = new Koa();

app.use(async (ctx, next) =&gt; {
    console.log(1);
    await next();
    console.log(6);
});

app.use(async (ctx, next) =&gt; {
    console.log(2);
    await next();
    console.log(5);
});

app.use(async (ctx, next) =&gt; {
    console.log(3);
    ctx.body = &quot;hello world&quot;;
    console.log(4);
});

app.listen(3000, () =&gt; {
    console.log(&apos;listenning on 3000&apos;);
});
</code></pre><p>è¿è¡ŒæˆåŠŸåä¼šåœ¨ç»ˆç«¯è¾“å‡º123456ï¼Œé‚£å°±èƒ½éªŒè¯æˆ‘ä»¬çš„koaçš„å‰¥æ´‹è‘±æ¨¡å‹æ˜¯æ­£ç¡®çš„ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹å®ç°ï¼Œä¿®æ”¹application.jsæ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p>
<pre><code>compose() {
    return async ctx =&gt; {
        function createNext(middleware, oldNext) {
            return async () =&gt; {
                await middleware(ctx, oldNext);
            }
        }
        let len = this.middlewares.length;
        let next = async () =&gt; {
            return Promise.resolve();
        };
        for (let i = len - 1; i &gt;= 0; i--) {
            let currentMiddleware = this.middlewares[i];
            next = createNext(currentMiddleware, next);
        }
        await next();
    };
}

callback() {
    return(req, res) =&gt; {
        let ctx = this.createContext(req, res);
        let respond = () =&gt;this.responseBody(ctx);
        let onerror = (err) =&gt;this.onerror(err, ctx);
        let fn = this.compose();
        return fn(ctx);
    };
}
</code></pre><p>koaé€šè¿‡useå‡½æ•°ï¼ŒæŠŠæ‰€æœ‰çš„ä¸­é—´ä»¶pushåˆ°ä¸€ä¸ªå†…éƒ¨æ•°ç»„é˜Ÿåˆ—this.middlewaresä¸­ï¼Œå‰¥æ´‹è‘±æ¨¡å‹èƒ½è®©æ‰€æœ‰çš„ä¸­é—´ä»¶ä¾æ¬¡æ‰§è¡Œï¼Œæ¯æ¬¡æ‰§è¡Œå®Œä¸€ä¸ªä¸­é—´ä»¶ï¼Œé‡åˆ°next()å°±ä¼šå°†æ§åˆ¶æƒä¼ é€’åˆ°ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ï¼Œä¸‹ä¸€ä¸ªä¸­é—´ä»¶çš„nextå‚æ•°ï¼Œå‰¥æ´‹è‘±æ¨¡å‹çš„æœ€å…³é”®ä»£ç æ˜¯composeè¿™ä¸ªå‡½æ•°ï¼š</p>
<pre><code>compose() {
        return async ctx =&gt; {
            function createNext(middleware, oldNext) {
                returnasync () =&gt; {
                    await middleware(ctx, oldNext);
                }
            }
            let len = this.middlewares.length;
            let next = async () =&gt; {
                return Promise.resolve();
            };
            for (let i = len - 1; i &gt;= 0; i--) {
                let currentMiddleware = this.middlewares[i];
                next = createNext(currentMiddleware, next);
            }
            await next();
        };
    }
</code></pre><p>createNextå‡½æ•°çš„ä½œç”¨å°±æ˜¯å°†ä¸Šä¸€ä¸ªä¸­é—´ä»¶çš„nextå½“åšå‚æ•°ä¼ ç»™ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ï¼Œå¹¶ä¸”å°†ä¸Šä¸‹æ–‡ctxç»‘å®šå½“å‰ä¸­é—´ä»¶ï¼Œå½“ä¸­é—´ä»¶æ‰§è¡Œå®Œï¼Œè°ƒç”¨next()çš„æ—¶å€™ï¼Œå…¶å®å°±æ˜¯å»æ‰§è¡Œä¸‹ä¸€ä¸ªä¸­é—´ä»¶ã€‚</p>
<pre><code>for (let i = len - 1; i &gt;= 0; i--) {
        let currentMiddleware = this.middlewares[i];
        next = createNext(currentMiddleware, next);
 }
</code></pre><p>ä¸Šé¢è¿™æ®µä»£ç å…¶å®å°±æ˜¯ä¸€ä¸ªé“¾å¼åå‘é€’å½’æ¨¡å‹çš„å®ç°ï¼Œiæ˜¯ä»æœ€å¤§æ•°å¼€å§‹å¾ªç¯çš„ï¼Œå°†ä¸­é—´ä»¶ä»æœ€åä¸€ä¸ªå¼€å§‹å°è£…ï¼Œæ¯ä¸€æ¬¡éƒ½æ˜¯å°†è‡ªå·±çš„æ‰§è¡Œå‡½æ•°å°è£…æˆnextå½“åšä¸Šä¸€ä¸ªä¸­é—´ä»¶çš„nextå‚æ•°ï¼Œè¿™æ ·å½“å¾ªç¯åˆ°ç¬¬ä¸€ä¸ªä¸­é—´ä»¶çš„æ—¶å€™ï¼Œåªéœ€è¦æ‰§è¡Œä¸€æ¬¡next()ï¼Œå°±èƒ½é“¾å¼çš„é€’å½’è°ƒç”¨æ‰€æœ‰ä¸­é—´ä»¶ï¼Œè¿™ä¸ªå°±æ˜¯koaå‰¥æ´‹è‘±çš„æ ¸å¿ƒä»£ç æœºåˆ¶ã€‚</p>
<p>åˆ°è¿™é‡Œæˆ‘ä»¬æ€»ç»“ä¸€ä¸‹ä¸Šé¢æ‰€æœ‰å‰¥æ´‹è‘±æ¨¡å‹ä»£ç çš„æµç¨‹ï¼Œé€šè¿‡useä¼ è¿›æ¥çš„ä¸­é—´ä»¶æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå›è°ƒå‡½æ•°çš„å‚æ•°æ˜¯ctxä¸Šä¸‹æ–‡å’Œnextï¼Œnextå…¶å®å°±æ˜¯æ§åˆ¶æƒçš„äº¤æ¥æ£’ï¼Œnextçš„ä½œç”¨æ˜¯åœæ­¢è¿è¡Œå½“å‰ä¸­é—´ä»¶ï¼Œå°†æ§åˆ¶æƒäº¤ç»™ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ï¼Œæ‰§è¡Œä¸‹ä¸€ä¸ªä¸­é—´ä»¶çš„next()ä¹‹å‰çš„ä»£ç ï¼Œå½“ä¸‹ä¸€ä¸ªä¸­é—´ä»¶è¿è¡Œçš„ä»£ç é‡åˆ°äº†next()ï¼Œåˆä¼šå°†ä»£ç æ‰§è¡Œæƒäº¤ç»™ä¸‹ä¸‹ä¸ªä¸­é—´ä»¶ï¼Œå½“æ‰§è¡Œåˆ°æœ€åä¸€ä¸ªä¸­é—´ä»¶çš„æ—¶å€™ï¼Œæ§åˆ¶æƒå‘ç”Ÿåè½¬ï¼Œå¼€å§‹å›å¤´å»æ‰§è¡Œä¹‹å‰æ‰€æœ‰ä¸­é—´ä»¶ä¸­å‰©ä¸‹æœªæ‰§è¡Œçš„ä»£ç ï¼Œè¿™æ•´ä¸ªæµç¨‹æœ‰ç‚¹åƒä¸€ä¸ªä¼ªé€’å½’ï¼Œå½“æœ€ç»ˆæ‰€æœ‰ä¸­é—´ä»¶å…¨éƒ¨æ‰§è¡Œå®Œåï¼Œä¼šè¿”å›ä¸€ä¸ªPromiseå¯¹è±¡ï¼Œå› ä¸ºæˆ‘ä»¬çš„composeå‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ªasyncçš„å‡½æ•°ï¼Œasyncå‡½æ•°æ‰§è¡Œå®Œåä¼šè¿”å›ä¸€ä¸ªPromiseï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½å°†æ‰€æœ‰çš„ä¸­é—´ä»¶å¼‚æ­¥æ‰§è¡ŒåŒæ­¥åŒ–ï¼Œé€šè¿‡thenå°±å¯ä»¥æ‰§è¡Œå“åº”å‡½æ•°å’Œé”™è¯¯å¤„ç†å‡½æ•°ã€‚</p>
<p>å½“ä¸­é—´ä»¶æœºåˆ¶ä»£ç å†™å¥½äº†ä»¥åï¼Œè¿è¡Œæˆ‘ä»¬çš„ä¸Šé¢çš„ä¾‹å­ï¼Œå·²ç»èƒ½è¾“å‡º123456äº†ï¼Œè‡³æ­¤ï¼Œæˆ‘ä»¬çš„koaçš„åŸºæœ¬æ¡†æ¶å·²ç»åŸºæœ¬åšå¥½äº†ï¼Œä¸è¿‡ä¸€ä¸ªæ¡†æ¶ä¸èƒ½åªå®ç°åŠŸèƒ½ï¼Œä¸ºäº†æ¡†æ¶å’ŒæœåŠ¡å™¨å®ä¾‹çš„å¥å£®ï¼Œè¿˜éœ€è¦åŠ ä¸Šé”™è¯¯å¤„ç†æœºåˆ¶ã€‚</p>
<h4 id="æ¨¡å—å››ï¼šé”™è¯¯æ•è·å’Œé”™è¯¯å¤„ç†"><a href="#æ¨¡å—å››ï¼šé”™è¯¯æ•è·å’Œé”™è¯¯å¤„ç†" class="headerlink" title="æ¨¡å—å››ï¼šé”™è¯¯æ•è·å’Œé”™è¯¯å¤„ç†"></a>æ¨¡å—å››ï¼šé”™è¯¯æ•è·å’Œé”™è¯¯å¤„ç†</h4><p>è¦å®ç°ä¸€ä¸ªåŸºç¡€æ¡†æ¶ï¼Œé”™è¯¯å¤„ç†å’Œæ•è·å¿…ä¸å¯å°‘ï¼Œä¸€ä¸ªå¥å£®çš„æ¡†æ¶ï¼Œå¿…é¡»ä¿è¯åœ¨å‘ç”Ÿé”™è¯¯çš„æ—¶å€™ï¼Œèƒ½å¤Ÿæ•è·åˆ°é”™è¯¯å’ŒæŠ›å‡ºçš„å¼‚å¸¸ï¼Œå¹¶åé¦ˆå‡ºæ¥ï¼Œå°†é”™è¯¯ä¿¡æ¯å‘é€åˆ°ç›‘æ§ç³»ç»Ÿä¸Šè¿›è¡Œåé¦ˆï¼Œç›®å‰æˆ‘ä»¬å®ç°çš„ç®€æ˜“koaæ¡†æ¶è¿˜æ²¡æœ‰èƒ½å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬æ¥ä¸‹åŠ ä¸Šé”™è¯¯å¤„ç†å’Œæ•è·çš„æœºåˆ¶ã€‚</p>
<pre><code>throw new Error(&apos;oooops&apos;);
</code></pre><p>åŸºäºç°åœ¨çš„æ¡†æ¶ï¼Œå¦‚æœä¸­é—´ä»¶ä»£ç ä¸­å‡ºç°å¦‚ä¸Šé”™è¯¯å¼‚å¸¸æŠ›å‡ºï¼Œæ˜¯æ•è·ä¸åˆ°é”™è¯¯çš„ï¼Œè¿™æ—¶å€™æˆ‘ä»¬çœ‹ä¸€ä¸‹application.jsä¸­çš„callbackå‡½æ•°çš„returnè¿”å›ä»£ç ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code>return fn(ctx).then(respond);
</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œfnæ˜¯ä¸­é—´ä»¶çš„æ‰§è¡Œå‡½æ•°ï¼Œæ¯ä¸€ä¸ªä¸­é—´ä»¶ä»£ç éƒ½æ˜¯ç”±asyncåŒ…è£¹ç€çš„ï¼Œè€Œä¸”ä¸­é—´ä»¶çš„æ‰§è¡Œå‡½æ•°composeè¿”å›çš„ä¹Ÿæ˜¯ä¸€ä¸ªasyncå‡½æ•°ï¼Œæˆ‘ä»¬æ ¹æ®es7çš„è§„èŒƒçŸ¥é“ï¼Œasyncè¿”å›çš„æ˜¯ä¸€ä¸ªpromiseçš„å¯¹è±¡å®ä¾‹ï¼Œæˆ‘ä»¬å¦‚æœæƒ³è¦æ•è·promiseçš„é”™è¯¯ï¼Œåªéœ€è¦ä½¿ç”¨promiseçš„catchæ–¹æ³•ï¼Œå°±å¯ä»¥æŠŠæ‰€æœ‰çš„ä¸­é—´ä»¶çš„å¼‚å¸¸å…¨éƒ¨æ•è·åˆ°ï¼Œä¿®æ”¹åcallbackçš„è¿”å›ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code>return fn(ctx).then(respond).catch(onerror);
</code></pre><p>ç°åœ¨æˆ‘ä»¬å·²ç»å®ç°äº†ä¸­é—´ä»¶çš„é”™è¯¯å¼‚å¸¸æ•è·ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜ç¼ºå°‘æ¡†æ¶å±‚å‘ç”Ÿé”™è¯¯çš„æ•è·æœºåˆ¶ï¼Œæˆ‘ä»¬å¸Œæœ›æˆ‘ä»¬çš„æœåŠ¡å™¨å®ä¾‹èƒ½æœ‰é”™è¯¯äº‹ä»¶çš„ç›‘å¬æœºåˆ¶ï¼Œé€šè¿‡onçš„ç›‘å¬å‡½æ•°å°±èƒ½è®¢é˜…å’Œç›‘å¬æ¡†æ¶å±‚é¢ä¸Šçš„é”™è¯¯ï¼Œå®ç°è¿™ä¸ªæœºåˆ¶ä¸éš¾ï¼Œä½¿ç”¨nodejsåŸç”Ÿeventsæ¨¡å—å³å¯ï¼Œeventsæ¨¡å—ç»™æˆ‘ä»¬æä¾›äº†äº‹ä»¶ç›‘å¬onå‡½æ•°å’Œäº‹ä»¶è§¦å‘emitè¡Œä¸ºå‡½æ•°ï¼Œä¸€ä¸ªå‘å°„äº‹ä»¶ï¼Œä¸€ä¸ªè´Ÿè´£æ¥æ”¶äº‹ä»¶ï¼Œæˆ‘ä»¬åªéœ€è¦å°†koaçš„æ„é€ å‡½æ•°ç»§æ‰¿eventsæ¨¡å—å³å¯ï¼Œæ„é€ åçš„ä¼ªä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code>let EventEmitter = require(&apos;events&apos;);
class Application extends EventEmitter{}
</code></pre><p>ç»§æ‰¿äº†eventsæ¨¡å—åï¼Œå½“æˆ‘ä»¬åˆ›å»ºkoaå®ä¾‹çš„æ—¶å€™ï¼ŒåŠ ä¸Šonç›‘å¬å‡½æ•°ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code>let app = new Koa();

app.on(&apos;error&apos;, err =&gt; {
    console.log(&apos;error happends: &apos;, err.stack);
});
</code></pre><p>è¿™æ ·æˆ‘ä»¬å°±å®ç°äº†æ¡†æ¶å±‚é¢ä¸Šçš„é”™è¯¯çš„æ•è·å’Œç›‘å¬æœºåˆ¶äº†ã€‚æ€»ç»“ä¸€ä¸‹ï¼Œé”™è¯¯å¤„ç†å’Œæ•è·ï¼Œåˆ†ä¸­é—´ä»¶çš„é”™è¯¯å¤„ç†æ•è·å’Œæ¡†æ¶å±‚çš„é”™è¯¯å¤„ç†æ•è·ï¼Œä¸­é—´ä»¶çš„é”™è¯¯å¤„ç†ç”¨promiseçš„catchï¼Œæ¡†æ¶å±‚é¢çš„é”™è¯¯å¤„ç†ç”¨nodejsçš„åŸç”Ÿæ¨¡å—eventsï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æŠŠä¸€ä¸ªæœåŠ¡å™¨å®ä¾‹ä¸Šçš„æ‰€æœ‰çš„é”™è¯¯å¼‚å¸¸å…¨éƒ¨æ•è·åˆ°äº†ã€‚è‡³æ­¤ï¼Œæˆ‘ä»¬å°±å®Œæ•´å®ç°äº†ä¸€ä¸ªè½»é‡ç‰ˆçš„koaæ¡†æ¶äº†ã€‚</p>
<h3 id="ç»“å°¾"><a href="#ç»“å°¾" class="headerlink" title="ç»“å°¾"></a>ç»“å°¾</h3><p>å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»å®ç°äº†ä¸€ä¸ªè½»é‡ç‰ˆçš„koaæ¡†æ¶äº†ï¼Œæˆ‘ä»¬å®ç°äº†å°è£…node http serverã€åˆ›å»ºKoaç±»æ„é€ å‡½æ•°ã€æ„é€ requestã€responseã€contextå¯¹è±¡ã€ä¸­é—´ä»¶æœºåˆ¶å’Œå‰¥æ´‹è‘±æ¨¡å‹çš„å®ç°ã€é”™è¯¯æ•è·å’Œé”™è¯¯å¤„ç†è¿™å››ä¸ªå¤§æ¨¡å—ï¼Œç†è§£äº†è¿™ä¸ªè½»é‡ç‰ˆkoaçš„å®ç°åŸç†ï¼Œå†å»çœ‹koa2çš„æºç ï¼Œä½ å°±ä¼šå‘ç°ä¸€åˆ‡éƒ½è±ç„¶å¼€æœ—ï¼Œkoa2çš„æºç æ— éå°±æ˜¯åœ¨è¿™ä¸ªè½»é‡ç‰ˆåŸºç¡€ä¸ŠåŠ äº†å¾ˆå¤šå·¥å…·å‡½æ•°å’Œç»†èŠ‚çš„å¤„ç†ï¼Œé™äºç¯‡å¹…ç¬”è€…å°±ä¸å†ä¸€ä¸€ä»‹ç»äº†ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/07/vue2ç»„ä»¶æ‡’åŠ è½½/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/07/vue2ç»„ä»¶æ‡’åŠ è½½/" itemprop="url">vue2ç»„ä»¶æ‡’åŠ è½½</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-01-07T20:04:56+08:00">
                2018-01-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="ä»€ä¹ˆæ˜¯æ‡’åŠ è½½"><a href="#ä»€ä¹ˆæ˜¯æ‡’åŠ è½½" class="headerlink" title="ä»€ä¹ˆæ˜¯æ‡’åŠ è½½"></a>ä»€ä¹ˆæ˜¯æ‡’åŠ è½½</h3><p>æ‡’åŠ è½½ä¹Ÿå«å»¶è¿ŸåŠ è½½ï¼Œå³åœ¨éœ€è¦çš„æ—¶å€™è¿›è¡ŒåŠ è½½ï¼Œéšç”¨éšè½½ã€‚</p>
<h3 id="ä¸ºä»€ä¹ˆéœ€è¦æ‡’åŠ è½½"><a href="#ä¸ºä»€ä¹ˆéœ€è¦æ‡’åŠ è½½" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦æ‡’åŠ è½½"></a>ä¸ºä»€ä¹ˆéœ€è¦æ‡’åŠ è½½</h3><p>åœ¨å•é¡µåº”ç”¨ä¸­ï¼Œå¦‚æœæ²¡æœ‰åº”ç”¨æ‡’åŠ è½½ï¼Œè¿ç”¨webpackæ‰“åŒ…åçš„æ–‡ä»¶å°†ä¼šå¼‚å¸¸çš„å¤§ï¼Œé€ æˆè¿›å…¥é¦–é¡µæ—¶ï¼Œéœ€è¦åŠ è½½çš„å†…å®¹è¿‡å¤šï¼Œå»¶æ—¶è¿‡é•¿ï¼Œä¸åˆ©äºç”¨æˆ·ä½“éªŒï¼Œè€Œè¿ç”¨æ‡’åŠ è½½åˆ™å¯ä»¥å°†é¡µé¢è¿›è¡Œåˆ’åˆ†ï¼Œéœ€è¦çš„æ—¶å€™åŠ è½½é¡µé¢ï¼Œå¯ä»¥æœ‰æ•ˆçš„åˆ†æ‹…é¦–é¡µæ‰€æ‰¿æ‹…çš„åŠ è½½å‹åŠ›ï¼Œå‡å°‘é¦–é¡µåŠ è½½ç”¨æ—¶</p>
<h3 id="å¦‚ä½•ä¸webpacké…åˆå®ç°ç»„ä»¶æ‡’åŠ è½½"><a href="#å¦‚ä½•ä¸webpacké…åˆå®ç°ç»„ä»¶æ‡’åŠ è½½" class="headerlink" title="å¦‚ä½•ä¸webpacké…åˆå®ç°ç»„ä»¶æ‡’åŠ è½½"></a>å¦‚ä½•ä¸webpacké…åˆå®ç°ç»„ä»¶æ‡’åŠ è½½</h3><p>ã€€ã€€1ã€åœ¨webpacké…ç½®æ–‡ä»¶ä¸­çš„outputè·¯å¾„é…ç½®chunkFilenameå±æ€§<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">output: &#123;</span><br><span class="line">        path: resolve(__dirname, &apos;dist&apos;),</span><br><span class="line">        filename: options.dev ? &apos;[name].js&apos; : &apos;[name].js?[chunkhash]&apos;,</span><br><span class="line">        chunkFilename: &apos;chunk[id].js?[chunkhash]&apos;,</span><br><span class="line">        publicPath: options.dev ? &apos;/assets/&apos; : publicPath</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure></p>
<p>chunkFilenameè·¯å¾„å°†ä¼šä½œä¸ºç»„ä»¶æ‡’åŠ è½½çš„è·¯å¾„</p>
<p>2ã€é…åˆwebpackæ”¯æŒçš„å¼‚æ­¥åŠ è½½æ–¹æ³•</p>
<ul>
<li>resolve =&gt; require([URL], resolve), æ”¯æŒæ€§å¥½</li>
<li>() =&gt; system.import(URL) , webpack2å®˜ç½‘ä¸Šå·²ç»å£°æ˜å°†é€æ¸åºŸé™¤, ä¸æ¨èä½¿ç”¨</li>
<li>() =&gt; import(URL), webpack2å®˜ç½‘æ¨èä½¿ç”¨, å±äºes7èŒƒç•´, éœ€è¦é…åˆbabelçš„syntax-dynamic-importæ’ä»¶ä½¿ç”¨, å…·ä½“ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev babel-core babel-loader babel-plugin-syntax-dynamic-import babel-preset-es2015</span><br><span class="line"></span><br><span class="line">use: [&#123;</span><br><span class="line">        loader: &apos;babel-loader&apos;,</span><br><span class="line">        options: &#123;</span><br><span class="line">          presets: [[&apos;es2015&apos;, &#123;modules: false&#125;]],</span><br><span class="line">          plugins: [&apos;syntax-dynamic-import&apos;]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;]</span><br></pre></td></tr></table></figure>
<h3 id="å…·ä½“å®ä¾‹ä¸­å®ç°æ‡’åŠ è½½"><a href="#å…·ä½“å®ä¾‹ä¸­å®ç°æ‡’åŠ è½½" class="headerlink" title="å…·ä½“å®ä¾‹ä¸­å®ç°æ‡’åŠ è½½"></a>å…·ä½“å®ä¾‹ä¸­å®ç°æ‡’åŠ è½½</h3><h4 id="è·¯ç”±ä¸­é…ç½®å¼‚æ­¥ç»„ä»¶"><a href="#è·¯ç”±ä¸­é…ç½®å¼‚æ­¥ç»„ä»¶" class="headerlink" title="è·¯ç”±ä¸­é…ç½®å¼‚æ­¥ç»„ä»¶"></a>è·¯ç”±ä¸­é…ç½®å¼‚æ­¥ç»„ä»¶</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">export default new Router(&#123;</span><br><span class="line">    routes: [</span><br><span class="line">        &#123;</span><br><span class="line">            mode: &apos;history&apos;,</span><br><span class="line">            path: &apos;/my&apos;,</span><br><span class="line">            name: &apos;my&apos;,</span><br><span class="line">            component:  resolve =&gt; require([&apos;../page/my/my.vue&apos;], resolve),//æ‡’åŠ è½½</span><br><span class="line">        &#125;,</span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="å®ä¾‹ä¸­é…ç½®å¼‚æ­¥ç»„ä»¶"><a href="#å®ä¾‹ä¸­é…ç½®å¼‚æ­¥ç»„ä»¶" class="headerlink" title="å®ä¾‹ä¸­é…ç½®å¼‚æ­¥ç»„ä»¶"></a>å®ä¾‹ä¸­é…ç½®å¼‚æ­¥ç»„ä»¶</h4><blockquote>
<p>æ¨è<code>historyTab: () =&gt; import(&#39;../../component/historyTab/historyTab.vue&#39;)</code></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">components: &#123;</span><br><span class="line">        historyTab: resolve =&gt; &#123;require([&apos;../../component/historyTab/historyTab.vue&apos;], resolve)&#125;,//æ‡’åŠ è½½</span><br><span class="line">        //historyTab: () =&gt; import(&apos;../../component/historyTab/historyTab.vue&apos;)</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>
<h4 id="å…¨å±€æ³¨å†Œå¼‚æ­¥ç»„ä»¶"><a href="#å…¨å±€æ³¨å†Œå¼‚æ­¥ç»„ä»¶" class="headerlink" title="å…¨å±€æ³¨å†Œå¼‚æ­¥ç»„ä»¶"></a>å…¨å±€æ³¨å†Œå¼‚æ­¥ç»„ä»¶</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Vue.component(&apos;mideaHeader&apos;, () =&gt; &#123;</span><br><span class="line">    System.import(&apos;./component/header/header.vue&apos;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/02/Vueå¤§æ•°æ®æ¸²æŸ“è™šæ‹Ÿæ»šåŠ¨åˆ—è¡¨/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/02/Vueå¤§æ•°æ®æ¸²æŸ“è™šæ‹Ÿæ»šåŠ¨åˆ—è¡¨/" itemprop="url">Vueå¤§æ•°æ®æ¸²æŸ“è™šæ‹Ÿæ»šåŠ¨åˆ—è¡¨</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-01-02T22:59:12+08:00">
                2018-01-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Githubï¼š<a href="https://link.zhihu.com/?target=https%3A//github.com/tangbc/vue-virtual-scroll-list" target="_blank" rel="noopener">tangbc/vue-virtual-scroll-list</a><br><img src="https://pic1.zhimg.com/v2-827fdf77d1a145a6d1d3d56f390a37ff_b.gif" alt=""></p>
<p><img src="https://pic1.zhimg.com/v2-827fdf77d1a145a6d1d3d56f390a37ff_b.jpg" alt=""></p>
<pre><code>;
(function(root, factory) {
    var namespace = &apos;VirtualScrollList&apos;
    if(typeof exports === &apos;object&apos; &amp;&amp; typeof module === &apos;object&apos;) {
        module.exports = factory(namespace, require(&apos;vue&apos;))
    } else if(typeof define === &apos;function&apos; &amp;&amp; define.amd) {
        define([&apos;vue&apos;], factory.bind(root, namespace))
    } else if(typeof exports === &apos;object&apos;) {
        exports[namespace] = factory(namespace, require(&apos;vue&apos;))
    } else {
        root[namespace] = factory(namespace, root[&apos;Vue&apos;])
    }
})(this, function(namespace, Vue2) {
    if(typeof Vue2 === &apos;object&apos; &amp;&amp; typeof Vue2.default === &apos;function&apos;) {
        Vue2 = Vue2.default
    }

    var _debounce = function(func, wait, immediate) {
        var timeout
        return function() {
            var context = this
            var args = arguments
            var later = function() {
                timeout = null
                if(!immediate) {
                    func.apply(context, args)
                }
            }
            var callNow = immediate &amp;&amp; !timeout
            clearTimeout(timeout)
            timeout = setTimeout(later, wait)
            if(callNow) {
                func.apply(context, args)
            }
        }
    }

    return Vue2.component(namespace, {
        props: {
            size: {
                type: Number,
                required: true
            },
            remain: {
                type: Number,
                required: true
            },
            rtag: {
                type: String,
                default: &apos;div&apos;
            },
            wtag: {
                type: String,
                default: &apos;p&apos;
            },
            wclass: {
                type: String,
                default: &apos;&apos;
            },
            start: {
                type: Number,
                default: 0
            },
            offset: {
                type: Number,
                default: 0
            },
            variable: [Function, Boolean],
            bench: Number,
            debounce: Number,
            totop: Function,
            tobottom: Function,
            onscroll: Function
        },

        data(){
            return {
                delta:{}
            }
        },

        created: function() {   // :size=&quot;60&quot; :remain=&quot;6&quot; :bench=&quot;44&quot; class=&quot;list&quot; :start=&quot;startIndex&quot;
            var start = this.start &gt;= this.remain ? this.start : 0
            var keeps = this.remain + (this.bench || this.remain)

            console.log(start)
            console.log(keeps)

            this.delta = {
                start: start, // start index.   //èµ·å§‹index
                end: start + keeps - 1, // end index.   //æ˜¾ç¤ºåˆ—è¡¨last index
                keeps: keeps, // nums keeping in real dom.      //è¦æ˜¾ç¤ºçš„åˆ—è¡¨æ•°æ®
                total: 0, // all items count, update in filter.    //æ€»çš„åˆ—è¡¨æ•°æ®
                offsetAll: 0, // cache all the scrollable offset.
                paddingTop: 0, // container wrapper real padding-top.
                paddingBottom: 0, // container wrapper real padding-bottom.
                varCache: {}, // object to cache variable index height and scroll offset.
                varAverSize: 0, // average/estimate item height before variable be calculated.
                varLastCalcIndex: 0 // last calculated variable height/offset index, always increase.
            }


        },

        watch: {
            size: function() {
                this.alter = &apos;size&apos;
            },
            remain: function() {
                this.alter = &apos;remain&apos;
            },
            bench: function() {
                this.alter = &apos;bench&apos;
            },
            start: function() {
                this.alter = &apos;start&apos;
            },
            offset: function() {
                this.alter = &apos;offset&apos;
            }
        },

        methods: {
            onScroll: function(e) {
                var delta = this.delta
                var offset = this.$refs.vsl.scrollTop

                if(delta.total &gt; delta.keeps) {
                    this.updateZone(offset)
                } else {
                    delta.end = delta.total - 1
                }

                var offsetAll = delta.offsetAll
                if(this.onscroll) {
                    this.onscroll(e, {
                        offset: offset,
                        offsetAll: offsetAll,
                        start: delta.start,
                        end: delta.end
                    })
                }

                if(!offset &amp;&amp; delta.total) {
                    this.triggerEvent(&apos;totop&apos;)
                }

                if(offset &gt;= offsetAll) {
                    this.triggerEvent(&apos;tobottom&apos;)
                }
            },

            // update render zone by scroll offset.
            updateZone: function(offset) {
                var overs = this.variable ?
                    this.getVarOvers(offset) :
                    Math.floor(offset / this.size)

                var delta = this.delta
                var zone = this.getZone(overs)
                var bench = this.bench || this.remain

                // for better performance, if scroll pass items within now bench, do not update.
                if(!zone.isLast &amp;&amp; (overs &gt; delta.start) &amp;&amp; (overs - delta.start &lt;= bench)) {
                    return
                }

                delta.end = zone.end
                delta.start = zone.start
                this.$forceUpdate()
            },

            // return the scroll passed items count in variable.
            getVarOvers: function(offset) {
                var low = 0
                var middle = 0
                var middleOffset = 0
                var delta = this.delta
                var high = delta.total

                while(low &lt;= high) {
                    middle = low + Math.floor((high - low) / 2)
                    middleOffset = this.getVarOffset(middle)

                    // calculate the average variable height at first binary search.
                    if(!delta.varAverSize) {
                        delta.varAverSize = Math.floor(middleOffset / middle)
                    }

                    if(middleOffset === offset) {
                        return middle
                    } else if(middleOffset &lt; offset) {
                        low = middle + 1
                    } else if(middleOffset &gt; offset) {
                        high = middle - 1
                    }
                }

                return low &gt; 0 ? --low : 0
            },

            // return a variable scroll offset from given index.
            getVarOffset: function(index, nocache) {
                var delta = this.delta
                var cache = delta.varCache[index]

                if(!nocache &amp;&amp; cache) {
                    return cache.offset
                }

                var offset = 0
                for(var i = 0; i &lt; index; i++) {
                    var size = this.getVarSize(i, nocache)
                    delta.varCache[i] = {
                        size: size,
                        offset: offset
                    }
                    offset += size
                }

                delta.varLastCalcIndex = Math.max(delta.varLastCalcIndex, index - 1)
                delta.varLastCalcIndex = Math.min(delta.varLastCalcIndex, delta.total - 1)

                return offset
            },

            // return a variable size (height) from given index.
            getVarSize: function(index, nocache) {
                var cache = this.delta.varCache[index]
                if(!nocache &amp;&amp; cache) {
                    return cache.size
                }

                if(typeof this.variable === &apos;function&apos;) {
                    return this.variable(index) || 0
                } else {
                    var slot = this.$slots.default[index]
                    var style = slot &amp;&amp; slot.data &amp;&amp; slot.data.style
                    if(style &amp;&amp; style.height) {
                        var shm = style.height.match(/^(.*)px$/)
                        return(shm &amp;&amp; +shm[1]) || 0
                    }
                }
                return 0
            },

            // return the variable paddingTop base current zone.
            // @todo: if set a large `start` before variable was calculated,
            // here will also case too much offset calculate when list is very large,
            // consider use estimate paddingTop in this case just like `getVarPaddingBottom`.
            getVarPaddingTop: function() {
                return this.getVarOffset(this.delta.start)
            },

            // return the variable paddingBottom base current zone.
            getVarPaddingBottom: function() {
                var delta = this.delta
                var last = delta.total - 1
                if(delta.total - delta.end &lt;= delta.keeps || delta.varLastCalcIndex === last) {
                    return this.getVarOffset(last) - this.getVarOffset(delta.end)
                } else {
                    // if unreached last zone or uncalculate real behind offset
                    // return the estimate paddingBottom avoid too much calculate.
                    return(delta.total - delta.end) * (delta.varAverSize || this.size)
                }
            },

            // retun the variable all heights use to judge reach bottom.
            getVarAllHeight: function() {
                var delta = this.delta
                if(delta.total - delta.end &lt;= delta.keeps || delta.varLastCalcIndex === delta.total - 1) {
                    return this.getVarOffset(delta.total)
                } else {
                    return this.getVarOffset(delta.start) + (delta.total - delta.end) * (delta.varAverSize || this.size)
                }
            },

            // the ONLY ONE public method, allow the parent update variable by index.
            updateVariable: function(index) {
                // clear/update all the offfsets and heights ahead of index.
                this.getVarOffset(index, true)
            },

            // return the right zone info base on `start/index`.
            getZone: function(index) {
                var start, end
                var delta = this.delta

                index = parseInt(index, 10)
                index = Math.max(0, index)

                var lastStart = delta.total - delta.keeps
                var isLast = (index &lt;= delta.total &amp;&amp; index &gt;= lastStart) || (index &gt; delta.total)
                if(isLast) {
                    end = delta.total - 1
                    start = Math.max(0, lastStart)
                } else {
                    start = index
                    end = start + delta.keeps - 1
                }

                return {
                    end: end,
                    start: start,
                    isLast: isLast
                }
            },

            // trigger a props event on parent.
            triggerEvent: function(event) {
                if(this[event]) {
                    this[event]()
                }
            },

            // set manual scroll top.
            setScrollTop: function(scrollTop) {
                this.$refs.vsl.scrollTop = scrollTop
            },

            // filter the shown items base on `start` and `end`.
            filter: function() {
                var delta = this.delta
                var slots = this.$slots.default

                if(!slots) {
                    slots = []
                    delta.start = 0
                }

                delta.total = slots.length

                var paddingTop, paddingBottom, allHeight;


                var hasPadding = delta.total &gt; delta.keeps

                if(this.variable) {
                    allHeight = this.getVarAllHeight()
                    paddingTop = hasPadding ? this.getVarPaddingTop() : 0
                    paddingBottom = hasPadding ? this.getVarPaddingBottom() : 0
                } else {
                    allHeight = this.size * delta.total
                    paddingTop = this.size * (hasPadding ? delta.start : 0)
                    paddingBottom = this.size * (hasPadding ? delta.total - delta.keeps : 0) - paddingTop
                }

                delta.paddingTop = paddingTop
                delta.paddingBottom = paddingBottom
                delta.offsetAll = allHeight - this.size * this.remain  //æ€»é«˜åº¦å‡å»çª—å£çš„é«˜åº¦

                return slots.filter(function(slot, index) {
                    return index &gt;= delta.start &amp;&amp; index &lt;= delta.end
                })
            }
        },

        mounted: function() {
            if(this.start) {
                var start = this.getZone(this.start).start
                this.setScrollTop(this.variable ? this.getVarOffset(start) : start * this.size)
            } else if(this.offset) {
                this.setScrollTop(this.offset)
            }
        },

        // check if delta should update when prorps change.
        beforeUpdate: function() {
            var delta = this.delta
            delta.keeps = this.remain + (this.bench || this.remain)

            var calcstart = this.alter === &apos;start&apos; ? this.start : delta.start
            var zone = this.getZone(calcstart)

            // if start, size or offset change, update scroll position.
            if(~[&apos;start&apos;, &apos;size&apos;, &apos;offset&apos;].indexOf(this.alter)) {
                this.$nextTick(this.setScrollTop.bind(this, this.alter === &apos;offset&apos; ?
                    this.offset : this.variable ?
                    this.getVarOffset(zone.isLast ? delta.total : zone.start) :
                    zone.isLast ? delta.total * this.size : zone.start * this.size))
            }

            // if points out difference, force update once again.
            if(calcstart !== zone.start || delta.end !== zone.end || this.alter) {
                this.alter = &apos;&apos;
                delta.end = zone.end
                delta.start = zone.start
                this.$forceUpdate()
            }
        },

        render: function(h) {
            var list = this.filter()
            var delta = this.delta
            var dbc = this.debounce
            console.log(list)
            return h(this.rtag, {
                &apos;ref&apos;: &apos;vsl&apos;,
                &apos;style&apos;: {
                    &apos;display&apos;: &apos;block&apos;,
                    &apos;overflow-y&apos;: &apos;auto&apos;,
                    &apos;height&apos;: this.size * this.remain + &apos;px&apos;
                },
                &apos;on&apos;: {
                    &apos;scroll&apos;: dbc ? _debounce(this.onScroll.bind(this), dbc) : this.onScroll
                }
            }, [
                h(this.wtag, {
                    &apos;style&apos;: {
                        &apos;display&apos;: &apos;block&apos;,
                        &apos;padding-top&apos;: delta.paddingTop + &apos;px&apos;,
                        &apos;padding-bottom&apos;: delta.paddingBottom + &apos;px&apos;
                    },
                    &apos;class&apos;: this.wclass
                }, list)
            ])
        }
    })
})


&lt;template&gt;
    &lt;div class=&quot;appWraper&quot;&gt;
        &lt;div class=&quot;scrollToIndex&quot;&gt;
            &lt;span&gt;Scroll to index: &lt;/span&gt;
            &lt;input type=&quot;text&quot; v-model.number.lazy=&quot;startIndex&quot;&gt;
            &lt;small&gt;Change and blur to set start index.&lt;/small&gt;
        &lt;/div&gt;
        &lt;VirtualList :size=&quot;60&quot; :remain=&quot;6&quot; :bench=&quot;24&quot; class=&quot;list&quot; :start=&quot;startIndex&quot;&gt;
            &lt;Item v-for=&quot;(udf, index) of items&quot; :index=&quot;index&quot; :key=&quot;index&quot;&gt;&lt;/Item&gt;
        &lt;/VirtualList&gt;




        &lt;div class=&quot;source&quot;&gt;
            &lt;a href=&quot;https://github.com/tangbc/vue-virtual-scroll-list/blob/master/examples/finite/finite.vue#L1&quot;&gt;
                View this demo source code
            &lt;/a&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
    import Item from &apos;./item.vue&apos;
    import VirtualList from &apos;./VirtualScrollList.js&apos;

    export default {
        name: &apos;finite-test&apos;,

        components: {
            Item,
            VirtualList
        },

        data() {
            return {
                startIndex: 9,
                items: new Array(100)
            }
        }
    }
&lt;/script&gt;

&lt;style&gt;

    body {
        background: #fffaf0;
    }
    .appWraper {
        width: 440px;
        margin: 0 auto;
        overflow-y: auto;
    }
    .title {
        font-size: 25px;
        font-weight: 100;
        text-align: center;
    }
    @media (max-width: 640px) {
        .appWraper {
            width: 100%;
        }
        .title {
            font-size: 16px;
        }
    }





    .scrollToIndex {
        padding-bottom: 20px;
    }

    input {
        outline: none;
        padding: .4em .5em;
        width: 55px;
        height: 16px;
        border-radius: 3px;
        border: 1px solid;
        border-color: #dddddd;
        font-size: 16px;
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
    }

    input:focus {
        border-color: #6495ed;
    }

    small {
        color: #999;
    }

    .list {
        background: #fff;
        border-radius: 3px;
        border: 1px solid #ddd;
        -webkit-overflow-scrolling: touch;
        overflow-scrolling: touch;
    }

    .source {
        text-align: center;
        padding-top: 20px;
    }

    .source a {
        color: #999;
        text-decoration: none;
        font-weight: 100;
    }

    @media (max-width: 640px) {
        small {
            display: none;
        }
    }
&lt;/style&gt;
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/20/promiseçš„æ¨¡æ‹Ÿå®ç°/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/20/promiseçš„æ¨¡æ‹Ÿå®ç°/" itemprop="url">promiseçš„æ¨¡æ‹Ÿå®ç°</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-12-20T13:11:36+08:00">
                2017-12-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1.æ¦‚è¿°"></a>1.æ¦‚è¿°</h1><h2 id="1-1-ä»€ä¹ˆæ˜¯promise"><a href="#1-1-ä»€ä¹ˆæ˜¯promise" class="headerlink" title="1.1 ä»€ä¹ˆæ˜¯promise"></a>1.1 ä»€ä¹ˆæ˜¯promise</h2><p><code>Promise</code> å¯¹è±¡æ˜¯ <code>JavaScript</code> çš„å¼‚æ­¥æ“ä½œè§£å†³æ–¹æ¡ˆï¼Œä¸ºå¼‚æ­¥æ“ä½œæä¾›ç»Ÿä¸€æ¥å£ã€‚å®ƒèµ·åˆ°ä»£ç†ä½œç”¨ï¼ˆproxyï¼‰ï¼Œå……å½“å¼‚æ­¥æ“ä½œä¸å›è°ƒå‡½æ•°ä¹‹é—´çš„ä¸­ä»‹ï¼Œä½¿å¾—å¼‚æ­¥æ“ä½œå…·å¤‡åŒæ­¥æ“ä½œçš„æ¥å£ã€‚</p>
<h2 id="1-2-promiseè§£å†³çš„é—®é¢˜"><a href="#1-2-promiseè§£å†³çš„é—®é¢˜" class="headerlink" title="1.2 promiseè§£å†³çš„é—®é¢˜"></a>1.2 promiseè§£å†³çš„é—®é¢˜</h2><h3 id="1-2-1-å›è°ƒåœ°ç‹±"><a href="#1-2-1-å›è°ƒåœ°ç‹±" class="headerlink" title="1.2.1 å›è°ƒåœ°ç‹±"></a>1.2.1 å›è°ƒåœ°ç‹±</h3><p><code>Promise</code> å¯ä»¥è®©å¼‚æ­¥æ“ä½œå†™èµ·æ¥ï¼Œå°±åƒåœ¨å†™åŒæ­¥æ“ä½œçš„æµç¨‹ï¼Œè€Œä¸å¿…ä¸€å±‚å±‚åœ°åµŒå¥—å›è°ƒå‡½æ•°ã€‚</p>
<h3 id="1-2-2-å¹¶è¡Œç»“æœ"><a href="#1-2-2-å¹¶è¡Œç»“æœ" class="headerlink" title="1.2.2 å¹¶è¡Œç»“æœ"></a>1.2.2 å¹¶è¡Œç»“æœ</h3><p>å¦‚æœå‡ ä¸ªå¼‚æ­¥æ“ä½œä¹‹é—´å¹¶æ²¡æœ‰å‰åé¡ºåºä¹‹åˆ†,ä½†éœ€è¦ç­‰å¤šä¸ªå¼‚æ­¥æ“ä½œéƒ½å®Œæˆåæ‰èƒ½æ‰§è¡Œåç»­çš„ä»»åŠ¡ï¼Œæ— æ³•å®ç°å¹¶è¡ŒèŠ‚çº¦æ—¶é—´ã€‚</p>
<h2 id="1-3-promiseç®€ä»‹"><a href="#1-3-promiseç®€ä»‹" class="headerlink" title="1.3 promiseç®€ä»‹"></a>1.3 promiseç®€ä»‹</h2><p>åœ¨ <code>ES6 Promises</code> æ ‡å‡†ä¸­å®šä¹‰çš„APIè¿˜ä¸æ˜¯å¾ˆå¤šï¼Œç›®å‰å¤§è‡´æœ‰ä¸‹é¢ä¸‰ç§ç±»å‹ã€‚</p>
<h3 id="1-3-1-consturctor"><a href="#1-3-1-consturctor" class="headerlink" title="1.3.1 consturctor"></a>1.3.1 <strong>consturctor</strong></h3><p>é¦–å…ˆï¼Œ<code>Promise</code> æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ã€‚</p>
<pre><code>functionf1(resolve, reject) {
  // å¼‚æ­¥ä»£ç ...
}

var promise = newPromise(f1);
</code></pre><h3 id="1-3-2-Instance-Method"><a href="#1-3-2-Instance-Method" class="headerlink" title="1.3.2 Instance Method"></a>1.3.2 Instance Method</h3><p><code>Promise</code>å¯¹è±¡é€šè¿‡è‡ªèº«çš„çŠ¶æ€ï¼Œæ¥æ§åˆ¶å¼‚æ­¥æ“ä½œã€‚Promiseå®ä¾‹å…·æœ‰ä¸‰ç§çŠ¶æ€ã€‚</p>
<ul>
<li>å¼‚æ­¥æ“ä½œæœªå®Œæˆï¼ˆpendingï¼‰</li>
<li>å¼‚æ­¥æ“ä½œæˆåŠŸï¼ˆfulfilledï¼‰</li>
<li>å¼‚æ­¥æ“ä½œå¤±è´¥ï¼ˆrejectedï¼‰</li>
</ul>
<p>è¿™ä¸‰ç§çš„çŠ¶æ€çš„å˜åŒ–é€”å¾„åªæœ‰ä¸¤ç§ã€‚</p>
<ul>
<li>ä»â€œæœªå®Œæˆâ€åˆ°â€œæˆåŠŸâ€</li>
<li>ä»â€œæœªå®Œæˆâ€åˆ°â€œå¤±è´¥â€</li>
</ul>
<p>æ‰€ä»¥<code>Promise</code>çš„æœ€ç»ˆç»“æœåªæœ‰ä¸¤ä¸ª,</p>
<ul>
<li>å¼‚æ­¥æ“ä½œæˆåŠŸï¼ŒPromiseå®ä¾‹ä¼ å›ä¸€ä¸ªå€¼ï¼ˆvalueï¼‰,çŠ¶æ€å˜ä¸º<code>fulfilled</code>ã€‚</li>
<li><p>å¼‚æ­¥æ“ä½œå¤±è´¥ï¼ŒPromise å®ä¾‹æŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼ˆerrorï¼‰,çŠ¶æ€å˜ä¸º<code>rejected</code>ã€‚</p>
<p>  promise.then(onFulfilled, onRejected)<br>  // resolve(æˆåŠŸ)æ—¶,onFulfilled ä¼šè¢«è°ƒç”¨// reject(å¤±è´¥)æ—¶,onRejected ä¼šè¢«è°ƒç”¨</p>
</li>
</ul>
<p><img src="https://user-gold-cdn.xitu.io/2018/3/5/161f55d1eecd52cb?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""></p>
<h3 id="1-3-3-Static-Method"><a href="#1-3-3-Static-Method" class="headerlink" title="1.3.3 Static Method"></a>1.3.3 Static Method</h3><p>åƒ <code>Promise</code>è¿™æ ·çš„å…¨å±€å¯¹è±¡è¿˜æ‹¥æœ‰ä¸€äº›é™æ€æ–¹æ³•ã€‚åŒ…æ‹¬ <code>Promise.all()</code>è¿˜æœ‰<code>Promise.resolve()</code> ç­‰åœ¨å†…ï¼Œä¸»è¦éƒ½æ˜¯ä¸€äº›å¯¹<code>Promise</code>è¿›è¡Œæ“ä½œçš„è¾…åŠ©æ–¹æ³•ã€‚</p>
<h1 id="2-Promiseçš„å®ç°"><a href="#2-Promiseçš„å®ç°" class="headerlink" title="2.Promiseçš„å®ç°"></a>2.<code>Promise</code>çš„å®ç°</h1><h2 id="2-1-resolveå’Œreject"><a href="#2-1-resolveå’Œreject" class="headerlink" title="2.1 resolveå’Œreject"></a>2.1 resolveå’Œreject</h2><p><code>resolve</code>å’Œ<code>reject</code>éƒ½æ˜¯å‡½æ•°</p>
<pre><code>//æ„é€ å‡½æ•°ä¸­functionPromise(executor) {
    let self = this;

    /*åˆå§‹åŒ–status*/
    self.status = &apos;pending&apos;;
    /*åˆå§‹åŒ–value*/
    self.value = undefined;
    /*è®¢é˜…äº‹ä»¶çš„æ•°ç»„*/
    self.onResolvedCallBacks = [];
    self.onRejectedCallBacks = [];

    /*æ­¤å‡½æ•°å°†Promiseå®ä¾‹çš„çŠ¶æ€ç”±pending è½¬åŒ–ä¸º fulfilled*/functionresolve(value) {
        if (value instanceofPromise) {
            return value.then(resolve, reject);
        }
        setTimeout(function () {
            if (self.status === &apos;pending&apos;) {
                self.status = &apos;fulfilled&apos;;
                self.value = value;
                /*å‘å¸ƒå·²ç»è®¢é˜…è¿‡çš„äº‹ä»¶*/
                self.onResolvedCallBacks.forEach(item =&gt; item(self.value))
            }
        }, 0)
    }
    /*æ­¤å‡½æ•°å°†Promiseå®ä¾‹çš„çŠ¶æ€ç”±pending è½¬åŒ–ä¸º rejected*/functionreject(reason) {
        setTimeout(function () {
            if (self.status === &apos;pending&apos;) {
                self.status = &apos;rejected&apos;;
                self.value = reason;
                /*å‘å¸ƒå·²ç»è®¢é˜…è¿‡çš„äº‹ä»¶*/
                self.onRejectedCallBacks.forEach(item =&gt; item(self.value))
            }
        }, 0)
    }

    // new Promise çš„æ—¶å€™ï¼Œæ‰§è¡Œå™¨ï¼ˆexecutorï¼‰çš„ä»£ç ä¼šç«‹å³æ‰§è¡Œtry {
        executor(resolve, reject);
    } catch (e) {
        reject(e);
    }

}
</code></pre><h2 id="2-2-thenæ–¹æ³•"><a href="#2-2-thenæ–¹æ³•" class="headerlink" title="2.2 thenæ–¹æ³•"></a>2.2 thenæ–¹æ³•</h2><p><code>promise</code>æˆåŠŸåï¼Œ<code>onFullfilled</code>ä¼šè¢«è°ƒç”¨ã€‚å¹¶ä¸”æŠŠ<code>promise</code>çš„å€¼å½“åšå®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚<code>promise</code>åœ¨æˆåŠŸä¹‹å‰ï¼Œä¸ä¼šè°ƒç”¨å®ƒï¼Œå¹¶ä¸”åªèƒ½è¢«è°ƒç”¨ä¸€æ¬¡ã€‚<code>reject</code>ä¹Ÿä¸€æ ·ã€‚</p>
<pre><code>// å…ˆå°è£…ä¸€ä¸ªæ–¹æ³•
function resolvePromise(promise2,x,resolve,reject){
//
  if(promise2 === x){
    return reject(new TypeError(&apos;å¾ªç¯å¼•ç”¨&apos;));
  }
  // ä¸ºäº†é˜²æ­¢resolveå’ŒrejectåŒæ—¶è°ƒç”¨
  let called = false;//promise2æ˜¯å¦å·²ç»resolve æˆ–rejectäº†
  if(x instanceof Promise){
    if(x.status == PENDING){
      x.then(function(y){
        resolvePromise(promise2,y,resolve,reject);
      },reject);
    }else{
      x.then(resolve,reject);
    }
    //xæ˜¯ä¸€ä¸ªthenableå¯¹è±¡æˆ–å‡½æ•°ï¼Œåªè¦æœ‰thenæ–¹æ³•çš„å¯¹è±¡ï¼Œ
  }elseif(x!= null &amp;&amp;((typeof x==&apos;object&apos;)||(typeof x == &apos;function&apos;))){
    //å½“æˆ‘ä»¬çš„promiseå’Œåˆ«çš„promiseè¿›è¡Œäº¤äº’ï¼Œç¼–å†™è¿™æ®µä»£ç çš„æ—¶å€™å°½é‡çš„è€ƒè™‘å…¼å®¹æ€§ï¼Œ
    //å…è®¸åˆ«äººçå†™ï¼Œxå¯ä»¥æ˜¯å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥æ˜¯å‡½æ•°
    try{
      letthen = x.then;
      if(typeof then == &apos;function&apos;){
        //æœ‰äº›promiseä¼šåŒæ—¶æ‰§è¡ŒæˆåŠŸå’Œå¤±è´¥çš„å›è°ƒ
        then.call(x,function(y){
          //å¦‚æœpromise2å·²ç»æˆåŠŸæˆ–å¤±è´¥äº†ï¼Œåˆ™ä¸ä¼šå†å¤„ç†äº†
          if(called)return;
          called = true;
          resolvePromise(promise2,y,resolve,reject)
        },function(err){
          if(called)return;
          called = true;
          reject(err);
        });
      }else{
        //åˆ°æ­¤çš„è¯xä¸æ˜¯ä¸€ä¸ªthenableå¯¹è±¡ï¼Œé‚£ç›´æ¥æŠŠå®ƒå½“æˆå€¼resolve promise2å°±å¯ä»¥äº†
        // å½“è¿”å›ä¸€ä¸ªå¯¹è±¡ {name:&apos;a&apos;,then:{age:8}},å¯¹è±¡é‡Œçš„thenä¸æ˜¯thenableå¯¹è±¡
        resolve(x);
      }
    }catch(e){
      if(called)return;
      called = true;
      reject(e);
    }

  }else{
    //å¦‚æœXæ˜¯ä¸€ä¸ªæ™®é€š çš„å€¼ï¼Œåˆ™ç”¨xçš„å€¼å»resolve promise2
    resolve(x);
  }
}

Promise.prototype.then = function(onFulfilled,onRejected){
  //å¦‚æœæˆåŠŸå’Œå¤±è´¥çš„å›è°ƒæ²¡æœ‰ä¼ ï¼Œåˆ™è¡¨ç¤ºè¿™ä¸ªthenæ²¡æœ‰ä»»ä½•é€»è¾‘ï¼Œåªä¼šæŠŠå€¼å¾€åæŠ›,å«åšå€¼çš„ç©¿é€
  // ä¾‹å¦‚ï¼špromise.then().then().then(function(data){},function(err){})

  onFulfilled = typeof onFulfilled == &apos;function&apos;?onFulfilled:function(value){return  value};
  onRejected = typeof onRejected == &apos;function&apos;?onRejected:reason=&gt;{throw reason};
  //å¦‚æœå½“å‰promiseçŠ¶æ€å·²ç»æ˜¯æˆåŠŸæ€äº†ï¼ŒonFulfilledç›´æ¥å–å€¼
  let self = this;
  let promise2;
  if(self.status == FULFILLED){
    return promise2 = new Promise(function(resolve,reject){
      setTimeout(function(){
        try{
          let x =onFulfilled(self.value);
          //å¦‚æœè·å–åˆ°äº†è¿”å›å€¼x,ä¼šèµ°è§£æpromiseçš„è¿‡ç¨‹
          resolvePromise(promise2,x,resolve,reject);
        }catch(e){
          //å¦‚æœæ‰§è¡ŒæˆåŠŸçš„å›è°ƒè¿‡ç¨‹ä¸­å‡ºé”™äº†ï¼Œç”¨é”™è¯¯åŸå› æŠŠpromise2 reject
          reject(e);
        }
      })

    });
  }
  if(self.status == REJECTED){
    return promise2 = new Promise(function(resolve,reject){
      setTimeout(function(){
        try{
          let x =onRejected(self.value);
          resolvePromise(promise2,x,resolve,reject);
        }catch(e){
          reject(e);
        }
      })
    });
  }
  if(self.status == PENDING){
    return promise2 = new Promise(function(resolve,reject){
      self.onResolvedCallbacks.push(function(){
        try{
          let x =onFulfilled(self.value);
          //å¦‚æœè·å–åˆ°äº†è¿”å›å€¼x,ä¼šèµ°è§£æpromiseçš„è¿‡ç¨‹
          resolvePromise(promise2,x,resolve,reject);
        }catch(e){
          reject(e);
        }

      });
      self.onRejectedCallbacks.push(function(){
        try{
          let x =onRejected(self.value);
          resolvePromise(promise2,x,resolve,reject);
        }catch(e){
          reject(e);
        }
      });
    });
  }

}
</code></pre><h2 id="2-2-catchæ–¹æ³•"><a href="#2-2-catchæ–¹æ³•" class="headerlink" title="2.2 catchæ–¹æ³•"></a>2.2 catchæ–¹æ³•</h2><pre><code>Promise.prototype.catch=function (callback) {
  returnthis.then(null,callback);
}
---------ä½¿ç”¨-------
let promise = newPromise(function (resolve, reject) {
  reject(&apos;é”™è¯¯&apos;);
})
promise.then(function(data){console.log(data)}).catch(e=&gt;{console.log(e)});
</code></pre><h2 id="2-3-all-æ–¹æ³•"><a href="#2-3-all-æ–¹æ³•" class="headerlink" title="2.3 all æ–¹æ³•"></a>2.3 all æ–¹æ³•</h2><pre><code>Promise.all = function (promises) {
  returnnewPromise(function (resolve,reject) {
    let arr =[];//arræ˜¯æœ€ç»ˆè¿”å›å€¼çš„ç»“æœçš„é›†åˆã€‚let j =0;
    functionprocessData(i,data){// æ¯è°ƒç”¨ä¸€æ¬¡æ­¤å‡½æ•°ï¼Œjå°±ä¼š+1ï¼›
      arr[i] = data;// æ¯æ¬¡æˆåŠŸçš„ç»“æœéƒ½æ”¾å…¥æ•°ç»„ä¸­if(++j===promises.length){
        resolve(arr); //åªæœ‰promisesä¸­çš„æœ€åä¸€ä¸ªæˆåŠŸï¼Œæ‰èƒ½è°ƒç”¨resolveæ–¹æ³•ã€‚
      }
    }
    for(let i=0;i&lt;promises.length;i++){
      promises[i].then(function (data) {
          processData(i,data);
      },reject)// å¦‚æœæœ‰ä¸€ä¸ªå¤±è´¥ï¼Œæ•´ä½“å°±ä¼šå¤±è´¥
    }
  })
}
</code></pre><p>ä½¿ç”¨æ–¹æ³•ï¼š</p>
<pre><code>functionread(file) {
  returnnew Promise1(function (resolve, reject) {
    require(&apos;fs&apos;).readFile(file,&apos;utf8&apos;,function (err, data) {
      resolve(data);
    })
  })
}

Promise1.all([read(&apos;./1.txt&apos;),read(&apos;./2.txt&apos;)]).then(function (data) {
  console.log(data)
})
// [&apos;file1&apos;,&apos;file2&apos;]
</code></pre><h2 id="2-4-race-æ–¹æ³•"><a href="#2-4-race-æ–¹æ³•" class="headerlink" title="2.4 race æ–¹æ³•"></a>2.4 race æ–¹æ³•</h2><p>åªè¦æœ‰ä¸€ä¸ªpromiseæˆåŠŸï¼Œå°±ä¼šæ‰§è¡ŒæˆåŠŸçš„å›è°ƒï¼Œå‚æ•°æ˜¯ç”±promiseç»„æˆçš„æ•°ç»„</p>
<pre><code>Promise.race=function (promises) {
  return new Promise(function (resolve, reject) {
    for(let i=0;i&lt;promises.length;i++){
      promises[i].then(resolve,reject);
    }
  })
}
</code></pre><h2 id="2-5-resolveæ–¹æ³•"><a href="#2-5-resolveæ–¹æ³•" class="headerlink" title="2.5 resolveæ–¹æ³•"></a>2.5 resolveæ–¹æ³•</h2><pre><code>Promise.resolve = function (value) {
  return new Promise(function (resolve, reject) {
    resolve(value)
  })
}
</code></pre><h2 id="2-6-reject-æ–¹æ³•"><a href="#2-6-reject-æ–¹æ³•" class="headerlink" title="2.6 reject æ–¹æ³•"></a>2.6 reject æ–¹æ³•</h2><pre><code>Promise.reject = function (reason) {
  return new Promise(function (resolve, reject) {
    reject(reason);
  })
}
</code></pre><h1 id="3-Promiseå¯¹è±¡çš„ç¼ºç‚¹ï¼š"><a href="#3-Promiseå¯¹è±¡çš„ç¼ºç‚¹ï¼š" class="headerlink" title="3.Promiseå¯¹è±¡çš„ç¼ºç‚¹ï¼š"></a>3.<code>Promise</code>å¯¹è±¡çš„ç¼ºç‚¹ï¼š</h1><ul>
<li><p>1ã€æ— æ³•å–æ¶ˆ<code>Promise</code>ï¼Œä¸€æ—¦æ–°å»ºå®ƒå°±ä¼šç«‹å³æ‰§è¡Œï¼Œæ— æ³•ä¸­é€”å–æ¶ˆã€‚</p>
</li>
<li><p>2ã€å¦‚æœä¸è®¾ç½®å›è°ƒå‡½æ•°ï¼Œ<code>Promise</code>å†…éƒ¨æŠ›å‡ºçš„é”™è¯¯ï¼Œä¸ä¼šååº”åˆ°å¤–éƒ¨ã€‚</p>
</li>
<li><p>3ã€å½“å¤„äº<code>Pending</code>çŠ¶æ€æ—¶ï¼Œæ— æ³•å¾—çŸ¥ç›®å‰è¿›å±•åˆ°å“ªä¸€ä¸ªé˜¶æ®µï¼ˆåˆšåˆšå¼€å§‹è¿˜æ˜¯å³å°†å®Œæˆï¼‰ã€‚</p>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/15/vue-routeræµ…æåŸç†/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/15/vue-routeræµ…æåŸç†/" itemprop="url">vue-routeræµ…æåŸç†</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-11-15T13:06:49+08:00">
                2017-11-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>è¿‘æœŸè¢«é—®åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨ä½ ä»¬é¡¹ç›®ä¸­ä½¿ç”¨çš„æ˜¯Vueçš„SPAï¼ˆå•é¡µé¢ï¼‰è¿˜æ˜¯Vueçš„å¤šé¡µé¢è®¾è®¡ï¼Ÿ</p>
<p>è¿™ç¯‡æ–‡ç« ä¸»è¦å›´ç»•Vueçš„SPAå•é¡µé¢è®¾è®¡å±•å¼€ã€‚<br>å…³äºå¦‚ä½•å±•å¼€Vueå¤šé¡µé¢è®¾è®¡<a href="https://link.juejin.im?target=https%3A%2F%2Fjuejin.im%2Fpost%2F5a8e3f00f265da4e747fc700" target="_blank" rel="noopener">è¯·ç‚¹å‡»æŸ¥çœ‹</a>ã€‚</p>
<h2 id="vue-routeræ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#vue-routeræ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="vue-routeræ˜¯ä»€ä¹ˆï¼Ÿ"></a>vue-routeræ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“vue-routeræ˜¯ä»€ä¹ˆï¼Œå®ƒæ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿ</p>
<p>è¿™é‡ŒæŒ‡çš„è·¯ç”±å¹¶ä¸æ˜¯æŒ‡æˆ‘ä»¬å¹³æ—¶æ‰€è¯´çš„ç¡¬ä»¶è·¯ç”±å™¨ï¼Œè¿™é‡Œçš„è·¯ç”±å°±æ˜¯SPAï¼ˆå•é¡µåº”ç”¨ï¼‰çš„è·¯å¾„ç®¡ç†å™¨ã€‚<br>æ¢å¥è¯è¯´ï¼Œvue-routerå°±æ˜¯WebAppçš„é“¾æ¥è·¯å¾„ç®¡ç†ç³»ç»Ÿã€‚</p>
<p>vue-routeræ˜¯Vue.jså®˜æ–¹çš„è·¯ç”±æ’ä»¶ï¼Œå®ƒå’Œvue.jsæ˜¯æ·±åº¦é›†æˆçš„ï¼Œé€‚åˆç”¨äºæ„å»ºå•é¡µé¢åº”ç”¨ã€‚</p>
<p>é‚£ä¸ä¼ ç»Ÿçš„é¡µé¢è·³è½¬æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</p>
<p>1.vueçš„å•é¡µé¢åº”ç”¨æ˜¯åŸºäºè·¯ç”±å’Œç»„ä»¶çš„ï¼Œè·¯ç”±ç”¨äºè®¾å®šè®¿é—®è·¯å¾„ï¼Œå¹¶å°†è·¯å¾„å’Œç»„ä»¶æ˜ å°„èµ·æ¥ã€‚</p>
<p>2.ä¼ ç»Ÿçš„é¡µé¢åº”ç”¨ï¼Œæ˜¯ç”¨ä¸€äº›è¶…é“¾æ¥æ¥å®ç°é¡µé¢åˆ‡æ¢å’Œè·³è½¬çš„ã€‚</p>
<p>åœ¨vue-routerå•é¡µé¢åº”ç”¨ä¸­ï¼Œåˆ™æ˜¯è·¯å¾„ä¹‹é—´çš„åˆ‡æ¢ï¼Œä¹Ÿå°±æ˜¯ç»„ä»¶çš„åˆ‡æ¢ã€‚è·¯ç”±æ¨¡å—çš„æœ¬è´¨ å°±æ˜¯å»ºç«‹èµ·urlå’Œé¡µé¢ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚</p>
<p>è‡³äºä¸ºå•¥ä¸èƒ½ç”¨aæ ‡ç­¾ï¼Œè¿™æ˜¯å› ä¸ºç”¨Vueåšçš„éƒ½æ˜¯å•é¡µåº”ç”¨ï¼Œå°±ç›¸å½“äºåªæœ‰ä¸€ä¸ªä¸»çš„index.htmlé¡µé¢ï¼Œæ‰€ä»¥ä½ å†™çš„æ ‡ç­¾æ˜¯ä¸èµ·ä½œç”¨çš„ï¼Œå¿…é¡»ä½¿ç”¨vue-routeræ¥è¿›è¡Œç®¡ç†ã€‚</p>
<h2 id="vue-routerå®ç°åŸç†"><a href="#vue-routerå®ç°åŸç†" class="headerlink" title="vue-routerå®ç°åŸç†"></a>vue-routerå®ç°åŸç†</h2><p>SPA(single page application):å•ä¸€é¡µé¢åº”ç”¨ç¨‹åºï¼Œæœ‰ä¸”åªæœ‰ä¸€ä¸ªå®Œæ•´çš„é¡µé¢ï¼›å½“å®ƒåœ¨åŠ è½½é¡µé¢çš„æ—¶å€™ï¼Œä¸ä¼šåŠ è½½æ•´ä¸ªé¡µé¢çš„å†…å®¹ï¼Œè€Œåªæ›´æ–°æŸä¸ªæŒ‡å®šçš„å®¹å™¨ä¸­å†…å®¹ã€‚</p>
<p>å•é¡µé¢åº”ç”¨(SPA)çš„æ ¸å¿ƒä¹‹ä¸€æ˜¯:</p>
<p>1.æ›´æ–°è§†å›¾è€Œä¸é‡æ–°è¯·æ±‚é¡µé¢;</p>
<p>2.vue-routeråœ¨å®ç°å•é¡µé¢å‰ç«¯è·¯ç”±æ—¶ï¼Œæä¾›äº†ä¸‰ç§æ–¹å¼ï¼šHashæ¨¡å¼ã€Historyæ¨¡å¼ã€abstractæ¨¡å¼ï¼Œæ ¹æ®modeå‚æ•°æ¥å†³å®šé‡‡ç”¨å“ªä¸€ç§æ–¹å¼ã€‚</p>
<h4 id="è·¯ç”±æ¨¡å¼"><a href="#è·¯ç”±æ¨¡å¼" class="headerlink" title="è·¯ç”±æ¨¡å¼"></a>è·¯ç”±æ¨¡å¼</h4><p>vue-router æä¾›äº†ä¸‰ç§è¿è¡Œæ¨¡å¼ï¼š</p>
<p>â— hash: ä½¿ç”¨ URL hash å€¼æ¥ä½œè·¯ç”±ã€‚é»˜è®¤æ¨¡å¼ã€‚</p>
<p>â— history: ä¾èµ– HTML5 History API å’ŒæœåŠ¡å™¨é…ç½®ã€‚æŸ¥çœ‹ HTML5 History æ¨¡å¼ã€‚</p>
<p>â— abstract: æ”¯æŒæ‰€æœ‰ JavaScript è¿è¡Œç¯å¢ƒï¼Œå¦‚ Node.js æœåŠ¡å™¨ç«¯ã€‚</p>
<h3 id="Hashæ¨¡å¼"><a href="#Hashæ¨¡å¼" class="headerlink" title="Hashæ¨¡å¼"></a>Hashæ¨¡å¼</h3><p><strong>vue-router é»˜è®¤æ¨¡å¼æ˜¯ hash æ¨¡å¼ â€”â€” ä½¿ç”¨ URL çš„ hash æ¥æ¨¡æ‹Ÿä¸€ä¸ªå®Œæ•´çš„ URLï¼Œå½“ URL æ”¹å˜æ—¶ï¼Œé¡µé¢ä¸ä¼šå»é‡æ–°åŠ è½½</strong>ã€‚</p>
<p>hashï¼ˆ#ï¼‰æ˜¯URL çš„é”šç‚¹ï¼Œä»£è¡¨çš„æ˜¯ç½‘é¡µä¸­çš„ä¸€ä¸ªä½ç½®ï¼Œå•å•æ”¹å˜#åçš„éƒ¨åˆ†ï¼ˆ/#/..ï¼‰ï¼Œæµè§ˆå™¨åªä¼šåŠ è½½ç›¸åº”ä½ç½®çš„å†…å®¹ï¼Œä¸ä¼šé‡æ–°åŠ è½½ç½‘é¡µï¼Œä¹Ÿå°±æ˜¯è¯´ #æ˜¯ç”¨æ¥æŒ‡å¯¼æµè§ˆå™¨åŠ¨ä½œçš„ï¼Œå¯¹æœåŠ¡å™¨ç«¯å®Œå…¨æ— ç”¨ï¼ŒHTTPè¯·æ±‚ä¸­ä¸åŒ…æ‹¬#ï¼›åŒæ—¶æ¯ä¸€æ¬¡æ”¹å˜#åçš„éƒ¨åˆ†ï¼Œéƒ½ä¼šåœ¨æµè§ˆå™¨çš„è®¿é—®å†å²ä¸­å¢åŠ ä¸€ä¸ªè®°å½•ï¼Œä½¿ç”¨â€åé€€â€æŒ‰é’®ï¼Œå°±å¯ä»¥å›åˆ°ä¸Šä¸€ä¸ªä½ç½®ï¼›<strong>æ‰€ä»¥è¯´Hashæ¨¡å¼é€šè¿‡é”šç‚¹å€¼çš„æ”¹å˜ï¼Œæ ¹æ®ä¸åŒçš„å€¼ï¼Œæ¸²æŸ“æŒ‡å®šDOMä½ç½®çš„ä¸åŒæ•°æ®</strong>ã€‚</p>
<h3 id="Historyæ¨¡å¼"><a href="#Historyæ¨¡å¼" class="headerlink" title="Historyæ¨¡å¼"></a>Historyæ¨¡å¼</h3><p>HTML5 History APIæä¾›äº†ä¸€ç§åŠŸèƒ½ï¼Œèƒ½è®©å¼€å‘äººå‘˜åœ¨ä¸åˆ·æ–°æ•´ä¸ªé¡µé¢çš„æƒ…å†µä¸‹ä¿®æ”¹ç«™ç‚¹çš„URLï¼Œå°±æ˜¯åˆ©ç”¨ history.pushState API æ¥å®Œæˆ URL è·³è½¬è€Œæ— é¡»é‡æ–°åŠ è½½é¡µé¢ï¼›</p>
<p>ç”±äºhashæ¨¡å¼ä¼šåœ¨urlä¸­è‡ªå¸¦#ï¼Œå¦‚æœä¸æƒ³è¦å¾ˆä¸‘çš„ hashï¼Œæˆ‘ä»¬å¯ä»¥ç”¨è·¯ç”±çš„ history æ¨¡å¼ï¼Œåªéœ€è¦åœ¨é…ç½®è·¯ç”±è§„åˆ™æ—¶ï¼ŒåŠ å…¥â€mode: â€˜historyâ€™â€,è¿™ç§æ¨¡å¼å……åˆ†åˆ©ç”¨ history.pushState API æ¥å®Œæˆ URL è·³è½¬è€Œæ— é¡»é‡æ–°åŠ è½½é¡µé¢ã€‚</p>
<pre><code>//main.jsæ–‡ä»¶ä¸­
const router = new VueRouter({
  mode: &apos;history&apos;,
  routes: [...]
})
</code></pre><p>å½“ä½¿ç”¨ history æ¨¡å¼æ—¶ï¼ŒURL å°±åƒæ­£å¸¸çš„ urlï¼Œä¾‹å¦‚ <a href="https://link.juejin.im?target=http%3A%2F%2Fyoursite.com%2Fuser%2Fid%25EF%25BC%258C%25E6%25AF%2594%25E8%25BE%2583%25E5%25A5%25BD%25E7%259C%258B%25EF%25BC%2581" target="_blank" rel="noopener">yoursite.com/user/idï¼Œæ¯”è¾ƒå¥½â€¦</a><br>ä¸è¿‡è¿™ç§æ¨¡å¼è¦ç©å¥½ï¼Œè¿˜éœ€è¦åå°é…ç½®æ”¯æŒã€‚å› ä¸ºæˆ‘ä»¬çš„åº”ç”¨æ˜¯ä¸ªå•é¡µå®¢æˆ·ç«¯åº”ç”¨ï¼Œå¦‚æœåå°æ²¡æœ‰æ­£ç¡®çš„é…ç½®ï¼Œå½“ç”¨æˆ·åœ¨æµè§ˆå™¨ç›´æ¥è®¿é—®</p>
<p>æ‰€ä»¥å‘¢ï¼Œä½ è¦åœ¨æœåŠ¡ç«¯å¢åŠ ä¸€ä¸ªè¦†ç›–æ‰€æœ‰æƒ…å†µçš„å€™é€‰èµ„æºï¼šå¦‚æœ URL åŒ¹é…ä¸åˆ°ä»»ä½•é™æ€èµ„æºï¼Œåˆ™åº”è¯¥è¿”å›åŒä¸€ä¸ª index.html é¡µé¢ï¼Œè¿™ä¸ªé¡µé¢å°±æ˜¯ä½  app ä¾èµ–çš„é¡µé¢ã€‚</p>
<pre><code>export const routes = [ 
  {path: &quot;/&quot;, name: &quot;homeLink&quot;, component:Home}
  {path: &quot;/register&quot;, name: &quot;registerLink&quot;, component: Register},
  {path: &quot;/login&quot;, name: &quot;loginLink&quot;, component: Login},
  {path: &quot;*&quot;, redirect: &quot;/&quot;}]
</code></pre><p>æ­¤å¤„å°±è®¾ç½®å¦‚æœURLè¾“å…¥é”™è¯¯æˆ–è€…æ˜¯URL åŒ¹é…ä¸åˆ°ä»»ä½•é™æ€èµ„æºï¼Œå°±è‡ªåŠ¨è·³åˆ°åˆ°Homeé¡µé¢ã€‚</p>
<h3 id="abstractæ¨¡å¼"><a href="#abstractæ¨¡å¼" class="headerlink" title="abstractæ¨¡å¼"></a>abstractæ¨¡å¼</h3><p>abstractæ¨¡å¼æ˜¯ä½¿ç”¨ä¸€ä¸ªä¸ä¾èµ–äºæµè§ˆå™¨çš„æµè§ˆå†å²è™šæ‹Ÿç®¡ç†åç«¯ã€‚</p>
<p>æ ¹æ®å¹³å°å·®å¼‚å¯ä»¥çœ‹å‡ºï¼Œåœ¨ Weex ç¯å¢ƒä¸­åªæ”¯æŒä½¿ç”¨ abstract æ¨¡å¼ã€‚ ä¸è¿‡ï¼Œvue-router è‡ªèº«ä¼šå¯¹ç¯å¢ƒåšæ ¡éªŒï¼Œå¦‚æœå‘ç°æ²¡æœ‰æµè§ˆå™¨çš„ APIï¼Œvue-router ä¼šè‡ªåŠ¨å¼ºåˆ¶è¿›å…¥ abstract æ¨¡å¼ï¼Œæ‰€ä»¥ åœ¨ä½¿ç”¨ vue-router æ—¶åªè¦ä¸å†™ mode é…ç½®å³å¯ï¼Œé»˜è®¤ä¼šåœ¨æµè§ˆå™¨ç¯å¢ƒä¸­ä½¿ç”¨ hash æ¨¡å¼ï¼Œåœ¨ç§»åŠ¨ç«¯åŸç”Ÿç¯å¢ƒä¸­ä½¿ç”¨ abstract æ¨¡å¼ã€‚ ï¼ˆå½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥æ˜ç¡®æŒ‡å®šåœ¨æ‰€æœ‰æƒ…å†µä¸‹éƒ½ä½¿ç”¨ abstract æ¨¡å¼ï¼‰</p>
<h2 id="vue-routerä½¿ç”¨æ–¹å¼"><a href="#vue-routerä½¿ç”¨æ–¹å¼" class="headerlink" title="vue-routerä½¿ç”¨æ–¹å¼"></a>vue-routerä½¿ç”¨æ–¹å¼</h2><p><strong>1:ä¸‹è½½</strong> npm i vue-router -S</p>
<p><strong>2:åœ¨main.jsä¸­å¼•å…¥ </strong> import VueRouter from â€˜vue-routerâ€™;</p>
<p><strong>3:å®‰è£…æ’ä»¶</strong> Vue.use(VueRouter);</p>
<p><strong>4:åˆ›å»ºè·¯ç”±å¯¹è±¡å¹¶é…ç½®è·¯ç”±è§„åˆ™</strong></p>
<p>let router = new VueRouter({routes:[{path:â€™/homeâ€™,component:Home}]});</p>
<p><strong>5:å°†å…¶è·¯ç”±å¯¹è±¡ä¼ é€’ç»™Vueçš„å®ä¾‹</strong>ï¼Œoptionsä¸­åŠ å…¥ router:router</p>
<p><strong>6:åœ¨app.vueä¸­ç•™å‘</strong></p>
<pre><code>&lt;router-view&gt;&lt;/router-view&gt;
</code></pre><p>å…·ä½“å®ç°è¯·çœ‹å¦‚ä¸‹ä»£ç ï¼š</p>
<pre><code>//main.jsæ–‡ä»¶ä¸­å¼•å…¥
import Vue from &apos;vue&apos;;
import VueRouter from &apos;vue-router&apos;;
//ä¸»ä½“
import App from &apos;./components/app.vue&apos;;
import index from &apos;./components/index.vue&apos;
//å®‰è£…æ’ä»¶
Vue.use(VueRouter); //æŒ‚è½½å±æ€§
//åˆ›å»ºè·¯ç”±å¯¹è±¡å¹¶é…ç½®è·¯ç”±è§„åˆ™
let router = new VueRouter({
    routes: [
        //ä¸€ä¸ªä¸ªå¯¹è±¡
        { path: &apos;/index&apos;, component: index }
    ]
});
//new Vue å¯åŠ¨
new Vue({
    el: &apos;#app&apos;,
    //è®©vueçŸ¥é“æˆ‘ä»¬çš„è·¯ç”±è§„åˆ™
    router: router, //å¯ä»¥ç®€å†™router
    render: c =&gt; c(App),
})
</code></pre><p>æœ€åè®°å¾—åœ¨åœ¨app.vueä¸­â€œç•™å‘â€</p>
<pre><code>//app.vueä¸­
&lt;template&gt;
    &lt;div&gt;
        &lt;!-- ç•™å‘ï¼Œéå¸¸é‡è¦ --&gt;
        &lt;router-view&gt;&lt;/router-view&gt;
    &lt;/div&gt;
&lt;/template&gt;
&lt;script&gt;
    export default {
        data(){
            return {}
        }
    }
&lt;/script&gt;
</code></pre><h2 id="vue-routeræºç åˆ†æ"><a href="#vue-routeræºç åˆ†æ" class="headerlink" title="vue-routeræºç åˆ†æ"></a>vue-routeræºç åˆ†æ</h2><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹vueçš„å®ç°è·¯å¾„ã€‚<br><img src="https://user-gold-cdn.xitu.io/2018/10/18/16684f162d3090eb?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""><br>åœ¨å…¥å£æ–‡ä»¶ä¸­éœ€è¦å®ä¾‹åŒ–ä¸€ä¸ª VueRouter çš„å®ä¾‹å¯¹è±¡ ï¼Œç„¶åå°†å…¶ä¼ å…¥ Vue å®ä¾‹çš„ options ä¸­ã€‚</p>
<pre><code>export default class VueRouter {
  static install: () =&gt; void;
  static version: string;

  app: any;
  apps: Array&lt;any&gt;;
  ready: boolean;
  readyCbs: Array&lt;Function&gt;;
  options: RouterOptions;
  mode: string;
  history: HashHistory | HTML5History | AbstractHistory;
  matcher: Matcher;
  fallback: boolean;
  beforeHooks: Array&lt;?NavigationGuard&gt;;
  resolveHooks: Array&lt;?NavigationGuard&gt;;
  afterHooks: Array&lt;?AfterNavigationHook&gt;;

  constructor (options: RouterOptions = {}) {
    this.app = null
    this.apps = []
    this.options = options
    this.beforeHooks = []
    this.resolveHooks = []
    this.afterHooks = []
    // åˆ›å»º matcher åŒ¹é…å‡½æ•°
    this.matcher = createMatcher(options.routes || [], this)
    // æ ¹æ® mode å®ä¾‹åŒ–å…·ä½“çš„ Historyï¼Œé»˜è®¤ä¸º&apos;hash&apos;æ¨¡å¼
    let mode = options.mode || &apos;hash&apos;
    // é€šè¿‡ supportsPushState åˆ¤æ–­æµè§ˆå™¨æ˜¯å¦æ”¯æŒ&apos;history&apos;æ¨¡å¼
    // å¦‚æœè®¾ç½®çš„æ˜¯&apos;history&apos;ä½†æ˜¯å¦‚æœæµè§ˆå™¨ä¸æ”¯æŒçš„è¯ï¼Œ&apos;history&apos;æ¨¡å¼ä¼šé€€å›åˆ°&apos;hash&apos;æ¨¡å¼
    // fallback æ˜¯å½“æµè§ˆå™¨ä¸æ”¯æŒ history.pushState æ§åˆ¶è·¯ç”±æ˜¯å¦åº”è¯¥å›é€€åˆ° hash æ¨¡å¼ã€‚é»˜è®¤å€¼ä¸º trueã€‚
    this.fallback = mode === &apos;history&apos; &amp;&amp; !supportsPushState &amp;&amp; options.fallback !== falseif (this.fallback) {
      mode = &apos;hash&apos;
    }
    // ä¸åœ¨æµè§ˆå™¨å†…éƒ¨çš„è¯ï¼Œå°±ä¼šå˜æˆ&apos;abstract&apos;æ¨¡å¼
    if (!inBrowser) {
      mode = &apos;abstract&apos;
    }
    this.mode = mode
     // æ ¹æ®ä¸åŒæ¨¡å¼é€‰æ‹©å®ä¾‹åŒ–å¯¹åº”çš„ History ç±»
    switch (mode) {
      case&apos;history&apos;:
        this.history = new HTML5History(this, options.base)
        breakcase&apos;hash&apos;:
        this.history = new HashHistory(this, options.base, this.fallback)
        breakcase&apos;abstract&apos;:
        this.history = new AbstractHistory(this, options.base)
        break
      default:
        if (process.env.NODE_ENV !== &apos;production&apos;) {
          assert(false, `invalid mode: ${mode}`)
        }
    }
  }

  match (
    raw: RawLocation,
    current?: Route,
    redirectedFrom?: Location
  ): Route {
    return this.matcher.match(raw, current, redirectedFrom)
  }

  get currentRoute (): ?Route {
    return this.history &amp;&amp; this.history.current
  }

  init (app: any /* Vue component instance */) {
    process.env.NODE_ENV !== &apos;production&apos; &amp;&amp; assert(
      install.installed,
      `not installed. Make sure to call \`Vue.use(VueRouter)\` ` +
      `before creating root instance.`
    )

    this.apps.push(app)

    // main app already initialized.
    if (this.app) {
      return
    }

    this.app = app

    const history = this.history
    // æ ¹æ®historyçš„ç±»åˆ«æ‰§è¡Œç›¸åº”çš„åˆå§‹åŒ–æ“ä½œå’Œç›‘å¬
    if (history instanceof HTML5History) {
      history.transitionTo(history.getCurrentLocation())
    } elseif (history instanceof HashHistory) {
      const setupHashListener = () =&gt; {
        history.setupListeners()
      }
      history.transitionTo(
        history.getCurrentLocation(),
        setupHashListener,
        setupHashListener
      )
    }

    history.listen(route =&gt; {
      this.apps.forEach((app) =&gt; {
        app._route = route
      })
    })
  }
  // è·¯ç”±è·³è½¬ä¹‹å‰
  beforeEach (fn: Function): Function {
    return registerHook(this.beforeHooks, fn)
  }
  // è·¯ç”±å¯¼èˆªè¢«ç¡®è®¤ä¹‹é—´å‰
  beforeResolve (fn: Function): Function {
    return registerHook(this.resolveHooks, fn)
  }
  // è·¯ç”±è·³è½¬ä¹‹å
  afterEach (fn: Function): Function {
    return registerHook(this.afterHooks, fn)
  }
  // ç¬¬ä¸€æ¬¡è·¯ç”±è·³è½¬å®Œæˆæ—¶è¢«è°ƒç”¨çš„å›è°ƒå‡½æ•°
  onReady (cb: Function, errorCb?: Function) {
    this.history.onReady(cb, errorCb)
  }
  // è·¯ç”±æŠ¥é”™
  onError (errorCb: Function) {
    this.history.onError(errorCb)
  }
  // è·¯ç”±æ·»åŠ ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šå‘historyæ ˆæ·»åŠ ä¸€ä¸ªè®°å½•ï¼Œç‚¹å‡»åé€€ä¼šè¿”å›åˆ°ä¸Šä¸€ä¸ªé¡µé¢ã€‚
  push (location: RawLocation, onComplete?: Function, onAbort?: Function) {
    this.history.push(location, onComplete, onAbort)
  }
  // è¿™ä¸ªæ–¹æ³•ä¸ä¼šå‘historyé‡Œé¢æ·»åŠ æ–°çš„è®°å½•ï¼Œç‚¹å‡»è¿”å›ï¼Œä¼šè·³è½¬åˆ°ä¸Šä¸Šä¸€ä¸ªé¡µé¢ã€‚ä¸Šä¸€ä¸ªè®°å½•æ˜¯ä¸å­˜åœ¨çš„ã€‚
  replace (location: RawLocation, onComplete?: Function, onAbort?: Function) {
    this.history.replace(location, onComplete, onAbort)
  }
  // ç›¸å¯¹äºå½“å‰é¡µé¢å‘å‰æˆ–å‘åè·³è½¬å¤šå°‘ä¸ªé¡µé¢,ç±»ä¼¼ window.history.go(n)ã€‚nå¯ä¸ºæ­£æ•°å¯ä¸ºè´Ÿæ•°ã€‚æ­£æ•°è¿”å›ä¸Šä¸€ä¸ªé¡µé¢
  go (n: number) {
    this.history.go(n)
  }
  // åé€€åˆ°ä¸Šä¸€ä¸ªé¡µé¢
  back () {
    this.go(-1)
  }
  // å‰è¿›åˆ°ä¸‹ä¸€ä¸ªé¡µé¢
  forward () {
    this.go(1)
  }

  getMatchedComponents (to?: RawLocation | Route): Array&lt;any&gt; {
    const route: any = to
      ? to.matched
        ? to
        : this.resolve(to).route
      : this.currentRoute
    if (!route) {
      return []
    }
    return [].concat.apply([], route.matched.map(m =&gt; {
      return Object.keys(m.components).map(key =&gt; {
        return m.components[key]
      })
    }))
  }

  resolve (
    to: RawLocation,
    current?: Route,
    append?: boolean
  ): {
    location: Location,
    route: Route,
    href: string,
    // for backwards compat
    normalizedTo: Location,
    resolved: Route
  } {
    const location = normalizeLocation(
      to,
      current || this.history.current,
      append,
      this
    )
    const route = this.match(location, current)
    const fullPath = route.redirectedFrom || route.fullPath
    const base = this.history.base
    const href = createHref(base, fullPath, this.mode)
    return {
      location,
      route,
      href,
      // for backwards compat
      normalizedTo: location,
      resolved: route
    }
  }

  addRoutes (routes: Array&lt;RouteConfig&gt;) {
    this.matcher.addRoutes(routes)
    if (this.history.current !== START) {
      this.history.transitionTo(this.history.getCurrentLocation())
    }
  }
}
</code></pre><h3 id="HashHistory"><a href="#HashHistory" class="headerlink" title="HashHistory"></a>HashHistory</h3><p>â€¢ hashè™½ç„¶å‡ºç°åœ¨urlä¸­ï¼Œä½†ä¸ä¼šè¢«åŒ…æ‹¬åœ¨httpè¯·æ±‚ä¸­ï¼Œå®ƒæ˜¯ç”¨æ¥æŒ‡å¯¼æµè§ˆå™¨åŠ¨ä½œçš„ï¼Œå¯¹æœåŠ¡å™¨ç«¯æ²¡å½±å“ï¼Œå› æ­¤ï¼Œæ”¹å˜hashä¸ä¼šé‡æ–°åŠ è½½é¡µé¢ã€‚</p>
<p>â€¢ å¯ä»¥ä¸ºhashçš„æ”¹å˜æ·»åŠ ç›‘å¬äº‹ä»¶ï¼š</p>
<pre><code>window.addEventListener(&quot;hashchange&quot;,funcRef,false)
</code></pre><p>â€¢ æ¯ä¸€æ¬¡æ”¹å˜hash(window.location.hash)ï¼Œéƒ½ä¼šåœ¨æµè§ˆå™¨è®¿é—®å†å²ä¸­å¢åŠ ä¸€ä¸ªè®°å½•ã€‚</p>
<pre><code>export class HashHistory extends History {
  constructor (router: Router, base: ?string, fallback: boolean) {
    super(router, base)
    // check history fallback deeplinking
    // å¦‚æœæ˜¯ä»historyæ¨¡å¼é™çº§æ¥çš„ï¼Œéœ€è¦åšé™çº§æ£€æŸ¥
    if (fallback &amp;&amp; checkFallback(this.base)) {
    // å¦‚æœé™çº§ä¸”åšäº†é™çº§å¤„ç†ï¼Œåˆ™è¿”å›
      return
    }
    ensureSlash()
  }
  .......


function checkFallback (base) {
  const location = getLocation(base)
  // å¾—åˆ°é™¤å»baseçš„çœŸæ­£çš„ location å€¼
  if (!/^\/#/.test(location)) {
  // å¦‚æœæ­¤æ—¶åœ°å€ä¸æ˜¯ä»¥ /# å¼€å¤´çš„
  // éœ€è¦åšä¸€æ¬¡é™çº§å¤„ç†ï¼Œé™ä¸º hash æ¨¡å¼ä¸‹åº”æœ‰çš„ /# å¼€å¤´
    window.location.replace(
      cleanPath(base + &apos;/#&apos; + location)
    )
    returntrue
  }
}

function ensureSlash (): boolean {
// å¾—åˆ° hash å€¼
  const path = getHash()
  if (path.charAt(0) === &apos;/&apos;) {
   // å¦‚æœæ˜¯ä»¥ / å¼€å¤´çš„ï¼Œç›´æ¥è¿”å›å³å¯
    returntrue
  }
  // ä¸æ˜¯çš„è¯ï¼Œéœ€è¦æ‰‹åŠ¨ä¿è¯ä¸€æ¬¡ æ›¿æ¢ hash å€¼
  replaceHash(&apos;/&apos; + path)
  returnfalse
}

exportfunction getHash (): string {
  // We can&apos;t use window.location.hash here because it&apos;s not
  // consistent across browsers - Firefox will pre-decode it!
  // å› ä¸ºå…¼å®¹æ€§çš„é—®é¢˜ï¼Œè¿™é‡Œæ²¡æœ‰ç›´æ¥ä½¿ç”¨ window.location.hash
  // å› ä¸º Firefox decode hash å€¼
  const href = window.location.href
  const index = href.indexOf(&apos;#&apos;)
  return index === -1 ? &apos;&apos; : decodeURI(href.slice(index + 1))
}
// å¾—åˆ°hashä¹‹å‰çš„urlåœ°å€
function getUrl (path) {
  const href = window.location.href
  const i = href.indexOf(&apos;#&apos;)
  const base = i &gt;= 0 ? href.slice(0, i) : href
  return `${base}#${path}`
}
// æ·»åŠ ä¸€ä¸ªhashfunction pushHash (path) {
  if (supportsPushState) {
    pushState(getUrl(path))
  } else {
    window.location.hash = path
  }
}
// æ›¿ä»£hashfunction replaceHash (path) {
  if (supportsPushState) {
    replaceState(getUrl(path))
  } else {
    window.location.replace(getUrl(path))
  }
}
</code></pre><p>hashçš„æ”¹å˜ä¼šè‡ªåŠ¨æ·»åŠ åˆ°æµè§ˆå™¨çš„è®¿é—®å†å²è®°å½•ä¸­ã€‚ é‚£ä¹ˆè§†å›¾çš„æ›´æ–°æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Œçœ‹ä¸‹ transitionTo()æ–¹æ³•ï¼š</p>
<pre><code>transitionTo (location: RawLocation, onComplete?: Function, onAbort?: Function) {
    const route = this.router.match(location, this.current) //æ‰¾åˆ°åŒ¹é…è·¯ç”±
    this.confirmTransition(route, () =&gt; { //ç¡®è®¤æ˜¯å¦è½¬åŒ–
      this.updateRoute(route) //æ›´æ–°route
      onComplete &amp;&amp; onComplete(route)
      this.ensureURL()

      // fire ready cbs once
      if (!this.ready) {
        this.ready = true
        this.readyCbs.forEach(cb =&gt; { cb(route) })
      }
    }, err =&gt; {
      if (onAbort) {
        onAbort(err)
      }
      if (err &amp;&amp; !this.ready) {
        this.ready = true
        this.readyErrorCbs.forEach(cb =&gt; { cb(err) })
      }
    })
  }

//æ›´æ–°è·¯ç”±
updateRoute (route: Route) {
    const prev = this.current // è·³è½¬å‰è·¯ç”±
    this.current = route // è£…å¤‡è·³è½¬è·¯ç”±
    this.cb &amp;&amp; this.cb(route) // å›è°ƒå‡½æ•°ï¼Œè¿™ä¸€æ­¥å¾ˆé‡è¦ï¼Œè¿™ä¸ªå›è°ƒå‡½æ•°åœ¨indexæ–‡ä»¶ä¸­æ³¨å†Œï¼Œä¼šæ›´æ–°è¢«åŠ«æŒçš„æ•°æ® _router
    this.router.afterHooks.forEach(hook =&gt; {
      hook &amp;&amp; hook(route, prev)
    })
  }
}
</code></pre><h4 id="pushState"><a href="#pushState" class="headerlink" title="pushState"></a>pushState</h4><pre><code>exportfunction pushState (url?: string, replace?: boolean) {
  saveScrollPosition()
  // try...catch the pushState call to get around Safari
  // DOM Exception 18 where it limits to 100 pushState calls
  // åŠ äº† try...catch æ˜¯å› ä¸º Safari æœ‰è°ƒç”¨ pushState 100 æ¬¡é™åˆ¶
  // ä¸€æ—¦è¾¾åˆ°å°±ä¼šæŠ›å‡º DOM Exception 18 é”™è¯¯
  const history = window.history
  try {
    if (replace) {
    // replace çš„è¯ key è¿˜æ˜¯å½“å‰çš„ key æ²¡å¿…è¦ç”Ÿæˆæ–°çš„
      history.replaceState({ key: _key }, &apos;&apos;, url)
    } else {
    // é‡æ–°ç”Ÿæˆ key
      _key = genKey()
       // å¸¦å…¥æ–°çš„ key å€¼
      history.pushState({ key: _key }, &apos;&apos;, url)
    }
  } catch (e) {
  // è¾¾åˆ°é™åˆ¶äº† åˆ™é‡æ–°æŒ‡å®šæ–°çš„åœ°å€
    window.location[replace ? &apos;replace&apos; : &apos;assign&apos;](url)
  }
}
</code></pre><h4 id="replaceState"><a href="#replaceState" class="headerlink" title="replaceState"></a>replaceState</h4><pre><code>// ç›´æ¥è°ƒç”¨ pushState ä¼ å…¥ replace ä¸º trueexportfunction replaceState (url?: string) {
  pushState(url, true)
}
</code></pre><p>pushStateå’ŒreplaceStateä¸¤ç§æ–¹æ³•çš„å…±åŒç‰¹ç‚¹ï¼šå½“è°ƒç”¨ä»–ä»¬ä¿®æ”¹æµè§ˆå™¨å†å²æ ˆåï¼Œè™½ç„¶å½“å‰urlæ”¹å˜äº†ï¼Œä½†æµè§ˆå™¨ä¸ä¼šç«‹å³å‘é€è¯·æ±‚è¯¥urlï¼Œè¿™å°±ä¸ºå•é¡µåº”ç”¨å‰ç«¯è·¯ç”±ï¼Œæ›´æ–°è§†å›¾ä½†ä¸é‡æ–°è¯·æ±‚é¡µé¢æä¾›äº†åŸºç¡€ã€‚</p>
<h4 id="supportsPushState"><a href="#supportsPushState" class="headerlink" title="supportsPushState"></a>supportsPushState</h4><pre><code>export const supportsPushState = inBrowser &amp;&amp; (function () {
  const ua = window.navigator.userAgent

  if (
    (ua.indexOf(&apos;Android 2.&apos;) !== -1 || ua.indexOf(&apos;Android 4.0&apos;) !== -1) &amp;&amp;
    ua.indexOf(&apos;Mobile Safari&apos;) !== -1 &amp;&amp;
    ua.indexOf(&apos;Chrome&apos;) === -1 &amp;&amp;
    ua.indexOf(&apos;Windows Phone&apos;) === -1
  ) {
    returnfalse
  }

  return window.history &amp;&amp; &apos;pushState&apos;in window.history
})()
</code></pre><p>å…¶å®æ‰€è°“å“åº”å¼å±æ€§ï¼Œå³å½“_routeå€¼æ”¹å˜æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨Vueå®ä¾‹çš„render()æ–¹æ³•ï¼Œæ›´æ–°è§†å›¾ã€‚<br>$router.push()â€“&gt;HashHistory.push()â€“&gt;History.transitionTo()â€“&gt;History.updateRoute()â€“&gt;{app._route=route}â€“&gt;vm.render()</p>
<h4 id="ç›‘å¬åœ°å€æ "><a href="#ç›‘å¬åœ°å€æ " class="headerlink" title="ç›‘å¬åœ°å€æ "></a>ç›‘å¬åœ°å€æ </h4><p>åœ¨æµè§ˆå™¨ä¸­ï¼Œç”¨æˆ·å¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨åœ°å€æ ä¸­è¾“å…¥æ”¹å˜è·¯ç”±ï¼Œå› æ­¤è¿˜éœ€è¦ç›‘å¬æµè§ˆå™¨åœ°å€æ ä¸­è·¯ç”±çš„å˜åŒ– ï¼Œå¹¶å…·æœ‰ä¸é€šè¿‡ä»£ç è°ƒç”¨ç›¸åŒçš„å“åº”è¡Œä¸ºï¼Œåœ¨HashHistoryä¸­è¿™ä¸€åŠŸèƒ½é€šè¿‡setupListenersç›‘å¬hashchangeå®ç°ï¼š</p>
<pre><code>setupListeners () {
    window.addEventListener(&apos;hashchange&apos;, () =&gt; {
        if (!ensureSlash()) {
            return
        }
        this.transitionTo(getHash(), route =&gt; {
            replaceHash(route.fullPath)
        })
    })
}
</code></pre><h3 id="HTML5History"><a href="#HTML5History" class="headerlink" title="HTML5History"></a>HTML5History</h3><p>History interfaceæ˜¯æµè§ˆå™¨å†å²è®°å½•æ ˆæä¾›çš„æ¥å£ï¼Œé€šè¿‡back(),forward(),go()ç­‰æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥è¯»å–æµè§ˆå™¨å†å²è®°å½•æ ˆçš„ä¿¡æ¯ï¼Œè¿›è¡Œå„ç§è·³è½¬æ“ä½œã€‚</p>
<pre><code>export class HTML5History extends History {
  constructor (router: Router, base: ?string) {
    super(router, base)

    const expectScroll = router.options.scrollBehavior //æŒ‡å›æ»šæ–¹å¼
    const supportsScroll = supportsPushState &amp;&amp; expectScroll

    if (supportsScroll) {
      setupScroll()
    }

    const initLocation = getLocation(this.base)
    //ç›‘æ§popstateäº‹ä»¶
    window.addEventListener(&apos;popstate&apos;, e =&gt; {
      const current = this.current

      // Avoiding first `popstate` event dispatched in some browsers but first
      // history route not updated since async guard at the same time.
      // é¿å…åœ¨æŸäº›æµè§ˆå™¨ä¸­é¦–æ¬¡å‘å‡ºâ€œpopstateâ€äº‹ä»¶
      // ç”±äºåŒä¸€æ—¶é—´å¼‚æ­¥ç›‘å¬ï¼Œhistoryè·¯ç”±æ²¡æœ‰åŒæ—¶æ›´æ–°ã€‚
      const location = getLocation(this.base)
      if (this.current === START &amp;&amp; location === initLocation) {
        return
      }

      this.transitionTo(location, route =&gt; {
        if (supportsScroll) {
          handleScroll(router, route, current, true)
        }
      })
    })
  }
</code></pre><p>hashæ¨¡å¼ä»…æ”¹å˜hashéƒ¨åˆ†çš„å†…å®¹ï¼Œè€Œhashéƒ¨åˆ†æ˜¯ä¸ä¼šåŒ…å«åœ¨httpè¯·æ±‚ä¸­çš„(hashå¸¦#)ï¼š</p>
<p><a href="https://link.juejin.im?target=http%3A%2F%2Foursite.com%2F%23%2Fuser%2Fid" target="_blank" rel="noopener">oursite.com/#/user/id</a> //å¦‚è¯·æ±‚ï¼Œåªä¼šå‘é€<a href="http://oursite.com/" target="_blank" rel="noopener">http://oursite.com/</a></p>
<p>æ‰€ä»¥hashæ¨¡å¼ä¸‹é‡åˆ°æ ¹æ®urlè¯·æ±‚é¡µé¢ä¸ä¼šæœ‰é—®é¢˜</p>
<p>è€Œhistoryæ¨¡å¼åˆ™å°†urlä¿®æ”¹çš„å°±å’Œæ­£å¸¸è¯·æ±‚åç«¯çš„urlä¸€æ ·(historyä¸å¸¦#)</p>
<p><a href="https://link.juejin.im?target=http%3A%2F%2Foursite.com%2Fuser%2Fid" target="_blank" rel="noopener">oursite.com/user/id</a></p>
<p>å¦‚æœè¿™ç§å‘åç«¯å‘é€è¯·æ±‚çš„è¯ï¼Œåç«¯æ²¡æœ‰é…ç½®å¯¹åº”/user/idçš„getè·¯ç”±å¤„ç†,ä¼šè¿”å›404é”™è¯¯ã€‚</p>
<p>å®˜æ–¹æ¨èçš„è§£å†³åŠæ³•æ˜¯åœ¨æœåŠ¡ç«¯å¢åŠ ä¸€ä¸ªè¦†ç›–æ‰€æœ‰æƒ…å†µçš„å€™é€‰èµ„æºï¼šå¦‚æœ URL åŒ¹é…ä¸åˆ°ä»»ä½•é™æ€èµ„æºï¼Œåˆ™åº”è¯¥è¿”å›åŒä¸€ä¸ª index.html é¡µé¢ï¼Œè¿™ä¸ªé¡µé¢å°±æ˜¯ä½  app ä¾èµ–çš„é¡µé¢ã€‚åŒæ—¶è¿™ä¹ˆåšä»¥åï¼ŒæœåŠ¡å™¨å°±ä¸å†è¿”å› 404 é”™è¯¯é¡µé¢ï¼Œå› ä¸ºå¯¹äºæ‰€æœ‰è·¯å¾„éƒ½ä¼šè¿”å› index.html æ–‡ä»¶ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œåœ¨ Vue åº”ç”¨é‡Œé¢è¦†ç›–æ‰€æœ‰çš„è·¯ç”±æƒ…å†µï¼Œç„¶ååœ¨ç»™å‡ºä¸€ä¸ª 404 é¡µé¢ã€‚æˆ–è€…ï¼Œå¦‚æœæ˜¯ç”¨ Node.js ä½œåå°ï¼Œå¯ä»¥ä½¿ç”¨æœåŠ¡ç«¯çš„è·¯ç”±æ¥åŒ¹é… URLï¼Œå½“æ²¡æœ‰åŒ¹é…åˆ°è·¯ç”±çš„æ—¶å€™è¿”å› 404ï¼Œä»è€Œå®ç° fallbackã€‚</p>
<h4 id="ä¸¤ç§æ¨¡å¼æ¯”è¾ƒ"><a href="#ä¸¤ç§æ¨¡å¼æ¯”è¾ƒ" class="headerlink" title="ä¸¤ç§æ¨¡å¼æ¯”è¾ƒ"></a>ä¸¤ç§æ¨¡å¼æ¯”è¾ƒ</h4><p>ä¸€èˆ¬çš„éœ€æ±‚åœºæ™¯ä¸­ï¼Œhashæ¨¡å¼ä¸historyæ¨¡å¼æ˜¯å·®ä¸å¤šçš„ï¼Œæ ¹æ®MDNçš„ä»‹ç»ï¼Œè°ƒç”¨history.pushState()ç›¸æ¯”äºç›´æ¥ä¿®æ”¹hashä¸»è¦æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š</p>
<p>â€¢ pushStateè®¾ç½®çš„æ–°urlå¯ä»¥æ˜¯ä¸å½“å‰urlåŒæºçš„ä»»æ„url,è€Œhashåªå¯ä¿®æ”¹#åé¢çš„éƒ¨åˆ†ï¼Œæ•…åªå¯è®¾ç½®ä¸å½“å‰åŒæ–‡æ¡£çš„url</p>
<p>â€¢ pushStateè®¾ç½®çš„æ–°urlå¯ä»¥ä¸å½“å‰urlä¸€æ¨¡ä¸€æ ·ï¼Œè¿™æ ·ä¹Ÿä¼šæŠŠè®°å½•æ·»åŠ åˆ°æ ˆä¸­ï¼Œè€Œhashè®¾ç½®çš„æ–°å€¼å¿…é¡»ä¸åŸæ¥ä¸ä¸€æ ·æ‰ä¼šè§¦å‘è®°å½•æ·»åŠ åˆ°æ ˆä¸­</p>
<p>â€¢ pushStateé€šè¿‡stateObjectå¯ä»¥æ·»åŠ ä»»æ„ç±»å‹çš„æ•°æ®è®°å½•ä¸­ï¼Œè€Œhashåªå¯æ·»åŠ çŸ­å­—ç¬¦ä¸²<br>pushStateå¯é¢å¤–è®¾ç½®titleå±æ€§ä¾›åç»­ä½¿ç”¨</p>
<h3 id="AbstractHistory"><a href="#AbstractHistory" class="headerlink" title="AbstractHistory"></a>AbstractHistory</h3><p>â€˜abstractâ€™æ¨¡å¼ï¼Œä¸æ¶‰åŠå’Œæµè§ˆå™¨åœ°å€çš„ç›¸å…³è®°å½•ï¼Œæµç¨‹è·Ÿâ€™HashHistoryâ€™æ˜¯ä¸€æ ·çš„ï¼Œå…¶åŸç†æ˜¯é€šè¿‡æ•°ç»„æ¨¡æ‹Ÿæµè§ˆå™¨å†å²è®°å½•æ ˆçš„åŠŸèƒ½</p>
<pre><code>//abstract.jså®ç°ï¼Œè¿™é‡Œé€šè¿‡æ ˆçš„æ•°æ®ç»“æ„æ¥æ¨¡æ‹Ÿè·¯ç”±è·¯å¾„
export class AbstractHistory extends History {
  index: number;
  stack: Array&lt;Route&gt;;

  constructor (router: Router, base: ?string) {
    super(router, base)
    this.stack = []
    this.index = -1
  }

  // å¯¹äº go çš„æ¨¡æ‹Ÿ
  go (n: number) {
    // æ–°çš„å†å²è®°å½•ä½ç½®
    const targetIndex = this.index + n
    // å°äºæˆ–å¤§äºè¶…å‡ºåˆ™è¿”å›
    if (targetIndex &lt; 0 || targetIndex &gt;= this.stack.length) {
      return
    }
    // å–å¾—æ–°çš„ route å¯¹è±¡
    // å› ä¸ºæ˜¯å’Œæµè§ˆå™¨æ— å…³çš„ è¿™é‡Œå¾—åˆ°çš„ä¸€å®šæ˜¯å·²ç»è®¿é—®è¿‡çš„
    const route = this.stack[targetIndex]
    // æ‰€ä»¥è¿™é‡Œç›´æ¥è°ƒç”¨ confirmTransition äº†
    // è€Œä¸æ˜¯è°ƒç”¨ transitionTo è¿˜è¦èµ°ä¸€é match é€»è¾‘
    this.confirmTransition(route, () =&gt; {
      this.index = targetIndex
      this.updateRoute(route)
    })
  }


 //ç¡®è®¤æ˜¯å¦è½¬åŒ–è·¯ç”±
  confirmTransition (route: Route, onComplete: Function, onAbort?: Function) {
    const current = this.current
    const abort = err =&gt; {
      if (isError(err)) {
        if (this.errorCbs.length) {
          this.errorCbs.forEach(cb =&gt; { cb(err) })
        } else {
          warn(false, &apos;uncaught error during route navigation:&apos;)
          console.error(err)
        }
      }
      onAbort &amp;&amp; onAbort(err)
    }
    //åˆ¤æ–­å¦‚æœå‰åæ˜¯åŒä¸€ä¸ªè·¯ç”±ï¼Œä¸è¿›è¡Œæ“ä½œ
    if (
      isSameRoute(route, current) &amp;&amp;
      route.matched.length === current.matched.length
    ) {
      this.ensureURL()
      return abort()
    }
    //ä¸‹é¢æ˜¯å„ç±»é’©å­å‡½æ•°çš„å¤„ç†
    //*********************
    })
  }
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/11/callå’Œapplyçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯null-undefinedæ—¶å‡½æ•°å†…çš„çš„thisæŒ‡å‘windowæˆ–global/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/11/callå’Œapplyçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯null-undefinedæ—¶å‡½æ•°å†…çš„çš„thisæŒ‡å‘windowæˆ–global/" itemprop="url">callå’Œapplyçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯null/undefinedæ—¶å‡½æ•°å†…çš„çš„thisæŒ‡å‘windowæˆ–global</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-11-11T23:25:16+08:00">
                2017-11-11
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="è°è¯´-JavaScript-å¾ˆç®€å•äº†ï¼Ÿ"><a href="#è°è¯´-JavaScript-å¾ˆç®€å•äº†ï¼Ÿ" class="headerlink" title="è°è¯´ JavaScript å¾ˆç®€å•äº†ï¼Ÿ"></a><a href="https://link.zhihu.com/?target=https%3A//segmentfault.com/a/1190000009024648" target="_blank" rel="noopener">è°è¯´ JavaScript å¾ˆç®€å•äº†ï¼Ÿ</a></h2><h2 id="JavaScriptç³»åˆ—â€”â€”æ•°ç»„å…ƒç´ å·¦å³ç§»åŠ¨Nä½ç®—æ³•å®ç°"><a href="#JavaScriptç³»åˆ—â€”â€”æ•°ç»„å…ƒç´ å·¦å³ç§»åŠ¨Nä½ç®—æ³•å®ç°" class="headerlink" title="JavaScriptç³»åˆ—â€”â€”æ•°ç»„å…ƒç´ å·¦å³ç§»åŠ¨Nä½ç®—æ³•å®ç°"></a><a href="https://link.zhihu.com/?target=https%3A//segmentfault.com/a/1190000012882330" target="_blank" rel="noopener">JavaScriptç³»åˆ—â€”â€”æ•°ç»„å…ƒç´ å·¦å³ç§»åŠ¨Nä½ç®—æ³•å®ç°</a></h2><p>14å¹´çš„é¢è¯•é¢˜ï¼Œæƒ³ä¸åˆ°ä»Šå¤©åœ¨ç¾¤é‡Œæœ‰äººè¿˜é—®äº†è¿™ä¸ªï¼<br><img src="https://pic1.zhimg.com/v2-2ba203f9e2e5fd627521c12d5e8f4e91_b.jpg" alt=""><img src="https://pic1.zhimg.com/80/v2-2ba203f9e2e5fd627521c12d5e8f4e91_hd.jpg" alt=""><br>call/applyç”¨æ¥æ”¹å˜å‡½æ•°çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆthisï¼‰ï¼Œå®ƒä»¬çš„ç¬¬ä¸€ä¸ªå‚æ•°thisArgæ˜¯ä¸ªå¯¹è±¡ï¼Œå³ä½œä¸ºå‡½æ•°å†…çš„thisã€‚</p>
<p>å¤šæ•°æ—¶å€™ä½ ä¼ å•¥å‡½æ•°å†…å°±æ˜¯å•¥ã€‚ä»…ä»¥callç¤ºä¾‹</p>
<pre><code>function fun() {
alert(this);
}
fun.call(1);
fun.call(&apos;a&apos;);
fun.call(true);
fun.call({name:&apos;jack&apos;});
</code></pre><p>åˆ†åˆ«å¼¹å‡ºâ€œ1â€ã€â€œaâ€ã€â€œtrueâ€ã€â€œ[object Object]â€ã€‚</p>
<p>æœ‰ä¸¤ç§æƒ…å†µéœ€è¦æ³¨æ„ï¼Œä¼ nullæˆ–undefinedæ—¶ï¼Œå°†æ˜¯JSæ‰§è¡Œç¯å¢ƒçš„å…¨å±€å˜é‡ã€‚æµè§ˆå™¨ä¸­æ˜¯windowï¼Œå…¶å®ƒç¯å¢ƒï¼ˆå¦‚nodeï¼‰åˆ™æ˜¯globalã€‚</p>
<pre><code>fun.call(null); // window or global
fun.call(undefined); // window or global
</code></pre><p>è¿™åœ¨ECMAScript5.1 15.3.4.4ä¸­æœ‰è§£é‡Šï¼Œå¦‚ä¸‹<br><img src="https://pic2.zhimg.com/v2-a55dd237510bbfca06ff1f5ad5c1ac2e_b.jpg" alt=""><img src="https://pic2.zhimg.com/80/v2-a55dd237510bbfca06ff1f5ad5c1ac2e_hd.jpg" alt=""><br>ä¸¥æ ¼æ¨¡å¼ä¸‹æƒ…å†µåˆæœ‰æ‰€ä¸åŒï¼ŒES3æ¯”è¾ƒå®½å®¹å°½é‡å»æ£æµ‹ä»£ç æ„å›¾ã€‚ES5ä¸¥æ ¼æ¨¡å¼ï¼ˆie6/7/8/9é™¤å¤–ï¼‰åˆ™ä¸å†æ£æµ‹ï¼Œç»™call/applyä¼ å…¥çš„ä»»ä½•å‚æ•°ä¸å†è½¬æ¢ã€‚å¦‚ä¸‹</p>
<pre><code>&apos;use strict&apos;
function fun() {
alert(this);
}
fun.call(null)      // null
fun.call(undefined) // undefined 
</code></pre><h2 id="å‡ ä¸ªé¢è¯•å°é¢˜ï¼š"><a href="#å‡ ä¸ªé¢è¯•å°é¢˜ï¼š" class="headerlink" title="å‡ ä¸ªé¢è¯•å°é¢˜ï¼š"></a>å‡ ä¸ªé¢è¯•å°é¢˜ï¼š</h2><p><img src="https://pic1.zhimg.com/v2-99d1bfc9bfa325ea383e8e5209a46384_b.jpg" alt=""><img src="https://pic1.zhimg.com/80/v2-99d1bfc9bfa325ea383e8e5209a46384_hd.jpg" alt=""><br>1.alert(alert(1)&amp;&amp;alert(2)):    ç¬¬ä¸€ä¸ªalertæ‰§è¡Œæ²¡è¿”å›undefinedã€alert æ˜¯å‡½æ•°ï¼Œalertï¼ˆ1ï¼‰ç›¸å½“è°ƒç”¨ï¼Œä½†æ²¡æœ‰è¿”å›å€¼ï¼Œæ‰€ä»¥æ˜¯undefinedã€‘ï¼Œalertï¼ˆ2ï¼‰ ç›´æ¥çŸ­è·¯æ‰ã€‚</p>
<p>2.alert(1&amp;&amp;2)   &amp;&amp;ç¬¬ä¸€ä¸ªä¸ºtrueï¼Œæ‰ä¼šæ‰§è¡Œç¬¬äºŒä¸ªï¼Œå¦‚æœå…¨éƒ¨æ˜¯trueè¿”å›æœ€åä¸€ä¸ªå€¼ã€‚</p>
<p>3.<br><img src="https://pic3.zhimg.com/v2-3c568d3cbe2ee035f846917f7907903d_b.jpg" alt=""><img src="https://pic3.zhimg.com/80/v2-3c568d3cbe2ee035f846917f7907903d_hd.jpg" alt=""><br>å¤šæ¬¡bindåªä¿ç•™ç¬¬ä¸€æ¬¡çš„ã€‚</p>
<p>4.<br><img src="https://pic3.zhimg.com/v2-99af21478704f737a974a986e9fd41cc_b.jpg" alt=""><img src="https://pic3.zhimg.com/80/v2-99af21478704f737a974a986e9fd41cc_hd.jpg" alt=""><br>5.<br><img src="https://pic4.zhimg.com/v2-eef9d265365a8782e55efa78ad718b01_b.jpg" alt=""><img src="https://pic4.zhimg.com/80/v2-eef9d265365a8782e55efa78ad718b01_hd.jpg" alt=""><img src="https://pic4.zhimg.com/v2-d355491fab6f0917e3b6b141992dac5c_b.jpg" alt=""><img src="https://pic4.zhimg.com/80/v2-d355491fab6f0917e3b6b141992dac5c_hd.jpg" alt=""><img src="https://pic4.zhimg.com/v2-698cc4f2c86dccb91268ae9b597089dc_b.jpg" alt=""><img src="https://pic4.zhimg.com/80/v2-698cc4f2c86dccb91268ae9b597089dc_hd.jpg" alt=""><br>6.è‡ªå®šä¹‰äº‹ä»¶</p>
<pre><code>var myEvent = new Event(&apos;myEvent&apos;);
document.addEventListener(&apos;myEvent&apos;, log, false);
function log() {
  console.log(&apos;hello event&apos;);
}
document.dispatchEvent(myEvent);
</code></pre><p>7.æ•°ç»„å¾ªç¯ç§»åŠ¨<br><img src="https://pic4.zhimg.com/v2-c996087a776f590d84df53c1827872d2_b.jpg" alt=""><img src="https://pic4.zhimg.com/80/v2-c996087a776f590d84df53c1827872d2_hd.jpg" alt=""><br>éœ€æ±‚</p>
<p>å‡è®¾æœ‰è¿™æ ·ä¸€ä¸ªæ•°ç»„</p>
<pre><code>[1,2,3,4,5]
</code></pre><p>ç°åœ¨æƒ³è¦å·¦ç§»æˆ–è€…å³ç§»Nä½ï¼Œæ¯”å¦‚ç§»åŠ¨1ä½</p>
<pre><code>//å·¦ç§»1ä½
[2,3,4,5,1]

//å³ç§»1ä½
[5,1,2,3,4]
</code></pre><p>ç®—æ³•å®ç°</p>
<p>è¿™æ ·ä¸€é“é¢˜ç›®ï¼Œä½ å…ˆä¸è¦çœ‹æˆ‘ä¸‹é¢çš„ä»£ç ï¼Œè‡ªå·±æ€è€ƒä¸€ä¸‹å¦‚ä½•å®ç°å®ƒï¼Œä¸ç®¡æ˜¯å¤æ‚çš„è¿˜æ˜¯ç®€å•çš„æ–¹æ³•ã€‚<br>å¯ä»¥å…ˆå‘Šè¯‰ä½ æˆ‘ç”¨äº†2è¡Œä»£ç å®ç°å·¦ã€å³ç§»åŠ¨å…ƒç´ ã€‚</p>
<p>æ‹†åˆ†æ³•</p>
<p>å½“æˆ‘ä»¬æ²¡æœ‰å…·ä½“æ€è·¯çš„æ—¶å€™ï¼Œå°±å…ˆå‡è®¾æ•°ç»„ç§»åŠ¨1ä½çš„æƒ…å†µã€‚</p>
<pre><code>[1,2,3,4,5]
=&gt;
[null,1,2,3,4] and [5,null,null,null,null]
=&gt;
[5,1,2,3,4]
</code></pre><p>è¿™é‡Œå¯ä»¥çœ‹æˆ2ä¸ªæ•°ç»„ï¼Œä¸€ä¸ªæ˜¯æ²¡æœ‰åˆ°è¾¾è¾¹ç•Œçš„å…ƒç´ ç§»åŠ¨[null,1,2,3,4]ï¼Œä¸€ä¸ªæ˜¯åˆ°è¾¾äº†è¾¹ç•Œçš„å…ƒç´ ç§»åŠ¨[5,null,null,null,null]ï¼Œå½“å…ƒç´ åˆ°è¾¾è¾¹ç•Œï¼Œå°±ä¼šå¾€æ•°ç»„çš„åˆå§‹ä½ç½®ç§»åŠ¨ï¼Œå½¢æˆäº†ä¸€ä¸ªå¾ªç¯çš„è¿‡ç¨‹ã€‚</p>
<p>å¾ˆæ˜æ˜¾ï¼Œå¦‚æœæˆ‘ä»¬å°†è¿™2ä¸ªç§»åŠ¨åçš„æ•°ç»„åˆå¹¶èµ·æ¥ï¼Œå°±æ˜¯éœ€æ±‚çš„ç»“æœã€‚</p>
<p>ç§»åŠ¨2ä½</p>
<p>åŒæ ·ç¬¦åˆ2ä¸ªç§»åŠ¨åçš„æ•°ç»„åˆå¹¶èµ·æ¥ä¸ºç»“æœçš„æƒ…å†µ</p>
<pre><code>[1,2,3,4,5]
=&gt;
[null,null,1,2,3] and [4,5,null,null,null]
=&gt;
[4,5,1,2,3]
</code></pre><p>åˆšå¥½ç§»åŠ¨æ•°ç»„é•¿åº¦</p>
<pre><code>[1,2,3,4,5]
=&gt;
[1,2,3,4,5] and [] //å¦‚æœæ²¡æœ‰ï¼Œå°±å‡è®¾ä¸ºç©ºæ•°ç»„
</code></pre><p>åˆå¹¶æ•°ç»„</p>
<p>å‡è®¾ç§»åŠ¨1ä½çš„æƒ…å†µ<br>ä¸Šé¢çš„æ­¥éª¤ï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†è§„å¾‹ï¼Œæ¥ä¸‹æ¥è¦åšçš„æ˜¯æ‰¾åˆ°2ä¸ªæ•°ç»„ï¼Œéœ€è¦ç”¨åˆ°sliceæˆªå–æ•°ç»„å…ƒç´ ã€‚<br>æˆªå–ç¬¬ä¸€ä¸ªæ•°ç»„</p>
<pre><code>arr.slice(0,-1)
// [1,2,3,4]
</code></pre><p>æˆªå–ç¬¬äºŒä¸ªæ•°ç»„</p>
<pre><code>arr.slice(-1)
// [5]
</code></pre><p>åˆå¹¶æ•°ç»„</p>
<pre><code>arr.slice(-1).concat(arr.slice(0,-1))
// [5,1,2,3,4]
</code></pre><p>è¿™æ ·ä½ å°±å®ç°äº†ç§»åŠ¨1ä½çš„æƒ…å†µï¼Œæ¥ç€ï¼Œä½ ç»§ç»­æ‹¿+5å’Œ-5èŒƒå›´å†…çš„æ•°å­—è¿›è¡Œæµ‹è¯•ï¼Œå‘ç°éƒ½å¯ä»¥æ­£å¸¸ç§»åŠ¨ï¼Œå½“æ•°å­—å¤§äº5æˆ–è€…å°äº-5çš„æ—¶å€™ï¼Œä»£ç å°±æ— æ•ˆäº†ï¼Œå§‹ç»ˆè¾“å‡º[1,2,3,4,5]</p>
<pre><code>arr.slice(-6).concat(arr.slice(0,-6))
// [1,2,3,4,5]
</code></pre><p>æˆ‘ä»¬å†åŠ ä¸Šä¸€ä¸ªå°æŠ€å·§ï¼Œæ±‚ä½™æ•°ï¼Œå‡è®¾æ˜¯ç§»åŠ¨6ï¼Œé‚£ä¹ˆï¼Œå®é™…ä¸Šå’Œç§»åŠ¨1æ˜¯ç›¸åŒçš„ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ ¹æ®å…¬å¼æ±‚ä½™æ•°</p>
<pre><code>n = n%arr.length
// n = 6%5 ä½™1
</code></pre><p>åŒç†ï¼Œå½“ç§»åŠ¨-6æ—¶</p>
<pre><code>n = n%arr.length
// n = -6%5 ä½™-1
</code></pre><p>æ¥ç€å¸¦å…¥å…¬å¼ï¼Œå‘ç°è¾“å‡ºå…¨éƒ¨éƒ½æ­£ç¡®äº†ï¼ï¼</p>
<p>æ€è·¯åˆ†æå®Œäº†ï¼Œåº”è¯¥å¾ˆæ¸…æ™°äº†å§ï¼Œæºç åœ¨ä¸‹é¢ã€</p>
<p>ç®—æ³•æºç </p>
<p>arrè¡¨ç¤ºåŸå§‹æ•°ç»„ï¼Œnè¡¨ç¤ºç§»åŠ¨çš„è·ç¦»ï¼Œå¯ä»¥æ˜¯æ­£æ•°ã€å¯ä»¥æ˜¯0ã€ä¹Ÿå¯ä»¥æ˜¯è´Ÿæ•°ã€æ­£æ•°è¡¨ç¤ºå³ç§»ï¼Œè´Ÿæ•°è¡¨ç¤ºå·¦ç§»ï¼Œ0è¡¨ç¤ºä¸ç§»åŠ¨ã€‚</p>
<pre><code>function moveElement(arr, n) {
  if(Math.abs(n)&gt;arr.length) n = n%arr.length
  return arr.slice(-n).concat(arr.slice(0,-n))
}

// moveElement(arr, 9)
// moveElement(arr, 0)
// moveElement(arr, -9)
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/04/H5å¦‚ä½•å”¤èµ·APP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/04/H5å¦‚ä½•å”¤èµ·APP/" itemprop="url">H5å¦‚ä½•å”¤èµ·APP</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-11-04T19:29:36+08:00">
                2017-11-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>å‰ä¸€æ®µæ—¶é—´åœ¨åšç”µæµApp H5é¡µé¢ï¼Œéœ€æ±‚ä¸­è½åœ°é¡µå æ¯”è¾ƒå¤§ï¼Œè½åœ°é¡µæ‰¿æ‹…çš„èŒè´£å°±æ˜¯å¼•æµã€‚å¼•æµæœ‰ä¸¤ç§å½¢å¼ï¼ŒåŒæ—¶ä¹Ÿæ˜¯æˆ‘ä»¬å¯¹å”¤ç«¯çš„å®šä¹‰ï¼šå¼•å¯¼å·²ä¸‹è½½ç”¨æˆ·æ‰“å¼€APPï¼Œå¼•å¯¼æœªä¸‹è½½ç”¨æˆ·ä¸‹è½½APPã€‚</p>
<p>å¼•å¯¼å·²ä¸‹è½½ç”¨æˆ·æ‰“å¼€APPï¼Œä»æ•°æ®ä¸Šè¯´ç”¨æˆ·åœç•™åœ¨APPä¸­çš„æ—¶é—´æ›´å¤šäº†ï¼Œæ˜¯åœ¨æé«˜ç”¨æˆ·ç²˜æ€§ï¼›ä»ä½“éªŒä¸Šè¯´ï¼ŒAPPä½“éªŒæ˜¯è¦æ¯”H5å¥½çš„ã€‚å¼•å¯¼æœªä¸‹è½½ç”¨æˆ·ä¸‹è½½APPï¼Œå¯ä»¥å¢åŠ æˆ‘ä»¬çš„ç”¨æˆ·é‡ã€‚</p>
<p>ä¸Šé¢å…¶å®åˆ†åˆ«è§£é‡Šäº† <strong>ä»€ä¹ˆæ˜¯å”¤ç«¯</strong> ä»¥åŠ <strong>ä¸ºä»€ä¹ˆè¦å”¤ç«¯</strong>ï¼Œä¹Ÿå°±æ˜¯  <em>3Wæ³•åˆ™</em> ä¸­çš„ What å’Œ Whyï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬å°±è¦èŠä¸€èŠ How äº†ï¼Œä¹Ÿå°±æ˜¯ <strong>å¦‚ä½•å”¤ç«¯</strong> ã€‚</p>
<p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹å¸¸è§çš„å”¤ç«¯æ–¹å¼ä»¥åŠä»–ä»¬é€‚ç”¨çš„åœºæ™¯ï¼š</p>
<h2 id="å”¤ç«¯åª’ä»‹"><a href="#å”¤ç«¯åª’ä»‹" class="headerlink" title="å”¤ç«¯åª’ä»‹"></a>å”¤ç«¯åª’ä»‹</h2><h3 id="URL-Scheme"><a href="#URL-Scheme" class="headerlink" title="URL Scheme"></a>URL Scheme</h3><h4 id="æ¥æº"><a href="#æ¥æº" class="headerlink" title="æ¥æº"></a>æ¥æº</h4><p>æˆ‘ä»¬çš„æ‰‹æœºä¸Šæœ‰è®¸å¤šç§å¯†ä¿¡æ¯ï¼Œè”ç³»æ–¹å¼ã€ç…§ç‰‡ã€é“¶è¡Œå¡ä¿¡æ¯â€¦æˆ‘ä»¬ä¸å¸Œæœ›è¿™äº›ä¿¡æ¯å¯ä»¥è¢«æ‰‹æœºåº”ç”¨éšæ„è·å–åˆ°ï¼Œä¿¡æ¯æ³„éœ²çš„å±å®³ç”šå¤§ã€‚æ‰€ä»¥ï¼Œå¦‚ä½•ä¿è¯ä¸ªäººä¿¡æ¯åœ¨è®¾å¤‡æ‰€æœ‰è€…çŸ¥æƒ…å¹¶å…è®¸çš„æƒ…å†µä¸‹è¢«ä½¿ç”¨ï¼Œæ˜¯æ™ºèƒ½è®¾å¤‡çš„æ ¸å¿ƒå®‰å…¨é—®é¢˜ã€‚</p>
<p>å¯¹æ­¤ï¼Œè‹¹æœä½¿ç”¨äº†åä¸º <em>æ²™ç›’</em> çš„æœºåˆ¶ï¼šåº”ç”¨åªèƒ½è®¿é—®å®ƒå£°æ˜å¯èƒ½è®¿é—®çš„èµ„æºã€‚ä½†æ²™ç›’ä¹Ÿé˜»ç¢äº†åº”ç”¨é—´åˆç†çš„ä¿¡æ¯å…±äº«ï¼ŒæŸç§ç¨‹åº¦ä¸Šé™åˆ¶äº†åº”ç”¨çš„èƒ½åŠ›ã€‚</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬æ€¥éœ€è¦ä¸€ä¸ªè¾…åŠ©å·¥å…·æ¥å¸®åŠ©æˆ‘ä»¬å®ç°åº”ç”¨é€šä¿¡ï¼Œ URL Scheme å°±æ˜¯è¿™ä¸ªå·¥å…·ã€‚</p>
<h4 id="URL-Scheme-æ˜¯ä»€ä¹ˆ"><a href="#URL-Scheme-æ˜¯ä»€ä¹ˆ" class="headerlink" title="URL Scheme æ˜¯ä»€ä¹ˆ"></a>URL Scheme æ˜¯ä»€ä¹ˆ</h4><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ URL çš„ç»„æˆï¼š</p>
<pre><code>[scheme:][//authority][path][?query][#fragment]
</code></pre><p>æˆ‘ä»¬æ‹¿ <code>https://www.baidu.com</code> æ¥ä¸¾ä¾‹ï¼Œscheme è‡ªç„¶å°±æ˜¯ <code>https</code> äº†ã€‚</p>
<p>å°±åƒç»™æœåŠ¡å™¨èµ„æºåˆ†é…ä¸€ä¸ª URLï¼Œä»¥ä¾¿æˆ‘ä»¬å»è®¿é—®å®ƒä¸€æ ·ï¼Œæˆ‘ä»¬åŒæ ·ä¹Ÿå¯ä»¥ç»™æ‰‹æœºAPPåˆ†é…ä¸€ä¸ªç‰¹æ®Šæ ¼å¼çš„ URLï¼Œç”¨æ¥è®¿é—®è¿™ä¸ªAPPæˆ–è€…è¿™ä¸ªAPPä¸­çš„æŸä¸ªåŠŸèƒ½(æ¥å®ç°é€šä¿¡)ã€‚APPå¾—æœ‰ä¸€ä¸ªæ ‡è¯†ï¼Œå¥½è®©æˆ‘ä»¬å¯ä»¥å®šä½åˆ°å®ƒï¼Œå®ƒå°±æ˜¯ URL çš„ Scheme éƒ¨åˆ†ã€‚</p>
<h4 id="å¸¸ç”¨APPçš„-URL-Scheme"><a href="#å¸¸ç”¨APPçš„-URL-Scheme" class="headerlink" title="å¸¸ç”¨APPçš„ URL Scheme"></a>å¸¸ç”¨APPçš„ URL Scheme</h4><table>
<thead>
<tr>
<th>APP</th>
<th style="text-align:center">å¾®ä¿¡</th>
<th style="text-align:center">æ”¯ä»˜å®</th>
<th style="text-align:center">æ·˜å®</th>
<th style="text-align:center">å¾®åš</th>
<th style="text-align:center">QQ</th>
</tr>
</thead>
<tbody>
<tr>
<td>URL Scheme</td>
<td style="text-align:center">weixin://</td>
<td style="text-align:center">alipay://</td>
<td style="text-align:center">taobao://</td>
<td style="text-align:center">sinaweibo://</td>
<td style="text-align:center">mqq://</td>
</tr>
</tbody>
</table>
<h4 id="URL-Scheme-è¯­æ³•"><a href="#URL-Scheme-è¯­æ³•" class="headerlink" title="URL Scheme è¯­æ³•"></a>URL Scheme è¯­æ³•</h4><p>ä¸Šé¢è¡¨æ ¼ä¸­éƒ½æ˜¯æœ€ç®€å•çš„ç”¨äºæ‰“å¼€ APP çš„ URL Schemeï¼Œä¸‹é¢æ‰æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„ URL Scheme æ ¼å¼ï¼š</p>
<pre><code>     è¡Œä¸º(åº”ç”¨çš„æŸä¸ªåŠŸèƒ½)    
            |
scheme://[path][?query]
   |               |
åº”ç”¨æ ‡è¯†       åŠŸèƒ½éœ€è¦çš„å‚æ•°
</code></pre><h3 id="Intent"><a href="#Intent" class="headerlink" title="Intent"></a>Intent</h3><p>å®‰å“çš„åŸç”Ÿè°·æ­Œæµè§ˆå™¨è‡ªä» chrome25 ç‰ˆæœ¬å¼€å§‹å¯¹äºå”¤ç«¯åŠŸèƒ½åšäº†ä¸€äº›å˜åŒ–ï¼ŒURL Scheme æ— æ³•å†å¯åŠ¨Androidåº”ç”¨ã€‚ ä¾‹å¦‚ï¼Œé€šè¿‡ iframe æŒ‡å‘ <code>weixin://</code>ï¼Œå³ä½¿ç”¨æˆ·å®‰è£…äº†å¾®ä¿¡ä¹Ÿæ— æ³•æ‰“å¼€ã€‚æ‰€ä»¥ï¼ŒAPPéœ€è¦å®ç°è°·æ­Œå®˜æ–¹æä¾›çš„ <code>intent:</code> è¯­æ³•ï¼Œæˆ–è€…å®ç°è®©ç”¨æˆ·é€šè¿‡è‡ªå®šä¹‰æ‰‹åŠ¿æ¥æ‰“å¼€APPï¼Œå½“ç„¶è¿™å°±æ˜¯é¢˜å¤–è¯äº†ã€‚</p>
<h4 id="Intent-è¯­æ³•"><a href="#Intent-è¯­æ³•" class="headerlink" title="Intent è¯­æ³•"></a>Intent è¯­æ³•</h4><pre><code>intent:
   HOST/URI-path // Optional host 
   #Intent; 
      package=[string]; 
      action=[string]; 
      category=[string]; 
      component=[string]; 
      scheme=[string]; 
   end;
</code></pre><p>å¦‚æœç”¨æˆ·æœªå®‰è£… APPï¼Œåˆ™ä¼šè·³è½¬åˆ°ç³»ç»Ÿé»˜è®¤å•†åº—ã€‚å½“ç„¶ï¼Œå¦‚æœä½ æƒ³è¦æŒ‡å®šä¸€ä¸ªå”¤èµ·å¤±è´¥çš„è·³è½¬åœ°å€ï¼Œæ·»åŠ ä¸‹é¢çš„å­—ç¬¦ä¸²åœ¨ <code>end;</code> å‰å°±å¯ä»¥äº†:</p>
<pre><code>S.browser_fallback_url=[encoded_full_url]
</code></pre><h4 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h4><p>ä¸‹é¢æ˜¯æ‰“å¼€ Zxing äºŒç»´ç æ‰«æ APP çš„ intentã€‚</p>
<pre><code>intent:
   //scan/
   #Intent; 
      package=com.google.zxing.client.android; 
      scheme=zxing; 
   end; 
</code></pre><p>æ‰“å¼€è¿™ä¸ª APP ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹çš„æ–¹å¼ï¼š</p>
<pre><code>&lt;ahref=&quot;intent://scan/#Intent;scheme=zxing;package=com.google.zxing.client.android;S.browser_fallback_url=http%3A%2F%2Fzxing.org;end&quot;&gt; Take a QR code &lt;/a&gt;
</code></pre><h3 id="Universal-Link"><a href="#Universal-Link" class="headerlink" title="Universal Link"></a>Universal Link</h3><h4 id="Universal-Link-æ˜¯ä»€ä¹ˆ"><a href="#Universal-Link-æ˜¯ä»€ä¹ˆ" class="headerlink" title="Universal Link æ˜¯ä»€ä¹ˆ"></a>Universal Link æ˜¯ä»€ä¹ˆ</h4><p>Universal Link æ˜¯è‹¹æœåœ¨ WWDC2015 ä¸Šä¸º iOS9 å¼•å…¥çš„æ–°åŠŸèƒ½ï¼Œé€šè¿‡ä¼ ç»Ÿçš„ HTTP é“¾æ¥å³å¯æ‰“å¼€ APPã€‚å¦‚æœç”¨æˆ·æœªå®‰è£… APPï¼Œåˆ™ä¼šè·³è½¬åˆ°è¯¥é“¾æ¥æ‰€å¯¹åº”çš„é¡µé¢ã€‚</p>
<h4 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-Universal-Link"><a href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-Universal-Link" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ Universal Link"></a>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ Universal Link</h4><p>ä¼ ç»Ÿçš„ Scheme é“¾æ¥æœ‰ä»¥ä¸‹å‡ ä¸ªç—›ç‚¹ï¼š</p>
<ul>
<li>åœ¨ ios ä¸Šä¼šæœ‰ç¡®è®¤å¼¹çª—æç¤ºç”¨æˆ·æ˜¯å¦æ‰“å¼€ï¼Œå¯¹äºç”¨æˆ·æ¥è¯´å”¤ç«¯ï¼Œå¤šå‡ºäº†ä¸€æ­¥æ“ä½œã€‚è‹¥ç”¨æˆ·æœªå®‰è£… APP ï¼Œä¹Ÿä¼šæœ‰ä¸€ä¸ªæç¤ºçª—ï¼Œå‘ŠçŸ¥æˆ‘ä»¬ â€œæ‰“ä¸å¼€è¯¥ç½‘é¡µï¼Œå› ä¸ºç½‘å€æ— æ•ˆâ€</li>
<li>ä¼ ç»Ÿ Scheme è·³è½¬æ— æ³•å¾—çŸ¥å”¤ç«¯æ˜¯å¦æˆåŠŸï¼ŒUniversal Link å”¤ç«¯å¤±è´¥å¯ä»¥ç›´æ¥æ‰“å¼€æ­¤é“¾æ¥å¯¹åº”çš„é¡µé¢</li>
<li>Scheme åœ¨å¾®ä¿¡ã€å¾®åšã€QQæµè§ˆå™¨ã€æ‰‹ç™¾ä¸­éƒ½å·²ç»è¢«ç¦æ­¢ä½¿ç”¨ï¼Œä½¿ç”¨ Universal Link å¯ä»¥é¿å¼€å®ƒä»¬çš„å±è”½ï¼ˆ æˆªæ­¢åˆ° 18å¹´8æœˆ21æ—¥ï¼Œå¾®ä¿¡å’ŒQQæµè§ˆå™¨å·²ç»ç¦æ­¢äº† Universal Linkï¼Œå…¶ä»–ä¸»æµAPPæœªå‘ç°æœ‰ç¦æ­¢ ï¼‰</li>
</ul>
<h4 id="å¦‚ä½•è®©-APP-æ”¯æŒ-Universal-Link"><a href="#å¦‚ä½•è®©-APP-æ”¯æŒ-Universal-Link" class="headerlink" title="å¦‚ä½•è®© APP æ”¯æŒ Universal Link"></a>å¦‚ä½•è®© APP æ”¯æŒ Universal Link</h4><p>æœ‰å¤§é‡çš„æ–‡ç« ä¼šè¯¦ç»†çš„å‘Šè¯‰æˆ‘ä»¬å¦‚ä½•é…ç½®ï¼Œä½ ä¹Ÿå¯ä»¥å»çœ‹<a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.apple.com%2Flibrary%2Farchive%2Fdocumentation%2FGeneral%2FConceptual%2FAppSearch%2FUniversalLinks.html%23%2F%2Fapple_ref%2Fdoc%2Fuid%2FTP40016308-CH12-SW2" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a>ï¼Œæˆ‘è¿™é‡Œç®€å•çš„å†™ä¸€ä¸ª12345ã€‚</p>
<ol>
<li>æ‹¥æœ‰ä¸€ä¸ªæ”¯æŒ <strong>https</strong> çš„åŸŸå</li>
<li>åœ¨ <a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.apple.com%2F" target="_blank" rel="noopener">å¼€å‘è€…ä¸­å¿ƒ</a> ï¼ŒIdentifiers ä¸‹ AppIDs æ‰¾åˆ°è‡ªå·±çš„ App IDï¼Œç¼–è¾‘æ‰“å¼€ Associated Domains æœåŠ¡ã€‚</li>
<li>æ‰“å¼€å·¥ç¨‹é…ç½®ä¸­çš„ Associated Domains ï¼Œåœ¨å…¶ä¸­çš„ Domains ä¸­å¡«å…¥ä½ æƒ³æ”¯æŒçš„åŸŸåï¼Œå¿…é¡»ä»¥ <code>applinks:</code> ä¸ºå‰ç¼€</li>
<li>é…ç½® <code>apple-app-site-association</code> æ–‡ä»¶ï¼Œæ–‡ä»¶åå¿…é¡»ä¸º <code>apple-app-site-association</code> ï¼Œ<strong>ä¸å¸¦ä»»ä½•åç¼€</strong></li>
<li>ä¸Šä¼ è¯¥æ–‡ä»¶åˆ°ä½ çš„ HTTPS æœåŠ¡å™¨çš„ <strong>æ ¹ç›®å½•</strong> æˆ–è€… <code>.well-known</code> ç›®å½•ä¸‹</li>
</ol>
<h4 id="Universal-Link-é…ç½®ä¸­çš„å‘"><a href="#Universal-Link-é…ç½®ä¸­çš„å‘" class="headerlink" title="Universal Link é…ç½®ä¸­çš„å‘"></a>Universal Link é…ç½®ä¸­çš„å‘</h4><p>è¿™é‡Œæ”¾ä¸€ä¸‹æˆ‘ä»¬åœ¨é…ç½®è¿‡ç¨‹ä¸­é‡åˆ°çš„å‘ï¼Œå½“ç„¶é¦–å…ˆä½ åœ¨é…ç½®è¿‡ç¨‹ä¸­å¿…é¡»å¾—ä¸¥æ ¼æŒ‰ç…§ä¸Šé¢çš„è¦æ±‚å»åšï¼Œå°¤å…¶æ˜¯åŠ ç²—çš„åœ°æ–¹ã€‚</p>
<ol>
<li>åŸŸåé—®é¢˜</li>
</ol>
<p>Universal Link æ”¯æŒçš„åŸŸåæœ€å¤šåªèƒ½æ”¯æŒåˆ°äºŒçº§åŸŸåï¼Œå¦‚æœä½ ç”¨åˆ°äº†ä¸‰çº§åŸŸåï¼ŒUniversal Link å”¤ç«¯æ˜¯ä¸ä¼šç”Ÿæ•ˆçš„ã€‚</p>
<ol start="2">
<li>è·¨åŸŸé—®é¢˜</li>
</ol>
<p>IOS 9.2 ä»¥åï¼Œå¿…é¡»è¦è§¦å‘è·¨åŸŸæ‰èƒ½æ”¯æŒ Universal Link å”¤ç«¯ã€‚</p>
<p>IOS é‚£è¾¹æœ‰è¿™æ ·ä¸€ä¸ªåˆ¤æ–­ï¼Œå¦‚æœä½ è¦æ‰“å¼€çš„ Universal Link å’Œ å½“å‰é¡µé¢æ˜¯åŒä¸€åŸŸåï¼Œios å°Šé‡ç”¨æˆ·æœ€å¯èƒ½çš„æ„å›¾ï¼Œç›´æ¥æ‰“å¼€é“¾æ¥æ‰€å¯¹åº”çš„é¡µé¢ã€‚å¦‚æœä¸åœ¨åŒä¸€åŸŸåä¸‹ï¼Œåˆ™åœ¨ä½ çš„ APP ä¸­æ‰“å¼€é“¾æ¥ï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œå…·ä½“çš„å”¤ç«¯æ“ä½œã€‚</p>
<ol start="3">
<li>Universal Link æ˜¯ç©ºé¡µé¢</li>
</ol>
<p>Universal Link æœ¬è´¨ä¸Šæ˜¯ä¸ªç©ºé¡µé¢ï¼Œå¦‚æœæœªå®‰è£… APPï¼ŒUniversal Link è¢«å½“åšæ™®é€šçš„é¡µé¢é“¾æ¥ï¼Œè‡ªç„¶ä¼šè·³åˆ° 404 é¡µé¢ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†å®ƒç»‘å®šåˆ°æˆ‘ä»¬çš„ä¸­è½¬é¡µæˆ–è€…ä¸‹è½½é¡µã€‚</p>
<h2 id="å¦‚ä½•è°ƒç”¨ä¸‰ç§å”¤ç«¯åª’ä»‹"><a href="#å¦‚ä½•è°ƒç”¨ä¸‰ç§å”¤ç«¯åª’ä»‹" class="headerlink" title="å¦‚ä½•è°ƒç”¨ä¸‰ç§å”¤ç«¯åª’ä»‹"></a>å¦‚ä½•è°ƒç”¨ä¸‰ç§å”¤ç«¯åª’ä»‹</h2><p>é€šè¿‡å‰é¢çš„ä»‹ç»ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œæ— è®ºæ˜¯ URL Scheme è¿˜æ˜¯ Intent æˆ–è€… Universal Link ï¼Œä»–ä»¬éƒ½ç®—æ˜¯ URL ï¼Œåªæ˜¯ URL Scheme å’Œ Intent ç®—æ˜¯ç‰¹æ®Šçš„ URLã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ‹¿ä½¿ç”¨ URL çš„æ–¹æ³•æ¥ä½¿ç”¨å®ƒä»¬ã€‚</p>
<h3 id="iframe"><a href="#iframe" class="headerlink" title="iframe"></a>iframe</h3><pre><code>&lt;iframesrc=&quot;sinaweibo://qrcode&quot;&gt;
</code></pre><p>åœ¨åªæœ‰ URL Scheme çš„æ—¥å­é‡Œï¼Œiframe æ˜¯ä½¿ç”¨æœ€å¤šçš„äº†ã€‚å› ä¸ºåœ¨æœªå®‰è£… app çš„æƒ…å†µä¸‹ï¼Œä¸ä¼šå»è·³è½¬é”™è¯¯é¡µé¢ã€‚ä½†æ˜¯ iframe åœ¨å„ä¸ªç³»ç»Ÿä»¥åŠå„ä¸ªåº”ç”¨ä¸­çš„å…¼å®¹é—®é¢˜è¿˜æ˜¯æŒºå¤šçš„ï¼Œä¸èƒ½å…¨éƒ¨ä½¿ç”¨ URL Schemeã€‚</p>
<h3 id="a-æ ‡ç­¾"><a href="#a-æ ‡ç­¾" class="headerlink" title="a æ ‡ç­¾"></a>a æ ‡ç­¾</h3><pre><code>&lt;ahref=&quot;intent://scan/#Intent;scheme=zxing;package=com.google.zxing.client.android;end&quot;&quot;&gt;æ‰«ä¸€æ‰«&lt;/a&gt;
</code></pre><p>å‰é¢æˆ‘ä»¬æåˆ° Intent åè®®ï¼Œå®˜æ–¹ç»™å‡ºçš„ç”¨ä¾‹ä½¿ç”¨çš„å°±æ˜¯ä½¿ç”¨çš„ a æ ‡ç­¾ï¼Œæ‰€ä»¥æˆ‘ä»¬è·Ÿç€ä¸€èµ·ç”¨å°±å¯ä»¥äº†ã€‚</p>
<p>ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œå¯¹äºåŠ¨æ€ç”Ÿæˆçš„ a æ ‡ç­¾ï¼Œä½¿ç”¨ <code>dispatch</code> æ¥æ¨¡æ‹Ÿè§¦å‘ç‚¹å‡»äº‹ä»¶ï¼Œå‘ç°å¾ˆå¤šç§ event ä¼ é€’è¿‡å»éƒ½æ— æ•ˆï¼›ä½¿ç”¨ <code>click()</code> æ¥æ¨¡æ‹Ÿè§¦å‘ï¼Œéƒ¨åˆ†åœºæ™¯ä¸‹å­˜åœ¨è¿™æ ·çš„æƒ…å†µï¼Œç¬¬ä¸€æ¬¡ç‚¹å‡»è¿‡åï¼Œå›åˆ°åŸå…ˆé¡µé¢ï¼Œå†æ¬¡ç‚¹å‡»ï¼Œç‚¹å‡»ä½ç½®å’Œé¡µé¢æ‰€è¯†åˆ«ä½ç½®æœ‰ä¸å°çš„åç§»ï¼Œæ‰€ä»¥ Intent åè®®ä» a æ ‡ç­¾æ¢æˆäº† window.locationã€‚</p>
<h3 id="window-location"><a href="#window-location" class="headerlink" title="window.location"></a>window.location</h3><p>URL Scheme åœ¨ ios 9+ ä¸Šè¯¸å¦‚ safariã€UCã€QQæµè§ˆå™¨ä¸­ï¼Œ iframe å‡æ— æ³•æˆåŠŸå”¤èµ· APPï¼Œåªèƒ½é€šè¿‡ window.location æ‰èƒ½æˆåŠŸå”¤ç«¯ã€‚</p>
<p>å½“ç„¶ï¼Œå¦‚æœæˆ‘ä»¬çš„ app æ”¯æŒ Universal Linkï¼Œios 9+ å°±ç”¨ä¸åˆ° URL Scheme äº†ã€‚è€Œ Universal Link åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæˆ‘å‘ç°åœ¨ qq ä¸­ï¼Œæ— è®ºæ˜¯ iframe å¯¼èˆª è¿˜æ˜¯ a æ ‡ç­¾æ‰“å¼€ åˆæˆ–è€… window.location éƒ½æ— æ³•æˆåŠŸå”¤ç«¯ï¼Œä¸€å¼€å§‹æˆ‘ä»¥ä¸ºæ˜¯ qq å’Œå¾®ä¿¡ä¸€æ ·ç¦æ­¢äº† Universal Link å”¤ç«¯çš„åŠŸèƒ½ï¼Œå…¶å®ä¸ç„¶ï¼Œç™¾èˆ¬è¯•éªŒä¸‹ï¼Œé€šè¿‡ top.location å”¤ç«¯æˆåŠŸäº†ã€‚</p>
<h2 id="åˆ¤æ–­å”¤ç«¯æ˜¯å¦æˆåŠŸ"><a href="#åˆ¤æ–­å”¤ç«¯æ˜¯å¦æˆåŠŸ" class="headerlink" title="åˆ¤æ–­å”¤ç«¯æ˜¯å¦æˆåŠŸ"></a>åˆ¤æ–­å”¤ç«¯æ˜¯å¦æˆåŠŸ</h2><p>å¦‚æœå”¤ç«¯å¤±è´¥ï¼ˆAPP æœªå®‰è£…ï¼‰ï¼Œæˆ‘ä»¬æ€»æ˜¯è¦åšä¸€äº›å¤„ç†çš„ï¼Œå¯ä»¥æ˜¯è·³è½¬ä¸‹è½½é¡µï¼Œå¯ä»¥æ˜¯ ios ä¸‹è·³è½¬ App Storeâ€¦ ä½†æ˜¯Js å¹¶ä¸èƒ½æä¾›ç»™æˆ‘ä»¬è·å– APP å”¤èµ·çŠ¶æ€çš„èƒ½åŠ›ï¼ŒAndroid Intent ä»¥åŠ Universal Link å€’æ˜¯ä¸ç”¨æ‹…å¿ƒï¼Œå®ƒä»¬ä¿©çš„è‡ªèº«æœºåˆ¶å…è®¸å®ƒä»¬å”¤ç«¯å¤±è´¥åç›´æ¥å¯¼èˆªè‡³ç›¸åº”çš„é¡µé¢ï¼Œä½†æ˜¯ URL Scheme å¹¶ä¸å…·å¤‡è¿™æ ·çš„èƒ½åŠ›ï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½é€šè¿‡ä¸€äº›å¾ˆ hack çš„æ–¹å¼æ¥å®ç° APP å”¤èµ·æ£€æµ‹åŠŸèƒ½ã€‚</p>
<pre><code>const initialTime = newDate();
let counter = 0;
let waitTime = 0;

const checkOpen = setInterval(() =&gt; {
   count++;
   waitTime = newDate() - initialTime;

   if (waitTime &gt; 2500) {
      clearInterval(checkOpen);
      cb();
   }

   if (counter &lt; 100) return;

   clearInterval(checkOpen);

   const hide = document.hidden || document.webkitHidden;

   if (!hide) {
      cb(); // å”¤ç«¯å¤±è´¥çš„å›è°ƒå‡½æ•°
   }
}, 20);
</code></pre><p>APP å¦‚æœè¢«å”¤èµ·çš„è¯ï¼Œé¡µé¢å°±ä¼šè¿›å…¥åå°è¿è¡Œï¼ŒsetInterval åœ¨ ios ä¸­ä¸ä¼šåœæ­¢è¿è¡Œï¼Œåœ¨ android ä¸­åœæ­¢è¿è¡Œã€‚</p>
<p>æ¯ 20ms æ‰§è¡Œä¸€æ¬¡ï¼Œæ‰§è¡Œ 100æ¬¡ åœ¨é¡µé¢ä¸­å®é™…è€—è´¹ä¸ 2000 ms ä¸ä¼šç›¸å·®å¤šå°‘ã€‚</p>
<p>æˆ‘ä»¬çš„åˆ¤æ–­æ¡ä»¶æ¯”é¢„æœŸæ—¶é—´å¤šè®¾ç½®äº† 500msï¼Œæ‰€ä»¥å¦‚æœå®‰å“ä¸­ setInterval å†…çš„å‡½æ•°æ‰§è¡Œ 100 æ¬¡ä»¥å†…æ‰€è´¹æ—¶é—´è¶…è¿‡ 2500msï¼Œåˆ™è¯´æ˜ APP å”¤èµ·æˆåŠŸï¼Œåä¹‹åˆ™ä»£è¡¨å¤±è´¥ã€‚</p>
<p>æˆ‘ä»¬é€šè¿‡ document.hidden å’Œ document.webkitHidden å±æ€§æ¥åˆ¤æ–­ APP åœ¨ ios ä¸­æ˜¯å¦è¢«æ­£å¸¸å”¤èµ·ï¼Œ2000ms å†…ï¼Œé¡µé¢è½¬å…¥åå°è¿è¡Œï¼Œdocument.hidden ä¼šè¿”å› trueï¼Œä»£è¡¨å”¤ç«¯æˆåŠŸï¼Œåä¹‹åˆ™ä»£è¡¨å¤±è´¥ã€‚</p>
<h2 id="æ²¡æœ‰å®Œç¾çš„æ–¹æ¡ˆ"><a href="#æ²¡æœ‰å®Œç¾çš„æ–¹æ¡ˆ" class="headerlink" title="æ²¡æœ‰å®Œç¾çš„æ–¹æ¡ˆ"></a>æ²¡æœ‰å®Œç¾çš„æ–¹æ¡ˆ</h2><p>é€è¿‡ä¸Šé¢çš„å‡ ä¸ªç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œæ— è®ºæ˜¯ <em>å”¤ç«¯åª’ä»‹</em> ã€ <em>è°ƒç”¨å”¤ç«¯åª’ä»‹</em> è¿˜æ˜¯ <em>åˆ¤æ–­å”¤ç«¯ç»“æœ</em> éƒ½æ²¡æœ‰ä¸€ä¸ªåå…¨åç¾çš„æ–¹æ³•ï¼Œæˆ‘ä»¬åœ¨ä»£ç å±‚ä¸Šèƒ½åšçš„åªæ˜¯åœ¨ç¡®ä¿æœ€å¸¸ç”¨çš„åœºæ™¯ï¼ˆæ¯”å¦‚ å¾®ä¿¡ã€å¾®åšã€æ‰‹ç™¾ ç­‰ï¼‰å”¤ç«¯æ— è¯¯çš„æƒ…å†µä¸‹ï¼Œæœ€å¤§åŒ–çš„å…¼å®¹å‰©ä½™çš„åœºæ™¯ã€‚</p>
<p>å¥½çš„ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥æ‰¯ä¸€äº›ä»£ç ä»¥å¤–çš„ï¼Œè®©æˆ‘ä»¬çš„ APP èƒ½å¤Ÿåœ¨æ›´å¤šçš„å¹³å°å”¤èµ·ã€‚</p>
<ul>
<li>å¾®ä¿¡ã€å¾®åšã€æ‰‹ç™¾ã€QQæµè§ˆå™¨ç­‰ã€‚</li>
</ul>
<p>è¿™äº›åº”ç”¨èƒ½é˜»æ­¢å”¤ç«¯æ˜¯å› ä¸ºå®ƒä»¬ç›´æ¥å±è”½æ‰äº† URL Scheme ã€‚æ¥ä¸‹æ¥å¯èƒ½å°±æœ‰çœ‹å®˜ç–‘æƒ‘äº†ï¼Œå¾®ä¿¡ä¸­æ˜¯å¯ä»¥æ‰“å¼€å¤§ä¼—ç‚¹è¯„çš„å‘€ï¼Œå¾®åšé‡Œé¢å¯ä»¥æ‰“å¼€ä¼˜é…·å‘€ï¼Œé‚£æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ</p>
<p>å®ƒä»¬éƒ½å„è‡ªç»´æŠ¤ç€ä¸€ä¸ªç™½åå•ï¼Œå¦‚æœä½ çš„åŸŸååœ¨ç™½åå•å†…ï¼Œé‚£è¿™ä¸ªåŸŸåä¸‹æ‰€æœ‰çš„é¡µé¢å‘èµ·çš„ URL Scheme å°±éƒ½ä¼šè¢«å…è®¸ã€‚å°±åƒå¾®ä¿¡ï¼Œå¦‚æœä½ æ˜¯è…¾è®¯çš„â€œå®¶å±â€ï¼Œä½ å°±å¯ä»¥åŠ å…¥ç™½åå•äº†ï¼Œå¾®ä¿¡çš„ç™½åå•ä¸€èˆ¬åªåŒ…å«ç€â€œå®¶å±â€ï¼Œé™¤æ­¤å¤–å¾ˆéš¾ç”³è¯·åˆ°ç™½åå•èµ„è´¨ã€‚ä½†æ˜¯å¾®åšä¹‹ç±»çš„éƒ½æ˜¯å¯ä»¥è”ç³»ä»–ä»¬çš„æ¸ é“ç«¥é‹è¿›è¡Œç”³è¯·çš„ï¼Œåªæ˜¯æ¡ä»¶å„ä¸ç›¸åŒï¼Œæ¯”å¦‚å¾®åšçš„å°±æ˜¯åœ¨ä½ çš„ APP ä¸­æ·»åŠ æ‰“å¼€å¾®åšçš„å…¥å£ï¼Œä¸‰ä¸ªæœˆå†…å”¤èµ·è¶…è¿‡ 100w æ¬¡ï¼Œå°±å¯ä»¥åŠ å…¥ç™½åå•äº†ã€‚</p>
<ul>
<li>è…¾è®¯åº”ç”¨å®ç›´æ¥æ‰“å¼€ APP çš„æŸä¸ªåŠŸèƒ½</li>
</ul>
<p>åˆšåˆšæˆ‘ä»¬è¯´åˆ°ï¼Œå¦‚æœä½ ä¸æ˜¯å¾®ä¿¡çš„å®¶å±ï¼Œé‚£ä½ æ˜¯å¾ˆéš¾è¿›å…¥ç™½åå•çš„ï¼Œæ‰€ä»¥åœ¨å®‰å“ä¸­æˆ‘ä»¬ä¸€èˆ¬éƒ½æ˜¯ç›´æ¥æ‰“å¼€è…¾è®¯åº”ç”¨å®ï¼Œios ä¸­ ç›´æ¥æ‰“å¼€ App Storeã€‚ç‚¹å‡»è…¾è®¯åº”ç”¨å®ä¸­çš„â€œæ‰“å¼€â€æŒ‰é’®ï¼Œå¯ä»¥ç›´æ¥å”¤èµ·æˆ‘ä»¬çš„ APPï¼Œä½†æ˜¯æ— æ³•æ‰“å¼€ APP ä¸­çš„æŸä¸ªåŠŸèƒ½ï¼ˆå°±æ˜¯æ— æ³•æ‰“å¼€æŒ‡å®šé¡µé¢ï¼‰ã€‚</p>
<p>è…¾è®¯åº”ç”¨å®å¯¹å¤–å¼€æ”¾äº†ä¸€ä¸ªå«åš APP Link çš„ç”³è¯·ï¼Œåªè¦ä½ ç”³è¯·äº† APP Linkï¼Œå°±å¯ä»¥é€šè¿‡åœ¨æ‰“å¼€åº”ç”¨å®çš„æ—¶å€™åœ¨åº”ç”¨å®åœ°å€åé¢æ·»åŠ ä¸Š <code>&amp;android_schema={your_scheme}</code> ï¼Œæ¥æ‰“å¼€æŒ‡å®šçš„é¡µé¢äº†ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/03/Git-çš„-4-ä¸ªé˜¶æ®µçš„æ’¤é”€æ›´æ”¹/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/03/Git-çš„-4-ä¸ªé˜¶æ®µçš„æ’¤é”€æ›´æ”¹/" itemprop="url">Git çš„ 4 ä¸ªé˜¶æ®µçš„æ’¤é”€æ›´æ”¹</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-11-03T13:07:36+08:00">
                2017-11-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>è™½ç„¶gitè¯ç”Ÿè·ä»Šå·²æœ‰12å¹´ä¹‹ä¹…ï¼Œç½‘ä¸Šå„ç§å…³äºgitçš„ä»‹ç»æ–‡ç« æ•°ä¸èƒœæ•°ï¼Œä½†æ˜¯ä¾ç„¶æœ‰å¾ˆå¤šäººï¼ˆåŒ…æ‹¬æˆ‘è‡ªå·±åœ¨å†…ï¼‰å¯¹äºå®ƒçš„åŠŸèƒ½ä¸èƒ½å®Œå…¨æŒæ¡ã€‚ä»¥ä¸‹çš„ä»‹ç»åªæ˜¯åŸºäºæˆ‘ä¸ªäººå¯¹äºgitçš„ç†è§£ï¼Œå¹¶ä¸”å¯èƒ½ç”Ÿç¼–ç¡¬é€ äº†ä¸€äº›ä¸å®Œå…¨ç¬¦åˆgitè¯´æ³•çš„è¯è¯­ã€‚ç›®çš„åªæ˜¯ä¸ºäº†è®©gité€šä¿—åŒ–ï¼Œä½¿åˆå­¦è€…ä¹Ÿèƒ½å¤§æ¦‚äº†è§£å¦‚ä½•å¿«é€Ÿä¸Šæ‰‹gitã€‚åŒæ—¶ï¼Œä¸‹é¢æ‰€æœ‰è®¨è®ºï¼Œæˆ‘ä»¬éƒ½å‡è®¾åªä½¿ç”¨ä¸€ä¸ªåˆ†æ”¯ï¼Œä¹Ÿå°±æ˜¯ä¸»åˆ†æ”¯masterçš„æƒ…å†µï¼Œè™½ç„¶è¿™ç§ä½œæ³•å¹¶ä¸ç¬¦åˆgitè§„èŒƒï¼Œä½†æ˜¯ç°å®æƒ…å†µä¸­ç»å¤§éƒ¨åˆ†ç”¨æˆ·æ˜¯ç›´æ¥åœ¨masteråˆ†æ”¯ä¸Šè¿›è¡Œå·¥ä½œçš„ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œæˆ‘ä»¬ä¸å»å¼•å…¥æ›´åŠ å¤æ‚çš„å„ç§åˆ†æ”¯çš„æƒ…å†µï¼Œä¹Ÿä¸æ¶‰åŠæ ‡ç­¾tagçš„æ“ä½œï¼Œåªè®²åœ¨æœ€ç®€å•çš„ä¸»åˆ†æ”¯ä¸Šå¦‚ä½•å›é€€ã€‚</p>
<h1 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a><strong>åŸºæœ¬æ¦‚å¿µ</strong></h1><h2 id="3ä¸ªæ­¥éª¤"><a href="#3ä¸ªæ­¥éª¤" class="headerlink" title="3ä¸ªæ­¥éª¤"></a><strong>3ä¸ªæ­¥éª¤</strong></h2><p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/9aPYe0E1fb1el0zsnhYXiadWS9DtUkHnwzsRUe3nJiclZIHpg0Mc2EYjcdSxicXjJSJDs9bOYlNEHbwJZzibibQxKpg/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt=""></p>
<p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„å·¥ä½œæµå°±æ˜¯3ä¸ªæ­¥éª¤ï¼Œå¯¹åº”ä¸Šå›¾ä¸­çš„3ä¸ªç®­å¤´çº¿ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">  git add .</span><br><span class="line">  </span><br><span class="line">  git commit -m &quot;comment&quot;</span><br><span class="line">  </span><br><span class="line">  git push</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">git add .æŠŠæ‰€æœ‰æ–‡ä»¶æ”¾å…¥æš‚å­˜åŒºï¼›</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">git commitæŠŠæ‰€æœ‰æ–‡ä»¶ä»æš‚å­˜åŒºæäº¤è¿›æœ¬åœ°ä»“åº“ï¼›</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">git pushæŠŠæ‰€æœ‰æ–‡ä»¶ä»æœ¬åœ°ä»“åº“æ¨é€è¿›è¿œç¨‹ä»“åº“ã€‚</span><br></pre></td></tr></table></figure></p>
<h2 id="4ä¸ªåŒº"><a href="#4ä¸ªåŒº" class="headerlink" title="4ä¸ªåŒº"></a><strong>4ä¸ªåŒº</strong></h2><p>gitä¹‹æ‰€ä»¥ä»¤äººè´¹è§£ï¼Œä¸»è¦æ˜¯å®ƒç›¸æ¯”äºsvnç­‰ç­‰ä¼ ç»Ÿçš„ç‰ˆæœ¬ç®¡ç†å·¥å…·ï¼Œå¤šå¼•å…¥äº†ä¸€ä¸ªæš‚å­˜åŒº(Stage)çš„æ¦‚å¿µï¼Œå°±å› ä¸ºå¤šäº†è¿™ä¸€ä¸ªæ¦‚å¿µï¼Œè€Œä½¿å¾ˆå¤šäººç–‘æƒ‘ã€‚å…¶å®ï¼Œåœ¨åˆå­¦è€…æ¥è¯´ï¼Œæ¯ä¸ªåŒºå…·ä½“æ€ä¹ˆå·¥ä½œçš„ï¼Œæˆ‘ä»¬å®Œå…¨ä¸éœ€è¦å…³å¿ƒï¼Œè€Œåªè¦çŸ¥é“æœ‰è¿™ä¹ˆ4ä¸ªåŒºå°±å¤Ÿäº†ï¼š</p>
<ul>
<li><p>å·¥ä½œåŒº(Working Area)</p>
</li>
<li><p>æš‚å­˜åŒº(Stage)</p>
</li>
<li><p>æœ¬åœ°ä»“åº“(Local Repository)</p>
</li>
<li><p>è¿œç¨‹ä»“åº“(Remote Repository)</p>
</li>
</ul>
<h2 id="5ç§çŠ¶æ€"><a href="#5ç§çŠ¶æ€" class="headerlink" title="5ç§çŠ¶æ€"></a><strong>5ç§çŠ¶æ€</strong></h2><p>ä»¥ä¸Š4ä¸ªåŒºï¼Œè¿›å…¥æ¯ä¸€ä¸ªåŒºæˆåŠŸä¹‹åä¼šäº§ç”Ÿä¸€ä¸ªçŠ¶æ€ï¼Œå†åŠ ä¸Šæœ€åˆå§‹çš„ä¸€ä¸ªçŠ¶æ€ï¼Œä¸€å…±æ˜¯5ç§çŠ¶æ€ã€‚ä»¥ä¸‹æˆ‘ä»¬æŠŠè¿™5ç§çŠ¶æ€åˆ†åˆ«å‘½åä¸ºï¼š</p>
<ul>
<li><p>æœªä¿®æ”¹(Origin)</p>
</li>
<li><p>å·²ä¿®æ”¹(Modified)</p>
</li>
<li><p>å·²æš‚å­˜(Staged)</p>
</li>
<li><p>å·²æäº¤(Committed)</p>
</li>
<li><p>å·²æ¨é€(Pushed)</p>
</li>
</ul>
<h1 id="æ£€æŸ¥ä¿®æ”¹"><a href="#æ£€æŸ¥ä¿®æ”¹" class="headerlink" title="æ£€æŸ¥ä¿®æ”¹"></a><strong>æ£€æŸ¥ä¿®æ”¹</strong></h1><p>äº†è§£äº†åŸºæœ¬æ¦‚å¿µä¹‹åï¼Œæˆ‘ä»¬æ¥è°ˆä¸€è°ˆçŠ¯é”™è¯¯ä¹‹åå¦‚ä½•æ’¤é”€çš„é—®é¢˜ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬è¦äº†è§£å¦‚ä½•æ£€æŸ¥è¿™3ä¸ªæ­¥éª¤å½“ä¸­æ¯ä¸€ä¸ªæ­¥éª¤ä¿®æ”¹äº†ä»€ä¹ˆï¼Œç„¶åæ‰å¥½åˆ¤æ–­æœ‰æ²¡æœ‰ä¿®æ”¹æˆåŠŸã€‚æ£€æŸ¥ä¿®æ”¹çš„äºŒçº§å‘½ä»¤éƒ½ç›¸åŒï¼Œéƒ½æ˜¯diffï¼Œåªæ˜¯å‚æ•°æœ‰æ‰€ä¸åŒã€‚</p>
<h2 id="å·²ä¿®æ”¹ï¼Œæœªæš‚å­˜"><a href="#å·²ä¿®æ”¹ï¼Œæœªæš‚å­˜" class="headerlink" title="å·²ä¿®æ”¹ï¼Œæœªæš‚å­˜"></a><strong>å·²ä¿®æ”¹ï¼Œæœªæš‚å­˜</strong></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git diff</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬åªæ˜¯ç®€å•åœ°åœ¨æµè§ˆå™¨é‡Œä¿å­˜äº†ä¸€ä¸‹æ–‡ä»¶ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰åšgit add .ä¹‹å‰ï¼Œæˆ‘ä»¬å¦‚ä½•æ£€æŸ¥æœ‰å“ªäº›ä¿®æ”¹ã€‚æˆ‘ä»¬å…ˆéšä¾¿æ‹¿ä¸€ä¸ªæ–‡ä»¶æ¥åšä¸€ä¸‹å®éªŒï¼š</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/9aPYe0E1fb1el0zsnhYXiadWS9DtUkHnwDg9nsy9V0Ra5nMdBquNG1HpYFaOazjo6vl1LPHJpjMia8ibicSXu0Svyw/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt=""></p>
<p>æˆ‘ä»¬åœ¨æ–‡ä»¶å¼€å¤´çš„ç¬¬2è¡Œèƒ¡ä¹±åŠ äº†4ä¸ªæ•°å­—1234ï¼Œå­˜ç›˜ï¼Œè¿™æ—¶æ–‡ä»¶è¿›å…¥äº†å·²ä¿®æ”¹çŠ¶æ€ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰è¿›å…¥æš‚å­˜åŒºï¼Œæˆ‘ä»¬è¿è¡Œgit diffï¼Œç»“æœå¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">diff --git a/index.md b/index.md</span><br><span class="line"></span><br><span class="line">index 73ff1ba..1066758 100644</span><br><span class="line"></span><br><span class="line">--- a/index.md</span><br><span class="line"></span><br><span class="line">+++ b/index.md</span><br><span class="line"></span><br><span class="line">@@ -1,5 +1,5 @@</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">-layout: main</span><br><span class="line"></span><br><span class="line">+1234layout: main</span><br><span class="line"></span><br><span class="line">color: black</span><br><span class="line"></span><br><span class="line">---</span><br></pre></td></tr></table></figure></p>
<p>git diffçš„ç»“æœå‘Šè¯‰æˆ‘ä»¬å“ªäº›æ–‡ä»¶å·²ç»åšäº†å“ªäº›ä¿®æ”¹ã€‚</p>
<p><strong>å·²æš‚å­˜ï¼Œæœªæäº¤</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git diff --cached</span><br></pre></td></tr></table></figure></p>
<p>ç°åœ¨æˆ‘ä»¬æŠŠä¿®æ”¹æ”¾å…¥æš‚å­˜åŒºçœ‹ä¸€ä¸‹ã€‚å…ˆæ‰§è¡Œgit add .ï¼Œç„¶åæ‰§è¡Œgit diffï¼Œä½ ä¼šå‘ç°æ²¡æœ‰ä»»ä½•ç»“æœï¼š</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/9aPYe0E1fb1el0zsnhYXiadWS9DtUkHnwXwBzS1lToMWWjy9lEibicoiaibAAAaZa1HCp2j6v52OTN1cjRDia7VTVE6w/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt=""></p>
<p>è¿™è¯´æ˜git diffè¿™ä¸ªå‘½ä»¤åªæ£€æŸ¥æˆ‘ä»¬çš„å·¥ä½œåŒºå’Œæš‚å­˜åŒºä¹‹é—´çš„å·®å¼‚ï¼Œå¦‚æœæˆ‘ä»¬æƒ³çœ‹åˆ°æš‚å­˜åŒºå’Œæœ¬åœ°ä»“åº“ä¹‹é—´çš„å·®å¼‚ï¼Œå°±éœ€è¦åŠ ä¸€ä¸ªå‚æ•°git diff â€“cachedï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">diff --git a/index.md b/index.md</span><br><span class="line"></span><br><span class="line">index 73ff1ba..1066758 100644</span><br><span class="line"></span><br><span class="line">--- a/index.md</span><br><span class="line"></span><br><span class="line">+++ b/index.md</span><br><span class="line"></span><br><span class="line">@@ -1,5 +1,5 @@</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">-layout: main</span><br><span class="line"></span><br><span class="line">+1234layout: main</span><br><span class="line"></span><br><span class="line">color: black</span><br><span class="line"></span><br><span class="line">---</span><br></pre></td></tr></table></figure></p>
<p>è¿™æ—¶å€™æˆ‘ä»¬çœ‹åˆ°çš„å·®å¼‚æ˜¯æš‚å­˜åŒºå’Œæœ¬åœ°ä»“åº“ä¹‹é—´çš„å·®å¼‚ã€‚</p>
<p><strong>å·²æäº¤ï¼Œæœªæ¨é€</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git diff master origin/master</span><br></pre></td></tr></table></figure></p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬æŠŠä¿®æ”¹ä»æš‚å­˜åŒºæäº¤åˆ°æœ¬åœ°ä»“åº“ï¼Œå†çœ‹ä¸€ä¸‹å·®å¼‚ã€‚å…ˆæ‰§è¡Œgit commitï¼Œç„¶åå†æ‰§è¡Œgit diff â€“cachedï¼Œæ²¡æœ‰å·®å¼‚ï¼Œæ‰§è¡Œgit diff master origin/masterï¼Œå¯ä»¥çœ‹åˆ°å·®å¼‚ï¼š</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/9aPYe0E1fb1el0zsnhYXiadWS9DtUkHnwNSkuZnLBptQUSBddcyOZURahoMau6Rq0cebaYVniaudrh3kXToVj6WA/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt=""></p>
<p>åœ¨è¿™é‡Œï¼Œmasterå°±æ˜¯ä½ çš„æœ¬åœ°ä»“åº“ï¼Œè€Œorigin/masterå°±æ˜¯ä½ çš„è¿œç¨‹ä»“åº“ï¼Œmasteræ˜¯ä¸»åˆ†æ”¯çš„æ„æ€ï¼Œå› ä¸ºæˆ‘ä»¬éƒ½åœ¨ä¸»åˆ†æ”¯ä¸Šå·¥ä½œï¼Œæ‰€ä»¥è¿™é‡Œä¸¤è¾¹éƒ½æ˜¯masterï¼Œè€Œoriginå°±ä»£è¡¨è¿œç¨‹ã€‚</p>
<h1 id="æ’¤é”€ä¿®æ”¹"><a href="#æ’¤é”€ä¿®æ”¹" class="headerlink" title="æ’¤é”€ä¿®æ”¹"></a><strong>æ’¤é”€ä¿®æ”¹</strong></h1><p>äº†è§£æ¸…æ¥šå¦‚ä½•æ£€æŸ¥å„ç§ä¿®æ”¹ä¹‹åï¼Œæˆ‘ä»¬å¼€å§‹å°è¯•å„ç§æ’¤é”€æ“ä½œã€‚</p>
<h2 id="å·²ä¿®æ”¹ï¼Œæœªæš‚å­˜-1"><a href="#å·²ä¿®æ”¹ï¼Œæœªæš‚å­˜-1" class="headerlink" title="å·²ä¿®æ”¹ï¼Œæœªæš‚å­˜"></a><strong>å·²ä¿®æ”¹ï¼Œæœªæš‚å­˜</strong></h2><p>å¦‚æœæˆ‘ä»¬åªæ˜¯åœ¨ç¼–è¾‘å™¨é‡Œä¿®æ”¹äº†æ–‡ä»¶ï¼Œä½†è¿˜æ²¡æœ‰æ‰§è¡Œgit add .ï¼Œè¿™æ—¶å€™æˆ‘ä»¬çš„æ–‡ä»¶è¿˜åœ¨å·¥ä½œåŒºï¼Œå¹¶æ²¡æœ‰è¿›å…¥æš‚å­˜åŒºï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> git checkout .</span><br><span class="line"></span><br><span class="line">æˆ–è€…</span><br><span class="line"></span><br><span class="line">  git reset --hard</span><br></pre></td></tr></table></figure></p>
<p>æ¥è¿›è¡Œæ’¤é”€æ“ä½œã€‚</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/9aPYe0E1fb1el0zsnhYXiadWS9DtUkHnw3vn4WgIpIIyGGweDCXuZzlhpOwS62ibmJNjwviaXsCp9bwshpI9KAKBQ/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt=""></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æ‰§è¡Œå®Œgit checkout .ä¹‹åï¼Œä¿®æ”¹å·²è¢«æ’¤é”€ï¼Œgit diffæ²¡æœ‰ä»»ä½•å†…å®¹äº†ã€‚</p>
<blockquote>
<p>ä¸€å¯¹åä¹‰è¯ git add .çš„åä¹‰è¯æ˜¯git checkout .ã€‚åšå®Œä¿®æ”¹ä¹‹åï¼Œå¦‚æœä½ æƒ³å‘å‰èµ°ä¸€æ­¥ï¼Œè®©ä¿®æ”¹è¿›å…¥æš‚å­˜åŒºï¼Œå°±æ‰§è¡Œgit add .ï¼Œå¦‚æœä½ æƒ³å‘åé€€ä¸€æ­¥ï¼Œæ’¤é”€åˆšæ‰çš„ä¿®æ”¹ï¼Œå°±æ‰§è¡Œgit checkout .ã€‚</p>
</blockquote>
<h2 id="å·²æš‚å­˜ï¼Œæœªæäº¤"><a href="#å·²æš‚å­˜ï¼Œæœªæäº¤" class="headerlink" title="å·²æš‚å­˜ï¼Œæœªæäº¤"></a><strong>å·²æš‚å­˜ï¼Œæœªæäº¤</strong></h2><p>ä½ å·²ç»æ‰§è¡Œäº†git add .ï¼Œä½†è¿˜æ²¡æœ‰æ‰§è¡Œgit commit -m â€œcommentâ€ã€‚è¿™æ—¶å€™ä½ æ„è¯†åˆ°äº†é”™è¯¯ï¼Œæƒ³è¦æ’¤é”€ï¼Œä½ å¯ä»¥æ‰§è¡Œï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git reset</span><br><span class="line"></span><br><span class="line">git checkout .</span><br></pre></td></tr></table></figure></p>
<p>æˆ–è€…<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reset --hard</span><br></pre></td></tr></table></figure></p>
<p>git resetåªæ˜¯æŠŠä¿®æ”¹é€€å›åˆ°äº†git add .ä¹‹å‰çš„çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¯´æ–‡ä»¶æœ¬èº«è¿˜å¤„äºå·²ä¿®æ”¹æœªæš‚å­˜çŠ¶æ€ï¼Œä½ å¦‚æœæƒ³é€€å›æœªä¿®æ”¹çŠ¶æ€ï¼Œè¿˜éœ€è¦æ‰§è¡Œgit checkout .ã€‚</p>
<p>æˆ–è®¸ä½ å·²ç»æ³¨æ„åˆ°äº†ï¼Œä»¥ä¸Šä¸¤ä¸ªæ­¥éª¤éƒ½å¯ä»¥ç”¨åŒä¸€ä¸ªå‘½ä»¤git reset â€“hardæ¥å®Œæˆã€‚æ˜¯çš„ï¼Œå°±æ˜¯è¿™ä¸ªå¼ºå¤§çš„å‘½ä»¤ï¼Œå¯ä»¥ä¸€æ­¥åˆ°ä½åœ°æŠŠä½ çš„ä¿®æ”¹å®Œå…¨æ¢å¤åˆ°æœªä¿®æ”¹çš„çŠ¶æ€ã€‚</p>
<p><strong>å·²æäº¤ï¼Œæœªæ¨é€</strong></p>
<p>ä½ çš„æ‰‹å¤ªå¿«ï¼Œä½ æ—¢æ‰§è¡Œäº†git add .ï¼Œåˆæ‰§è¡Œäº†git commitï¼Œè¿™æ—¶å€™ä½ çš„ä»£ç å·²ç»è¿›å…¥äº†ä½ çš„æœ¬åœ°ä»“åº“ï¼Œç„¶è€Œä½ åæ‚”äº†ï¼Œæ€ä¹ˆåŠï¼Ÿä¸è¦ç€æ€¥ï¼Œè¿˜æœ‰åŠæ³•ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reset --hard origin/master</span><br></pre></td></tr></table></figure></p>
<p>è¿˜æ˜¯è¿™ä¸ªgit reset â€“hardå‘½ä»¤ï¼Œåªä¸è¿‡è¿™æ¬¡å¤šäº†ä¸€ä¸ªå‚æ•°origin/masterï¼Œæ­£å¦‚æˆ‘ä»¬ä¸Šé¢è®²è¿‡çš„ï¼Œorigin/masterä»£è¡¨è¿œç¨‹ä»“åº“ï¼Œæ—¢ç„¶ä½ å·²ç»æ±¡æŸ“äº†ä½ çš„æœ¬åœ°ä»“åº“ï¼Œé‚£ä¹ˆå°±ä»è¿œç¨‹ä»“åº“æŠŠä»£ç å–å›æ¥å§ã€‚</p>
<p><strong>å·²æ¨é€</strong></p>
<p>å¾ˆä¸å¹¸ï¼Œä½ çš„æ‰‹å®åœ¨æ˜¯å¤ªå¿«äº†ï¼Œä½ æ—¢git addäº†ï¼Œåˆgit commitäº†ï¼Œå¹¶ä¸”è¿˜git pushäº†ï¼Œè¿™æ—¶ä½ çš„ä»£ç å·²ç»è¿›å…¥è¿œç¨‹ä»“åº“ã€‚å¦‚æœä½ æƒ³æ¢å¤çš„è¯ï¼Œè¿˜å¥½ï¼Œç”±äºä½ çš„æœ¬åœ°ä»“åº“å’Œè¿œç¨‹ä»“åº“æ˜¯ç­‰ä»·çš„ï¼Œä½ åªéœ€è¦å…ˆæ¢å¤æœ¬åœ°ä»“åº“ï¼Œå†å¼ºåˆ¶pushåˆ°è¿œç¨‹ä»“åº“å°±å¥½äº†ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git reset --hard HEAD^</span><br><span class="line"></span><br><span class="line">git push -f</span><br></pre></td></tr></table></figure></p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/9aPYe0E1fb1el0zsnhYXiadWS9DtUkHnwCtsdla2FrJ4nCjP0tBssNeB7ZqBkQON4Jcxb2ghrAUEibNa2icoiaB3cg/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt=""></p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a><strong>æ€»ç»“</strong></h1><p>ä»¥ä¸Š4ç§çŠ¶æ€çš„æ’¤é”€æˆ‘ä»¬éƒ½ç”¨åˆ°äº†åŒä¸€ä¸ªå‘½ä»¤git reset â€“hardï¼Œå‰2ç§çŠ¶æ€çš„ç”¨æ³•ç”šè‡³å®Œå…¨ä¸€æ ·ï¼Œæ‰€ä»¥åªè¦æŒæ¡äº†git reset â€“hardè¿™ä¸ªå‘½ä»¤çš„ç”¨æ³•ï¼Œä»æ­¤ä½ å†ä¹Ÿä¸ç”¨æ‹…å¿ƒæäº¤é”™è¯¯äº†ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/6/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/8/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/tx.jpg"
                alt="ææ–Œ" />
            
              <p class="site-author-name" itemprop="name">ææ–Œ</p>
              <p class="site-description motion-element" itemprop="description">æƒ³è¦é£å¾—é«˜ï¼Œé‚£å°±æŠŠåœ°å¹³çº¿å¿˜æ‰</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">108</span>
                  <span class="site-state-item-name">æ—¥å¿—</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">78</span>
                  <span class="site-state-item-name">æ ‡ç­¾</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/libin1991" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="3120217729@qq.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://juejin.im/user/57e737f6c4c971005f6bcd8d" target="_blank" title="juejin">
                      
                        <i class="fa fa-fw fa-spinner"></i>juejin</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ææ–Œ</span>

  
</div>


  <div class="powered-by">ç”± <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">ä¸»é¢˜ &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
<script type="text/javascript" src="/js/src/clicklove.js"></script>

