<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="Blog">
<meta property="og:type" content="website">
<meta property="og:title" content="LuckDay">
<meta property="og:url" content="http://yoursite.com/page/7/index.html">
<meta property="og:site_name" content="LuckDay">
<meta property="og:description" content="Blog">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="LuckDay">
<meta name="twitter:description" content="Blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/7/"/>





  <title>LuckDay - æƒ³è¦é£å¾—é«˜ï¼Œé‚£å°±æŠŠåœ°å¹³çº¿å¿˜æ‰</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband">
    	<div class="eevee"><div class="body"><div class="head"><div class="ears"><div class="ear"><div class="lobe"></div></div><div class="ear"><div class="lobe"></div></div></div><div class="face"><div class="eyes"><div class="eye"><div class="eyelid"></div></div><div class="eye"><div class="eyelid"></div></div></div><div class="nose"></div><div class="mouth"></div></div></div><div class="chest"><div class="fur"><div class="patch"></div></div><div class="fur"><div class="patch"></div></div><div class="fur"><div class="patch"></div></div></div><div class="legs"><div class="leg"><div class="inner-leg"></div></div><div class="leg"><div class="inner-leg"></div></div><div class="leg"><div class="inner-leg"></div></div><div class="leg"><div class="inner-leg"></div></div></div><div class="tail"><div class="tail"><div class="tail"><div class="tail"><div class="tail"><div class="tail -end"></div></div></div></div></div></div></div></div>
    </div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
    	<div class="sky">
	<div class="clouds_one"></div>
	<div class="clouds_two"></div>
	<div class="clouds_three"></div>
</div>
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">LuckDay</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">æƒ³è¦é£å¾—é«˜ï¼Œé‚£å°±æŠŠåœ°å¹³çº¿å¿˜æ‰</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            æ ‡ç­¾
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            å…³äº
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            æœç´¢
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="æœç´¢..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/09/44ä¸ªJavaScript-å˜æ€é¢˜è§£æ/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/09/44ä¸ªJavaScript-å˜æ€é¢˜è§£æ/" itemprop="url">44ä¸ªJavaScript å˜æ€é¢˜è§£æ</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-12-09T18:39:40+08:00">
                2017-12-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="/2017/12/09/44ä¸ªJavaScript-å˜æ€é¢˜è§£æ/1.jpg" alt=""></p>
<h2 id="ç¬¬1é¢˜"><a href="#ç¬¬1é¢˜" class="headerlink" title="ç¬¬1é¢˜"></a>ç¬¬1é¢˜</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&quot;1&quot;, &quot;2&quot;, &quot;3&quot;].map(parseInt)</span><br></pre></td></tr></table></figure>
<p>çŸ¥è¯†ç‚¹:</p>
<ul>
<li><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FArray%2Fmap" target="_blank" rel="noopener">Array/map</a></li>
<li><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FNumber%2FparseInt" target="_blank" rel="noopener">Number/parseInt</a></li>
<li><p><a href="https://link.juejin.im?target=http%3A%2F%2Fwww.w3school.com.cn%2Fjsref%2Fjsref_parseInt.asp" target="_blank" rel="noopener">JavaScript parseInt</a></p>
<p>é¦–å…ˆ, mapæ¥å—ä¸¤ä¸ªå‚æ•°, ä¸€ä¸ªå›è°ƒå‡½æ•° callback, ä¸€ä¸ªå›è°ƒå‡½æ•°çš„thiså€¼</p>
<p>å…¶ä¸­å›è°ƒå‡½æ•°æ¥å—ä¸‰ä¸ªå‚æ•° currentValue, index, arrary;</p>
<p>è€Œé¢˜ç›®ä¸­, mapåªä¼ å…¥äº†å›è°ƒå‡½æ•°â€“parseInt.</p>
<p>å…¶æ¬¡, parseInt åªæ¥å—ä¸¤ä¸ªä¸¤ä¸ªå‚æ•° string, radix(åŸºæ•°).</p>
</li>
</ul>
<blockquote>
<p> å¯é€‰ã€‚è¡¨ç¤ºè¦è§£æçš„æ•°å­—çš„åŸºæ•°ã€‚è¯¥å€¼ä»‹äº 2 ~ 36 ä¹‹é—´ã€‚<br> å¦‚æœçœç•¥è¯¥å‚æ•°æˆ–å…¶å€¼ä¸º 0ï¼Œåˆ™æ•°å­—å°†ä»¥ 10 ä¸ºåŸºç¡€æ¥è§£æã€‚å¦‚æœå®ƒä»¥ â€œ0xâ€ æˆ– â€œ0Xâ€ å¼€å¤´ï¼Œå°†ä»¥ 16 ä¸ºåŸºæ•°ã€‚<br> å¦‚æœè¯¥å‚æ•°å°äº 2 æˆ–è€…å¤§äº 36ï¼Œåˆ™ parseInt() å°†è¿”å› NaNã€‚</p>
</blockquote>
<p> æ‰€ä»¥æœ¬é¢˜å³é—®<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">parseInt(&apos;1&apos;, 0);</span><br><span class="line">parseInt(&apos;2&apos;, 1);</span><br><span class="line">parseInt(&apos;3&apos;, 2);</span><br></pre></td></tr></table></figure></p>
<p> é¦–å…ˆåä¸¤è€…å‚æ•°ä¸åˆæ³•.</p>
<p> æ‰€ä»¥ç­”æ¡ˆæ˜¯ [1, NaN, NaN]</p>
<h2 id="ç¬¬2é¢˜"><a href="#ç¬¬2é¢˜" class="headerlink" title="ç¬¬2é¢˜"></a>ç¬¬2é¢˜</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[typeof null, null instanceof Object]</span><br></pre></td></tr></table></figure>
<p> ä¸¤ä¸ªçŸ¥è¯†ç‚¹:</p>
<ul>
<li><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FOperators%2Ftypeof" target="_blank" rel="noopener">Operators/typeof</a></li>
<li><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FOperators%2Finstanceof" target="_blank" rel="noopener">Operators/instanceof</a></li>
<li><p><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FOperators%2Finstanceof" target="_blank" rel="noopener">Operators/instanceof(ä¸­)</a></p>
<p>typeof è¿”å›ä¸€ä¸ªè¡¨ç¤ºç±»å‹çš„å­—ç¬¦ä¸².</p>
<p>instanceof è¿ç®—ç¬¦ç”¨æ¥æ£€æµ‹ constructor.prototype æ˜¯å¦å­˜åœ¨äºå‚æ•° object çš„åŸå‹é“¾ä¸Š.</p>
<p>è¿™ä¸ªé¢˜å¯ä»¥ç›´æ¥çœ‹é“¾æ¥â€¦ å› ä¸º typeof null === â€˜objectâ€™ è‡ªè¯­è¨€ä¹‹åˆå°±æ˜¯è¿™æ ·â€¦.</p>
</li>
</ul>
<p>typeof çš„ç»“æœè¯·çœ‹ä¸‹è¡¨:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">type         result</span><br><span class="line">Undefined   &quot;undefined&quot;</span><br><span class="line">Null        &quot;object&quot;</span><br><span class="line">Boolean     &quot;boolean&quot;</span><br><span class="line">Number      &quot;number&quot;</span><br><span class="line">String      &quot;string&quot;</span><br><span class="line">Symbol      &quot;symbol&quot;</span><br><span class="line">Host object Implementation-dependent</span><br><span class="line">Function    &quot;function&quot;</span><br><span class="line">Object      &quot;object&quot;</span><br></pre></td></tr></table></figure></p>
<p> æ‰€ä»¥ç­”æ¡ˆ [object, false]</p>
<h2 id="ç¬¬3é¢˜"><a href="#ç¬¬3é¢˜" class="headerlink" title="ç¬¬3é¢˜"></a>ç¬¬3é¢˜</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[ [3,2,1].reduce(Math.pow), [].reduce(Math.pow) ]</span><br></pre></td></tr></table></figure>
<p> çŸ¥è¯†ç‚¹:</p>
<ul>
<li><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FArray%2FReduce" target="_blank" rel="noopener">Array/Reduce</a></li>
</ul>
<p>arr.reduce(callback[, initialValue])</p>
<p>reduceæ¥å—ä¸¤ä¸ªå‚æ•°, ä¸€ä¸ªå›è°ƒ, ä¸€ä¸ªåˆå§‹å€¼.</p>
<p>å›è°ƒå‡½æ•°æ¥å—å››ä¸ªå‚æ•° previousValue, currentValue, currentIndex, array</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ If the array is empty and no initialValue was provided, TypeError would be thrown.</p>
<p>æ‰€ä»¥ç¬¬äºŒä¸ªè¡¨è¾¾å¼ä¼šæŠ¥å¼‚å¸¸. ç¬¬ä¸€ä¸ªè¡¨è¾¾å¼ç­‰ä»·äº Math.pow(3, 2) =&gt; 9; Math.pow(9, 1) =&gt;9</p>
<p>ç­”æ¡ˆ an error</p>
<h2 id="ç¬¬4é¢˜"><a href="#ç¬¬4é¢˜" class="headerlink" title="ç¬¬4é¢˜"></a>ç¬¬4é¢˜</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var val = &apos;smtg&apos;;</span><br><span class="line">console.log(&apos;Value is &apos; + (val === &apos;smtg&apos;) ? &apos;Something&apos; : &apos;Nothing&apos;);</span><br></pre></td></tr></table></figure>
<p> ä¸¤ä¸ªçŸ¥è¯†ç‚¹:</p>
<ul>
<li><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FOperators%2FOperator_Precedence" target="_blank" rel="noopener">Operators/Operator_Precedence</a></li>
<li><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FOperators%2FConditional_Operator" target="_blank" rel="noopener">Operators/Conditional_Operator</a></li>
</ul>
<p>ç®€è€Œè¨€ä¹‹ + çš„ä¼˜å…ˆçº§ å¤§äº ?</p>
<p>æ‰€ä»¥åŸé¢˜ç­‰ä»·äº â€˜Value is trueâ€™ ? â€˜Somthingâ€™ : â€˜Nonthingâ€™ è€Œä¸æ˜¯ â€˜Value isâ€™ + (true ? â€˜Somethingâ€™ : â€˜Nonthingâ€™)</p>
<p>ç­”æ¡ˆ â€˜Somethingâ€™</p>
<h2 id="ç¬¬5é¢˜"><a href="#ç¬¬5é¢˜" class="headerlink" title="ç¬¬5é¢˜"></a>ç¬¬5é¢˜</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var name = &apos;World!&apos;;</span><br><span class="line">(function () &#123;</span><br><span class="line">    if (typeof name === &apos;undefined&apos;) &#123;</span><br><span class="line">        var name = &apos;Jack&apos;;</span><br><span class="line">        console.log(&apos;Goodbye &apos; + name);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        console.log(&apos;Hello &apos; + name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p> è¿™ä¸ªç›¸å¯¹ç®€å•, ä¸€ä¸ªçŸ¥è¯†ç‚¹:</p>
<ul>
<li><p><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FGlossary%2FHoisting" target="_blank" rel="noopener">Hoisting</a></p>
<p>åœ¨ JavaScriptä¸­ï¼Œ functions å’Œ variables ä¼šè¢«æå‡ã€‚å˜é‡æå‡æ˜¯JavaScriptå°†å£°æ˜ç§»è‡³ä½œç”¨åŸŸ scope (å…¨å±€åŸŸæˆ–è€…å½“å‰å‡½æ•°ä½œç”¨åŸŸ) é¡¶éƒ¨çš„è¡Œä¸ºã€‚</p>
</li>
</ul>
<p>è¿™ä¸ªé¢˜ç›®ç›¸å½“äº<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">var name = &apos;World!&apos;;</span><br><span class="line">(function () &#123;</span><br><span class="line">    var name;</span><br><span class="line">    if (typeof name === &apos;undefined&apos;) &#123;</span><br><span class="line">        name = &apos;Jack&apos;;</span><br><span class="line">        console.log(&apos;Goodbye &apos; + name);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        console.log(&apos;Hello &apos; + name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure></p>
<p> æ‰€ä»¥ç­”æ¡ˆæ˜¯ â€˜Goodbye Jackâ€™</p>
<h2 id="ç¬¬6é¢˜"><a href="#ç¬¬6é¢˜" class="headerlink" title="ç¬¬6é¢˜"></a>ç¬¬6é¢˜</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var END = Math.pow(2, 53);</span><br><span class="line">var START = END - 100;</span><br><span class="line">var count = 0;</span><br><span class="line">for (var i = START; i &lt;= END; i++) &#123;</span><br><span class="line">    count++;</span><br><span class="line">&#125;</span><br><span class="line">console.log(count);</span><br></pre></td></tr></table></figure>
<p> ä¸€ä¸ªçŸ¥è¯†ç‚¹:</p>
<ul>
<li><p><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FInfinity" target="_blank" rel="noopener">Infinity</a></p>
<p>åœ¨ JS é‡Œ, Math.pow(2, 53) == 9007199254740992 æ˜¯å¯ä»¥è¡¨ç¤ºçš„æœ€å¤§å€¼. æœ€å¤§å€¼åŠ ä¸€è¿˜æ˜¯æœ€å¤§å€¼. æ‰€ä»¥å¾ªç¯ä¸ä¼šåœ.</p>
</li>
</ul>
<h2 id="ç¬¬7é¢˜"><a href="#ç¬¬7é¢˜" class="headerlink" title="ç¬¬7é¢˜"></a>ç¬¬7é¢˜</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var ary = [0,1,2];</span><br><span class="line">ary[10] = 10;</span><br><span class="line">ary.filter(function(x) &#123; return x === undefined;&#125;);</span><br></pre></td></tr></table></figure>
<p>ç­”æ¡ˆæ˜¯ []</p>
<p> çœ‹ä¸€ç¯‡æ–‡ç« ç†è§£ç¨€ç–æ•°ç»„</p>
<ul>
<li><a href="https://link.juejin.im?target=http%3A%2F%2Fwww.cnblogs.com%2Fziyunfei%2Farchive%2F2012%2F09%2F16%2F2687165.html" target="_blank" rel="noopener">è¯‘ JavaScriptä¸­çš„ç¨€ç–æ•°ç»„ä¸å¯†é›†æ•°ç»„</a></li>
<li><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FArray%2Ffilter" target="_blank" rel="noopener">Array/filter</a></li>
</ul>
<p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ Array.prototype.filter çš„ polyfill:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">if (!Array.prototype.filter) &#123;</span><br><span class="line">  Array.prototype.filter = function(fun/*, thisArg*/) &#123;</span><br><span class="line">    &apos;use strict&apos;;</span><br><span class="line"></span><br><span class="line">    if (this === void 0 || this === null) &#123;</span><br><span class="line">      throw new TypeError();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    var t = Object(this);</span><br><span class="line">    var len = t.length &gt;&gt;&gt; 0;</span><br><span class="line">    if (typeof fun !== &apos;function&apos;) &#123;</span><br><span class="line">      throw new TypeError();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    var res = [];</span><br><span class="line">    var thisArg = arguments.length &gt;= 2 ? arguments[1] : void 0;</span><br><span class="line">    for (var i = 0; i &lt; len; i++) &#123;</span><br><span class="line">      if (i in t) &#123; // æ³¨æ„è¿™é‡Œ!!!</span><br><span class="line">        var val = t[i];</span><br><span class="line">        if (fun.call(thisArg, val, i, t)) &#123;</span><br><span class="line">          res.push(val);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return res;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p> æˆ‘ä»¬çœ‹åˆ°åœ¨è¿­ä»£è¿™ä¸ªæ•°ç»„çš„æ—¶å€™, é¦–å…ˆæ£€æŸ¥äº†è¿™ä¸ªç´¢å¼•å€¼æ˜¯ä¸æ˜¯æ•°ç»„çš„ä¸€ä¸ªå±æ€§, é‚£ä¹ˆæˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0 in ary; =&gt; true</span><br><span class="line">3 in ary; =&gt; false</span><br><span class="line">10 in ary; =&gt; true</span><br></pre></td></tr></table></figure></p>
<p>ä¹Ÿå°±æ˜¯è¯´ ä» 3 - 9 éƒ½æ˜¯æ²¡æœ‰åˆå§‹åŒ–çš„â€™å‘â€™!, è¿™äº›ç´¢å¼•å¹¶ä¸å­˜åœ¨ä¸æ•°ç»„ä¸­. åœ¨ array çš„å‡½æ•°è°ƒç”¨çš„æ—¶å€™æ˜¯ä¼šè·³è¿‡è¿™äº›â€™å‘â€™çš„.</p>
<h2 id="ç¬¬8é¢˜"><a href="#ç¬¬8é¢˜" class="headerlink" title="ç¬¬8é¢˜"></a>ç¬¬8é¢˜</h2><pre><code>var two   = 0.2
var one   = 0.1
var eight = 0.8
var six   = 0.6
[two - one == one, eight - six == two]
</code></pre><ul>
<li><p><a href="https://link.juejin.im?target=http%3A%2F%2Fourjs.com%2Fdetail%2F54695381bc3f9b154e000046" target="_blank" rel="noopener">JavaScriptçš„è®¾è®¡ç¼ºé™·?æµ®ç‚¹è¿ç®—ï¼š0.1 + 0.2 != 0.3</a></p>
<p>IEEE 754æ ‡å‡†ä¸­çš„æµ®ç‚¹æ•°å¹¶ä¸èƒ½ç²¾ç¡®åœ°è¡¨è¾¾å°æ•°</p>
<p>é‚£ä»€ä¹ˆæ—¶å€™ç²¾å‡†, ä»€ä¹ˆæ—¶å€™ä¸ç»å‡†å‘¢? ç¬”è€…ä¹Ÿä¸çŸ¥é“â€¦</p>
<p>ç­”æ¡ˆ [true, false]</p>
</li>
</ul>
<h2 id="ç¬¬9é¢˜"><a href="#ç¬¬9é¢˜" class="headerlink" title="ç¬¬9é¢˜"></a>ç¬¬9é¢˜</h2><pre><code>function showCase(value) {
    switch(value) {
    case &apos;A&apos;:
        console.log(&apos;Case A&apos;);
        break;
    case &apos;B&apos;:
        console.log(&apos;Case B&apos;);
        break;
    case undefined:
        console.log(&apos;undefined&apos;);
        break;
    default:
        console.log(&apos;Do not know!&apos;);
    }
}
showCase(new String(&apos;A&apos;));
</code></pre><p> ä¸¤ä¸ªçŸ¥è¯†ç‚¹:</p>
<ul>
<li><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FStatements%2Fswitch" target="_blank" rel="noopener">Statements/switch</a></li>
<li><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FString" target="_blank" rel="noopener">String</a></li>
</ul>
<p>switch æ˜¯ä¸¥æ ¼æ¯”è¾ƒ, String å®ä¾‹å’Œ å­—ç¬¦ä¸²ä¸ä¸€æ ·.</p>
<pre><code>var s_prim = &apos;foo&apos;;
var s_obj = new String(s_prim);

console.log(typeof s_prim); // &quot;string&quot;
console.log(typeof s_obj);  // &quot;object&quot;
console.log(s_prim === s_obj); // false
</code></pre><p> ç­”æ¡ˆæ˜¯ â€˜Do not know!â€™</p>
<h2 id="ç¬¬10é¢˜"><a href="#ç¬¬10é¢˜" class="headerlink" title="ç¬¬10é¢˜"></a>ç¬¬10é¢˜</h2><pre><code>function showCase2(value) {
    switch(value) {
    case &apos;A&apos;:
        console.log(&apos;Case A&apos;);
        break;
    case &apos;B&apos;:
        console.log(&apos;Case B&apos;);
        break;
    case undefined:
        console.log(&apos;undefined&apos;);
        break;
    default:
        console.log(&apos;Do not know!&apos;);
    }
}
showCase2(String(&apos;A&apos;));
</code></pre><p>è§£é‡Š:<br> String(x) does not create an object but does return a string, i.e. typeof String(1) === â€œstringâ€</p>
<p>è¿˜æ˜¯åˆšæ‰çš„çŸ¥è¯†ç‚¹, åªä¸è¿‡ String ä¸ä»…æ˜¯ä¸ªæ„é€ å‡½æ•° ç›´æ¥è°ƒç”¨è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²å“¦.</p>
<p> ç­”æ¡ˆ â€˜Case Aâ€™</p>
<h2 id="ç¬¬11é¢˜"><a href="#ç¬¬11é¢˜" class="headerlink" title="ç¬¬11é¢˜"></a>ç¬¬11é¢˜</h2><pre><code>function isOdd(num) {
    return num % 2 == 1;
}
function isEven(num) {
    return num % 2 == 0;
}
function isSane(num) {
    return isEven(num) || isOdd(num);
}
var values = [7, 4, &apos;13&apos;, -9, Infinity];
values.map(isSane);
</code></pre><p> ä¸€ä¸ªçŸ¥è¯†ç‚¹</p>
<ul>
<li><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FOperators%2FArithmetic_Operators%23Remainder" target="_blank" rel="noopener">Arithmetic_Operators#Remainder</a></li>
</ul>
<p>æ­¤é¢˜ç­‰ä»·äº<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">7 % 2 =&gt; 1</span><br><span class="line">4 % 2 =&gt; 0</span><br><span class="line">&apos;13&apos; % 2 =&gt; 1</span><br><span class="line">-9 % % 2 =&gt; -1</span><br><span class="line">Infinity % 2 =&gt; NaN</span><br></pre></td></tr></table></figure></p>
<p> éœ€è¦æ³¨æ„çš„æ˜¯ ä½™æ•°çš„æ­£è´Ÿå·éšç¬¬ä¸€ä¸ªæ“ä½œæ•°.</p>
<p> ç­”æ¡ˆ [true, true, true, false, false]</p>
<h2 id="ç¬¬12é¢˜"><a href="#ç¬¬12é¢˜" class="headerlink" title="ç¬¬12é¢˜"></a>ç¬¬12é¢˜</h2><pre><code>parseInt(3, 8)
parseInt(3, 2)
parseInt(3, 0)
</code></pre><p> ç¬¬ä¸€ä¸ªé¢˜è®²è¿‡äº†, ç­”æ¡ˆ 3, NaN, 3</p>
<h2 id="ç¬¬13é¢˜"><a href="#ç¬¬13é¢˜" class="headerlink" title="ç¬¬13é¢˜"></a>ç¬¬13é¢˜</h2><pre><code>Array.isArray( Array.prototype )
</code></pre><p> ä¸€ä¸ªçŸ¥è¯†ç‚¹:</p>
<ul>
<li><p><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FArray%2Fprototype" target="_blank" rel="noopener">Array/prototype</a></p>
<p>ä¸€ä¸ªé²œä¸ºäººçŸ¥çš„å®äº‹: Array.prototype =&gt; [];</p>
<p>ç­”æ¡ˆ: true</p>
</li>
</ul>
<h2 id="ç¬¬14é¢˜"><a href="#ç¬¬14é¢˜" class="headerlink" title="ç¬¬14é¢˜"></a>ç¬¬14é¢˜</h2><pre><code>var a = [0];
if ([0]) {
  console.log(a == true);
} else {
  console.log(&quot;wut&quot;);
}
</code></pre><ul>
<li><p><a href="https://link.juejin.im?target=https%3A%2F%2Fdorey.github.io%2FJavaScript-Equality-Table%2F" target="_blank" rel="noopener">JavaScript-Equality-Table</a></p>
<p>ç­”æ¡ˆ: false</p>
</li>
</ul>
<h2 id="ç¬¬15é¢˜"><a href="#ç¬¬15é¢˜" class="headerlink" title="ç¬¬15é¢˜"></a>ç¬¬15é¢˜</h2><pre><code>[]==[]
</code></pre><p> == æ˜¯ä¸‡æ¶ä¹‹æº, çœ‹ä¸Šå›¾</p>
<p> ç­”æ¡ˆæ˜¯ false</p>
<h2 id="ç¬¬16é¢˜"><a href="#ç¬¬16é¢˜" class="headerlink" title="ç¬¬16é¢˜"></a>ç¬¬16é¢˜</h2><pre><code>&apos;5&apos; + 3
&apos;5&apos; - 3
</code></pre><p> ä¸¤ä¸ªçŸ¥è¯†ç‚¹:</p>
<ul>
<li><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FOperators%2FArithmetic_Operators%23Addition" target="_blank" rel="noopener">Arithmetic_Operators#Addition</a></li>
<li><p><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FOperators%2FArithmetic_Operators%23Subtraction" target="_blank" rel="noopener">Arithmetic_Operators#Subtraction</a></p>
<ul>
<li>ç”¨æ¥è¡¨ç¤ºä¸¤ä¸ªæ•°çš„å’Œæˆ–è€…å­—ç¬¦ä¸²æ‹¼æ¥, -è¡¨ç¤ºä¸¤æ•°ä¹‹å·®.</li>
</ul>
</li>
</ul>
<p>è¯·çœ‹ä¾‹å­, ä½“ä¼šåŒºåˆ«:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; &apos;5&apos; + 3</span><br><span class="line">&apos;53&apos;</span><br><span class="line">&gt; 5 + &apos;3&apos;</span><br><span class="line">&apos;53&apos;</span><br><span class="line">&gt; 5 - &apos;3&apos;</span><br><span class="line">2</span><br><span class="line">&gt; &apos;5&apos; - 3</span><br><span class="line">2</span><br><span class="line">&gt; &apos;5&apos; - &apos;3&apos;</span><br><span class="line">2</span><br></pre></td></tr></table></figure></p>
<p> ä¹Ÿå°±æ˜¯è¯´ - ä¼šå°½å¯èƒ½çš„å°†ä¸¤ä¸ªæ“ä½œæ•°å˜æˆæ•°å­—, è€Œ + å¦‚æœä¸¤è¾¹ä¸éƒ½æ˜¯æ•°å­—, é‚£ä¹ˆå°±æ˜¯å­—ç¬¦ä¸²æ‹¼æ¥.</p>
<p> ç­”æ¡ˆæ˜¯ â€˜53â€™, 2</p>
<h2 id="ç¬¬17é¢˜"><a href="#ç¬¬17é¢˜" class="headerlink" title="ç¬¬17é¢˜"></a>ç¬¬17é¢˜</h2><pre><code>1 + - + + + - + 1
</code></pre><p> è¿™é‡Œåº”è¯¥æ˜¯(å€’ç€çœ‹)</p>
<pre><code>1 + (a)  =&gt; 2
a = - (b) =&gt; 1
b = + (c) =&gt; -1
c = + (d) =&gt; -1
d = + (e) =&gt; -1
e = + (f) =&gt; -1
f = - (g) =&gt; -1
g = + 1   =&gt; 1
</code></pre><p> æ‰€ä»¥ç­”æ¡ˆ 2</p>
<h2 id="ç¬¬18é¢˜"><a href="#ç¬¬18é¢˜" class="headerlink" title="ç¬¬18é¢˜"></a>ç¬¬18é¢˜</h2><pre><code>var ary = Array(3);
ary[0]=2
ary.map(function(elem) { return &apos;1&apos;; });
</code></pre><p> ç¨€ç–æ•°ç»„. åŒç¬¬7é¢˜.</p>
<p> é¢˜ç›®ä¸­çš„æ•°ç»„å…¶å®æ˜¯ä¸€ä¸ªé•¿åº¦ä¸º3, ä½†æ˜¯æ²¡æœ‰å†…å®¹çš„æ•°ç»„, array ä¸Šçš„æ“ä½œä¼šè·³è¿‡è¿™äº›æœªåˆå§‹åŒ–çš„â€™å‘â€™.</p>
<p> æ‰€ä»¥ç­”æ¡ˆæ˜¯ [â€œ1â€, undefined Ã— 2]</p>
<p> è¿™é‡Œè´´ä¸Š Array.prototype.map çš„ polyfill.</p>
<pre><code>Array.prototype.map = function(callback, thisArg) {

        var T, A, k;

        if (this == null) {
            throw new TypeError(&apos; this is null or not defined&apos;);
        }

        var O = Object(this);
        var len = O.length &gt;&gt;&gt; 0;
        if (typeof callback !== &apos;function&apos;) {
            throw new TypeError(callback + &apos; is not a function&apos;);
        }
        if (arguments.length &gt; 1) {
            T = thisArg;
        }
        A = new Array(len);
        k = 0;
        while (k &lt; len) {
            var kValue, mappedValue;
            if (k in O) {
                kValue = O[k];
                mappedValue = callback.call(T, kValue, k, O);
                A[k] = mappedValue;
            }
            k++;
        }
        return A;
    };
</code></pre><h2 id="ç¬¬19é¢˜"><a href="#ç¬¬19é¢˜" class="headerlink" title="ç¬¬19é¢˜"></a>ç¬¬19é¢˜</h2><pre><code>function sidEffecting(ary) {
  ary[0] = ary[2];
}
function bar(a,b,c) {
  c = 10
  sidEffecting(arguments);
  return a + b + c;
}
bar(1,1,1)
</code></pre><p> è¿™æ˜¯ä¸€ä¸ªå¤§å‘, å°¤å…¶æ˜¯æ¶‰åŠåˆ° ES6è¯­æ³•çš„æ—¶å€™</p>
<p> çŸ¥è¯†ç‚¹:</p>
<ul>
<li><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FFunctions%2Farguments" target="_blank" rel="noopener">Functions/arguments</a></li>
</ul>
<p>é¦–å…ˆ The arguments object is an Array-like object corresponding to the arguments passed to a function.</p>
<p>ä¹Ÿå°±æ˜¯è¯´ arguments æ˜¯ä¸€ä¸ª object, c å°±æ˜¯ arguments[2], æ‰€ä»¥å¯¹äº c çš„ä¿®æ”¹å°±æ˜¯å¯¹ arguments[2] çš„ä¿®æ”¹.</p>
<p>æ‰€ä»¥ç­”æ¡ˆæ˜¯ 21.</p>
<p>ç„¶è€Œ!!!!!!</p>
<p>å½“å‡½æ•°å‚æ•°æ¶‰åŠåˆ° any rest parameters, any default parameters or any destructured parameters çš„æ—¶å€™, è¿™ä¸ª arguments å°±ä¸åœ¨æ˜¯ä¸€ä¸ª mapped arguments object äº†â€¦..</p>
<p>è¯·çœ‹:</p>
<pre><code>function sidEffecting(ary) {
  ary[0] = ary[2];
}
function bar(a,b,c=3) {
  c = 10
  sidEffecting(arguments);
  return a + b + c;
}
bar(1,1,1)
</code></pre><p> ç­”æ¡ˆæ˜¯ 12 !!!!</p>
<p> è¯·è¯»è€…ç»†ç»†ä½“ä¼š!!</p>
<h2 id="ç¬¬20é¢˜"><a href="#ç¬¬20é¢˜" class="headerlink" title="ç¬¬20é¢˜"></a>ç¬¬20é¢˜</h2><pre><code>var a = 111111111111111110000,
    b = 1111;
a + b;
</code></pre><p> ç­”æ¡ˆè¿˜æ˜¯ 111111111111111110000. è§£é‡Šæ˜¯ Lack of precision for numbers in JavaScript affects both small and big numbers. ä½†æ˜¯ç¬”è€…ä¸æ˜¯å¾ˆæ˜ç™½â€¦â€¦â€¦â€¦â€¦. è¯·è¯»è€…èµæ•™!</p>
<h2 id="ç¬¬21é¢˜"><a href="#ç¬¬21é¢˜" class="headerlink" title="ç¬¬21é¢˜"></a>ç¬¬21é¢˜</h2><pre><code>var x = [].reverse;
x();
</code></pre><p> è¿™ä¸ªé¢˜æœ‰æ„æ€!</p>
<p> çŸ¥è¯†ç‚¹:</p>
<ul>
<li><p><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FArray%2Freverse" target="_blank" rel="noopener">Array/reverse</a></p>
<p>The reverse method transposes the elements of the calling array object in place, mutating the array, and returning a reference to the array.</p>
<p>ä¹Ÿå°±æ˜¯è¯´ æœ€åä¼šè¿”å›è¿™ä¸ªè°ƒç”¨è€…(this), å¯æ˜¯ x æ‰§è¡Œçš„æ—¶å€™æ˜¯ä¸Šä¸‹æ–‡æ˜¯å…¨å±€. é‚£ä¹ˆæœ€åè¿”å›çš„æ˜¯ window.</p>
<p>ç­”æ¡ˆæ˜¯ window</p>
</li>
</ul>
<h2 id="ç¬¬22é¢˜"><a href="#ç¬¬22é¢˜" class="headerlink" title="ç¬¬22é¢˜"></a>ç¬¬22é¢˜</h2><pre><code>Number.MIN_VALUE &gt; 0
</code></pre><p> true</p>
<h2 id="ç¬¬23é¢˜"><a href="#ç¬¬23é¢˜" class="headerlink" title="ç¬¬23é¢˜"></a>ç¬¬23é¢˜</h2><pre><code>[1 &lt; 2 &lt; 3, 3 &lt; 2 &lt; 1]
</code></pre><p> è¿™ä¸ªé¢˜ä¹Ÿè¿˜å¯ä»¥.</p>
<p> è¿™ä¸ªé¢˜ä¼šè®©äººè¯¯ä»¥ä¸ºæ˜¯ 2 &gt; 1 &amp;&amp; 2 &lt; 3 å…¶å®ä¸æ˜¯çš„.</p>
<p> è¿™ä¸ªé¢˜ç­‰ä»·äº</p>
<pre><code>1 &lt; 2 =&gt; true;
true &lt; 3 =&gt;  1 &lt; 3 =&gt; true;
3 &lt; 2 =&gt; false;
false &lt; 1 =&gt; 0 &lt; 1 =&gt; true;
</code></pre><p> ç­”æ¡ˆæ˜¯ [true, true]</p>
<h2 id="ç¬¬24é¢˜"><a href="#ç¬¬24é¢˜" class="headerlink" title="ç¬¬24é¢˜"></a>ç¬¬24é¢˜</h2><pre><code>// the most classic wtf
2 == [[[2]]]
</code></pre><p> è¿™ä¸ªé¢˜æˆ‘æ˜¯çŒœçš„. æˆ‘çŒœçš„ true, è‡³äºä¸ºä»€ä¹ˆâ€¦..</p>
<p> both objects get converted to strings and in both cases the resulting string is â€œ2â€ æˆ‘ä¸èƒ½ä¿¡æœâ€¦</p>
<h2 id="ç¬¬25é¢˜"><a href="#ç¬¬25é¢˜" class="headerlink" title="ç¬¬25é¢˜"></a>ç¬¬25é¢˜</h2><pre><code>3.toString()
3..toString()
3...toString()
</code></pre><p> è¿™ä¸ªé¢˜ä¹ŸæŒºé€—, æˆ‘åšå¯¹äº† :) ç­”æ¡ˆæ˜¯ error, â€˜3â€™, error</p>
<p> ä½ å¦‚æœæ¢ä¸€ä¸ªå†™æ³•å°±æ›´è´¹è§£äº†</p>
<pre><code>var a = 3;
a.toString()
</code></pre><p> è¿™ä¸ªç­”æ¡ˆå°±æ˜¯ â€˜3â€™;</p>
<p> ä¸ºå•¥å‘¢?</p>
<p> å› ä¸ºåœ¨ js ä¸­ 1.1, 1., .1 éƒ½æ˜¯åˆæ³•çš„æ•°å­—. é‚£ä¹ˆåœ¨è§£æ 3.toString çš„æ—¶å€™è¿™ä¸ª . åˆ°åº•æ˜¯å±äºè¿™ä¸ªæ•°å­—è¿˜æ˜¯å‡½æ•°è°ƒç”¨å‘¢? åªèƒ½æ˜¯æ•°å­—, å› ä¸º3.åˆæ³•å•Š!</p>
<h2 id="ç¬¬26é¢˜"><a href="#ç¬¬26é¢˜" class="headerlink" title="ç¬¬26é¢˜"></a>ç¬¬26é¢˜</h2><pre><code>(function(){
  var x = y = 1;
})();
console.log(y);
console.log(x);
</code></pre><p> ç­”æ¡ˆæ˜¯ 1, error</p>
<p> y è¢«èµ‹å€¼åˆ°å…¨å±€. x æ˜¯å±€éƒ¨å˜é‡. æ‰€ä»¥æ‰“å° x çš„æ—¶å€™ä¼šæŠ¥ ReferenceError</p>
<h2 id="ç¬¬27é¢˜"><a href="#ç¬¬27é¢˜" class="headerlink" title="ç¬¬27é¢˜"></a>ç¬¬27é¢˜</h2><pre><code>var a = /123/,
    b = /123/;
a == b
a === b
</code></pre><p> å³ä½¿æ­£åˆ™çš„å­—é¢é‡ä¸€è‡´, ä»–ä»¬ä¹Ÿä¸ç›¸ç­‰.</p>
<p> ç­”æ¡ˆ false, false</p>
<h2 id="ç¬¬28é¢˜"><a href="#ç¬¬28é¢˜" class="headerlink" title="ç¬¬28é¢˜"></a>ç¬¬28é¢˜</h2><pre><code>var a = [1, 2, 3],
    b = [1, 2, 3],
    c = [1, 2, 4]
a ==  b
a === b
a &gt;   c
a &lt;   c
</code></pre><p> å­—é¢é‡ç›¸ç­‰çš„æ•°ç»„ä¹Ÿä¸ç›¸ç­‰.</p>
<p> æ•°ç»„åœ¨æ¯”è¾ƒå¤§å°çš„æ—¶å€™æŒ‰ç…§å­—å…¸åºæ¯”è¾ƒ</p>
<p> ç­”æ¡ˆ false, false, false, true</p>
<h2 id="ç¬¬29é¢˜"><a href="#ç¬¬29é¢˜" class="headerlink" title="ç¬¬29é¢˜"></a>ç¬¬29é¢˜</h2><pre><code>var a = {}, b = Object.prototype;
[a.prototype === b, Object.getPrototypeOf(a) === b]
</code></pre><p> çŸ¥è¯†ç‚¹:</p>
<ul>
<li><p><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FObject%2FgetPrototypeOf" target="_blank" rel="noopener">Object/getPrototypeOf</a></p>
<p>åªæœ‰ Function æ‹¥æœ‰ä¸€ä¸ª prototype çš„å±æ€§. æ‰€ä»¥ a.prototype ä¸º undefined.</p>
<p>è€Œ Object.getPrototypeOf(obj) è¿”å›ä¸€ä¸ªå…·ä½“å¯¹è±¡çš„åŸå‹(è¯¥å¯¹è±¡çš„å†…éƒ¨[[prototype]]å€¼)</p>
<p>ç­”æ¡ˆ false, true</p>
</li>
</ul>
<h2 id="ç¬¬30é¢˜"><a href="#ç¬¬30é¢˜" class="headerlink" title="ç¬¬30é¢˜"></a>ç¬¬30é¢˜</h2><pre><code>function f() {}
var a = f.prototype, b = Object.getPrototypeOf(f);
a === b
</code></pre><p> f.prototype is the object that will become the parent of any objects created with new f while Object.getPrototypeOf returns the parent in the inheritance hierarchy.</p>
<p> f.prototype æ˜¯ä½¿ç”¨ä½¿ç”¨ new åˆ›å»ºçš„ f å®ä¾‹çš„åŸå‹. è€Œ Object.getPrototypeOf æ˜¯ f å‡½æ•°çš„åŸå‹.</p>
<p> è¯·çœ‹:</p>
<pre><code>a === Object.getPrototypeOf(new f()) // true
b === Function.prototype // true
</code></pre><p> ç­”æ¡ˆ false</p>
<h2 id="31"><a href="#31" class="headerlink" title="31"></a>31</h2><pre><code>function foo() { }
var oldName = foo.name;
foo.name = &quot;bar&quot;;
[oldName, foo.name]
</code></pre><p> ç­”æ¡ˆ [â€˜fooâ€™, â€˜fooâ€™]</p>
<p> çŸ¥è¯†ç‚¹:</p>
<ul>
<li><p><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FFunction%2Fname" target="_blank" rel="noopener">Function/name</a></p>
<p>å› ä¸ºå‡½æ•°çš„åå­—ä¸å¯å˜.</p>
</li>
</ul>
<h2 id="ç¬¬32é¢˜"><a href="#ç¬¬32é¢˜" class="headerlink" title="ç¬¬32é¢˜"></a>ç¬¬32é¢˜</h2><pre><code>&quot;1 2 3&quot;.replace(/\d/g, parseInt)
</code></pre><p> çŸ¥è¯†ç‚¹:</p>
<ul>
<li><p><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FString%2Freplace%23Specifying_a_function_as_a_parameter" target="_blank" rel="noopener">String/replace#Specifying_a_function_as_a_parameter</a></p>
<p>str.replace(regexp|substr, newSubStr|function)</p>
<p>å¦‚æœreplaceå‡½æ•°ä¼ å…¥çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯å‡½æ•°, é‚£ä¹ˆè¿™ä¸ªå‡½æ•°å°†æ¥å—å¦‚ä¸‹å‚æ•°</p>
</li>
<li><p>match é¦–å…ˆæ˜¯åŒ¹é…çš„å­—ç¬¦ä¸²</p>
</li>
<li>p1, p2 â€¦. ç„¶åæ˜¯æ­£åˆ™çš„åˆ†ç»„</li>
<li>offset match åŒ¹é…çš„index</li>
<li>string æ•´ä¸ªå­—ç¬¦ä¸²</li>
</ul>
<p>ç”±äºé¢˜ç›®ä¸­çš„æ­£åˆ™æ²¡æœ‰åˆ†ç»„, æ‰€ä»¥ç­‰ä»·äºé—®</p>
<pre><code>parseInt(&apos;1&apos;, 0)
parseInt(&apos;2&apos;, 2)
parseInt(&apos;3&apos;, 4)
</code></pre><p> ç­”æ¡ˆ: 1, NaN, 3</p>
<h2 id="ç¬¬33é¢˜"><a href="#ç¬¬33é¢˜" class="headerlink" title="ç¬¬33é¢˜"></a>ç¬¬33é¢˜</h2><pre><code>function f() {}
var parent = Object.getPrototypeOf(f);
f.name // ?
parent.name // ?
typeof eval(f.name) // ?
typeof eval(parent.name) //  ?
</code></pre><p> å…ˆè¯´ä»¥ä¸‹ç­”æ¡ˆ â€˜fâ€™, â€˜Emptyâ€™, â€˜functionâ€™, error è¿™ä¸ªç­”æ¡ˆå¹¶ä¸é‡è¦â€¦..</p>
<p> è¿™é‡Œç¬¬ä¸€å°é—®å’Œç¬¬ä¸‰å°é—®å¾ˆç®€å•ä¸è§£é‡Šäº†.</p>
<p> ç¬¬äºŒå°é—®ç¬”è€…åœ¨è‡ªå·±çš„æµè§ˆå™¨æµ‹è¯•çš„æ—¶å€™æ˜¯ â€˜â€™, ç¬¬å››é—®æ˜¯ â€˜undefinedâ€™</p>
<p> æ‰€ä»¥åº”è¯¥æ˜¯å¹³å°ç›¸å…³çš„. è¿™é‡Œæ˜ç™½ parent === Function.prototype å°±å¥½äº†.</p>
<h2 id="ç¬¬34é¢˜"><a href="#ç¬¬34é¢˜" class="headerlink" title="ç¬¬34é¢˜"></a>ç¬¬34é¢˜</h2><pre><code>var lowerCaseOnly =  /^[a-z]+$/;
[lowerCaseOnly.test(null), lowerCaseOnly.test()]
</code></pre><p> çŸ¥è¯†ç‚¹:</p>
<ul>
<li><p><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FRegExp%2Ftest" target="_blank" rel="noopener">RegExp/test</a></p>
<p>è¿™é‡Œ test å‡½æ•°ä¼šå°†å‚æ•°è½¬ä¸ºå­—ç¬¦ä¸². â€˜nulâ€™, â€˜undefinedâ€™ è‡ªç„¶éƒ½æ˜¯å…¨å°å†™äº†</p>
<p>ç­”æ¡ˆ: true, true</p>
</li>
</ul>
<h2 id="ç¬¬35é¢˜"><a href="#ç¬¬35é¢˜" class="headerlink" title="ç¬¬35é¢˜"></a>ç¬¬35é¢˜</h2><pre><code>[,,,].join(&quot;, &quot;)
</code></pre><p> [,,,] =&gt; [undefined Ã— 3]</p>
<p> å› ä¸ºjavascript åœ¨å®šä¹‰æ•°ç»„çš„æ—¶å€™å…è®¸æœ€åä¸€ä¸ªå…ƒç´ åè·Ÿä¸€ä¸ª,, æ‰€ä»¥è¿™æ˜¯ä¸ªé•¿åº¦ä¸ºä¸‰çš„ç¨€ç–æ•°ç»„(è¿™æ˜¯é•¿åº¦ä¸ºä¸‰, å¹¶æ²¡æœ‰ 0, 1, 2ä¸‰ä¸ªå±æ€§å“¦)</p>
<p> ç­”æ¡ˆ: â€œ, , â€œ</p>
<h2 id="ç¬¬36é¢˜"><a href="#ç¬¬36é¢˜" class="headerlink" title="ç¬¬36é¢˜"></a>ç¬¬36é¢˜</h2><pre><code>var a = {class: &quot;Animal&quot;, name: &apos;Fido&apos;};
a.class
</code></pre><p> è¿™ä¸ªé¢˜æ¯”è¾ƒæµæ°“.. å› ä¸ºæ˜¯æµè§ˆå™¨ç›¸å…³, classæ˜¯ä¸ªä¿ç•™å­—(ç°åœ¨æ˜¯ä¸ªå…³é”®å­—äº†)</p>
<p> æ‰€ä»¥ç­”æ¡ˆä¸é‡è¦, é‡è¦çš„æ˜¯è‡ªå·±åœ¨å–å±æ€§åç§°çš„æ—¶å€™å°½é‡é¿å…ä¿ç•™å­—. å¦‚æœä½¿ç”¨çš„è¯è¯·åŠ å¼•å· a[â€˜classâ€™]</p>
<h2 id="ç¬¬37é¢˜"><a href="#ç¬¬37é¢˜" class="headerlink" title="ç¬¬37é¢˜"></a>ç¬¬37é¢˜</h2><pre><code>var a = new Date(&quot;epoch&quot;)
</code></pre><p> çŸ¥è¯†ç‚¹:</p>
<ul>
<li><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FDate" target="_blank" rel="noopener">Date</a></li>
<li><p><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FDate%2Fparse" target="_blank" rel="noopener">Date/parse</a></p>
<p>ç®€å•æ¥è¯´, å¦‚æœè°ƒç”¨ Date çš„æ„é€ å‡½æ•°ä¼ å…¥ä¸€ä¸ªå­—ç¬¦ä¸²çš„è¯éœ€è¦ç¬¦åˆè§„èŒƒ, å³æ»¡è¶³ Date.parse çš„æ¡ä»¶.</p>
<p>å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ å¦‚æœæ ¼å¼é”™è¯¯ æ„é€ å‡½æ•°è¿”å›çš„ä»æ˜¯ä¸€ä¸ªDate çš„å®ä¾‹ Invalid Date.</p>
<p>ç­”æ¡ˆ Invalid Date</p>
</li>
</ul>
<h2 id="ç¬¬38é¢˜"><a href="#ç¬¬38é¢˜" class="headerlink" title="ç¬¬38é¢˜"></a>ç¬¬38é¢˜</h2><pre><code>var a = Function.length,
    b = new Function().length
a === b
</code></pre><p> æˆ‘ä»¬çŸ¥é“ä¸€ä¸ªfunction(Function çš„å®ä¾‹)çš„ length å±æ€§å°±æ˜¯å‡½æ•°ç­¾åçš„å‚æ•°ä¸ªæ•°, æ‰€ä»¥ b.length == 0.</p>
<p> å¦å¤– Function.length å®šä¹‰ä¸º1â€¦â€¦</p>
<p> æ‰€ä»¥ä¸ç›¸ç­‰â€¦â€¦.ç­”æ¡ˆ false</p>
<h2 id="ç¬¬39é¢˜"><a href="#ç¬¬39é¢˜" class="headerlink" title="ç¬¬39é¢˜"></a>ç¬¬39é¢˜</h2><pre><code>var a = Date(0);
var b = new Date(0);
var c = new Date();
[a === b, b === c, a === c]
</code></pre><p> è¿˜æ˜¯å…³äºDate çš„é¢˜, éœ€è¦æ³¨æ„çš„æ˜¯</p>
<ul>
<li>å¦‚æœä¸ä¼ å‚æ•°ç­‰ä»·äºå½“å‰æ—¶é—´.</li>
<li><p>å¦‚æœæ˜¯å‡½æ•°è°ƒç”¨ è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸².</p>
<p>ç­”æ¡ˆ false, false, false</p>
</li>
</ul>
<h2 id="ç¬¬40é¢˜"><a href="#ç¬¬40é¢˜" class="headerlink" title="ç¬¬40é¢˜"></a>ç¬¬40é¢˜</h2><pre><code>var min = Math.min(), max = Math.max()
min &lt; max
</code></pre><p> çŸ¥è¯†ç‚¹:</p>
<ul>
<li><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FMath%2Fmin" target="_blank" rel="noopener">Math/min</a></li>
<li><p><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FMath%2Fmax" target="_blank" rel="noopener">Math/max</a></p>
<p>æœ‰è¶£çš„æ˜¯, Math.min ä¸ä¼ å‚æ•°è¿”å› Infinity, Math.max ä¸ä¼ å‚æ•°è¿”å› -InfinityğŸ˜†</p>
<p>ç­”æ¡ˆ: false</p>
</li>
</ul>
<h2 id="ç¬¬41é¢˜"><a href="#ç¬¬41é¢˜" class="headerlink" title="ç¬¬41é¢˜"></a>ç¬¬41é¢˜</h2><pre><code>function captureOne(re, str) {
  var match = re.exec(str);
  return match &amp;&amp; match[1];
}
var numRe  = /num=(\d+)/ig,
    wordRe = /word=(\w+)/i,
    a1 = captureOne(numRe,  &quot;num=1&quot;),
    a2 = captureOne(wordRe, &quot;word=1&quot;),
    a3 = captureOne(numRe,  &quot;NUM=2&quot;),
    a4 = captureOne(wordRe,  &quot;WORD=2&quot;);
[a1 === a2, a3 === a4]
</code></pre><p> çŸ¥è¯†ç‚¹:</p>
<ul>
<li><p><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FRegExp%2Fexec" target="_blank" rel="noopener">RegExp/exec</a></p>
<p>é€šä¿—çš„è®²</p>
<p>å› ä¸ºç¬¬ä¸€ä¸ªæ­£åˆ™æœ‰ä¸€ä¸ª g é€‰é¡¹ å®ƒä¼šâ€˜è®°å¿†â€™ä»–æ‰€åŒ¹é…çš„å†…å®¹, ç­‰åŒ¹é…åä»–ä¼šä»ä¸Šæ¬¡åŒ¹é…çš„ç´¢å¼•ç»§ç»­, è€Œç¬¬äºŒä¸ªæ­£åˆ™ä¸ä¼š</p>
</li>
</ul>
<p>ä¸¾ä¸ªä¾‹å­</p>
<pre><code>var myRe = /ab*/g;
var str = &apos;abbcdefabh&apos;;
var myArray;
while ((myArray = myRe.exec(str)) !== null) {
  var msg = &apos;Found &apos; + myArray[0] + &apos;. &apos;;
  msg += &apos;Next match starts at &apos; + myRe.lastIndex;
  console.log(msg);
}
// Found abb. Next match starts at 3
// Found ab. Next match starts at 9
</code></pre><p> æ‰€ä»¥ a1 = â€˜1â€™; a2 = â€˜1â€™; a3 = null; a4 = â€˜2â€™</p>
<p> ç­”æ¡ˆ [true, false]</p>
<h2 id="ç¬¬42é¢˜"><a href="#ç¬¬42é¢˜" class="headerlink" title="ç¬¬42é¢˜"></a>ç¬¬42é¢˜</h2><pre><code>var a = new Date(&quot;2014-03-19&quot;),
    b = new Date(2014, 03, 19);
[a.getDay() === b.getDay(), a.getMonth() === b.getMonth()]
</code></pre><p> è¿™ä¸ªâ€¦.</p>
<blockquote>
<p> JavaScript inherits 40 years old design from C: days are 1-indexed in Câ€™s struct tm, but months are 0 indexed. In addition to that, getDay returns the 0-indexed day of the week, to get the 1-indexed day of the month you have to use getDate,<br>                    which doesnâ€™t return a Date object.</p>
</blockquote>
<pre><code>a.getDay()
3
b.getDay()
6
a.getMonth()
2
b.getMonth()
3
</code></pre><p> éƒ½æ˜¯å¥—è·¯!</p>
<p> ç­”æ¡ˆ [false, false]</p>
<h2 id="ç¬¬43é¢˜"><a href="#ç¬¬43é¢˜" class="headerlink" title="ç¬¬43é¢˜"></a>ç¬¬43é¢˜</h2><pre><code>if (&apos;http://giftwrapped.com/picture.jpg&apos;.match(&apos;.gif&apos;)) {
  &apos;a gif file&apos;
} else {
  &apos;not a gif file&apos;
}
</code></pre><p> çŸ¥è¯†ç‚¹:</p>
<ul>
<li><p><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FString%2Fmatch" target="_blank" rel="noopener">String/match</a></p>
<p>String.prototype.match æ¥å—ä¸€ä¸ªæ­£åˆ™, å¦‚æœä¸æ˜¯, æŒ‰ç…§ new RegExp(obj) è½¬åŒ–. æ‰€ä»¥ . å¹¶ä¸ä¼šè½¬ä¹‰<br>é‚£ä¹ˆ /gif å°±åŒ¹é…äº† /.gif/</p>
<p>ç­”æ¡ˆ: â€˜a gif fileâ€™</p>
</li>
</ul>
<h2 id="ç¬¬44é¢˜"><a href="#ç¬¬44é¢˜" class="headerlink" title="ç¬¬44é¢˜"></a>ç¬¬44é¢˜</h2><pre><code>function foo(a) {
    var a;
    return a;
}
function bar(a) {
    var a = &apos;bye&apos;;
    return a;
}
[foo(&apos;hello&apos;), bar(&apos;hello&apos;)]
</code></pre><p> åœ¨ä¸¤ä¸ªå‡½æ•°é‡Œ, aä½œä¸ºå‚æ•°å…¶å®å·²ç»å£°æ˜äº†, æ‰€ä»¥ var a; var a = â€˜byeâ€™ å…¶å®å°±æ˜¯ a; a =â€™byeâ€™</p>
<p> æ‰€ä»¥ç­”æ¡ˆ â€˜helloâ€™, â€˜byeâ€™</p>
<p> å…¨éƒ¨ç»“æŸ!</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/05/html2canvasä¿å­˜å›¾ç‰‡å‹ç¼©å›¾ç‰‡/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/05/html2canvasä¿å­˜å›¾ç‰‡å‹ç¼©å›¾ç‰‡/" itemprop="url">html2canvasä¿å­˜å›¾ç‰‡å‹ç¼©å›¾ç‰‡</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-12-05T20:21:38+08:00">
                2017-12-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">async $html2canvas(el, options = &#123;&#125;) &#123;</span><br><span class="line">	const &#123;</span><br><span class="line">		type</span><br><span class="line">	&#125; = options;</span><br><span class="line">	const canvas = await html2canvas(el, &#123;</span><br><span class="line">		useCORS: true</span><br><span class="line">	&#125;);</span><br><span class="line">	try &#123;</span><br><span class="line">		if(type &amp;&amp; type === &quot;dataURL&quot;) &#123;</span><br><span class="line">			return canvas.toDataURL(&quot;image/png&quot;);</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			console.warn(&quot;warn&quot;);</span><br><span class="line">			return canvas;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; catch(err) &#123;</span><br><span class="line">		console.log(&quot;err&quot;);</span><br><span class="line">		console.log(err);</span><br><span class="line">	&#125;</span><br><span class="line">	return canvas;</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">async print() &#123;</span><br><span class="line">	const el = document.getElementById(&quot;invite&quot;);</span><br><span class="line">	var width = el.offsetWidth * 0.8;</span><br><span class="line">	var height = el.offsetHeight * 0.8;</span><br><span class="line">	const options = &#123;</span><br><span class="line">		type: &quot;dataURL&quot;,</span><br><span class="line">		useCORS: true,</span><br><span class="line">		logging: true,</span><br><span class="line">		taintTest: false,</span><br><span class="line">		allowTaint: false,</span><br><span class="line">		width: el.offsetWidth * 0.8,</span><br><span class="line">		height: el.offsetHeight * 0.8</span><br><span class="line">	&#125;;</span><br><span class="line">	var output = await this.$html2canvas(el, options);</span><br><span class="line">	this.ImgToBase64(output, width, height);</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">ImgToBase64(base64, width, height) &#123;   //å‹ç¼©å›¾ç‰‡</span><br><span class="line">	var that = this;</span><br><span class="line">	var img = new Image();</span><br><span class="line">	img.src = base64;</span><br><span class="line">	img.onload = function() &#123;</span><br><span class="line">		var rate = 0.8;   //å‹ç¼©å›¾ç‰‡</span><br><span class="line">		img.width = width * rate;</span><br><span class="line">		img.height = height * rate;</span><br><span class="line">		//ç”Ÿæˆcanvas</span><br><span class="line">		var canvas = document.createElement(&quot;canvas&quot;);</span><br><span class="line">		var ctx = canvas.getContext(&quot;2d&quot;);</span><br><span class="line">		canvas.width = img.width;</span><br><span class="line">		canvas.height = img.height;</span><br><span class="line">		ctx.drawImage(img, 0, 0, img.width, img.height);</span><br><span class="line">		var base64 = canvas.toDataURL(&apos;image/jpeg&apos;, 0.95);</span><br><span class="line">		that.output = base64;</span><br><span class="line">		that.$nextTick(() =&gt; &#123;</span><br><span class="line">			setTimeout(() =&gt; &#123;</span><br><span class="line">				that.$emit(&quot;savaImg&quot;, that.output);</span><br><span class="line">			&#125;, 0)</span><br><span class="line">		&#125;)</span><br><span class="line">		console.log(&apos;that.output&apos;)</span><br><span class="line">		console.log(that.output)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/19/Vueçš„MVVMæ¨¡å¼å®ç°/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/19/Vueçš„MVVMæ¨¡å¼å®ç°/" itemprop="url">Vueçš„MVVMæ¨¡å¼å®ç°</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-11-19T21:09:31+08:00">
                2017-11-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="/2017/11/19/Vueçš„MVVMæ¨¡å¼å®ç°/timg.png" alt="timg"></p>
<h3 id="1ã€MVVMæ¨¡å¼"><a href="#1ã€MVVMæ¨¡å¼" class="headerlink" title="1ã€MVVMæ¨¡å¼"></a>1ã€MVVMæ¨¡å¼</h3><p>MVVMçš„è®¾è®¡æ€æƒ³ï¼šå…³æ³¨Modelï¼ˆæ•°æ®ï¼‰çš„å˜åŒ–ï¼Œè®©MVVMæ¡†æ¶å»è‡ªåŠ¨æ›´æ–°DOMçš„çŠ¶æ€ï¼Œæ¯”è¾ƒä¸»æµçš„å®ç°æœ‰ï¼šangularçš„ï¼ˆè„å€¼æ£€æµ‹ï¼‰vueçš„ï¼ˆæ•°æ®åŠ«æŒ-&gt;å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼‰æˆ‘ä»¬é‡ç‚¹äº†è§£vueï¼ˆæ•°æ®åŠ«æŒ-&gt;å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼‰çš„å®ç°æ–¹å¼ï¼Œè®©æˆ‘ä»¬ä»æ“ä½œDOMçš„ç¹çæ“ä½œä¸­è§£è„±å‡ºæ¥</p>
<h3 id="2ã€æ ¸å¿ƒæ–¹æ³•Object-definePropertyçš„ç†è§£"><a href="#2ã€æ ¸å¿ƒæ–¹æ³•Object-definePropertyçš„ç†è§£" class="headerlink" title="2ã€æ ¸å¿ƒæ–¹æ³•Object.definePropertyçš„ç†è§£"></a>2ã€æ ¸å¿ƒæ–¹æ³•Object.definePropertyçš„ç†è§£</h3><p>æˆ‘ä»¬å…ˆç®€å•çœ‹ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•å®ƒä¹Ÿæ˜¯ç”¨æ¥å®ç°æˆ‘ä»¬æ•°æ®åŠ«æŒï¼ˆæ•°æ®ç›‘å¬ï¼‰çš„å…³é”®æ–¹æ³•ï¼Œæˆ‘ä»¬çŸ¥é“vueæ¡†æ¶æ˜¯ä¸å…¼å®¹IE6~8ä½ç‰ˆæœ¬çš„ï¼Œä¸»è¦æ˜¯å› ä¸ºå®ƒçš„ç”¨åˆ°äº†ES5ä¸­çš„è¿™ä¸ªObject.definePropertyçš„æ–¹æ³•ï¼Œè€Œä¸”è¿™ä¸ªæ–¹æ³•æš‚æ—¶æ²¡æœ‰å¾ˆå¥½çš„é™çº§æ–¹æ¡ˆã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var a = &#123;&#125;;</span><br><span class="line">Object.defineProperty(a, &apos;b&apos;, &#123;</span><br><span class="line">    value: 123,         // è®¾ç½®çš„å±æ€§å€¼</span><br><span class="line">    writable: false,    // æ˜¯å¦åªè¯»</span><br><span class="line">    enumerable: false,  // æ˜¯å¦å¯æšä¸¾</span><br><span class="line">    configurable: false// </span><br><span class="line">&#125;);</span><br><span class="line">console.log(a.b); //123</span><br></pre></td></tr></table></figure></p>
<p>æ–¹æ³•ä½¿ç”¨å¾ˆç®€å•ï¼Œå®ƒæ¥å—ä¸‰ä¸ªå‚æ•°ï¼Œè€Œä¸”éƒ½æ˜¯å¿…å¡«çš„</p>
<ul>
<li>ç¬¬ä¸€ä¸ªå‚æ•°ï¼šç›®æ ‡å¯¹è±¡</li>
<li>ç¬¬äºŒä¸ªå‚æ•°ï¼šéœ€è¦å®šä¹‰çš„å±æ€§æˆ–æ–¹æ³•çš„åå­—ã€‚</li>
<li>ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šç›®æ ‡å±æ€§æ‰€æ‹¥æœ‰çš„ç‰¹æ€§</li>
</ul>
<p>å‰ä¸¤ä¸ªå‚æ•°æ¯”è¾ƒå¥½ç†è§£ï¼Œä¸»è¦çœ‹ç¬¬ä¸‰ä¸ªå‚æ•°å®ƒæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œçœ‹çœ‹æœ‰å“ªäº›å±æ€§å®šä¹‰</p>
<ul>
<li>valueï¼šå±æ€§çš„å€¼ã€‚</li>
<li>writableï¼šå¦‚æœä¸º false ï¼Œå±æ€§çš„å€¼å°±ä¸èƒ½è¢«é‡å†™,åªèƒ½ä¸ºåªè¯»äº†ã€‚</li>
<li>enumerableï¼šæ˜¯å¦å¯æšä¸¾ï¼Œé»˜è®¤æ˜¯falseä¸å¯æšä¸¾çš„ï¼ˆé€šå¸¸è®¾ç½®ä¸ºtrueï¼‰</li>
<li>configurableï¼šæ€»å¼€å…³ï¼Œä¸€æ—¦ä¸ºfalseï¼Œå°±ä¸èƒ½å†è®¾ç½®å…¶ä»–çš„ï¼ˆ value ï¼Œ writable ï¼Œ enumerableï¼‰</li>
<li>get()ï¼šå‡½æ•°ï¼Œè·å–å±æ€§å€¼æ—¶æ‰§è¡Œçš„æ–¹æ³•ï¼ˆä¸å¯ä»¥å’Œwritableã€valueå±æ€§å…±å­˜ï¼‰</li>
<li>set()ï¼šå‡½æ•°ï¼Œè®¾ç½®å±æ€§å€¼æ—¶æ‰§è¡Œçš„æ–¹æ³•ï¼ˆä¸å¯ä»¥å’Œwritableã€valueå±æ€§å…±å­˜ï¼‰</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// å¸¸ç”¨å®šä¹‰</span><br><span class="line">var obj = &#123;&#125;;</span><br><span class="line">Object.defineProperty(obj, &apos;school&apos;, &#123;</span><br><span class="line">    enumerable: true,</span><br><span class="line">    get: function()&#123;        </span><br><span class="line">        // è·å–å±æ€§å€¼æ—¶ä¼šè°ƒç”¨getæ–¹æ³•</span><br><span class="line">    &#125;,</span><br><span class="line">    set: function(newVal)&#123;        </span><br><span class="line">        // è®¾ç½®å±æ€§å€¼æ—¶ä¼šè°ƒç”¨setæ–¹æ³•</span><br><span class="line">        return newVal</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬é€šè¿‡è¿™ä¸ªObject.definePropertyè¿™ä¸ªæ–¹æ³•ï¼Œå¯ä»¥å®ç°å¯¹å®šä¹‰çš„å¼•ç”¨æ•°æ®ç±»å‹çš„å®ç°ç›‘å¬ï¼Œè¢«æ–¹æ³•ç›‘å¬åçš„å¯¹è±¡ï¼Œé‡Œé¢å®šä¹‰çš„å€¼å‘ç”Ÿè¢«è·å–å’Œè®¾ç½®æ“ä½œçš„æ—¶å€™ï¼Œä¼šåˆ†åˆ«è§¦å‘Object.definePropertyé‡Œé¢å‚æ•°ä¸‰çš„getå’Œsetæ–¹æ³•ã€‚</p>
<h3 id="3ã€æ•°æ®åŠ«æŒ"><a href="#3ã€æ•°æ®åŠ«æŒ" class="headerlink" title="3ã€æ•°æ®åŠ«æŒ"></a>3ã€æ•°æ®åŠ«æŒ</h3><p>åœ¨äº†è§£å®Œäº†Object.definePropertyæ–¹æ³•åï¼Œæˆ‘ä»¬ç°åœ¨è¦é€šè¿‡å®ƒæ¥å®ç°æˆ‘ä»¬çš„æ•°æ®åŠ«æŒåŠŸèƒ½Obaerveçš„æ–¹æ³•ï¼Œçœ‹å¦‚ä¸‹ä»£ç </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">function MyVue(options = &#123;&#125;)&#123;    </span><br><span class="line">    // å°†æ‰€æœ‰çš„å±æ€§æŒ‚è½½åˆ°$optionsèº«ä¸Š</span><br><span class="line">    this.$options = options;    </span><br><span class="line">    // è·å–åˆ°dataæ•°æ®ï¼ˆModelï¼‰</span><br><span class="line">    var data = this._data = this.$options.data;    </span><br><span class="line">    // åŠ«æŒæ•°æ®</span><br><span class="line">    observe(data)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ç»™éœ€è¦è§‚å¯Ÿçš„å¯¹è±¡éƒ½æ·»åŠ  Object.defineProperty çš„ç›‘å¬</span><br><span class="line">function Observe(data)&#123;    </span><br><span class="line">    for (let key in data) &#123;        </span><br><span class="line">        let val = data[key];        </span><br><span class="line">        // é€’å½’ =ã€‹æ¥å®ç°æ·±å±‚çš„æ•°æ®ç›‘å¬</span><br><span class="line">        observe(val)        </span><br><span class="line">        Object.defineProperty(data, key, &#123;</span><br><span class="line">            enumerable: true,</span><br><span class="line">            get() &#123;                </span><br><span class="line">                return val</span><br><span class="line">            &#125;,</span><br><span class="line">            set(newval) &#123; </span><br><span class="line">                if (val === newval) &#123; //è®¾ç½®çš„å€¼æ˜¯å¦å’Œä»¥å‰æ˜¯ä¸€æ ·çš„ï¼Œå¦‚æœæ˜¯å°±ä»€ä¹ˆéƒ½ä¸åš</span><br><span class="line">                    return</span><br><span class="line">                &#125;</span><br><span class="line">                val = newval // è¿™é‡Œè¦æŠŠæ–°è®¾ç½®çš„å€¼ä¹Ÿåœ¨æ·»åŠ ä¸€æ¬¡æ•°æ®åŠ«æŒæ¥å®ç°æ·±åº¦å“åº”,</span><br><span class="line">                observe(newval);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">function observe(data)&#123;</span><br><span class="line">    // è¿™é‡Œåšä¸€ä¸‹æ•°æ®ç±»å‹çš„åˆ¤æ–­ï¼Œåªæœ‰å¼•ç”¨æ•°æ®ç±»å‹æ‰å»åšæ•°æ®åŠ«æŒ</span><br><span class="line">    if (typeof data != &apos;object&apos;) return</span><br><span class="line">    returnnew Observe(data)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>1ï¼‰ä»¥ä¸Šä»£ç åšäº†è¿™äº›äº‹æƒ…ï¼Œå…ˆå®šä¹‰äº†åˆå§‹æ¢æ„é€ å‡½æ•°MyVueæˆ‘ä»¬é€šè¿‡å®ƒæ¥è·å–åˆ°æˆ‘ä»¬ä¼ è¿›æ¥çš„æ•°æ®dataå’Œæˆ‘ä»¬å®šä¹‰çš„DOMèŠ‚ç‚¹èŒƒå›´ï¼Œç„¶åæŠŠdataä¼ è¿›å®šå¥½çš„æ•°æ®åŠ«æŒæ–¹æ³•observe<br>2ï¼‰Observeå®ç°äº†å¯¹æ•°æ®çš„ç›‘å¬æ•´ä½“é€»è¾‘ï¼Œè¿™é‡Œæœ‰ä¸ªç»†èŠ‚ç‚¹ï¼Œæ²¡æœ‰ç›´æ¥ç”¨æ„é€ å‡½æ•°Observeå»åŠ«æŒæˆ‘ä»¬çš„æ•°æ®ï¼Œè€Œæ˜¯å†™å¤šäº†ä¸€ä¸ªobserveçš„å°æ–¹æ³•ç”¨æ¥new Observeï¼Œå¹¶ä¸”åœ¨é‡Œé¢åšäº†å¼•ç”¨æ•°æ®ç±»å‹çš„åˆ¤æ–­ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†æ–¹ä¾¿é€’å½’æ¥å®ç°æ•°æ®ç»“æ„çš„æ·±å±‚ç›‘å¬ï¼Œå› ä¸ºæˆ‘ä»¬çš„dataç»“æ„è‚¯å®šæ˜¯å¤æ‚å¤šæ ·çš„ï¼Œä¾‹å¦‚ä¸‹é¢ä»£ç <br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// è¿™é‡Œæ•°æ®ç»“æ„åµŒå¥—å¾ˆå¤šï¼Œè¦å®ç°æ·±å±‚çš„æ•°æ®ç›‘å¬é‡‡ç”¨äº†é€’å½’çš„å®ç°æ–¹å¼</span><br><span class="line">data: &#123; a: &#123;b:2&#125; , c:&#123;q:12,k:&#123;name:&apos;binhemori&apos;&#125;&#125; , f:&apos;mvvvm&apos;,o:[12,5,9,8]&#125;</span><br></pre></td></tr></table></figure></p>
<p>3ï¼‰è¿™é‡Œè¿˜éœ€è¦æ³¨æ„çš„æ˜¯æˆ‘ä»¬åœ¨setæ–¹æ³•é‡Œé¢æœ‰å†ä¸€æ¬¡æŠŠè®¾ç½®çš„æ–°å€¼ï¼Œæ‰§è¡Œäº†ä¸€éobserveæ–¹æ³•ï¼Œæ˜¯ä¸ºäº†å®ç°æ·±åº¦å“åº”ï¼Œå› ä¸ºåœ¨èµ‹å€¼çš„æ—¶å€™å¯èƒ½ä¼šèµ‹å€¼ä¸€ä¸ªå¼•ç”¨æ•°æ®ç±»å‹çš„å€¼ï¼Œæˆ‘ä»¬çŸ¥é“vueæœ‰ä¸ªç‰¹ç‚¹ï¼Œæ˜¯ä¸èƒ½æ–°å¢ä¸å­˜åœ¨çš„å±æ€§å’Œä¸èƒ½å­˜åœ¨å±æ€§æ²¡æœ‰getå’Œsetæ–¹æ³•çš„ï¼Œå¦‚æœèµ‹å€¼è¿›æ¥çš„æ–°å±æ€§å€¼æ˜¯å¼•ç”¨æ•°æ®ç±»å‹ï¼Œå°±ä¼šæŠŠæˆ‘ä»¬åŸå…ˆæ‰§è¡Œè¿‡æ•°æ®åŠ«æŒæ–¹æ³•çš„å¯¹è±¡åœ°å€ç»™æ›¿æ¢æ‰ï¼Œè€Œæ–°å¯¹è±¡æ˜¯æ²¡æœ‰ç»è¿‡æ•°æ®åŠ«æŒçš„å°±æ˜¯æ²¡æœ‰getå’Œsetçš„æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è®¾ç½®æ–°å€¼çš„æ—¶å€™éœ€è¦åœ¨é‡æ–°ç»™ä»–æ‰§è¡Œä¸€éobserveæ•°æ®åŠ«æŒï¼Œç¡®ä¿å¼€å‘è€…ä¸ç®¡æ€æ ·å»è®¾ç½®å€¼çš„æ—¶å€™éƒ½èƒ½è¢«åŠ«æŒåˆ°</p>
<hr>
<p>è¯´äº†è¿™ä¹ˆå¤šï¼Œæˆ‘ä»¬æ¥ä½¿ç”¨ä¸€ä¸‹çœ‹çœ‹æœ‰æ²¡æœ‰å®ç°å¯¹æ•°æ®çš„åŠ«æŒï¼ˆæ•°æ®ç›‘å¬ï¼‰å§<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=&quot;app&quot;&gt;     </span><br><span class="line">    &lt;div&gt;</span><br><span class="line">         &lt;div&gt;è¿™é‡Œçš„æ•°æ®1======&lt;span style=&quot;color: red;&quot;&gt;&#123;&#123;a.b&#125;&#125;&lt;/span&gt;&lt;/div&gt;</span><br><span class="line">         &lt;div&gt;è¿™é‡Œæ˜¯æ•°æ®2======&lt;span style=&quot;color: green;&quot;&gt;&#123;&#123;c&#125;&#125;&lt;/span&gt;&lt;/div&gt;</span><br><span class="line">     &lt;/div&gt;</span><br><span class="line">     &lt;input type=&quot;text&quot; v-model=&quot;a.b&quot; value=&quot;&quot;&gt;</span><br><span class="line"> &lt;/div&gt;</span><br><span class="line"> &lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„mvvmæ¨¡å— --&gt;</span><br><span class="line"> &lt;script src=&quot;./mvvm.js&quot;&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"> &lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">     var myvue = new MyVue(&#123;</span><br><span class="line">         el: &apos;#app&apos;,</span><br><span class="line">         data: &#123; a: &#123; b: &apos;ä½ å¥½&apos; &#125;, c: 12, o: [12, 5, 9, 8] &#125;</span><br><span class="line">     &#125;) </span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></p>
<p><img src="/2017/11/19/Vueçš„MVVMæ¨¡å¼å®ç°/3.png" alt="3"></p>
<p>å¯ä»¥çœ‹åˆ°å¯¹æˆ‘ä»¬æ‰€å®šä¹‰çš„dataä¸­çš„æ•°æ®éƒ½å·²ç»æœ‰äº†getå’Œsetæ–¹æ³•äº†ï¼Œåˆ°è¿™é‡Œæˆ‘ä»¬å¯¹dataä¸­æ•°æ®çš„å˜åŒ–éƒ½æ˜¯å¯ä»¥ç›‘å¬çš„åˆ°äº†</p>
<h3 id="4ã€æ•°æ®ä»£ç†"><a href="#4ã€æ•°æ®ä»£ç†" class="headerlink" title="4ã€æ•°æ®ä»£ç†"></a>4ã€æ•°æ®ä»£ç†</h3><p>æ•°æ®ä»£ç†ï¼Œæˆ‘ä»¬ç”¨è¿‡vueçš„éƒ½çŸ¥é“ï¼Œåœ¨å®é™…ä½¿ç”¨ä¸­æ˜¯èƒ½ç›´æ¥é€šè¿‡å®ä¾‹+å±æ€§ï¼ˆvm.aï¼‰ç›´æ¥è·å–åˆ°æ•°æ®çš„ï¼Œè€Œæˆ‘ä»¬ä¸Šé¢çš„ä»£ç è¦è·å–åˆ°æ•°æ®è¿˜éœ€è¦è¿™æ ·myvue._data.aè¿™æ ·æ¥è·å–åˆ°æ•°æ®ï¼Œä¸­é—´å¤šäº†ä¸€ä¸ª _data çš„ç¯èŠ‚ï¼Œè¿™æ ·ä½¿ç”¨èµ·æ¥ä¸æ˜¯å¾ˆæ–¹ä¾¿çš„ï¼Œä¸‹é¢æˆ‘ä»¬æ¥å®ç°è®©æˆ‘ä»¬çš„å®ä¾‹thisæ¥ä»£ç†ï¼ˆ _dataï¼‰æ•°æ®ï¼Œä»è€Œå®ç° myvue.a è¿™æ ·çš„æ“ä½œå¯ä»¥ç›´æ¥è·å–åˆ°æ•°æ®<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">function MyVue(options = &#123;&#125;) &#123;    </span><br><span class="line">    // å°†æ‰€æœ‰çš„å±æ€§æŒ‚è½½åˆ°$optionsèº«ä¸Š</span><br><span class="line">    this.$options = options;    </span><br><span class="line">    // è·å–åˆ°dataæ•°æ®ï¼ˆModelï¼‰</span><br><span class="line">    var data = this._data = this.$options.data;</span><br><span class="line">    observe(data);    </span><br><span class="line">    </span><br><span class="line">    // this å°±ä»£ç†æ•°æ® this._data</span><br><span class="line">    for (const key in data) &#123;        </span><br><span class="line">    Object.defineProperty(this, key, &#123;</span><br><span class="line">            enumerable: true,</span><br><span class="line">            get() &#123;                </span><br><span class="line">                // this.a è¿™é‡Œå–å€¼çš„æ—¶å€™ å®é™…ä¸Šæ˜¯å»_dataä¸­çš„å€¼</span><br><span class="line">                return this._data[key] </span><br><span class="line">            &#125;,</span><br><span class="line">            set(newVal) &#123; </span><br><span class="line">                // è®¾ç½®å€¼çš„æ—¶å€™å…¶å®ä¹Ÿæ˜¯å»æ”¹this._data.açš„å€¼</span><br><span class="line">                this._data[key] = newVal</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä»¥ä¸Šä»£ç å®ç°äº†æˆ‘ä»¬çš„æ•°æ®ä»£ç†ï¼Œå°±æ˜¯åœ¨æ„å»ºå®ä¾‹çš„æ—¶å€™ï¼ŒæŠŠdataä¸­çš„æ•°æ®éå†ä¸€æ¬¡å‡ºæ¥ï¼Œä¾æ¬¡åŠ åˆ°æˆ‘ä»¬thisä¸Šï¼ŒåŠ çš„è¿‡ç¨‹ä¸­ä¹Ÿä¸è¦å¿˜è®°æ·»åŠ Object.definePropertyï¼Œåªè¦æ˜¯æ•°æ®æˆ‘ä»¬éƒ½éœ€è¦æ·»åŠ ç›‘å¬ã€‚å¦‚ä¸‹å›¾æˆ‘ä»¬å·²ç»å®ç°äº†å¯¹æ•°æ®çš„ä»£ç†</p>
<p><img src="/2017/11/19/Vueçš„MVVMæ¨¡å¼å®ç°/2.png" alt="2"></p>
<h3 id="5ã€ç¼–è¯‘æ¨¡æ¿ï¼ˆCompileï¼‰"><a href="#5ã€ç¼–è¯‘æ¨¡æ¿ï¼ˆCompileï¼‰" class="headerlink" title="5ã€ç¼–è¯‘æ¨¡æ¿ï¼ˆCompileï¼‰"></a>5ã€ç¼–è¯‘æ¨¡æ¿ï¼ˆCompileï¼‰</h3><p>æˆ‘ä»¬å·²ç»å®Œæˆå¯¹æ•°æ®åŠ«æŒä¹Ÿå®ç°äº†thiså¯¹æ•°æ®çš„ä»£ç†ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥è¦åšçš„å°±æ˜¯æ€æ ·æŠŠæ•°æ®ç¼–è¯‘åˆ°æˆ‘ä»¬çš„DOMèŠ‚ç‚¹ä¸Šé¢ï¼Œä¹Ÿå°±æ˜¯è®©è§†å›¾å±‚ï¼ˆviewï¼‰è¦å±•ç¤ºæˆ‘ä»¬çš„æ•°æ®äº†<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">// å°†æ•°æ®å’ŒèŠ‚ç‚¹æŒ‚è½½åœ¨ä¸€èµ·</span><br><span class="line">function Compile(el, vm) &#123;    </span><br><span class="line">    // elè¡¨ç¤ºæ›¿æ¢çš„èŒƒå›´</span><br><span class="line">    vm.$el = document.querySelector(el);    </span><br><span class="line">    // è¿™é‡Œæ³¨æ„æˆ‘ä»¬æ²¡æœ‰å»ç›´æ¥æ“ä½œDOMï¼Œè€Œæ˜¯æŠŠè¿™ä¸ªæ­¥éª¤ç§»åˆ°å†…å­˜ä¸­æ¥æ“ä½œï¼Œè¿™é‡Œçš„æ“ä½œæ˜¯ä¸ä¼šå¼•å‘DOMèŠ‚ç‚¹çš„å›æµ</span><br><span class="line">    let fragment = document.createDocumentFragment(); // æ–‡æ¡£ç¢ç‰‡</span><br><span class="line">    let child;   </span><br><span class="line">    </span><br><span class="line">    while (child = vm.$el.firstChild) &#123; </span><br><span class="line">        // å°†appçš„å†…å®¹ç§»å…¥å†…å­˜ä¸­</span><br><span class="line">        fragment.appendChild(child);</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">    replace(fragment)    </span><br><span class="line">    function replace(fragment) &#123;        </span><br><span class="line">        Array.from(fragment.childNodes).forEach(function (node) &#123; //å¾ªç¯æ¯ä¸€å±‚</span><br><span class="line">            let text = node.textContent;            </span><br><span class="line">            let reg = /\&#123;\&#123;(.*)\&#125;\&#125;/g;</span><br><span class="line">                        </span><br><span class="line">            // è¿™é‡Œåšäº†åˆ¤æ–­åªæœ‰æ–‡æœ¬èŠ‚ç‚¹æ‰å»åŒ¹é…ï¼Œè€Œä¸”è¿˜è¦å¸¦&#123;&#123;***&#125;&#125;çš„å­—ç¬¦ä¸²</span><br><span class="line">            if (node.nodeType === 3 &amp;&amp; reg.test(text)) &#123;  </span><br><span class="line">                // æŠŠåŒ¹é…åˆ°çš„å†…å®¹æ‹†åˆ†æˆæ•°ç»„              </span><br><span class="line">                let arr = RegExp.$1.split(&apos;.&apos;); </span><br><span class="line">                let val = vm;                </span><br><span class="line">                </span><br><span class="line">                // è¿™é‡Œå¯¹æˆ‘ä»¬åŒ¹é…åˆ°çš„å®šä¹‰æ•°ç»„ï¼Œä¼šä¾æ¬¡å»éå†å®ƒï¼Œæ¥å®ç°å¯¹å®ä¾‹çš„æ·±åº¦èµ‹å€¼</span><br><span class="line">                arr.forEach(function (k) &#123; // this.a.b  this.c</span><br><span class="line">                    val = val[k]</span><br><span class="line">                &#125;)      </span><br><span class="line">                          </span><br><span class="line">                // ç”¨å­—ç¬¦ä¸²çš„replaceæ–¹æ³•æ›¿æ¢æ‰æˆ‘ä»¬è·å–åˆ°çš„æ•°æ®val</span><br><span class="line">                node.textContent = text.replace(/\&#123;\&#123;(.*)\&#125;\&#125;/, val)</span><br><span class="line">            &#125;         </span><br><span class="line">                   </span><br><span class="line">            // è¿™é‡Œåšäº†åˆ¤æ–­ï¼Œå¦‚æœæœ‰å­èŠ‚ç‚¹çš„è¯ ä½¿ç”¨é€’å½’</span><br><span class="line">            if (node.childNodes) &#123;</span><br><span class="line">                replace(node)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;    </span><br><span class="line">    // æœ€åæŠŠç¼–è¯‘å®Œçš„DOMåŠ å…¥åˆ°appå…ƒç´ ä¸­</span><br><span class="line">    vm.$el.appendChild(fragment)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä»¥ä¸Šä»£ç å®ç°æˆ‘ä»¬å¯¹æ•°æ®çš„ç¼–è¯‘Compileå¦‚ä¸‹å›¾ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬æŠŠè·å–åˆ°elä¸‹é¢æ‰€æœ‰çš„å­èŠ‚ç‚¹éƒ½å­˜å‚¨åˆ°äº†æ–‡æ¡£ç¢ç‰‡ fragment ä¸­æš‚æ—¶å­˜å‚¨äº†èµ·æ¥ï¼ˆæ”¾åˆ°å†…å­˜ä¸­ï¼‰ï¼Œå› ä¸ºè¿™é‡Œè¦å»é¢‘ç¹çš„æ“ä½œDOMå’ŒæŸ¥æ‰¾DOMï¼Œæ‰€ä»¥ç§»åˆ°å†…å­˜ä¸­æ“ä½œ</p>
<p><img src="/2017/11/19/Vueçš„MVVMæ¨¡å¼å®ç°/4.png" alt="4"></p>
<ul>
<li>1ï¼‰å…ˆç”¨whileå¾ªç¯ï¼Œå…ˆæŠŠ el ä¸­æ‰€æœ‰çš„å­èŠ‚ç‚¹éƒ½æ·»åŠ åˆ°æ–‡æ¡£ç¢ç‰‡ä¸­fragment.appendChild(child);</li>
<li>2ï¼‰ç„¶åæˆ‘ä»¬é€šè¿‡replaceæ–¹æ³•å»éå†æ–‡æ¡£ä¸­æ‰€æœ‰çš„å­èŠ‚ç‚¹ï¼Œå°†ä»–ä»¬æ–‡æœ¬èŠ‚ç‚¹ä¸­ï¼ˆnode.nodeType = 3ï¼‰å¸¦æœ‰åŒå¤§æ‹¬å·è¯­æ³•ä¸­çš„å†…å®¹éƒ½è·å–åˆ°ï¼ŒæŠŠåŒ¹é…åˆ°çš„å€¼æ‹†åˆ†æˆæ•°ç»„ï¼Œç„¶åéå†ä¾æ¬¡å»dataä¸­æŸ¥æ‰¾è·å–ï¼Œéå†çš„èŠ‚ç‚¹å¦‚æœæœ‰å­èŠ‚ç‚¹çš„è¯ç»§ç»­ä½¿ç”¨replaceæ–¹æ³•ç›´åˆ°åå›undefined</li>
<li>3ï¼‰è·å–åˆ°æ•°æ®åï¼Œç”¨replaceæ–¹æ³•æ›¿æ¢æ‰æ–‡æœ¬ä¸­åŒå¤§æ‹¬å·çš„æ•´å—å†…å®¹ï¼Œç„¶ååœ¨æ”¾å›elå…ƒç´ ä¸­vm.$el.appendChild(fragment)ï¼Œ</li>
</ul>
<h3 id="6ã€å…³è”è§†å›¾ï¼ˆviewï¼‰ä¸æ•°æ®ï¼ˆmodelï¼‰"><a href="#6ã€å…³è”è§†å›¾ï¼ˆviewï¼‰ä¸æ•°æ®ï¼ˆmodelï¼‰" class="headerlink" title="6ã€å…³è”è§†å›¾ï¼ˆviewï¼‰ä¸æ•°æ®ï¼ˆmodelï¼‰"></a>6ã€å…³è”è§†å›¾ï¼ˆviewï¼‰ä¸æ•°æ®ï¼ˆmodelï¼‰</h3><p>åœ¨æˆåŠŸçš„å°†æˆ‘ä»¬çš„æ•°æ®ç»‘å®šåˆ°äº†DOMèŠ‚ç‚¹ä¹‹åï¼Œè¦å®ç°æˆ‘ä»¬çš„è§†å›¾å±‚ï¼ˆviewï¼‰è·Ÿæ•°æ®å±‚ï¼ˆmodelï¼‰çš„å…³è”ï¼Œç°åœ¨å®é™…ä¸Šè¿˜æ²¡æœ‰å…³è”èµ·æ¥ï¼Œå› ä¸ºæ— æ³•é€šè¿‡æ”¹æ•°æ®å€¼æ¥å¼•å‘è§†å›¾çš„å˜åŒ–ï¼Œå®ç°è¿™æ­¥ä¹‹å‰å…ˆèŠä¸€ä¸‹JSä¸­æ¯”è¾ƒå¸¸ç”¨çš„è®¾è®¡æ¨¡å¼å‘å¸ƒè®¢é˜…æ¨¡å¼ä¹Ÿæ˜¯vueå®ç°åŒå‘æ•°æ®ç»‘å®šçš„å¾ˆå…³é”®çš„ä¸€æ­¥</p>
<h5 id="å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼ˆåˆç§°è§‚å¯Ÿè€…æ¨¡å¼ï¼‰"><a href="#å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼ˆåˆç§°è§‚å¯Ÿè€…æ¨¡å¼ï¼‰" class="headerlink" title="å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼ˆåˆç§°è§‚å¯Ÿè€…æ¨¡å¼ï¼‰"></a>å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼ˆåˆç§°è§‚å¯Ÿè€…æ¨¡å¼ï¼‰</h5><p>æˆ‘ä»¬å…ˆç®€å•æ‰‹åŠ¨å®ç°ä¸€ä¸ªï¼ˆå°±æ˜¯ä¸€ä¸ªæ•°ç»„å…³ç³»ï¼‰<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">// å‘å¸ƒè®¢é˜…</span><br><span class="line">function Dep() &#123;    </span><br><span class="line">    this.subs = []</span><br><span class="line">&#125;</span><br><span class="line">// è®¢é˜…</span><br><span class="line">Dep.prototype.addSub = function (sub) &#123;    </span><br><span class="line">    this.subs.push(sub)</span><br><span class="line">&#125;</span><br><span class="line">// é€šçŸ¥</span><br><span class="line">Dep.prototype.notify = function (sub) &#123;    </span><br><span class="line">    this.subs.forEach(item =&gt; item.update())</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">// watcheræ˜¯ä¸€ä¸ªç±»ï¼Œé€šè¿‡è¿™ä¸ªç±»åˆ›å»ºçš„å‡½æ•°éƒ½ä¼šæœ‰updateçš„æ–¹æ³•</span><br><span class="line">function Watcher(fn) &#123;    </span><br><span class="line">    this.fn = fn;</span><br><span class="line">&#125;</span><br><span class="line">Watcher.prototype.update = function () &#123;    </span><br><span class="line">    this.fn() </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿™é‡Œç”¨Depæ–¹æ³•æ¥å®ç°è®¢é˜…å’Œé€šçŸ¥ï¼Œåœ¨è¿™ä¸ªç±»ä¸­æœ‰addSubï¼ˆæ·»åŠ ï¼‰å’Œnotifyï¼ˆé€šçŸ¥ï¼‰ä¸¤ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬æŠŠå°†è¦åšçš„äº‹æƒ…ï¼ˆå‡½æ•°ï¼‰é€šè¿‡addSubæ·»åŠ è¿›æ•°ç»„é‡Œï¼Œç­‰æ—¶æœºä¸€åˆ°å°±notifyé€šçŸ¥é‡Œé¢æ‰€æœ‰çš„æ–¹æ³•æ‰§è¡Œ</p>
<p>å¤§å®¶ä¼šå‘ç°ä¸ºä»€ä¹ˆè¦å¦å¤–å®šä¹‰ä¸€ä¸ªåˆ›å»ºå‡½æ•°çš„æ–¹æ³•watcherï¼Œè€Œä¸æ˜¯ç›´æ¥æŠŠæ–¹æ³•æ‰”åˆ°addSubä¸­å¥½ï¼Œè¿™æ ·ä¸æ˜¯å¤šæ­¤ä¸€ä¸¾å˜›ï¼Ÿå…¶å®è¿™æ ·åšçš„æœ‰å®ƒçš„ç›®çš„ï¼Œå…¶ä¸­ä¸€ä¸ªå¥½å¤„å°±æ˜¯æˆ‘ä»¬é€šè¿‡watcheråˆ›å»ºçš„å‡½æ•°éƒ½ä¼šæœ‰ä¸€ä¸ªupdateæ‰§è¡Œçš„æ–¹æ³•å¯ä»¥æ–¹ä¾¿æˆ‘ä»¬è°ƒç”¨ã€‚è€Œå¦å¤–ä¸€ä¸ªç”¨å¤„æˆ‘ä¸‹é¢ä¼šè®²åˆ°ï¼Œå…ˆæŠŠå®ƒè¿ç”¨èµ·æ¥å§<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">function replace(fragment) &#123;     </span><br><span class="line">    Array.from(fragment.childNodes).forEach(function (node) &#123; </span><br><span class="line">         let text = node.textContent;         </span><br><span class="line">         let reg = /\&#123;\&#123;(.*)\&#125;\&#125;/g;   </span><br><span class="line">               </span><br><span class="line">         if (node.nodeType === 3 &amp;&amp; reg.test(text)) &#123;             </span><br><span class="line">             let arr = RegExp.$1.split(&apos;.&apos;);             </span><br><span class="line">             let val = vm; </span><br><span class="line">             arr.forEach(function (k) &#123; </span><br><span class="line">                 val = val[k]</span><br><span class="line">             &#125;)             </span><br><span class="line">             // åœ¨è¿™é‡Œè¿ç”¨äº†Watcherå‡½æ•°æ¥æ–°å¢è¦æ“ä½œçš„äº‹æƒ…</span><br><span class="line">             new Watcher(vm, RegExp.$1, function (newVal) &#123;</span><br><span class="line">                 node.textContent = text.replace(/\&#123;\&#123;(.*)\&#125;\&#125;/, newVal)</span><br><span class="line">             &#125;)</span><br><span class="line"></span><br><span class="line">             node.textContent = text.replace(/\&#123;\&#123;(.*)\&#125;\&#125;/, val)</span><br><span class="line">         &#125;         </span><br><span class="line">             </span><br><span class="line">         if (node.childNodes) &#123;</span><br><span class="line">             replace(node)</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;)</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p>
<p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æŠŠå®šä¹‰å‡½æ•°çš„æ–¹æ³•watcheråŠ åˆ°äº†replaceæ–¹æ³•é‡Œé¢ï¼Œä½†æ˜¯è¿™é‡Œçš„watcheræ›´åˆšå†™ç¼–å†™çš„å¤šäº†ä¸¤ä¸ªå½¢å‚vmã€RegExp.$1ï¼Œè€Œä¸”å†™æ³•ä¹Ÿæ–°å¢äº†ä¸€äº›å†…å®¹ï¼Œå› ä¸ºå½“new Watcherçš„æ—¶å€™ä¼šå¼•å‘å‘ç”Ÿå‡ ä¸ªæ“ä½œï¼Œæ¥çœ‹ä»£ç ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"> // vmåšæ•°æ®ä»£ç†çš„åœ°æ–¹</span><br><span class="line">function MyVue(options = &#123;&#125;) &#123;    </span><br><span class="line">    this.$options = options;    </span><br><span class="line">    var data = this._data = this.$options.data;</span><br><span class="line">    observe(data);    </span><br><span class="line">    for (const key in data) &#123;        </span><br><span class="line">        Object.defineProperty(this, key, &#123;</span><br><span class="line">            enumerable: true,</span><br><span class="line">            get() &#123;                </span><br><span class="line">                return this._data[key] </span><br><span class="line">            &#125;,</span><br><span class="line">            set(newVal) &#123; </span><br><span class="line">                this._data[key] = newVal</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">// æ•°æ®åŠ«æŒå‡½æ•°</span><br><span class="line">function Observe(data) &#123;       </span><br><span class="line">    let dep = new Dep();    </span><br><span class="line">    for (let key in data) &#123;        </span><br><span class="line">        let val = data[key];</span><br><span class="line">        observe(val)        </span><br><span class="line">        Object.defineProperty(data, key, &#123;</span><br><span class="line">            enumerable: true,</span><br><span class="line">            get() &#123;                </span><br><span class="line">                /* è·å–å€¼çš„æ—¶å€™ Dep.target </span><br><span class="line">                   å¯¹äºç€ watcherçš„å®ä¾‹ï¼ŒæŠŠä»–åˆ›å»ºçš„å®ä¾‹åŠ åˆ°è®¢é˜…é˜Ÿåˆ—ä¸­</span><br><span class="line">                */</span><br><span class="line">                Dep.target &amp;&amp; dep.addSub(Dep.target); </span><br><span class="line">                return val</span><br><span class="line">            &#125;,</span><br><span class="line">            set(newval) &#123; </span><br><span class="line">                if (val === newval) &#123;                    </span><br><span class="line">                    return</span><br><span class="line">                &#125;</span><br><span class="line">                val = newval;</span><br><span class="line">                observe(newval);                </span><br><span class="line">                // è®¾ç½®å€¼çš„æ—¶å€™è®©æ‰€æœ‰çš„watcher.updateæ–¹æ³•æ‰§è¡Œå³å¯è§¦å‘æ‰€æœ‰æ•°æ®æ›´æ–°</span><br><span class="line">                dep.notify() </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Watcher(vm, exp, fn) &#123;    </span><br><span class="line">    this.fn = fn;    </span><br><span class="line">    // è¿™é‡Œæˆ‘ä»¬æ–°å¢äº†ä¸€äº›å†…å®¹ï¼Œç”¨æ¥å¯ä»¥è·å–å¯¹äºçš„æ•°æ®</span><br><span class="line">    this.vm = vm;    </span><br><span class="line">    this.exp = exp; </span><br><span class="line">    Dep.target = this</span><br><span class="line">    let val = vm;    </span><br><span class="line">    let arr = exp.split(&apos;.&apos;);    </span><br><span class="line">    /* æ‰§è¡Œè¿™ä¸€æ­¥çš„æ—¶å€™æ“ä½œçš„æ˜¯vm.aï¼Œ</span><br><span class="line">    è€Œè¿™ä¸€æ­¥æ“ä½œå…¶å®å°±æ˜¯æ“ä½œçš„vm._data.açš„æ“ä½œï¼Œ</span><br><span class="line">    ä¼šè§¦å‘thisä»£ç†çš„æ•°æ®å’Œ_dataä¸Šé¢çš„æ•°æ®</span><br><span class="line">    */</span><br><span class="line">    arr.forEach(function (k) &#123;</span><br><span class="line">        val = val[k]</span><br><span class="line">    &#125;)</span><br><span class="line">    Dep.target = null;</span><br><span class="line">&#125;</span><br><span class="line">// è¿™é‡Œæ˜¯è®¾ç½®å€¼æ“ä½œ</span><br><span class="line">Watcher.prototype.update = function () &#123;    </span><br><span class="line">    let val = this.vm;    </span><br><span class="line">    let arr = this.exp.split(&apos;.&apos;);</span><br><span class="line">    arr.forEach(function (k) &#123;</span><br><span class="line">        val = val[k]</span><br><span class="line">    &#125;)    </span><br><span class="line">    this.fn(val) //è¿™é‡Œé¢è¦ä¼ ä¸€ä¸ªæ–°å€¼</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿™é‡Œå¼€å§‹ä¼šæœ‰ç‚¹ç»•ï¼Œä¸€å®šè¦ç†è§£å¥½æ“ä½œæ•°æ®çš„æ—¶å€™ä¼šè§¦å‘çš„é‚£ä¸ªå®ä¾‹ä¸Šé¢æ•°æ®çš„getå’Œsetï¼Œæ“ä½œçš„æ˜¯é‚£ä¸ªæ•°æ®è¿™ä¸ªæ€ç»´</p>
<p>1ï¼‰é¦–å…ˆçœ‹åœ¨Watcheræ„é€ å‡½æ•°ä¸­æ–°å¢äº†ä¸€äº›ç§æœ‰å±æ€§åˆ†åˆ«ä»£è¡¨ï¼š</p>
<ul>
<li>Dep.target = thisï¼ˆåœ¨æ„é€ å‡½æ•°Dep.targetä¸´æ—¶å­˜å‚¨ç€watcherçš„å½“å‰å®ä¾‹ï¼‰</li>
<li>this.vm = vmï¼ˆvm = myvueå®ä¾‹ï¼‰</li>
<li>this.exp = expï¼ˆexp = åŒ¹é…çš„æŸ¥æ‰¾çš„å¯¹è±¡â€a.bâ€æ˜¯å­—ç¬¦ä¸²ç±»å‹çš„å€¼ï¼‰</li>
</ul>
<p>æˆ‘ä»¬å­˜å‚¨è¿™äº›å±æ€§åï¼Œæ¥ä¸‹æ¥å°±è¦å»è·å–ç”¨expåŒ¹é…çš„å­—ç¬¦ä¸²é‡Œé¢å¯¹äºæ•°æ®ä¹Ÿå°±æ˜¯ vm.a.bï¼Œä½†æ˜¯æ­¤æ—¶çš„expæ˜¯ä¸ªå­—ç¬¦ä¸²ï¼Œä½ ä¸èƒ½ç›´æ¥è¿™æ ·å–å€¼vm[a.b]è¿™æ˜¯é”™è¯¯çš„è¯­æ³•ï¼Œæ‰€ä»¥è¦å¾ªç¯å»å–åˆ°å¯¹äºçš„å€¼<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">arr.forEach(function (k) &#123;        </span><br><span class="line">        // arr = [a,b] </span><br><span class="line">        val = val[k]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<ul>
<li>ç¬¬ä¸€æ¬¡å¾ªç¯çš„æ—¶å€™æ˜¯vm[a] = {b:12}ï¼Œå–åˆ°äº†aè¿™ä¸ªå¯¹è±¡ï¼Œç„¶ååœ¨èµ‹å€¼å›å»å°±æ˜¯æŠŠå½“å‰çš„valå˜æˆäº†aè¿™ä¸ªå¯¹è±¡</li>
<li>ç¬¬äºŒæ¬¡å¾ªç¯çš„æ—¶å€™valå·²ç»å˜æˆäº† aå¯¹è±¡ï¼Œæ­¤æ—¶çš„kå˜æˆäº†bï¼Œvalå°±å˜æˆäº†ï¼ša[b] = 12</li>
</ul>
<p>ç»è¿‡ä¸¤æ¬¡éå†åæˆ‘ä»¬è·å–åˆ°å€¼æ˜¯vmä»£ç†æ•°æ®ä¸Šé¢çš„aå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯ä¼šè§¦å‘ä»£ç†æ•°æ®ä¸Šé¢å¯¹äºæ•°æ®çš„getçš„æ–¹æ³•ï¼ˆvm.a.bï¼‰è€Œè¿™ä¸ªæ“ä½œè¿”å›çš„æ˜¯ this._data[k] å®ƒåˆä¼šè§¦å‘ vm._data.a.b æ•°æ®ä¸Šçš„getæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯èµ°åˆ°äº†Observe å‡½æ•°é‡Œé¢çš„getï¼Œæ­¤æ—¶çš„Dep.targetå­˜å‚¨çš„æ˜¯å½“å‰watcheræ–¹æ³•çš„å®ä¾‹ï¼ˆè¿™ä¸ªå®ä¾‹é‡Œé¢å·²ç»æœ‰è¦æ“ä½œæ•°æ®çš„ä¿¡æ¯ï¼‰ï¼Œå¹¶ä¸”æŠŠå–åˆ°æœ€æ–°çš„å€¼ä¼ åˆ°äº†æ–¹æ³•ä¸­<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">get() &#123;    </span><br><span class="line">    // èµ°åˆ°è¿™é‡Œçš„æ—¶å€™ Dep.target å·²ç»å­˜å‚¨äº† watcherçš„å½“å‰å®ä¾‹å®ä¾‹ï¼ŒæŠŠä»–åˆ›å»ºçš„å®ä¾‹åŠ åˆ°è®¢é˜…é˜Ÿåˆ—ä¸­</span><br><span class="line">    Dep.target &amp;&amp; dep.addSub(Dep.target); </span><br><span class="line">    return val</span><br><span class="line">&#125;,</span><br><span class="line">    </span><br><span class="line">// æŠŠè¦åšçš„æ›´æ–°è§†å›¾å±‚çš„æ“ä½œæ–¹æ³•ç”¨Watcherå®šä¹‰å¥½ï¼Œé‡Œé¢å·²ç»å®šä¹‰å¥½äº†è¦æ“ä½œçš„å¯¹è±¡</span><br><span class="line">new Watcher(vm, RegExp.$1, function (newVal) &#123;</span><br><span class="line">    node.textContent = text.replace(/\&#123;\&#123;(.*)\&#125;\&#125;/, newVal)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">Watcher.prototype.update = function () &#123;    </span><br><span class="line">    let val = this.vm;    </span><br><span class="line">    let arr = this.exp.split(&apos;.&apos;);</span><br><span class="line">    arr.forEach(function (k) &#123;</span><br><span class="line">        val = val[k]</span><br><span class="line">    &#125;)    this.fn(val) // æŠŠå¯¹äºçš„æ–°å€¼ä¼ é€’åˆ°æ–¹æ³•é‡Œé¢</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿™é‡Œå› ä¸ºåŠ å¤šäº†ä¸€å±‚ vm.a è¿™æ ·çš„æ•°æ®ä»£ç†ï¼Œæ‰€ä»¥é€»è¾‘æœ‰ç‚¹ç»•ï¼Œè®°ä½è¿™å¥è¯å°±å¥½ç†è§£æ“ä½œ vm.a ä»£ç†æ•°æ®ä¸Šé¢å€¼çš„æ—¶å€™ï¼Œå…¶å®å°±æ˜¯æ“ä½œçš„vm._dataä¸­çš„æ•°æ®æ‰€ä»¥ä¼šè§¦å‘ä¸¤ä¸ªåœ°æ–¹çš„getå’Œsetæ–¹æ³•ï¼Œå¥½è¯´è¿™ä¹ˆå¤šï¼Œæˆ‘ä»¬æ¥çœ‹æ˜¯å¦å®ç°æ•°æ®å˜åŠ¨è§¦å‘è§†å›¾å±‚çš„å˜åŒ–å§</p>
<p><img src="/2017/11/19/Vueçš„MVVMæ¨¡å¼å®ç°/text2.gif" alt=""></p>
<p>è¿™é‡Œå°±å®ç°äº†æ•°æ®çš„å˜æ›´è§¦å‘è§†å›¾å±‚çš„æ›´æ–°æ“ä½œäº†</p>
<h3 id="7ã€inputåŒå‘æ•°æ®ç»‘å®šçš„å®ç°"><a href="#7ã€inputåŒå‘æ•°æ®ç»‘å®šçš„å®ç°" class="headerlink" title="7ã€inputåŒå‘æ•°æ®ç»‘å®šçš„å®ç°"></a>7ã€inputåŒå‘æ•°æ®ç»‘å®šçš„å®ç°</h3><p>æœ€åä¸€æ­¥å°±æ¥å®ç°è§†å›¾å±‚çš„å˜æ›´è§¦å‘æ•°æ®ç»“æ„çš„å˜æ›´æ“ä½œï¼Œä¸Šé¢æˆ‘ä»¬å·²ç»æŠŠè§†å›¾ä¸æ•°æ®å…³è”æœ€æ ¸å¿ƒçš„ä»£ç è®²è§£äº†ï¼Œå‰©ä¸‹è§†å›¾å˜æ›´è§¦å‘æ•°æ®å˜æ›´å°±æ¯”è¾ƒå¥½å®ç°äº†<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> &lt;div id=&quot;app&quot;&gt;    </span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;div&gt;è¿™é‡Œçš„æ•°æ®1======&lt;span style=&quot;color: red;&quot;&gt;&#123;&#123;a.b&#125;&#125;&lt;/span&gt;&lt;/div&gt;</span><br><span class="line">        &lt;div&gt;è¿™é‡Œæ˜¯æ•°æ®2======&lt;span style=&quot;color: green;&quot;&gt;&#123;&#123;c&#125;&#125;&lt;/span&gt;&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;input type=&quot;text&quot; v-model=&quot;a.b&quot; value=&quot;&quot;&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„mvvmæ¨¡å— --&gt;</span><br><span class="line">&lt;script src=&quot;./mvvm.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">    var myvue = new MyVue(&#123;</span><br><span class="line">        el: &apos;#app&apos;,</span><br><span class="line">        data: &#123; a: &#123; b: &apos;ä½ å¥½&apos; &#125;, c: 12, o: [12, 5, 9, 8] &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">// è·å–æ‰€æœ‰å…ƒç´ èŠ‚ç‚¹</span><br><span class="line">if (node.nodeType === 1) &#123;    </span><br><span class="line">    let nodeAttr = node.attributes    </span><br><span class="line">    Array.from(nodeAttr).forEach(function (attr) &#123;        </span><br><span class="line">        let name = attr.name; // v-model=&quot;a.b&quot;</span><br><span class="line">        let exp = attr.value; // a.b</span><br><span class="line"></span><br><span class="line">        if (name.indexOf(&apos;v-&apos;) &gt;= 0) &#123;            </span><br><span class="line">            let val = vm;            </span><br><span class="line">            let arr = exp.split(&apos;.&apos;);</span><br><span class="line">            arr.forEach(function (n) &#123;</span><br><span class="line">                val = val[n]</span><br><span class="line">            &#125;)            </span><br><span class="line">            // è¿™ä¸ªè¿˜å¥½å¤„ç†ï¼Œå–åˆ°å¯¹åº”çš„å€¼è®¾ç½®ç»™input.valueå°±å¥½</span><br><span class="line">            node.value = val;</span><br><span class="line">        &#125;        </span><br><span class="line">        // è¿™é‡Œä¹Ÿè¦å®šä¹‰ä¸€ä¸ªWatcherï¼Œå› ä¸ºæ•°æ®å˜æ›´çš„æ—¶å€™ä¹Ÿè¦å˜æ›´å¸¦æœ‰v-modelå±æ€§åçš„å€¼</span><br><span class="line">        new Watcher(vm, exp, function (newVal) &#123;</span><br><span class="line">            node.value = newVal</span><br><span class="line">        &#125;)        </span><br><span class="line">        // è¿™é‡Œæ˜¯è§†å›¾å˜åŒ–çš„æ—¶å€™ï¼Œå˜æ›´æ•°æ®ç»“æ„ä¸Šé¢çš„å€¼</span><br><span class="line">        node.addEventListener(&apos;input&apos;, function (e) &#123;            </span><br><span class="line">            let newVal = e.target.value            </span><br><span class="line">            if (name.indexOf(&apos;v-&apos;) &gt;= 0) &#123;                </span><br><span class="line">                let val = vm;                </span><br><span class="line">                let arr = exp.split(&apos;.&apos;);</span><br><span class="line">                arr.forEach(function (k,index) &#123;     </span><br><span class="line">                    if (typeof val[k] === &apos;object&apos;) &#123;</span><br><span class="line">                        val = val[k]</span><br><span class="line">                    &#125; else&#123;                        </span><br><span class="line">                    if (index === arr.length-1) &#123;</span><br><span class="line">                            val[k] = newVal</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ä»£ç å¯¹æ•°æ®å˜æ›´è§¦å‘è§†å›¾å±‚å˜æ›´çš„é€»è¾‘æ›´ä¸Šä¸€èŠ‚ä¸€æ ·å³å¯ï¼Œä¸»è¦æ˜¯node.addEventListener(â€˜inputâ€™)è¿™é‡Œè®¾ç½®æ•°æ®çš„é—®é¢˜ï¼Œå…¶å®åŸç†è·Ÿç¬¬å…­èŠ‚å…³è”è§†å›¾ï¼ˆviewï¼‰ä¸æ•°æ®ï¼ˆmodelï¼‰çš„é€»è¾‘ä¸€æ ·ï¼Œæœ‰ä¸€å®šéœ€è¦æ³¨æ„çš„æ˜¯è¿™è¾¹åŠ äº†ä¸€ä¸ªå¼•ç”¨æ•°æ®ç±»å‹çš„åˆ¤æ–­ï¼Œä¸ç„¶ä»–çš„å¾ªç¯ä¼šåˆ°æœ€åº•å±‚çš„æ•°æ®ç±»å‹å€¼ï¼ˆä¹Ÿå°±æ˜¯åŸºç¡€æ•°æ®ç±»å‹ï¼‰</p>
<p>1ï¼‰è¿™é‡Œåˆ¤æ–­åˆ°å–åˆ°çš„ä¸æ˜¯å¯¹è±¡æ•°æ®ç±»å‹ï¼Œä¸åšæ›¿æ¢æ“ä½œ ï¼ˆval = val[k]ï¼‰<br>2ï¼‰åˆ¤æ–­æ˜¯ä¸æ˜¯å·²ç»æœ€åä¸€ä¸ªå±‚çº§äº†index === arr.length-1ï¼Œå¦‚æœæ˜¯çš„è¯ç›´æ¥æŠŠinputä¸­çš„å€¼èµ‹å€¼è¿›å½“å‰æ•°æ®ä¸­å³å¯<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">arr.forEach(function (k,index) &#123;     </span><br><span class="line">    if (typeof val[k] === &apos;object&apos;) &#123;        </span><br><span class="line">        // å¦‚æœæœ‰åµŒå¥—çš„è¯å°±ç»§ç»­æŸ¥æ‰¾</span><br><span class="line">        val = val[k]</span><br><span class="line">    &#125; else&#123;        </span><br><span class="line">        if (index === arr.length-1) &#123;            </span><br><span class="line">        // æŸ¥æ‰¾åˆ°æœ€åä¸€ä¸ªåç›´æ¥èµ‹å€¼</span><br><span class="line">            val[k] = newVal</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>ä»¥ä¸Šæ˜¯æ•´ä¸ªmvvmåŒå‘æ•°æ®ç»‘å®šçš„ç®€å•å®ç°åŸç†ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/18/Virtual-Domä»‹ç»/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/18/Virtual-Domä»‹ç»/" itemprop="url">Virtual Domä»‹ç»</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-11-18T12:18:24+08:00">
                2017-11-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://segmentfault.com/a/1190000016129036" target="_blank" rel="noopener">ä½ ä¸çŸ¥é“çš„Virtual DOMï¼ˆä¸€ï¼‰ï¼šVirtual Domä»‹ç»</a><br><a href="https://segmentfault.com/a/1190000016145981" target="_blank" rel="noopener">ä½ ä¸çŸ¥é“çš„Virtual DOMï¼ˆäºŒï¼‰ï¼šVirtual Domçš„æ›´æ–°</a><br><a href="https://segmentfault.com/a/1190000016186666" target="_blank" rel="noopener">ä½ ä¸çŸ¥é“çš„Virtual DOMï¼ˆä¸‰ï¼‰ï¼šVirtual Domæ›´æ–°ä¼˜åŒ–</a><br><a href="https://segmentfault.com/a/1190000016200003" target="_blank" rel="noopener">ä½ ä¸çŸ¥é“çš„Virtual DOMï¼ˆå››ï¼‰ï¼škeyçš„ä½œç”¨</a><br><a href="https://segmentfault.com/a/1190000016248276" target="_blank" rel="noopener">ä½ ä¸çŸ¥é“çš„Virtual DOMï¼ˆäº”ï¼‰ï¼šè‡ªå®šä¹‰ç»„ä»¶</a><br><a href="https://segmentfault.com/a/1190000016328371" target="_blank" rel="noopener">ä½ ä¸çŸ¥é“çš„Virtual DOMï¼ˆå…­ï¼‰ï¼šäº‹ä»¶å¤„ç†&amp;å¼‚æ­¥æ›´æ–°</a> </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/15/Vue-routeræµ…æåŸç†/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/15/Vue-routeræµ…æåŸç†/" itemprop="url">vue-routeræµ…æåŸç†</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-11-15T13:06:49+08:00">
                2017-11-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>è¿‘æœŸè¢«é—®åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨ä½ ä»¬é¡¹ç›®ä¸­ä½¿ç”¨çš„æ˜¯Vueçš„SPAï¼ˆå•é¡µé¢ï¼‰è¿˜æ˜¯Vueçš„å¤šé¡µé¢è®¾è®¡ï¼Ÿ</p>
<p>è¿™ç¯‡æ–‡ç« ä¸»è¦å›´ç»•Vueçš„SPAå•é¡µé¢è®¾è®¡å±•å¼€ã€‚<br>å…³äºå¦‚ä½•å±•å¼€Vueå¤šé¡µé¢è®¾è®¡<a href="https://link.juejin.im?target=https%3A%2F%2Fjuejin.im%2Fpost%2F5a8e3f00f265da4e747fc700" target="_blank" rel="noopener">è¯·ç‚¹å‡»æŸ¥çœ‹</a>ã€‚</p>
<h2 id="vue-routeræ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#vue-routeræ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="vue-routeræ˜¯ä»€ä¹ˆï¼Ÿ"></a>vue-routeræ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“vue-routeræ˜¯ä»€ä¹ˆï¼Œå®ƒæ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿ</p>
<p>è¿™é‡ŒæŒ‡çš„è·¯ç”±å¹¶ä¸æ˜¯æŒ‡æˆ‘ä»¬å¹³æ—¶æ‰€è¯´çš„ç¡¬ä»¶è·¯ç”±å™¨ï¼Œè¿™é‡Œçš„è·¯ç”±å°±æ˜¯SPAï¼ˆå•é¡µåº”ç”¨ï¼‰çš„è·¯å¾„ç®¡ç†å™¨ã€‚<br>æ¢å¥è¯è¯´ï¼Œvue-routerå°±æ˜¯WebAppçš„é“¾æ¥è·¯å¾„ç®¡ç†ç³»ç»Ÿã€‚</p>
<p>vue-routeræ˜¯Vue.jså®˜æ–¹çš„è·¯ç”±æ’ä»¶ï¼Œå®ƒå’Œvue.jsæ˜¯æ·±åº¦é›†æˆçš„ï¼Œé€‚åˆç”¨äºæ„å»ºå•é¡µé¢åº”ç”¨ã€‚</p>
<p>é‚£ä¸ä¼ ç»Ÿçš„é¡µé¢è·³è½¬æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</p>
<p>1.vueçš„å•é¡µé¢åº”ç”¨æ˜¯åŸºäºè·¯ç”±å’Œç»„ä»¶çš„ï¼Œè·¯ç”±ç”¨äºè®¾å®šè®¿é—®è·¯å¾„ï¼Œå¹¶å°†è·¯å¾„å’Œç»„ä»¶æ˜ å°„èµ·æ¥ã€‚</p>
<p>2.ä¼ ç»Ÿçš„é¡µé¢åº”ç”¨ï¼Œæ˜¯ç”¨ä¸€äº›è¶…é“¾æ¥æ¥å®ç°é¡µé¢åˆ‡æ¢å’Œè·³è½¬çš„ã€‚</p>
<p>åœ¨vue-routerå•é¡µé¢åº”ç”¨ä¸­ï¼Œåˆ™æ˜¯è·¯å¾„ä¹‹é—´çš„åˆ‡æ¢ï¼Œä¹Ÿå°±æ˜¯ç»„ä»¶çš„åˆ‡æ¢ã€‚è·¯ç”±æ¨¡å—çš„æœ¬è´¨ å°±æ˜¯å»ºç«‹èµ·urlå’Œé¡µé¢ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚</p>
<p>è‡³äºä¸ºå•¥ä¸èƒ½ç”¨aæ ‡ç­¾ï¼Œè¿™æ˜¯å› ä¸ºç”¨Vueåšçš„éƒ½æ˜¯å•é¡µåº”ç”¨ï¼Œå°±ç›¸å½“äºåªæœ‰ä¸€ä¸ªä¸»çš„index.htmlé¡µé¢ï¼Œæ‰€ä»¥ä½ å†™çš„æ ‡ç­¾æ˜¯ä¸èµ·ä½œç”¨çš„ï¼Œå¿…é¡»ä½¿ç”¨vue-routeræ¥è¿›è¡Œç®¡ç†ã€‚</p>
<h2 id="vue-routerå®ç°åŸç†"><a href="#vue-routerå®ç°åŸç†" class="headerlink" title="vue-routerå®ç°åŸç†"></a>vue-routerå®ç°åŸç†</h2><p>SPA(single page application):å•ä¸€é¡µé¢åº”ç”¨ç¨‹åºï¼Œæœ‰ä¸”åªæœ‰ä¸€ä¸ªå®Œæ•´çš„é¡µé¢ï¼›å½“å®ƒåœ¨åŠ è½½é¡µé¢çš„æ—¶å€™ï¼Œä¸ä¼šåŠ è½½æ•´ä¸ªé¡µé¢çš„å†…å®¹ï¼Œè€Œåªæ›´æ–°æŸä¸ªæŒ‡å®šçš„å®¹å™¨ä¸­å†…å®¹ã€‚</p>
<p>å•é¡µé¢åº”ç”¨(SPA)çš„æ ¸å¿ƒä¹‹ä¸€æ˜¯:</p>
<p>1.æ›´æ–°è§†å›¾è€Œä¸é‡æ–°è¯·æ±‚é¡µé¢;</p>
<p>2.vue-routeråœ¨å®ç°å•é¡µé¢å‰ç«¯è·¯ç”±æ—¶ï¼Œæä¾›äº†ä¸‰ç§æ–¹å¼ï¼šHashæ¨¡å¼ã€Historyæ¨¡å¼ã€abstractæ¨¡å¼ï¼Œæ ¹æ®modeå‚æ•°æ¥å†³å®šé‡‡ç”¨å“ªä¸€ç§æ–¹å¼ã€‚</p>
<h4 id="è·¯ç”±æ¨¡å¼"><a href="#è·¯ç”±æ¨¡å¼" class="headerlink" title="è·¯ç”±æ¨¡å¼"></a>è·¯ç”±æ¨¡å¼</h4><p>vue-router æä¾›äº†ä¸‰ç§è¿è¡Œæ¨¡å¼ï¼š</p>
<p>â— hash: ä½¿ç”¨ URL hash å€¼æ¥ä½œè·¯ç”±ã€‚é»˜è®¤æ¨¡å¼ã€‚</p>
<p>â— history: ä¾èµ– HTML5 History API å’ŒæœåŠ¡å™¨é…ç½®ã€‚æŸ¥çœ‹ HTML5 History æ¨¡å¼ã€‚</p>
<p>â— abstract: æ”¯æŒæ‰€æœ‰ JavaScript è¿è¡Œç¯å¢ƒï¼Œå¦‚ Node.js æœåŠ¡å™¨ç«¯ã€‚</p>
<h3 id="Hashæ¨¡å¼"><a href="#Hashæ¨¡å¼" class="headerlink" title="Hashæ¨¡å¼"></a>Hashæ¨¡å¼</h3><p><strong>vue-router é»˜è®¤æ¨¡å¼æ˜¯ hash æ¨¡å¼ â€”â€” ä½¿ç”¨ URL çš„ hash æ¥æ¨¡æ‹Ÿä¸€ä¸ªå®Œæ•´çš„ URLï¼Œå½“ URL æ”¹å˜æ—¶ï¼Œé¡µé¢ä¸ä¼šå»é‡æ–°åŠ è½½</strong>ã€‚</p>
<p>hashï¼ˆ#ï¼‰æ˜¯URL çš„é”šç‚¹ï¼Œä»£è¡¨çš„æ˜¯ç½‘é¡µä¸­çš„ä¸€ä¸ªä½ç½®ï¼Œå•å•æ”¹å˜#åçš„éƒ¨åˆ†ï¼ˆ/#/..ï¼‰ï¼Œæµè§ˆå™¨åªä¼šåŠ è½½ç›¸åº”ä½ç½®çš„å†…å®¹ï¼Œä¸ä¼šé‡æ–°åŠ è½½ç½‘é¡µï¼Œä¹Ÿå°±æ˜¯è¯´ #æ˜¯ç”¨æ¥æŒ‡å¯¼æµè§ˆå™¨åŠ¨ä½œçš„ï¼Œå¯¹æœåŠ¡å™¨ç«¯å®Œå…¨æ— ç”¨ï¼ŒHTTPè¯·æ±‚ä¸­ä¸åŒ…æ‹¬#ï¼›åŒæ—¶æ¯ä¸€æ¬¡æ”¹å˜#åçš„éƒ¨åˆ†ï¼Œéƒ½ä¼šåœ¨æµè§ˆå™¨çš„è®¿é—®å†å²ä¸­å¢åŠ ä¸€ä¸ªè®°å½•ï¼Œä½¿ç”¨â€åé€€â€æŒ‰é’®ï¼Œå°±å¯ä»¥å›åˆ°ä¸Šä¸€ä¸ªä½ç½®ï¼›<strong>æ‰€ä»¥è¯´Hashæ¨¡å¼é€šè¿‡é”šç‚¹å€¼çš„æ”¹å˜ï¼Œæ ¹æ®ä¸åŒçš„å€¼ï¼Œæ¸²æŸ“æŒ‡å®šDOMä½ç½®çš„ä¸åŒæ•°æ®</strong>ã€‚</p>
<h3 id="Historyæ¨¡å¼"><a href="#Historyæ¨¡å¼" class="headerlink" title="Historyæ¨¡å¼"></a>Historyæ¨¡å¼</h3><p>HTML5 History APIæä¾›äº†ä¸€ç§åŠŸèƒ½ï¼Œèƒ½è®©å¼€å‘äººå‘˜åœ¨ä¸åˆ·æ–°æ•´ä¸ªé¡µé¢çš„æƒ…å†µä¸‹ä¿®æ”¹ç«™ç‚¹çš„URLï¼Œå°±æ˜¯åˆ©ç”¨ history.pushState API æ¥å®Œæˆ URL è·³è½¬è€Œæ— é¡»é‡æ–°åŠ è½½é¡µé¢ï¼›</p>
<p>ç”±äºhashæ¨¡å¼ä¼šåœ¨urlä¸­è‡ªå¸¦#ï¼Œå¦‚æœä¸æƒ³è¦å¾ˆä¸‘çš„ hashï¼Œæˆ‘ä»¬å¯ä»¥ç”¨è·¯ç”±çš„ history æ¨¡å¼ï¼Œåªéœ€è¦åœ¨é…ç½®è·¯ç”±è§„åˆ™æ—¶ï¼ŒåŠ å…¥â€mode: â€˜historyâ€™â€,è¿™ç§æ¨¡å¼å……åˆ†åˆ©ç”¨ history.pushState API æ¥å®Œæˆ URL è·³è½¬è€Œæ— é¡»é‡æ–°åŠ è½½é¡µé¢ã€‚</p>
<pre><code>//main.jsæ–‡ä»¶ä¸­
const router = new VueRouter({
  mode: &apos;history&apos;,
  routes: [...]
})
</code></pre><p>å½“ä½¿ç”¨ history æ¨¡å¼æ—¶ï¼ŒURL å°±åƒæ­£å¸¸çš„ urlï¼Œä¾‹å¦‚ <a href="https://link.juejin.im?target=http%3A%2F%2Fyoursite.com%2Fuser%2Fid%25EF%25BC%258C%25E6%25AF%2594%25E8%25BE%2583%25E5%25A5%25BD%25E7%259C%258B%25EF%25BC%2581" target="_blank" rel="noopener">yoursite.com/user/idï¼Œæ¯”è¾ƒå¥½â€¦</a><br>ä¸è¿‡è¿™ç§æ¨¡å¼è¦ç©å¥½ï¼Œè¿˜éœ€è¦åå°é…ç½®æ”¯æŒã€‚å› ä¸ºæˆ‘ä»¬çš„åº”ç”¨æ˜¯ä¸ªå•é¡µå®¢æˆ·ç«¯åº”ç”¨ï¼Œå¦‚æœåå°æ²¡æœ‰æ­£ç¡®çš„é…ç½®ï¼Œå½“ç”¨æˆ·åœ¨æµè§ˆå™¨ç›´æ¥è®¿é—®</p>
<p>æ‰€ä»¥å‘¢ï¼Œä½ è¦åœ¨æœåŠ¡ç«¯å¢åŠ ä¸€ä¸ªè¦†ç›–æ‰€æœ‰æƒ…å†µçš„å€™é€‰èµ„æºï¼šå¦‚æœ URL åŒ¹é…ä¸åˆ°ä»»ä½•é™æ€èµ„æºï¼Œåˆ™åº”è¯¥è¿”å›åŒä¸€ä¸ª index.html é¡µé¢ï¼Œè¿™ä¸ªé¡µé¢å°±æ˜¯ä½  app ä¾èµ–çš„é¡µé¢ã€‚</p>
<pre><code>export const routes = [ 
  {path: &quot;/&quot;, name: &quot;homeLink&quot;, component:Home}
  {path: &quot;/register&quot;, name: &quot;registerLink&quot;, component: Register},
  {path: &quot;/login&quot;, name: &quot;loginLink&quot;, component: Login},
  {path: &quot;*&quot;, redirect: &quot;/&quot;}]
</code></pre><p>æ­¤å¤„å°±è®¾ç½®å¦‚æœURLè¾“å…¥é”™è¯¯æˆ–è€…æ˜¯URL åŒ¹é…ä¸åˆ°ä»»ä½•é™æ€èµ„æºï¼Œå°±è‡ªåŠ¨è·³åˆ°åˆ°Homeé¡µé¢ã€‚</p>
<h3 id="abstractæ¨¡å¼"><a href="#abstractæ¨¡å¼" class="headerlink" title="abstractæ¨¡å¼"></a>abstractæ¨¡å¼</h3><p>abstractæ¨¡å¼æ˜¯ä½¿ç”¨ä¸€ä¸ªä¸ä¾èµ–äºæµè§ˆå™¨çš„æµè§ˆå†å²è™šæ‹Ÿç®¡ç†åç«¯ã€‚</p>
<p>æ ¹æ®å¹³å°å·®å¼‚å¯ä»¥çœ‹å‡ºï¼Œåœ¨ Weex ç¯å¢ƒä¸­åªæ”¯æŒä½¿ç”¨ abstract æ¨¡å¼ã€‚ ä¸è¿‡ï¼Œvue-router è‡ªèº«ä¼šå¯¹ç¯å¢ƒåšæ ¡éªŒï¼Œå¦‚æœå‘ç°æ²¡æœ‰æµè§ˆå™¨çš„ APIï¼Œvue-router ä¼šè‡ªåŠ¨å¼ºåˆ¶è¿›å…¥ abstract æ¨¡å¼ï¼Œæ‰€ä»¥ åœ¨ä½¿ç”¨ vue-router æ—¶åªè¦ä¸å†™ mode é…ç½®å³å¯ï¼Œé»˜è®¤ä¼šåœ¨æµè§ˆå™¨ç¯å¢ƒä¸­ä½¿ç”¨ hash æ¨¡å¼ï¼Œåœ¨ç§»åŠ¨ç«¯åŸç”Ÿç¯å¢ƒä¸­ä½¿ç”¨ abstract æ¨¡å¼ã€‚ ï¼ˆå½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥æ˜ç¡®æŒ‡å®šåœ¨æ‰€æœ‰æƒ…å†µä¸‹éƒ½ä½¿ç”¨ abstract æ¨¡å¼ï¼‰</p>
<h2 id="vue-routerä½¿ç”¨æ–¹å¼"><a href="#vue-routerä½¿ç”¨æ–¹å¼" class="headerlink" title="vue-routerä½¿ç”¨æ–¹å¼"></a>vue-routerä½¿ç”¨æ–¹å¼</h2><p><strong>1:ä¸‹è½½</strong> npm i vue-router -S</p>
<p><strong>2:åœ¨main.jsä¸­å¼•å…¥ </strong> import VueRouter from â€˜vue-routerâ€™;</p>
<p><strong>3:å®‰è£…æ’ä»¶</strong> Vue.use(VueRouter);</p>
<p><strong>4:åˆ›å»ºè·¯ç”±å¯¹è±¡å¹¶é…ç½®è·¯ç”±è§„åˆ™</strong></p>
<p>let router = new VueRouter({routes:[{path:â€™/homeâ€™,component:Home}]});</p>
<p><strong>5:å°†å…¶è·¯ç”±å¯¹è±¡ä¼ é€’ç»™Vueçš„å®ä¾‹</strong>ï¼Œoptionsä¸­åŠ å…¥ router:router</p>
<p><strong>6:åœ¨app.vueä¸­ç•™å‘</strong></p>
<pre><code>&lt;router-view&gt;&lt;/router-view&gt;
</code></pre><p>å…·ä½“å®ç°è¯·çœ‹å¦‚ä¸‹ä»£ç ï¼š</p>
<pre><code>//main.jsæ–‡ä»¶ä¸­å¼•å…¥
import Vue from &apos;vue&apos;;
import VueRouter from &apos;vue-router&apos;;
//ä¸»ä½“
import App from &apos;./components/app.vue&apos;;
import index from &apos;./components/index.vue&apos;
//å®‰è£…æ’ä»¶
Vue.use(VueRouter); //æŒ‚è½½å±æ€§
//åˆ›å»ºè·¯ç”±å¯¹è±¡å¹¶é…ç½®è·¯ç”±è§„åˆ™
let router = new VueRouter({
    routes: [
        //ä¸€ä¸ªä¸ªå¯¹è±¡
        { path: &apos;/index&apos;, component: index }
    ]
});
//new Vue å¯åŠ¨
new Vue({
    el: &apos;#app&apos;,
    //è®©vueçŸ¥é“æˆ‘ä»¬çš„è·¯ç”±è§„åˆ™
    router: router, //å¯ä»¥ç®€å†™router
    render: c =&gt; c(App),
})
</code></pre><p>æœ€åè®°å¾—åœ¨åœ¨app.vueä¸­â€œç•™å‘â€</p>
<pre><code>//app.vueä¸­
&lt;template&gt;
    &lt;div&gt;
        &lt;!-- ç•™å‘ï¼Œéå¸¸é‡è¦ --&gt;
        &lt;router-view&gt;&lt;/router-view&gt;
    &lt;/div&gt;
&lt;/template&gt;
&lt;script&gt;
    export default {
        data(){
            return {}
        }
    }
&lt;/script&gt;
</code></pre><h2 id="vue-routeræºç åˆ†æ"><a href="#vue-routeræºç åˆ†æ" class="headerlink" title="vue-routeræºç åˆ†æ"></a>vue-routeræºç åˆ†æ</h2><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹vueçš„å®ç°è·¯å¾„ã€‚<br><img src="https://user-gold-cdn.xitu.io/2018/10/18/16684f162d3090eb?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""><br>åœ¨å…¥å£æ–‡ä»¶ä¸­éœ€è¦å®ä¾‹åŒ–ä¸€ä¸ª VueRouter çš„å®ä¾‹å¯¹è±¡ ï¼Œç„¶åå°†å…¶ä¼ å…¥ Vue å®ä¾‹çš„ options ä¸­ã€‚</p>
<pre><code>export default class VueRouter {
  static install: () =&gt; void;
  static version: string;

  app: any;
  apps: Array&lt;any&gt;;
  ready: boolean;
  readyCbs: Array&lt;Function&gt;;
  options: RouterOptions;
  mode: string;
  history: HashHistory | HTML5History | AbstractHistory;
  matcher: Matcher;
  fallback: boolean;
  beforeHooks: Array&lt;?NavigationGuard&gt;;
  resolveHooks: Array&lt;?NavigationGuard&gt;;
  afterHooks: Array&lt;?AfterNavigationHook&gt;;

  constructor (options: RouterOptions = {}) {
    this.app = null
    this.apps = []
    this.options = options
    this.beforeHooks = []
    this.resolveHooks = []
    this.afterHooks = []
    // åˆ›å»º matcher åŒ¹é…å‡½æ•°
    this.matcher = createMatcher(options.routes || [], this)
    // æ ¹æ® mode å®ä¾‹åŒ–å…·ä½“çš„ Historyï¼Œé»˜è®¤ä¸º&apos;hash&apos;æ¨¡å¼
    let mode = options.mode || &apos;hash&apos;
    // é€šè¿‡ supportsPushState åˆ¤æ–­æµè§ˆå™¨æ˜¯å¦æ”¯æŒ&apos;history&apos;æ¨¡å¼
    // å¦‚æœè®¾ç½®çš„æ˜¯&apos;history&apos;ä½†æ˜¯å¦‚æœæµè§ˆå™¨ä¸æ”¯æŒçš„è¯ï¼Œ&apos;history&apos;æ¨¡å¼ä¼šé€€å›åˆ°&apos;hash&apos;æ¨¡å¼
    // fallback æ˜¯å½“æµè§ˆå™¨ä¸æ”¯æŒ history.pushState æ§åˆ¶è·¯ç”±æ˜¯å¦åº”è¯¥å›é€€åˆ° hash æ¨¡å¼ã€‚é»˜è®¤å€¼ä¸º trueã€‚
    this.fallback = mode === &apos;history&apos; &amp;&amp; !supportsPushState &amp;&amp; options.fallback !== falseif (this.fallback) {
      mode = &apos;hash&apos;
    }
    // ä¸åœ¨æµè§ˆå™¨å†…éƒ¨çš„è¯ï¼Œå°±ä¼šå˜æˆ&apos;abstract&apos;æ¨¡å¼
    if (!inBrowser) {
      mode = &apos;abstract&apos;
    }
    this.mode = mode
     // æ ¹æ®ä¸åŒæ¨¡å¼é€‰æ‹©å®ä¾‹åŒ–å¯¹åº”çš„ History ç±»
    switch (mode) {
      case&apos;history&apos;:
        this.history = new HTML5History(this, options.base)
        breakcase&apos;hash&apos;:
        this.history = new HashHistory(this, options.base, this.fallback)
        breakcase&apos;abstract&apos;:
        this.history = new AbstractHistory(this, options.base)
        break
      default:
        if (process.env.NODE_ENV !== &apos;production&apos;) {
          assert(false, `invalid mode: ${mode}`)
        }
    }
  }

  match (
    raw: RawLocation,
    current?: Route,
    redirectedFrom?: Location
  ): Route {
    return this.matcher.match(raw, current, redirectedFrom)
  }

  get currentRoute (): ?Route {
    return this.history &amp;&amp; this.history.current
  }

  init (app: any /* Vue component instance */) {
    process.env.NODE_ENV !== &apos;production&apos; &amp;&amp; assert(
      install.installed,
      `not installed. Make sure to call \`Vue.use(VueRouter)\` ` +
      `before creating root instance.`
    )

    this.apps.push(app)

    // main app already initialized.
    if (this.app) {
      return
    }

    this.app = app

    const history = this.history
    // æ ¹æ®historyçš„ç±»åˆ«æ‰§è¡Œç›¸åº”çš„åˆå§‹åŒ–æ“ä½œå’Œç›‘å¬
    if (history instanceof HTML5History) {
      history.transitionTo(history.getCurrentLocation())
    } elseif (history instanceof HashHistory) {
      const setupHashListener = () =&gt; {
        history.setupListeners()
      }
      history.transitionTo(
        history.getCurrentLocation(),
        setupHashListener,
        setupHashListener
      )
    }

    history.listen(route =&gt; {
      this.apps.forEach((app) =&gt; {
        app._route = route
      })
    })
  }
  // è·¯ç”±è·³è½¬ä¹‹å‰
  beforeEach (fn: Function): Function {
    return registerHook(this.beforeHooks, fn)
  }
  // è·¯ç”±å¯¼èˆªè¢«ç¡®è®¤ä¹‹é—´å‰
  beforeResolve (fn: Function): Function {
    return registerHook(this.resolveHooks, fn)
  }
  // è·¯ç”±è·³è½¬ä¹‹å
  afterEach (fn: Function): Function {
    return registerHook(this.afterHooks, fn)
  }
  // ç¬¬ä¸€æ¬¡è·¯ç”±è·³è½¬å®Œæˆæ—¶è¢«è°ƒç”¨çš„å›è°ƒå‡½æ•°
  onReady (cb: Function, errorCb?: Function) {
    this.history.onReady(cb, errorCb)
  }
  // è·¯ç”±æŠ¥é”™
  onError (errorCb: Function) {
    this.history.onError(errorCb)
  }
  // è·¯ç”±æ·»åŠ ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šå‘historyæ ˆæ·»åŠ ä¸€ä¸ªè®°å½•ï¼Œç‚¹å‡»åé€€ä¼šè¿”å›åˆ°ä¸Šä¸€ä¸ªé¡µé¢ã€‚
  push (location: RawLocation, onComplete?: Function, onAbort?: Function) {
    this.history.push(location, onComplete, onAbort)
  }
  // è¿™ä¸ªæ–¹æ³•ä¸ä¼šå‘historyé‡Œé¢æ·»åŠ æ–°çš„è®°å½•ï¼Œç‚¹å‡»è¿”å›ï¼Œä¼šè·³è½¬åˆ°ä¸Šä¸Šä¸€ä¸ªé¡µé¢ã€‚ä¸Šä¸€ä¸ªè®°å½•æ˜¯ä¸å­˜åœ¨çš„ã€‚
  replace (location: RawLocation, onComplete?: Function, onAbort?: Function) {
    this.history.replace(location, onComplete, onAbort)
  }
  // ç›¸å¯¹äºå½“å‰é¡µé¢å‘å‰æˆ–å‘åè·³è½¬å¤šå°‘ä¸ªé¡µé¢,ç±»ä¼¼ window.history.go(n)ã€‚nå¯ä¸ºæ­£æ•°å¯ä¸ºè´Ÿæ•°ã€‚æ­£æ•°è¿”å›ä¸Šä¸€ä¸ªé¡µé¢
  go (n: number) {
    this.history.go(n)
  }
  // åé€€åˆ°ä¸Šä¸€ä¸ªé¡µé¢
  back () {
    this.go(-1)
  }
  // å‰è¿›åˆ°ä¸‹ä¸€ä¸ªé¡µé¢
  forward () {
    this.go(1)
  }

  getMatchedComponents (to?: RawLocation | Route): Array&lt;any&gt; {
    const route: any = to
      ? to.matched
        ? to
        : this.resolve(to).route
      : this.currentRoute
    if (!route) {
      return []
    }
    return [].concat.apply([], route.matched.map(m =&gt; {
      return Object.keys(m.components).map(key =&gt; {
        return m.components[key]
      })
    }))
  }

  resolve (
    to: RawLocation,
    current?: Route,
    append?: boolean
  ): {
    location: Location,
    route: Route,
    href: string,
    // for backwards compat
    normalizedTo: Location,
    resolved: Route
  } {
    const location = normalizeLocation(
      to,
      current || this.history.current,
      append,
      this
    )
    const route = this.match(location, current)
    const fullPath = route.redirectedFrom || route.fullPath
    const base = this.history.base
    const href = createHref(base, fullPath, this.mode)
    return {
      location,
      route,
      href,
      // for backwards compat
      normalizedTo: location,
      resolved: route
    }
  }

  addRoutes (routes: Array&lt;RouteConfig&gt;) {
    this.matcher.addRoutes(routes)
    if (this.history.current !== START) {
      this.history.transitionTo(this.history.getCurrentLocation())
    }
  }
}
</code></pre><h3 id="HashHistory"><a href="#HashHistory" class="headerlink" title="HashHistory"></a>HashHistory</h3><p>â€¢ hashè™½ç„¶å‡ºç°åœ¨urlä¸­ï¼Œä½†ä¸ä¼šè¢«åŒ…æ‹¬åœ¨httpè¯·æ±‚ä¸­ï¼Œå®ƒæ˜¯ç”¨æ¥æŒ‡å¯¼æµè§ˆå™¨åŠ¨ä½œçš„ï¼Œå¯¹æœåŠ¡å™¨ç«¯æ²¡å½±å“ï¼Œå› æ­¤ï¼Œæ”¹å˜hashä¸ä¼šé‡æ–°åŠ è½½é¡µé¢ã€‚</p>
<p>â€¢ å¯ä»¥ä¸ºhashçš„æ”¹å˜æ·»åŠ ç›‘å¬äº‹ä»¶ï¼š</p>
<pre><code>window.addEventListener(&quot;hashchange&quot;,funcRef,false)
</code></pre><p>â€¢ æ¯ä¸€æ¬¡æ”¹å˜hash(window.location.hash)ï¼Œéƒ½ä¼šåœ¨æµè§ˆå™¨è®¿é—®å†å²ä¸­å¢åŠ ä¸€ä¸ªè®°å½•ã€‚</p>
<pre><code>export class HashHistory extends History {
  constructor (router: Router, base: ?string, fallback: boolean) {
    super(router, base)
    // check history fallback deeplinking
    // å¦‚æœæ˜¯ä»historyæ¨¡å¼é™çº§æ¥çš„ï¼Œéœ€è¦åšé™çº§æ£€æŸ¥
    if (fallback &amp;&amp; checkFallback(this.base)) {
    // å¦‚æœé™çº§ä¸”åšäº†é™çº§å¤„ç†ï¼Œåˆ™è¿”å›
      return
    }
    ensureSlash()
  }
  .......


function checkFallback (base) {
  const location = getLocation(base)
  // å¾—åˆ°é™¤å»baseçš„çœŸæ­£çš„ location å€¼
  if (!/^\/#/.test(location)) {
  // å¦‚æœæ­¤æ—¶åœ°å€ä¸æ˜¯ä»¥ /# å¼€å¤´çš„
  // éœ€è¦åšä¸€æ¬¡é™çº§å¤„ç†ï¼Œé™ä¸º hash æ¨¡å¼ä¸‹åº”æœ‰çš„ /# å¼€å¤´
    window.location.replace(
      cleanPath(base + &apos;/#&apos; + location)
    )
    returntrue
  }
}

function ensureSlash (): boolean {
// å¾—åˆ° hash å€¼
  const path = getHash()
  if (path.charAt(0) === &apos;/&apos;) {
   // å¦‚æœæ˜¯ä»¥ / å¼€å¤´çš„ï¼Œç›´æ¥è¿”å›å³å¯
    returntrue
  }
  // ä¸æ˜¯çš„è¯ï¼Œéœ€è¦æ‰‹åŠ¨ä¿è¯ä¸€æ¬¡ æ›¿æ¢ hash å€¼
  replaceHash(&apos;/&apos; + path)
  returnfalse
}

exportfunction getHash (): string {
  // We can&apos;t use window.location.hash here because it&apos;s not
  // consistent across browsers - Firefox will pre-decode it!
  // å› ä¸ºå…¼å®¹æ€§çš„é—®é¢˜ï¼Œè¿™é‡Œæ²¡æœ‰ç›´æ¥ä½¿ç”¨ window.location.hash
  // å› ä¸º Firefox decode hash å€¼
  const href = window.location.href
  const index = href.indexOf(&apos;#&apos;)
  return index === -1 ? &apos;&apos; : decodeURI(href.slice(index + 1))
}
// å¾—åˆ°hashä¹‹å‰çš„urlåœ°å€
function getUrl (path) {
  const href = window.location.href
  const i = href.indexOf(&apos;#&apos;)
  const base = i &gt;= 0 ? href.slice(0, i) : href
  return `${base}#${path}`
}
// æ·»åŠ ä¸€ä¸ªhashfunction pushHash (path) {
  if (supportsPushState) {
    pushState(getUrl(path))
  } else {
    window.location.hash = path
  }
}
// æ›¿ä»£hashfunction replaceHash (path) {
  if (supportsPushState) {
    replaceState(getUrl(path))
  } else {
    window.location.replace(getUrl(path))
  }
}
</code></pre><p>hashçš„æ”¹å˜ä¼šè‡ªåŠ¨æ·»åŠ åˆ°æµè§ˆå™¨çš„è®¿é—®å†å²è®°å½•ä¸­ã€‚ é‚£ä¹ˆè§†å›¾çš„æ›´æ–°æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Œçœ‹ä¸‹ transitionTo()æ–¹æ³•ï¼š</p>
<pre><code>transitionTo (location: RawLocation, onComplete?: Function, onAbort?: Function) {
    const route = this.router.match(location, this.current) //æ‰¾åˆ°åŒ¹é…è·¯ç”±
    this.confirmTransition(route, () =&gt; { //ç¡®è®¤æ˜¯å¦è½¬åŒ–
      this.updateRoute(route) //æ›´æ–°route
      onComplete &amp;&amp; onComplete(route)
      this.ensureURL()

      // fire ready cbs once
      if (!this.ready) {
        this.ready = true
        this.readyCbs.forEach(cb =&gt; { cb(route) })
      }
    }, err =&gt; {
      if (onAbort) {
        onAbort(err)
      }
      if (err &amp;&amp; !this.ready) {
        this.ready = true
        this.readyErrorCbs.forEach(cb =&gt; { cb(err) })
      }
    })
  }

//æ›´æ–°è·¯ç”±
updateRoute (route: Route) {
    const prev = this.current // è·³è½¬å‰è·¯ç”±
    this.current = route // è£…å¤‡è·³è½¬è·¯ç”±
    this.cb &amp;&amp; this.cb(route) // å›è°ƒå‡½æ•°ï¼Œè¿™ä¸€æ­¥å¾ˆé‡è¦ï¼Œè¿™ä¸ªå›è°ƒå‡½æ•°åœ¨indexæ–‡ä»¶ä¸­æ³¨å†Œï¼Œä¼šæ›´æ–°è¢«åŠ«æŒçš„æ•°æ® _router
    this.router.afterHooks.forEach(hook =&gt; {
      hook &amp;&amp; hook(route, prev)
    })
  }
}
</code></pre><h4 id="pushState"><a href="#pushState" class="headerlink" title="pushState"></a>pushState</h4><pre><code>exportfunction pushState (url?: string, replace?: boolean) {
  saveScrollPosition()
  // try...catch the pushState call to get around Safari
  // DOM Exception 18 where it limits to 100 pushState calls
  // åŠ äº† try...catch æ˜¯å› ä¸º Safari æœ‰è°ƒç”¨ pushState 100 æ¬¡é™åˆ¶
  // ä¸€æ—¦è¾¾åˆ°å°±ä¼šæŠ›å‡º DOM Exception 18 é”™è¯¯
  const history = window.history
  try {
    if (replace) {
    // replace çš„è¯ key è¿˜æ˜¯å½“å‰çš„ key æ²¡å¿…è¦ç”Ÿæˆæ–°çš„
      history.replaceState({ key: _key }, &apos;&apos;, url)
    } else {
    // é‡æ–°ç”Ÿæˆ key
      _key = genKey()
       // å¸¦å…¥æ–°çš„ key å€¼
      history.pushState({ key: _key }, &apos;&apos;, url)
    }
  } catch (e) {
  // è¾¾åˆ°é™åˆ¶äº† åˆ™é‡æ–°æŒ‡å®šæ–°çš„åœ°å€
    window.location[replace ? &apos;replace&apos; : &apos;assign&apos;](url)
  }
}
</code></pre><h4 id="replaceState"><a href="#replaceState" class="headerlink" title="replaceState"></a>replaceState</h4><pre><code>// ç›´æ¥è°ƒç”¨ pushState ä¼ å…¥ replace ä¸º trueexportfunction replaceState (url?: string) {
  pushState(url, true)
}
</code></pre><p>pushStateå’ŒreplaceStateä¸¤ç§æ–¹æ³•çš„å…±åŒç‰¹ç‚¹ï¼šå½“è°ƒç”¨ä»–ä»¬ä¿®æ”¹æµè§ˆå™¨å†å²æ ˆåï¼Œè™½ç„¶å½“å‰urlæ”¹å˜äº†ï¼Œä½†æµè§ˆå™¨ä¸ä¼šç«‹å³å‘é€è¯·æ±‚è¯¥urlï¼Œè¿™å°±ä¸ºå•é¡µåº”ç”¨å‰ç«¯è·¯ç”±ï¼Œæ›´æ–°è§†å›¾ä½†ä¸é‡æ–°è¯·æ±‚é¡µé¢æä¾›äº†åŸºç¡€ã€‚</p>
<h4 id="supportsPushState"><a href="#supportsPushState" class="headerlink" title="supportsPushState"></a>supportsPushState</h4><pre><code>export const supportsPushState = inBrowser &amp;&amp; (function () {
  const ua = window.navigator.userAgent

  if (
    (ua.indexOf(&apos;Android 2.&apos;) !== -1 || ua.indexOf(&apos;Android 4.0&apos;) !== -1) &amp;&amp;
    ua.indexOf(&apos;Mobile Safari&apos;) !== -1 &amp;&amp;
    ua.indexOf(&apos;Chrome&apos;) === -1 &amp;&amp;
    ua.indexOf(&apos;Windows Phone&apos;) === -1
  ) {
    returnfalse
  }

  return window.history &amp;&amp; &apos;pushState&apos;in window.history
})()
</code></pre><p>å…¶å®æ‰€è°“å“åº”å¼å±æ€§ï¼Œå³å½“_routeå€¼æ”¹å˜æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨Vueå®ä¾‹çš„render()æ–¹æ³•ï¼Œæ›´æ–°è§†å›¾ã€‚<br>$router.push()â€“&gt;HashHistory.push()â€“&gt;History.transitionTo()â€“&gt;History.updateRoute()â€“&gt;{app._route=route}â€“&gt;vm.render()</p>
<h4 id="ç›‘å¬åœ°å€æ "><a href="#ç›‘å¬åœ°å€æ " class="headerlink" title="ç›‘å¬åœ°å€æ "></a>ç›‘å¬åœ°å€æ </h4><p>åœ¨æµè§ˆå™¨ä¸­ï¼Œç”¨æˆ·å¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨åœ°å€æ ä¸­è¾“å…¥æ”¹å˜è·¯ç”±ï¼Œå› æ­¤è¿˜éœ€è¦ç›‘å¬æµè§ˆå™¨åœ°å€æ ä¸­è·¯ç”±çš„å˜åŒ– ï¼Œå¹¶å…·æœ‰ä¸é€šè¿‡ä»£ç è°ƒç”¨ç›¸åŒçš„å“åº”è¡Œä¸ºï¼Œåœ¨HashHistoryä¸­è¿™ä¸€åŠŸèƒ½é€šè¿‡setupListenersç›‘å¬hashchangeå®ç°ï¼š</p>
<pre><code>setupListeners () {
    window.addEventListener(&apos;hashchange&apos;, () =&gt; {
        if (!ensureSlash()) {
            return
        }
        this.transitionTo(getHash(), route =&gt; {
            replaceHash(route.fullPath)
        })
    })
}
</code></pre><h3 id="HTML5History"><a href="#HTML5History" class="headerlink" title="HTML5History"></a>HTML5History</h3><p>History interfaceæ˜¯æµè§ˆå™¨å†å²è®°å½•æ ˆæä¾›çš„æ¥å£ï¼Œé€šè¿‡back(),forward(),go()ç­‰æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥è¯»å–æµè§ˆå™¨å†å²è®°å½•æ ˆçš„ä¿¡æ¯ï¼Œè¿›è¡Œå„ç§è·³è½¬æ“ä½œã€‚</p>
<pre><code>export class HTML5History extends History {
  constructor (router: Router, base: ?string) {
    super(router, base)

    const expectScroll = router.options.scrollBehavior //æŒ‡å›æ»šæ–¹å¼
    const supportsScroll = supportsPushState &amp;&amp; expectScroll

    if (supportsScroll) {
      setupScroll()
    }

    const initLocation = getLocation(this.base)
    //ç›‘æ§popstateäº‹ä»¶
    window.addEventListener(&apos;popstate&apos;, e =&gt; {
      const current = this.current

      // Avoiding first `popstate` event dispatched in some browsers but first
      // history route not updated since async guard at the same time.
      // é¿å…åœ¨æŸäº›æµè§ˆå™¨ä¸­é¦–æ¬¡å‘å‡ºâ€œpopstateâ€äº‹ä»¶
      // ç”±äºåŒä¸€æ—¶é—´å¼‚æ­¥ç›‘å¬ï¼Œhistoryè·¯ç”±æ²¡æœ‰åŒæ—¶æ›´æ–°ã€‚
      const location = getLocation(this.base)
      if (this.current === START &amp;&amp; location === initLocation) {
        return
      }

      this.transitionTo(location, route =&gt; {
        if (supportsScroll) {
          handleScroll(router, route, current, true)
        }
      })
    })
  }
</code></pre><p>hashæ¨¡å¼ä»…æ”¹å˜hashéƒ¨åˆ†çš„å†…å®¹ï¼Œè€Œhashéƒ¨åˆ†æ˜¯ä¸ä¼šåŒ…å«åœ¨httpè¯·æ±‚ä¸­çš„(hashå¸¦#)ï¼š</p>
<p><a href="https://link.juejin.im?target=http%3A%2F%2Foursite.com%2F%23%2Fuser%2Fid" target="_blank" rel="noopener">oursite.com/#/user/id</a> //å¦‚è¯·æ±‚ï¼Œåªä¼šå‘é€<a href="http://oursite.com/" target="_blank" rel="noopener">http://oursite.com/</a></p>
<p>æ‰€ä»¥hashæ¨¡å¼ä¸‹é‡åˆ°æ ¹æ®urlè¯·æ±‚é¡µé¢ä¸ä¼šæœ‰é—®é¢˜</p>
<p>è€Œhistoryæ¨¡å¼åˆ™å°†urlä¿®æ”¹çš„å°±å’Œæ­£å¸¸è¯·æ±‚åç«¯çš„urlä¸€æ ·(historyä¸å¸¦#)</p>
<p><a href="https://link.juejin.im?target=http%3A%2F%2Foursite.com%2Fuser%2Fid" target="_blank" rel="noopener">oursite.com/user/id</a></p>
<p>å¦‚æœè¿™ç§å‘åç«¯å‘é€è¯·æ±‚çš„è¯ï¼Œåç«¯æ²¡æœ‰é…ç½®å¯¹åº”/user/idçš„getè·¯ç”±å¤„ç†,ä¼šè¿”å›404é”™è¯¯ã€‚</p>
<p>å®˜æ–¹æ¨èçš„è§£å†³åŠæ³•æ˜¯åœ¨æœåŠ¡ç«¯å¢åŠ ä¸€ä¸ªè¦†ç›–æ‰€æœ‰æƒ…å†µçš„å€™é€‰èµ„æºï¼šå¦‚æœ URL åŒ¹é…ä¸åˆ°ä»»ä½•é™æ€èµ„æºï¼Œåˆ™åº”è¯¥è¿”å›åŒä¸€ä¸ª index.html é¡µé¢ï¼Œè¿™ä¸ªé¡µé¢å°±æ˜¯ä½  app ä¾èµ–çš„é¡µé¢ã€‚åŒæ—¶è¿™ä¹ˆåšä»¥åï¼ŒæœåŠ¡å™¨å°±ä¸å†è¿”å› 404 é”™è¯¯é¡µé¢ï¼Œå› ä¸ºå¯¹äºæ‰€æœ‰è·¯å¾„éƒ½ä¼šè¿”å› index.html æ–‡ä»¶ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œåœ¨ Vue åº”ç”¨é‡Œé¢è¦†ç›–æ‰€æœ‰çš„è·¯ç”±æƒ…å†µï¼Œç„¶ååœ¨ç»™å‡ºä¸€ä¸ª 404 é¡µé¢ã€‚æˆ–è€…ï¼Œå¦‚æœæ˜¯ç”¨ Node.js ä½œåå°ï¼Œå¯ä»¥ä½¿ç”¨æœåŠ¡ç«¯çš„è·¯ç”±æ¥åŒ¹é… URLï¼Œå½“æ²¡æœ‰åŒ¹é…åˆ°è·¯ç”±çš„æ—¶å€™è¿”å› 404ï¼Œä»è€Œå®ç° fallbackã€‚</p>
<h4 id="ä¸¤ç§æ¨¡å¼æ¯”è¾ƒ"><a href="#ä¸¤ç§æ¨¡å¼æ¯”è¾ƒ" class="headerlink" title="ä¸¤ç§æ¨¡å¼æ¯”è¾ƒ"></a>ä¸¤ç§æ¨¡å¼æ¯”è¾ƒ</h4><p>ä¸€èˆ¬çš„éœ€æ±‚åœºæ™¯ä¸­ï¼Œhashæ¨¡å¼ä¸historyæ¨¡å¼æ˜¯å·®ä¸å¤šçš„ï¼Œæ ¹æ®MDNçš„ä»‹ç»ï¼Œè°ƒç”¨history.pushState()ç›¸æ¯”äºç›´æ¥ä¿®æ”¹hashä¸»è¦æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š</p>
<p>â€¢ pushStateè®¾ç½®çš„æ–°urlå¯ä»¥æ˜¯ä¸å½“å‰urlåŒæºçš„ä»»æ„url,è€Œhashåªå¯ä¿®æ”¹#åé¢çš„éƒ¨åˆ†ï¼Œæ•…åªå¯è®¾ç½®ä¸å½“å‰åŒæ–‡æ¡£çš„url</p>
<p>â€¢ pushStateè®¾ç½®çš„æ–°urlå¯ä»¥ä¸å½“å‰urlä¸€æ¨¡ä¸€æ ·ï¼Œè¿™æ ·ä¹Ÿä¼šæŠŠè®°å½•æ·»åŠ åˆ°æ ˆä¸­ï¼Œè€Œhashè®¾ç½®çš„æ–°å€¼å¿…é¡»ä¸åŸæ¥ä¸ä¸€æ ·æ‰ä¼šè§¦å‘è®°å½•æ·»åŠ åˆ°æ ˆä¸­</p>
<p>â€¢ pushStateé€šè¿‡stateObjectå¯ä»¥æ·»åŠ ä»»æ„ç±»å‹çš„æ•°æ®è®°å½•ä¸­ï¼Œè€Œhashåªå¯æ·»åŠ çŸ­å­—ç¬¦ä¸²<br>pushStateå¯é¢å¤–è®¾ç½®titleå±æ€§ä¾›åç»­ä½¿ç”¨</p>
<h3 id="AbstractHistory"><a href="#AbstractHistory" class="headerlink" title="AbstractHistory"></a>AbstractHistory</h3><p>â€˜abstractâ€™æ¨¡å¼ï¼Œä¸æ¶‰åŠå’Œæµè§ˆå™¨åœ°å€çš„ç›¸å…³è®°å½•ï¼Œæµç¨‹è·Ÿâ€™HashHistoryâ€™æ˜¯ä¸€æ ·çš„ï¼Œå…¶åŸç†æ˜¯é€šè¿‡æ•°ç»„æ¨¡æ‹Ÿæµè§ˆå™¨å†å²è®°å½•æ ˆçš„åŠŸèƒ½</p>
<pre><code>//abstract.jså®ç°ï¼Œè¿™é‡Œé€šè¿‡æ ˆçš„æ•°æ®ç»“æ„æ¥æ¨¡æ‹Ÿè·¯ç”±è·¯å¾„
export class AbstractHistory extends History {
  index: number;
  stack: Array&lt;Route&gt;;

  constructor (router: Router, base: ?string) {
    super(router, base)
    this.stack = []
    this.index = -1
  }

  // å¯¹äº go çš„æ¨¡æ‹Ÿ
  go (n: number) {
    // æ–°çš„å†å²è®°å½•ä½ç½®
    const targetIndex = this.index + n
    // å°äºæˆ–å¤§äºè¶…å‡ºåˆ™è¿”å›
    if (targetIndex &lt; 0 || targetIndex &gt;= this.stack.length) {
      return
    }
    // å–å¾—æ–°çš„ route å¯¹è±¡
    // å› ä¸ºæ˜¯å’Œæµè§ˆå™¨æ— å…³çš„ è¿™é‡Œå¾—åˆ°çš„ä¸€å®šæ˜¯å·²ç»è®¿é—®è¿‡çš„
    const route = this.stack[targetIndex]
    // æ‰€ä»¥è¿™é‡Œç›´æ¥è°ƒç”¨ confirmTransition äº†
    // è€Œä¸æ˜¯è°ƒç”¨ transitionTo è¿˜è¦èµ°ä¸€é match é€»è¾‘
    this.confirmTransition(route, () =&gt; {
      this.index = targetIndex
      this.updateRoute(route)
    })
  }


 //ç¡®è®¤æ˜¯å¦è½¬åŒ–è·¯ç”±
  confirmTransition (route: Route, onComplete: Function, onAbort?: Function) {
    const current = this.current
    const abort = err =&gt; {
      if (isError(err)) {
        if (this.errorCbs.length) {
          this.errorCbs.forEach(cb =&gt; { cb(err) })
        } else {
          warn(false, &apos;uncaught error during route navigation:&apos;)
          console.error(err)
        }
      }
      onAbort &amp;&amp; onAbort(err)
    }
    //åˆ¤æ–­å¦‚æœå‰åæ˜¯åŒä¸€ä¸ªè·¯ç”±ï¼Œä¸è¿›è¡Œæ“ä½œ
    if (
      isSameRoute(route, current) &amp;&amp;
      route.matched.length === current.matched.length
    ) {
      this.ensureURL()
      return abort()
    }
    //ä¸‹é¢æ˜¯å„ç±»é’©å­å‡½æ•°çš„å¤„ç†
    //*********************
    })
  }
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/14/Service-Worker-PWA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/14/Service-Worker-PWA/" itemprop="url">Service Worker,PWA</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-11-14T20:08:28+08:00">
                2017-11-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="ä»€ä¹ˆæ˜¯Service-Worker"><a href="#ä»€ä¹ˆæ˜¯Service-Worker" class="headerlink" title="ä»€ä¹ˆæ˜¯Service Worker"></a>ä»€ä¹ˆæ˜¯<code>Service Worker</code></h2><p><code>Service Worker</code>æœ¬è´¨ä¸Šå……å½“Webåº”ç”¨ç¨‹åºä¸æµè§ˆå™¨ä¹‹é—´çš„ä»£ç†æœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥åœ¨ç½‘ç»œå¯ç”¨æ—¶ä½œä¸ºæµè§ˆå™¨å’Œç½‘ç»œé—´çš„ä»£ç†ã€‚å®ƒä»¬æ—¨åœ¨ï¼ˆé™¤å…¶ä»–ä¹‹å¤–ï¼‰ä½¿å¾—èƒ½å¤Ÿåˆ›å»ºæœ‰æ•ˆçš„ç¦»çº¿ä½“éªŒï¼Œæ‹¦æˆªç½‘ç»œè¯·æ±‚å¹¶åŸºäºç½‘ç»œæ˜¯å¦å¯ç”¨ä»¥åŠæ›´æ–°çš„èµ„æºæ˜¯å¦é©»ç•™åœ¨æœåŠ¡å™¨ä¸Šæ¥é‡‡å–é€‚å½“çš„åŠ¨ä½œã€‚ä»–ä»¬è¿˜å…è®¸è®¿é—®æ¨é€é€šçŸ¥å’Œåå°åŒæ­¥<code>API</code>ã€‚</p>
<ul>
<li><code>Service Worker</code>çš„æœ¬è´¨æ˜¯ä¸€ä¸ª<code>Web Worker</code>ï¼Œå®ƒç‹¬ç«‹äº<code>JavaScript</code>ä¸»çº¿ç¨‹ï¼Œå› æ­¤å®ƒä¸èƒ½ç›´æ¥è®¿é—®<code>DOM</code>ï¼Œä¹Ÿä¸èƒ½ç›´æ¥è®¿é—®<code>window</code>å¯¹è±¡ï¼Œä½†æ˜¯ï¼Œ<code>Service Worker</code>å¯ä»¥è®¿é—®<code>navigator</code>å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ¶ˆæ¯ä¼ é€’çš„æ–¹å¼ï¼ˆ<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/postMessage" target="_blank" rel="noopener">postMessage</a>ï¼‰ä¸<code>JavaScript</code>ä¸»çº¿ç¨‹è¿›è¡Œé€šä¿¡ã€‚</li>
<li><code>Service Worker</code>æ˜¯ä¸€ä¸ªç½‘ç»œä»£ç†ï¼Œå®ƒå¯ä»¥æ§åˆ¶<code>Web</code>é¡µé¢çš„æ‰€æœ‰ç½‘ç»œè¯·æ±‚ã€‚</li>
<li><code>Service Worker</code>å…·æœ‰è‡ªèº«çš„ç”Ÿå‘½å‘¨æœŸï¼Œä½¿ç”¨å¥½<code>Service Worker</code>çš„å…³é”®æ˜¯çµæ´»æ§åˆ¶å…¶ç”Ÿå‘½å‘¨æœŸã€‚</li>
</ul>
<h2 id="Service-Workerçš„ä½œç”¨"><a href="#Service-Workerçš„ä½œç”¨" class="headerlink" title="Service Workerçš„ä½œç”¨"></a><code>Service Worker</code>çš„ä½œç”¨</h2><ul>
<li>ç”¨äºæµè§ˆå™¨ç¼“å­˜</li>
<li>å®ç°ç¦»çº¿<code>Web APP</code></li>
<li>æ¶ˆæ¯æ¨é€</li>
</ul>
<h2 id="Service-Workerå…¼å®¹æ€§"><a href="#Service-Workerå…¼å®¹æ€§" class="headerlink" title="Service Workerå…¼å®¹æ€§"></a><code>Service Worker</code>å…¼å®¹æ€§</h2><p><img src="/2017/11/14/Service-Worker-PWA/1.webp" alt=""></p>
<p><code>Service Worker</code>æ˜¯ç°ä»£æµè§ˆå™¨çš„ä¸€ä¸ªé«˜çº§ç‰¹æ€§ï¼Œå®ƒä¾èµ–äº<code>fetch API</code>ã€<code>Cache Storage</code>ã€<code>Promise</code>ç­‰ï¼Œå…¶ä¸­ï¼Œ<code>Cache</code>æä¾›äº†<code>Request / Response</code>å¯¹è±¡å¯¹çš„å­˜å‚¨æœºåˆ¶ï¼Œ<code>Cache Storage</code>å­˜å‚¨å¤šä¸ª<code>Cache</code>ã€‚</p>
<h2 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h2><p>åœ¨äº†è§£<code>Service Worker</code>çš„åŸç†ä¹‹å‰ï¼Œå…ˆæ¥çœ‹ä¸€æ®µ<code>Service Worker</code>çš„ç¤ºä¾‹ï¼š</p>
<pre><code>self.importScripts(&apos;./serviceworker-cache-polyfill.js&apos;);

var urlsToCache = [
  &apos;/&apos;,
  &apos;/index.js&apos;,
  &apos;/style.css&apos;,
  &apos;/favicon.ico&apos;,
];

varCACHE_NAME=&apos;counterxing&apos;;

self.addEventListener(&apos;install&apos;, function(event) {
  self.skipWaiting();
  event.waitUntil(
    caches.open(CACHE_NAME)
    .then(function(cache) {
      returncache.addAll(urlsToCache);
    })
  );
});

self.addEventListener(&apos;fetch&apos;, function(event) {
  event.respondWith(
    caches.match(event.request)
    .then(function(response) {
      if (response) {
        return response;
      }
      returnfetch(event.request);
    })
  );
});


self.addEventListener(&apos;activate&apos;, function(event) {
  var cacheWhitelist = [&apos;counterxing&apos;];

  event.waitUntil(
    caches.keys().then(function(cacheNames) {
      returnPromise.all(
        cacheNames.map(function(cacheName) {
          if (cacheWhitelist.indexOf(cacheName) ===-1) {
            returncaches.delete(cacheName);
          }
        })
      );
    })
  );
});
</code></pre><p>ä¸‹é¢å¼€å§‹é€æ®µé€æ®µåœ°åˆ†æï¼Œæ­å¼€<code>Service Worker</code>çš„ç¥ç§˜é¢çº±ï¼š</p>
<h2 id="polyfill"><a href="#polyfill" class="headerlink" title="polyfill"></a><code>polyfill</code></h2><p>é¦–å…ˆçœ‹ç¬¬ä¸€è¡Œï¼š<code>self.importScripts(&#39;./serviceworker-cache-polyfill.js&#39;);</code>ï¼Œè¿™é‡Œå¼•å…¥äº†<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Cache" target="_blank" rel="noopener">Cache API</a>çš„ä¸€ä¸ª<a href="https://github.com/dominiccooney/cache-polyfill" target="_blank" rel="noopener">polyfill</a>ï¼Œè¿™ä¸ª<code>polyfill</code>æ”¯æŒä½¿å¾—åœ¨è¾ƒä½ç‰ˆæœ¬çš„æµè§ˆå™¨ä¸‹ä¹Ÿå¯ä»¥ä½¿ç”¨<code>Cache Storage API</code>ã€‚æƒ³è¦å®ç°<code>Service Worker</code>çš„åŠŸèƒ½ï¼Œä¸€èˆ¬éƒ½éœ€è¦æ­é…<code>Cache API</code>ä»£ç†ç½‘ç»œè¯·æ±‚åˆ°ç¼“å­˜ä¸­ã€‚</p>
<p>åœ¨<code>Service Worker</code>çº¿ç¨‹ä¸­ï¼Œä½¿ç”¨<code>importScripts</code>å¼•å…¥<code>polyfill</code>è„šæœ¬ï¼Œç›®çš„æ˜¯å¯¹ä½ç‰ˆæœ¬æµè§ˆå™¨çš„å…¼å®¹ã€‚</p>
<h2 id="Cache-Resources-List-And-Cache-Name"><a href="#Cache-Resources-List-And-Cache-Name" class="headerlink" title="Cache Resources List And Cache Name"></a><code>Cache Resources List</code> And <code>Cache Name</code></h2><p>ä¹‹åï¼Œä½¿ç”¨ä¸€ä¸ª<code>urlsToCache</code>åˆ—è¡¨æ¥å£°æ˜éœ€è¦ç¼“å­˜çš„é™æ€èµ„æºï¼Œå†ä½¿ç”¨ä¸€ä¸ªå˜é‡<code>CACHE_NAME</code>æ¥ç¡®å®šå½“å‰ç¼“å­˜çš„<code>Cache Storage Name</code>ï¼Œè¿™é‡Œå¯ä»¥ç†è§£æˆ<code>Cache Storage</code>æ˜¯ä¸€ä¸ª<code>DB</code>ï¼Œè€Œ<code>CACHE_NAME</code>åˆ™æ˜¯<code>DB</code>åï¼š</p>
<pre><code>var urlsToCache = [
  &apos;/&apos;,
  &apos;/index.js&apos;,
  &apos;/style.css&apos;,
  &apos;/favicon.ico&apos;,
];

varCACHE_NAME=&apos;counterxing&apos;;
</code></pre><h2 id="Lifecycle"><a href="#Lifecycle" class="headerlink" title="Lifecycle"></a><code>Lifecycle</code></h2><p><code>Service Worker</code>ç‹¬ç«‹äºæµè§ˆå™¨<code>JavaScript</code>ä¸»çº¿ç¨‹ï¼Œæœ‰å®ƒè‡ªå·±ç‹¬ç«‹çš„ç”Ÿå‘½å‘¨æœŸã€‚</p>
<p>å¦‚æœéœ€è¦åœ¨ç½‘ç«™ä¸Šå®‰è£…<code>Service Worker</code>ï¼Œåˆ™éœ€è¦åœ¨<code>JavaScript</code>ä¸»çº¿ç¨‹ä¸­ä½¿ç”¨ä»¥ä¸‹ä»£ç å¼•å…¥<code>Service Worker</code>ã€‚</p>
<pre><code>if (&apos;serviceWorker&apos;innavigator) {
  navigator.serviceWorker.register(&apos;/sw.js&apos;).then(function(registration) {
    console.log(&apos;æˆåŠŸå®‰è£…&apos;, registration.scope);
  }).catch(function(err) {
    console.log(err);
  });
}
</code></pre><p>æ­¤å¤„ï¼Œä¸€å®šè¦æ³¨æ„<code>sw.js</code>æ–‡ä»¶çš„è·¯å¾„ï¼Œåœ¨æˆ‘çš„ç¤ºä¾‹ä¸­ï¼Œå¤„äºå½“å‰åŸŸæ ¹ç›®å½•ä¸‹ï¼Œè¿™æ„å‘³ç€ï¼Œ<code>Service Worker</code>å’Œç½‘ç«™æ˜¯åŒæºçš„ï¼Œå¯ä»¥ä¸ºå½“å‰ç½‘ç«™çš„æ‰€æœ‰è¯·æ±‚åšä»£ç†ï¼Œå¦‚æœ<code>Service Worker</code>è¢«æ³¨å†Œåˆ°<code>/imaging/sw.js</code>ä¸‹ï¼Œé‚£åªèƒ½ä»£ç†<code>/imaging</code>ä¸‹çš„ç½‘ç»œè¯·æ±‚ã€‚</p>
<p>å¯ä»¥ä½¿ç”¨<code>Chrome</code>æ§åˆ¶å°ï¼ŒæŸ¥çœ‹å½“å‰é¡µé¢çš„<code>Service Worker</code>æƒ…å†µï¼š</p>
<p><img src="/2017/11/14/Service-Worker-PWA/2.webp" alt=""></p>
<p>å®‰è£…å®Œæˆåï¼Œ<code>Service Worker</code>ä¼šç»å†ä»¥ä¸‹ç”Ÿå‘½å‘¨æœŸï¼š</p>
<ol>
<li>ä¸‹è½½ï¼ˆ<code>download</code>ï¼‰</li>
<li>å®‰è£…ï¼ˆ<code>install</code>ï¼‰</li>
<li>æ¿€æ´»ï¼ˆ<code>activate</code>ï¼‰</li>
</ol>
<ul>
<li><p>ç”¨æˆ·é¦–æ¬¡è®¿é—®<code>Service Worker</code>æ§åˆ¶çš„ç½‘ç«™æˆ–é¡µé¢æ—¶ï¼Œ<code>Service Worker</code>ä¼šç«‹åˆ»è¢«ä¸‹è½½ã€‚ä¹‹åè‡³å°‘æ¯<code>24</code>å°æ—¶å®ƒä¼šè¢«ä¸‹è½½ä¸€æ¬¡ã€‚å®ƒå¯èƒ½è¢«æ›´é¢‘ç¹åœ°ä¸‹è½½ï¼Œä¸è¿‡æ¯<code>24</code>å°æ—¶ä¸€å®šä¼šè¢«ä¸‹è½½ä¸€æ¬¡ï¼Œä»¥é¿å…ä¸è‰¯è„šæœ¬é•¿æ—¶é—´ç”Ÿæ•ˆã€‚</p>
</li>
<li><p>åœ¨ä¸‹è½½å®Œæˆåï¼Œå¼€å§‹å®‰è£…<code>Service Worker</code>ï¼Œåœ¨å®‰è£…é˜¶æ®µï¼Œé€šå¸¸éœ€è¦ç¼“å­˜ä¸€äº›æˆ‘ä»¬é¢„å…ˆå£°æ˜çš„é™æ€èµ„æºï¼Œåœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œé€šè¿‡<code>urlsToCache</code>é¢„å…ˆå£°æ˜ã€‚</p>
</li>
<li><p>åœ¨å®‰è£…å®Œæˆåï¼Œä¼šå¼€å§‹è¿›è¡Œæ¿€æ´»ï¼Œæµè§ˆå™¨ä¼šå°è¯•ä¸‹è½½<code>Service Worker</code>è„šæœ¬æ–‡ä»¶ï¼Œä¸‹è½½æˆåŠŸåï¼Œä¼šä¸å‰ä¸€æ¬¡å·²ç¼“å­˜çš„<code>Service Worker</code>è„šæœ¬æ–‡ä»¶åšå¯¹æ¯”ï¼Œå¦‚æœä¸å‰ä¸€æ¬¡çš„<code>Service Worker</code>è„šæœ¬æ–‡ä»¶ä¸åŒï¼Œè¯æ˜<code>Service Worker</code>å·²ç»æ›´æ–°ï¼Œä¼šè§¦å‘<code>activate</code>äº‹ä»¶ã€‚å®Œæˆæ¿€æ´»ã€‚</p>
</li>
</ul>
<p>å¦‚å›¾æ‰€ç¤ºï¼Œä¸º<code>Service Worker</code>å¤§è‡´çš„ç”Ÿå‘½å‘¨æœŸï¼š</p>
<p><img src="/2017/11/14/Service-Worker-PWA/3.webp" alt=""></p>
<h3 id="install"><a href="#install" class="headerlink" title="install"></a><code>install</code></h3><p>åœ¨å®‰è£…å®Œæˆåï¼Œå°è¯•ç¼“å­˜ä¸€äº›é™æ€èµ„æºï¼š</p>
<pre><code>self.addEventListener(&apos;install&apos;, function(event) {
  self.skipWaiting();
  event.waitUntil(
    caches.open(CACHE_NAME)
    .then(function(cache) {
      returncache.addAll(urlsToCache);
    })
  );
});
</code></pre><p>é¦–å…ˆï¼Œ<code>self.skipWaiting()</code>æ‰§è¡Œï¼Œå‘ŠçŸ¥æµè§ˆå™¨ç›´æ¥è·³è¿‡ç­‰å¾…é˜¶æ®µï¼Œæ·˜æ±°è¿‡æœŸçš„<code>sw.js</code>çš„<code>Service Worker</code>è„šæœ¬ï¼Œç›´æ¥å¼€å§‹å°è¯•æ¿€æ´»æ–°çš„<code>Service Worker</code>ã€‚</p>
<p>ç„¶åä½¿ç”¨<code>caches.open</code>æ‰“å¼€ä¸€ä¸ª<code>Cache</code>ï¼Œæ‰“å¼€åï¼Œé€šè¿‡<code>cache.addAll</code>å°è¯•ç¼“å­˜æˆ‘ä»¬é¢„å…ˆå£°æ˜çš„é™æ€æ–‡ä»¶ã€‚</p>
<h3 id="ç›‘å¬fetchï¼Œä»£ç†ç½‘ç»œè¯·æ±‚"><a href="#ç›‘å¬fetchï¼Œä»£ç†ç½‘ç»œè¯·æ±‚" class="headerlink" title="ç›‘å¬fetchï¼Œä»£ç†ç½‘ç»œè¯·æ±‚"></a>ç›‘å¬<code>fetch</code>ï¼Œä»£ç†ç½‘ç»œè¯·æ±‚</h3><p>é¡µé¢çš„æ‰€æœ‰ç½‘ç»œè¯·æ±‚ï¼Œéƒ½ä¼šé€šè¿‡<code>Service Worker</code>çš„<code>fetch</code>äº‹ä»¶è§¦å‘ï¼Œ<code>Service Worker</code>é€šè¿‡<code>caches.match</code>å°è¯•ä»<code>Cache</code>ä¸­æŸ¥æ‰¾ç¼“å­˜ï¼Œç¼“å­˜å¦‚æœå‘½ä¸­ï¼Œåˆ™ç›´æ¥è¿”å›ç¼“å­˜ä¸­çš„<code>response</code>ï¼Œå¦åˆ™ï¼Œåˆ›å»ºä¸€ä¸ªçœŸå®çš„ç½‘ç»œè¯·æ±‚ã€‚</p>
<pre><code>self.addEventListener(&apos;fetch&apos;, function(event) {
  event.respondWith(
    caches.match(event.request)
    .then(function(response) {
      if (response) {
        return response;
      }
      returnfetch(event.request);
    })
  );
});
</code></pre><p>å¦‚æœæˆ‘ä»¬éœ€è¦åœ¨è¯·æ±‚è¿‡ç¨‹ä¸­ï¼Œå†å‘<code>Cache Storage</code>ä¸­æ·»åŠ æ–°çš„ç¼“å­˜ï¼Œå¯ä»¥é€šè¿‡<code>cache.put</code>æ–¹æ³•æ·»åŠ ï¼Œçœ‹ä»¥ä¸‹ä¾‹å­ï¼š</p>
<pre><code>self.addEventListener(&apos;fetch&apos;, function(event) {
  event.respondWith(
    caches.match(event.request)
    .then(function(response) {
      // ç¼“å­˜å‘½ä¸­if (response) {
        return response;
      }

      // æ³¨æ„ï¼Œè¿™é‡Œå¿…é¡»ä½¿ç”¨cloneæ–¹æ³•å…‹éš†è¿™ä¸ªè¯·æ±‚// åŸå› æ˜¯responseæ˜¯ä¸€ä¸ªStreamï¼Œä¸ºäº†è®©æµè§ˆå™¨è·Ÿç¼“å­˜éƒ½ä½¿ç”¨è¿™ä¸ªresponse// å¿…é¡»å…‹éš†è¿™ä¸ªresponseï¼Œä¸€ä»½åˆ°æµè§ˆå™¨ï¼Œä¸€ä»½åˆ°ç¼“å­˜ä¸­ç¼“å­˜ã€‚// åªèƒ½è¢«æ¶ˆè´¹ä¸€æ¬¡ï¼Œæƒ³è¦å†æ¬¡æ¶ˆè´¹ï¼Œå¿…é¡»cloneä¸€æ¬¡var fetchRequest =event.request.clone();

      returnfetch(fetchRequest).then(
        function(response) {
          // å¿…é¡»æ˜¯æœ‰æ•ˆè¯·æ±‚ï¼Œå¿…é¡»æ˜¯åŒæºå“åº”ï¼Œç¬¬ä¸‰æ–¹çš„è¯·æ±‚ï¼Œå› ä¸ºä¸å¯æ§ï¼Œæœ€å¥½ä¸è¦ç¼“å­˜if (!response ||response.status!==200||response.type!==&apos;basic&apos;) {
            return response;
          }

          // æ¶ˆè´¹è¿‡ä¸€æ¬¡ï¼Œåˆéœ€è¦å†å…‹éš†ä¸€æ¬¡var responseToCache =response.clone();
          caches.open(CACHE_NAME)
            .then(function(cache) {
              cache.put(event.request, responseToCache);
            });
          return response;
        }
      );
    })
  );
});
</code></pre><blockquote>
<p>åœ¨é¡¹ç›®ä¸­ï¼Œä¸€å®šè¦æ³¨æ„æ§åˆ¶ç¼“å­˜ï¼Œæ¥å£è¯·æ±‚ä¸€èˆ¬æ˜¯ä¸æ¨èç¼“å­˜çš„ã€‚æ‰€ä»¥åœ¨æˆ‘è‡ªå·±çš„é¡¹ç›®ä¸­ï¼Œå¹¶æ²¡æœ‰åœ¨è¿™é‡ŒåšåŠ¨æ€çš„ç¼“å­˜æ–¹æ¡ˆã€‚</p>
</blockquote>
<h3 id="activate"><a href="#activate" class="headerlink" title="activate"></a><code>activate</code></h3><p><code>Service Worker</code>æ€»æœ‰éœ€è¦æ›´æ–°çš„ä¸€å¤©ï¼Œéšç€ç‰ˆæœ¬è¿­ä»£ï¼ŒæŸä¸€å¤©ï¼Œæˆ‘ä»¬éœ€è¦æŠŠæ–°ç‰ˆæœ¬çš„åŠŸèƒ½å‘å¸ƒä¸Šçº¿ï¼Œæ­¤æ—¶éœ€è¦æ·˜æ±°æ‰æ—§çš„ç¼“å­˜ï¼Œæ—§çš„<code>Service Worker</code>å’Œ<code>Cache Storage</code>å¦‚ä½•æ·˜æ±°å‘¢ï¼Ÿ</p>
<pre><code>self.addEventListener(&apos;activate&apos;, function(event) {
  var cacheWhitelist = [&apos;counterxing&apos;];

  event.waitUntil(
    caches.keys().then(function(cacheNames) {
      returnPromise.all(
        cacheNames.map(function(cacheName) {
          if (cacheWhitelist.indexOf(cacheName) ===-1) {
            returncaches.delete(cacheName);
          }
        })
      );
    })
  );
});
</code></pre><ol>
<li>é¦–å…ˆæœ‰ä¸€ä¸ªç™½åå•ï¼Œç™½åå•ä¸­çš„<code>Cache</code>æ˜¯ä¸è¢«æ·˜æ±°çš„ã€‚</li>
<li>ä¹‹åé€šè¿‡<code>caches.keys()</code>æ‹¿åˆ°æ‰€æœ‰çš„<code>Cache Storage</code>ï¼ŒæŠŠä¸åœ¨ç™½åå•ä¸­çš„<code>Cache</code>æ·˜æ±°ã€‚</li>
<li>æ·˜æ±°ä½¿ç”¨<code>caches.delete()</code>æ–¹æ³•ã€‚å®ƒæ¥æ”¶<code>cacheName</code>ä½œä¸ºå‚æ•°ï¼Œåˆ é™¤è¯¥<code>cacheName</code>æ‰€æœ‰ç¼“å­˜ã€‚</li>
</ol>
<h2 id="sw-precache-webpack-plugin"><a href="#sw-precache-webpack-plugin" class="headerlink" title="sw-precache-webpack-plugin"></a>sw-precache-webpack-plugin</h2><p><a href="https://github.com/goldhand/sw-precache-webpack-plugin" target="_blank" rel="noopener">sw-precache-webpack-plugin</a>æ˜¯ä¸€ä¸ª<code>webpack plugin</code>ï¼Œå¯ä»¥é€šè¿‡é…ç½®çš„æ–¹å¼åœ¨<code>webpack</code>æ‰“åŒ…æ—¶ç”Ÿæˆæˆ‘ä»¬æƒ³è¦çš„<code>sw.js</code>çš„<code>Service Worker</code>è„šæœ¬ã€‚</p>
<p>ä¸€ä¸ªæœ€ç®€å•çš„é…ç½®å¦‚ä¸‹ï¼š</p>
<pre><code>var path =require(&apos;path&apos;);
var SWPrecacheWebpackPlugin =require(&apos;sw-precache-webpack-plugin&apos;);

constPUBLIC_PATH=&apos;https://www.my-project-name.com/&apos;;  // webpack needs the trailing slash for output.publicPathmodule.exports= {

  entry: {
    main:path.resolve(__dirname, &apos;src/index&apos;),
  },

  output: {
    path:path.resolve(__dirname, &apos;src/bundles/&apos;),
    filename:&apos;[name]-[hash].js&apos;,
    publicPath:PUBLIC_PATH,
  },

  plugins: [
    newSWPrecacheWebpackPlugin(
      {
        cacheId:&apos;my-project-name&apos;,
        dontCacheBustUrlsMatching:/\.\w{8}\./,
        filename:&apos;service-worker.js&apos;,
        minify:true,
        navigateFallback:PUBLIC_PATH+&apos;index.html&apos;,
        staticFileGlobsIgnorePatterns: [/\.map$/,/asset-manifest\.json$/],
      }
    ),
  ],
}
</code></pre><p>åœ¨æ‰§è¡Œ<code>webpack</code>æ‰“åŒ…åï¼Œä¼šç”Ÿæˆä¸€ä¸ªåä¸º<code>service-worker.js</code>æ–‡ä»¶ï¼Œç”¨äºç¼“å­˜<code>webpack</code>æ‰“åŒ…åçš„é™æ€æ–‡ä»¶ã€‚</p>
<p>ä¸€ä¸ªæœ€ç®€å•çš„<a href="https://github.com/goldhand/sw-precache-webpack-plugin/tree/master/examples" target="_blank" rel="noopener">ç¤ºä¾‹</a>ã€‚</p>
<h2 id="Service-Worker-Cache-VS-Http-Cache"><a href="#Service-Worker-Cache-VS-Http-Cache" class="headerlink" title="Service Worker Cache VS Http Cache"></a><code>Service Worker Cache</code> VS <code>Http Cache</code></h2><p>å¯¹æ¯”èµ·<code>Http Header</code>ç¼“å­˜ï¼Œ<code>Service Worker</code>é…åˆ<code>Cache Storage</code>ä¹Ÿæœ‰è‡ªå·±çš„ä¼˜åŠ¿ï¼š</p>
<ol>
<li>ç¼“å­˜ä¸æ›´æ–°å¹¶å­˜ï¼šæ¯æ¬¡æ›´æ–°ç‰ˆæœ¬ï¼Œå€ŸåŠ©<code>Service Worker</code>å¯ä»¥ç«‹é©¬ä½¿ç”¨ç¼“å­˜è¿”å›ï¼Œä½†ä¸æ­¤åŒæ—¶å¯ä»¥å‘èµ·è¯·æ±‚ï¼Œæ ¡éªŒæ˜¯å¦æœ‰æ–°ç‰ˆæœ¬æ›´æ–°ã€‚</li>
<li>æ— ä¾µå…¥å¼ï¼š<code>hash</code>å€¼å®åœ¨æ˜¯å¤ªéš¾çœ‹äº†ã€‚</li>
<li>ä¸æ˜“è¢«å†²æ‰ï¼š<code>Http</code>ç¼“å­˜å®¹æ˜“è¢«å†²æ‰ï¼Œä¹Ÿå®¹æ˜“è¿‡æœŸï¼Œè€Œ<code>Cache Storage</code>åˆ™ä¸å®¹æ˜“è¢«å†²æ‰ã€‚ä¹Ÿæ²¡æœ‰è¿‡æœŸæ—¶é—´çš„è¯´æ³•ã€‚</li>
<li>ç¦»çº¿ï¼šå€ŸåŠ©<code>Service Worker</code>å¯ä»¥å®ç°ç¦»çº¿è®¿é—®åº”ç”¨ã€‚</li>
</ol>
<p>ä½†æ˜¯ç¼ºç‚¹æ˜¯ï¼Œç”±äº<code>Service Worker</code>ä¾èµ–äº<code>fetch API</code>ã€ä¾èµ–äº<code>Promise</code>ã€<code>Cache Storage</code>ç­‰ï¼Œå…¼å®¹æ€§ä¸å¤ªå¥½ã€‚</p>
<h2 id="åè¯"><a href="#åè¯" class="headerlink" title="åè¯"></a>åè¯</h2><p>æœ¬æ–‡åªæ˜¯ç®€å•æ€»ç»“äº†<code>Service Worker</code>çš„åŸºæœ¬ä½¿ç”¨å’Œä½¿ç”¨<code>Service Worker</code>åšå®¢æˆ·ç«¯ç¼“å­˜çš„ç®€å•æ–¹å¼ï¼Œç„¶è€Œï¼Œ<code>Service Worker</code>çš„ä½œç”¨è¿œä¸æ­¢äºæ­¤ï¼Œä¾‹å¦‚ï¼šå€ŸåŠ©<code>Service Worker</code>åšç¦»çº¿åº”ç”¨ã€ç”¨äºåšç½‘ç»œåº”ç”¨çš„æ¨é€ï¼ˆå¯å‚è€ƒ<a href="https://developers.google.com/web/fundamentals/codelabs/push-notifications/" target="_blank" rel="noopener">push-notifications</a>ï¼‰ç­‰ã€‚</p>
<p>ç”šè‡³å¯ä»¥å€ŸåŠ©<code>Service Worker</code>ï¼Œå¯¹æ¥å£è¿›è¡Œç¼“å­˜ï¼Œåœ¨æˆ‘æ‰€åœ¨çš„é¡¹ç›®ä¸­ï¼Œå…¶å®å¹¶ä¸ä¼šåšçš„è¿™ä¹ˆå¤æ‚ã€‚ä¸è¿‡åšæ¥å£ç¼“å­˜çš„å¥½å¤„æ˜¯æ”¯æŒç¦»çº¿è®¿é—®ï¼Œå¯¹ç¦»çº¿çŠ¶æ€ä¸‹ä¹Ÿèƒ½æ­£å¸¸è®¿é—®æˆ‘ä»¬çš„<code>Web</code>åº”ç”¨ã€‚</p>
<p><code>Cache Storage</code>å’Œ<code>Service Worker</code>æ€»æ˜¯åˆ†ä¸å¼€çš„ã€‚<code>Service Worker</code>çš„æœ€ä½³ç”¨æ³•å…¶å®å°±æ˜¯é…åˆ<code>Cache Storage</code>åšç¦»çº¿ç¼“å­˜ã€‚å€ŸåŠ©äº<code>Service Worker</code>ï¼Œå¯ä»¥è½»æ¾å®ç°å¯¹ç½‘ç»œè¯·æ±‚çš„æ§åˆ¶ï¼Œå¯¹äºä¸åŒçš„ç½‘ç»œè¯·æ±‚ï¼Œé‡‡å–ä¸åŒçš„ç­–ç•¥ã€‚ä¾‹å¦‚å¯¹äº<code>Cache</code>çš„ç­–ç•¥ï¼Œå…¶å®ä¹Ÿæ˜¯å­˜åœ¨å¤šç§æƒ…å†µã€‚ä¾‹å¦‚å¯ä»¥ä¼˜å…ˆä½¿ç”¨ç½‘ç»œè¯·æ±‚ï¼Œåœ¨ç½‘ç»œè¯·æ±‚å¤±è´¥æ—¶å†ä½¿ç”¨ç¼“å­˜ã€äº¦å¯ä»¥åŒæ—¶ä½¿ç”¨ç¼“å­˜å’Œç½‘ç»œè¯·æ±‚ï¼Œä¸€æ–¹é¢æ£€æŸ¥è¯·æ±‚ï¼Œä¸€æ–¹é¢æœ‰æ£€æŸ¥ç¼“å­˜ï¼Œç„¶åçœ‹ä¸¤ä¸ªè°å¿«ï¼Œå°±ç”¨è°ã€‚</p>
<hr>
<h2 id="Progressive-Web-Appsï¼ˆPWAï¼‰"><a href="#Progressive-Web-Appsï¼ˆPWAï¼‰" class="headerlink" title="Progressive Web Appsï¼ˆPWAï¼‰"></a>Progressive Web Appsï¼ˆPWAï¼‰</h2><p><code>Progressive Web App</code>, ç®€ç§° PWAï¼Œæ˜¯æå‡<code>Web App</code>çš„ä½“éªŒçš„ä¸€ç§æ–°æ–¹æ³•ï¼Œèƒ½ç»™ç”¨æˆ·åŸç”Ÿåº”ç”¨çš„ä½“éªŒã€‚</p>
<p><code>PWA</code>èƒ½åšåˆ°åŸç”Ÿåº”ç”¨çš„ä½“éªŒä¸æ˜¯é ç‰¹æŒ‡æŸä¸€é¡¹æŠ€æœ¯ï¼Œè€Œæ˜¯ç»è¿‡åº”ç”¨ä¸€äº›æ–°æŠ€æœ¯è¿›è¡Œæ”¹è¿›ï¼Œåœ¨å®‰å…¨ã€æ€§èƒ½å’Œä½“éªŒä¸‰ä¸ªæ–¹é¢éƒ½æœ‰å¾ˆå¤§æå‡ï¼Œ<code>PWA</code>æœ¬è´¨ä¸Šæ˜¯<code>Web App</code>ï¼Œå€ŸåŠ©ä¸€äº›æ–°æŠ€æœ¯ä¹Ÿå…·å¤‡äº†<code>Native App</code>çš„ä¸€äº›ç‰¹æ€§ï¼Œå…¼å…·<code>Web App</code>å’Œ<code>Native App</code>çš„ä¼˜ç‚¹ã€‚</p>
<p><code>PWA</code>çš„ä¸»è¦ç‰¹ç‚¹åŒ…æ‹¬ä¸‹é¢ä¸‰ç‚¹ï¼š</p>
<p>å¯é  - å³ä½¿åœ¨ä¸ç¨³å®šçš„ç½‘ç»œç¯å¢ƒä¸‹ï¼Œä¹Ÿèƒ½ç¬é—´åŠ è½½å¹¶å±•ç°</p>
<p>ä½“éªŒ - å¿«é€Ÿå“åº”ï¼Œå¹¶ä¸”æœ‰å¹³æ»‘çš„åŠ¨ç”»å“åº”ç”¨æˆ·çš„æ“ä½œ</p>
<p>ç²˜æ€§ - åƒè®¾å¤‡ä¸Šçš„åŸç”Ÿåº”ç”¨ï¼Œå…·æœ‰æ²‰æµ¸å¼çš„ç”¨æˆ·ä½“éªŒï¼Œç”¨æˆ·å¯ä»¥æ·»åŠ åˆ°æ¡Œé¢<br><code>PWA</code>æœ¬èº«å¼ºè°ƒæ¸è¿›å¼ï¼Œå¹¶ä¸è¦æ±‚ä¸€æ¬¡æ€§è¾¾åˆ°å®‰å…¨ã€æ€§èƒ½å’Œä½“éªŒä¸Šçš„æ‰€æœ‰è¦æ±‚ï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡<a href="https://developers.google.cn/web/progressive-web-apps/checklist" target="_blank" rel="noopener">PWA Checklist</a>æŸ¥çœ‹ç°æœ‰çš„ç‰¹å¾ã€‚</p>
<p>é€šè¿‡ä¸Šé¢çš„<code>PWA Checklist</code>ï¼Œæ€»ç»“èµ·æ¥ï¼Œ<code>PWA</code>å¤§è‡´æœ‰ä»¥ä¸‹çš„ä¼˜åŠ¿ï¼š</p>
<ul>
<li>ä½“éªŒï¼šé€šè¿‡<code>Service Worker</code>é…åˆ<code>Cache Storage API</code>ï¼Œä¿è¯äº†<code>PWA</code>é¦–å±çš„åŠ è½½æ•ˆç‡ï¼Œç”šè‡³é…åˆæœ¬åœ°å­˜å‚¨å¯ä»¥æ”¯æŒç¦»çº¿åº”ç”¨ï¼›</li>
<li>ç²˜æ€§ï¼š<code>PWA</code>æ˜¯å¯ä»¥å®‰è£…çš„ï¼Œç”¨æˆ·ç‚¹å‡»å®‰è£…åˆ°æ¡Œé¢åï¼Œä¼šåœ¨æ¡Œé¢åˆ›å»ºä¸€ä¸ª PWA åº”ç”¨ï¼Œå¹¶ä¸”ä¸éœ€è¦ä»åº”ç”¨å•†åº—ä¸‹è½½ï¼Œå¯ä»¥å€ŸåŠ©<code>Web App Manifest</code>æä¾›ç»™ç”¨æˆ·å’Œ<code>Native App</code>ä¸€æ ·çš„æ²‰æµ¸å¼ä½“éªŒï¼Œå¯ä»¥é€šè¿‡ç»™ç”¨æˆ·å‘é€ç¦»çº¿é€šçŸ¥ï¼Œè®©ç”¨æˆ·å›æµï¼›</li>
<li>æ¸è¿›å¼ï¼šé€‚ç”¨äºå¤§å¤šæ•°ç°ä»£æµè§ˆå™¨ï¼Œéšç€æµè§ˆå™¨ç‰ˆæœ¬çš„è¿­ä»£ï¼Œå…¶åŠŸèƒ½æ˜¯æ¸è¿›å¢å¼ºçš„ï¼›</li>
<li>æ— ç‰ˆæœ¬é—®é¢˜ï¼šå¦‚<code>Web</code>åº”ç”¨çš„ä¼˜åŠ¿ï¼Œæ›´æ–°ç‰ˆæœ¬åªéœ€è¦æ›´æ–°åº”ç”¨ç¨‹åºå¯¹åº”çš„é™æ€æ–‡ä»¶å³å¯ï¼Œ<code>Service Worker</code>ä¼šå¸®åŠ©æˆ‘ä»¬è¿›è¡Œæ›´æ–°ï¼›</li>
<li>è·¨å¹³å°ï¼š<code>Windows</code>ã€<code>Mac OSX</code>ã€<code>Android</code>ã€<code>IOS</code>ï¼Œä¸€å¥—ä»£ç ï¼Œå¤šå¤„ä½¿ç”¨ï¼›</li>
<li>æ¶ˆæ¯æ¨é€ï¼šå³ä½¿ç”¨æˆ·å·²ç»å…³é—­åº”ç”¨ç¨‹åºï¼Œä»ç„¶å¯ä»¥å¯¹ç”¨æˆ·è¿›è¡Œæ¶ˆæ¯æ¨é€ï¼›</li>
</ul>
<p>æ€»çš„è¯´æ¥ï¼Œåªè¦<code>Web</code>åº”ç”¨æ”¯æŒçš„åŠŸèƒ½ï¼Œå¯¹äº<code>PWA</code>è€Œè¨€ï¼ŒåŸºæœ¬éƒ½æ”¯æŒï¼Œæ­¤å¤–ï¼Œè¿˜æä¾›äº†åŸç”Ÿèƒ½åŠ›ã€‚</p>
<h3 id="ä½¿ç”¨PWA-manifestæ·»åŠ æ¡Œé¢å…¥å£"><a href="#ä½¿ç”¨PWA-manifestæ·»åŠ æ¡Œé¢å…¥å£" class="headerlink" title="ä½¿ç”¨PWA manifestæ·»åŠ æ¡Œé¢å…¥å£"></a>ä½¿ç”¨<code>PWA manifest</code>æ·»åŠ æ¡Œé¢å…¥å£</h3><p>æ³¨æ„è¿™é‡Œè¯´çš„<code>manifest</code>ä¸æ˜¯æŒ‡çš„<code>manifest</code>ç¼“å­˜ï¼Œè¿™ä¸ª<code>manifest</code>æ˜¯ä¸€ä¸ª<code>JSON</code>æ–‡ä»¶ï¼Œå¼€å‘è€…å¯ä»¥åˆ©ç”¨å®ƒæ§åˆ¶åœ¨ç”¨æˆ·æƒ³è¦çœ‹åˆ°åº”ç”¨çš„åŒºåŸŸï¼ˆä¾‹å¦‚ç§»åŠ¨è®¾å¤‡ä¸»å±å¹•ï¼‰ä¸­å¦‚ä½•å‘ç”¨æˆ·æ˜¾ç¤ºç½‘ç»œåº”ç”¨æˆ–ç½‘ç«™ï¼ŒæŒ‡ç¤ºç”¨æˆ·å¯ä»¥å¯åŠ¨å“ªäº›åŠŸèƒ½ï¼Œä»¥åŠå®šä¹‰å…¶åœ¨å¯åŠ¨æ—¶çš„å¤–è§‚ã€‚</p>
<p><code>manifest</code>æä¾›äº†å°†ç½‘ç«™ä¹¦ç­¾ä¿å­˜åˆ°è®¾å¤‡ä¸»å±å¹•çš„åŠŸèƒ½ã€‚å½“ç½‘ç«™ä»¥è¿™ç§æ–¹å¼å¯åŠ¨æ—¶ï¼š</p>
<ul>
<li>å®ƒå…·æœ‰å”¯ä¸€çš„å›¾æ ‡å’Œåç§°ï¼Œä»¥ä¾¿ç”¨æˆ·å°†å…¶ä¸å…¶ä»–ç½‘ç«™åŒºåˆ†å¼€æ¥ã€‚</li>
<li>å®ƒä¼šåœ¨ä¸‹è½½èµ„æºæˆ–ä»ç¼“å­˜æ¢å¤èµ„æºæ—¶å‘ç”¨æˆ·æ˜¾ç¤ºæŸäº›ä¿¡æ¯ã€‚</li>
<li>å®ƒä¼šå‘æµè§ˆå™¨æä¾›é»˜è®¤æ˜¾ç¤ºç‰¹æ€§ï¼Œä»¥é¿å…ç½‘ç«™èµ„æºå¯ç”¨æ—¶çš„è¿‡æ¸¡è¿‡äºç”Ÿç¡¬ã€‚</li>
</ul>
<p>ä¸‹é¢æ˜¯æˆ‘çš„åšå®¢ç½‘ç«™çš„<code>manifest.json</code>æ–‡ä»¶ï¼Œä½œä¸ºæ¡Œé¢å…¥å£é…ç½®æ–‡ä»¶çš„ç¤ºä¾‹ï¼š</p>
<pre><code>{
  &quot;name&quot;: &quot;Counterxing&quot;,
  &quot;short_name&quot;: &quot;Counterxing&quot;,
  &quot;description&quot;: &quot;Why did you encounter me?&quot;,
  &quot;start_url&quot;: &quot;/index.html&quot;,
  &quot;display&quot;: &quot;standalone&quot;,
  &quot;orientation&quot;: &quot;any&quot;,
  &quot;background_color&quot;: &quot;#ACE&quot;,
  &quot;theme_color&quot;: &quot;#ACE&quot;,
  &quot;icons&quot;: [{
    &quot;src&quot;: &quot;/images/logo/logo072.png&quot;,
    &quot;sizes&quot;: &quot;72x72&quot;,
    &quot;type&quot;: &quot;image/png&quot;
  }, {
    &quot;src&quot;: &quot;/images/logo/logo152.png&quot;,
    &quot;sizes&quot;: &quot;152x152&quot;,
    &quot;type&quot;: &quot;image/png&quot;
  }, {
    &quot;src&quot;: &quot;/images/logo/logo192.png&quot;,
    &quot;sizes&quot;: &quot;192x192&quot;,
    &quot;type&quot;: &quot;image/png&quot;
  }, {
    &quot;src&quot;: &quot;/images/logo/logo256.png&quot;,
    &quot;sizes&quot;: &quot;256x256&quot;,
    &quot;type&quot;: &quot;image/png&quot;
  }, {
    &quot;src&quot;: &quot;/images/logo/logo512.png&quot;,
    &quot;sizes&quot;: &quot;512x512&quot;,
    &quot;type&quot;: &quot;image/png&quot;
  }]
}
</code></pre><p>ä¸Šé¢çš„å­—æ®µå«ä¹‰ä¹Ÿä¸ç”¨å¤šè§£é‡Šäº†ï¼Œå¤§è‡´å°±æ˜¯å¯åŠ¨çš„<code>icon</code>æ ·å¼ï¼Œåº”ç”¨åç§°ã€ç®€å†™åç§°ä¸æè¿°ç­‰ï¼Œå…¶ä¸­å¿…é¡»ç¡®ä¿æœ‰<code>short_name</code>å’Œ<code>name</code>ã€‚æ­¤å¤–ï¼Œæœ€å¥½è®¾å®šå¥½<code>start_url</code>ï¼Œè¡¨ç¤ºå¯åŠ¨çš„æ ¹é¡µé¢è·¯å¾„ï¼Œå¦‚æœä¸æ·»åŠ ï¼Œåˆ™æ˜¯ä½¿ç”¨å½“å‰è·¯å¾„ã€‚</p>
<p><code>display</code>ä¸º<code>standalone</code>ï¼Œåˆ™ä¼šéšè—æµè§ˆå™¨çš„<code>UI</code>ç•Œé¢ï¼Œå¦‚æœè®¾ç½®<code>display</code>ä¸º<code>browser</code>ï¼Œåˆ™å¯åŠ¨æ—¶ä¿å­˜æµè§ˆå™¨çš„<code>UI</code>ç•Œé¢ã€‚</p>
<p><code>orientation</code>è¡¨ç¤ºå¯åŠ¨æ—¶çš„æ–¹å‘ï¼Œæ¨ªå±ã€ç«–å±ç­‰ï¼Œå…·ä½“å‚æ•°å€¼å¯å‚è€ƒ<a href="https://developer.mozilla.org/en-US/docs/Web/Manifest" target="_blank" rel="noopener">æ–‡æ¡£</a>ã€‚</p>
<p><code>background_color</code>å’Œ<code>theme_color</code>è¡¨ç¤ºåº”ç”¨ç¨‹åºçš„èƒŒæ™¯é¢œè‰²å’Œä¸»é¢˜é¢œè‰²ã€‚</p>
<p>åœ¨åˆ›å»ºå¥½<code>manifest.json</code>åï¼Œå°†ã€ä½¿ç”¨<code>link</code>æ ‡ç­¾æ·»åŠ åˆ°åº”ç”¨ç¨‹åºçš„æ‰€æœ‰é¡µé¢ä¸Šï¼Œ<code>&lt;link rel=&quot;manifest&quot; href=&quot;/manifest.json&quot;&gt;</code></p>
<h3 id="å®‰è£…åˆ°æ¡Œé¢"><a href="#å®‰è£…åˆ°æ¡Œé¢" class="headerlink" title="å®‰è£…åˆ°æ¡Œé¢"></a>å®‰è£…åˆ°æ¡Œé¢</h3><h4 id="æ¡Œé¢ç«¯ï¼ˆä»¥Mac-OSXä¸ºä¾‹ï¼‰"><a href="#æ¡Œé¢ç«¯ï¼ˆä»¥Mac-OSXä¸ºä¾‹ï¼‰" class="headerlink" title="æ¡Œé¢ç«¯ï¼ˆä»¥Mac OSXä¸ºä¾‹ï¼‰"></a>æ¡Œé¢ç«¯ï¼ˆä»¥<code>Mac OSX</code>ä¸ºä¾‹ï¼‰</h4><p>åªæœ‰æ³¨å†Œã€æ¿€æ´»äº†<code>Service Worker</code>çš„ç½‘ç«™æ‰èƒ½å¤Ÿå®‰è£…åˆ°æ¡Œé¢ï¼Œåœ¨<code>Chrome 70</code>ç‰ˆæœ¬ä¹‹å‰ï¼Œéœ€è¦æ‰‹åŠ¨å¼€å¯å®éªŒæ€§åŠŸèƒ½ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>è¿›å…¥<code>chrome://flags</code></li>
<li>æ‰¾åˆ°<code>Desktop PWAs</code>ï¼Œé€‰æ‹©<code>Enabled</code></li>
</ol>
<p><img src="/2017/11/14/Service-Worker-PWA/4.webp" alt=""><br>æ­¤æ—¶ï¼Œè¿›å…¥ä¸€ä¸ªæ”¯æŒ<code>PWA</code>çš„ç½‘ç«™ï¼ˆä¾‹å¦‚<a href="https://events.google.com/io2016/" target="_blank" rel="noopener">Google I/O</a>ï¼‰ï¼Œåœ¨<code>Chrome</code>æµè§ˆå™¨å³ä¸Šè§’ï¼Œç‚¹å‡»å®‰è£…ã€‚å³å¯å®‰è£…åˆ°æ¡Œé¢ã€‚è¿™é‡Œä»¥æˆ‘çš„åšå®¢ä¸ºä¾‹ï¼š</p>
<blockquote>
<p>å¯ä»¥åˆ°<a href="https://github.com/hemanth/awesome-pwa" target="_blank" rel="noopener">awesome-pwa</a>æŸ¥æ‰¾ç›®å‰æ”¯æŒ<code>PWA</code>çš„ç½‘ç«™åˆ—è¡¨</p>
</blockquote>
<p><img src="/2017/11/14/Service-Worker-PWA/5.webp" alt=""><br>æ¥ç€ç‚¹å‡»å®‰è£…ï¼š</p>
<p><img src="/2017/11/14/Service-Worker-PWA/6.webp" alt=""><br>è¿™æ ·ï¼Œä¸€ä¸ª<code>PWA</code>åº”ç”¨å°±å®‰è£…åˆ°ä½ çš„æœºå™¨ä¸Šäº†ï¼Œè¿™é‡Œæˆ‘çš„æ“ä½œç³»ç»Ÿä¸º<code>Mac OSX</code>ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡<code>Launchpad</code>æ‰“å¼€ï¼Œåœ¨<code>Windows</code>ä¹Ÿæ˜¯åŒç†çš„ï¼Œä¼šè¢«å®‰è£…åˆ°æ¡Œé¢ä¸Šï¼Œå¯é€šè¿‡å¼€å§‹èœå•æ‰¾åˆ°åº”ç”¨ç¨‹åºã€‚</p>
<p><img src="/2017/11/14/Service-Worker-PWA/7.webp" alt=""><br>æ‰“å¼€åº”ç”¨ç¨‹åºï¼Œå‘ç°å…¶ä¸åŸå§‹åº”ç”¨å‡ ä¹æ²¡æœ‰ä»»ä½•å·®è·ï¼š</p>
<p><img src="/2017/11/14/Service-Worker-PWA/8.webp" alt=""></p>
<blockquote>
<p>Windowsä¸ä¸Šè¿°æ–¹æ³•ç±»ä¼¼ï¼Œè¿™é‡Œå°±ä¸åšè¿‡å¤šé˜è¿°</p>
</blockquote>
<h4 id="ç§»åŠ¨ç«¯ï¼ˆä»¥IOSä¸ºä¾‹ï¼‰"><a href="#ç§»åŠ¨ç«¯ï¼ˆä»¥IOSä¸ºä¾‹ï¼‰" class="headerlink" title="ç§»åŠ¨ç«¯ï¼ˆä»¥IOSä¸ºä¾‹ï¼‰"></a>ç§»åŠ¨ç«¯ï¼ˆä»¥<code>IOS</code>ä¸ºä¾‹ï¼‰</h4><p>ç”±äºå½“åˆè‹¹æœæ¨å‡º<code>PWA</code>æ—¶ï¼Œå¹¶æ²¡æœ‰ä¸€ä¸ªç»Ÿä¸€çš„<code>manifest</code>çš„è§„èŒƒï¼Œæœ€å¼€å§‹çš„è®¾è®¡æ˜¯é€šè¿‡<code>meta</code>å’Œ<code>link</code>æ ‡ç­¾æ¥è®¾å®šåº”ç”¨çš„å¯¹åº”å‚æ•°çš„ï¼Œæ‰€ä»¥ï¼Œåœ¨ç§»åŠ¨ç«¯ä¸Šçš„<code>PWA</code>åº”ç”¨ï¼Œä¸ºäº†å…¼å®¹<code>Windows Phone</code>å’Œ<code>iPhone</code>ï¼Œéœ€è¦åœ¨æ‰€æœ‰é¡µé¢çš„<code>HTML</code>çš„<code>head</code>ä¸­æ·»åŠ ä»¥ä¸‹çš„æ ‡ç­¾ï¼š</p>
<pre><code>&lt;metaname=&quot;msapplication-TileImage&quot;content=&quot;./images/logo/logo152.png&quot;&gt;
&lt;metaname=&quot;msapplication-TileColor&quot;content=&quot;#2F3BA2&quot;&gt;
&lt;metaname=&quot;apple-mobile-web-app-capable&quot;content=&quot;yes&quot;&gt;
&lt;metaname=&quot;apple-mobile-web-app-status-bar-style&quot;content=&quot;black&quot;&gt;
&lt;metaname=&quot;apple-mobile-web-app-title&quot;content=&quot;Counterxing&quot;&gt;
&lt;linkrel=&quot;apple-touch-icon&quot;href=&quot;./images/logo/logo152.png&quot;&gt;
</code></pre><p>æ·»åŠ å¥½åï¼Œå°±å¯ä»¥ä½“éªŒæˆ‘ä»¬çš„<code>PWA</code>äº†ï¼</p>
<p><code>IOS</code>åœ¨<code>11.3</code>ç‰ˆæœ¬ä¹‹åä¹Ÿæ”¯æŒ<code>PWA</code>äº†ï¼ŒçŸ¥é“è¿™ä¸€æ¶ˆæ¯çš„æˆ‘ï¼Œå¸è½½äº†æ‰‹æœºä¸Šå¾ˆå¤šè½¯ä»¶ï¼Œç«‹åˆ»ä½“éªŒä¸Šäº†<code>PWA</code>ã€‚</p>
<p>è¿™é‡Œä»¥<a href="https://m.douban.com" target="_blank" rel="noopener">è±†ç“£ç§»åŠ¨ç«¯</a>ä¸ºä¾‹ä½¿ç”¨<code>Safiri</code>æµè§ˆå™¨æ‰“å¼€ä¸€ä¸ªç½‘ç«™ï¼Œç‚¹å‡»ä¸‹æ–¹åˆ†äº«å›¾æ ‡ï¼Œé€‰æ‹©æ·»åŠ åˆ°ä¸»å±å¹•ã€‚</p>
<p><img src="/2017/11/14/Service-Worker-PWA/9.webp" alt=""><br><img src="/2017/11/14/Service-Worker-PWA/10.webp" alt=""><br>ç„¶ååœ¨æ–°å¼¹å‡ºçš„ä¸€ä¸ªæµè§ˆå™¨é¡µé¢ï¼Œé€‰æ‹©æ·»åŠ ï¼š</p>
<p><img src="/2017/11/14/Service-Worker-PWA/11.webp" alt=""><br>å°±ä»¥ä¸Šç®€çŸ­çš„æ­¥éª¤ï¼Œç§»åŠ¨ç«¯ä¸Šçš„ä¸€ä¸ª<code>PWA</code>æ¡Œé¢åº”ç”¨å°±æ·»åŠ å¥½äº†ï¼Œèµ¶ç´§ä½“éªŒå§ï¼</p>
<h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>æœ¬æ–‡æ˜¯ç¬”è€…å†™çš„<code>Service Worker</code>å­¦ä¹ ä¸å®è·µç³»åˆ—æ–‡ç« çš„ç¬¬äºŒç¯‡ï¼Œä¸»è¦è®²è¿°çš„æ˜¯é…åˆ<code>Service Worker</code>ä½¿ç”¨çš„<code>PWA</code>çš„ä¼˜åŠ¿ï¼Œå¦‚ä½•é…ç½®<code>manifest.json</code>æ–‡ä»¶æ¥å®ç°å°†<code>PWA</code>å®‰è£…åˆ°æ¡Œé¢ï¼Œå¹¶é€šè¿‡<code>Mac OSX</code>å’Œ<code>IOS</code>å¦‚ä½•å®‰è£…<code>PWA</code>åˆ°æ¡Œé¢çš„è¯¦ç»†æ­¥éª¤ï¼Œé˜è¿°äº†å¦‚ä½•é…ç½®<code>PWA</code>ï¼Œä½¿å…¶æ–¹ä¾¿åœ°å®‰è£…åˆ°æ¡Œé¢ä¸Šã€‚</p>
<p>ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œä¸»è¦è®²è¿°<code>Service Worker</code>åœ¨<code>PWA</code>å®è·µä¸­çš„é‡è¦èƒ½åŠ›ï¼š<code>Web Push</code>ã€‚</p>
<hr>
<h2 id="Notification"><a href="#Notification" class="headerlink" title="Notification"></a>Notification</h2><p>è¯´åˆ°åº•ï¼Œ<code>PWA</code>çš„æ¶ˆæ¯æ¨é€ä¹Ÿæ˜¯æœåŠ¡ç«¯æ¨é€çš„ä¸€ç§ï¼Œå¸¸è§çš„æœåŠ¡ç«¯æ¨é€æ–¹æ³•ï¼Œä¾‹å¦‚å¹¿æ³›ä½¿ç”¨çš„è½®è¯¢ã€é•¿è½®è¯¢ã€<code>Web Socket</code>ç­‰ï¼Œè¯´åˆ°åº•ï¼Œéƒ½æ˜¯å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¹‹é—´çš„é€šä¿¡ï¼Œåœ¨<code>Service Worker</code>ä¸­ï¼Œå®¢æˆ·ç«¯æ¥æ”¶åˆ°é€šçŸ¥ï¼Œæ˜¯åŸºäº<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/notification" target="_blank" rel="noopener">Notification</a>æ¥è¿›è¡Œæ¨é€çš„ã€‚</p>
<p>é‚£ä¹ˆï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ï¼Œå¦‚ä½•ç›´æ¥ä½¿ç”¨<code>Notification</code>æ¥å‘é€ä¸€æ¡æ¨é€å‘¢ï¼Ÿä¸‹é¢æ˜¯ä¸€æ®µç¤ºä¾‹ä»£ç ï¼š</p>
<pre><code>// åœ¨ä¸»çº¿ç¨‹ä¸­ä½¿ç”¨let notification =newNotification(&apos;æ‚¨æœ‰æ–°æ¶ˆæ¯&apos;, {
  body:&apos;Hello Service Worker&apos;,
  icon:&apos;./images/logo/logo152.png&apos;,
});

notification.onclick=function() {
  console.log(&apos;ç‚¹å‡»äº†&apos;);
};
</code></pre><p>åœ¨æ§åˆ¶å°æ•²ä¸‹ä¸Šè¿°ä»£ç åï¼Œåˆ™ä¼šå¼¹å‡ºä»¥ä¸‹é€šçŸ¥ï¼š</p>
<p><img src="/2017/11/14/Service-Worker-PWA/12.webp" alt=""><br>ç„¶è€Œï¼Œ<code>Notification</code>è¿™ä¸ª<code>API</code>ï¼Œåªæ¨èåœ¨<code>Service Worker</code>ä¸­ä½¿ç”¨ï¼Œä¸æ¨èåœ¨ä¸»çº¿ç¨‹ä¸­ä½¿ç”¨ï¼Œåœ¨<code>Service Worker</code>ä¸­çš„ä½¿ç”¨æ–¹æ³•ä¸ºï¼š</p>
<pre><code>// æ·»åŠ notificationclickäº‹ä»¶ç›‘å¬å™¨ï¼Œåœ¨ç‚¹å‡»notificationæ—¶è§¦å‘self.addEventListener(&apos;notificationclick&apos;, function(event) {
  // å…³é—­å½“å‰çš„å¼¹çª—event.notification.close();
  // åœ¨æ–°çª—å£æ‰“å¼€é¡µé¢event.waitUntil(
    clients.openWindow(&apos;https://google.com&apos;)
  );
});

// è§¦å‘ä¸€æ¡é€šçŸ¥self.registration.showNotification(&apos;æ‚¨æœ‰æ–°æ¶ˆæ¯&apos;, {
  body:&apos;Hello Service Worker&apos;,
  icon:&apos;./images/logo/logo152.png&apos;,
});
</code></pre><p>è¯»è€…å¯ä»¥åœ¨<a href="https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorkerRegistration/showNotification" target="_blank" rel="noopener">MDN Web Docs</a>å…³äº<code>Notification</code>åœ¨<code>Service Worker</code>ä¸­çš„ç›¸å…³ç”¨æ³•ï¼Œåœ¨æœ¬æ–‡å°±ä¸æµªè´¹å¤§é‡ç¯‡å¹…æ¥è¿›è¡Œè¾ƒä¸ºè¯¦ç»†çš„é˜è¿°äº†ã€‚</p>
<h2 id="ç”³è¯·æ¨é€çš„æƒé™"><a href="#ç”³è¯·æ¨é€çš„æƒé™" class="headerlink" title="ç”³è¯·æ¨é€çš„æƒé™"></a>ç”³è¯·æ¨é€çš„æƒé™</h2><p>å¦‚æœæµè§ˆå™¨ç›´æ¥ç»™æ‰€æœ‰å¼€å‘è€…å¼€æ”¾å‘ç”¨æˆ·æ¨é€é€šçŸ¥çš„æƒé™ï¼Œé‚£ä¹ˆåŠ¿å¿…ç”¨æˆ·ä¼šå—åˆ°å¤§é‡åƒåœ¾ä¿¡æ¯çš„éªšæ‰°ï¼Œå› æ­¤è¿™ä¸€æƒé™æ˜¯éœ€è¦ç”³è¯·çš„ï¼Œå¦‚æœç”¨æˆ·ç¦æ­¢äº†æ¶ˆæ¯æ¨é€ï¼Œå¼€å‘è€…æ˜¯æ²¡æœ‰æƒåˆ©å‘ç”¨æˆ·å‘èµ·æ¶ˆæ¯æ¨é€çš„ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡<a href="https://developer.mozilla.org/en-US/docs/Web/API/PushManager" target="_blank" rel="noopener">serviceWorkerRegistration.pushManager.getSubscription</a>æ–¹æ³•æŸ¥çœ‹ç”¨æˆ·æ˜¯å¦å·²ç»å…è®¸æ¨é€é€šçŸ¥çš„æƒé™ã€‚ä¿®æ”¹<code>sw-register.js</code>ä¸­çš„ä»£ç ï¼š</p>
<pre><code>if (&apos;serviceWorker&apos;innavigator) {
  navigator.serviceWorker.register(&apos;/sw.js&apos;).then(function (swReg) {
    swReg.pushManager.getSubscription()
      .then(function(subscription) {
        if (subscription) {
          console.log(JSON.stringify(subscription));
        } else {
          console.log(&apos;æ²¡æœ‰è®¢é˜…&apos;);
          subscribeUser(swReg);
        }
      });
  });
}
</code></pre><p>ä¸Šé¢çš„ä»£ç è°ƒç”¨äº†<code>swReg.pushManager</code>çš„<code>getSubscription</code>ï¼Œå¯ä»¥çŸ¥é“ç”¨æˆ·æ˜¯å¦å·²ç»å…è®¸è¿›è¡Œæ¶ˆæ¯æ¨é€ï¼Œå¦‚æœ<code>swReg.pushManager.getSubscription</code>çš„<code>Promise</code>è¢«<code>reject</code>äº†ï¼Œåˆ™è¡¨ç¤ºç”¨æˆ·è¿˜æ²¡æœ‰è®¢é˜…æˆ‘ä»¬çš„æ¶ˆæ¯ï¼Œè°ƒç”¨<code>subscribeUser</code>æ–¹æ³•ï¼Œå‘ç”¨æˆ·ç”³è¯·æ¶ˆæ¯æ¨é€çš„æƒé™ï¼š</p>
<pre><code>functionsubscribeUser(swReg) {
  constapplicationServerKey=urlB64ToUint8Array(applicationServerPublicKey);
  swReg.pushManager.subscribe({
    userVisibleOnly:true,
    applicationServerKey: applicationServerKey
  })
  .then(function(subscription) {
    console.log(JSON.stringify(subscription));
  })
  .catch(function(err) {
    console.log(&apos;è®¢é˜…å¤±è´¥: &apos;, err);
  });
}
</code></pre><p>ä¸Šé¢çš„ä»£ç é€šè¿‡<a href="https://developer.mozilla.org/en-US/docs/Web/API/PushManager" target="_blank" rel="noopener">serviceWorkerRegistration.pushManager.subscribe</a>å‘ç”¨æˆ·å‘èµ·è®¢é˜…çš„æƒé™ï¼Œè¿™ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ª<code>Promise</code>ï¼Œå¦‚æœ<code>Promise</code>è¢«<code>resolve</code>ï¼Œåˆ™è¡¨ç¤ºç”¨æˆ·å…è®¸åº”ç”¨ç¨‹åºæ¨é€æ¶ˆæ¯ï¼Œåä¹‹ï¼Œå¦‚æœè¢«<code>reject</code>ï¼Œåˆ™è¡¨ç¤ºç”¨æˆ·æ‹’ç»äº†åº”ç”¨ç¨‹åºçš„æ¶ˆæ¯æ¨é€ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/2017/11/14/Service-Worker-PWA/13.webp" alt=""><br><code>serviceWorkerRegistration.pushManager.subscribe</code>æ–¹æ³•é€šå¸¸éœ€è¦ä¼ é€’ä¸¤ä¸ªå‚æ•°ï¼š</p>
<ul>
<li><code>userVisibleOnly</code>ï¼Œè¿™ä¸ªå‚æ•°é€šå¸¸è¢«è®¾ç½®ä¸º<code>true</code>ï¼Œç”¨æ¥è¡¨ç¤ºåç»­ä¿¡æ¯æ˜¯å¦å±•ç¤ºç»™ç”¨æˆ·ã€‚</li>
<li><p><code>applicationServerKey</code>ï¼Œè¿™ä¸ªå‚æ•°æ˜¯ä¸€ä¸ª<code>Uint8Array</code>ï¼Œç”¨äºåŠ å¯†æœåŠ¡ç«¯çš„æ¨é€ä¿¡æ¯ï¼Œé˜²æ­¢ä¸­é—´äººæ”»å‡»ï¼Œä¼šè¯è¢«æ”»å‡»è€…ç¯¡æ”¹ã€‚è¿™ä¸€å‚æ•°æ˜¯ç”±æœåŠ¡ç«¯ç”Ÿæˆçš„å…¬é’¥ï¼Œé€šè¿‡<code>urlB64ToUint8Array</code>è½¬æ¢çš„ï¼Œè¿™ä¸€å‡½æ•°é€šå¸¸æ˜¯å›ºå®šçš„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>  functionurlB64ToUint8Array(base64String) {</p>
<pre><code>constpadding=&apos;=&apos;.repeat((4-base64String.length%4) %4);
constbase64= (base64String + padding)
  .replace(/\-/g, &apos;+&apos;)
  .replace(/_/g, &apos;/&apos;);

constrawData=window.atob(base64);
constoutputArray=newUint8Array(rawData.length);

for (let i =0; i &lt;rawData.length; ++i) {
  outputArray[i] =rawData.charCodeAt(i);
}
return outputArray;
</code></pre><p>  }</p>
</li>
</ul>
<p>å…³äºæœåŠ¡ç«¯å…¬é’¥å¦‚ä½•è·å–ï¼Œåœ¨æ–‡ç« åç»­ä¼šæœ‰ç›¸å…³é˜è¿°ã€‚</p>
<h2 id="å¤„ç†æ‹’ç»çš„æƒé™"><a href="#å¤„ç†æ‹’ç»çš„æƒé™" class="headerlink" title="å¤„ç†æ‹’ç»çš„æƒé™"></a>å¤„ç†æ‹’ç»çš„æƒé™</h2><p>å¦‚æœåœ¨è°ƒç”¨<code>serviceWorkerRegistration.pushManager.subscribe</code>åï¼Œç”¨æˆ·æ‹’ç»äº†æ¨é€æƒé™ï¼ŒåŒæ ·ä¹Ÿå¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œé€šè¿‡<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/notification/permission" target="_blank" rel="noopener">Notification.permission</a>è·å–åˆ°è¿™ä¸€çŠ¶æ€ï¼Œ<code>Notification.permission</code>æœ‰ä»¥ä¸‹ä¸‰ä¸ªå–å€¼ï¼Œï¼š</p>
<ul>
<li><code>granted</code>ï¼šç”¨æˆ·å·²ç»æ˜ç¡®çš„æˆäºˆäº†æ˜¾ç¤ºé€šçŸ¥çš„æƒé™ã€‚</li>
<li><code>denied</code>ï¼šç”¨æˆ·å·²ç»æ˜ç¡®çš„æ‹’ç»äº†æ˜¾ç¤ºé€šçŸ¥çš„æƒé™ã€‚</li>
<li><p><code>default</code>ï¼šç”¨æˆ·è¿˜æœªè¢«è¯¢é—®æ˜¯å¦æˆæƒï¼Œåœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œè¿™ç§æƒ…å†µä¸‹æƒé™å°†è§†ä¸º<code>denied</code>ã€‚</p>
<p>  if (Notification.permission===â€™grantedâ€™) {</p>
<pre><code>// ç”¨æˆ·å…è®¸æ¶ˆæ¯æ¨é€
</code></pre><p>  } else {</p>
<pre><code>// è¿˜ä¸å…è®¸æ¶ˆæ¯æ¨é€ï¼Œå‘ç”¨æˆ·ç”³è¯·æ¶ˆæ¯æ¨é€çš„æƒé™
</code></pre><p>  }</p>
</li>
</ul>
<h2 id="å¯†é’¥ç”Ÿæˆ"><a href="#å¯†é’¥ç”Ÿæˆ" class="headerlink" title="å¯†é’¥ç”Ÿæˆ"></a>å¯†é’¥ç”Ÿæˆ</h2><p>ä¸Šè¿°ä»£ç ä¸­çš„<code>applicationServerPublicKey</code>é€šå¸¸æƒ…å†µä¸‹æ˜¯ç”±æœåŠ¡ç«¯ç”Ÿæˆçš„å…¬é’¥ï¼Œåœ¨é¡µé¢åˆå§‹åŒ–çš„æ—¶å€™å°±ä¼šè¿”å›ç»™å®¢æˆ·ç«¯ï¼ŒæœåŠ¡ç«¯ä¼šä¿å­˜æ¯ä¸ªç”¨æˆ·å¯¹åº”çš„å…¬é’¥ä¸ç§é’¥ï¼Œä»¥ä¾¿è¿›è¡Œæ¶ˆæ¯æ¨é€ã€‚</p>
<p>åœ¨æˆ‘çš„ç¤ºä¾‹æ¼”ç¤ºä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>Google</code>é…å¥—çš„å®éªŒç½‘ç«™<a href="https://web-push-codelab.glitch.me/" target="_blank" rel="noopener">web-push-codelab</a>ç”Ÿæˆå…¬é’¥ä¸ç§é’¥ï¼Œä»¥ä¾¿å‘é€æ¶ˆæ¯é€šçŸ¥ï¼š</p>
<p><img src="/2017/11/14/Service-Worker-PWA/14.webp" alt=""></p>
<h2 id="å‘é€æ¨é€"><a href="#å‘é€æ¨é€" class="headerlink" title="å‘é€æ¨é€"></a>å‘é€æ¨é€</h2><p>åœ¨<code>Service Worker</code>ä¸­ï¼Œé€šè¿‡ç›‘å¬<code>push</code>äº‹ä»¶æ¥å¤„ç†æ¶ˆæ¯æ¨é€ï¼š</p>
<pre><code>self.addEventListener(&apos;push&apos;, function(event) {
  consttitle=event.data.text();
  constoptions= {
    body:event.data.text(),
    icon:&apos;./images/logo/logo512.png&apos;,
  };

  event.waitUntil(self.registration.showNotification(title, options));
});
</code></pre><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œåœ¨<code>push</code>äº‹ä»¶å›è°ƒä¸­ï¼Œé€šè¿‡<code>event.data.text()</code>æ‹¿åˆ°æ¶ˆæ¯æ¨é€çš„æ–‡æœ¬ï¼Œç„¶åè°ƒç”¨ä¸Šé¢æ‰€è¯´çš„<code>self.registration.showNotification</code>æ¥å±•ç¤ºæ¶ˆæ¯æ¨é€ã€‚</p>
<h2 id="æœåŠ¡ç«¯å‘é€"><a href="#æœåŠ¡ç«¯å‘é€" class="headerlink" title="æœåŠ¡ç«¯å‘é€"></a>æœåŠ¡ç«¯å‘é€</h2><p>é‚£ä¹ˆï¼Œå¦‚ä½•åœ¨æœåŠ¡ç«¯è¯†åˆ«æŒ‡å®šçš„ç”¨æˆ·ï¼Œå‘å…¶å‘é€å¯¹åº”çš„æ¶ˆæ¯æ¨é€å‘¢ï¼Ÿ</p>
<p>åœ¨è°ƒç”¨<code>swReg.pushManager.subscribe</code>æ–¹æ³•åï¼Œå¦‚æœç”¨æˆ·æ˜¯å…è®¸æ¶ˆæ¯æ¨é€çš„ï¼Œé‚£ä¹ˆè¯¥å‡½æ•°è¿”å›çš„<code>Promise</code>å°†ä¼š<code>resolve</code>ï¼Œåœ¨<code>then</code>ä¸­è·å–åˆ°å¯¹åº”çš„<code>subscription</code>ã€‚</p>
<p><code>subscription</code>ä¸€èˆ¬æ˜¯ä¸‹é¢çš„æ ¼å¼ï¼š</p>
<pre><code>{
  &quot;endpoint&quot;: &quot;https://fcm.googleapis.com/fcm/send/cSEJGmI_x2s:APA91bHzRHllE6tNoEHqjHQSlLpcQHeiGr7X78EIa1QrUPFqDGDM_4RVKNxoLPV3_AaCCejR4uwUawBKYcQLmLpUrCUoZetQ9pVzQCJSomB5BvoFZBzkSnUb-ALm4D1lqwV9w_uP3M0E&quot;,
  &quot;expirationTime&quot;: null,
  &quot;keys&quot;: {
    &quot;p256dh&quot;: &quot;BDOx1ZTtsFL2ncSN17Bu7-Wl_1Z7yIiI-lKhtoJ2dAZMToGz-XtQOe6cuMLMa3I8FoqPfcPy232uAqoISB4Z-UU&quot;,
    &quot;auth&quot;: &quot;XGWy-wlmrAw3Be818GLZ8Q&quot;
  }
}
</code></pre><p>ä½¿ç”¨<code>Google</code>é…å¥—çš„å®éªŒç½‘ç«™<a href="https://web-push-codelab.glitch.me/" target="_blank" rel="noopener">web-push-codelab</a>ï¼Œå‘é€æ¶ˆæ¯æ¨é€ã€‚</p>
<p><img src="/2017/11/14/Service-Worker-PWA/15.webp" alt=""></p>
<h2 id="web-push"><a href="#web-push" class="headerlink" title="web-push"></a>web-push</h2><p>åœ¨æœåŠ¡ç«¯ï¼Œä½¿ç”¨<a href="https://github.com/web-push-libs" target="_blank" rel="noopener">web-push-libs</a>ï¼Œå®ç°å…¬é’¥ä¸ç§é’¥çš„ç”Ÿæˆï¼Œæ¶ˆæ¯æ¨é€åŠŸèƒ½ï¼Œ<a href="https://github.com/web-push-libs/web-push" target="_blank" rel="noopener">Node.jsç‰ˆæœ¬</a>ã€‚</p>
<pre><code>constwebpush=require(&apos;web-push&apos;);

// VAPID keys should only be generated only once.constvapidKeys=webpush.generateVAPIDKeys();

webpush.setGCMAPIKey(&apos;&lt;Your GCM API Key Here&gt;&apos;);
webpush.setVapidDetails(
  &apos;mailto:example@yourdomain.org&apos;,
  vapidKeys.publicKey,
  vapidKeys.privateKey
);

// pushSubscriptionæ˜¯å‰ç«¯é€šè¿‡swReg.pushManager.subscribeè·å–åˆ°çš„subscriptionconstpushSubscription= {
  endpoint:&apos;.....&apos;,
  keys: {
    auth:&apos;.....&apos;,
    p256dh:&apos;.....&apos;
  }
};

webpush.sendNotification(pushSubscription, &apos;Your Push Payload Text&apos;);
</code></pre><p>ä¸Šé¢çš„ä»£ç ä¸­ï¼Œ<code>GCM API Key</code>éœ€è¦åœ¨<a href="https://console.firebase.google.com" target="_blank" rel="noopener">Firebase console</a>ä¸­ç”³è¯·ï¼Œç”³è¯·æ•™ç¨‹å¯å‚è€ƒè¿™ç¯‡<a href="https://www.pushbots.help/install-pushbots-in-your-app-or-website/android/the-google-part-fcmgcm-api-key-and-sender-id" target="_blank" rel="noopener">åšæ–‡</a>ã€‚</p>
<p>åœ¨è¿™ä¸ªæˆ‘å†™çš„ç¤ºä¾‹<code>Demo</code>ä¸­ï¼Œæˆ‘æŠŠ<code>subscription</code>å†™æ­»äº†ï¼š</p>
<pre><code>constwebpush=require(&apos;web-push&apos;);

webpush.setVapidDetails(
  &apos;mailto:503908971@qq.com&apos;,
  &apos;BCx1qqSFCJBRGZzPaFa8AbvjxtuJj9zJie_pXom2HI-gisHUUnlAFzrkb-W1_IisYnTcUXHmc5Ie3F58M1uYhZU&apos;,
  &apos;g5pubRphHZkMQhvgjdnVvq8_4bs7qmCrlX-zWAJE9u8&apos;
);

constsubscription= {
  &quot;endpoint&quot;:&quot;https://fcm.googleapis.com/fcm/send/cSEJGmI_x2s:APA91bHzRHllE6tNoEHqjHQSlLpcQHeiGr7X78EIa1QrUPFqDGDM_4RVKNxoLPV3_AaCCejR4uwUawBKYcQLmLpUrCUoZetQ9pVzQCJSomB5BvoFZBzkSnUb-ALm4D1lqwV9w_uP3M0E&quot;,
  &quot;expirationTime&quot;:null,
  &quot;keys&quot;: {
    &quot;p256dh&quot;:&quot;BDOx1ZTtsFL2ncSN17Bu7-Wl_1Z7yIiI-lKhtoJ2dAZMToGz-XtQOe6cuMLMa3I8FoqPfcPy232uAqoISB4Z-UU&quot;,
    &quot;auth&quot;:&quot;XGWy-wlmrAw3Be818GLZ8Q&quot;
  }
};

webpush.sendNotification(subscription, &apos;Counterxing&apos;);
</code></pre><h2 id="äº¤äº’å“åº”"><a href="#äº¤äº’å“åº”" class="headerlink" title="äº¤äº’å“åº”"></a>äº¤äº’å“åº”</h2><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¨é€çš„æ¶ˆæ¯ç‚¹å‡»åæ˜¯æ²¡æœ‰å¯¹åº”çš„äº¤äº’çš„ï¼Œé…åˆ<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Clients" target="_blank" rel="noopener">clients API</a>å¯ä»¥å®ç°ä¸€äº›ç±»ä¼¼äºåŸç”Ÿåº”ç”¨çš„äº¤äº’ï¼Œè¿™é‡Œå‚è€ƒäº†è¿™ç¯‡<a href="https://blog.csdn.net/i10630226/article/details/78888698" target="_blank" rel="noopener">åšæ–‡</a>çš„å®ç°ï¼š</p>
<blockquote>
<p><code>Service Worker</code>ä¸­çš„<code>self.clients</code>å¯¹è±¡æä¾›äº†<code>Client</code>çš„è®¿é—®ï¼Œ<code>Client</code>æ¥å£è¡¨ç¤ºä¸€ä¸ªå¯æ‰§è¡Œçš„ä¸Šä¸‹æ–‡ï¼Œå¦‚<code>Worker</code>æˆ–<code>SharedWorker</code>ã€‚<code>Window</code>å®¢æˆ·ç«¯ç”±æ›´å…·ä½“çš„<code>WindowClient</code>è¡¨ç¤ºã€‚ ä½ å¯ä»¥ä»<code>Clients.matchAll()</code>å’Œ<code>Clients.get()</code>ç­‰æ–¹æ³•è·å–<code>Client/WindowClient</code>å¯¹è±¡ã€‚</p>
</blockquote>
<h3 id="æ–°çª—å£æ‰“å¼€"><a href="#æ–°çª—å£æ‰“å¼€" class="headerlink" title="æ–°çª—å£æ‰“å¼€"></a>æ–°çª—å£æ‰“å¼€</h3><p>ä½¿ç”¨<code>clients.openWindow</code>åœ¨æ–°çª—å£æ‰“å¼€ä¸€ä¸ªç½‘é¡µï¼š</p>
<pre><code>self.addEventListener(&apos;notificationclick&apos;, function(event) {
  event.notification.close();
  // æ–°çª—å£æ‰“å¼€event.waitUntil(
    clients.openWindow(&apos;https://google.com/&apos;)
  );
});
</code></pre><h3 id="èšç„¦å·²ç»æ‰“å¼€çš„é¡µé¢"><a href="#èšç„¦å·²ç»æ‰“å¼€çš„é¡µé¢" class="headerlink" title="èšç„¦å·²ç»æ‰“å¼€çš„é¡µé¢"></a>èšç„¦å·²ç»æ‰“å¼€çš„é¡µé¢</h3><p>åˆ©ç”¨<code>cilents</code>æä¾›çš„ç›¸å…³<code>API</code>è·å–ï¼Œå½“å‰æµè§ˆå™¨å·²ç»æ‰“å¼€çš„é¡µé¢<code>URLs</code>ã€‚ä¸è¿‡è¿™äº›<code>URLs</code>åªèƒ½æ˜¯å’Œä½ <code>SW</code>åŒåŸŸçš„ã€‚ç„¶åï¼Œé€šè¿‡åŒ¹é…<code>URL</code>ï¼Œé€šè¿‡<code>matchingClient.focus()</code>è¿›è¡Œèšç„¦ã€‚æ²¡æœ‰çš„è¯ï¼Œåˆ™æ–°æ‰“å¼€é¡µé¢å³å¯ã€‚</p>
<pre><code>self.addEventListener(&apos;notificationclick&apos;, function(event) {
  event.notification.close();
  consturlToOpen=self.location.origin+&apos;/index.html&apos;;

  constpromiseChain=clients.matchAll({
      type:&apos;window&apos;,
      includeUncontrolled:true
    })
    .then((windowClients) =&gt; {
      let matchingClient =null;

      for (let i =0; i &lt;windowClients.length; i++) {
        constwindowClient= windowClients[i];
        if (windowClient.url=== urlToOpen) {
          matchingClient = windowClient;
          break;
        }
      }

      if (matchingClient) {
        returnmatchingClient.focus();
      } else {
        returnclients.openWindow(urlToOpen);
      }
    });

  event.waitUntil(promiseChain);
});
</code></pre><h3 id="æ£€æµ‹æ˜¯å¦éœ€è¦æ¨é€"><a href="#æ£€æµ‹æ˜¯å¦éœ€è¦æ¨é€" class="headerlink" title="æ£€æµ‹æ˜¯å¦éœ€è¦æ¨é€"></a>æ£€æµ‹æ˜¯å¦éœ€è¦æ¨é€</h3><p>å¦‚æœç”¨æˆ·å·²ç»åœç•™åœ¨å½“å‰çš„ç½‘é¡µï¼Œé‚£æˆ‘ä»¬å¯èƒ½å°±ä¸éœ€è¦æ¨é€äº†ï¼Œé‚£ä¹ˆé’ˆå¯¹äºè¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬åº”è¯¥æ€ä¹ˆæ£€æµ‹ç”¨æˆ·æ˜¯å¦æ­£åœ¨ç½‘é¡µä¸Šå‘¢ï¼Ÿ</p>
<blockquote>
<p>é€šè¿‡<code>windowClient.focused</code>å¯ä»¥æ£€æµ‹åˆ°å½“å‰çš„<code>Client</code>æ˜¯å¦å¤„äºèšç„¦çŠ¶æ€ã€‚</p>
</blockquote>
<pre><code>self.addEventListener(&apos;push&apos;, function(event) {
  constpromiseChain=clients.matchAll({
      type:&apos;window&apos;,
      includeUncontrolled:true
    })
    .then((windowClients) =&gt; {
      let mustShowNotification =true;

      for (let i =0; i &lt;windowClients.length; i++) {
        constwindowClient= windowClients[i];
        if (windowClient.focused) {
          mustShowNotification =false;
          break;
        }
      }

      return mustShowNotification;
    })
    .then((mustShowNotification) =&gt; {
      if (mustShowNotification) {
        consttitle=event.data.text();
        constoptions= {
          body:event.data.text(),
          icon:&apos;./images/logo/logo512.png&apos;,
        };
        returnself.registration.showNotification(title, options);
      } else {
        console.log(&apos;ç”¨æˆ·å·²ç»èšç„¦äºå½“å‰é¡µé¢ï¼Œä¸éœ€è¦æ¨é€ã€‚&apos;);
      }
    });
});
</code></pre><h3 id="åˆå¹¶æ¶ˆæ¯"><a href="#åˆå¹¶æ¶ˆæ¯" class="headerlink" title="åˆå¹¶æ¶ˆæ¯"></a>åˆå¹¶æ¶ˆæ¯</h3><p>è¯¥åœºæ™¯çš„ä¸»è¦é’ˆå¯¹æ¶ˆæ¯çš„åˆå¹¶ã€‚æ¯”å¦‚ï¼Œå½“åªæœ‰ä¸€æ¡æ¶ˆæ¯æ—¶ï¼Œå¯ä»¥ç›´æ¥æ¨é€ï¼Œé‚£å¦‚æœè¯¥ç”¨æˆ·åˆå‘é€ä¸€ä¸ªæ¶ˆæ¯å‘¢ï¼Ÿ è¿™æ—¶å€™ï¼Œæ¯”è¾ƒå¥½çš„ç”¨æˆ·ä½“éªŒæ˜¯ç›´æ¥å°†æ¨é€åˆå¹¶ä¸ºä¸€ä¸ªï¼Œç„¶åæ›¿æ¢å³å¯ã€‚ é‚£ä¹ˆï¼Œæ­¤æ—¶æˆ‘ä»¬å°±éœ€è¦è·å¾—å½“å‰å·²ç»å±•ç¤ºçš„æ¨é€æ¶ˆæ¯ï¼Œè¿™é‡Œä¸»è¦é€šè¿‡<code>registration.getNotifications() API</code>æ¥è¿›è¡Œè·å–ã€‚è¯¥<code>API</code>è¿”å›çš„ä¹Ÿæ˜¯ä¸€ä¸ª<code>Promise</code>å¯¹è±¡ã€‚é€šè¿‡<code>Promise</code>åœ¨<code>resolve</code>åæ‹¿åˆ°çš„<code>notifications</code>ï¼Œåˆ¤æ–­å…¶<code>length</code>ï¼Œè¿›è¡Œæ¶ˆæ¯åˆå¹¶ã€‚</p>
<pre><code>self.addEventListener(&apos;push&apos;, function(event) {
  // ...
    .then((mustShowNotification) =&gt; {
      if (mustShowNotification) {
        returnregistration.getNotifications()
          .then(notifications=&gt; {
            let options = {
              icon:&apos;./images/logo/logo512.png&apos;,
              badge:&apos;./images/logo/logo512.png&apos;
            };
            let title =event.data.text();
            if (notifications.length) {
              options.body=`æ‚¨æœ‰${notifications.length}æ¡æ–°æ¶ˆæ¯`;
            } else {
              options.body=event.data.text();
            }
            returnself.registration.showNotification(title, options);

          });
      } else {
        console.log(&apos;ç”¨æˆ·å·²ç»èšç„¦äºå½“å‰é¡µé¢ï¼Œä¸éœ€è¦æ¨é€ã€‚&apos;);
      }
    });
  // ...
});
</code></pre><p><img src="/2017/11/14/Service-Worker-PWA/16.webp" alt=""></p>
<h3 id="æœåŠ¡ç«¯æ¨é€çš„å‡ ç§æ–¹å¼"><a href="#æœåŠ¡ç«¯æ¨é€çš„å‡ ç§æ–¹å¼" class="headerlink" title="æœåŠ¡ç«¯æ¨é€çš„å‡ ç§æ–¹å¼"></a>æœåŠ¡ç«¯æ¨é€çš„å‡ ç§æ–¹å¼</h3><p>æœåŠ¡ç«¯æ¨é€æ˜¯ç°ä»Š<code>Web</code>å¼€å‘è¿‡ç¨‹ä¸­æœ€å¸¸è§çš„éœ€æ±‚ã€‚ä¾‹å¦‚ï¼š</p>
<ul>
<li>å³æ—¶èŠå¤©å·¥å…·</li>
<li>H5ç½‘ç»œæ¸¸æˆ</li>
<li>æ¶ˆæ¯é€šçŸ¥</li>
</ul>
<p>ä¸€èˆ¬çš„æœåŠ¡å™¨æ¨é€åŒ…æ‹¬ï¼š</p>
<ul>
<li>æœ€ç®€å•çš„æ˜¯å®¢æˆ·ç«¯è½®è¯¢çš„æ–¹å¼ï¼Œåœ¨å®¢æˆ·ç«¯åˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨ï¼Œæ¯éš”ä¸€å®šçš„æ—¶é—´å»è¯·æ±‚æœåŠ¡ç«¯ï¼Œæ¯æ¬¡è¯·æ±‚æ£€æŸ¥çŠ¶æ€å˜åŒ–ä»¥åˆ¤æ–­æœåŠ¡ç«¯æ˜¯å¦æœ‰æ–°æ•°æ®æ›´æ–°ã€‚</li>
<li>åŸºäº AJAX çš„é•¿è½®è¯¢ï¼ˆ<code>long-polling</code>ï¼‰æ–¹å¼ï¼ŒæœåŠ¡å™¨åœ¨ä¸€æ®µæ—¶é—´åå†è¿”å›ä¿¡æ¯ï¼›</li>
<li><code>HTTP Streaming</code>ï¼Œé€šè¿‡<code>iframe</code>å’Œ<code>&lt;script&gt;</code>æ ‡ç­¾å®Œæˆæ•°æ®çš„ä¼ è¾“ï¼›</li>
<li><code>TCP</code>é•¿è¿æ¥/<code>WebSocket</code>ï¼Œå¯ä»¥å®ç°æœåŠ¡å™¨ä¸»åŠ¨å‘é€æ•°æ®è‡³ç½‘é¡µç«¯ï¼Œå®ƒå’Œ<code>HTTP</code>ä¸€æ ·ï¼Œæ˜¯ä¸€ä¸ªåŸºäº<code>HTTP</code>çš„åº”ç”¨å±‚åè®®ï¼Œè·‘çš„æ˜¯<code>TCP</code>ï¼Œæ‰€ä»¥æœ¬è´¨ä¸Šè¿˜æ˜¯ä¸ªé•¿è¿æ¥ï¼ŒåŒå‘é€šä¿¡ï¼Œæ„å‘³ç€æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯å¯ä»¥åŒæ—¶å‘é€å¹¶å“åº”è¯·æ±‚ï¼Œè€Œä¸å†åƒ<code>HTTP</code>çš„è¯·æ±‚å’Œå“åº”</li>
<li><code>SSE: Server-Sent Events</code>ï¼Œè¿™æ˜¯é€šè¿‡<code>http</code>åè®®å˜é€šå®ç°çš„ï¼Œé€šè¿‡æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯å£°æ˜ï¼Œæ¥ä¸‹æ¥æ˜¯è¦å‘é€çš„æ˜¯æµä¿¡æ¯ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯å®Œæˆä¸€æ¬¡è€—æ—¶é•¿çš„ä¸‹è½½ã€‚</li>
</ul>
<h2 id="å°ç»“-1"><a href="#å°ç»“-1" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>æœ¬æ–‡é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œè®²è¿°äº†<code>Service Worker</code>ä¸­æ¶ˆæ¯æ¨é€çš„åŸç†ã€‚<code>Service Worker</code>ä¸­çš„æ¶ˆæ¯æ¨é€æ˜¯åŸºäº<code>Notification API</code>çš„ï¼Œè¿™ä¸€<code>API</code>çš„ä½¿ç”¨é¦–å…ˆéœ€è¦ç”¨æˆ·æˆæƒï¼Œé€šè¿‡åœ¨<code>Service Worker</code>æ³¨å†Œæ—¶çš„<code>serviceWorkerRegistration.pushManager.subscribe</code>æ–¹æ³•æ¥å‘ç”¨æˆ·ç”³è¯·æƒé™ï¼Œå¦‚æœç”¨æˆ·æ‹’ç»äº†æ¶ˆæ¯æ¨é€ï¼Œåº”ç”¨ç¨‹åºä¹Ÿéœ€è¦ç›¸å…³å¤„ç†ã€‚</p>
<p>æ¶ˆæ¯æ¨é€æ˜¯åŸºäºè°·æ­Œäº‘æœåŠ¡çš„ï¼Œå› æ­¤ï¼Œåœ¨å›½å†…ï¼Œæ”¶åˆ°<code>GFW</code>çš„é™åˆ¶ï¼Œè¿™ä¸€åŠŸèƒ½çš„æ”¯æŒå¹¶ä¸å¥½ï¼Œ<code>Google</code>æä¾›äº†ä¸€ç³»åˆ—æ¨é€ç›¸å…³çš„åº“ï¼Œä¾‹å¦‚<code>Node.js</code>ä¸­ï¼Œä½¿ç”¨<a href="https://github.com/web-push-libs/web-push" target="_blank" rel="noopener">web-push</a>æ¥å®ç°ã€‚ä¸€èˆ¬åŸç†æ˜¯ï¼šåœ¨æœåŠ¡ç«¯ç”Ÿæˆå…¬é’¥å’Œç§é’¥ï¼Œå¹¶é’ˆå¯¹ç”¨æˆ·å°†å…¶å…¬é’¥å’Œç§é’¥å­˜å‚¨åˆ°æœåŠ¡ç«¯ï¼Œå®¢æˆ·ç«¯åªå­˜å‚¨å…¬é’¥ã€‚<code>Service Worker</code>çš„<code>swReg.pushManager.subscribe</code>å¯ä»¥è·å–åˆ°<code>subscription</code>ï¼Œå¹¶å‘é€ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯åˆ©ç”¨<code>subscription</code>å‘æŒ‡å®šçš„ç”¨æˆ·å‘èµ·æ¶ˆæ¯æ¨é€ã€‚</p>
<p>æ¶ˆæ¯æ¨é€åŠŸèƒ½å¯ä»¥é…åˆ<code>clients API</code>åšç‰¹æ®Šå¤„ç†ã€‚</p>
<p>å¦‚æœç”¨æˆ·å®‰è£…äº†<code>PWA</code>åº”ç”¨ï¼Œå³ä½¿ç”¨æˆ·å…³é—­äº†åº”ç”¨ç¨‹åºï¼Œ<code>Service Worker</code>ä¹Ÿåœ¨è¿è¡Œï¼Œå³ä½¿ç”¨æˆ·æœªæ‰“å¼€åº”ç”¨ç¨‹åºï¼Œä¹Ÿä¼šæ”¶åˆ°æ¶ˆæ¯é€šçŸ¥ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/11/callå’Œapplyçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯null-undefinedæ—¶å‡½æ•°å†…çš„çš„thisæŒ‡å‘windowæˆ–global/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/11/callå’Œapplyçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯null-undefinedæ—¶å‡½æ•°å†…çš„çš„thisæŒ‡å‘windowæˆ–global/" itemprop="url">callå’Œapplyçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯null/undefinedæ—¶å‡½æ•°å†…çš„çš„thisæŒ‡å‘windowæˆ–global</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-11-11T23:25:16+08:00">
                2017-11-11
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="è°è¯´-JavaScript-å¾ˆç®€å•äº†ï¼Ÿ"><a href="#è°è¯´-JavaScript-å¾ˆç®€å•äº†ï¼Ÿ" class="headerlink" title="è°è¯´ JavaScript å¾ˆç®€å•äº†ï¼Ÿ"></a><a href="https://link.zhihu.com/?target=https%3A//segmentfault.com/a/1190000009024648" target="_blank" rel="noopener">è°è¯´ JavaScript å¾ˆç®€å•äº†ï¼Ÿ</a></h2><h2 id="JavaScriptç³»åˆ—â€”â€”æ•°ç»„å…ƒç´ å·¦å³ç§»åŠ¨Nä½ç®—æ³•å®ç°"><a href="#JavaScriptç³»åˆ—â€”â€”æ•°ç»„å…ƒç´ å·¦å³ç§»åŠ¨Nä½ç®—æ³•å®ç°" class="headerlink" title="JavaScriptç³»åˆ—â€”â€”æ•°ç»„å…ƒç´ å·¦å³ç§»åŠ¨Nä½ç®—æ³•å®ç°"></a><a href="https://link.zhihu.com/?target=https%3A//segmentfault.com/a/1190000012882330" target="_blank" rel="noopener">JavaScriptç³»åˆ—â€”â€”æ•°ç»„å…ƒç´ å·¦å³ç§»åŠ¨Nä½ç®—æ³•å®ç°</a></h2><p>14å¹´çš„é¢è¯•é¢˜ï¼Œæƒ³ä¸åˆ°ä»Šå¤©åœ¨ç¾¤é‡Œæœ‰äººè¿˜é—®äº†è¿™ä¸ªï¼<br><img src="https://pic1.zhimg.com/v2-2ba203f9e2e5fd627521c12d5e8f4e91_b.jpg" alt=""><img src="https://pic1.zhimg.com/80/v2-2ba203f9e2e5fd627521c12d5e8f4e91_hd.jpg" alt=""><br>call/applyç”¨æ¥æ”¹å˜å‡½æ•°çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆthisï¼‰ï¼Œå®ƒä»¬çš„ç¬¬ä¸€ä¸ªå‚æ•°thisArgæ˜¯ä¸ªå¯¹è±¡ï¼Œå³ä½œä¸ºå‡½æ•°å†…çš„thisã€‚</p>
<p>å¤šæ•°æ—¶å€™ä½ ä¼ å•¥å‡½æ•°å†…å°±æ˜¯å•¥ã€‚ä»…ä»¥callç¤ºä¾‹</p>
<pre><code>function fun() {
alert(this);
}
fun.call(1);
fun.call(&apos;a&apos;);
fun.call(true);
fun.call({name:&apos;jack&apos;});
</code></pre><p>åˆ†åˆ«å¼¹å‡ºâ€œ1â€ã€â€œaâ€ã€â€œtrueâ€ã€â€œ[object Object]â€ã€‚</p>
<p>æœ‰ä¸¤ç§æƒ…å†µéœ€è¦æ³¨æ„ï¼Œä¼ nullæˆ–undefinedæ—¶ï¼Œå°†æ˜¯JSæ‰§è¡Œç¯å¢ƒçš„å…¨å±€å˜é‡ã€‚æµè§ˆå™¨ä¸­æ˜¯windowï¼Œå…¶å®ƒç¯å¢ƒï¼ˆå¦‚nodeï¼‰åˆ™æ˜¯globalã€‚</p>
<pre><code>fun.call(null); // window or global
fun.call(undefined); // window or global
</code></pre><p>è¿™åœ¨ECMAScript5.1 15.3.4.4ä¸­æœ‰è§£é‡Šï¼Œå¦‚ä¸‹<br><img src="https://pic2.zhimg.com/v2-a55dd237510bbfca06ff1f5ad5c1ac2e_b.jpg" alt=""><img src="https://pic2.zhimg.com/80/v2-a55dd237510bbfca06ff1f5ad5c1ac2e_hd.jpg" alt=""><br>ä¸¥æ ¼æ¨¡å¼ä¸‹æƒ…å†µåˆæœ‰æ‰€ä¸åŒï¼ŒES3æ¯”è¾ƒå®½å®¹å°½é‡å»æ£æµ‹ä»£ç æ„å›¾ã€‚ES5ä¸¥æ ¼æ¨¡å¼ï¼ˆie6/7/8/9é™¤å¤–ï¼‰åˆ™ä¸å†æ£æµ‹ï¼Œç»™call/applyä¼ å…¥çš„ä»»ä½•å‚æ•°ä¸å†è½¬æ¢ã€‚å¦‚ä¸‹</p>
<pre><code>&apos;use strict&apos;
function fun() {
alert(this);
}
fun.call(null)      // null
fun.call(undefined) // undefined 
</code></pre><h2 id="å‡ ä¸ªé¢è¯•å°é¢˜ï¼š"><a href="#å‡ ä¸ªé¢è¯•å°é¢˜ï¼š" class="headerlink" title="å‡ ä¸ªé¢è¯•å°é¢˜ï¼š"></a>å‡ ä¸ªé¢è¯•å°é¢˜ï¼š</h2><p><img src="https://pic1.zhimg.com/v2-99d1bfc9bfa325ea383e8e5209a46384_b.jpg" alt=""><img src="https://pic1.zhimg.com/80/v2-99d1bfc9bfa325ea383e8e5209a46384_hd.jpg" alt=""><br>1.alert(alert(1)&amp;&amp;alert(2)):    ç¬¬ä¸€ä¸ªalertæ‰§è¡Œæ²¡è¿”å›undefinedã€alert æ˜¯å‡½æ•°ï¼Œalertï¼ˆ1ï¼‰ç›¸å½“è°ƒç”¨ï¼Œä½†æ²¡æœ‰è¿”å›å€¼ï¼Œæ‰€ä»¥æ˜¯undefinedã€‘ï¼Œalertï¼ˆ2ï¼‰ ç›´æ¥çŸ­è·¯æ‰ã€‚</p>
<p>2.alert(1&amp;&amp;2)   &amp;&amp;ç¬¬ä¸€ä¸ªä¸ºtrueï¼Œæ‰ä¼šæ‰§è¡Œç¬¬äºŒä¸ªï¼Œå¦‚æœå…¨éƒ¨æ˜¯trueè¿”å›æœ€åä¸€ä¸ªå€¼ã€‚</p>
<p>3.<br><img src="https://pic3.zhimg.com/v2-3c568d3cbe2ee035f846917f7907903d_b.jpg" alt=""><img src="https://pic3.zhimg.com/80/v2-3c568d3cbe2ee035f846917f7907903d_hd.jpg" alt=""><br>å¤šæ¬¡bindåªä¿ç•™ç¬¬ä¸€æ¬¡çš„ã€‚</p>
<p>4.<br><img src="https://pic3.zhimg.com/v2-99af21478704f737a974a986e9fd41cc_b.jpg" alt=""><img src="https://pic3.zhimg.com/80/v2-99af21478704f737a974a986e9fd41cc_hd.jpg" alt=""><br>5.<br><img src="https://pic4.zhimg.com/v2-eef9d265365a8782e55efa78ad718b01_b.jpg" alt=""><img src="https://pic4.zhimg.com/80/v2-eef9d265365a8782e55efa78ad718b01_hd.jpg" alt=""><img src="https://pic4.zhimg.com/v2-d355491fab6f0917e3b6b141992dac5c_b.jpg" alt=""><img src="https://pic4.zhimg.com/80/v2-d355491fab6f0917e3b6b141992dac5c_hd.jpg" alt=""><img src="https://pic4.zhimg.com/v2-698cc4f2c86dccb91268ae9b597089dc_b.jpg" alt=""><img src="https://pic4.zhimg.com/80/v2-698cc4f2c86dccb91268ae9b597089dc_hd.jpg" alt=""><br>6.è‡ªå®šä¹‰äº‹ä»¶</p>
<pre><code>var myEvent = new Event(&apos;myEvent&apos;);
document.addEventListener(&apos;myEvent&apos;, log, false);
function log() {
  console.log(&apos;hello event&apos;);
}
document.dispatchEvent(myEvent);
</code></pre><p>7.æ•°ç»„å¾ªç¯ç§»åŠ¨<br><img src="https://pic4.zhimg.com/v2-c996087a776f590d84df53c1827872d2_b.jpg" alt=""><img src="https://pic4.zhimg.com/80/v2-c996087a776f590d84df53c1827872d2_hd.jpg" alt=""><br>éœ€æ±‚</p>
<p>å‡è®¾æœ‰è¿™æ ·ä¸€ä¸ªæ•°ç»„</p>
<pre><code>[1,2,3,4,5]
</code></pre><p>ç°åœ¨æƒ³è¦å·¦ç§»æˆ–è€…å³ç§»Nä½ï¼Œæ¯”å¦‚ç§»åŠ¨1ä½</p>
<pre><code>//å·¦ç§»1ä½
[2,3,4,5,1]

//å³ç§»1ä½
[5,1,2,3,4]
</code></pre><p>ç®—æ³•å®ç°</p>
<p>è¿™æ ·ä¸€é“é¢˜ç›®ï¼Œä½ å…ˆä¸è¦çœ‹æˆ‘ä¸‹é¢çš„ä»£ç ï¼Œè‡ªå·±æ€è€ƒä¸€ä¸‹å¦‚ä½•å®ç°å®ƒï¼Œä¸ç®¡æ˜¯å¤æ‚çš„è¿˜æ˜¯ç®€å•çš„æ–¹æ³•ã€‚<br>å¯ä»¥å…ˆå‘Šè¯‰ä½ æˆ‘ç”¨äº†2è¡Œä»£ç å®ç°å·¦ã€å³ç§»åŠ¨å…ƒç´ ã€‚</p>
<p>æ‹†åˆ†æ³•</p>
<p>å½“æˆ‘ä»¬æ²¡æœ‰å…·ä½“æ€è·¯çš„æ—¶å€™ï¼Œå°±å…ˆå‡è®¾æ•°ç»„ç§»åŠ¨1ä½çš„æƒ…å†µã€‚</p>
<pre><code>[1,2,3,4,5]
=&gt;
[null,1,2,3,4] and [5,null,null,null,null]
=&gt;
[5,1,2,3,4]
</code></pre><p>è¿™é‡Œå¯ä»¥çœ‹æˆ2ä¸ªæ•°ç»„ï¼Œä¸€ä¸ªæ˜¯æ²¡æœ‰åˆ°è¾¾è¾¹ç•Œçš„å…ƒç´ ç§»åŠ¨[null,1,2,3,4]ï¼Œä¸€ä¸ªæ˜¯åˆ°è¾¾äº†è¾¹ç•Œçš„å…ƒç´ ç§»åŠ¨[5,null,null,null,null]ï¼Œå½“å…ƒç´ åˆ°è¾¾è¾¹ç•Œï¼Œå°±ä¼šå¾€æ•°ç»„çš„åˆå§‹ä½ç½®ç§»åŠ¨ï¼Œå½¢æˆäº†ä¸€ä¸ªå¾ªç¯çš„è¿‡ç¨‹ã€‚</p>
<p>å¾ˆæ˜æ˜¾ï¼Œå¦‚æœæˆ‘ä»¬å°†è¿™2ä¸ªç§»åŠ¨åçš„æ•°ç»„åˆå¹¶èµ·æ¥ï¼Œå°±æ˜¯éœ€æ±‚çš„ç»“æœã€‚</p>
<p>ç§»åŠ¨2ä½</p>
<p>åŒæ ·ç¬¦åˆ2ä¸ªç§»åŠ¨åçš„æ•°ç»„åˆå¹¶èµ·æ¥ä¸ºç»“æœçš„æƒ…å†µ</p>
<pre><code>[1,2,3,4,5]
=&gt;
[null,null,1,2,3] and [4,5,null,null,null]
=&gt;
[4,5,1,2,3]
</code></pre><p>åˆšå¥½ç§»åŠ¨æ•°ç»„é•¿åº¦</p>
<pre><code>[1,2,3,4,5]
=&gt;
[1,2,3,4,5] and [] //å¦‚æœæ²¡æœ‰ï¼Œå°±å‡è®¾ä¸ºç©ºæ•°ç»„
</code></pre><p>åˆå¹¶æ•°ç»„</p>
<p>å‡è®¾ç§»åŠ¨1ä½çš„æƒ…å†µ<br>ä¸Šé¢çš„æ­¥éª¤ï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†è§„å¾‹ï¼Œæ¥ä¸‹æ¥è¦åšçš„æ˜¯æ‰¾åˆ°2ä¸ªæ•°ç»„ï¼Œéœ€è¦ç”¨åˆ°sliceæˆªå–æ•°ç»„å…ƒç´ ã€‚<br>æˆªå–ç¬¬ä¸€ä¸ªæ•°ç»„</p>
<pre><code>arr.slice(0,-1)
// [1,2,3,4]
</code></pre><p>æˆªå–ç¬¬äºŒä¸ªæ•°ç»„</p>
<pre><code>arr.slice(-1)
// [5]
</code></pre><p>åˆå¹¶æ•°ç»„</p>
<pre><code>arr.slice(-1).concat(arr.slice(0,-1))
// [5,1,2,3,4]
</code></pre><p>è¿™æ ·ä½ å°±å®ç°äº†ç§»åŠ¨1ä½çš„æƒ…å†µï¼Œæ¥ç€ï¼Œä½ ç»§ç»­æ‹¿+5å’Œ-5èŒƒå›´å†…çš„æ•°å­—è¿›è¡Œæµ‹è¯•ï¼Œå‘ç°éƒ½å¯ä»¥æ­£å¸¸ç§»åŠ¨ï¼Œå½“æ•°å­—å¤§äº5æˆ–è€…å°äº-5çš„æ—¶å€™ï¼Œä»£ç å°±æ— æ•ˆäº†ï¼Œå§‹ç»ˆè¾“å‡º[1,2,3,4,5]</p>
<pre><code>arr.slice(-6).concat(arr.slice(0,-6))
// [1,2,3,4,5]
</code></pre><p>æˆ‘ä»¬å†åŠ ä¸Šä¸€ä¸ªå°æŠ€å·§ï¼Œæ±‚ä½™æ•°ï¼Œå‡è®¾æ˜¯ç§»åŠ¨6ï¼Œé‚£ä¹ˆï¼Œå®é™…ä¸Šå’Œç§»åŠ¨1æ˜¯ç›¸åŒçš„ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ ¹æ®å…¬å¼æ±‚ä½™æ•°</p>
<pre><code>n = n%arr.length
// n = 6%5 ä½™1
</code></pre><p>åŒç†ï¼Œå½“ç§»åŠ¨-6æ—¶</p>
<pre><code>n = n%arr.length
// n = -6%5 ä½™-1
</code></pre><p>æ¥ç€å¸¦å…¥å…¬å¼ï¼Œå‘ç°è¾“å‡ºå…¨éƒ¨éƒ½æ­£ç¡®äº†ï¼ï¼</p>
<p>æ€è·¯åˆ†æå®Œäº†ï¼Œåº”è¯¥å¾ˆæ¸…æ™°äº†å§ï¼Œæºç åœ¨ä¸‹é¢ã€</p>
<p>ç®—æ³•æºç </p>
<p>arrè¡¨ç¤ºåŸå§‹æ•°ç»„ï¼Œnè¡¨ç¤ºç§»åŠ¨çš„è·ç¦»ï¼Œå¯ä»¥æ˜¯æ­£æ•°ã€å¯ä»¥æ˜¯0ã€ä¹Ÿå¯ä»¥æ˜¯è´Ÿæ•°ã€æ­£æ•°è¡¨ç¤ºå³ç§»ï¼Œè´Ÿæ•°è¡¨ç¤ºå·¦ç§»ï¼Œ0è¡¨ç¤ºä¸ç§»åŠ¨ã€‚</p>
<pre><code>function moveElement(arr, n) {
  if(Math.abs(n)&gt;arr.length) n = n%arr.length
  return arr.slice(-n).concat(arr.slice(0,-n))
}

// moveElement(arr, 9)
// moveElement(arr, 0)
// moveElement(arr, -9)
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/04/H5å¦‚ä½•å”¤èµ·APP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/04/H5å¦‚ä½•å”¤èµ·APP/" itemprop="url">H5å¦‚ä½•å”¤èµ·APP</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-11-04T19:29:36+08:00">
                2017-11-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>å‰ä¸€æ®µæ—¶é—´åœ¨åšç”µæµApp H5é¡µé¢ï¼Œéœ€æ±‚ä¸­è½åœ°é¡µå æ¯”è¾ƒå¤§ï¼Œè½åœ°é¡µæ‰¿æ‹…çš„èŒè´£å°±æ˜¯å¼•æµã€‚å¼•æµæœ‰ä¸¤ç§å½¢å¼ï¼ŒåŒæ—¶ä¹Ÿæ˜¯æˆ‘ä»¬å¯¹å”¤ç«¯çš„å®šä¹‰ï¼šå¼•å¯¼å·²ä¸‹è½½ç”¨æˆ·æ‰“å¼€APPï¼Œå¼•å¯¼æœªä¸‹è½½ç”¨æˆ·ä¸‹è½½APPã€‚</p>
<p>å¼•å¯¼å·²ä¸‹è½½ç”¨æˆ·æ‰“å¼€APPï¼Œä»æ•°æ®ä¸Šè¯´ç”¨æˆ·åœç•™åœ¨APPä¸­çš„æ—¶é—´æ›´å¤šäº†ï¼Œæ˜¯åœ¨æé«˜ç”¨æˆ·ç²˜æ€§ï¼›ä»ä½“éªŒä¸Šè¯´ï¼ŒAPPä½“éªŒæ˜¯è¦æ¯”H5å¥½çš„ã€‚å¼•å¯¼æœªä¸‹è½½ç”¨æˆ·ä¸‹è½½APPï¼Œå¯ä»¥å¢åŠ æˆ‘ä»¬çš„ç”¨æˆ·é‡ã€‚</p>
<p>ä¸Šé¢å…¶å®åˆ†åˆ«è§£é‡Šäº† <strong>ä»€ä¹ˆæ˜¯å”¤ç«¯</strong> ä»¥åŠ <strong>ä¸ºä»€ä¹ˆè¦å”¤ç«¯</strong>ï¼Œä¹Ÿå°±æ˜¯  <em>3Wæ³•åˆ™</em> ä¸­çš„ What å’Œ Whyï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬å°±è¦èŠä¸€èŠ How äº†ï¼Œä¹Ÿå°±æ˜¯ <strong>å¦‚ä½•å”¤ç«¯</strong> ã€‚</p>
<p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹å¸¸è§çš„å”¤ç«¯æ–¹å¼ä»¥åŠä»–ä»¬é€‚ç”¨çš„åœºæ™¯ï¼š</p>
<h2 id="å”¤ç«¯åª’ä»‹"><a href="#å”¤ç«¯åª’ä»‹" class="headerlink" title="å”¤ç«¯åª’ä»‹"></a>å”¤ç«¯åª’ä»‹</h2><h3 id="URL-Scheme"><a href="#URL-Scheme" class="headerlink" title="URL Scheme"></a>URL Scheme</h3><h4 id="æ¥æº"><a href="#æ¥æº" class="headerlink" title="æ¥æº"></a>æ¥æº</h4><p>æˆ‘ä»¬çš„æ‰‹æœºä¸Šæœ‰è®¸å¤šç§å¯†ä¿¡æ¯ï¼Œè”ç³»æ–¹å¼ã€ç…§ç‰‡ã€é“¶è¡Œå¡ä¿¡æ¯â€¦æˆ‘ä»¬ä¸å¸Œæœ›è¿™äº›ä¿¡æ¯å¯ä»¥è¢«æ‰‹æœºåº”ç”¨éšæ„è·å–åˆ°ï¼Œä¿¡æ¯æ³„éœ²çš„å±å®³ç”šå¤§ã€‚æ‰€ä»¥ï¼Œå¦‚ä½•ä¿è¯ä¸ªäººä¿¡æ¯åœ¨è®¾å¤‡æ‰€æœ‰è€…çŸ¥æƒ…å¹¶å…è®¸çš„æƒ…å†µä¸‹è¢«ä½¿ç”¨ï¼Œæ˜¯æ™ºèƒ½è®¾å¤‡çš„æ ¸å¿ƒå®‰å…¨é—®é¢˜ã€‚</p>
<p>å¯¹æ­¤ï¼Œè‹¹æœä½¿ç”¨äº†åä¸º <em>æ²™ç›’</em> çš„æœºåˆ¶ï¼šåº”ç”¨åªèƒ½è®¿é—®å®ƒå£°æ˜å¯èƒ½è®¿é—®çš„èµ„æºã€‚ä½†æ²™ç›’ä¹Ÿé˜»ç¢äº†åº”ç”¨é—´åˆç†çš„ä¿¡æ¯å…±äº«ï¼ŒæŸç§ç¨‹åº¦ä¸Šé™åˆ¶äº†åº”ç”¨çš„èƒ½åŠ›ã€‚</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬æ€¥éœ€è¦ä¸€ä¸ªè¾…åŠ©å·¥å…·æ¥å¸®åŠ©æˆ‘ä»¬å®ç°åº”ç”¨é€šä¿¡ï¼Œ URL Scheme å°±æ˜¯è¿™ä¸ªå·¥å…·ã€‚</p>
<h4 id="URL-Scheme-æ˜¯ä»€ä¹ˆ"><a href="#URL-Scheme-æ˜¯ä»€ä¹ˆ" class="headerlink" title="URL Scheme æ˜¯ä»€ä¹ˆ"></a>URL Scheme æ˜¯ä»€ä¹ˆ</h4><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ URL çš„ç»„æˆï¼š</p>
<pre><code>[scheme:][//authority][path][?query][#fragment]
</code></pre><p>æˆ‘ä»¬æ‹¿ <code>https://www.baidu.com</code> æ¥ä¸¾ä¾‹ï¼Œscheme è‡ªç„¶å°±æ˜¯ <code>https</code> äº†ã€‚</p>
<p>å°±åƒç»™æœåŠ¡å™¨èµ„æºåˆ†é…ä¸€ä¸ª URLï¼Œä»¥ä¾¿æˆ‘ä»¬å»è®¿é—®å®ƒä¸€æ ·ï¼Œæˆ‘ä»¬åŒæ ·ä¹Ÿå¯ä»¥ç»™æ‰‹æœºAPPåˆ†é…ä¸€ä¸ªç‰¹æ®Šæ ¼å¼çš„ URLï¼Œç”¨æ¥è®¿é—®è¿™ä¸ªAPPæˆ–è€…è¿™ä¸ªAPPä¸­çš„æŸä¸ªåŠŸèƒ½(æ¥å®ç°é€šä¿¡)ã€‚APPå¾—æœ‰ä¸€ä¸ªæ ‡è¯†ï¼Œå¥½è®©æˆ‘ä»¬å¯ä»¥å®šä½åˆ°å®ƒï¼Œå®ƒå°±æ˜¯ URL çš„ Scheme éƒ¨åˆ†ã€‚</p>
<h4 id="å¸¸ç”¨APPçš„-URL-Scheme"><a href="#å¸¸ç”¨APPçš„-URL-Scheme" class="headerlink" title="å¸¸ç”¨APPçš„ URL Scheme"></a>å¸¸ç”¨APPçš„ URL Scheme</h4><table>
<thead>
<tr>
<th>APP</th>
<th style="text-align:center">å¾®ä¿¡</th>
<th style="text-align:center">æ”¯ä»˜å®</th>
<th style="text-align:center">æ·˜å®</th>
<th style="text-align:center">å¾®åš</th>
<th style="text-align:center">QQ</th>
</tr>
</thead>
<tbody>
<tr>
<td>URL Scheme</td>
<td style="text-align:center">weixin://</td>
<td style="text-align:center">alipay://</td>
<td style="text-align:center">taobao://</td>
<td style="text-align:center">sinaweibo://</td>
<td style="text-align:center">mqq://</td>
</tr>
</tbody>
</table>
<h4 id="URL-Scheme-è¯­æ³•"><a href="#URL-Scheme-è¯­æ³•" class="headerlink" title="URL Scheme è¯­æ³•"></a>URL Scheme è¯­æ³•</h4><p>ä¸Šé¢è¡¨æ ¼ä¸­éƒ½æ˜¯æœ€ç®€å•çš„ç”¨äºæ‰“å¼€ APP çš„ URL Schemeï¼Œä¸‹é¢æ‰æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„ URL Scheme æ ¼å¼ï¼š</p>
<pre><code>     è¡Œä¸º(åº”ç”¨çš„æŸä¸ªåŠŸèƒ½)    
            |
scheme://[path][?query]
   |               |
åº”ç”¨æ ‡è¯†       åŠŸèƒ½éœ€è¦çš„å‚æ•°
</code></pre><h3 id="Intent"><a href="#Intent" class="headerlink" title="Intent"></a>Intent</h3><p>å®‰å“çš„åŸç”Ÿè°·æ­Œæµè§ˆå™¨è‡ªä» chrome25 ç‰ˆæœ¬å¼€å§‹å¯¹äºå”¤ç«¯åŠŸèƒ½åšäº†ä¸€äº›å˜åŒ–ï¼ŒURL Scheme æ— æ³•å†å¯åŠ¨Androidåº”ç”¨ã€‚ ä¾‹å¦‚ï¼Œé€šè¿‡ iframe æŒ‡å‘ <code>weixin://</code>ï¼Œå³ä½¿ç”¨æˆ·å®‰è£…äº†å¾®ä¿¡ä¹Ÿæ— æ³•æ‰“å¼€ã€‚æ‰€ä»¥ï¼ŒAPPéœ€è¦å®ç°è°·æ­Œå®˜æ–¹æä¾›çš„ <code>intent:</code> è¯­æ³•ï¼Œæˆ–è€…å®ç°è®©ç”¨æˆ·é€šè¿‡è‡ªå®šä¹‰æ‰‹åŠ¿æ¥æ‰“å¼€APPï¼Œå½“ç„¶è¿™å°±æ˜¯é¢˜å¤–è¯äº†ã€‚</p>
<h4 id="Intent-è¯­æ³•"><a href="#Intent-è¯­æ³•" class="headerlink" title="Intent è¯­æ³•"></a>Intent è¯­æ³•</h4><pre><code>intent:
   HOST/URI-path // Optional host 
   #Intent; 
      package=[string]; 
      action=[string]; 
      category=[string]; 
      component=[string]; 
      scheme=[string]; 
   end;
</code></pre><p>å¦‚æœç”¨æˆ·æœªå®‰è£… APPï¼Œåˆ™ä¼šè·³è½¬åˆ°ç³»ç»Ÿé»˜è®¤å•†åº—ã€‚å½“ç„¶ï¼Œå¦‚æœä½ æƒ³è¦æŒ‡å®šä¸€ä¸ªå”¤èµ·å¤±è´¥çš„è·³è½¬åœ°å€ï¼Œæ·»åŠ ä¸‹é¢çš„å­—ç¬¦ä¸²åœ¨ <code>end;</code> å‰å°±å¯ä»¥äº†:</p>
<pre><code>S.browser_fallback_url=[encoded_full_url]
</code></pre><h4 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h4><p>ä¸‹é¢æ˜¯æ‰“å¼€ Zxing äºŒç»´ç æ‰«æ APP çš„ intentã€‚</p>
<pre><code>intent:
   //scan/
   #Intent; 
      package=com.google.zxing.client.android; 
      scheme=zxing; 
   end; 
</code></pre><p>æ‰“å¼€è¿™ä¸ª APP ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹çš„æ–¹å¼ï¼š</p>
<pre><code>&lt;ahref=&quot;intent://scan/#Intent;scheme=zxing;package=com.google.zxing.client.android;S.browser_fallback_url=http%3A%2F%2Fzxing.org;end&quot;&gt; Take a QR code &lt;/a&gt;
</code></pre><h3 id="Universal-Link"><a href="#Universal-Link" class="headerlink" title="Universal Link"></a>Universal Link</h3><h4 id="Universal-Link-æ˜¯ä»€ä¹ˆ"><a href="#Universal-Link-æ˜¯ä»€ä¹ˆ" class="headerlink" title="Universal Link æ˜¯ä»€ä¹ˆ"></a>Universal Link æ˜¯ä»€ä¹ˆ</h4><p>Universal Link æ˜¯è‹¹æœåœ¨ WWDC2015 ä¸Šä¸º iOS9 å¼•å…¥çš„æ–°åŠŸèƒ½ï¼Œé€šè¿‡ä¼ ç»Ÿçš„ HTTP é“¾æ¥å³å¯æ‰“å¼€ APPã€‚å¦‚æœç”¨æˆ·æœªå®‰è£… APPï¼Œåˆ™ä¼šè·³è½¬åˆ°è¯¥é“¾æ¥æ‰€å¯¹åº”çš„é¡µé¢ã€‚</p>
<h4 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-Universal-Link"><a href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-Universal-Link" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ Universal Link"></a>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ Universal Link</h4><p>ä¼ ç»Ÿçš„ Scheme é“¾æ¥æœ‰ä»¥ä¸‹å‡ ä¸ªç—›ç‚¹ï¼š</p>
<ul>
<li>åœ¨ ios ä¸Šä¼šæœ‰ç¡®è®¤å¼¹çª—æç¤ºç”¨æˆ·æ˜¯å¦æ‰“å¼€ï¼Œå¯¹äºç”¨æˆ·æ¥è¯´å”¤ç«¯ï¼Œå¤šå‡ºäº†ä¸€æ­¥æ“ä½œã€‚è‹¥ç”¨æˆ·æœªå®‰è£… APP ï¼Œä¹Ÿä¼šæœ‰ä¸€ä¸ªæç¤ºçª—ï¼Œå‘ŠçŸ¥æˆ‘ä»¬ â€œæ‰“ä¸å¼€è¯¥ç½‘é¡µï¼Œå› ä¸ºç½‘å€æ— æ•ˆâ€</li>
<li>ä¼ ç»Ÿ Scheme è·³è½¬æ— æ³•å¾—çŸ¥å”¤ç«¯æ˜¯å¦æˆåŠŸï¼ŒUniversal Link å”¤ç«¯å¤±è´¥å¯ä»¥ç›´æ¥æ‰“å¼€æ­¤é“¾æ¥å¯¹åº”çš„é¡µé¢</li>
<li>Scheme åœ¨å¾®ä¿¡ã€å¾®åšã€QQæµè§ˆå™¨ã€æ‰‹ç™¾ä¸­éƒ½å·²ç»è¢«ç¦æ­¢ä½¿ç”¨ï¼Œä½¿ç”¨ Universal Link å¯ä»¥é¿å¼€å®ƒä»¬çš„å±è”½ï¼ˆ æˆªæ­¢åˆ° 18å¹´8æœˆ21æ—¥ï¼Œå¾®ä¿¡å’ŒQQæµè§ˆå™¨å·²ç»ç¦æ­¢äº† Universal Linkï¼Œå…¶ä»–ä¸»æµAPPæœªå‘ç°æœ‰ç¦æ­¢ ï¼‰</li>
</ul>
<h4 id="å¦‚ä½•è®©-APP-æ”¯æŒ-Universal-Link"><a href="#å¦‚ä½•è®©-APP-æ”¯æŒ-Universal-Link" class="headerlink" title="å¦‚ä½•è®© APP æ”¯æŒ Universal Link"></a>å¦‚ä½•è®© APP æ”¯æŒ Universal Link</h4><p>æœ‰å¤§é‡çš„æ–‡ç« ä¼šè¯¦ç»†çš„å‘Šè¯‰æˆ‘ä»¬å¦‚ä½•é…ç½®ï¼Œä½ ä¹Ÿå¯ä»¥å»çœ‹<a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.apple.com%2Flibrary%2Farchive%2Fdocumentation%2FGeneral%2FConceptual%2FAppSearch%2FUniversalLinks.html%23%2F%2Fapple_ref%2Fdoc%2Fuid%2FTP40016308-CH12-SW2" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a>ï¼Œæˆ‘è¿™é‡Œç®€å•çš„å†™ä¸€ä¸ª12345ã€‚</p>
<ol>
<li>æ‹¥æœ‰ä¸€ä¸ªæ”¯æŒ <strong>https</strong> çš„åŸŸå</li>
<li>åœ¨ <a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.apple.com%2F" target="_blank" rel="noopener">å¼€å‘è€…ä¸­å¿ƒ</a> ï¼ŒIdentifiers ä¸‹ AppIDs æ‰¾åˆ°è‡ªå·±çš„ App IDï¼Œç¼–è¾‘æ‰“å¼€ Associated Domains æœåŠ¡ã€‚</li>
<li>æ‰“å¼€å·¥ç¨‹é…ç½®ä¸­çš„ Associated Domains ï¼Œåœ¨å…¶ä¸­çš„ Domains ä¸­å¡«å…¥ä½ æƒ³æ”¯æŒçš„åŸŸåï¼Œå¿…é¡»ä»¥ <code>applinks:</code> ä¸ºå‰ç¼€</li>
<li>é…ç½® <code>apple-app-site-association</code> æ–‡ä»¶ï¼Œæ–‡ä»¶åå¿…é¡»ä¸º <code>apple-app-site-association</code> ï¼Œ<strong>ä¸å¸¦ä»»ä½•åç¼€</strong></li>
<li>ä¸Šä¼ è¯¥æ–‡ä»¶åˆ°ä½ çš„ HTTPS æœåŠ¡å™¨çš„ <strong>æ ¹ç›®å½•</strong> æˆ–è€… <code>.well-known</code> ç›®å½•ä¸‹</li>
</ol>
<h4 id="Universal-Link-é…ç½®ä¸­çš„å‘"><a href="#Universal-Link-é…ç½®ä¸­çš„å‘" class="headerlink" title="Universal Link é…ç½®ä¸­çš„å‘"></a>Universal Link é…ç½®ä¸­çš„å‘</h4><p>è¿™é‡Œæ”¾ä¸€ä¸‹æˆ‘ä»¬åœ¨é…ç½®è¿‡ç¨‹ä¸­é‡åˆ°çš„å‘ï¼Œå½“ç„¶é¦–å…ˆä½ åœ¨é…ç½®è¿‡ç¨‹ä¸­å¿…é¡»å¾—ä¸¥æ ¼æŒ‰ç…§ä¸Šé¢çš„è¦æ±‚å»åšï¼Œå°¤å…¶æ˜¯åŠ ç²—çš„åœ°æ–¹ã€‚</p>
<ol>
<li>åŸŸåé—®é¢˜</li>
</ol>
<p>Universal Link æ”¯æŒçš„åŸŸåæœ€å¤šåªèƒ½æ”¯æŒåˆ°äºŒçº§åŸŸåï¼Œå¦‚æœä½ ç”¨åˆ°äº†ä¸‰çº§åŸŸåï¼ŒUniversal Link å”¤ç«¯æ˜¯ä¸ä¼šç”Ÿæ•ˆçš„ã€‚</p>
<ol start="2">
<li>è·¨åŸŸé—®é¢˜</li>
</ol>
<p>IOS 9.2 ä»¥åï¼Œå¿…é¡»è¦è§¦å‘è·¨åŸŸæ‰èƒ½æ”¯æŒ Universal Link å”¤ç«¯ã€‚</p>
<p>IOS é‚£è¾¹æœ‰è¿™æ ·ä¸€ä¸ªåˆ¤æ–­ï¼Œå¦‚æœä½ è¦æ‰“å¼€çš„ Universal Link å’Œ å½“å‰é¡µé¢æ˜¯åŒä¸€åŸŸåï¼Œios å°Šé‡ç”¨æˆ·æœ€å¯èƒ½çš„æ„å›¾ï¼Œç›´æ¥æ‰“å¼€é“¾æ¥æ‰€å¯¹åº”çš„é¡µé¢ã€‚å¦‚æœä¸åœ¨åŒä¸€åŸŸåä¸‹ï¼Œåˆ™åœ¨ä½ çš„ APP ä¸­æ‰“å¼€é“¾æ¥ï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œå…·ä½“çš„å”¤ç«¯æ“ä½œã€‚</p>
<ol start="3">
<li>Universal Link æ˜¯ç©ºé¡µé¢</li>
</ol>
<p>Universal Link æœ¬è´¨ä¸Šæ˜¯ä¸ªç©ºé¡µé¢ï¼Œå¦‚æœæœªå®‰è£… APPï¼ŒUniversal Link è¢«å½“åšæ™®é€šçš„é¡µé¢é“¾æ¥ï¼Œè‡ªç„¶ä¼šè·³åˆ° 404 é¡µé¢ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†å®ƒç»‘å®šåˆ°æˆ‘ä»¬çš„ä¸­è½¬é¡µæˆ–è€…ä¸‹è½½é¡µã€‚</p>
<h2 id="å¦‚ä½•è°ƒç”¨ä¸‰ç§å”¤ç«¯åª’ä»‹"><a href="#å¦‚ä½•è°ƒç”¨ä¸‰ç§å”¤ç«¯åª’ä»‹" class="headerlink" title="å¦‚ä½•è°ƒç”¨ä¸‰ç§å”¤ç«¯åª’ä»‹"></a>å¦‚ä½•è°ƒç”¨ä¸‰ç§å”¤ç«¯åª’ä»‹</h2><p>é€šè¿‡å‰é¢çš„ä»‹ç»ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œæ— è®ºæ˜¯ URL Scheme è¿˜æ˜¯ Intent æˆ–è€… Universal Link ï¼Œä»–ä»¬éƒ½ç®—æ˜¯ URL ï¼Œåªæ˜¯ URL Scheme å’Œ Intent ç®—æ˜¯ç‰¹æ®Šçš„ URLã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ‹¿ä½¿ç”¨ URL çš„æ–¹æ³•æ¥ä½¿ç”¨å®ƒä»¬ã€‚</p>
<h3 id="iframe"><a href="#iframe" class="headerlink" title="iframe"></a>iframe</h3><pre><code>&lt;iframesrc=&quot;sinaweibo://qrcode&quot;&gt;
</code></pre><p>åœ¨åªæœ‰ URL Scheme çš„æ—¥å­é‡Œï¼Œiframe æ˜¯ä½¿ç”¨æœ€å¤šçš„äº†ã€‚å› ä¸ºåœ¨æœªå®‰è£… app çš„æƒ…å†µä¸‹ï¼Œä¸ä¼šå»è·³è½¬é”™è¯¯é¡µé¢ã€‚ä½†æ˜¯ iframe åœ¨å„ä¸ªç³»ç»Ÿä»¥åŠå„ä¸ªåº”ç”¨ä¸­çš„å…¼å®¹é—®é¢˜è¿˜æ˜¯æŒºå¤šçš„ï¼Œä¸èƒ½å…¨éƒ¨ä½¿ç”¨ URL Schemeã€‚</p>
<h3 id="a-æ ‡ç­¾"><a href="#a-æ ‡ç­¾" class="headerlink" title="a æ ‡ç­¾"></a>a æ ‡ç­¾</h3><pre><code>&lt;ahref=&quot;intent://scan/#Intent;scheme=zxing;package=com.google.zxing.client.android;end&quot;&quot;&gt;æ‰«ä¸€æ‰«&lt;/a&gt;
</code></pre><p>å‰é¢æˆ‘ä»¬æåˆ° Intent åè®®ï¼Œå®˜æ–¹ç»™å‡ºçš„ç”¨ä¾‹ä½¿ç”¨çš„å°±æ˜¯ä½¿ç”¨çš„ a æ ‡ç­¾ï¼Œæ‰€ä»¥æˆ‘ä»¬è·Ÿç€ä¸€èµ·ç”¨å°±å¯ä»¥äº†ã€‚</p>
<p>ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œå¯¹äºåŠ¨æ€ç”Ÿæˆçš„ a æ ‡ç­¾ï¼Œä½¿ç”¨ <code>dispatch</code> æ¥æ¨¡æ‹Ÿè§¦å‘ç‚¹å‡»äº‹ä»¶ï¼Œå‘ç°å¾ˆå¤šç§ event ä¼ é€’è¿‡å»éƒ½æ— æ•ˆï¼›ä½¿ç”¨ <code>click()</code> æ¥æ¨¡æ‹Ÿè§¦å‘ï¼Œéƒ¨åˆ†åœºæ™¯ä¸‹å­˜åœ¨è¿™æ ·çš„æƒ…å†µï¼Œç¬¬ä¸€æ¬¡ç‚¹å‡»è¿‡åï¼Œå›åˆ°åŸå…ˆé¡µé¢ï¼Œå†æ¬¡ç‚¹å‡»ï¼Œç‚¹å‡»ä½ç½®å’Œé¡µé¢æ‰€è¯†åˆ«ä½ç½®æœ‰ä¸å°çš„åç§»ï¼Œæ‰€ä»¥ Intent åè®®ä» a æ ‡ç­¾æ¢æˆäº† window.locationã€‚</p>
<h3 id="window-location"><a href="#window-location" class="headerlink" title="window.location"></a>window.location</h3><p>URL Scheme åœ¨ ios 9+ ä¸Šè¯¸å¦‚ safariã€UCã€QQæµè§ˆå™¨ä¸­ï¼Œ iframe å‡æ— æ³•æˆåŠŸå”¤èµ· APPï¼Œåªèƒ½é€šè¿‡ window.location æ‰èƒ½æˆåŠŸå”¤ç«¯ã€‚</p>
<p>å½“ç„¶ï¼Œå¦‚æœæˆ‘ä»¬çš„ app æ”¯æŒ Universal Linkï¼Œios 9+ å°±ç”¨ä¸åˆ° URL Scheme äº†ã€‚è€Œ Universal Link åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæˆ‘å‘ç°åœ¨ qq ä¸­ï¼Œæ— è®ºæ˜¯ iframe å¯¼èˆª è¿˜æ˜¯ a æ ‡ç­¾æ‰“å¼€ åˆæˆ–è€… window.location éƒ½æ— æ³•æˆåŠŸå”¤ç«¯ï¼Œä¸€å¼€å§‹æˆ‘ä»¥ä¸ºæ˜¯ qq å’Œå¾®ä¿¡ä¸€æ ·ç¦æ­¢äº† Universal Link å”¤ç«¯çš„åŠŸèƒ½ï¼Œå…¶å®ä¸ç„¶ï¼Œç™¾èˆ¬è¯•éªŒä¸‹ï¼Œé€šè¿‡ top.location å”¤ç«¯æˆåŠŸäº†ã€‚</p>
<h2 id="åˆ¤æ–­å”¤ç«¯æ˜¯å¦æˆåŠŸ"><a href="#åˆ¤æ–­å”¤ç«¯æ˜¯å¦æˆåŠŸ" class="headerlink" title="åˆ¤æ–­å”¤ç«¯æ˜¯å¦æˆåŠŸ"></a>åˆ¤æ–­å”¤ç«¯æ˜¯å¦æˆåŠŸ</h2><p>å¦‚æœå”¤ç«¯å¤±è´¥ï¼ˆAPP æœªå®‰è£…ï¼‰ï¼Œæˆ‘ä»¬æ€»æ˜¯è¦åšä¸€äº›å¤„ç†çš„ï¼Œå¯ä»¥æ˜¯è·³è½¬ä¸‹è½½é¡µï¼Œå¯ä»¥æ˜¯ ios ä¸‹è·³è½¬ App Storeâ€¦ ä½†æ˜¯Js å¹¶ä¸èƒ½æä¾›ç»™æˆ‘ä»¬è·å– APP å”¤èµ·çŠ¶æ€çš„èƒ½åŠ›ï¼ŒAndroid Intent ä»¥åŠ Universal Link å€’æ˜¯ä¸ç”¨æ‹…å¿ƒï¼Œå®ƒä»¬ä¿©çš„è‡ªèº«æœºåˆ¶å…è®¸å®ƒä»¬å”¤ç«¯å¤±è´¥åç›´æ¥å¯¼èˆªè‡³ç›¸åº”çš„é¡µé¢ï¼Œä½†æ˜¯ URL Scheme å¹¶ä¸å…·å¤‡è¿™æ ·çš„èƒ½åŠ›ï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½é€šè¿‡ä¸€äº›å¾ˆ hack çš„æ–¹å¼æ¥å®ç° APP å”¤èµ·æ£€æµ‹åŠŸèƒ½ã€‚</p>
<pre><code>const initialTime = newDate();
let counter = 0;
let waitTime = 0;

const checkOpen = setInterval(() =&gt; {
   count++;
   waitTime = newDate() - initialTime;

   if (waitTime &gt; 2500) {
      clearInterval(checkOpen);
      cb();
   }

   if (counter &lt; 100) return;

   clearInterval(checkOpen);

   const hide = document.hidden || document.webkitHidden;

   if (!hide) {
      cb(); // å”¤ç«¯å¤±è´¥çš„å›è°ƒå‡½æ•°
   }
}, 20);
</code></pre><p>APP å¦‚æœè¢«å”¤èµ·çš„è¯ï¼Œé¡µé¢å°±ä¼šè¿›å…¥åå°è¿è¡Œï¼ŒsetInterval åœ¨ ios ä¸­ä¸ä¼šåœæ­¢è¿è¡Œï¼Œåœ¨ android ä¸­åœæ­¢è¿è¡Œã€‚</p>
<p>æ¯ 20ms æ‰§è¡Œä¸€æ¬¡ï¼Œæ‰§è¡Œ 100æ¬¡ åœ¨é¡µé¢ä¸­å®é™…è€—è´¹ä¸ 2000 ms ä¸ä¼šç›¸å·®å¤šå°‘ã€‚</p>
<p>æˆ‘ä»¬çš„åˆ¤æ–­æ¡ä»¶æ¯”é¢„æœŸæ—¶é—´å¤šè®¾ç½®äº† 500msï¼Œæ‰€ä»¥å¦‚æœå®‰å“ä¸­ setInterval å†…çš„å‡½æ•°æ‰§è¡Œ 100 æ¬¡ä»¥å†…æ‰€è´¹æ—¶é—´è¶…è¿‡ 2500msï¼Œåˆ™è¯´æ˜ APP å”¤èµ·æˆåŠŸï¼Œåä¹‹åˆ™ä»£è¡¨å¤±è´¥ã€‚</p>
<p>æˆ‘ä»¬é€šè¿‡ document.hidden å’Œ document.webkitHidden å±æ€§æ¥åˆ¤æ–­ APP åœ¨ ios ä¸­æ˜¯å¦è¢«æ­£å¸¸å”¤èµ·ï¼Œ2000ms å†…ï¼Œé¡µé¢è½¬å…¥åå°è¿è¡Œï¼Œdocument.hidden ä¼šè¿”å› trueï¼Œä»£è¡¨å”¤ç«¯æˆåŠŸï¼Œåä¹‹åˆ™ä»£è¡¨å¤±è´¥ã€‚</p>
<h2 id="æ²¡æœ‰å®Œç¾çš„æ–¹æ¡ˆ"><a href="#æ²¡æœ‰å®Œç¾çš„æ–¹æ¡ˆ" class="headerlink" title="æ²¡æœ‰å®Œç¾çš„æ–¹æ¡ˆ"></a>æ²¡æœ‰å®Œç¾çš„æ–¹æ¡ˆ</h2><p>é€è¿‡ä¸Šé¢çš„å‡ ä¸ªç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œæ— è®ºæ˜¯ <em>å”¤ç«¯åª’ä»‹</em> ã€ <em>è°ƒç”¨å”¤ç«¯åª’ä»‹</em> è¿˜æ˜¯ <em>åˆ¤æ–­å”¤ç«¯ç»“æœ</em> éƒ½æ²¡æœ‰ä¸€ä¸ªåå…¨åç¾çš„æ–¹æ³•ï¼Œæˆ‘ä»¬åœ¨ä»£ç å±‚ä¸Šèƒ½åšçš„åªæ˜¯åœ¨ç¡®ä¿æœ€å¸¸ç”¨çš„åœºæ™¯ï¼ˆæ¯”å¦‚ å¾®ä¿¡ã€å¾®åšã€æ‰‹ç™¾ ç­‰ï¼‰å”¤ç«¯æ— è¯¯çš„æƒ…å†µä¸‹ï¼Œæœ€å¤§åŒ–çš„å…¼å®¹å‰©ä½™çš„åœºæ™¯ã€‚</p>
<p>å¥½çš„ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥æ‰¯ä¸€äº›ä»£ç ä»¥å¤–çš„ï¼Œè®©æˆ‘ä»¬çš„ APP èƒ½å¤Ÿåœ¨æ›´å¤šçš„å¹³å°å”¤èµ·ã€‚</p>
<ul>
<li>å¾®ä¿¡ã€å¾®åšã€æ‰‹ç™¾ã€QQæµè§ˆå™¨ç­‰ã€‚</li>
</ul>
<p>è¿™äº›åº”ç”¨èƒ½é˜»æ­¢å”¤ç«¯æ˜¯å› ä¸ºå®ƒä»¬ç›´æ¥å±è”½æ‰äº† URL Scheme ã€‚æ¥ä¸‹æ¥å¯èƒ½å°±æœ‰çœ‹å®˜ç–‘æƒ‘äº†ï¼Œå¾®ä¿¡ä¸­æ˜¯å¯ä»¥æ‰“å¼€å¤§ä¼—ç‚¹è¯„çš„å‘€ï¼Œå¾®åšé‡Œé¢å¯ä»¥æ‰“å¼€ä¼˜é…·å‘€ï¼Œé‚£æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ</p>
<p>å®ƒä»¬éƒ½å„è‡ªç»´æŠ¤ç€ä¸€ä¸ªç™½åå•ï¼Œå¦‚æœä½ çš„åŸŸååœ¨ç™½åå•å†…ï¼Œé‚£è¿™ä¸ªåŸŸåä¸‹æ‰€æœ‰çš„é¡µé¢å‘èµ·çš„ URL Scheme å°±éƒ½ä¼šè¢«å…è®¸ã€‚å°±åƒå¾®ä¿¡ï¼Œå¦‚æœä½ æ˜¯è…¾è®¯çš„â€œå®¶å±â€ï¼Œä½ å°±å¯ä»¥åŠ å…¥ç™½åå•äº†ï¼Œå¾®ä¿¡çš„ç™½åå•ä¸€èˆ¬åªåŒ…å«ç€â€œå®¶å±â€ï¼Œé™¤æ­¤å¤–å¾ˆéš¾ç”³è¯·åˆ°ç™½åå•èµ„è´¨ã€‚ä½†æ˜¯å¾®åšä¹‹ç±»çš„éƒ½æ˜¯å¯ä»¥è”ç³»ä»–ä»¬çš„æ¸ é“ç«¥é‹è¿›è¡Œç”³è¯·çš„ï¼Œåªæ˜¯æ¡ä»¶å„ä¸ç›¸åŒï¼Œæ¯”å¦‚å¾®åšçš„å°±æ˜¯åœ¨ä½ çš„ APP ä¸­æ·»åŠ æ‰“å¼€å¾®åšçš„å…¥å£ï¼Œä¸‰ä¸ªæœˆå†…å”¤èµ·è¶…è¿‡ 100w æ¬¡ï¼Œå°±å¯ä»¥åŠ å…¥ç™½åå•äº†ã€‚</p>
<ul>
<li>è…¾è®¯åº”ç”¨å®ç›´æ¥æ‰“å¼€ APP çš„æŸä¸ªåŠŸèƒ½</li>
</ul>
<p>åˆšåˆšæˆ‘ä»¬è¯´åˆ°ï¼Œå¦‚æœä½ ä¸æ˜¯å¾®ä¿¡çš„å®¶å±ï¼Œé‚£ä½ æ˜¯å¾ˆéš¾è¿›å…¥ç™½åå•çš„ï¼Œæ‰€ä»¥åœ¨å®‰å“ä¸­æˆ‘ä»¬ä¸€èˆ¬éƒ½æ˜¯ç›´æ¥æ‰“å¼€è…¾è®¯åº”ç”¨å®ï¼Œios ä¸­ ç›´æ¥æ‰“å¼€ App Storeã€‚ç‚¹å‡»è…¾è®¯åº”ç”¨å®ä¸­çš„â€œæ‰“å¼€â€æŒ‰é’®ï¼Œå¯ä»¥ç›´æ¥å”¤èµ·æˆ‘ä»¬çš„ APPï¼Œä½†æ˜¯æ— æ³•æ‰“å¼€ APP ä¸­çš„æŸä¸ªåŠŸèƒ½ï¼ˆå°±æ˜¯æ— æ³•æ‰“å¼€æŒ‡å®šé¡µé¢ï¼‰ã€‚</p>
<p>è…¾è®¯åº”ç”¨å®å¯¹å¤–å¼€æ”¾äº†ä¸€ä¸ªå«åš APP Link çš„ç”³è¯·ï¼Œåªè¦ä½ ç”³è¯·äº† APP Linkï¼Œå°±å¯ä»¥é€šè¿‡åœ¨æ‰“å¼€åº”ç”¨å®çš„æ—¶å€™åœ¨åº”ç”¨å®åœ°å€åé¢æ·»åŠ ä¸Š <code>&amp;android_schema={your_scheme}</code> ï¼Œæ¥æ‰“å¼€æŒ‡å®šçš„é¡µé¢äº†ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/03/Git-çš„-4-ä¸ªé˜¶æ®µçš„æ’¤é”€æ›´æ”¹/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/03/Git-çš„-4-ä¸ªé˜¶æ®µçš„æ’¤é”€æ›´æ”¹/" itemprop="url">Git çš„ 4 ä¸ªé˜¶æ®µçš„æ’¤é”€æ›´æ”¹</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-11-03T13:07:36+08:00">
                2017-11-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Git-è¯¯æ“ä½œæ•‘å‘½ç¯‡ä¸€ï¼š-å¦‚ä½•å°†æ”¹åŠ¨æ’¤é”€ï¼Ÿ"><a href="#Git-è¯¯æ“ä½œæ•‘å‘½ç¯‡ä¸€ï¼š-å¦‚ä½•å°†æ”¹åŠ¨æ’¤é”€ï¼Ÿ" class="headerlink" title="Git è¯¯æ“ä½œæ•‘å‘½ç¯‡ä¸€ï¼š å¦‚ä½•å°†æ”¹åŠ¨æ’¤é”€ï¼Ÿ"></a><a href="https://zhuanlan.zhihu.com/p/42929114" target="_blank" rel="noopener">Git è¯¯æ“ä½œæ•‘å‘½ç¯‡ä¸€ï¼š å¦‚ä½•å°†æ”¹åŠ¨æ’¤é”€ï¼Ÿ</a></h2><p>è™½ç„¶gitè¯ç”Ÿè·ä»Šå·²æœ‰12å¹´ä¹‹ä¹…ï¼Œç½‘ä¸Šå„ç§å…³äºgitçš„ä»‹ç»æ–‡ç« æ•°ä¸èƒœæ•°ï¼Œä½†æ˜¯ä¾ç„¶æœ‰å¾ˆå¤šäººï¼ˆåŒ…æ‹¬æˆ‘è‡ªå·±åœ¨å†…ï¼‰å¯¹äºå®ƒçš„åŠŸèƒ½ä¸èƒ½å®Œå…¨æŒæ¡ã€‚ä»¥ä¸‹çš„ä»‹ç»åªæ˜¯åŸºäºæˆ‘ä¸ªäººå¯¹äºgitçš„ç†è§£ï¼Œå¹¶ä¸”å¯èƒ½ç”Ÿç¼–ç¡¬é€ äº†ä¸€äº›ä¸å®Œå…¨ç¬¦åˆgitè¯´æ³•çš„è¯è¯­ã€‚ç›®çš„åªæ˜¯ä¸ºäº†è®©gité€šä¿—åŒ–ï¼Œä½¿åˆå­¦è€…ä¹Ÿèƒ½å¤§æ¦‚äº†è§£å¦‚ä½•å¿«é€Ÿä¸Šæ‰‹gitã€‚åŒæ—¶ï¼Œä¸‹é¢æ‰€æœ‰è®¨è®ºï¼Œæˆ‘ä»¬éƒ½å‡è®¾åªä½¿ç”¨ä¸€ä¸ªåˆ†æ”¯ï¼Œä¹Ÿå°±æ˜¯ä¸»åˆ†æ”¯masterçš„æƒ…å†µï¼Œè™½ç„¶è¿™ç§ä½œæ³•å¹¶ä¸ç¬¦åˆgitè§„èŒƒï¼Œä½†æ˜¯ç°å®æƒ…å†µä¸­ç»å¤§éƒ¨åˆ†ç”¨æˆ·æ˜¯ç›´æ¥åœ¨masteråˆ†æ”¯ä¸Šè¿›è¡Œå·¥ä½œçš„ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œæˆ‘ä»¬ä¸å»å¼•å…¥æ›´åŠ å¤æ‚çš„å„ç§åˆ†æ”¯çš„æƒ…å†µï¼Œä¹Ÿä¸æ¶‰åŠæ ‡ç­¾tagçš„æ“ä½œï¼Œåªè®²åœ¨æœ€ç®€å•çš„ä¸»åˆ†æ”¯ä¸Šå¦‚ä½•å›é€€ã€‚</p>
<h1 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a><strong>åŸºæœ¬æ¦‚å¿µ</strong></h1><h2 id="3ä¸ªæ­¥éª¤"><a href="#3ä¸ªæ­¥éª¤" class="headerlink" title="3ä¸ªæ­¥éª¤"></a><strong>3ä¸ªæ­¥éª¤</strong></h2><p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/9aPYe0E1fb1el0zsnhYXiadWS9DtUkHnwzsRUe3nJiclZIHpg0Mc2EYjcdSxicXjJSJDs9bOYlNEHbwJZzibibQxKpg/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt=""></p>
<p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„å·¥ä½œæµå°±æ˜¯3ä¸ªæ­¥éª¤ï¼Œå¯¹åº”ä¸Šå›¾ä¸­çš„3ä¸ªç®­å¤´çº¿ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">  git add .</span><br><span class="line">  </span><br><span class="line">  git commit -m &quot;comment&quot;</span><br><span class="line">  </span><br><span class="line">  git push</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">git add .æŠŠæ‰€æœ‰æ–‡ä»¶æ”¾å…¥æš‚å­˜åŒºï¼›</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">git commitæŠŠæ‰€æœ‰æ–‡ä»¶ä»æš‚å­˜åŒºæäº¤è¿›æœ¬åœ°ä»“åº“ï¼›</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">git pushæŠŠæ‰€æœ‰æ–‡ä»¶ä»æœ¬åœ°ä»“åº“æ¨é€è¿›è¿œç¨‹ä»“åº“ã€‚</span><br></pre></td></tr></table></figure></p>
<h2 id="4ä¸ªåŒº"><a href="#4ä¸ªåŒº" class="headerlink" title="4ä¸ªåŒº"></a><strong>4ä¸ªåŒº</strong></h2><p>gitä¹‹æ‰€ä»¥ä»¤äººè´¹è§£ï¼Œä¸»è¦æ˜¯å®ƒç›¸æ¯”äºsvnç­‰ç­‰ä¼ ç»Ÿçš„ç‰ˆæœ¬ç®¡ç†å·¥å…·ï¼Œå¤šå¼•å…¥äº†ä¸€ä¸ªæš‚å­˜åŒº(Stage)çš„æ¦‚å¿µï¼Œå°±å› ä¸ºå¤šäº†è¿™ä¸€ä¸ªæ¦‚å¿µï¼Œè€Œä½¿å¾ˆå¤šäººç–‘æƒ‘ã€‚å…¶å®ï¼Œåœ¨åˆå­¦è€…æ¥è¯´ï¼Œæ¯ä¸ªåŒºå…·ä½“æ€ä¹ˆå·¥ä½œçš„ï¼Œæˆ‘ä»¬å®Œå…¨ä¸éœ€è¦å…³å¿ƒï¼Œè€Œåªè¦çŸ¥é“æœ‰è¿™ä¹ˆ4ä¸ªåŒºå°±å¤Ÿäº†ï¼š</p>
<ul>
<li><p>å·¥ä½œåŒº(Working Area)</p>
</li>
<li><p>æš‚å­˜åŒº(Stage)</p>
</li>
<li><p>æœ¬åœ°ä»“åº“(Local Repository)</p>
</li>
<li><p>è¿œç¨‹ä»“åº“(Remote Repository)</p>
</li>
</ul>
<h2 id="5ç§çŠ¶æ€"><a href="#5ç§çŠ¶æ€" class="headerlink" title="5ç§çŠ¶æ€"></a><strong>5ç§çŠ¶æ€</strong></h2><p>ä»¥ä¸Š4ä¸ªåŒºï¼Œè¿›å…¥æ¯ä¸€ä¸ªåŒºæˆåŠŸä¹‹åä¼šäº§ç”Ÿä¸€ä¸ªçŠ¶æ€ï¼Œå†åŠ ä¸Šæœ€åˆå§‹çš„ä¸€ä¸ªçŠ¶æ€ï¼Œä¸€å…±æ˜¯5ç§çŠ¶æ€ã€‚ä»¥ä¸‹æˆ‘ä»¬æŠŠè¿™5ç§çŠ¶æ€åˆ†åˆ«å‘½åä¸ºï¼š</p>
<ul>
<li><p>æœªä¿®æ”¹(Origin)</p>
</li>
<li><p>å·²ä¿®æ”¹(Modified)</p>
</li>
<li><p>å·²æš‚å­˜(Staged)</p>
</li>
<li><p>å·²æäº¤(Committed)</p>
</li>
<li><p>å·²æ¨é€(Pushed)</p>
</li>
</ul>
<h1 id="æ£€æŸ¥ä¿®æ”¹"><a href="#æ£€æŸ¥ä¿®æ”¹" class="headerlink" title="æ£€æŸ¥ä¿®æ”¹"></a><strong>æ£€æŸ¥ä¿®æ”¹</strong></h1><p>äº†è§£äº†åŸºæœ¬æ¦‚å¿µä¹‹åï¼Œæˆ‘ä»¬æ¥è°ˆä¸€è°ˆçŠ¯é”™è¯¯ä¹‹åå¦‚ä½•æ’¤é”€çš„é—®é¢˜ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬è¦äº†è§£å¦‚ä½•æ£€æŸ¥è¿™3ä¸ªæ­¥éª¤å½“ä¸­æ¯ä¸€ä¸ªæ­¥éª¤ä¿®æ”¹äº†ä»€ä¹ˆï¼Œç„¶åæ‰å¥½åˆ¤æ–­æœ‰æ²¡æœ‰ä¿®æ”¹æˆåŠŸã€‚æ£€æŸ¥ä¿®æ”¹çš„äºŒçº§å‘½ä»¤éƒ½ç›¸åŒï¼Œéƒ½æ˜¯diffï¼Œåªæ˜¯å‚æ•°æœ‰æ‰€ä¸åŒã€‚</p>
<h2 id="å·²ä¿®æ”¹ï¼Œæœªæš‚å­˜"><a href="#å·²ä¿®æ”¹ï¼Œæœªæš‚å­˜" class="headerlink" title="å·²ä¿®æ”¹ï¼Œæœªæš‚å­˜"></a><strong>å·²ä¿®æ”¹ï¼Œæœªæš‚å­˜</strong></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git diff</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬åªæ˜¯ç®€å•åœ°åœ¨æµè§ˆå™¨é‡Œä¿å­˜äº†ä¸€ä¸‹æ–‡ä»¶ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰åšgit add .ä¹‹å‰ï¼Œæˆ‘ä»¬å¦‚ä½•æ£€æŸ¥æœ‰å“ªäº›ä¿®æ”¹ã€‚æˆ‘ä»¬å…ˆéšä¾¿æ‹¿ä¸€ä¸ªæ–‡ä»¶æ¥åšä¸€ä¸‹å®éªŒï¼š</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/9aPYe0E1fb1el0zsnhYXiadWS9DtUkHnwDg9nsy9V0Ra5nMdBquNG1HpYFaOazjo6vl1LPHJpjMia8ibicSXu0Svyw/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt=""></p>
<p>æˆ‘ä»¬åœ¨æ–‡ä»¶å¼€å¤´çš„ç¬¬2è¡Œèƒ¡ä¹±åŠ äº†4ä¸ªæ•°å­—1234ï¼Œå­˜ç›˜ï¼Œè¿™æ—¶æ–‡ä»¶è¿›å…¥äº†å·²ä¿®æ”¹çŠ¶æ€ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰è¿›å…¥æš‚å­˜åŒºï¼Œæˆ‘ä»¬è¿è¡Œgit diffï¼Œç»“æœå¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">diff --git a/index.md b/index.md</span><br><span class="line"></span><br><span class="line">index 73ff1ba..1066758 100644</span><br><span class="line"></span><br><span class="line">--- a/index.md</span><br><span class="line"></span><br><span class="line">+++ b/index.md</span><br><span class="line"></span><br><span class="line">@@ -1,5 +1,5 @@</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">-layout: main</span><br><span class="line"></span><br><span class="line">+1234layout: main</span><br><span class="line"></span><br><span class="line">color: black</span><br><span class="line"></span><br><span class="line">---</span><br></pre></td></tr></table></figure></p>
<p>git diffçš„ç»“æœå‘Šè¯‰æˆ‘ä»¬å“ªäº›æ–‡ä»¶å·²ç»åšäº†å“ªäº›ä¿®æ”¹ã€‚</p>
<p><strong>å·²æš‚å­˜ï¼Œæœªæäº¤</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git diff --cached</span><br></pre></td></tr></table></figure></p>
<p>ç°åœ¨æˆ‘ä»¬æŠŠä¿®æ”¹æ”¾å…¥æš‚å­˜åŒºçœ‹ä¸€ä¸‹ã€‚å…ˆæ‰§è¡Œgit add .ï¼Œç„¶åæ‰§è¡Œgit diffï¼Œä½ ä¼šå‘ç°æ²¡æœ‰ä»»ä½•ç»“æœï¼š</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/9aPYe0E1fb1el0zsnhYXiadWS9DtUkHnwXwBzS1lToMWWjy9lEibicoiaibAAAaZa1HCp2j6v52OTN1cjRDia7VTVE6w/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt=""></p>
<p>è¿™è¯´æ˜git diffè¿™ä¸ªå‘½ä»¤åªæ£€æŸ¥æˆ‘ä»¬çš„å·¥ä½œåŒºå’Œæš‚å­˜åŒºä¹‹é—´çš„å·®å¼‚ï¼Œå¦‚æœæˆ‘ä»¬æƒ³çœ‹åˆ°æš‚å­˜åŒºå’Œæœ¬åœ°ä»“åº“ä¹‹é—´çš„å·®å¼‚ï¼Œå°±éœ€è¦åŠ ä¸€ä¸ªå‚æ•°git diff â€“cachedï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">diff --git a/index.md b/index.md</span><br><span class="line"></span><br><span class="line">index 73ff1ba..1066758 100644</span><br><span class="line"></span><br><span class="line">--- a/index.md</span><br><span class="line"></span><br><span class="line">+++ b/index.md</span><br><span class="line"></span><br><span class="line">@@ -1,5 +1,5 @@</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">-layout: main</span><br><span class="line"></span><br><span class="line">+1234layout: main</span><br><span class="line"></span><br><span class="line">color: black</span><br><span class="line"></span><br><span class="line">---</span><br></pre></td></tr></table></figure></p>
<p>è¿™æ—¶å€™æˆ‘ä»¬çœ‹åˆ°çš„å·®å¼‚æ˜¯æš‚å­˜åŒºå’Œæœ¬åœ°ä»“åº“ä¹‹é—´çš„å·®å¼‚ã€‚</p>
<p><strong>å·²æäº¤ï¼Œæœªæ¨é€</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git diff master origin/master</span><br></pre></td></tr></table></figure></p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬æŠŠä¿®æ”¹ä»æš‚å­˜åŒºæäº¤åˆ°æœ¬åœ°ä»“åº“ï¼Œå†çœ‹ä¸€ä¸‹å·®å¼‚ã€‚å…ˆæ‰§è¡Œgit commitï¼Œç„¶åå†æ‰§è¡Œgit diff â€“cachedï¼Œæ²¡æœ‰å·®å¼‚ï¼Œæ‰§è¡Œgit diff master origin/masterï¼Œå¯ä»¥çœ‹åˆ°å·®å¼‚ï¼š</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/9aPYe0E1fb1el0zsnhYXiadWS9DtUkHnwNSkuZnLBptQUSBddcyOZURahoMau6Rq0cebaYVniaudrh3kXToVj6WA/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt=""></p>
<p>åœ¨è¿™é‡Œï¼Œmasterå°±æ˜¯ä½ çš„æœ¬åœ°ä»“åº“ï¼Œè€Œorigin/masterå°±æ˜¯ä½ çš„è¿œç¨‹ä»“åº“ï¼Œmasteræ˜¯ä¸»åˆ†æ”¯çš„æ„æ€ï¼Œå› ä¸ºæˆ‘ä»¬éƒ½åœ¨ä¸»åˆ†æ”¯ä¸Šå·¥ä½œï¼Œæ‰€ä»¥è¿™é‡Œä¸¤è¾¹éƒ½æ˜¯masterï¼Œè€Œoriginå°±ä»£è¡¨è¿œç¨‹ã€‚</p>
<h1 id="æ’¤é”€ä¿®æ”¹"><a href="#æ’¤é”€ä¿®æ”¹" class="headerlink" title="æ’¤é”€ä¿®æ”¹"></a><strong>æ’¤é”€ä¿®æ”¹</strong></h1><p>äº†è§£æ¸…æ¥šå¦‚ä½•æ£€æŸ¥å„ç§ä¿®æ”¹ä¹‹åï¼Œæˆ‘ä»¬å¼€å§‹å°è¯•å„ç§æ’¤é”€æ“ä½œã€‚</p>
<h2 id="å·²ä¿®æ”¹ï¼Œæœªæš‚å­˜-1"><a href="#å·²ä¿®æ”¹ï¼Œæœªæš‚å­˜-1" class="headerlink" title="å·²ä¿®æ”¹ï¼Œæœªæš‚å­˜"></a><strong>å·²ä¿®æ”¹ï¼Œæœªæš‚å­˜</strong></h2><p>å¦‚æœæˆ‘ä»¬åªæ˜¯åœ¨ç¼–è¾‘å™¨é‡Œä¿®æ”¹äº†æ–‡ä»¶ï¼Œä½†è¿˜æ²¡æœ‰æ‰§è¡Œgit add .ï¼Œè¿™æ—¶å€™æˆ‘ä»¬çš„æ–‡ä»¶è¿˜åœ¨å·¥ä½œåŒºï¼Œå¹¶æ²¡æœ‰è¿›å…¥æš‚å­˜åŒºï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> git checkout .</span><br><span class="line"></span><br><span class="line">æˆ–è€…</span><br><span class="line"></span><br><span class="line">  git reset --hard</span><br></pre></td></tr></table></figure></p>
<p>æ¥è¿›è¡Œæ’¤é”€æ“ä½œã€‚</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/9aPYe0E1fb1el0zsnhYXiadWS9DtUkHnw3vn4WgIpIIyGGweDCXuZzlhpOwS62ibmJNjwviaXsCp9bwshpI9KAKBQ/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt=""></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æ‰§è¡Œå®Œgit checkout .ä¹‹åï¼Œä¿®æ”¹å·²è¢«æ’¤é”€ï¼Œgit diffæ²¡æœ‰ä»»ä½•å†…å®¹äº†ã€‚</p>
<blockquote>
<p>ä¸€å¯¹åä¹‰è¯ git add .çš„åä¹‰è¯æ˜¯git checkout .ã€‚åšå®Œä¿®æ”¹ä¹‹åï¼Œå¦‚æœä½ æƒ³å‘å‰èµ°ä¸€æ­¥ï¼Œè®©ä¿®æ”¹è¿›å…¥æš‚å­˜åŒºï¼Œå°±æ‰§è¡Œgit add .ï¼Œå¦‚æœä½ æƒ³å‘åé€€ä¸€æ­¥ï¼Œæ’¤é”€åˆšæ‰çš„ä¿®æ”¹ï¼Œå°±æ‰§è¡Œgit checkout .ã€‚</p>
</blockquote>
<h2 id="å·²æš‚å­˜ï¼Œæœªæäº¤"><a href="#å·²æš‚å­˜ï¼Œæœªæäº¤" class="headerlink" title="å·²æš‚å­˜ï¼Œæœªæäº¤"></a><strong>å·²æš‚å­˜ï¼Œæœªæäº¤</strong></h2><p>ä½ å·²ç»æ‰§è¡Œäº†git add .ï¼Œä½†è¿˜æ²¡æœ‰æ‰§è¡Œgit commit -m â€œcommentâ€ã€‚è¿™æ—¶å€™ä½ æ„è¯†åˆ°äº†é”™è¯¯ï¼Œæƒ³è¦æ’¤é”€ï¼Œä½ å¯ä»¥æ‰§è¡Œï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git reset</span><br><span class="line"></span><br><span class="line">git checkout .</span><br></pre></td></tr></table></figure></p>
<p>æˆ–è€…<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reset --hard</span><br></pre></td></tr></table></figure></p>
<p>git resetåªæ˜¯æŠŠä¿®æ”¹é€€å›åˆ°äº†git add .ä¹‹å‰çš„çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¯´æ–‡ä»¶æœ¬èº«è¿˜å¤„äºå·²ä¿®æ”¹æœªæš‚å­˜çŠ¶æ€ï¼Œä½ å¦‚æœæƒ³é€€å›æœªä¿®æ”¹çŠ¶æ€ï¼Œè¿˜éœ€è¦æ‰§è¡Œgit checkout .ã€‚</p>
<p>æˆ–è®¸ä½ å·²ç»æ³¨æ„åˆ°äº†ï¼Œä»¥ä¸Šä¸¤ä¸ªæ­¥éª¤éƒ½å¯ä»¥ç”¨åŒä¸€ä¸ªå‘½ä»¤git reset â€“hardæ¥å®Œæˆã€‚æ˜¯çš„ï¼Œå°±æ˜¯è¿™ä¸ªå¼ºå¤§çš„å‘½ä»¤ï¼Œå¯ä»¥ä¸€æ­¥åˆ°ä½åœ°æŠŠä½ çš„ä¿®æ”¹å®Œå…¨æ¢å¤åˆ°æœªä¿®æ”¹çš„çŠ¶æ€ã€‚</p>
<p><strong>å·²æäº¤ï¼Œæœªæ¨é€</strong></p>
<p>ä½ çš„æ‰‹å¤ªå¿«ï¼Œä½ æ—¢æ‰§è¡Œäº†git add .ï¼Œåˆæ‰§è¡Œäº†git commitï¼Œè¿™æ—¶å€™ä½ çš„ä»£ç å·²ç»è¿›å…¥äº†ä½ çš„æœ¬åœ°ä»“åº“ï¼Œç„¶è€Œä½ åæ‚”äº†ï¼Œæ€ä¹ˆåŠï¼Ÿä¸è¦ç€æ€¥ï¼Œè¿˜æœ‰åŠæ³•ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reset --hard origin/master</span><br></pre></td></tr></table></figure></p>
<p>è¿˜æ˜¯è¿™ä¸ªgit reset â€“hardå‘½ä»¤ï¼Œåªä¸è¿‡è¿™æ¬¡å¤šäº†ä¸€ä¸ªå‚æ•°origin/masterï¼Œæ­£å¦‚æˆ‘ä»¬ä¸Šé¢è®²è¿‡çš„ï¼Œorigin/masterä»£è¡¨è¿œç¨‹ä»“åº“ï¼Œæ—¢ç„¶ä½ å·²ç»æ±¡æŸ“äº†ä½ çš„æœ¬åœ°ä»“åº“ï¼Œé‚£ä¹ˆå°±ä»è¿œç¨‹ä»“åº“æŠŠä»£ç å–å›æ¥å§ã€‚</p>
<p><strong>å·²æ¨é€</strong></p>
<p>å¾ˆä¸å¹¸ï¼Œä½ çš„æ‰‹å®åœ¨æ˜¯å¤ªå¿«äº†ï¼Œä½ æ—¢git addäº†ï¼Œåˆgit commitäº†ï¼Œå¹¶ä¸”è¿˜git pushäº†ï¼Œè¿™æ—¶ä½ çš„ä»£ç å·²ç»è¿›å…¥è¿œç¨‹ä»“åº“ã€‚å¦‚æœä½ æƒ³æ¢å¤çš„è¯ï¼Œè¿˜å¥½ï¼Œç”±äºä½ çš„æœ¬åœ°ä»“åº“å’Œè¿œç¨‹ä»“åº“æ˜¯ç­‰ä»·çš„ï¼Œä½ åªéœ€è¦å…ˆæ¢å¤æœ¬åœ°ä»“åº“ï¼Œå†å¼ºåˆ¶pushåˆ°è¿œç¨‹ä»“åº“å°±å¥½äº†ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git reset --hard HEAD^</span><br><span class="line"></span><br><span class="line">git push -f</span><br></pre></td></tr></table></figure></p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/9aPYe0E1fb1el0zsnhYXiadWS9DtUkHnwCtsdla2FrJ4nCjP0tBssNeB7ZqBkQON4Jcxb2ghrAUEibNa2icoiaB3cg/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt=""></p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a><strong>æ€»ç»“</strong></h1><p>ä»¥ä¸Š4ç§çŠ¶æ€çš„æ’¤é”€æˆ‘ä»¬éƒ½ç”¨åˆ°äº†åŒä¸€ä¸ªå‘½ä»¤git reset â€“hardï¼Œå‰2ç§çŠ¶æ€çš„ç”¨æ³•ç”šè‡³å®Œå…¨ä¸€æ ·ï¼Œæ‰€ä»¥åªè¦æŒæ¡äº†git reset â€“hardè¿™ä¸ªå‘½ä»¤çš„ç”¨æ³•ï¼Œä»æ­¤ä½ å†ä¹Ÿä¸ç”¨æ‹…å¿ƒæäº¤é”™è¯¯äº†ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/29/ä»Vue-jsæºç çœ‹nextTickæœºåˆ¶/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/29/ä»Vue-jsæºç çœ‹nextTickæœºåˆ¶/" itemprop="url">ä»Vue.jsæºç çœ‹nextTickæœºåˆ¶</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-10-29T22:30:13+08:00">
                2017-10-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://link.zhihu.com/?target=https%3A//chuckliu.me/%23%21/posts/58bd08a2b5187d2fb51c04f9" target="_blank" rel="noopener">Vueæºç è¯¦è§£ä¹‹nextTickï¼šMutationObserveråªæ˜¯æµ®äº‘ï¼Œmicrotaskæ‰æ˜¯æ ¸å¿ƒï¼</a></p>
<h2 id="å¯èƒ½ä¼šæœ‰ç†è§£å­˜åœ¨åå·®çš„åœ°æ–¹ï¼Œæ¬¢è¿å¤§ç¥æ–§æ­£ï¼Œå…±åŒå­¦ä¹ ï¼Œå…±åŒè¿›æ­¥ã€‚"><a href="#å¯èƒ½ä¼šæœ‰ç†è§£å­˜åœ¨åå·®çš„åœ°æ–¹ï¼Œæ¬¢è¿å¤§ç¥æ–§æ­£ï¼Œå…±åŒå­¦ä¹ ï¼Œå…±åŒè¿›æ­¥ã€‚" class="headerlink" title="å¯èƒ½ä¼šæœ‰ç†è§£å­˜åœ¨åå·®çš„åœ°æ–¹ï¼Œæ¬¢è¿å¤§ç¥æ–§æ­£ï¼Œå…±åŒå­¦ä¹ ï¼Œå…±åŒè¿›æ­¥ã€‚"></a>å¯èƒ½ä¼šæœ‰ç†è§£å­˜åœ¨åå·®çš„åœ°æ–¹ï¼Œæ¬¢è¿å¤§ç¥æ–§æ­£ï¼Œå…±åŒå­¦ä¹ ï¼Œå…±åŒè¿›æ­¥ã€‚</h2><h2 id="æ“ä½œDOM"><a href="#æ“ä½œDOM" class="headerlink" title="æ“ä½œDOM"></a>æ“ä½œDOM</h2><p>åœ¨ä½¿ç”¨vue.jsçš„æ—¶å€™ï¼Œæœ‰æ—¶å€™å› ä¸ºä¸€äº›ç‰¹å®šçš„ä¸šåŠ¡åœºæ™¯ï¼Œä¸å¾—ä¸å»æ“ä½œDOMï¼Œæ¯”å¦‚è¿™æ ·ï¼š</p>
<pre><code>&lt;template&gt;
  &lt;div&gt;
    &lt;div ref=&quot;test&quot;&gt;{{test}}&lt;/div&gt;
    &lt;button @click=&quot;handleClick&quot;&gt;tet&lt;/button&gt;
  &lt;/div&gt;
&lt;/template&gt;
export default {
    data () {
        return {
            test: &apos;begin&apos;
        };
    },
    methods () {
        handleClick () {
            this.test = &apos;end&apos;;
            console.log(this.$refs.test.innerText);//æ‰“å°â€œbeginâ€
        }
    }
}
</code></pre><p>æ‰“å°çš„ç»“æœæ˜¯beginï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬æ˜æ˜å·²ç»å°†testè®¾ç½®æˆäº†â€œendâ€ï¼Œè·å–çœŸå®DOMèŠ‚ç‚¹çš„innerTextå´æ²¡æœ‰å¾—åˆ°æˆ‘ä»¬é¢„æœŸä¸­çš„â€œendâ€ï¼Œè€Œæ˜¯å¾—åˆ°ä¹‹å‰çš„å€¼â€œbeginâ€å‘¢ï¼Ÿ</p>
<h2 id="Watcheré˜Ÿåˆ—"><a href="#Watcheré˜Ÿåˆ—" class="headerlink" title="Watcheré˜Ÿåˆ—"></a>Watcheré˜Ÿåˆ—</h2><p>å¸¦ç€ç–‘é—®ï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†Vue.jsæºç çš„Watchå®ç°ã€‚å½“æŸä¸ªå“åº”å¼æ•°æ®å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œå®ƒçš„setterå‡½æ•°ä¼šé€šçŸ¥é—­åŒ…ä¸­çš„Depï¼ŒDepåˆ™ä¼šè°ƒç”¨å®ƒç®¡ç†çš„æ‰€æœ‰Watchå¯¹è±¡ã€‚è§¦å‘Watchå¯¹è±¡çš„updateå®ç°ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹updateçš„å®ç°ã€‚</p>
<pre><code>update () {
    /* istanbul ignore else */
    if (this.lazy) {
        this.dirty = true
    } else if (this.sync) {
        /*åŒæ­¥åˆ™æ‰§è¡Œrunç›´æ¥æ¸²æŸ“è§†å›¾*/
        this.run()
    } else {
        /*å¼‚æ­¥æ¨é€åˆ°è§‚å¯Ÿè€…é˜Ÿåˆ—ä¸­ï¼Œä¸‹ä¸€ä¸ªtickæ—¶è°ƒç”¨ã€‚*/
        queueWatcher(this)
    }
}
</code></pre><p>æˆ‘ä»¬å‘ç°Vue.jsé»˜è®¤æ˜¯ä½¿ç”¨<a href="https://link.zhihu.com/?target=https%3A//link.juejin.im/%3Ftarget%3Dhttps%253A%252F%252Fcn.vuejs.org%252Fv2%252Fguide%252Freactivity.html%2523%25E5%25BC%2582%25E6%25AD%25A5%25E6%259B%25B4%25E6%2596%25B0%25E9%2598%259F%25E5%2588%2597" target="_blank" rel="noopener">å¼‚æ­¥æ‰§è¡ŒDOMæ›´æ–°</a>ã€‚<br>å½“å¼‚æ­¥æ‰§è¡Œupdateçš„æ—¶å€™ï¼Œä¼šè°ƒç”¨queueWatcherå‡½æ•°ã€‚</p>
<pre><code>/*å°†ä¸€ä¸ªè§‚å¯Ÿè€…å¯¹è±¡pushè¿›è§‚å¯Ÿè€…é˜Ÿåˆ—ï¼Œåœ¨é˜Ÿåˆ—ä¸­å·²ç»å­˜åœ¨ç›¸åŒçš„idåˆ™è¯¥è§‚å¯Ÿè€…å¯¹è±¡å°†è¢«è·³è¿‡ï¼Œé™¤éå®ƒæ˜¯åœ¨é˜Ÿåˆ—è¢«åˆ·æ–°æ—¶æ¨é€*/
export function queueWatcher (watcher: Watcher) {
  /*è·å–watcherçš„id*/
  const id = watcher.id
  /*æ£€éªŒidæ˜¯å¦å­˜åœ¨ï¼Œå·²ç»å­˜åœ¨åˆ™ç›´æ¥è·³è¿‡ï¼Œä¸å­˜åœ¨åˆ™æ ‡è®°å“ˆå¸Œè¡¨hasï¼Œç”¨äºä¸‹æ¬¡æ£€éªŒ*/
  if (has[id] == null) {
    has[id] = true
    if (!flushing) {
      /*å¦‚æœæ²¡æœ‰flushæ‰ï¼Œç›´æ¥pushåˆ°é˜Ÿåˆ—ä¸­å³å¯*/
      queue.push(watcher)
    } else {
      // if already flushing, splice the watcher based on its id
      // if already past its id, it will be run next immediately.
      let i = queue.length - 1
      while (i &gt;= 0 &amp;&amp; queue[i].id &gt; watcher.id) {
        i--
      }
      queue.splice(Math.max(i, index) + 1, 0, watcher)
    }
    // queue the flush
    if (!waiting) {
      waiting = true
      nextTick(flushSchedulerQueue)
    }
  }
}
</code></pre><p>æŸ¥çœ‹queueWatcherçš„æºç æˆ‘ä»¬å‘ç°ï¼ŒWatchå¯¹è±¡å¹¶ä¸æ˜¯ç«‹å³æ›´æ–°è§†å›¾ï¼Œè€Œæ˜¯è¢«pushè¿›äº†ä¸€ä¸ªé˜Ÿåˆ—queueï¼Œæ­¤æ—¶çŠ¶æ€å¤„äºwaitingçš„çŠ¶æ€ï¼Œè¿™æ—¶å€™ä¼šç»§ç»­ä¼šæœ‰Watchå¯¹è±¡è¢«pushè¿›è¿™ä¸ªé˜Ÿåˆ—queueï¼Œç­‰å¾…ä¸‹ä¸€ä¸ªtickæ—¶ï¼Œè¿™äº›Watchå¯¹è±¡æ‰ä¼šè¢«éå†å–å‡ºï¼Œæ›´æ–°è§†å›¾ã€‚åŒæ—¶ï¼Œidé‡å¤çš„Watcherä¸ä¼šè¢«å¤šæ¬¡åŠ å…¥åˆ°queueä¸­å»ï¼Œå› ä¸ºåœ¨æœ€ç»ˆæ¸²æŸ“æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦å…³å¿ƒæ•°æ®çš„æœ€ç»ˆç»“æœã€‚</p>
<p>é‚£ä¹ˆï¼Œä»€ä¹ˆæ˜¯ä¸‹ä¸€ä¸ªtickï¼Ÿ</p>
<h2 id="nextTick"><a href="#nextTick" class="headerlink" title="nextTick"></a>nextTick</h2><p>vue.jsæä¾›äº†ä¸€ä¸ª<a href="https://link.zhihu.com/?target=https%3A//link.juejin.im/%3Ftarget%3Dhttps%253A%252F%252Fcn.vuejs.org%252Fv2%252Fapi%252F%2523Vue-nextTick" target="_blank" rel="noopener">nextTick</a>å‡½æ•°ï¼Œå…¶å®ä¹Ÿå°±æ˜¯ä¸Šé¢è°ƒç”¨çš„nextTickã€‚</p>
<p>nextTickçš„å®ç°æ¯”è¾ƒç®€å•ï¼Œæ‰§è¡Œçš„ç›®çš„æ˜¯åœ¨microtaskæˆ–è€…taskä¸­æ¨å…¥ä¸€ä¸ªfuntionï¼Œåœ¨å½“å‰æ ˆæ‰§è¡Œå®Œæ¯•ï¼ˆä¹Ÿè¡Œè¿˜ä¼šæœ‰ä¸€äº›æ’åœ¨å‰é¢çš„éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡ï¼‰ä»¥åæ‰§è¡ŒnextTickä¼ å…¥çš„funtionï¼Œçœ‹ä¸€ä¸‹æºç ï¼š</p>
<pre><code>/**
 * Defer a task to execute it asynchronously.
 */
 /*
    å»¶è¿Ÿä¸€ä¸ªä»»åŠ¡ä½¿å…¶å¼‚æ­¥æ‰§è¡Œï¼Œåœ¨ä¸‹ä¸€ä¸ªtickæ—¶æ‰§è¡Œï¼Œä¸€ä¸ªç«‹å³æ‰§è¡Œå‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªfunction
    è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯åœ¨taskæˆ–è€…microtaskä¸­æ¨å…¥ä¸€ä¸ªtimerFuncï¼Œ
    åœ¨å½“å‰è°ƒç”¨æ ˆæ‰§è¡Œå®Œä»¥åä»¥æ­¤æ‰§è¡Œç›´åˆ°æ‰§è¡Œåˆ°timerFunc
    ç›®çš„æ˜¯å»¶è¿Ÿåˆ°å½“å‰è°ƒç”¨æ ˆæ‰§è¡Œå®Œä»¥åæ‰§è¡Œ
*/
export const nextTick = (function () {
  /*å­˜æ”¾å¼‚æ­¥æ‰§è¡Œçš„å›è°ƒ*/
  const callbacks = []
  /*ä¸€ä¸ªæ ‡è®°ä½ï¼Œå¦‚æœå·²ç»æœ‰timerFuncè¢«æ¨é€åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­å»åˆ™ä¸éœ€è¦é‡å¤æ¨é€*/
  let pending = false
  /*ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼ŒæŒ‡å‘å‡½æ•°å°†è¢«æ¨é€åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œç­‰åˆ°ä¸»çº¿ç¨‹ä»»åŠ¡æ‰§è¡Œå®Œæ—¶ï¼Œä»»åŠ¡é˜Ÿåˆ—ä¸­çš„timerFuncè¢«è°ƒç”¨*/
  let timerFunc

  /*ä¸‹ä¸€ä¸ªtickæ—¶çš„å›è°ƒ*/
  function nextTickHandler () {
    /*ä¸€ä¸ªæ ‡è®°ä½ï¼Œæ ‡è®°ç­‰å¾…çŠ¶æ€ï¼ˆå³å‡½æ•°å·²ç»è¢«æ¨å…¥ä»»åŠ¡é˜Ÿåˆ—æˆ–è€…ä¸»çº¿ç¨‹ï¼Œå·²ç»åœ¨ç­‰å¾…å½“å‰æ ˆæ‰§è¡Œå®Œæ¯•å»æ‰§è¡Œï¼‰ï¼Œè¿™æ ·å°±ä¸éœ€è¦åœ¨pushå¤šä¸ªå›è°ƒåˆ°callbacksæ—¶å°†timerFuncå¤šæ¬¡æ¨å…¥ä»»åŠ¡é˜Ÿåˆ—æˆ–è€…ä¸»çº¿ç¨‹*/
    pending = false
    /*æ‰§è¡Œæ‰€æœ‰callback*/
    const copies = callbacks.slice(0)
    callbacks.length = 0
    for (let i = 0; i &lt; copies.length; i++) {
      copies[i]()
    }
  }

  // the nextTick behavior leverages the microtask queue, which can be accessed
  // via either native Promise.then or MutationObserver.
  // MutationObserver has wider support, however it is seriously bugged in
  // UIWebView in iOS &gt;= 9.3.3 when triggered in touch event handlers. It
  // completely stops working after triggering a few times... so, if native
  // Promise is available, we will use it:
  /* istanbul ignore if */

  /*
    è¿™é‡Œè§£é‡Šä¸€ä¸‹ï¼Œä¸€å…±æœ‰Promiseã€MutationObserverä»¥åŠsetTimeoutä¸‰ç§å°è¯•å¾—åˆ°timerFuncçš„æ–¹æ³•
    ä¼˜å…ˆä½¿ç”¨Promiseï¼Œåœ¨Promiseä¸å­˜åœ¨çš„æƒ…å†µä¸‹ä½¿ç”¨MutationObserverï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•éƒ½ä¼šåœ¨microtaskä¸­æ‰§è¡Œï¼Œä¼šæ¯”setTimeoutæ›´æ—©æ‰§è¡Œï¼Œæ‰€ä»¥ä¼˜å…ˆä½¿ç”¨ã€‚
    å¦‚æœä¸Šè¿°ä¸¤ç§æ–¹æ³•éƒ½ä¸æ”¯æŒçš„ç¯å¢ƒåˆ™ä¼šä½¿ç”¨setTimeoutï¼Œåœ¨taskå°¾éƒ¨æ¨å…¥è¿™ä¸ªå‡½æ•°ï¼Œç­‰å¾…è°ƒç”¨æ‰§è¡Œã€‚
    å‚è€ƒï¼šhttps://www.zhihu.com/question/55364497
  */
  if (typeof Promise !== &apos;undefined&apos; &amp;&amp; isNative(Promise)) {
    /*ä½¿ç”¨Promise*/
    var p = Promise.resolve()
    var logError = err =&gt; { console.error(err) }
    timerFunc = () =&gt; {
      p.then(nextTickHandler).catch(logError)
      // in problematic UIWebViews, Promise.then doesn&apos;t completely break, but
      // it can get stuck in a weird state where callbacks are pushed into the
      // microtask queue but the queue isn&apos;t being flushed, until the browser
      // needs to do some other work, e.g. handle a timer. Therefore we can
      // &quot;force&quot; the microtask queue to be flushed by adding an empty timer.
      if (isIOS) setTimeout(noop)
    }
  } else if (typeof MutationObserver !== &apos;undefined&apos; &amp;&amp; (
    isNative(MutationObserver) ||
    // PhantomJS and iOS 7.x
    MutationObserver.toString() === &apos;[object MutationObserverConstructor]&apos;
  )) {
    // use MutationObserver where native Promise is not available,
    // e.g. PhantomJS IE11, iOS7, Android 4.4
    /*æ–°å»ºä¸€ä¸ªtextNodeçš„DOMå¯¹è±¡ï¼Œç”¨MutationObserverç»‘å®šè¯¥DOMå¹¶æŒ‡å®šå›è°ƒå‡½æ•°ï¼Œåœ¨DOMå˜åŒ–çš„æ—¶å€™åˆ™ä¼šè§¦å‘å›è°ƒ,è¯¥å›è°ƒä¼šè¿›å…¥ä¸»çº¿ç¨‹ï¼ˆæ¯”ä»»åŠ¡é˜Ÿåˆ—ä¼˜å…ˆæ‰§è¡Œï¼‰ï¼Œå³textNode.data = String(counter)æ—¶ä¾¿ä¼šè§¦å‘å›è°ƒ*/
    var counter = 1
    var observer = new MutationObserver(nextTickHandler)
    var textNode = document.createTextNode(String(counter))
    observer.observe(textNode, {
      characterData: true
    })
    timerFunc = () =&gt; {
      counter = (counter + 1) % 2
      textNode.data = String(counter)
    }
  } else {
    // fallback to setTimeout
    /* istanbul ignore next */
    /*ä½¿ç”¨setTimeoutå°†å›è°ƒæ¨å…¥ä»»åŠ¡é˜Ÿåˆ—å°¾éƒ¨*/
    timerFunc = () =&gt; {
      setTimeout(nextTickHandler, 0)
    }
  }

  /*
    æ¨é€åˆ°é˜Ÿåˆ—ä¸­ä¸‹ä¸€ä¸ªtickæ—¶æ‰§è¡Œ
    cb å›è°ƒå‡½æ•°
    ctx ä¸Šä¸‹æ–‡
  */
  return function queueNextTick (cb?: Function, ctx?: Object) {
    let _resolve
    /*cbå­˜åˆ°callbacksä¸­*/
    callbacks.push(() =&gt; {
      if (cb) {
        try {
          cb.call(ctx)
        } catch (e) {
          handleError(e, ctx, &apos;nextTick&apos;)
        }
      } else if (_resolve) {
        _resolve(ctx)
      }
    })
    if (!pending) {
      pending = true
      timerFunc()
    }
    if (!cb &amp;&amp; typeof Promise !== &apos;undefined&apos;) {
      return new Promise((resolve, reject) =&gt; {
        _resolve = resolve
      })
    }
  }
})()
</code></pre><p>å®ƒæ˜¯ä¸€ä¸ªç«‹å³æ‰§è¡Œå‡½æ•°,è¿”å›ä¸€ä¸ªqueueNextTickæ¥å£ã€‚</p>
<p>ä¼ å…¥çš„cbä¼šè¢«pushè¿›callbacksä¸­å­˜æ”¾èµ·æ¥ï¼Œç„¶åæ‰§è¡ŒtimerFuncï¼ˆpendingæ˜¯ä¸€ä¸ªçŠ¶æ€æ ‡è®°ï¼Œä¿è¯timerFuncåœ¨ä¸‹ä¸€ä¸ªtickä¹‹å‰åªæ‰§è¡Œä¸€æ¬¡ï¼‰ã€‚</p>
<p>timerFuncæ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>çœ‹äº†æºç å‘ç°timerFuncä¼šæ£€æµ‹å½“å‰ç¯å¢ƒè€Œä¸åŒå®ç°ï¼Œå…¶å®å°±æ˜¯æŒ‰ç…§Promiseï¼ŒMutationObserverï¼ŒsetTimeoutä¼˜å…ˆçº§ï¼Œå“ªä¸ªå­˜åœ¨ä½¿ç”¨å“ªä¸ªï¼Œæœ€ä¸æµçš„ç¯å¢ƒä¸‹ä½¿ç”¨setTimeoutã€‚</p>
<p>ä¸¤è€…çš„å…·ä½“å®ç°</p>
<ul>
<li>macrotasks: setTimeout ï¼ŒsetIntervalï¼Œ setImmediateï¼ŒrequestAnimationFrame, I/O ï¼ŒUIæ¸²æŸ“</li>
<li>microtasks: Promiseï¼Œ process.nextTickï¼Œ Object.observeï¼Œ MutationObserver</li>
</ul>
<p>å†ç®€å•ç‚¹å¯ä»¥æ€»ç»“ä¸ºï¼š<br><img src="https://pic1.zhimg.com/v2-e92a4f5f686d115832b63b9b9e3ac2cd_b.jpg" alt=""><img src="https://pic1.zhimg.com/80/v2-e92a4f5f686d115832b63b9b9e3ac2cd_hd.jpg" alt=""></p>
<ol>
<li>åœ¨ macrotask é˜Ÿåˆ—ä¸­æ‰§è¡Œæœ€æ—©çš„é‚£ä¸ª task ï¼Œç„¶åç§»å‡º</li>
<li>å†æ‰§è¡Œ microtask é˜Ÿåˆ—ä¸­æ‰€æœ‰å¯ç”¨çš„ä»»åŠ¡ï¼Œç„¶åç§»å‡º</li>
<li><p>ä¸‹ä¸€ä¸ªå¾ªç¯ï¼Œæ‰§è¡Œä¸‹ä¸€ä¸ª macrotask ä¸­çš„ä»»åŠ¡ (å†è·³åˆ°ç¬¬2æ­¥)</p>
<p>  è¿™é‡Œè§£é‡Šä¸€ä¸‹ï¼Œä¸€å…±æœ‰Promiseã€MutationObserverä»¥åŠsetTimeoutä¸‰ç§å°è¯•å¾—åˆ°timerFuncçš„æ–¹æ³•ã€‚</p>
<pre><code>ä¼˜å…ˆä½¿ç”¨Promiseï¼Œåœ¨Promiseä¸å­˜åœ¨çš„æƒ…å†µä¸‹ä½¿ç”¨MutationObserverï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•çš„å›è°ƒå‡½æ•°éƒ½ä¼šåœ¨microtaskä¸­æ‰§è¡Œï¼Œå®ƒä»¬ä¼šæ¯”setTimeoutæ›´æ—©æ‰§è¡Œï¼Œæ‰€ä»¥ä¼˜å…ˆä½¿ç”¨ã€‚
å¦‚æœä¸Šè¿°ä¸¤ç§æ–¹æ³•éƒ½ä¸æ”¯æŒçš„ç¯å¢ƒåˆ™ä¼šä½¿ç”¨setTimeoutï¼Œåœ¨taskå°¾éƒ¨æ¨å…¥è¿™ä¸ªå‡½æ•°ï¼Œç­‰å¾…è°ƒç”¨æ‰§è¡Œã€‚
</code></pre></li>
</ol>
<p>ä¸ºä»€ä¹ˆè¦ä¼˜å…ˆä½¿ç”¨microtaskï¼Ÿæˆ‘åœ¨é¡¾è½¶çµåœ¨çŸ¥ä¹çš„å›ç­”ä¸­å­¦ä¹ åˆ°ï¼š</p>
<blockquote>
<p>  JS çš„ event loop æ‰§è¡Œæ—¶ä¼šåŒºåˆ† task å’Œ microtaskï¼Œå¼•æ“åœ¨æ¯ä¸ª task æ‰§è¡Œå®Œæ¯•ï¼Œä»é˜Ÿåˆ—ä¸­å–ä¸‹ä¸€ä¸ª task æ¥æ‰§è¡Œä¹‹å‰ï¼Œä¼šå…ˆæ‰§è¡Œå®Œæ‰€æœ‰ microtask é˜Ÿåˆ—ä¸­çš„ microtaskã€‚<br>setTimeout å›è°ƒä¼šè¢«åˆ†é…åˆ°ä¸€ä¸ªæ–°çš„ task ä¸­æ‰§è¡Œï¼Œè€Œ Promise çš„ resolverã€   MutationObserver çš„å›è°ƒéƒ½ä¼šè¢«å®‰æ’åˆ°ä¸€ä¸ªæ–°çš„ microtask ä¸­æ‰§è¡Œï¼Œä¼šæ¯” setTimeout äº§ç”Ÿçš„ task å…ˆæ‰§è¡Œã€‚<br>       è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ microtaskï¼Œä¼˜å…ˆä½¿ç”¨ Promiseï¼Œå¦‚æœæµè§ˆå™¨ä¸æ”¯æŒï¼Œå†å°è¯• MutationObserverã€‚<br>       å®åœ¨ä¸è¡Œï¼Œåªèƒ½ç”¨ setTimeout åˆ›å»º task äº†ã€‚<br>       ä¸ºå•¥è¦ç”¨ microtaskï¼Ÿ<br>       æ ¹æ® HTML Standardï¼Œåœ¨æ¯ä¸ª task è¿è¡Œå®Œä»¥åï¼ŒUI éƒ½ä¼šé‡æ¸²æŸ“ï¼Œé‚£ä¹ˆåœ¨ microtask ä¸­å°±å®Œæˆæ•°æ®æ›´æ–°ï¼Œå½“å‰ task ç»“æŸå°±å¯ä»¥å¾—åˆ°æœ€æ–°çš„ UI äº†ã€‚<br>       åä¹‹å¦‚æœæ–°å»ºä¸€ä¸ª task æ¥åšæ•°æ®æ›´æ–°ï¼Œé‚£ä¹ˆæ¸²æŸ“å°±ä¼šè¿›è¡Œä¸¤æ¬¡ã€‚</p>
</blockquote>
<p>é¦–å…ˆæ˜¯Promiseï¼Œ(Promise.resolve()).then()å¯ä»¥åœ¨microtaskä¸­åŠ å…¥å®ƒçš„å›è°ƒï¼Œ</p>
<p>MutationObserveræ–°å»ºä¸€ä¸ªtextNodeçš„DOMå¯¹è±¡ï¼Œç”¨MutationObserverç»‘å®šè¯¥DOMå¹¶æŒ‡å®šå›è°ƒå‡½æ•°ï¼Œåœ¨DOMå˜åŒ–çš„æ—¶å€™åˆ™ä¼šè§¦å‘å›è°ƒ,è¯¥å›è°ƒä¼šè¿›å…¥microtaskï¼Œå³textNode.data = String(counter)æ—¶ä¾¿ä¼šåŠ å…¥è¯¥å›è°ƒã€‚</p>
<p>è‡³äº MutationObserver å¦‚ä½•æ¨¡æ‹Ÿ nextTick è¿™ç‚¹ï¼Œç›´æ¥çœ‹æºç ï¼Œå…¶å®å°±æ˜¯åˆ›å»ºä¸€ä¸ª TextNode å¹¶ç›‘å¬å†…å®¹å˜åŒ–ï¼Œç„¶åè¦ nextTick çš„æ—¶å€™å»æ”¹ä¸€ä¸‹è¿™ä¸ªèŠ‚ç‚¹çš„æ–‡æœ¬å†…å®¹ï¼š    var counter = 1</p>
<pre><code>var observer = new MutationObserver(nextTickHandler)
    var textNode = document.createTextNode(String(counter))
    observer.observe(textNode, {
      characterData: true
    })
    timerFunc = () =&gt; {
      counter = (counter + 1) % 2
      textNode.data = String(counter)
    }
</code></pre><p>   setTimeoutæ˜¯æœ€åçš„ä¸€ç§å¤‡é€‰æ–¹æ¡ˆï¼Œå¹¶ä¸”é»˜è®¤æœ‰4mså»¶æ—¶ï¼ŒsetTimeoutå»¶æ—¶0ä¸ä¼šè€è€å®å®ç«‹å³æ‰§è¡Œï¼š</p>
<pre><code>setTimeout(function(){
    console.log(&quot;æˆ‘ä¸æ˜¯ç«‹å³æ‰§è¡Œçš„,ä¸€èˆ¬æˆ‘ä¼šå»¶æ—¶4ms,å“ˆå“ˆ&quot;);
},0);
</code></pre><p>å®ƒä¼šå°†å›è°ƒå‡½æ•°åŠ å…¥taskä¸­ï¼Œç­‰åˆ°æ‰§è¡Œã€‚<br><img src="https://pic2.zhimg.com/v2-59cf9f88d7daac690d39edfb9fffc8b8_b.jpg" alt=""><img src="https://pic2.zhimg.com/80/v2-59cf9f88d7daac690d39edfb9fffc8b8_hd.jpg" alt=""></p>
<pre><code>setTimeout(function(){console.log(4)},0);
new Promise(function(resolve){
    console.log(1)
    for( var i=0 ; i&lt;10000 ; i++ ){
        i==9999 &amp;&amp; resolve()
    }
    console.log(2)
}).then(function(){
    console.log(5)
});
console.log(3);
ç»“æœæ˜¯ï¼š
1,2,3,5,4
</code></pre><p>å†çœ‹è¿™ä¸ªï¼Œä¸¤ä¸ªè‡ªæ‰§è¡ŒåŒæ—¶æ‰§è¡Œï¼š</p>
<pre><code>&lt;script&gt;
(function test() {
  setTimeout(function () {
    console.log(4)
  }, 0);
  new Promise(function executor (resolve) {
    console.log(1);
    for(var i = 0; i &lt; 10000; i++) {
      i == 9999 &amp;&amp; resolve();
    }
    console.log(2);
  }).then(function() {
    console.log(5);
  });
  console.log(3);
})()

(function test2() {
  setTimeout(function () {
    console.log(42)
  }, 0);
  new Promise(function executor (resolve) {
    console.log(12);
    for(var i = 0; i &lt; 10000; i++) {
      i == 9999 &amp;&amp; resolve();
    }
    console.log(22);
  }).then(function() {
    console.log(52);
  });
  console.log(32);
})()
&lt;/script&gt;
</code></pre><p><img src="https://pic2.zhimg.com/v2-cd18c572eb05069895ede7e34388bb8d_b.jpg" alt=""><img src="https://pic2.zhimg.com/80/v2-cd18c572eb05069895ede7e34388bb8d_hd.jpg" alt=""><img src="https://pic3.zhimg.com/v2-afcb6fa6fb862818359f757107b769ab_b.jpg" alt=""><img src="https://pic3.zhimg.com/80/v2-afcb6fa6fb862818359f757107b769ab_hd.jpg" alt=""><br>æ•´ä¸ªæ‰§è¡Œè¿‡ç¨‹æ˜¯ä¸€ä¸ª main thread ã€<a href="https://link.zhihu.com/?target=http%3A//www.baidu.com/link%3Furl%3DCV-egCVH8yK1w-ilUqGsztryG8s2mbuhAliIC_L1n_-BSZ_KJ16tAfaNkmbcRtU8" target="_blank" rel="noopener">ä¸»çº¿ç¨‹</a>ã€‘ ï¼Œä½†å¹¶ä¸æ„å‘³ç€å…ˆæ‰§è¡Œç¬¬ä¸€ä¸ªè‡ªæ‰§è¡Œåå†æ‰§è¡Œç¬¬äºŒä¸ªï¼Œå› ä¸ºä¸¤ä¸ªè‡ªæ‰§è¡Œä¸­çš„ <code>setTimeout</code> è¿›å…¥çš„æ˜¯åŒä¸€ä¸ªäº‹ä»¶å¾ªç¯ä¸­ç­‰å¾…ï¼Œå› æ­¤ä»–ä¿©åœ¨æœ€ååˆ†åˆ«è¾“å‡ºäº†äº† 4 å’Œ 42ã€‚</p>
<pre><code>å½“ä¸€ä¸ªç¨‹åºæœ‰ï¼šsetTimeoutï¼Œ setInterval ï¼ŒsetImmediateï¼Œ I/Oï¼Œ UIæ¸²æŸ“ï¼ŒPromise ï¼Œprocess.nextTickï¼Œ Object.observeï¼Œ MutationObserverçš„æ—¶å€™ï¼š
</code></pre><p>   1.å…ˆæ‰§è¡Œ macrotasksï¼šI/O -ã€‹ UIæ¸²æŸ“</p>
<p>   2.å†æ‰§è¡Œ microtasks ï¼šprocess.nextTick  -ã€‹ Promise  -ã€‹MutationObserver -&gt;Object.observe</p>
<p>   3.å†æŠŠsetTimeout setInterval setImmediate å¡å…¥ä¸€ä¸ªæ–°çš„macrotasksï¼Œä¾æ¬¡ï¼š</p>
<p>setTimeout ï¼ŒsetInterval â€“ã€‹setImmediate</p>
<pre><code>  ç»¼ä¸Šï¼ŒnextTickçš„ç›®çš„å°±æ˜¯äº§ç”Ÿä¸€ä¸ªå›è°ƒå‡½æ•°åŠ å…¥taskæˆ–è€…microtaskä¸­ï¼Œå½“å‰æ ˆæ‰§è¡Œå®Œä»¥åï¼ˆå¯èƒ½ä¸­é—´è¿˜æœ‰åˆ«çš„æ’åœ¨å‰é¢çš„å‡½æ•°ï¼‰è°ƒç”¨è¯¥å›è°ƒå‡½æ•°ï¼Œèµ·åˆ°äº†å¼‚æ­¥è§¦å‘ï¼ˆå³ä¸‹ä¸€ä¸ªtickæ—¶è§¦å‘ï¼‰çš„ç›®çš„ã€‚

setImmediate(function(){
    console.log(1);
},0);
setTimeout(function(){
    console.log(2);
},0);
new Promise(function(resolve){
    console.log(3);
    resolve();
    console.log(4);
}).then(function(){
    console.log(5);
});
console.log(6);
process.nextTick(function(){
    console.log(7);
});
console.log(8);
ç»“æœæ˜¯ï¼š3 4 6 8 7 5 2 1
</code></pre><h2 id="flushSchedulerQueue"><a href="#flushSchedulerQueue" class="headerlink" title="flushSchedulerQueue"></a>flushSchedulerQueue</h2><pre><code>/*Github:https://github.com/answershuto*/
/**
 * Flush both queues and run the watchers.
 */
 /*nextTickçš„å›è°ƒå‡½æ•°ï¼Œåœ¨ä¸‹ä¸€ä¸ªtickæ—¶flushæ‰ä¸¤ä¸ªé˜Ÿåˆ—åŒæ—¶è¿è¡Œwatchers*/
function flushSchedulerQueue () {
  flushing = true
  let watcher, id

  // Sort queue before flush.
  // This ensures that:
  // 1. Components are updated from parent to child. (because parent is always
  //    created before the child)
  // 2. A component&apos;s user watchers are run before its render watcher (because
  //    user watchers are created before the render watcher)
  // 3. If a component is destroyed during a parent component&apos;s watcher run,
  //    its watchers can be skipped.
  /*
    ç»™queueæ’åºï¼Œè¿™æ ·åšå¯ä»¥ä¿è¯ï¼š
    1.ç»„ä»¶æ›´æ–°çš„é¡ºåºæ˜¯ä»çˆ¶ç»„ä»¶åˆ°å­ç»„ä»¶çš„é¡ºåºï¼Œå› ä¸ºçˆ¶ç»„ä»¶æ€»æ˜¯æ¯”å­ç»„ä»¶å…ˆåˆ›å»ºã€‚
    2.ä¸€ä¸ªç»„ä»¶çš„user watchersæ¯”render watcherå…ˆè¿è¡Œï¼Œå› ä¸ºuser watcherså¾€å¾€æ¯”render watcheræ›´æ—©åˆ›å»º
    3.å¦‚æœä¸€ä¸ªç»„ä»¶åœ¨çˆ¶ç»„ä»¶watcherè¿è¡ŒæœŸé—´è¢«é”€æ¯ï¼Œå®ƒçš„watcheræ‰§è¡Œå°†è¢«è·³è¿‡ã€‚
  */
  queue.sort((a, b) =&gt; a.id - b.id)

  // do not cache length because more watchers might be pushed
  // as we run existing watchers
  /*è¿™é‡Œä¸ç”¨index = queue.length;index &gt; 0; index--çš„æ–¹å¼å†™æ˜¯å› ä¸ºä¸è¦å°†lengthè¿›è¡Œç¼“å­˜ï¼Œå› ä¸ºåœ¨æ‰§è¡Œå¤„ç†ç°æœ‰watcherå¯¹è±¡æœŸé—´ï¼Œæ›´å¤šçš„watcherå¯¹è±¡å¯èƒ½ä¼šè¢«pushè¿›queue*/
  for (index = 0; index &lt; queue.length; index++) {
    watcher = queue[index]
    id = watcher.id
    /*å°†hasçš„æ ‡è®°åˆ é™¤*/
    has[id] = null
    /*æ‰§è¡Œwatcher*/
    watcher.run()
    // in dev build, check and stop circular updates.
    /*
      åœ¨æµ‹è¯•ç¯å¢ƒä¸­ï¼Œæ£€æµ‹watchæ˜¯å¦åœ¨æ­»å¾ªç¯ä¸­
      æ¯”å¦‚è¿™æ ·ä¸€ç§æƒ…å†µ
      watch: {
        test () {
          this.test++;
        }
      }
      æŒç»­æ‰§è¡Œäº†ä¸€ç™¾æ¬¡watchä»£è¡¨å¯èƒ½å­˜åœ¨æ­»å¾ªç¯
    */
    if (process.env.NODE_ENV !== &apos;production&apos; &amp;&amp; has[id] != null) {
      circular[id] = (circular[id] || 0) + 1
      if (circular[id] &gt; MAX_UPDATE_COUNT) {
        warn(
          &apos;You may have an infinite update loop &apos; + (
            watcher.user
              ? `in watcher with expression &quot;${watcher.expression}&quot;`
              : `in a component render function.`
          ),
          watcher.vm
        )
        break
      }
    }
  }

  // keep copies of post queues before resetting state
  /**/
  /*å¾—åˆ°é˜Ÿåˆ—çš„æ‹·è´*/
  const activatedQueue = activatedChildren.slice()
  const updatedQueue = queue.slice()

  /*é‡ç½®è°ƒåº¦è€…çš„çŠ¶æ€*/
  resetSchedulerState()

  // call component updated and activated hooks
  /*ä½¿å­ç»„ä»¶çŠ¶æ€éƒ½æ”¹ç¼–æˆactiveåŒæ—¶è°ƒç”¨activatedé’©å­*/
  callActivatedHooks(activatedQueue)
  /*è°ƒç”¨updatedé’©å­*/
  callUpdateHooks(updatedQueue)

  // devtool hook
  /* istanbul ignore if */
  if (devtools &amp;&amp; config.devtools) {
    devtools.emit(&apos;flush&apos;)
  }
}
</code></pre><p>flushSchedulerQueueæ˜¯ä¸‹ä¸€ä¸ªtickæ—¶çš„å›è°ƒå‡½æ•°ï¼Œä¸»è¦ç›®çš„æ˜¯æ‰§è¡ŒWatcherçš„runå‡½æ•°ï¼Œç”¨æ¥æ›´æ–°è§†å›¾</p>
<h2 id="ä¸ºä»€ä¹ˆè¦å¼‚æ­¥æ›´æ–°è§†å›¾"><a href="#ä¸ºä»€ä¹ˆè¦å¼‚æ­¥æ›´æ–°è§†å›¾" class="headerlink" title="ä¸ºä»€ä¹ˆè¦å¼‚æ­¥æ›´æ–°è§†å›¾"></a>ä¸ºä»€ä¹ˆè¦å¼‚æ­¥æ›´æ–°è§†å›¾</h2><p>æ¥çœ‹ä¸€ä¸‹ä¸‹é¢è¿™ä¸€æ®µä»£ç </p>
<pre><code>&lt;template&gt;
  &lt;div&gt;
    &lt;div&gt;{{test}}&lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;
export default {
    data () {
        return {
            test: 0
        };
    },
    created () {
      for(let i = 0; i &lt; 1000; i++) {
        this.test++;
      }
    }
}
</code></pre><p>ç°åœ¨æœ‰è¿™æ ·çš„ä¸€ç§æƒ…å†µï¼Œcreatedçš„æ—¶å€™testçš„å€¼ä¼šè¢«++å¾ªç¯æ‰§è¡Œ1000æ¬¡ã€‚<br>æ¯æ¬¡++æ—¶ï¼Œéƒ½ä¼šæ ¹æ®å“åº”å¼è§¦å‘setter-&gt;Dep-&gt;Watcher-&gt;update-&gt;patchã€‚<br>å¦‚æœè¿™æ—¶å€™æ²¡æœ‰å¼‚æ­¥æ›´æ–°è§†å›¾ï¼Œé‚£ä¹ˆæ¯æ¬¡++éƒ½ä¼šç›´æ¥æ“ä½œDOMæ›´æ–°è§†å›¾ï¼Œè¿™æ˜¯éå¸¸æ¶ˆè€—æ€§èƒ½çš„ã€‚<br>æ‰€ä»¥Vue.jså®ç°äº†ä¸€ä¸ªqueueé˜Ÿåˆ—ï¼Œåœ¨ä¸‹ä¸€ä¸ªtickçš„æ—¶å€™ä¼šç»Ÿä¸€æ‰§è¡Œqueueä¸­Watcherçš„runã€‚åŒæ—¶ï¼Œæ‹¥æœ‰ç›¸åŒidçš„Watcherä¸ä¼šè¢«é‡å¤åŠ å…¥åˆ°è¯¥queueä¸­å»ï¼Œæ‰€ä»¥ä¸ä¼šæ‰§è¡Œ1000æ¬¡Watcherçš„runã€‚æœ€ç»ˆæ›´æ–°è§†å›¾åªä¼šç›´æ¥å°†testå¯¹åº”çš„DOMçš„0å˜æˆ1000ã€‚<br>ä¿è¯æ›´æ–°è§†å›¾æ“ä½œDOMçš„åŠ¨ä½œæ˜¯åœ¨å½“å‰æ ˆæ‰§è¡Œå®Œä»¥åä¸‹ä¸€ä¸ªtickçš„æ—¶å€™è°ƒç”¨ï¼Œå¤§å¤§ä¼˜åŒ–äº†æ€§èƒ½ã€‚</p>
<h2 id="è®¿é—®çœŸå®DOMèŠ‚ç‚¹æ›´æ–°åçš„æ•°æ®"><a href="#è®¿é—®çœŸå®DOMèŠ‚ç‚¹æ›´æ–°åçš„æ•°æ®" class="headerlink" title="è®¿é—®çœŸå®DOMèŠ‚ç‚¹æ›´æ–°åçš„æ•°æ®"></a>è®¿é—®çœŸå®DOMèŠ‚ç‚¹æ›´æ–°åçš„æ•°æ®</h2><p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨ä¿®æ”¹dataä¸­çš„æ•°æ®åè®¿é—®çœŸå®çš„DOMèŠ‚ç‚¹æ›´æ–°åçš„æ•°æ®ï¼Œåªéœ€è¦è¿™æ ·ï¼Œæˆ‘ä»¬æŠŠæ–‡ç« ç¬¬ä¸€ä¸ªä¾‹å­è¿›è¡Œä¿®æ”¹ã€‚</p>
<pre><code>&lt;template&gt;
  &lt;div&gt;
    &lt;div ref=&quot;test&quot;&gt;{{test}}&lt;/div&gt;
    &lt;button @click=&quot;handleClick&quot;&gt;tet&lt;/button&gt;
  &lt;/div&gt;
&lt;/template&gt;
export default {
    data () {
        return {
            test: &apos;begin&apos;
        };
    },
    methods () {
        handleClick () {
            this.test = &apos;end&apos;;
            this.$nextTick(() =&gt; {
                console.log(this.$refs.test.innerText);//æ‰“å°&quot;end&quot;
            });
            console.log(this.$refs.test.innerText);//æ‰“å°â€œbeginâ€
        }
    }
}
</code></pre><p>ä½¿ç”¨Vue.jsçš„global APIçš„$nextTickæ–¹æ³•ï¼Œå³å¯åœ¨å›è°ƒä¸­è·å–å·²ç»æ›´æ–°å¥½çš„DOMå®ä¾‹äº†ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/6/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><span class="space">&hellip;</span><a class="page-number" href="/page/13/">13</a><a class="extend next" rel="next" href="/page/8/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/tx.jpg"
                alt="ææ–Œ" />
            
              <p class="site-author-name" itemprop="name">ææ–Œ</p>
              <p class="site-description motion-element" itemprop="description">æƒ³è¦é£å¾—é«˜ï¼Œé‚£å°±æŠŠåœ°å¹³çº¿å¿˜æ‰</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">125</span>
                  <span class="site-state-item-name">æ—¥å¿—</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">æ ‡ç­¾</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/libin1991" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="3120217729@qq.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://juejin.im/user/57e737f6c4c971005f6bcd8d" target="_blank" title="juejin">
                      
                        <i class="fa fa-fw fa-spinner"></i>juejin</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ææ–Œ</span>

  
</div>


  <div class="powered-by">ç”± <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">ä¸»é¢˜ &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
<script type="text/javascript" src="/js/src/clicklove.js"></script>

