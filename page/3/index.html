<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="Blog">
<meta property="og:type" content="website">
<meta property="og:title" content="LuckDay">
<meta property="og:url" content="http://yoursite.com/page/3/index.html">
<meta property="og:site_name" content="LuckDay">
<meta property="og:description" content="Blog">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="LuckDay">
<meta name="twitter:description" content="Blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/3/"/>





  <title>LuckDay - æƒ³è¦é£å¾—é«˜ï¼Œé‚£å°±æŠŠåœ°å¹³çº¿å¿˜æ‰</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband">
    	<div class="eevee"><div class="body"><div class="head"><div class="ears"><div class="ear"><div class="lobe"></div></div><div class="ear"><div class="lobe"></div></div></div><div class="face"><div class="eyes"><div class="eye"><div class="eyelid"></div></div><div class="eye"><div class="eyelid"></div></div></div><div class="nose"></div><div class="mouth"></div></div></div><div class="chest"><div class="fur"><div class="patch"></div></div><div class="fur"><div class="patch"></div></div><div class="fur"><div class="patch"></div></div></div><div class="legs"><div class="leg"><div class="inner-leg"></div></div><div class="leg"><div class="inner-leg"></div></div><div class="leg"><div class="inner-leg"></div></div><div class="leg"><div class="inner-leg"></div></div></div><div class="tail"><div class="tail"><div class="tail"><div class="tail"><div class="tail"><div class="tail -end"></div></div></div></div></div></div></div></div>
    </div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
    	<div class="sky">
	<div class="clouds_one"></div>
	<div class="clouds_two"></div>
	<div class="clouds_three"></div>
</div>
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">LuckDay</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">æƒ³è¦é£å¾—é«˜ï¼Œé‚£å°±æŠŠåœ°å¹³çº¿å¿˜æ‰</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            æ ‡ç­¾
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            å…³äº
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            æœç´¢
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="æœç´¢..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/03/æˆ‘ä¹Ÿæ¥å®ç°ä¸€æŠŠMVVM/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/03/æˆ‘ä¹Ÿæ¥å®ç°ä¸€æŠŠMVVM/" itemprop="url">æˆ‘ä¹Ÿæ¥å®ç°ä¸€æŠŠMVVM</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-10-03T00:20:32+08:00">
                2018-10-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>å¤§å®¶éƒ½çŸ¥é“ï¼Œvueæ˜¯ä¸ªMVVMæ¡†æ¶ï¼Œèƒ½å¤Ÿå®ç°viewå’Œmodelçš„åŒå‘ç»‘å®šï¼Œä¸åƒbackboneé‚£æ ·ï¼Œmodelæ”¹å˜éœ€è¦æ‰‹åŠ¨å»é€šçŸ¥viewæ›´æ–°ï¼Œè€Œvueå®ç°çš„åŸç†å°±æ˜¯é€šè¿‡Object.definePropertyå®ç°æ•°æ®æŒŸæŒï¼Œå®šä¹‰setterï¼Œç„¶åæ•°æ®æ”¹å˜çš„æ—¶å€™é€šçŸ¥è§†å›¾æ›´æ–°ã€‚</p>
<p>ä¸‹é¢æ˜¯ç½‘ä¸Švueçš„å®ç°åŸç†å›¾ï¼š</p>
<p> <img src="https://user-gold-cdn.xitu.io/2018/4/10/162ad3d5be3e5105?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="image"></p>
<h3 id="å®ç°æ•ˆæœ"><a href="#å®ç°æ•ˆæœ" class="headerlink" title="å®ç°æ•ˆæœ"></a>å®ç°æ•ˆæœ</h3><p><img src="https://user-gold-cdn.xitu.io/2018/8/15/1653b294cd1b80e3?imageslim" alt=""></p>
<h4 id="1ã€MVVM"><a href="#1ã€MVVM" class="headerlink" title="1ã€MVVM"></a>1ã€MVVM</h4><p>å…¥å£æ–‡ä»¶ï¼Œåœ¨è¿™é‡Œå¯¹vueå½“ä¸­çš„$elã€methodsã€$dataè¿›è¡Œåˆå§‹åŒ–ï¼Œè°ƒç”¨observeréå†$dataçš„æ•°æ®å¹¶è¿›è¡ŒæŒŸæŒï¼Œè°ƒç”¨compileéå†$elä¸‹çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œè§£ææŒ‡ä»¤å’Œå–å€¼æ“ä½œã€‚éå†$dataçš„æ•°æ®ï¼Œé€šè¿‡Object.definePropertyçš„getterå’Œsetterå®ç°å¯¹$dataçš„ä»£ç†ã€‚</p>
<h4 id="2ã€Observer"><a href="#2ã€Observer" class="headerlink" title="2ã€Observer"></a>2ã€Observer</h4><p>éå†dataï¼Œé€šè¿‡Object.definePropertyè®¾ç½®getterå’Œsetterï¼Œåœ¨setterçŸ¥é“æ•°æ®å‘ç”Ÿäº†æ”¹å˜ï¼Œç„¶åé€šçŸ¥Wacherå»æ›´æ–°viewã€‚</p>
<h4 id="3ã€Compile"><a href="#3ã€Compile" class="headerlink" title="3ã€Compile"></a>3ã€Compile</h4><p>éå†$elä¸‹çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œè§£ææŒ‡ä»¤å’Œå–å€¼æ“ä½œç­‰ï¼Œä¸ºæ¯ä¸ªèŠ‚ç‚¹ç»‘å®šæ›´æ–°å‡½æ•°ï¼ˆä¸ºä»€ä¹ˆåœ¨compileè¿™é‡Œç»‘å®šå‘¢ï¼Ÿå› ä¸ºè¿™é‡Œåˆšå¥½æ˜¯éå†çš„èŠ‚ç‚¹â˜ºï¼‰ï¼Œç»‘å®šäº‹ä»¶å’Œmethodçš„å…³ç³»ï¼ŒåŒæ—¶ä¹Ÿæ·»åŠ è®¢é˜…è€…ï¼Œå½“æ¥å—åˆ°è§†å›¾æ›´æ–°çš„è®¢é˜…æ¶ˆæ¯åï¼Œè°ƒç”¨æ›´æ–°å‡½æ•°ï¼Œå®ç°è§†å›¾æ›´æ–°ã€‚åŒæ—¶åœ¨æ·»åŠ è®¢é˜…è€…çš„æ—¶å€™ï¼Œåˆå§‹åŒ–æ¸²æŸ“è§†å›¾ã€‚</p>
<h4 id="4ã€Watcher"><a href="#4ã€Watcher" class="headerlink" title="4ã€Watcher"></a>4ã€Watcher</h4><p>Watcherä½œä¸ºè®¢é˜…è€…ï¼Œå……å½“Observerå’ŒCompileçš„ä¸­é—´æ¡¥æ¢ï¼ŒåŒ…å«updateæ–¹æ³•ï¼Œupdateæ–¹æ³•è°ƒç”¨Compileä¸­ç»‘å®šçš„äº‹ä»¶æ›´æ–°å‡½æ•°ï¼Œå®ç°å¯¹è§†å›¾çš„åˆå§‹åŒ–å’Œæ›´æ–°æ“ä½œã€‚</p>
<h3 id="MVVMçš„å®ç°"><a href="#MVVMçš„å®ç°" class="headerlink" title="MVVMçš„å®ç°"></a>MVVMçš„å®ç°</h3><p>MVVMå®Œæˆåˆå§‹åŒ–æ“ä½œï¼Œå¹¶ä¸”è°ƒç”¨observerå’Œcompileã€‚å¯¹$dataè¿›è¡Œä»£ç†ï¼Œå¦‚æ­¤ä¾¿å¯ä»¥é€šè¿‡this.attributeæ¥ä»£ç†this.$data.attributeã€‚å› ä¸ºä¸€ä¸ªå±æ€§å¯èƒ½å¯¹åº”å¤šä¸ªæŒ‡ä»¤ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ª_bindingå±æ€§æ¥å­˜æ”¾å±æ€§å¯¹åº”çš„æ‰€æœ‰è®¢é˜…è€…ï¼Œè¿™æ ·å±æ€§ä¸€æ”¹å˜ï¼Œå°±å¯ä»¥å–å‡ºæ‰€æœ‰çš„è®¢é˜…è€…å»æ›´æ–°è§†å›¾ã€‚</p>
<pre><code>function MVVM(options) {
  // åˆå§‹åŒ–
  this.$data = options.data;
  this.$methods = options.methods;
  this.$el = options.el;
  // ä¿å­˜dataçš„æ¯ä¸ªå±æ€§å¯¹åº”çš„æ‰€æœ‰watcher
  this._binding  = {};
  // è°ƒç”¨observerå’Œcompile
  this._observer(options.data);
  this._compile();
  // this.xxx ä»£ç†this.$data.xxx
  this.proxyAttribute();
}
</code></pre><h3 id="Observerçš„å®ç°"><a href="#Observerçš„å®ç°" class="headerlink" title="Observerçš„å®ç°"></a>Observerçš„å®ç°</h3><p>Observeréå†$dataï¼Œé€šè¿‡Object.definePropertyçš„setterçš„æŒŸæŒæ•°æ®æ”¹å˜ï¼Œç›‘å¬åˆ°æ•°æ®æ”¹å˜åå–å‡ºæ‰€æœ‰è¯¥å±æ€§å¯¹åº”çš„è®¢é˜…è€…ï¼Œç„¶åé€šçŸ¥æ›´æ–°å‡½æ•°æ›´æ–°è§†å›¾ã€‚</p>
<p>æ³¨æ„ï¼šè¿™é‡Œæœ‰å¾ªç¯ï¼Œä¸”é—­åŒ…ï¼ˆgetterå’Œsetterï¼‰é‡Œé¢éœ€è¦ä¾èµ–å¾ªç¯é¡¹ï¼ˆvalueå’Œkeyï¼‰ï¼Œæ‰€ä»¥ç”¨ç«‹å³æ‰§è¡Œå‡½æ•°è§£å†³å¾ªç¯é¡¹è·å–ä¸å¯¹çš„é—®é¢˜ã€‚</p>
<pre><code>MVVM.prototype._observer = function(data) {
  var self = this;
  for(var key in this.$data) {
    if (this.$data.hasOwnProperty(key)) {
      // åˆå§‹åŒ–å±æ€§å¯¹åº”çš„è®¢é˜…è€…å®¹å™¨ï¼ˆæ•°ç»„ï¼‰
      this._binding[key] = {
        _directives: [],
        _texts: []
      };

      if(typeof this.$data[key] === &quot;object&quot;) {
        return this._observer(this.$data[key]);
      }
      var val = data[key];
      // ç«‹å³æ‰§è¡Œå‡½æ•°è·å–æ­£ç¡®çš„å¾ªç¯é¡¹
      (function(value, key) {
        Object.defineProperty(self.$data, key, {
          enumerable: true,
          configurable: true,
          get: function() {
            return value;
          },
          set(newval) {
            if(newval === value) {
              return;
            }
            value = newval;
            // ç›‘å¬åˆ°æ•°æ®æ”¹å˜åå–å‡ºæ‰€æœ‰è¯¥å±æ€§å¯¹åº”çš„è®¢é˜…è€…ï¼Œé€šçŸ¥viewæ›´æ–°-å±æ€§
            if(self._binding[key]._directives) {
              self._binding[key]._directives.forEach(function(watcher) {
                watcher.update();
              }, self);
            }
            // ç›‘å¬åˆ°æ•°æ®æ”¹å˜åå–å‡ºæ‰€æœ‰è¯¥å±æ€§å¯¹åº”çš„è®¢é˜…è€…ï¼Œé€šçŸ¥viewæ›´æ–°-æ–‡æœ¬
            if(self._binding[key]._texts) {
              self._binding[key]._texts.forEach(function(watcher) {
                watcher.update();
              }, self);
            }
          }
        });
      })(val, key);
    }
  }
}
</code></pre><h3 id="Compileçš„å®ç°"><a href="#Compileçš„å®ç°" class="headerlink" title="Compileçš„å®ç°"></a>Compileçš„å®ç°</h3><p>Compileéå†æ‰€æœ‰çš„èŠ‚ç‚¹ï¼Œè§£ææŒ‡ä»¤ï¼Œä¸ºæ¯ä¸ªèŠ‚ç‚¹ç»‘å®šæ›´æ–°å‡½æ•°ï¼Œä¸”æ·»åŠ è®¢é˜…è€…ï¼Œå½“è®¢é˜…è€…é€šçŸ¥viewæ›´æ–°çš„æ—¶å€™ï¼Œè°ƒç”¨æ›´æ–°å‡½æ•°ï¼Œå®ç°å¯¹è§†å›¾çš„æ›´æ–°ã€‚</p>
<p>è¿™é‡ŒåŒæ ·éœ€è¦ä½¿ç”¨ç«‹å³æ‰§è¡Œå‡½æ•°æ¥è§£å†³é—­åŒ…ä¾èµ–çš„å¾ªç¯é¡¹é—®é¢˜ã€‚</p>
<p>è¿˜æœ‰ä¸€ç‚¹éœ€è¦è§£å†³çš„æ˜¯ï¼Œå¦‚æœèŠ‚ç‚¹çš„innerTextä¾èµ–å¤šä¸ªå±æ€§çš„è¯ï¼Œå¦‚ä½•åšåˆ°åªæ›¿æ¢æ”¹å˜å±æ€§å¯¹åº”çš„æ–‡æœ¬é—®é¢˜ã€‚</p>
<p>æ¯”å¦‚ï¼šå·²ç»è¢«ç¼–è¯‘è§£ææˆâ€œæ¬¢è¿ï¼š é¸£äººâ€ï¼Œå¦‚æœmessageæ”¹å˜ä¸ºâ€œä½ å¥½â€ï¼Œæ€ä¹ˆè®©ä½¿å¾—â€œæ¬¢è¿ï¼šé¸£äººâ€æ”¹ä¸ºâ€œä½ å¥½ï¼šé¸£äººâ€ã€‚</p>
<pre><code>MVVM.prototype._compile = function() {
  var dom = document.querySelector(this.$el);
  var children = dom.children;
  var self = this;
  var i = 0, j = 0;
  // æ›´æ–°å‡½æ•°ï¼Œä½†observerä¸­modelçš„æ•°æ®æ”¹å˜çš„æ—¶å€™ï¼Œé€šè¿‡Watcherçš„updateè°ƒç”¨æ›´æ–°å‡½æ•°ï¼Œä»è€Œæ›´æ–°dom
  var updater = null;
  for(; i &lt; children.length; i++) {
    var node = children[i];
    (function(node) {
      // è§£æ{{}}é‡Œé¢çš„å†…å®¹
      // ä¿å­˜æŒ‡ä»¤åŸå§‹å†…å®¹ï¼Œä¸ç„¶æ•°æ®æ›´æ–°æ—¶æ— æ³•å®Œæˆæ›¿æ¢
      var text = node.innerText;
      var matches = text.match(/{{([^{}]+)}}/g);
      if(matches &amp;&amp; matches.length &gt; 0) {
        // ä¿å­˜å’Œnodeç»‘å®šçš„æ‰€æœ‰å±æ€§
        node.bindingAttributes = [];
        for(j = 0; j &lt; matches.length; j++) {
          // dataæŸä¸ªå±æ€§
          var attr = matches[j].match(/{{([^{}]+)}}/)[1];
          // å°†å’Œè¯¥nodeç»‘å®šçš„dataå±æ€§ä¿å­˜èµ·æ¥
          node.bindingAttributes.push(attr);
          (function(attr) {
            updater = function() {
              // æ”¹å˜çš„å±æ€§å€¼å¯¹åº”çš„æ–‡æœ¬è¿›è¡Œæ›¿æ¢
              var innerText = text.replace(new RegExp(&quot;{{" + attr + "}}&quot;, &quot;g&quot;), self.$data[attr]);
              // å¦‚æœè¯¥nodeç»‘å®šå¤šä¸ªå±æ€§ eg:&lt;div&gt;{{title}}{{description}}&lt;/div&gt;
              for(var k = 0; k &lt; node.bindingAttributes.length; k++) {
                if(node.bindingAttributes[k] !== attr) {
                  // æ¢å¤åŸæ¥æ²¡æ”¹å˜çš„å±æ€§å¯¹åº”çš„æ–‡æœ¬
                  innerText = innerText.replace(&quot;{{" + node.bindingAttributes[k] + "}}&quot;, self.$data[node.bindingAttributes[k]]);
                }
              }
              node.innerText = innerText;
            }
            self._binding[attr]._texts.push(new Watcher(self, attr, updater));
          })(attr);
        }
      }

      // è§£ævueæŒ‡ä»¤
      var attributes = node.getAttributeNames();
      for(j = 0; j &lt; attributes.length; j++) {
        // vueæŒ‡ä»¤
        var attribute = attributes[j];
        // DOM attribute
        var domAttr = null;
        // ç»‘å®šçš„dataå±æ€§
        var vmDataAttr = node.getAttribute(attribute);

        if(/v-bind:([^=]+)/.test(attribute)) {
          // è§£æv-bind
          domAttr = RegExp.$1;
          // æ›´æ–°å‡½æ•°
          updater = function(val) {
            node[domAttr] = val;
          }
          // dataå±æ€§ç»‘å®šå¤šä¸ªwatcher
          self._binding[vmDataAttr]._directives.push(
            new Watcher(self, vmDataAttr, updater)
          )
        } elseif(attribute === &quot;v-model&quot; &amp;&amp; (node.tagName = &apos;INPUT&apos; || node.tagName == &apos;TEXTAREA&apos;)) {
          // è§£æv-model
          // æ›´æ–°å‡½æ•°
          updater = function(val) {
            node.value = val;
          }
          // dataå±æ€§ç»‘å®šå¤šä¸ªwatcher
          self._binding[vmDataAttr]._directives.push(
            new Watcher(self, vmDataAttr, updater)
          )
          // ç›‘å¬input/textareaçš„æ•°æ®å˜åŒ–ï¼ŒåŒæ­¥åˆ°modelå»ï¼Œå®ç°åŒå‘ç»‘å®š
          node.addEventListener(&quot;input&quot;, function(evt) {
            var $el = evt.currentTarget;
            self.$data[vmDataAttr] = $el.value;
          });
        } elseif(/v-on:([^=]+)/.test(attribute)) {
          // è§£æv-on
          var event = RegExp.$1;
          var method = vmDataAttr;
          node.addEventListener(event, function(evt) {
            self.$methods[method] &amp;&amp; self.$methods[method].call(self, evt);
          });
        }
      }
    })(node);
  }

}
</code></pre><h3 id="Watcherçš„å®ç°"><a href="#Watcherçš„å®ç°" class="headerlink" title="Watcherçš„å®ç°"></a>Watcherçš„å®ç°</h3><p>Watcherå……å½“è®¢é˜…è€…çš„è§’è‰²ï¼Œæ¶èµ·äº†Observerå’ŒCompileçš„æ¡¥æ¢ï¼ŒObserverç›‘å¬åˆ°æ•°æ®å˜åŒ–åï¼Œé€šçŸ¥Wathceræ›´æ–°è§†å›¾(è°ƒç”¨Wathcerçš„updateæ–¹æ³•)ï¼ŒWatcherå†å‘Šè¯‰Compileå»è°ƒç”¨æ›´æ–°å‡½æ•°ï¼Œå®ç°domçš„æ›´æ–°ã€‚åŒæ—¶é¡µé¢çš„åˆå§‹åŒ–æ¸²æŸ“ä¹Ÿäº¤ç»™äº†Watcherï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥æ”¾åˆ°Compileè¿›è¡Œï¼‰ã€‚</p>
<pre><code>function Watcher(vm, attr, cb) {
  this.vm = vm; // viewmodel
  this.attr = attr; // dataçš„å±æ€§ï¼Œä¸€ä¸ªwatcherè®¢é˜…ä¸€ä¸ªdataå±æ€§
  this.cb = cb; // æ›´æ–°å‡½æ•°ï¼Œåœ¨compileé‚£è¾¹å®šä¹‰
  // åˆå§‹åŒ–æ¸²æŸ“è§†å›¾
  this.update();
}

Watcher.prototype.update = function() {
  // é€šçŸ¥comileä¸­çš„æ›´æ–°å‡½æ•°æ›´æ–°dom 
  this.cb(this.vm.$data[this.attr]);
}
</code></pre><h3 id="å…¨éƒ¨ä»£ç "><a href="#å…¨éƒ¨ä»£ç " class="headerlink" title="å…¨éƒ¨ä»£ç "></a>å…¨éƒ¨ä»£ç </h3><p>gitåœ°å€ï¼š<a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2FVikiLee%2FMVVM.git" target="_blank" rel="noopener">github.com/VikiLee/MVVâ€¦</a></p>
<p>é¸£è°¢ï¼š<a href="https://link.juejin.im?target=https%3A%2F%2Fjuejin.im%2Fpost%2F5acc17cb51882555745a03f8" target="_blank" rel="noopener">juejin.im/post/5acc17â€¦</a></p>
<h3 id="ä½¿ç”¨ä¾‹å­"><a href="#ä½¿ç”¨ä¾‹å­" class="headerlink" title="ä½¿ç”¨ä¾‹å­"></a>ä½¿ç”¨ä¾‹å­</h3><pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
  &lt;meta charset=&quot;UTF-8&quot;&gt;
  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
  &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;
  &lt;title&gt;Document&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div id=&quot;view&quot;&gt;
    &lt;div v-bind:id=&quot;id&quot;&gt;
      {{message}}:{{name}}
    &lt;/div&gt;
    &lt;input type=&quot;text&quot; v-model=&quot;name&quot;/&gt;
    &lt;button v-on:click=&quot;handleClick&quot;&gt;è·å–è¾“å…¥å€¼&lt;/button&gt;
  &lt;/div&gt;
&lt;/body&gt;
&lt;script src=&quot;js/MVVM.js&quot;type=&quot;text/javascript&quot;&gt;&lt;/script&gt;
&lt;script&gt;
  var vue = new MVVM({
    el: &quot;#view&quot;,
    data: {
      message: &quot;æ¬¢è¿å…‰ä¸´&quot;,
      name: &quot;é¸£äºº&quot;,
      id: &quot;id&quot;
    },
    methods: {
      handleClick: function() {
        alert(this.message + &quot;:&quot; + this.name + &quot;, ç‚¹å‡»ç¡®å®šè·¯é£ä¼šå‡ºæ¥&quot;);
        this.name = &apos;è·¯é£&apos;;
      }
    }
  })

  setTimeout(function() {
    vue.message = &quot;ä½ å¥½&quot;;
  }, 1000);
&lt;/script&gt;
&lt;/html&gt;
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/02/Promise-å¿…çŸ¥å¿…ä¼š/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/02/Promise-å¿…çŸ¥å¿…ä¼š/" itemprop="url">Promise å¿…çŸ¥å¿…ä¼š</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-10-02T23:18:00+08:00">
                2018-10-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="ä½ ä¸çŸ¥é“çš„-Promise-å¯¹è±¡é»‘ç§‘æŠ€"><a href="#ä½ ä¸çŸ¥é“çš„-Promise-å¯¹è±¡é»‘ç§‘æŠ€" class="headerlink" title="ä½ ä¸çŸ¥é“çš„ Promise å¯¹è±¡é»‘ç§‘æŠ€"></a><a href="https://zhuanlan.zhihu.com/p/30735250" target="_blank" rel="noopener">ä½ ä¸çŸ¥é“çš„ Promise å¯¹è±¡é»‘ç§‘æŠ€</a></h2><p>Promise æƒ³å¿…å¤§å®¶éƒ½ååˆ†ç†Ÿæ‚‰ï¼Œæƒ³æƒ³å°±é‚£ä¹ˆå‡ ä¸ª apiï¼Œå¯æ˜¯ä½ çœŸçš„äº†è§£ Promise å—ï¼Ÿæœ¬æ–‡æ ¹æ® Promise çš„ä¸€äº›çŸ¥è¯†ç‚¹æ€»ç»“äº†åé“é¢˜ï¼Œçœ‹çœ‹ä½ èƒ½åšå¯¹å‡ é“ã€‚</p>
<p>ä»¥ä¸‹ promise å‡æŒ‡ä»£ Promise å®ä¾‹ï¼Œç¯å¢ƒæ˜¯ Node.jsã€‚</p>
<h2 id="é¢˜ç›®ä¸€"><a href="#é¢˜ç›®ä¸€" class="headerlink" title="é¢˜ç›®ä¸€"></a>é¢˜ç›®ä¸€</h2><pre><code>const promise = new Promise((resolve, reject) =&gt; {
  console.log(1)
  resolve()
  console.log(2)
})
promise.then(() =&gt; {
  console.log(3)
})
console.log(4)
</code></pre><p>è¿è¡Œç»“æœï¼š</p>
<pre><code>1
2
4
3
</code></pre><p>è§£é‡Šï¼šPromise æ„é€ å‡½æ•°æ˜¯åŒæ­¥æ‰§è¡Œçš„ï¼Œpromise.then ä¸­çš„å‡½æ•°æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ã€‚</p>
<h2 id="é¢˜ç›®äºŒ"><a href="#é¢˜ç›®äºŒ" class="headerlink" title="é¢˜ç›®äºŒ"></a>é¢˜ç›®äºŒ</h2><pre><code>const promise = new Promise((resolve, reject) =&gt; {
  setTimeout(() =&gt; {
    resolve(&apos;success&apos;)
  }, 1000)
})
console.log(promise)
promise
  .then(() =&gt; {
    console.log(promise)
    throw new Error(&apos;error!!!&apos;)
  })
  .catch(err =&gt; {
    console.log(promise)
  })
</code></pre><p>è¿è¡Œç»“æœï¼š</p>
<pre><code>Promise { &lt;pending&gt; }
Promise { &apos;success&apos; }
Promise { &apos;success&apos; }
</code></pre><p>è§£é‡Šï¼špromise æœ‰ 3 ç§çŠ¶æ€ï¼špendingã€fulfilled å’Œ rejectedã€‚çŠ¶æ€æ”¹å˜åªèƒ½æ˜¯ pending-&gt;fulfilled æˆ–è€… pending-&gt;rejectedï¼ŒçŠ¶æ€ä¸€æ—¦æ”¹å˜åˆ™ä¸èƒ½å†å˜ã€‚</p>
<h2 id="é¢˜ç›®ä¸‰"><a href="#é¢˜ç›®ä¸‰" class="headerlink" title="é¢˜ç›®ä¸‰"></a>é¢˜ç›®ä¸‰</h2><pre><code>const promise = new Promise((resolve, reject) =&gt; {
  resolve(&apos;success1&apos;)
  reject(&apos;error&apos;)
  resolve(&apos;success2&apos;)
})

promise
  .then((res) =&gt; {
    console.log(&apos;then: &apos;, res)
  })
  .catch((err) =&gt; {
    console.log(&apos;catch: &apos;, err)
  })
</code></pre><p>è¿è¡Œç»“æœï¼š</p>
<pre><code>then: success1
</code></pre><p>è§£é‡Šï¼šæ„é€ å‡½æ•°ä¸­çš„ resolve æˆ– reject åªæœ‰ç¬¬ä¸€æ¬¡æ‰§è¡Œæœ‰æ•ˆï¼Œå¤šæ¬¡è°ƒç”¨æ²¡æœ‰ä»»ä½•ä½œç”¨ï¼Œå‘¼åº”ä»£ç äºŒç»“è®ºï¼špromise çŠ¶æ€ä¸€æ—¦æ”¹å˜åˆ™ä¸èƒ½å†å˜ã€‚</p>
<h2 id="é¢˜ç›®å››"><a href="#é¢˜ç›®å››" class="headerlink" title="é¢˜ç›®å››"></a>é¢˜ç›®å››</h2><pre><code>Promise.resolve(1)
  .then((res) =&gt; {
    console.log(res)
    return 2
  })
  .catch((err) =&gt; {
    return 3
  })
  .then((res) =&gt; {
    console.log(res)
  })
</code></pre><p>è¿è¡Œç»“æœï¼š</p>
<pre><code>1
2
</code></pre><p>è§£é‡Šï¼špromise å¯ä»¥é“¾å¼è°ƒç”¨ã€‚æèµ·é“¾å¼è°ƒç”¨æˆ‘ä»¬é€šå¸¸ä¼šæƒ³åˆ°é€šè¿‡ return this å®ç°ï¼Œä¸è¿‡ Promise å¹¶ä¸æ˜¯è¿™æ ·å®ç°çš„ã€‚promise æ¯æ¬¡è°ƒç”¨ .then æˆ–è€… .catch éƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„ promiseï¼Œä»è€Œå®ç°äº†é“¾å¼è°ƒç”¨ã€‚</p>
<h2 id="é¢˜ç›®äº”"><a href="#é¢˜ç›®äº”" class="headerlink" title="é¢˜ç›®äº”"></a>é¢˜ç›®äº”</h2><pre><code>const promise = new Promise((resolve, reject) =&gt; {
  setTimeout(() =&gt; {
    console.log(&apos;once&apos;)
    resolve(&apos;success&apos;)
  }, 1000)
})

const start = Date.now()
promise.then((res) =&gt; {
  console.log(res, Date.now() - start)
})
promise.then((res) =&gt; {
  console.log(res, Date.now() - start)
})
</code></pre><p>è¿è¡Œç»“æœï¼š</p>
<pre><code>once
success 1005
success 1007
</code></pre><p>è§£é‡Šï¼špromise çš„ .then æˆ–è€… .catch å¯ä»¥è¢«è°ƒç”¨å¤šæ¬¡ï¼Œä½†è¿™é‡Œ Promise æ„é€ å‡½æ•°åªæ‰§è¡Œä¸€æ¬¡ã€‚æˆ–è€…è¯´ promise å†…éƒ¨çŠ¶æ€ä¸€ç»æ”¹å˜ï¼Œå¹¶ä¸”æœ‰äº†ä¸€ä¸ªå€¼ï¼Œé‚£ä¹ˆåç»­æ¯æ¬¡è°ƒç”¨ .then æˆ–è€… .catch éƒ½ä¼šç›´æ¥æ‹¿åˆ°è¯¥å€¼ã€‚</p>
<h2 id="é¢˜ç›®å…­"><a href="#é¢˜ç›®å…­" class="headerlink" title="é¢˜ç›®å…­"></a>é¢˜ç›®å…­</h2><pre><code>Promise.resolve()
  .then(() =&gt; {
    return new Error(&apos;error!!!&apos;)
  })
  .then((res) =&gt; {
    console.log(&apos;then: &apos;, res)
  })
  .catch((err) =&gt; {
    console.log(&apos;catch: &apos;, err)
  })
</code></pre><p>è¿è¡Œç»“æœï¼š</p>
<pre><code>then: Error: error!!!
    at Promise.resolve.then (...)
    at ...
</code></pre><p>è§£é‡Šï¼š.then æˆ–è€… .catch ä¸­ return ä¸€ä¸ª error å¯¹è±¡å¹¶ä¸ä¼šæŠ›å‡ºé”™è¯¯ï¼Œæ‰€ä»¥ä¸ä¼šè¢«åç»­çš„ .catch æ•è·ï¼Œéœ€è¦æ”¹æˆå…¶ä¸­ä¸€ç§ï¼š</p>
<ol>
<li>return Promise.reject(new Error(â€˜error!!!â€™))</li>
<li>throw new Error(â€˜error!!!â€™)</li>
</ol>
<p>å› ä¸ºè¿”å›ä»»æ„ä¸€ä¸ªé promise çš„å€¼éƒ½ä¼šè¢«åŒ…è£¹æˆ promise å¯¹è±¡ï¼Œå³ return new Error(â€˜error!!!â€™) ç­‰ä»·äº return Promise.resolve(new Error(â€˜error!!!â€™))ã€‚</p>
<h2 id="é¢˜ç›®ä¸ƒ"><a href="#é¢˜ç›®ä¸ƒ" class="headerlink" title="é¢˜ç›®ä¸ƒ"></a>é¢˜ç›®ä¸ƒ</h2><pre><code>const promise = Promise.resolve()
  .then(() =&gt; {
    return promise
  })
promise.catch(console.error)
</code></pre><p>è¿è¡Œç»“æœï¼š</p>
<pre><code>TypeError: Chaining cycle detected for promise #&lt;Promise&gt;
    at &lt;anonymous&gt;
    at process._tickCallback (internal/process/next_tick.js:188:7)
    at Function.Module.runMain (module.js:667:11)
    at startup (bootstrap_node.js:187:16)
    at bootstrap_node.js:607:3
</code></pre><p>è§£é‡Šï¼š.then æˆ– .catch è¿”å›çš„å€¼ä¸èƒ½æ˜¯ promise æœ¬èº«ï¼Œå¦åˆ™ä¼šé€ æˆæ­»å¾ªç¯ã€‚ç±»ä¼¼äºï¼š</p>
<pre><code>process.nextTick(function tick () {
  console.log(&apos;tick&apos;)
  process.nextTick(tick)
})
</code></pre><h2 id="é¢˜ç›®å…«"><a href="#é¢˜ç›®å…«" class="headerlink" title="é¢˜ç›®å…«"></a>é¢˜ç›®å…«</h2><pre><code>Promise.resolve(1)
  .then(2)
  .then(Promise.resolve(3))
  .then(console.log)
</code></pre><p>è¿è¡Œç»“æœï¼š</p>
<pre><code>1
</code></pre><p>è§£é‡Šï¼š.then æˆ–è€… .catch çš„å‚æ•°æœŸæœ›æ˜¯å‡½æ•°ï¼Œä¼ å…¥éå‡½æ•°åˆ™ä¼šå‘ç”Ÿå€¼ç©¿é€ã€‚</p>
<h2 id="é¢˜ç›®ä¹"><a href="#é¢˜ç›®ä¹" class="headerlink" title="é¢˜ç›®ä¹"></a>é¢˜ç›®ä¹</h2><pre><code>Promise.resolve()
  .then(function success (res) {
    throw new Error(&apos;error&apos;)
  }, function fail1 (e) {
    console.error(&apos;fail1: &apos;, e)
  })
  .catch(function fail2 (e) {
    console.error(&apos;fail2: &apos;, e)
  })
</code></pre><p>è¿è¡Œç»“æœï¼š</p>
<pre><code>fail2: Error: error
    at success (...)
    at ...
</code></pre><p>è§£é‡Šï¼š.then å¯ä»¥æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯å¤„ç†æˆåŠŸçš„å‡½æ•°ï¼Œç¬¬äºŒä¸ªæ˜¯å¤„ç†é”™è¯¯çš„å‡½æ•°ã€‚.catch æ˜¯ .then ç¬¬äºŒä¸ªå‚æ•°çš„ç®€ä¾¿å†™æ³•ï¼Œä½†æ˜¯å®ƒä»¬ç”¨æ³•ä¸Šæœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼š.then çš„ç¬¬äºŒä¸ªå¤„ç†é”™è¯¯çš„å‡½æ•°æ•è·ä¸äº†ç¬¬ä¸€ä¸ªå¤„ç†æˆåŠŸçš„å‡½æ•°æŠ›å‡ºçš„é”™è¯¯ï¼Œè€Œåç»­çš„ .catch å¯ä»¥æ•è·ä¹‹å‰çš„é”™è¯¯ã€‚å½“ç„¶ä»¥ä¸‹ä»£ç ä¹Ÿå¯ä»¥ï¼š</p>
<pre><code>Promise.resolve()
  .then(function success1 (res) {
    throw new Error(&apos;error&apos;)
  }, function fail1 (e) {
    console.error(&apos;fail1: &apos;, e)
  })
  .then(function success2 (res) {
  }, function fail2 (e) {
    console.error(&apos;fail2: &apos;, e)
  })
</code></pre><h2 id="é¢˜ç›®å"><a href="#é¢˜ç›®å" class="headerlink" title="é¢˜ç›®å"></a>é¢˜ç›®å</h2><pre><code>process.nextTick(() =&gt; {
  console.log(&apos;nextTick&apos;)
})
Promise.resolve()
  .then(() =&gt; {
    console.log(&apos;then&apos;)
  })
setImmediate(() =&gt; {
  console.log(&apos;setImmediate&apos;)
})
console.log(&apos;end&apos;)
</code></pre><p>è¿è¡Œç»“æœï¼š</p>
<pre><code>end
nextTick
then
setImmediate
</code></pre><p>è§£é‡Šï¼šprocess.nextTick å’Œ promise.then éƒ½å±äº microtasksï¼Œè€Œ setImmediate å±äº macrotasksï¼Œåœ¨äº‹ä»¶å¾ªç¯çš„ check é˜¶æ®µæ‰§è¡Œã€‚äº‹ä»¶å¾ªç¯çš„æ¯ä¸ªé˜¶æ®µï¼ˆmacrotasksï¼‰ä¹‹é—´éƒ½ä¼šæ‰§è¡Œ microtasksï¼Œäº‹ä»¶å¾ªç¯çš„å¼€å§‹ä¼šå…ˆæ‰§è¡Œä¸€æ¬¡ microtasksã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/01/JSæ­£åˆ™è¡¨è¾¾å¼Regex/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/01/JSæ­£åˆ™è¡¨è¾¾å¼Regex/" itemprop="url">JSæ­£åˆ™è¡¨è¾¾å¼Regex</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-10-01T21:56:19+08:00">
                2018-10-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>åä½™æ›°æ­£åˆ™å…®ï¼Œå­—ä½™æ›°çµå‡ã€‚</p>
</blockquote>
<p><code>Regular Expressions</code>ç¿»è¯‘æˆä¸­æ–‡å«æ­£åˆ™è¡¨è¾¾å¼ã€‚ä¹Ÿä¸çŸ¥é“æ˜¯è°ç¿»è¯‘è¿‡æ¥çš„ï¼Œå¬èµ·æ¥å°±å¾ˆä¸¥è‚ƒã€‚ä¼¼ä¹ç¿»è¯‘æˆ<code>é€šç”¨è¡¨è¾¾å¼</code>æ›´èƒ½ä¼ è¾¾å…¶ç²¾é«“ï¼Œå¦‚æœä½ ä¸æ€•æ¢¦è§å±ˆåŸçš„è¯ã€‚</p>
<p>ä¸ºä»€ä¹ˆå«é€šç”¨è¡¨è¾¾å¼ï¼Ÿå› ä¸ºå®ƒæœ‰ä¸€å¥—å’Œç¼–ç¨‹è¯­è¨€æ— å…³çš„æ–‡æœ¬åŒ¹é…è§„åˆ™ã€‚å¾ˆå¤šè¯­è¨€éƒ½å®ç°äº†æ­£åˆ™è¡¨è¾¾å¼çš„æ–‡æœ¬åŒ¹é…å¼•æ“ï¼Œåªä¸è¿‡åœ¨åŠŸèƒ½é›†åˆä¸Šç•¥æœ‰ä¸åŒã€‚</p>
<p>æˆ‘ä»¬è¦è®°ä½çš„æ˜¯ä¸‰ç‚¹ï¼š</p>
<p>å…¶ä¸€ï¼Œæ­£åˆ™è¡¨è¾¾å¼æ˜¯ç”¨æ¥æå–æ–‡æœ¬çš„ã€‚</p>
<p>å…¶äºŒï¼Œæ­£åˆ™è¡¨è¾¾å¼çš„è¡¨è¾¾èƒ½åŠ›å¼ºå¤§åˆ°ä»¤äººå‘æŒ‡ã€‚</p>
<p>å…¶ä¸‰ï¼Œæ­£åˆ™è¡¨è¾¾å¼çš„è¯­æ³•å¯¹åˆå­¦è€…ä¸å‹å¥½ã€‚</p>
<p>å¦å¤–ï¼Œæœ¬ä¸“é¢˜åªæ¶‰åŠJavaScriptè¯­è¨€çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œå…¶ä»–è¯­è¨€çš„è§„åˆ™å¯èƒ½ç•¥æœ‰ä¸åŒã€‚</p>
<p>æˆ‘è¿˜ä¸ºå„ä½è¯»è€…å‡†å¤‡äº†ä¸€å‰¯å®£ä¼ è¯­ï¼Œåº”è¯¥èƒ½è®©ä½ å¿ƒåŠ¨(ç‚¹èµ)å§ï¼Ÿ</p>
<blockquote>
<p>å­¦ä¸€é—¨å‰ç«¯å·¥å…·ï¼Œå‡ å¹´å°±è¿‡æ—¶äº†ã€‚å­¦æ­£åˆ™è¡¨è¾¾å¼ï¼Œå—ç”¨ä¸€è¾ˆå­ã€‚</p>
</blockquote>
<h2 id="æ™®é€šå­—ç¬¦"><a href="#æ™®é€šå­—ç¬¦" class="headerlink" title="æ™®é€šå­—ç¬¦"></a>æ™®é€šå­—ç¬¦</h2><p>ä»€ä¹ˆå«æ™®é€šå­—ç¬¦ï¼Ÿ</p>
<p>å½“æˆ‘ä»¬å†™<code>a</code>çš„æ—¶å€™ï¼Œæˆ‘ä»¬æŒ‡çš„å°±æ˜¯<code>a</code>ï¼›å½“æˆ‘ä»¬å†™<code>çˆ±</code>çš„æ—¶å€™ï¼Œæˆ‘ä»¬æŒ‡çš„å°±æ˜¯<code>çˆ±</code>ã€‚</p>
<pre><code>&apos;hello ğŸ˜€ regex&apos;.match(/ğŸ˜€/);
// [&quot;ğŸ˜€&quot;, index: 6, input: &quot;hello ğŸ˜€ regex&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><p>è¿™å°±æ˜¯æ™®é€šå­—ç¬¦ï¼Œå®ƒåœ¨æ­£åˆ™ä¸­çš„å«ä¹‰å°±æ˜¯æ£€ç´¢å®ƒæœ¬èº«ã€‚é™¤äº†æ­£åˆ™è§„å®šçš„éƒ¨åˆ†å­—ç¬¦å¤–ï¼Œå…¶ä½™çš„éƒ½æ˜¯æ™®é€šå­—ç¬¦ï¼ŒåŒ…æ‹¬å„ç§äººç±»è¯­è¨€ï¼ŒåŒ…æ‹¬emojiï¼Œåªè¦èƒ½å¤Ÿè¡¨è¾¾ä¸ºå­—ç¬¦ä¸²ã€‚</p>
<h2 id="å¼€å§‹ä¸ç»“æŸ"><a href="#å¼€å§‹ä¸ç»“æŸ" class="headerlink" title="å¼€å§‹ä¸ç»“æŸ"></a>å¼€å§‹ä¸ç»“æŸ</h2><p><code>^</code>å­—ç¬¦çš„è‹±æ–‡æ˜¯<code>caret</code>ï¼Œç¿»è¯‘æˆä¸­æ–‡æ˜¯<code>è„±å­—ç¬¦</code>ã€‚ä¸è¦é—®æˆ‘ï¼Œåˆä¸æ˜¯æˆ‘ç¿»è¯‘çš„ã€‚å®ƒåœ¨æ­£åˆ™ä¸­å±äºå…ƒå­—ç¬¦ï¼Œé€šå¸¸ä»£è¡¨çš„æ„ä¹‰æ˜¯æ–‡æœ¬çš„å¼€å§‹ã€‚è¯´é€šå¸¸æ˜¯å› ä¸ºå½“å®ƒåœ¨å­—ç¬¦ç»„ä¸­<code>[^abc]</code>å¦æœ‰å«ä¹‰ã€‚</p>
<p>ä»€ä¹ˆå«æ–‡æœ¬çš„å¼€å§‹ï¼Ÿå°±æ˜¯å¦‚æœå®ƒæ˜¯æ­£åˆ™ä¸»ä½“çš„ç¬¬ä¸€ä¸ªç¬¦å·ï¼Œé‚£ç´§è·Ÿç€å®ƒçš„å­—ç¬¦å¿…é¡»æ˜¯è¢«åŒ¹é…æ–‡æœ¬çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ã€‚</p>
<pre><code>&apos;regex&apos;.match(/^r/);
// [&quot;r&quot;, index: 0, input: &quot;regex&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><p>é—®é¢˜æ¥äº†ï¼Œå¦‚æœ<code>^</code>ä¸æ˜¯æ­£åˆ™çš„ç¬¬ä¸€ä¸ªç¬¦å·å‘¢ï¼Ÿ</p>
<pre><code>&apos;regex&apos;.match(/a^r/);
// nullå¤åˆ¶ä»£ç 
</code></pre><p>æ‰€ä»¥å‘€ï¼Œå…³äºå®ƒæœ‰ä¸‰ç‚¹éœ€è¦æ³¨æ„ï¼š</p>
<ul>
<li>ä½œä¸ºåŒ¹é…æ–‡æœ¬å¼€å§‹å…ƒå­—ç¬¦çš„æ—¶å€™å¿…é¡»æ˜¯æ­£åˆ™ä¸»ä½“çš„ç¬¬ä¸€ä¸ªç¬¦å·ï¼Œå¦åˆ™æ­£åˆ™æ— æ•ˆã€‚</li>
<li>å®ƒåŒ¹é…çš„æ˜¯ä¸€ä¸ªä½ç½®ï¼Œè€Œä¸æ˜¯å…·ä½“çš„æ–‡æœ¬ã€‚</li>
<li>å®ƒåœ¨å…¶ä»–è§„åˆ™ä¸­æœ‰å¦å¤–çš„å«ä¹‰ã€‚</li>
</ul>
<p><code>$</code>å­—ç¬¦ä¸<code>^</code>æ­£å¥½ç›¸åã€‚å®ƒä»£è¡¨æ–‡æœ¬çš„ç»“æŸï¼Œå¹¶ä¸”æ²¡æœ‰å…¶ä»–å«ä¹‰(å…¶å®æ˜¯æœ‰çš„ï¼Œä½†ä¸æ˜¯åœ¨æ­£åˆ™ä¸»ä½“å†…)ã€‚åŒæ ·ï¼Œå®ƒå¿…é¡»æ˜¯æ­£åˆ™ä¸»ä½“çš„æœ€åä¸€ä¸ªç¬¦å·ã€‚</p>
<pre><code>&apos;regex&apos;.match(/x$/);
// [&quot;x&quot;, index: 4, input: &quot;regex&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><p><code>^</code>ä¸<code>$</code>ç‰¹æ®Šçš„åœ°æ–¹åœ¨äºå®ƒåŒ¹é…çš„æ˜¯ä¸€ä¸ªä½ç½®ã€‚ä½ç½®ä¸åƒå­—ç¬¦ï¼Œå®ƒçœ‹ä¸è§ï¼Œæ‰€ä»¥æ›´ä¸å®¹æ˜“ç†è§£ã€‚</p>
<h2 id="è½¬ä¹‰"><a href="#è½¬ä¹‰" class="headerlink" title="è½¬ä¹‰"></a>è½¬ä¹‰</h2><p>æˆ‘ä»¬ç°åœ¨å·²ç»çŸ¥é“<code>$</code>åŒ¹é…æ–‡æœ¬çš„ç»“æŸä½ç½®ï¼Œå®ƒæ˜¯å…ƒå­—ç¬¦ã€‚ä½†æ˜¯å¦‚æœæˆ‘æƒ³åŒ¹é…<code>$</code>æœ¬èº«å‘¢ï¼ŸåŒ¹é…ä¸€ä¸ªç¾å…ƒç¬¦å·çš„éœ€æ±‚å†å¸¸è§ä¸è¿‡äº†å§ã€‚æ‰€ä»¥æˆ‘ä»¬å¾—å°†å®ƒè´¬ä¸ºåº¶æ°‘ã€‚</p>
<p><code>\</code>åæ–œæ å°±æ˜¯å¹²è¿™ä¸ªçš„ã€‚</p>
<pre><code>&apos;price: $3.6&apos;.match(/\$[0-9]+\.[0-9]+$/);
// [&quot;$3.6&quot;, index: 7, input: &quot;price: $3.6&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><p>ä¸Šé¢çš„ä¾‹å­æœ‰ç‚¹è¶…çº²äº†ï¼Œè¶…çº²çš„éƒ¨åˆ†å…ˆä¸ç®¡ã€‚</p>
<p>ä½ å¯ä»¥è®¤ä¸º<code>\</code>ä¹Ÿæ˜¯ä¸€ä¸ªå…ƒå­—ç¬¦ï¼Œå®ƒè·Ÿåœ¨å¦ä¸€ä¸ªå…ƒå­—ç¬¦åé¢ï¼Œå°±èƒ½è¿˜åŸå®ƒæœ¬æ¥çš„å«ä¹‰ã€‚</p>
<p>å¦‚æœæœ‰ä¸¤ä¸ª<code>\</code>å‘¢ï¼Ÿé‚£å°±æ˜¯è½¬ä¹‰è‡ªèº«äº†ã€‚å¦‚æœæœ‰ä¸‰ä¸ª<code>\</code>å‘¢ï¼Ÿæˆ‘ä»¬å¾—åˆ†æˆä¸¤æ®µå»ç†è§£ã€‚ä»¥æ­¤ç±»æ¨ã€‚</p>
<p>æ™®é€šå­—ç¬¦å‰é¢è·Ÿäº†ä¸€ä¸ª<code>\</code>æ˜¯ä»€ä¹ˆæ•ˆæœï¼Ÿé¦–å…ˆå®ƒä»¬æ˜¯ä¸€ä¸ªæ•´ä½“ï¼Œç„¶åæ™®é€šå­—ç¬¦è½¬ä¹‰åè¿˜æ˜¯æ™®é€šå­—ç¬¦ã€‚</p>
<h2 id="å¸¦åæ–œæ çš„å…ƒå­—ç¬¦"><a href="#å¸¦åæ–œæ çš„å…ƒå­—ç¬¦" class="headerlink" title="å¸¦åæ–œæ çš„å…ƒå­—ç¬¦"></a>å¸¦åæ–œæ çš„å…ƒå­—ç¬¦</h2><p>ä¸€èˆ¬æ¥è¯´ï¼Œæ™®é€šå­—ç¬¦å‰é¢å¸¦åæ–œæ è¿˜æ˜¯æ™®é€šå­—ç¬¦ï¼Œä½†æ˜¯æœ‰ä¸€äº›æ™®é€šå­—ç¬¦ï¼Œå¸¦åæ–œæ ååè€Œå˜æˆäº†å…ƒå­—ç¬¦ã€‚</p>
<p>è¦æ€ªåªèƒ½æ€ªè®¡ç®—æœºé¢†åŸŸçš„å¸¸ç”¨ç¬¦å·å¤ªå°‘äº†ã€‚<br>å…ƒå­—ç¬¦å«ä¹‰\båŒ¹é…ä¸€ä¸ªå•è¯è¾¹ç•Œ(boundary)\BåŒ¹é…ä¸€ä¸ªéå•è¯è¾¹ç•Œ\dåŒ¹é…ä¸€ä¸ªæ•°å­—å­—ç¬¦(digit)\DåŒ¹é…ä¸€ä¸ªéæ•°å­—å­—ç¬¦\såŒ¹é…ä¸€ä¸ªç©ºç™½å­—ç¬¦(space)\SåŒ¹é…ä¸€ä¸ªéç©ºç™½å­—ç¬¦\wåŒ¹é…ä¸€ä¸ªå­—æ¯æˆ–è€…ä¸€ä¸ªæ•°å­—æˆ–è€…ä¸€ä¸ªä¸‹åˆ’çº¿(word)\WåŒ¹é…ä¸€ä¸ªå­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿ä¹‹å¤–çš„å­—ç¬¦<br>ä½ è¿™ä¹ˆèªæ˜ï¼Œè‚¯å®šä¸€çœ¼å°±çœ‹å‡ºæ¥ï¼Œå¤§å†™ä»£è¡¨åä¹‰ã€‚å¯¹ï¼Œå°±æ˜¯è¿™ä¹ˆå¥½è®°ã€‚</p>
<h4 id="bå…ƒå­—ç¬¦"><a href="#bå…ƒå­—ç¬¦" class="headerlink" title="\bå…ƒå­—ç¬¦"></a>\bå…ƒå­—ç¬¦</h4><p><code>\b</code>åŒ¹é…çš„ä¹Ÿæ˜¯ä¸€ä¸ªä½ç½®ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå­—ç¬¦ã€‚å•è¯å’Œç©ºæ ¼ä¹‹é—´çš„ä½ç½®ï¼Œå°±æ˜¯æ‰€è°“å•è¯è¾¹ç•Œã€‚</p>
<pre><code>&apos;hello regex&apos;.match(/\bregex$/);
// [&quot;regex&quot;, index: 6, input: &quot;hello regex&quot;, groups: undefined]&apos;hello regex&apos;.match(/\Bregex$/);
// nullå¤åˆ¶ä»£ç 
</code></pre><p>æ‰€è°“å•è¯è¾¹ç•Œï¼Œå¯¹ä¸­æ–‡ç­‰å…¶ä»–è¯­è¨€æ˜¯æ— æ•ˆçš„ã€‚</p>
<pre><code>&apos;jiangshuying gaoyuanyuan huosiyan&apos;.match(/\bgaoyuanyuan\b/);
// [&quot;gaoyuanyuan&quot;, index: 13, input: &quot;jiangshuying gaoyuanyuan huosiyan&quot;, groups: undefined]&apos;æ±Ÿç–å½± é«˜åœ†åœ† éœæ€ç‡•&apos;.match(/\bé«˜åœ†åœ†\b/);
// nullå¤åˆ¶ä»£ç 
</code></pre><p>æ‰€ä»¥<code>\b</code>ç¿»è¯‘ä¸€ä¸‹å°±æ˜¯<code>^\w|\w$|\W\w|\w\W</code>ã€‚</p>
<h4 id="då…ƒå­—ç¬¦"><a href="#då…ƒå­—ç¬¦" class="headerlink" title="\då…ƒå­—ç¬¦"></a>\då…ƒå­—ç¬¦</h4><p><code>\d</code>åŒ¹é…ä¸€ä¸ªæ•°å­—ï¼Œæ³¨æ„ï¼Œè¿™é‡Œçš„æ•°å­—ä¸æ˜¯æŒ‡JavaScriptä¸­çš„æ•°å­—ç±»å‹ï¼Œå› ä¸ºæ–‡æœ¬å…¨æ˜¯å­—ç¬¦ä¸²ã€‚å®ƒæŒ‡çš„æ˜¯ä»£è¡¨æ•°å­—çš„å­—ç¬¦ã€‚</p>
<pre><code>&apos;123&apos;.match(/\d/);
// [&quot;1&quot;, index: 0, input: &quot;123&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><h4 id="så…ƒå­—ç¬¦"><a href="#så…ƒå­—ç¬¦" class="headerlink" title="\så…ƒå­—ç¬¦"></a>\så…ƒå­—ç¬¦</h4><p><code>\s</code>åŒ¹é…ä¸€ä¸ªç©ºç™½å­—ç¬¦ã€‚</p>
<p>è¿™é‡Œéœ€è¦è§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯ç©ºç™½å­—ç¬¦ã€‚</p>
<p>ç©ºç™½å­—ç¬¦ä¸æ˜¯ç©ºæ ¼ï¼Œå®ƒæ˜¯ç©ºæ ¼çš„è¶…é›†ã€‚å¾ˆå¤šäººè¯´å®ƒæ˜¯<code>\f\n\r\t\v</code>çš„æ€»å’Œï¼Œå…¶ä¸­<code>\f</code>æ˜¯æ¢é¡µç¬¦ï¼Œ<code>\n</code>æ˜¯æ¢è¡Œç¬¦ï¼Œ<code>\r</code>æ˜¯å›è½¦ç¬¦ï¼Œ<code>\t</code>æ˜¯æ°´å¹³åˆ¶è¡¨ç¬¦ï¼Œ<code>\v</code>æ˜¯å‚ç›´åˆ¶è¡¨ç¬¦ã€‚æ˜¯è¿™æ ·ä¹ˆï¼Ÿ</p>
<pre><code>&apos;a b&apos;.match(/\w\s\w/);
// [&quot;a b&quot;, index: 0, input: &quot;a b&quot;, groups: undefined]&apos;a b&apos;.match(/\w\f\w/);
// null&apos;a b&apos;.match(/\w\n\w/);
// null&apos;a b&apos;.match(/\w\r\w/);
// null&apos;a b&apos;.match(/\w\t\w/);
// null&apos;a b&apos;.match(/\w\v\w/);
// null&apos;a b&apos;.match(/\w \w/);
// [&quot;a b&quot;, index: 0, input: &quot;a b&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><p>è¿™æ ·è¯´çš„äººï¼Œæ˜æ˜¾æ˜¯æ²¡æœ‰åšè¿‡å®éªŒã€‚å…¶å®æ­£ç¡®çš„å†™æ³•æ˜¯<code>ç©ºæ ¼\f\n\r\t\v</code>çš„æ€»å’Œï¼Œé›†åˆé‡Œé¢åŒ…å«ä¸€ä¸ªç©ºæ ¼ï¼Œå¯åƒä¸‡åˆ«å¿½ç•¥äº†ã€‚è¯¶ï¼Œéš¾é“ç©ºæ ¼åœ¨æ­£åˆ™ä¸­çš„å†™æ³•å°±æ˜¯<code>ç©ºä¸€æ ¼</code>ä¹ˆï¼Œæ˜¯çš„ï¼Œå°±æ˜¯è¿™æ ·éšæ„ã€‚</p>
<p>è¿™ä¸ªé›†åˆä¸­å¾ˆå¤šéƒ½æ˜¯ä¸å¯æ‰“å°å­—ç¬¦ï¼Œä¼°è®¡åªæœ‰<code>\n</code>æ˜¯æˆ‘ä»¬çš„è€æœ‹å‹ã€‚æ‰€ä»¥ï¼Œå¦‚æœä¸éœ€è¦åŒºåˆ†ç©ºæ ¼å’Œæ¢è¡Œçš„è¯ï¼Œé‚£å°±å¤§èƒ†çš„ç”¨<code>\s</code>å§ã€‚</p>
<h4 id="wå…ƒå­—ç¬¦"><a href="#wå…ƒå­—ç¬¦" class="headerlink" title="\wå…ƒå­—ç¬¦"></a>\wå…ƒå­—ç¬¦</h4><p><code>\w</code>åŒ¹é…ä¸€ä¸ªå­—æ¯æˆ–è€…ä¸€ä¸ªæ•°å­—æˆ–è€…ä¸€ä¸ªä¸‹åˆ’çº¿ã€‚ä¸ºä»€ä¹ˆè¦å°†å®ƒä»¬æ”¾ä¸€èµ·ï¼Ÿæƒ³ä¸€æƒ³JavaScriptä¸­çš„å˜é‡è§„åˆ™ï¼ŒåŒ…æ‹¬å¾ˆå¤šåº”ç”¨çš„ç”¨æˆ·åéƒ½åªèƒ½æ˜¯è¿™ä¸‰æ ·ï¼Œæ‰€ä»¥æŠŠå®ƒä»¬æ”¾ä¸€èµ·æŒºæ–¹ä¾¿çš„ã€‚</p>
<p>ä¸è¿‡è¦æ³¨æ„ï¼Œå­—æ¯æŒ‡çš„æ˜¯26ä¸ªè‹±æ–‡å­—æ¯ï¼Œå…¶ä»–çš„ä¸è¡Œã€‚</p>
<pre><code>&apos;æ­£åˆ™&apos;.match(/\w/);
// nullå¤åˆ¶ä»£ç 
</code></pre><h4 id="è´Ÿé˜´æŠ±é˜³"><a href="#è´Ÿé˜´æŠ±é˜³" class="headerlink" title="è´Ÿé˜´æŠ±é˜³"></a>è´Ÿé˜´æŠ±é˜³</h4><p>å¦‚æœæˆ‘ä»¬å°†å¤§å†™å’Œå°å†™çš„å¸¦åæ–œæ çš„å…ƒå­—ç¬¦ç»„åˆåœ¨ä¸€èµ·ï¼Œå°±èƒ½åŒ¹é…ä»»ä½•å­—ç¬¦ã€‚æ˜¯çš„ï¼Œä¸é’ˆå¯¹ä»»ä½•äººã€‚</p>
<pre><code>&apos;@regex&apos;.match(/[\s\S]/);
// [&quot;@&quot;, index: 0, input: &quot;@regex&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><p>æ–¹æ‹¬å·çš„å«ä¹‰æˆ‘ä»¬å…ˆæŒ‰ä¸‹ä¸è¡¨ã€‚</p>
<h2 id="é“ç”Ÿä¸€"><a href="#é“ç”Ÿä¸€" class="headerlink" title="é“ç”Ÿä¸€"></a>é“ç”Ÿä¸€</h2><p><code>.</code>åœ¨æ­£åˆ™ä¸­çš„å«ä¹‰ä»™é£é“éª¨ï¼Œå®ƒåŒ¹é…æ¢è¡Œç¬¦ä¹‹å¤–çš„ä»»æ„å•ä¸ªå­—ç¬¦ã€‚</p>
<p>å¦‚æœæ–‡æœ¬ä¸å­˜åœ¨æ¢è¡Œç¬¦ï¼Œé‚£ä¹ˆ<code>.</code>å’Œ<code>[\b\B]</code>å’Œ<code>[\d\D]</code>å’Œ<code>[\s\S]</code>å’Œ<code>[\w\W]</code>æ˜¯ç­‰ä»·çš„ã€‚</p>
<p>å¦‚æœæ–‡æœ¬å­˜åœ¨æ¢è¡Œç¬¦ï¼Œé‚£ä¹ˆ<code>(.|\n)</code>å’Œ<code>[\b\B]</code>å’Œ<code>[\d\D]</code>å’Œ<code>[\s\S]</code>å’Œ<code>[\w\W]</code>æ˜¯ç­‰ä»·çš„ã€‚</p>
<pre><code>&apos;@regex&apos;.match(/./);
// [&quot;@&quot;, index: 0, input: &quot;@regex&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><h2 id="é‡è¯"><a href="#é‡è¯" class="headerlink" title="é‡è¯"></a>é‡è¯</h2><p>å‰é¢æˆ‘ä»¬ä¸€ç›´åœ¨å¼ºè°ƒï¼Œä¸€ä¸ªå…ƒå­—ç¬¦åªåŒ¹é…ä¸€ä¸ªå­—ç¬¦ã€‚å³ä¾¿å¼ºå¤§å¦‚<code>.</code>å®ƒä¹Ÿåªèƒ½åŒ¹é…ä¸€ä¸ªã€‚</p>
<p>é‚£åŒ¹é…<code>gooooogle</code>çš„æ­£åˆ™æ˜¯ä¸æ˜¯å¾—å†™æˆ<code>/gooooogle/</code>å‘¢ï¼Ÿ</p>
<p>æ­£åˆ™å†·ç¬‘ï¼Œå¹¶å‘ä½ å‘å°„ä¸€ä¸ªè”‘è§†ã€‚</p>
<p>å¦‚æœåŒ¹é…çš„æ¨¡å¼æœ‰é‡å¤ï¼Œæˆ‘ä»¬å¯ä»¥å£°æ˜å®ƒé‡å¤çš„æ¬¡æ•°ã€‚<br>é‡è¯å«ä¹‰?é‡å¤é›¶æ¬¡æˆ–è€…ä¸€æ¬¡+é‡å¤ä¸€æ¬¡æˆ–è€…å¤šæ¬¡ï¼Œä¹Ÿå°±æ˜¯è‡³å°‘ä¸€æ¬¡*é‡å¤é›¶æ¬¡æˆ–è€…å¤šæ¬¡ï¼Œä¹Ÿå°±æ˜¯ä»»æ„æ¬¡æ•°{n}é‡å¤næ¬¡{n,}é‡å¤næ¬¡æˆ–è€…æ›´å¤šæ¬¡{n,m}é‡å¤næ¬¡åˆ°mæ¬¡ä¹‹é—´çš„æ¬¡æ•°ï¼ŒåŒ…å«næ¬¡å’Œmæ¬¡<br>æœ‰ä¸‰ç‚¹éœ€è¦æ³¨æ„ï¼š</p>
<ul>
<li><p><code>?</code>åœ¨è¯¸å¦‚åŒ¹é…httpåè®®çš„æ—¶å€™éå¸¸æœ‰ç”¨ï¼Œå°±åƒè¿™æ ·ï¼š<code>/http(s)?/</code>ã€‚å®ƒåœ¨æ­£åˆ™ä¸­é™¤äº†æ˜¯é‡è¯è¿˜æœ‰åˆ«çš„å«ä¹‰ï¼Œåé¢ä¼šæåˆ°ã€‚</p>
</li>
<li><p>æˆ‘ä»¬ä¹ æƒ¯ç”¨<code>/.*/</code>æ¥åŒ¹é…è‹¥å¹²å¯¹æˆ‘ä»¬æ²¡æœ‰ä»·å€¼çš„æ–‡æœ¬ï¼Œå®ƒçš„å«ä¹‰æ˜¯<code>è‹¥å¹²é™¤æ¢è¡Œç¬¦ä¹‹å¤–çš„å­—ç¬¦</code>ã€‚æ¯”å¦‚æˆ‘ä»¬éœ€è¦æ–‡æœ¬ä¸¤å¤´çš„æ ¼å¼åŒ–ä¿¡æ¯ï¼Œä¸­é—´æ˜¯ä»€ä¹ˆæ— æ‰€è°“ï¼Œå®ƒå°±æ´¾ä¸Šç”¨åœºäº†ã€‚ä¸è¿‡å®ƒçš„æ€§èƒ½å¯ä¸å¥½ã€‚</p>
</li>
<li><p><code>{n,m}</code>ä¹‹é—´ä¸èƒ½æœ‰ç©ºæ ¼ï¼Œç©ºæ ¼åœ¨æ­£åˆ™ä¸­æ˜¯æœ‰å«ä¹‰çš„ã€‚</p>
</li>
</ul>
<p>å…³äºé‡è¯æœ€ä»¤äººå›°æƒ‘çš„æ˜¯ï¼šå®ƒé‡å¤ä»€ä¹ˆï¼Ÿ</p>
<p>å®ƒé‡å¤ç´§è´´åœ¨å®ƒå‰é¢çš„æŸä¸ªé›†åˆã€‚ç¬¬ä¸€ç‚¹ï¼Œå¿…é¡»æ˜¯ç´§è´´åœ¨å®ƒå‰é¢ï¼›ç¬¬äºŒç‚¹ï¼Œé‡å¤ä¸€ä¸ªé›†åˆã€‚æœ€å¸¸è§çš„é›†åˆå°±æ˜¯ä¸€ä¸ªå­—ç¬¦ï¼Œå½“ç„¶æ­£åˆ™ä¸­æœ‰ä¸€äº›å…ƒå­—ç¬¦èƒ½å¤Ÿå°†è‹¥å¹²å­—ç¬¦å˜æˆä¸€ä¸ªé›†åˆï¼Œåé¢ä¼šè®²åˆ°ã€‚</p>
<pre><code>&apos;gooooogle&apos;.match(/go{2,5}gle/);
// [&quot;gooooogle&quot;, index: 0, input: &quot;gooooogle&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><p>å¦‚æœä¸€ä¸ªé‡è¯ç´§è´´åœ¨å¦ä¸€ä¸ªé‡è¯åé¢ä¼šæ€æ ·ï¼Ÿ</p>
<pre><code>&apos;gooooogle&apos;.match(/go{2,5}+gle/);
// Uncaught SyntaxError: Invalid regular expression: /go{2,5}+gle/: Nothing to repeatå¤åˆ¶ä»£ç 
</code></pre><h2 id="è´ªå©ªæ¨¡å¼ä¸éè´ªå©ªæ¨¡å¼"><a href="#è´ªå©ªæ¨¡å¼ä¸éè´ªå©ªæ¨¡å¼" class="headerlink" title="è´ªå©ªæ¨¡å¼ä¸éè´ªå©ªæ¨¡å¼"></a>è´ªå©ªæ¨¡å¼ä¸éè´ªå©ªæ¨¡å¼</h2><p>å‰é¢æåˆ°é‡è¯ä¸èƒ½ç´§è·Ÿåœ¨å¦ä¸€ä¸ªé‡è¯åé¢ï¼Œé©¬ä¸Šè¦ğŸ‘‹ğŸ‘‹æ‰“è„¸äº†ã€‚</p>
<pre><code>&apos;https&apos;.match(/http(s)?/);
// [&quot;https&quot;, &quot;s&quot;, index: 0, input: &quot;https&quot;, groups: undefined]&apos;https&apos;.match(/http(s)??/);
// [&quot;http&quot;, undefined, index: 0, input: &quot;https&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><p>ç„¶è€Œï¼Œæˆ‘çš„è„¸æ˜¯è¿™ä¹ˆå¥½æ‰“çš„ï¼Ÿ</p>
<p>ç´§è·Ÿåœ¨<code>?</code>åé¢çš„<code>?</code>å®ƒä¸æ˜¯ä¸€ä¸ªé‡è¯ï¼Œè€Œæ˜¯ä¸€ä¸ªæ¨¡å¼åˆ‡æ¢ç¬¦ï¼Œä»è´ªå©ªæ¨¡å¼åˆ‡æ¢åˆ°éè´ªå©ªæ¨¡å¼ã€‚</p>
<p>è´ªå©ªæ¨¡å¼åœ¨æ­£åˆ™ä¸­æ˜¯é»˜è®¤çš„æ¨¡å¼ï¼Œå°±æ˜¯åœ¨æ—¢å®šè§„åˆ™ä¹‹ä¸‹åŒ¹é…å°½å¯èƒ½å¤šçš„æ–‡æœ¬ã€‚å› ä¸ºæ­£åˆ™ä¸­æœ‰é‡è¯ï¼Œå®ƒçš„é‡å¤æ¬¡æ•°å¯èƒ½æ˜¯ä¸€ä¸ªåŒºé—´ï¼Œè¿™å°±æœ‰äº†å–èˆã€‚</p>
<p>ç´§è·Ÿåœ¨é‡è¯ä¹‹ååŠ ä¸Š<code>?</code>å°±å¯ä»¥å¼€å¯éè´ªå©ªæ¨¡å¼ã€‚æ€ä¹ˆçœäº‹æ€ä¹ˆæ¥ã€‚</p>
<p>è¿™é‡Œçš„è¦ç‚¹æ˜¯ï¼Œ<code>?</code>å¿…é¡»ç´§è·Ÿç€é‡è¯ï¼Œå¦åˆ™çš„è¯å®ƒè‡ªå·±å°±å˜æˆé‡è¯äº†ã€‚</p>
<h2 id="å­—ç¬¦ç»„"><a href="#å­—ç¬¦ç»„" class="headerlink" title="å­—ç¬¦ç»„"></a>å­—ç¬¦ç»„</h2><p>æ­£åˆ™ä¸­çš„æ™®é€šå­—ç¬¦åªèƒ½åŒ¹é…å®ƒè‡ªå·±ã€‚å¦‚æœæˆ‘è¦åŒ¹é…ä¸€ä¸ªæ™®é€šå­—ç¬¦ï¼Œä½†æ˜¯æˆ‘ä¸ç¡®å®šå®ƒæ˜¯ä»€ä¹ˆï¼Œæ€ä¹ˆåŠï¼Ÿ</p>
<pre><code>&apos;grey or gray&apos;.match(/gr[ae]y/);
// [&quot;grey&quot;, index: 0, input: &quot;grey or gray&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><p>æ–¹æ‹¬å·åœ¨æ­£åˆ™ä¸­è¡¨ç¤ºä¸€ä¸ªåŒºé—´ï¼Œæˆ‘ä»¬ç§°å®ƒä¸ºå­—ç¬¦ç»„ã€‚</p>
<p>é¦–å…ˆï¼Œå­—ç¬¦ç»„ä¸­çš„å­—ç¬¦é›†åˆåªæ˜¯æ‰€æœ‰çš„å¯é€‰é¡¹ï¼Œæœ€ç»ˆå®ƒåªèƒ½åŒ¹é…ä¸€ä¸ªå­—ç¬¦ã€‚</p>
<p>ç„¶åï¼Œå­—ç¬¦ç»„æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ä¸–ç•Œï¼Œå…ƒå­—ç¬¦ä¸éœ€è¦è½¬ä¹‰ã€‚</p>
<pre><code>&apos;$&apos;.match(/[$&amp;@]/);
// [&quot;$&quot;, index: 0, input: &quot;$&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><p>æœ€åï¼Œæœ‰ä¸¤ä¸ªå­—ç¬¦åœ¨å­—ç¬¦ç»„ä¸­æœ‰ç‰¹æ®Šå«ä¹‰ã€‚</p>
<p><code>^</code>åœ¨å­—ç¬¦ç»„ä¸­è¡¨ç¤ºå–åï¼Œä¸å†æ˜¯æ–‡æœ¬å¼€å§‹çš„ä½ç½®äº†ã€‚</p>
<pre><code>&apos;regex&apos;.match(/[^abc]/);
// [&quot;r&quot;, index: 0, input: &quot;regex&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><p>å¦‚æœæˆ‘å°±è¦<code>^</code>å‘¢ï¼Ÿå‰é¢å·²ç»è®²è¿‡äº†ï¼Œè½¬ä¹‰ã€‚</p>
<p><code>-</code>æœ¬æ¥æ˜¯ä¸€ä¸ªæ™®é€šå­—ç¬¦ï¼Œåœ¨å­—ç¬¦ç»„ä¸­æ‘‡èº«ä¸€å˜æˆä¸ºè¿å­—ç¬¦ã€‚</p>
<pre><code>&apos;13&apos;.match(/[1-9]3/);
// [&quot;13&quot;, index: 0, input: &quot;13&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><p>è¿å­—ç¬¦çš„æ„æ€æ˜¯åŒ¹é…èŒƒå›´åœ¨å®ƒçš„å·¦è¾¹å­—ç¬¦å’Œå³è¾¹å­—ç¬¦ä¹‹é—´ã€‚</p>
<p>å¦‚æœæˆ‘è¿™æ ·å‘¢ï¼Ÿ</p>
<pre><code>&apos;abc-3&apos;.match(/[0-z]/);
// [&quot;a&quot;, index: 0, input: &quot;abc-3&quot;, groups: undefined]å¤åˆ¶ä»£ç 

&apos;xyz-3&apos;.match(/[0-c]/);
// [&quot;3&quot;, index: 4, input: &quot;xyz-3&quot;, groups: undefined]å¤åˆ¶ä»£ç 

&apos;xyz-3&apos;.match(/[0-$]/);
// Uncaught SyntaxError: Invalid regular expression: /[0-$]/: Range out of order in character classå¤åˆ¶ä»£ç 
</code></pre><p>å‘ç°ä»€ä¹ˆäº†æ²¡æœ‰ï¼Ÿåªæœ‰ä¸¤ç§å­—ç¬¦æ˜¯å¯ä»¥ç”¨è¿å­—ç¬¦çš„ï¼šè‹±æ–‡å­—æ¯å’Œæ•°å­—ã€‚è€Œä¸”è‹±æ–‡å­—æ¯å¯ä»¥å’Œæ•°å­—è¿èµ·æ¥ï¼Œè‹±æ–‡å­—æ¯çš„é¡ºåºåœ¨åé¢ã€‚è¿™å’Œæ‰‘å…‹ç‰Œ<code>1 2 3 4 5 6 7 8 9 10 J Q K</code>æ˜¯ä¸€ä¸ªé“ç†ã€‚</p>
<h2 id="æ•è·ç»„ä¸éæ•è·ç»„"><a href="#æ•è·ç»„ä¸éæ•è·ç»„" class="headerlink" title="æ•è·ç»„ä¸éæ•è·ç»„"></a>æ•è·ç»„ä¸éæ•è·ç»„</h2><p>æˆ‘ä»¬å·²ç»çŸ¥é“é‡è¯æ˜¯æ€ä¹ˆå›äº‹äº†ï¼Œæˆ‘ä»¬ä¹ŸçŸ¥é“é‡è¯åªèƒ½é‡å¤ç´§è´´åœ¨å®ƒå‰é¢çš„å­—ç¬¦ã€‚</p>
<p>å¦‚æœæˆ‘è¦é‡å¤çš„æ˜¯ä¸€ä¸²å­—ç¬¦å‘¢ï¼Ÿ</p>
<pre><code>&apos;i love you very very very much&apos;.match(/i love you very +much/);
// null&apos;i love you very very very much&apos;.match(/i love you v+e+r+y+ +much/);
// nullå¤åˆ¶ä»£ç 
</code></pre><p>è¿™æ ·è‚¯å®šæ˜¯ä¸è¡Œçš„ã€‚æ˜¯æ—¶å€™è¯·åœ†æ‹¬å·å‡ºå±±äº†ã€‚</p>
<pre><code>&apos;i love you very very very much&apos;.match(/i love you (very )+much/);
// [&quot;i love you very very very much&quot;, &quot;very &quot;, index: 0, input: &quot;i love you very very very much&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><p>åœ†æ‹¬å·çš„æ„æ€æ˜¯å°†å®ƒå…¶ä¸­çš„å­—ç¬¦é›†åˆæ‰“åŒ…æˆä¸€ä¸ªæ•´ä½“ï¼Œç„¶åé‡è¯å°±å¯ä»¥æ“ä½œè¿™ä¸ªæ•´ä½“äº†ã€‚è¿™å’Œæ–¹æ‹¬å·çš„æ•ˆæœæ˜¯å®Œå…¨ä¸ä¸€æ ·çš„ã€‚</p>
<p>è€Œä¸”é»˜è®¤çš„ï¼Œåœ†æ‹¬å·çš„åŒ¹é…ç»“æœæ˜¯å¯ä»¥æ•è·çš„ã€‚</p>
<h4 id="æ­£åˆ™å†…æ•è·"><a href="#æ­£åˆ™å†…æ•è·" class="headerlink" title="æ­£åˆ™å†…æ•è·"></a>æ­£åˆ™å†…æ•è·</h4><p>ç°åœ¨æˆ‘ä»¬æœ‰ä¸€ä¸ªéœ€æ±‚ï¼ŒåŒ¹é…<code>&lt;div&gt;</code>æ ‡ç­¾ã€‚</p>
<pre><code>&apos;&lt;div&gt;hello regex&lt;/div&gt;&apos;.match(/&lt;div&gt;.*&lt;\/div&gt;/);
// [&quot;&lt;div&gt;hello regex&lt;/div&gt;&quot;, index: 0, input: &quot;&lt;div&gt;hello regex&lt;/div&gt;&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><p>è¿™å¾ˆç®€å•ã€‚ä½†å¦‚æœæˆ‘è¦åŒ¹é…çš„æ˜¯ä»»æ„æ ‡ç­¾ï¼ŒåŒ…æ‹¬è‡ªå®šä¹‰çš„æ ‡ç­¾å‘¢ï¼Ÿ</p>
<pre><code>&apos;&lt;App&gt;hello regex&lt;/App&gt;&apos;.match(/&lt;([a-zA-Z]+)&gt;.*&lt;\/\1&gt;/);
// [&quot;&lt;App&gt;hello regex&lt;/App&gt;&quot;, &quot;App&quot;, index: 0, input: &quot;&lt;App&gt;hello regex&lt;/App&gt;&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><p>è¿™æ—¶å€™å°±è¦ç”¨åˆ°æ­£åˆ™çš„æ•è·ç‰¹æ€§ã€‚æ­£åˆ™å†…æ•è·ä½¿ç”¨<code>\æ•°å­—</code>çš„å½¢å¼ï¼Œåˆ†åˆ«å¯¹åº”å‰é¢çš„åœ†æ‹¬å·æ•è·çš„å†…å®¹ã€‚è¿™ç§æ•è·çš„å¼•ç”¨ä¹Ÿå«<strong>åå‘å¼•ç”¨</strong>ã€‚</p>
<p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªæ›´å¤æ‚çš„æƒ…å†µï¼š</p>
<pre><code>&apos;&lt;App&gt;hello regex&lt;/App&gt;&lt;p&gt;A&lt;/p&gt;&lt;p&gt;hello regex&lt;/p&gt;&apos;.match(/&lt;((A|a)pp)&gt;(hello regex)+&lt;\/\1&gt;&lt;p&gt;\2&lt;\/p&gt;&lt;p&gt;\3&lt;\/p&gt;/);
// [&quot;&lt;App&gt;hello regex&lt;/App&gt;&lt;p&gt;A&lt;/p&gt;&lt;p&gt;hello regex&lt;/p&gt;&quot;, &quot;App&quot;, &quot;A&quot;, &quot;hello regex&quot;, index: 0, input: &quot;&lt;App&gt;hello regex&lt;/App&gt;&lt;p&gt;A&lt;/p&gt;&lt;p&gt;hello regex&lt;/p&gt;&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><p>å¦‚æœæœ‰åµŒå¥—çš„åœ†æ‹¬å·ï¼Œé‚£ä¹ˆæ•è·çš„å¼•ç”¨æ˜¯å…ˆé€’å½’çš„ï¼Œç„¶åæ‰æ˜¯ä¸‹ä¸€ä¸ªé¡¶çº§æ•è·ã€‚</p>
<h4 id="æ­£åˆ™å¤–æ•è·"><a href="#æ­£åˆ™å¤–æ•è·" class="headerlink" title="æ­£åˆ™å¤–æ•è·"></a>æ­£åˆ™å¤–æ•è·</h4><pre><code>&apos;@abc&apos;.match(/@(abc)/);
// [&quot;@abc&quot;, &quot;abc&quot;, index: 0, input: &quot;@abc&quot;, groups: undefined]RegExp.$1;
// &quot;abc&quot;å¤åˆ¶ä»£ç 
</code></pre><p>æ²¡é”™ï¼Œ<code>RegExp</code>å°±æ˜¯æ„é€ æ­£åˆ™çš„æ„é€ å‡½æ•°ã€‚å¦‚æœæœ‰æ•è·ç»„ï¼Œå®ƒçš„å®ä¾‹å±æ€§<code>$æ•°å­—</code>ä¼šæ˜¾ç¤ºå¯¹åº”çš„å¼•ç”¨ã€‚</p>
<p>å¦‚æœæœ‰å¤šä¸ªæ­£åˆ™å‘¢ï¼Ÿ</p>
<pre><code>&apos;@abc&apos;.match(/@(abc)/);
// [&quot;@abc&quot;, &quot;abc&quot;, index: 0, input: &quot;@abc&quot;, groups: undefined]&apos;@xyz&apos;.match(/@(xyz)/);
// [&quot;@xyz&quot;, &quot;xyz&quot;, index: 0, input: &quot;@xyz&quot;, groups: undefined]RegExp.$1;
// &quot;xyz&quot;å¤åˆ¶ä»£ç 
</code></pre><p><code>RegExp</code>æ„é€ å‡½æ•°çš„å¼•ç”¨åªæ˜¾ç¤ºæœ€åä¸€ä¸ªæ­£åˆ™çš„æ•è·ã€‚</p>
<p>å¦å¤–è¿˜æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²å®ä¾‹æ–¹æ³•ä¹Ÿæ”¯æŒæ­£åˆ™æ•è·çš„å¼•ç”¨ï¼Œå®ƒå°±æ˜¯<code>replace</code>æ–¹æ³•ã€‚</p>
<pre><code>&apos;hello **regex**&apos;.replace(/\*{2}(.*)\*{2}/, &apos;&lt;strong&gt;$1&lt;/strong&gt;&apos;);
// &quot;hello &lt;strong&gt;regex&lt;/strong&gt;&quot;å¤åˆ¶ä»£ç 
</code></pre><p>å®é™…ä¸Šå®ƒæ‰æ˜¯æœ€å¸¸ç”¨çš„å¼•ç”¨æ•è·çš„æ–¹å¼ã€‚</p>
<h4 id="æ•è·å‘½å"><a href="#æ•è·å‘½å" class="headerlink" title="æ•è·å‘½å"></a>æ•è·å‘½å</h4><blockquote>
<p>è¿™æ˜¯ES2018çš„æ–°ç‰¹æ€§ã€‚</p>
</blockquote>
<p>ä½¿ç”¨<code>\æ•°å­—</code>å¼•ç”¨æ•è·å¿…é¡»ä¿è¯æ•è·ç»„çš„é¡ºåºä¸å˜ã€‚ç°åœ¨å¼€å‘è€…å¯ä»¥ç»™æ•è·ç»„å‘½åäº†ï¼Œæœ‰äº†åå­—ä»¥åï¼Œå¼•ç”¨èµ·æ¥æ›´åŠ ç¡®å®šã€‚</p>
<pre><code>&apos;&lt;App&gt;hello regex&lt;/App&gt;&apos;.match(/&lt;(?&lt;tag&gt;[a-zA-Z]+)&gt;.*&lt;\/\k&lt;tag&gt;&gt;/);
// [&quot;&lt;App&gt;hello regex&lt;/App&gt;&quot;, &quot;App&quot;, index: 0, input: &quot;&lt;App&gt;hello regex&lt;/App&gt;&quot;, groups: {tag: &quot;App&quot;}]å¤åˆ¶ä»£ç 
</code></pre><p>åœ¨æ•è·ç»„å†…éƒ¨æœ€å‰é¢åŠ ä¸Š<code>?&lt;key&gt;</code>ï¼Œå®ƒå°±è¢«å‘½åäº†ã€‚ä½¿ç”¨<code>\k&lt;key&gt;</code>è¯­æ³•å°±å¯ä»¥å¼•ç”¨å·²ç»å‘½åçš„æ•è·ç»„ã€‚</p>
<p>æ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Ÿ</p>
<p>é€šå¸¸æƒ…å†µä¸‹ï¼Œå¼€å‘è€…åªæ˜¯æƒ³åœ¨æ­£åˆ™ä¸­å°†æŸäº›å­—ç¬¦å½“æˆä¸€ä¸ªæ•´ä½“çœ‹å¾…ã€‚æ•è·ç»„å¾ˆæ£’ï¼Œä½†æ˜¯å®ƒåšäº†é¢å¤–çš„äº‹æƒ…ï¼Œè‚¯å®šéœ€è¦é¢å¤–çš„å†…å­˜å ç”¨å’Œè®¡ç®—èµ„æºã€‚äºæ˜¯æ­£åˆ™åˆæœ‰äº†éæ•è·ç»„çš„æ¦‚å¿µã€‚</p>
<pre><code>&apos;@abc&apos;.match(/@(abc)/);
// [&quot;@abc&quot;, &quot;abc&quot;, index: 0, input: &quot;@abc&quot;, groups: undefined]&apos;@abc&apos;.match(/@(?:abc)/);
// [&quot;@abc&quot;, index: 0, input: &quot;@abc&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><p>åªè¦åœ¨åœ†æ‹¬å·å†…æœ€å‰é¢åŠ ä¸Š<code>?:</code>æ ‡è¯†ï¼Œå°±æ˜¯å‘Šè¯‰æ­£åˆ™å¼•æ“ï¼šæˆ‘åªè¦è¿™ä¸ªæ•´ä½“ï¼Œä¸éœ€è¦å®ƒçš„å¼•ç”¨ï¼Œä½ å°±åˆ«è´¹åŠ²äº†ã€‚ä»ä¸Šé¢çš„ä¾‹å­ä¹Ÿå¯ä»¥çœ‹å‡ºæ¥ï¼Œ<code>match</code>æ–¹æ³•è¿”å›çš„ç»“æœæœ‰äº›è®¸ä¸ä¸€æ ·ã€‚</p>
<p>ä¸ªäººè§‚ç‚¹ï¼šæˆ‘è§‰å¾—æ­£åˆ™çš„æ•è·è®¾è®¡åº”è¯¥åè¿‡æ¥ï¼Œé»˜è®¤ä¸æ•è·ï¼ŒåŠ ä¸Š<code>?:</code>æ ‡è¯†åæ‰æ•è·ã€‚å› ä¸ºå¤§å¤šæ•°æ—¶å€™å¼€å‘è€…æ˜¯ä¸éœ€è¦æ•è·çš„ï¼Œä½†æ˜¯å®ƒåˆæ‡’å¾—åŠ <code>?:</code>æ ‡è¯†ï¼Œä¼šæœ‰äº›è®¸æ€§èƒ½æµªè´¹ã€‚</p>
<h2 id="åˆ†æ”¯"><a href="#åˆ†æ”¯" class="headerlink" title="åˆ†æ”¯"></a>åˆ†æ”¯</h2><p>æœ‰æ—¶å€™å¼€å‘è€…éœ€è¦åœ¨æ­£åˆ™ä¸­ä½¿ç”¨<code>æˆ–è€…</code>ã€‚</p>
<pre><code>&apos;é«˜åœ†åœ†&apos;.match(/é™ˆä¹”æ©|é«˜åœ†åœ†/);
// [&quot;é«˜åœ†åœ†&quot;, index: 0, input: &quot;é«˜åœ†åœ†&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><p><code>|</code>å°±ä»£è¡¨<code>æˆ–è€…</code>ã€‚å­—ç¬¦ç»„å…¶å®ä¹Ÿæ˜¯ä¸€ä¸ªå¤šé€‰ç»“æ„ï¼Œä½†æ˜¯å®ƒä»¬ä¿©æœ‰æœ¬è´¨åŒºåˆ«ã€‚å­—ç¬¦ç»„æœ€ç»ˆåªèƒ½åŒ¹é…ä¸€ä¸ªå­—ç¬¦ï¼Œè€Œåˆ†æ”¯åŒ¹é…çš„æ˜¯å·¦è¾¹æ‰€æœ‰çš„å­—ç¬¦æˆ–è€…å³è¾¹æ‰€æœ‰çš„å­—ç¬¦ã€‚</p>
<p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p>
<pre><code>&apos;æˆ‘å–œæ¬¢é«˜åœ†åœ†&apos;.match(/æˆ‘å–œæ¬¢é™ˆä¹”æ©|é«˜åœ†åœ†/);
// [&quot;é«˜åœ†åœ†&quot;, index: 3, input: &quot;æˆ‘å–œæ¬¢é«˜åœ†åœ†&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><p>å› ä¸º<code>|</code>æ˜¯å°†å·¦å³ä¸¤è¾¹ä¸€åˆ‡ä¸¤åŠï¼Œç„¶ååŒ¹é…å·¦è¾¹æˆ–è€…å³è¾¹ã€‚æ‰€ä»¥ä¸Šé¢çš„æ­£åˆ™æ˜¾ç„¶è¾¾ä¸åˆ°æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœã€‚è¿™ä¸ªæ—¶å€™å°±éœ€è¦ä¸€ä¸ªä¸œè¥¿æ¥ç¼©å°åˆ†æ”¯çš„èŒƒå›´ã€‚è¯¶ï¼Œä½ å¯èƒ½å·²ç»æƒ³åˆ°äº†ï¼š</p>
<pre><code>&apos;æˆ‘å–œæ¬¢é«˜åœ†åœ†&apos;.match(/æˆ‘å–œæ¬¢(?:é™ˆä¹”æ©|é«˜åœ†åœ†)/);
// [&quot;æˆ‘å–œæ¬¢é«˜åœ†åœ†&quot;, index: 0, input: &quot;æˆ‘å–œæ¬¢é«˜åœ†åœ†&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><p>æ²¡é”™ï¼Œå°±æ˜¯åœ†æ‹¬å·ã€‚</p>
<h2 id="é›¶å®½æ–­è¨€"><a href="#é›¶å®½æ–­è¨€" class="headerlink" title="é›¶å®½æ–­è¨€"></a>é›¶å®½æ–­è¨€</h2><p>æ­£åˆ™ä¸­æœ‰ä¸€äº›å…ƒå­—ç¬¦ï¼Œå®ƒä¸åŒ¹é…å­—ç¬¦ï¼Œè€Œæ˜¯åŒ¹é…ä¸€ä¸ªä½ç½®ã€‚æ¯”å¦‚ä¹‹å‰æåˆ°çš„<code>^</code>å’Œ<code>$</code>ã€‚<code>^</code>çš„æ„æ€æ˜¯è¯´è¿™ä¸ªä½ç½®åº”è¯¥æ˜¯æ–‡æœ¬å¼€å§‹çš„ä½ç½®ã€‚</p>
<p>æ­£åˆ™è¿˜æœ‰ä¸€äº›æ¯”è¾ƒé«˜çº§çš„åŒ¹é…ä½ç½®çš„è¯­æ³•ï¼Œå®ƒåŒ¹é…çš„æ˜¯ï¼šåœ¨è¿™ä¸ªä½ç½®ä¹‹å‰æˆ–ä¹‹ååº”è¯¥æœ‰ä»€ä¹ˆå†…å®¹ã€‚</p>
<p>é›¶å®½(zero-width)æ˜¯ä»€ä¹ˆæ„æ€ï¼ŸæŒ‡çš„å°±æ˜¯å®ƒåŒ¹é…ä¸€ä¸ªä½ç½®ï¼Œæœ¬èº«æ²¡æœ‰å®½åº¦ã€‚</p>
<p>æ–­è¨€(assertion)æ˜¯ä»€ä¹ˆæ„æ€ï¼ŸæŒ‡çš„æ˜¯ä¸€ç§åˆ¤æ–­ï¼Œæ–­è¨€ä¹‹å‰æˆ–ä¹‹ååº”è¯¥æœ‰ä»€ä¹ˆæˆ–åº”è¯¥æ²¡æœ‰ä»€ä¹ˆã€‚</p>
<h4 id="é›¶å®½è‚¯å®šå…ˆè¡Œæ–­è¨€"><a href="#é›¶å®½è‚¯å®šå…ˆè¡Œæ–­è¨€" class="headerlink" title="é›¶å®½è‚¯å®šå…ˆè¡Œæ–­è¨€"></a>é›¶å®½è‚¯å®šå…ˆè¡Œæ–­è¨€</h4><p>æ‰€è°“çš„è‚¯å®šå°±æ˜¯åˆ¤æ–­æœ‰ä»€ä¹ˆï¼Œè€Œä¸æ˜¯åˆ¤æ–­æ²¡æœ‰ä»€ä¹ˆã€‚</p>
<p>è€Œå…ˆè¡ŒæŒ‡çš„æ˜¯å‘å‰çœ‹(lookahead)ï¼Œæ–­è¨€çš„è¿™ä¸ªä½ç½®æ˜¯ä¸ºå‰é¢çš„è§„åˆ™æœåŠ¡çš„ã€‚</p>
<p>è¯­æ³•å¾ˆç®€å•ï¼šåœ†æ‹¬å·å†…æœ€å·¦è¾¹åŠ ä¸Š<code>?=</code>æ ‡è¯†ã€‚</p>
<pre><code>&apos;CoffeeScript JavaScript javascript&apos;.match(/\b\w{4}(?=Script\b)/);
// [&quot;Java&quot;, index: 13, input: &quot;CoffeeScript JavaScript javascript&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><p>ä¸Šé¢åŒ¹é…çš„æ˜¯å››ä¸ªå­—æ¯ï¼Œè¿™å››ä¸ªå­—æ¯è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼šç´§è·Ÿç€çš„åº”è¯¥æ˜¯<code>Script</code>å­—ç¬¦ä¸²ï¼Œè€Œä¸”<code>Script</code>å­—ç¬¦ä¸²åº”è¯¥æ˜¯å•è¯çš„ç»“å°¾éƒ¨åˆ†ã€‚</p>
<p>æ‰€ä»¥ï¼Œé›¶å®½è‚¯å®šå…ˆè¡Œæ–­è¨€çš„æ„æ€æ˜¯ï¼šç°åœ¨æœ‰ä¸€æ®µæ­£åˆ™è¯­æ³•ï¼Œç”¨è¿™æ®µè¯­æ³•å»åŒ¹é…ç»™å®šçš„æ–‡æœ¬ã€‚ä½†æ˜¯ï¼Œæ»¡è¶³æ¡ä»¶çš„æ–‡æœ¬ä¸ä»…è¦åŒ¹é…è¿™æ®µè¯­æ³•ï¼Œç´§è·Ÿç€å®ƒçš„å¿…é¡»æ˜¯ä¸€ä¸ªä½ç½®ï¼Œè¿™ä¸ªä½ç½®åˆå¿…é¡»æ»¡è¶³ä¸€æ®µæ­£åˆ™è¯­æ³•ã€‚</p>
<p>è¯´çš„å†ç›´ç™½ç‚¹ï¼Œæˆ‘è¦åŒ¹é…ä¸€æ®µæ–‡æœ¬ï¼Œä½†æ˜¯è¿™æ®µæ–‡æœ¬åé¢å¿…é¡»ç´§è·Ÿç€å¦ä¸€æ®µç‰¹å®šçš„æ–‡æœ¬ã€‚é›¶å®½è‚¯å®šå…ˆè¡Œæ–­è¨€å°±æ˜¯ä¸€ä¸ªç•Œç¢‘ï¼Œæˆ‘è¦æ»¡è¶³å‰é¢å’Œåé¢æ‰€æœ‰çš„æ¡ä»¶ï¼Œä½†æ˜¯æˆ‘åªè¦å‰é¢çš„æ–‡æœ¬ã€‚</p>
<p>æˆ‘ä»¬æ¥çœ‹å¦ä¸€ç§æƒ…å†µï¼š</p>
<pre><code>&apos;CoffeeScript JavaScript javascript&apos;.match(/\b\w{4}(?=Script\b)\w+/);
// [&quot;JavaScript&quot;, index: 13, input: &quot;CoffeeScript JavaScript javascript&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><p>ä¸Šé¢çš„ä¾‹å­æ›´åŠ ç›´è§‚ï¼Œé›¶å®½è‚¯å®šå…ˆè¡Œæ–­è¨€å·²ç»åŒ¹é…è¿‡<code>Script</code>ä¸€æ¬¡äº†ï¼Œåé¢çš„<code>\w+</code>å´è¿˜æ˜¯èƒ½åŒ¹é…<code>Script</code>æˆåŠŸï¼Œè¶³ä»¥è¯´æ˜å®ƒçš„<code>é›¶å®½</code>ç‰¹æ€§ã€‚å®ƒä¸ºç´§è´´åœ¨å®ƒå‰é¢çš„è§„åˆ™æœåŠ¡ï¼Œå¹¶ä¸”ä¸å½±å“åé¢çš„åŒ¹é…è§„åˆ™ã€‚</p>
<h4 id="é›¶å®½è‚¯å®šåè¡Œæ–­è¨€"><a href="#é›¶å®½è‚¯å®šåè¡Œæ–­è¨€" class="headerlink" title="é›¶å®½è‚¯å®šåè¡Œæ–­è¨€"></a>é›¶å®½è‚¯å®šåè¡Œæ–­è¨€</h4><p>å…ˆè¡Œæ˜¯å‘å‰çœ‹ï¼Œé‚£åè¡Œå°±æ˜¯å‘åçœ‹(lookbehind)å’¯ã€‚</p>
<p>è¯­æ³•æ˜¯åœ†æ‹¬å·å†…æœ€å·¦è¾¹åŠ ä¸Š<code>?&lt;=</code>æ ‡è¯†ã€‚</p>
<pre><code>&apos;æ¼”å‘˜é«˜åœ†åœ† å°†å†›éœå»ç—… æ¼”å‘˜éœæ€ç‡•&apos;.match(/(?&lt;=æ¼”å‘˜)éœ\S+/);
// [&quot;éœæ€ç‡•&quot;, index: 14, input: &quot;æ¼”å‘˜é«˜åœ†åœ† å°†å†›éœå»ç—… æ¼”å‘˜éœæ€ç‡•&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><p>ä¸€ä¸ªæ­£åˆ™å¯ä»¥æœ‰å¤šä¸ªæ–­è¨€ï¼š</p>
<pre><code>&apos;æ¼”å‘˜é«˜åœ†åœ† å°†å†›éœå»ç—… æ¼”å‘˜éœæ€ç‡•&apos;.match(/(?&lt;=æ¼”å‘˜)éœ.+?(?=\s|$)/);
// [&quot;éœæ€ç‡•&quot;, index: 14, input: &quot;æ¼”å‘˜é«˜åœ†åœ† å°†å†›éœå»ç—… æ¼”å‘˜éœæ€ç‡•&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><h4 id="é›¶å®½å¦å®šå…ˆè¡Œæ–­è¨€"><a href="#é›¶å®½å¦å®šå…ˆè¡Œæ–­è¨€" class="headerlink" title="é›¶å®½å¦å®šå…ˆè¡Œæ–­è¨€"></a>é›¶å®½å¦å®šå…ˆè¡Œæ–­è¨€</h4><p>è‚¯å®šæ˜¯åˆ¤æ–­æœ‰ä»€ä¹ˆï¼Œå¦å®šå°±æ˜¯åˆ¤æ–­æ²¡æœ‰ä»€ä¹ˆå’¯ã€‚</p>
<p>è¯­æ³•æ˜¯åœ†æ‹¬å·å†…æœ€å·¦è¾¹åŠ ä¸Š<code>?!</code>æ ‡è¯†ã€‚</p>
<pre><code>&apos;TypeScript Perl JavaScript&apos;.match(/\b\w{4}(?!Script\b)/);
// [&quot;Perl&quot;, index: 11, input: &quot;TypeScript Perl JavaScript&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><h4 id="é›¶å®½å¦å®šåè¡Œæ–­è¨€"><a href="#é›¶å®½å¦å®šåè¡Œæ–­è¨€" class="headerlink" title="é›¶å®½å¦å®šåè¡Œæ–­è¨€"></a>é›¶å®½å¦å®šåè¡Œæ–­è¨€</h4><p>è¯­æ³•æ˜¯åœ†æ‹¬å·æœ€å·¦è¾¹åŠ ä¸Š<code>?&lt;!</code>æ ‡è¯†ã€‚</p>
<pre><code>&apos;æ¼”å‘˜é«˜åœ†åœ† å°†å†›éœå»ç—… æ¼”å‘˜éœæ€ç‡•&apos;.match(/(?&lt;!æ¼”å‘˜)éœ\S+/);
// [&quot;éœå»ç—…&quot;, index: 8, input: &quot;æ¼”å‘˜é«˜åœ†åœ† å°†å†›éœå»ç—… æ¼”å‘˜éœæ€ç‡•&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><h2 id="ä¿®é¥°ç¬¦"><a href="#ä¿®é¥°ç¬¦" class="headerlink" title="ä¿®é¥°ç¬¦"></a>ä¿®é¥°ç¬¦</h2><p>æ­£åˆ™è¡¨è¾¾å¼é™¤äº†ä¸»ä½“è¯­æ³•ï¼Œè¿˜æœ‰è‹¥å¹²å¯é€‰çš„æ¨¡å¼ä¿®é¥°ç¬¦ã€‚</p>
<p>å†™æ³•å°±æ˜¯å°†ä¿®é¥°ç¬¦å®‰æ’åœ¨æ­£åˆ™ä¸»ä½“çš„å°¾å·´ä¸Šã€‚æ¯”å¦‚è¿™æ ·ï¼š<code>/abc/gi</code>ã€‚</p>
<h4 id="gä¿®é¥°ç¬¦"><a href="#gä¿®é¥°ç¬¦" class="headerlink" title="gä¿®é¥°ç¬¦"></a>gä¿®é¥°ç¬¦</h4><p><code>g</code>æ˜¯<code>global</code>çš„ç¼©å†™ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ­£åˆ™ä»å·¦å‘å³åŒ¹é…ï¼Œåªè¦åŒ¹é…åˆ°äº†ç»“æœå°±ä¼šæ”¶å·¥ã€‚<code>g</code>ä¿®é¥°ç¬¦ä¼šå¼€å¯å…¨å±€åŒ¹é…æ¨¡å¼ï¼Œæ‰¾åˆ°æ‰€æœ‰åŒ¹é…çš„ç»“æœã€‚</p>
<pre><code>&apos;æ¼”å‘˜é«˜åœ†åœ† å°†å†›éœå»ç—… æ¼”å‘˜éœæ€ç‡•&apos;.match(/(?&lt;=æ¼”å‘˜)\S+/);
// [&quot;é«˜åœ†åœ†&quot;, index: 2, input: &quot;æ¼”å‘˜é«˜åœ†åœ† å°†å†›éœå»ç—… æ¼”å‘˜éœæ€ç‡•&quot;, groups: undefined]&apos;æ¼”å‘˜é«˜åœ†åœ† å°†å†›éœå»ç—… æ¼”å‘˜éœæ€ç‡•&apos;.match(/(?&lt;=æ¼”å‘˜)\S+/g);
// [&quot;é«˜åœ†åœ†&quot;, &quot;éœæ€ç‡•&quot;]å¤åˆ¶ä»£ç 
</code></pre><h4 id="iä¿®é¥°ç¬¦"><a href="#iä¿®é¥°ç¬¦" class="headerlink" title="iä¿®é¥°ç¬¦"></a>iä¿®é¥°ç¬¦</h4><p><code>i</code>æ˜¯<code>ignoreCase</code>çš„ç¼©å†™ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>/z/</code>æ˜¯æ— æ³•åŒ¹é…<code>Z</code>çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ‰æ—¶å€™ä¸å¾—ä¸è¿™æ ·å†™ï¼š<code>/[a-zA-Z]/</code>ã€‚<code>i</code>ä¿®é¥°ç¬¦å¯ä»¥å…¨å±€å¿½ç•¥å¤§å°å†™ã€‚</p>
<p>å¾ˆå¤šæ—¶å€™æˆ‘ä»¬ä¸åœ¨ä¹æ–‡æœ¬æ˜¯å¤§å†™ã€å°å†™è¿˜æ˜¯å¤§å°å†™æ··å†™ï¼Œè¿™ä¸ªä¿®é¥°ç¬¦è¿˜æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚</p>
<pre><code>&apos;javascript is great&apos;.match(/JavaScript/);
// null&apos;javascript is great&apos;.match(/JavaScript/i);
// [&quot;javascript&quot;, index: 0, input: &quot;javascript is great&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><h4 id="mä¿®é¥°ç¬¦"><a href="#mä¿®é¥°ç¬¦" class="headerlink" title="mä¿®é¥°ç¬¦"></a>mä¿®é¥°ç¬¦</h4><p><code>m</code>æ˜¯<code>multiline</code>çš„ç¼©å†™ã€‚è¿™ä¸ªä¿®é¥°ç¬¦æœ‰ç‰¹å®šèµ·ä½œç”¨çš„åœºæ™¯ï¼šå®ƒè¦å’Œ<code>^</code>å’Œ<code>$</code>æ­é…èµ·æ¥ä½¿ç”¨ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>^</code>å’Œ<code>$</code>åŒ¹é…çš„æ˜¯æ–‡æœ¬çš„å¼€å§‹å’Œç»“æŸï¼ŒåŠ ä¸Š<code>m</code>ä¿®é¥°ç¬¦ï¼Œå®ƒä»¬çš„å«ä¹‰å°±å˜æˆäº†è¡Œçš„å¼€å§‹å’Œç»“æŸã€‚</p>
<pre><code>`
abc
xyz
`.match(/xyz/);
// [&quot;xyz&quot;, index: 5, input: &quot;â†µabcâ†µxyzâ†µ&quot;, groups: undefined]`
abc
xyz
`.match(/^xyz$/);
// null`
abc
xyz
`.match(/^xyz$/m);
// [&quot;xyz&quot;, index: 5, input: &quot;â†µabcâ†µxyzâ†µ&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><h4 id="yä¿®é¥°ç¬¦"><a href="#yä¿®é¥°ç¬¦" class="headerlink" title="yä¿®é¥°ç¬¦"></a>yä¿®é¥°ç¬¦</h4><blockquote>
<p>è¿™æ˜¯ES2015çš„æ–°ç‰¹æ€§ã€‚</p>
</blockquote>
<p><code>y</code>æ˜¯<code>sticky</code>çš„ç¼©å†™ã€‚<code>y</code>ä¿®é¥°ç¬¦æœ‰å’Œ<code>g</code>ä¿®é¥°ç¬¦é‡åˆçš„åŠŸèƒ½ï¼Œå®ƒä»¬éƒ½æ˜¯å…¨å±€åŒ¹é…ã€‚æ‰€ä»¥é‡ç‚¹åœ¨<code>sticky</code>ä¸Šï¼Œæ€ä¹ˆç†è§£è¿™ä¸ª<code>ç²˜è¿</code>å‘¢ï¼Ÿ</p>
<p><code>g</code>ä¿®é¥°ç¬¦ä¸æŒ‘é£Ÿï¼ŒåŒ¹é…å®Œä¸€ä¸ªæ¥ç€åŒ¹é…ä¸‹ä¸€ä¸ªï¼Œå¯¹äºæ–‡æœ¬çš„ä½ç½®æ²¡æœ‰è¦æ±‚ã€‚ä½†æ˜¯<code>y</code>ä¿®é¥°ç¬¦è¦æ±‚å¿…é¡»ä»æ–‡æœ¬çš„å¼€å§‹å®æ–½åŒ¹é…ï¼Œå› ä¸ºå®ƒä¼šå¼€å¯å…¨å±€åŒ¹é…ï¼ŒåŒ¹é…åˆ°çš„æ–‡æœ¬çš„ä¸‹ä¸€ä¸ªå­—ç¬¦å°±æ˜¯ä¸‹ä¸€æ¬¡æ–‡æœ¬çš„å¼€å§‹ã€‚è¿™å°±æ˜¯æ‰€è°“çš„ç²˜è¿ã€‚</p>
<pre><code>&apos;a bag with a tag has a mag&apos;.match(/\wag/g);
// [&quot;bag&quot;, &quot;tag&quot;, &quot;mag&quot;]&apos;a bag with a tag has a mag&apos;.match(/\wag/y);
// null&apos;bagtagmag&apos;.match(/\wag/y);
// [&quot;bag&quot;, index: 0, input: &quot;bagtagmag&quot;, groups: undefined]&apos;bagtagmag&apos;.match(/\wag/gy);
// [&quot;bag&quot;, &quot;tag&quot;, &quot;mag&quot;]å¤åˆ¶ä»£ç 
</code></pre><p>æœ‰äººè‚¯å®šå‘ç°äº†çŒ«è…»ï¼šä½ ä¸æ˜¯è¯´<code>y</code>ä¿®é¥°ç¬¦æ˜¯å…¨å±€åŒ¹é…ä¹ˆï¼Ÿçœ‹ä¸Šé¢çš„ä¾‹å­ï¼Œå•ç‹¬ä¸€ä¸ª<code>y</code>ä¿®é¥°ç¬¦ç”¨matchæ–¹æ³•æ€ä¹ˆå¹¶ä¸æ˜¯å…¨å±€åŒ¹é…å‘¢ï¼Ÿ</p>
<p>è¯¶ï¼Œè¿™é‡Œè¯´æ¥å°±è¯é•¿äº†ã€‚</p>
<p>é•¿è¯çŸ­è¯´å‘¢ï¼Œå°±æ¶‰åŠåˆ°<code>y</code>ä¿®é¥°ç¬¦çš„æœ¬è´¨æ˜¯ä»€ä¹ˆã€‚å®ƒçš„æœ¬è´¨æœ‰äºŒï¼š</p>
<ul>
<li>å…¨å±€åŒ¹é…(å…ˆåˆ«ç€æ€¥æ‰“æˆ‘)ã€‚</li>
<li>ä»æ–‡æœ¬çš„<code>lastIndex</code>ä½ç½®å¼€å§‹æ–°çš„åŒ¹é…ã€‚lastIndexæ˜¯ä»€ä¹ˆï¼Ÿå®ƒæ˜¯æ­£åˆ™è¡¨è¾¾å¼çš„ä¸€ä¸ªå±æ€§ï¼Œå¦‚æœæ˜¯å…¨å±€åŒ¹é…ï¼Œå®ƒç”¨æ¥æ ‡æ³¨ä¸‹ä¸€æ¬¡åŒ¹é…çš„èµ·å§‹ç‚¹ã€‚è¿™æ‰æ˜¯ç²˜è¿çš„æœ¬è´¨æ‰€åœ¨ã€‚</li>
</ul>
<p>ä¸çŸ¥é“ä½ ä»¬å‘ç°ä»€ä¹ˆäº†æ²¡æœ‰ï¼š<strong>lastIndexæ˜¯æ­£åˆ™è¡¨è¾¾å¼çš„ä¸€ä¸ªå±æ€§</strong>ã€‚è€Œä¸Šé¢ä¾‹å­ä¸­çš„matchæ–¹æ³•æ˜¯ä½œç”¨åœ¨å­—ç¬¦ä¸²ä¸Šçš„ï¼Œéƒ½æ²¡æœ‰lastIndexå±æ€§ï¼Œä¼‘æ€ªäººå®¶å·¥ä½œä¸ä¸Šå¿ƒã€‚</p>
<pre><code>const reg = /\wag/y;
reg.exec(&apos;bagtagmag&apos;);
// [&quot;bag&quot;, index: 0, input: &quot;bagtagmag&quot;, groups: undefined]
reg.exec(&apos;bagtagmag&apos;);
// [&quot;tag&quot;, index: 3, input: &quot;bagtagmag&quot;, groups: undefined]
reg.exec(&apos;bagtagmag&apos;);
// [&quot;mag&quot;, index: 6, input: &quot;bagtagmag&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><p>å’±ä»¬æ¢æˆæ­£åˆ™æ–¹æ³•execï¼Œå¤šæ¬¡æ‰§è¡Œï¼Œæ­£åˆ™çš„lastIndexåœ¨å˜ï¼ŒåŒ¹é…çš„ç»“æœä¹Ÿåœ¨å˜ã€‚å…¨å±€åŒ¹é…æ— ç–‘äº†å§ã€‚</p>
<h4 id="sä¿®é¥°ç¬¦"><a href="#sä¿®é¥°ç¬¦" class="headerlink" title="sä¿®é¥°ç¬¦"></a>sä¿®é¥°ç¬¦</h4><blockquote>
<p>è¿™æ˜¯ES2018çš„æ–°ç‰¹æ€§ã€‚</p>
</blockquote>
<p><code>s</code>ä¸æ˜¯<code>dotAll</code>çš„ç¼©å†™ã€‚<code>s</code>ä¿®é¥°ç¬¦è¦å’Œ<code>.</code>æ­é…ä½¿ç”¨ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>.</code>åŒ¹é…é™¤äº†æ¢è¡Œç¬¦ä¹‹å¤–çš„ä»»æ„å•ä¸ªå­—ç¬¦ï¼Œç„¶è€Œå®ƒè¿˜æ²¡æœ‰å¼ºå¤§åˆ°æ— æ‰€ä¸èƒ½çš„åœ°æ­¥ï¼Œæ‰€ä»¥æ­£åˆ™ç´¢æ€§ç»™å®ƒå¼€ä¸ªæŒ‚ã€‚</p>
<p><code>s</code>ä¿®é¥°ç¬¦çš„ä½œç”¨å°±æ˜¯è®©<code>.</code>å¯ä»¥åŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦ã€‚</p>
<p><code>s</code>æ˜¯<code>singleline</code>çš„ç¼©å†™ã€‚</p>
<pre><code>`
abc
xyz
`.match(/c.x/);
// null`
abc
xyz
`.match(/c.x/s);
// [&quot;câ†µx&quot;, index: 3, input: &quot;â†µabcâ†µxyzâ†µ&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><h4 id="uä¿®é¥°ç¬¦"><a href="#uä¿®é¥°ç¬¦" class="headerlink" title="uä¿®é¥°ç¬¦"></a>uä¿®é¥°ç¬¦</h4><blockquote>
<p>è¿™æ˜¯ES2015çš„æ–°ç‰¹æ€§ã€‚</p>
</blockquote>
<p><code>u</code>æ˜¯<code>unicode</code>çš„ç¼©å†™ã€‚æœ‰ä¸€äº›Unicodeå­—ç¬¦è¶…è¿‡ä¸€ä¸ªå­—èŠ‚ï¼Œæ­£åˆ™å°±æ— æ³•æ­£ç¡®çš„è¯†åˆ«å®ƒä»¬ã€‚<code>u</code>ä¿®é¥°ç¬¦å°±æ˜¯ç”¨æ¥å¤„ç†è¿™äº›ä¸å¸¸è§çš„æƒ…å†µçš„ã€‚</p>
<pre><code>&apos;ğ ®·&apos;.match(/^.$/);
// null&apos;ğ ®·&apos;.match(/^.$/u);
// [&quot;ğ ®·&quot;, index: 0, input: &quot;ğ ®·&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><p><code>ğ ®·</code>å¿µ<code>jÃ­</code>ï¼Œä¸<code>å‰</code>åŒä¹‰ã€‚</p>
<p>ç¬”è€…å¯¹Unicodeè®¤è¯†å°šæµ…ï¼Œè¿™é‡Œä¸è¿‡å¤šå±•å¼€ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/01/æ¨¡æ‹Ÿå®ç°callå’Œapply/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/01/æ¨¡æ‹Ÿå®ç°callå’Œapply/" itemprop="url">æ¨¡æ‹Ÿå®ç°callå’Œapply</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-10-01T20:39:27+08:00">
                2018-10-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h4><p>JS å‡½æ•° call å’Œ apply ç”¨æ¥æ‰‹åŠ¨æ”¹å˜ this çš„æŒ‡å‘ï¼Œcall å’Œ apply  å”¯ä¸€çš„åŒºåˆ«å°±åœ¨äºå‡½æ•°å‚æ•°çš„ä¼ é€’æ–¹å¼ä¸åŒï¼Œcall æ˜¯ä»¥é€—å·çš„å½¢å¼ï¼Œapply æ˜¯ä»¥æ•°ç»„çš„å½¢å¼ï¼š</p>
<pre><code>let person1 = {
    name: &quot;person1&quot;,
    say: function(age, sex) {
        console.log(this.name + &apos; age: &apos; + age + &apos; sex: &apos; + sex);
    }
}

let person2 = {
    name: &quot;person&quot;
}

person1.say.call(person2, 20, &quot;ç”·&quot;);

person1.say.apply(person2, [20, &quot;ç”·&quot;]);
</code></pre><p>æœ¬æ–‡å°±å°è¯•ç”¨å…¶ä»–æ–¹å¼æ¥æ¨¡æ‹Ÿå®ç° call å’Œ applyã€‚</p>
<p>é¦–å…ˆè§‚å¯Ÿ call å’Œ apply æœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ</p>
<ol>
<li>è¢«å‡½æ•°è°ƒç”¨ï¼ˆå‡½æ•°ä¹Ÿæ˜¯å¯¹è±¡ï¼‰ï¼Œç›¸å½“äº call å’Œ apply æ˜¯å‡½æ•°çš„å±æ€§</li>
<li>å¦‚æœæ²¡æœ‰ä¼ å…¥éœ€è¦ this æŒ‡å‘å¯¹è±¡ï¼Œé‚£ä¹ˆ this æŒ‡å‘å…¨å±€å¯¹è±¡</li>
<li>å‡½æ•°æ‰§è¡Œäº†</li>
<li>æœ€åéƒ½æ”¹å˜äº† this çš„æŒ‡å‘</li>
</ol>
<h4 id="ä¸€ã€åˆæ­¥å®ç°"><a href="#ä¸€ã€åˆæ­¥å®ç°" class="headerlink" title="ä¸€ã€åˆæ­¥å®ç°"></a>ä¸€ã€åˆæ­¥å®ç°</h4><p>åŸºäº call å‡½æ•°æ˜¯è°ƒç”¨å‡½æ•°çš„å±æ€§çš„ç‰¹ç‚¹ï¼Œcall çš„ this æŒ‡å‘è°ƒç”¨å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•æŠŠè°ƒç”¨å‡½æ•°çš„ä½œä¸ºä¼ å…¥çš„æ–°å¯¹è±¡çš„ä¸€ä¸ªå±æ€§ï¼Œæ‰§è¡Œåï¼Œå†åˆ é™¤è¿™ä¸ªå±æ€§å°±å¥½äº†ã€‚</p>
<pre><code>Function.prototype.newCall = function (context) {
    context.fn = this;  // this æŒ‡çš„æ˜¯ say å‡½æ•°
    context.fn();
    delete context.fn;
}

var person = {
    name: &quot;jayChou&quot;
};

var say = function() {
    console.log(this.name);
}

say.newCall(person);  // jayChou
</code></pre><p>æ˜¯ä¸æ˜¯å°±åˆæ­¥æ¨¡æ‹Ÿå®ç°äº† call å‡½æ•°å‘¢ï¼Œç”±äº call è¿˜æ¶‰åŠåˆ°ä¼ å‚çš„é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿›å…¥åˆ°ä¸‹ä¸€ç¯èŠ‚ã€‚</p>
<h4 id="äºŒã€eval-æ–¹å¼"><a href="#äºŒã€eval-æ–¹å¼" class="headerlink" title="äºŒã€eval æ–¹å¼"></a>äºŒã€eval æ–¹å¼</h4><p>åœ¨ç»™å¯¹è±¡ä¸´æ—¶ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶æ‰§è¡Œæ—¶ï¼Œä¼ å…¥çš„å‚æ•°æ˜¯é™¤äº† context å…¶ä½™çš„å‚æ•°ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æˆªå– arguments å‚æ•°æ•°ç»„çš„ç¬¬ä¸€ä¸ªåï¼Œå°†å‰©ä½™çš„å‚æ•°ä¼ å…¥ä¸´æ—¶æ•°ç»„ã€‚</p>
<p>åœ¨å‰é¢æˆ‘æœ‰è®²è¿‡å‡½æ•° arguments ç±»æ•°ç»„å¯¹è±¡çš„ç‰¹ç‚¹ï¼Œarguments æ˜¯ä¸æ”¯æŒæ•°ç»„çš„å¤§å¤šæ•°æ–¹æ³•, ä½†æ˜¯æ”¯æŒfor å¾ªç¯æ¥éå†æ•°ç»„ã€‚</p>
<pre><code>Function.prototype.newCall = function (context) {
    context.fn = this;

    let args = [];

    for(let i=1; i&lt; arguments.length; i++) {
        args.push(&apos;arguments[&apos; + i + &apos;]&apos;);
    }
    // args =&gt; [arguments[1], arguments[2], arguments[3], ...]

    context.fn(args.join(&apos;,&apos;));  // ï¼Ÿï¼Ÿï¼Ÿdelete context.fn;
}

var person = {
    name: &quot;jayChou&quot;
};

var say = function(age, sex) {
    console.log(`name: ${this.name},age: ${age}, sex: ${sex}`);
}

say.newCall(person);
</code></pre><p>ä¸Šé¢ä¼ é€’å‚æ•°çš„æ–¹å¼æœ€åè‚¯å®šæ˜¯å¤±è´¥çš„ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯• eval çš„æ–¹å¼ï¼Œå°†å‚æ•°æ·»åŠ å­å‡½æ•°çš„ä½œç”¨åŸŸä¸­ã€‚</p>
<blockquote>
<p>eval() å‡½æ•°å¯è®¡ç®—æŸä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶æ‰§è¡Œå…¶ä¸­çš„çš„ JavaScript ä»£ç </p>
</blockquote>
<pre><code>Function.prototype.newCall = function (context) {
    context.fn = this;

    let args = [];

    for(var i=1; i&lt; arguments.length; i++) {
        args.push(&apos;arguments[&apos; + i + &apos;]&apos;);
    }

    // args =&gt; [arguments[1], arguments[2], arguments[3], ...]eval(&apos;context.fn(&apos; + args + &apos;)&apos;);
    delete context.fn;
}

var person = {
    name: &quot;jayChou&quot;
};

functionsay(age, sex) {
    console.log(`name: ${this.name},age: ${age}, sex: ${sex}`);
}

say.newCall(person, 18, &apos;ç”·&apos;);  // name: jayChou,age: 18, sex: ç”·
</code></pre><p>æˆåŠŸå•¦ï¼</p>
<p>å®ç°äº†å‡½æ•°å‚æ•°çš„ä¼ é€’ï¼Œé‚£ä¹ˆå‡½æ•°è¿”å›å€¼æ€ä¹ˆå¤„ç†å‘¢ã€‚è€Œä¸”ï¼Œå¦‚æœä¼ å…¥çš„å¯¹è±¡æ˜¯ nullï¼Œåˆè¯¥å¦‚ä½•å¤„ç†ï¼Ÿæ‰€ä»¥è¿˜éœ€è¦å†åšä¸€äº›å·¥ä½œï¼š</p>
<pre><code>Function.prototype.newCall = function (context) {
    if (typeof context === &apos;object&apos;) {
        context = context || window
    } else {
        context = Object.create(null);
    }

    context.fn = this;

    let args = [];

    for(var i=1; i&lt; arguments.length; i++) {
        args.push(&apos;arguments[&apos; + i + &apos;]&apos;);
    }

    // args =&gt; [arguments[1], arguments[2], arguments[3], ...]var result = eval(&apos;context.fn(&apos; + args + &apos;)&apos;);  // å¤„ç†è¿”å›å€¼delete context.fn;
    return result;  // è¿”å›è¿”å›å€¼
}

var person = {
    name: &quot;jayChou&quot;
};

functionsay(age, sex) {
    console.log(`name: ${this.name},age: ${age}, sex: ${sex}`);
    return age + sex;
}

var check = say.newCall(person, 18, &apos;ç”·&apos;);
console.log(check); // 18ç”·
</code></pre><p>åˆ¤æ–­ä¼ å…¥å¯¹è±¡çš„ç±»å‹ï¼Œå¦‚æœä¸º null å°±æŒ‡å‘ window å¯¹è±¡ã€‚åˆ©ç”¨ eval æ¥æ‰§è¡Œå­—ç¬¦ä¸²ä»£ç ï¼Œå¹¶è¿”å›å­—ç¬¦ä¸²ä»£ç æ‰§è¡Œçš„ç»“æœï¼Œå°±å®Œæˆäº†æ¨¡æ‹Ÿ callã€‚<br>å¤§åŠŸå‘Šæˆï¼</p>
<h4 id="ä¸‰ã€ES-6-å®ç°"><a href="#ä¸‰ã€ES-6-å®ç°" class="headerlink" title="ä¸‰ã€ES 6 å®ç°"></a>ä¸‰ã€ES 6 å®ç°</h4><p>å‰é¢æˆ‘ä»¬ç”¨çš„ eval æ–¹å¼å¯ä»¥ç”¨ ES6 çš„è§£å†³è¿˜å­˜åœ¨çš„ä¸€äº›é—®é¢˜ï¼Œæœ‰æ²¡æœ‰æ³¨æ„åˆ°ï¼Œè¿™æ®µä»£ç æ˜¯æœ‰é—®é¢˜çš„ã€‚</p>
<pre><code>context.fn = this;
</code></pre><p>å‡å¦‚å¯¹è±¡åœ¨è¢« call è°ƒç”¨å‰ï¼Œå·²ç»æœ‰ fn å±æ€§æ€ä¹ˆåŠï¼Ÿ</p>
<p>ES6 ä¸­æä¾›äº†ä¸€ç§æ–°çš„åŸºæœ¬æ•°æ®ç±»å‹ï¼ŒSymbolï¼Œè¡¨ç¤ºç‹¬ä¸€æ— äºŒçš„å€¼ï¼Œå¦å¤–ï¼ŒSymbol ä½œä¸ºå±æ€§çš„æ—¶å€™ï¼Œä¸èƒ½ä½¿ç”¨ç‚¹è¿ç®—ç¬¦ã€‚æ‰€ä»¥å†åŠ ä¸Š ES çš„ rest å‰©ä½™å‚æ•°æ›¿ä»£ arguments éå†çš„å·¥ä½œå°±æœ‰ï¼š</p>
<pre><code>Function.prototype.newCall = function (context,...params) {
    if (typeof context === &apos;object&apos;) {
        context = context || window
    } else {
        context = Object.create(null);
    }
    let fn = Symbol();
    context[fn] = thisvar result = context[fn](...params);

    delete context.fn;
    return result;
}

var person = {
    name: &quot;jayChou&quot;
};

functionsay(age, sex) {
    console.log(`name: ${this.name},age: ${age}, sex: ${sex}`);
    return age + sex;
}

var check = say.newCall(person, 18, &apos;ç”·&apos;);
console.log(check); // 18ç”·
</code></pre><h4 id="å››ã€apply"><a href="#å››ã€apply" class="headerlink" title="å››ã€apply"></a>å››ã€apply</h4><p>apply å’Œ call çš„å®ç°åŸç†ï¼ŒåŸºæœ¬ç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äº apply çš„å‚æ•°æ˜¯ä»¥æ•°ç»„çš„å½¢å¼ä¼ å…¥ã€‚</p>
<pre><code>Function.prototype.newApply = function (context, arr) {
    if (typeof context === &apos;object&apos;) {
        context = context || window
    } else {
        context = Object.create(null);
    }
    context.fn = this;

    var result;
    if (!arr) {  // åˆ¤æ–­å‡½æ•°å‚æ•°æ˜¯å¦ä¸ºç©º
        result = context.fn();
    }
    else {
        var args = [];
        for (var i = 0; i &lt; arr.length; i++) {
            args.push(&apos;arr[&apos; + i + &apos;]&apos;);
        }
        result = eval(&apos;context.fn(&apos; + args + &apos;)&apos;);
    }

    delete context.fn;
    return result;
}
</code></pre><p><strong>es6 å®ç°</strong></p>
<pre><code>Function.prototype.newApply = function(context, parameter) {
  if (typeof context === &apos;object&apos;) {
    context = context || window
  } else {
    context = Object.create(null)
  }
  let fn = Symbol()
  context[fn] = this;
  var result = context[fn](...parameter);
  delete context[fn];
  return result;
}
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/30/pm2-å¸¸ç”¨é…ç½®åŠå‘½ä»¤/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/30/pm2-å¸¸ç”¨é…ç½®åŠå‘½ä»¤/" itemprop="url">pm2 å¸¸ç”¨é…ç½®åŠå‘½ä»¤</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-09-30T12:11:05+08:00">
                2018-09-30
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>å¦‚æœç›´æ¥é€šè¿‡node appæ¥å¯åŠ¨ï¼Œå¦‚æœæŠ¥é”™äº†å¯èƒ½ç›´æ¥åœåœ¨æ•´ä¸ªè¿è¡Œï¼Œsupervisoræ„Ÿè§‰åªæ˜¯æ‹¿æ¥ç”¨ä½œå¼€å‘ç¯å¢ƒçš„ã€‚å†ç½‘ä¸Šæ‰¾åˆ°pm2.ç›®å‰ä¼¼ä¹æœ€å¸¸è§çš„çº¿ä¸Šéƒ¨ç½²nodejsé¡¹ç›®çš„æœ‰forever,pm2è¿™ä¸¤ç§ã€‚<br>ä½¿ç”¨åœºåˆ:</p>
</blockquote>
<ul>
<li>supervisoræ˜¯å¼€å‘ç¯å¢ƒç”¨ã€‚</li>
<li>foreverç®¡ç†å¤šä¸ªç«™ç‚¹ï¼Œæ¯ä¸ªç«™ç‚¹è®¿é—®é‡ä¸å¤§ï¼Œä¸éœ€è¦ç›‘æ§ã€‚</li>
<li>nodemon æ˜¯å¼€å‘ç¯å¢ƒä½¿ç”¨ï¼Œä¿®æ”¹è‡ªåŠ¨é‡å¯ã€‚</li>
<li>pm2 ç½‘ç«™è®¿é—®é‡æ¯”è¾ƒå¤§,éœ€è¦å®Œæ•´çš„ç›‘æ§ç•Œé¢ã€‚</li>
</ul>
<p><code>PM2</code> æ˜¯ <code>node</code> è¿›ç¨‹ç®¡ç†å·¥å…·ï¼Œå¯ä»¥åˆ©ç”¨å®ƒæ¥ç®€åŒ–å¾ˆå¤š <code>node</code> åº”ç”¨ç®¡ç†çš„ç¹çä»»åŠ¡ï¼Œå¦‚æ€§èƒ½ç›‘æ§ã€è‡ªåŠ¨é‡å¯ã€è´Ÿè½½å‡è¡¡ç­‰ï¼Œè€Œä¸”ä½¿ç”¨éå¸¸ç®€å•ã€‚æœ¬æ–‡å°± <code>PM2</code> è¿›è¡Œå…¥é—¨æ€§çš„ä»‹ç»ï¼ŒåŸºæœ¬æ¶µç›–äº† <code>PM2</code> çš„å¸¸ç”¨çš„åŠŸèƒ½å’Œé…ç½®ã€‚</p>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g pm2</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä½ çš„nodeé¡¹ç›®é…ç½®æ–‡ä»¶å’Œä»¥ä¸Šä»£ç ä¸ä¸€æ ·ï¼Œï¼Œï¼Œè«æ€¥ï¼Œpm2 ä¹Ÿæ˜¯æœ‰åŠæ³•å¯ä»¥å¯åŠ¨çš„ï¼ˆä¸ªäººè§‰å¾—è¿™æ˜¯ä¸€ä¸ªä¸‡èƒ½çš„å¯åŠ¨çš„æ–¹æ³•ï¼‰ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pm2 start npm -- run XXX</span><br><span class="line">pm2 start npm --watch --name XXX -- run start</span><br></pre></td></tr></table></figure></p>
<p>ç”¨å¥¹æ›¿ä»£ï¼š<code>npm run dev</code>ï¼Œå°±å¯ä»¥å†™æˆï¼š<code>pm2 start npm -- run dev</code>ï¼Œé¡¹ç›®å¯åŠ¨ï¼š    </p>
<h2 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">pm2 start [server.js]</span><br><span class="line"># å¯åŠ¨æœåŠ¡</span><br><span class="line">pm2 list</span><br><span class="line"># æŸ¥çœ‹å½“å‰æ‰€è·‘æœåŠ¡çš„è¯¦æƒ…</span><br><span class="line">pm2 show [name]</span><br><span class="line"># æŸ¥çœ‹æ›´åŠ è¯¦ç»†çš„ä¿¡æ¯è¿™ä¸ªå‘½ä»¤å¯æŸ¥çœ‹pm2é…ç½® åŒ…æ‹¬æ—¥å¿—æ–‡ä»¶å­˜æ”¾çš„ä½ç½®ç­‰</span><br><span class="line">pm2 stop [id/name]</span><br><span class="line"># å…³é—­æŸä¸ªæœåŠ¡</span><br><span class="line">pm2 delete [id/name]</span><br><span class="line"># åˆ é™¤æŸä¸ªæœåŠ¡</span><br><span class="line">pm2 stop all</span><br><span class="line"># å…³é—­æ‰€æœ‰æœåŠ¡</span><br><span class="line">pm2 logs</span><br><span class="line"># æŸ¥çœ‹å®æ—¶æ—¥å¿—</span><br><span class="line">pm2 restart [name]</span><br><span class="line"># é‡æ–°å¯åŠ¨æœåŠ¡</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ pm2 logs æ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹æ—¥å¿—</span><br><span class="line">$ pm2 stop all åœæ­¢æ‰€æœ‰è¿›ç¨‹</span><br><span class="line">$ pm2 restart all é‡å¯æ‰€æœ‰è¿›ç¨‹</span><br><span class="line">$ pm2 reload all 0ç§’åœæœºé‡è½½è¿›ç¨‹ (ç”¨äº NETWORKED è¿›ç¨‹)</span><br><span class="line">$ pm2 stop 0 åœæ­¢æŒ‡å®šçš„è¿›ç¨‹</span><br><span class="line">$ pm2 restart 0 é‡å¯æŒ‡å®šçš„è¿›ç¨‹</span><br><span class="line">$ pm2 startup äº§ç”Ÿ init è„šæœ¬ ä¿æŒè¿›ç¨‹æ´»ç€</span><br><span class="line">$ pm2 web è¿è¡Œå¥å£®çš„ computer API endpoint (http://localhost:9615)</span><br><span class="line">$ pm2 delete 0 æ€æ­»æŒ‡å®šçš„è¿›ç¨‹</span><br><span class="line">$ pm2 delete all æ€æ­»å…¨éƒ¨è¿›ç¨‹</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">è¿è¡Œè¿›ç¨‹çš„ä¸åŒæ–¹å¼ï¼š</span><br><span class="line">$ pm2 start app.js -i max æ ¹æ®æœ‰æ•ˆCPUæ•°ç›®å¯åŠ¨æœ€å¤§è¿›ç¨‹æ•°ç›®</span><br><span class="line">$ pm2 start app.js -i 3 å¯åŠ¨3ä¸ªè¿›ç¨‹</span><br><span class="line">$ pm2 start app.js -x ç”¨forkæ¨¡å¼å¯åŠ¨ app.js è€Œä¸æ˜¯ä½¿ç”¨ cluster</span><br><span class="line">$ pm2 start app.js -x -- -a 23 ç”¨forkæ¨¡å¼å¯åŠ¨ app.js å¹¶ä¸”ä¼ é€’å‚æ•° (-a 23)</span><br><span class="line">$ pm2 start app.js --name serverone å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹å¹¶æŠŠå®ƒå‘½åä¸º serverone</span><br><span class="line">$ pm2 stop serverone åœæ­¢ serverone è¿›ç¨‹</span><br><span class="line">$ pm2 start app.json å¯åŠ¨è¿›ç¨‹, åœ¨ app.jsoné‡Œè®¾ç½®é€‰é¡¹</span><br><span class="line">$ pm2 start app.js -i max -- -a 23 åœ¨--ä¹‹åç»™ app.js ä¼ é€’å‚æ•°</span><br><span class="line">$ pm2 start app.js -i max -e err.log -o out.log å¯åŠ¨ å¹¶ ç”Ÿæˆä¸€ä¸ªé…ç½®æ–‡ä»¶</span><br></pre></td></tr></table></figure>
<h2 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h2><p>å‚æ•°è¯´æ˜ï¼š</p>
<ul>
<li><code>--watch</code>ï¼šç›‘å¬åº”ç”¨ç›®å½•çš„å˜åŒ–ï¼Œä¸€æ—¦å‘ç”Ÿå˜åŒ–ï¼Œè‡ªåŠ¨é‡å¯ã€‚å¦‚æœè¦ç²¾ç¡®ç›‘å¬ã€ä¸è§å¬çš„ç›®å½•ï¼Œæœ€å¥½é€šè¿‡é…ç½®æ–‡ä»¶ã€‚</li>
<li><code>-i --instances</code>ï¼šå¯ç”¨å¤šå°‘ä¸ªå®ä¾‹ï¼Œå¯ç”¨äºè´Ÿè½½å‡è¡¡ã€‚å¦‚æœ <code>-i 0</code> æˆ–è€… <code>-i max</code>ï¼Œåˆ™æ ¹æ®å½“å‰æœºå™¨æ ¸æ•°ç¡®å®šå®ä¾‹æ•°ç›®ã€‚</li>
<li><code>--ignore-watch</code>ï¼šæ’é™¤ç›‘å¬çš„ç›®å½•/æ–‡ä»¶ï¼Œå¯ä»¥æ˜¯ç‰¹å®šçš„æ–‡ä»¶åï¼Œä¹Ÿå¯ä»¥æ˜¯æ­£åˆ™ã€‚æ¯”å¦‚ <code>--ignore-watch=&quot;test node_modules &quot;some scripts&quot;&quot;</code></li>
<li><code>-n --name</code>ï¼šåº”ç”¨çš„åç§°ã€‚æŸ¥çœ‹åº”ç”¨ä¿¡æ¯çš„æ—¶å€™å¯ä»¥ç”¨åˆ°ã€‚</li>
<li><code>-o --output &lt;path&gt;</code>ï¼šæ ‡å‡†è¾“å‡ºæ—¥å¿—æ–‡ä»¶çš„è·¯å¾„ã€‚</li>
<li><code>-e --error &lt;path&gt;</code>ï¼šé”™è¯¯è¾“å‡ºæ—¥å¿—æ–‡ä»¶çš„è·¯å¾„ã€‚</li>
</ul>
<h2 id="ç›‘å¬"><a href="#ç›‘å¬" class="headerlink" title="ç›‘å¬"></a>ç›‘å¬</h2><pre><code>pm2 start ./bin/www --watch
#æ³¨æ„ï¼Œè¿™é‡Œç”¨äº†--watchå‚æ•°ï¼Œæ„å‘³ç€å½“ä½ çš„åº”ç”¨ä»£ç å‘ç”Ÿå˜åŒ–æ—¶ï¼Œpm2ä¼šå¸®ä½ è‡ªåŠ¨é‡å¯æœåŠ¡
</code></pre><h2 id="é…ç½®åŠéƒ¨ç½²"><a href="#é…ç½®åŠéƒ¨ç½²" class="headerlink" title="é…ç½®åŠéƒ¨ç½²"></a>é…ç½®åŠéƒ¨ç½²</h2><p>éƒ¨ç½²çš„é…ç½®æ–‡ä»¶ç¤ºä¾‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  // æ•°ç»„ä¸­æ”¾çš„æ˜¯éœ€è¦å‘å¸ƒçš„é¡¹ç›®ä¸€äº›å˜é‡çš„å®šä¹‰</span><br><span class="line">  &quot;apps&quot;: [&#123;</span><br><span class="line">    &quot;name&quot;: &quot;xxx&quot;, //é¡¹ç›®åç§°</span><br><span class="line">    &quot;script&quot;: &quot;server.js&quot;, //ç”¨æ¥å¯åŠ¨çš„è„šæœ¬</span><br><span class="line">    // &quot;instances&quot;:2,</span><br><span class="line">    // å¯åŠ¨é¡¹ç›®æ‰€éœ€è¦çš„ç¯å¢ƒå˜é‡</span><br><span class="line">    &quot;env&quot;: &#123;</span><br><span class="line">      &quot;COMMON_VARIABLE&quot;: &quot;true&quot;, //è®¾ç½®ä¸ºtrue å¯ä»¥åœ¨å¯åŠ¨çš„æ—¶ä¼ å…¥å¤–éƒ¨çš„å˜é‡è¿›å»</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;env_production&quot;: &#123;</span><br><span class="line">      &quot;NODE_ENV&quot;: &quot;production&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;],</span><br><span class="line">  // éƒ¨ç½²</span><br><span class="line">  &quot;deploy&quot;: &#123;</span><br><span class="line">    &quot;production&quot;: &#123;</span><br><span class="line">      &quot;user&quot;: &quot;root&quot;,</span><br><span class="line">      &quot;host&quot;: &quot;0.0.0.0&quot;, //å¯ä»¥æ˜¯æ•°ç»„ éƒ¨ç½²åˆ°å¤šå°ä¸»æœº</span><br><span class="line">      &quot;ref&quot;: &quot;origin/master&quot;, //é€‰æ‹©æ‹¿å“ªä¸ªä¸ªåˆ†æ”¯çš„ä»£ç </span><br><span class="line">      &quot;repo&quot;: &quot;git@github.com:ihoey/hitalk.git&quot;, //ä»“åº“åœ°å€</span><br><span class="line">      &quot;path&quot;: &quot;/root/www/hitalk/production&quot;, //è¦å‘å¸ƒåˆ°æœåŠ¡å™¨ä¸Šå“ªä¸ªç›®å½•ä¸‹é¢</span><br><span class="line">      &quot;ssh_options&quot;: &quot;StrictHostKeyChecking=no&quot;, //é¿å…keyéªŒè¯å¯¼è‡´ä»£ç æ›´æ–°åˆ°è¿œç¨‹ä»“åº“å¤±è´¥</span><br><span class="line">      &quot;post-deploy&quot;: &quot;source ~/.nvm/nvm.sh &amp;&amp; pm2 startOrRestart ecosystem.json --env production&quot;, //å‘å¸ƒä¹‹åæ‰§è¡Œçš„åŠ¨ä½œ æ‰§è¡Œå¼€å¯æˆ–æ›´æ–°pm2è¿è¡Œçš„æœåŠ¡</span><br><span class="line">      &quot;pre-deploy-local&quot;: &quot;echo &apos;Deploy Done!&apos;&quot;, //æœ¬åœ°å‘å¸ƒä¹‹å‰çš„åŠ¨ä½œ</span><br><span class="line">      &quot;env&quot;: &#123; //æŒ‡å®šéƒ¨ç½²åˆ°è¿œç¨‹çš„ä»“åº“çš„ç¯å¢ƒ æ˜¯productionç”Ÿäº§ç¯å¢ƒ</span><br><span class="line">        &quot;NODE_ENV&quot;: &quot;production&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>è¯´æ˜:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">apps:jsonç»“æ„ï¼Œappsæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ¯ä¸€ä¸ªæ•°ç»„æˆå‘˜å°±æ˜¯å¯¹åº”ä¸€ä¸ªpm2ä¸­è¿è¡Œçš„åº”ç”¨</span><br><span class="line">name:åº”ç”¨ç¨‹åºåç§°</span><br><span class="line">cwd:åº”ç”¨ç¨‹åºæ‰€åœ¨çš„ç›®å½•</span><br><span class="line">script:åº”ç”¨ç¨‹åºçš„è„šæœ¬è·¯å¾„</span><br><span class="line">log_date_format:</span><br><span class="line">error_file:è‡ªå®šä¹‰åº”ç”¨ç¨‹åºçš„é”™è¯¯æ—¥å¿—æ–‡ä»¶</span><br><span class="line">out_file:è‡ªå®šä¹‰åº”ç”¨ç¨‹åºæ—¥å¿—æ–‡ä»¶</span><br><span class="line">pid_file:è‡ªå®šä¹‰åº”ç”¨ç¨‹åºçš„pidæ–‡ä»¶</span><br><span class="line">instances:</span><br><span class="line">min_uptime:æœ€å°è¿è¡Œæ—¶é—´ï¼Œè¿™é‡Œè®¾ç½®çš„æ˜¯60så³å¦‚æœåº”ç”¨ç¨‹åºåœ¨60så†…é€€å‡ºï¼Œpm2ä¼šè®¤ä¸ºç¨‹åºå¼‚å¸¸é€€å‡ºï¼Œæ­¤æ—¶è§¦å‘é‡å¯max_restartsè®¾ç½®æ•°é‡</span><br><span class="line">max_restarts:è®¾ç½®åº”ç”¨ç¨‹åºå¼‚å¸¸é€€å‡ºé‡å¯çš„æ¬¡æ•°ï¼Œé»˜è®¤15æ¬¡ï¼ˆä»0å¼€å§‹è®¡æ•°ï¼‰</span><br><span class="line">cron_restart:å®šæ—¶å¯åŠ¨ï¼Œè§£å†³é‡å¯èƒ½è§£å†³çš„é—®é¢˜</span><br><span class="line">watch:æ˜¯å¦å¯ç”¨ç›‘æ§æ¨¡å¼ï¼Œé»˜è®¤æ˜¯falseã€‚å¦‚æœè®¾ç½®æˆtrueï¼Œå½“åº”ç”¨ç¨‹åºå˜åŠ¨æ—¶ï¼Œpm2ä¼šè‡ªåŠ¨é‡è½½ã€‚è¿™é‡Œä¹Ÿå¯ä»¥è®¾ç½®ä½ è¦ç›‘æ§çš„æ–‡ä»¶ã€‚</span><br><span class="line">merge_logs:</span><br><span class="line">exec_interpreter:åº”ç”¨ç¨‹åºçš„è„šæœ¬ç±»å‹ï¼Œè¿™é‡Œä½¿ç”¨çš„shellï¼Œé»˜è®¤æ˜¯nodejs</span><br><span class="line">exec_mode:åº”ç”¨ç¨‹åºå¯åŠ¨æ¨¡å¼ï¼Œè¿™é‡Œè®¾ç½®çš„æ˜¯cluster_modeï¼ˆé›†ç¾¤ï¼‰ï¼Œé»˜è®¤æ˜¯fork</span><br><span class="line">autorestart:å¯ç”¨/ç¦ç”¨åº”ç”¨ç¨‹åºå´©æºƒæˆ–é€€å‡ºæ—¶è‡ªåŠ¨é‡å¯</span><br><span class="line">vizion:å¯ç”¨/ç¦ç”¨vizionç‰¹æ€§(ç‰ˆæœ¬æ§åˆ¶)</span><br></pre></td></tr></table></figure>
<h3 id="åˆå§‹åŒ–é…ç½®"><a href="#åˆå§‹åŒ–é…ç½®" class="headerlink" title="åˆå§‹åŒ–é…ç½®"></a>åˆå§‹åŒ–é…ç½®</h3><p>ç¬¬ä¸€æ¬¡éƒ¨ç½²</p>
<pre><code>pm2 deploy ecosystem.json production setup
</code></pre><h3 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h3><pre><code>pm2 deploy ecosystem.json production
</code></pre><p>å¥½äº†ï¼Œå…ˆè®°å½•è¿™ä¹ˆå¤š~</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/21/ES6äº‹ä»¶æ€»çº¿-EventBus/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/21/ES6äº‹ä»¶æ€»çº¿-EventBus/" itemprop="url">ES6äº‹ä»¶æ€»çº¿ EventBus</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-09-21T14:13:12+08:00">
                2018-09-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">class EventBus &#123;</span><br><span class="line"></span><br><span class="line">    constructor() &#123;</span><br><span class="line">        this.events = &#123;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    on(type, callback, scope, ...args) &#123;</span><br><span class="line">        if (typeof this.events[type] == &quot;undefined&quot;) &#123;</span><br><span class="line">            this.events[type] = [];</span><br><span class="line">        &#125;</span><br><span class="line">        this.events[type].push(&#123;scope: scope, callback: callback, args: args&#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    off(type, callback, scope) &#123;</span><br><span class="line">        if (typeof this.events[type] == &quot;undefined&quot;) &#123;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        let numOfCallbacks = this.events[type].length;</span><br><span class="line">        let newArray = [];</span><br><span class="line">        for (let i = 0; i &lt; numOfCallbacks; i++) &#123;</span><br><span class="line">            let event = this.events[type][i];</span><br><span class="line">            if (event.scope == scope &amp;&amp; event.callback == callback) &#123;</span><br><span class="line"></span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                newArray.push(event);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        this.events[type] = newArray;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    has(type, callback, scope) &#123;</span><br><span class="line">        if (typeof this.events[type] == &quot;undefined&quot;) &#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        let numOfCallbacks = this.events[type].length;</span><br><span class="line">        if (callback === undefined &amp;&amp; scope === undefined) &#123;</span><br><span class="line">            return numOfCallbacks &gt; 0;</span><br><span class="line">        &#125;</span><br><span class="line">        for (let i = 0; i &lt; numOfCallbacks; i++) &#123;</span><br><span class="line">            let event = this.events[type][i];</span><br><span class="line">            if ((scope ? event.scope == scope : true) &amp;&amp; event.callback == callback) &#123;</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    emit(type, target, ...args) &#123;</span><br><span class="line">        if (typeof this.events[type] == &quot;undefined&quot;) &#123;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        let bag = &#123;</span><br><span class="line">            type: type,</span><br><span class="line">            target: target</span><br><span class="line">        &#125;;</span><br><span class="line">        args = [bag].concat(args);</span><br><span class="line">        let events = this.events[type].slice();</span><br><span class="line">        let numOfCallbacks = events.length;</span><br><span class="line">        for (let i = 0; i &lt; numOfCallbacks; i++) &#123;</span><br><span class="line">            let event = events[i];</span><br><span class="line">            if (event &amp;&amp; event.callback) &#123;</span><br><span class="line">                let concatArgs = args.concat(event.args);</span><br><span class="line">                event.callback.apply(event.scope, concatArgs);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    debug() &#123;</span><br><span class="line">        let str = &quot;&quot;;</span><br><span class="line">        for (let type in this.events) &#123;</span><br><span class="line">            let numOfCallbacks = this.events[type].length;</span><br><span class="line">            for (let i = 0; i &lt; numOfCallbacks; i++) &#123;</span><br><span class="line">                let event = this.events[type][i];</span><br><span class="line">                let className = &quot;Anonymous&quot;;</span><br><span class="line">                if (event.scope) &#123;</span><br><span class="line">                    if (event.scope.constructor.name) &#123;</span><br><span class="line">                        className = event.scope.constructor.name;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                str += `$&#123;className&#125; listening for &quot;$&#123;type&#125;&quot;\n`;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return str;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default new EventBus();</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;EventBus Examples&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;script type=&quot;module&quot;&gt;</span><br><span class="line">    import EventBus from &apos;/src/eventbus.js&apos;;</span><br><span class="line">    // Simple example</span><br><span class="line">    &#123;</span><br><span class="line">        function myHandler(event) &#123;</span><br><span class="line">            console.log(&quot;myHandler / type: &quot; + event.type);</span><br><span class="line">        &#125;</span><br><span class="line">        EventBus.on(&quot;my_event&quot;, myHandler);</span><br><span class="line">        EventBus.emit(&quot;my_event&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    // Keeping the scope</span><br><span class="line">    &#123;</span><br><span class="line">        class TestClass1 &#123;</span><br><span class="line">            constructor() &#123;</span><br><span class="line">                this.className = &quot;TestClass1&quot;;</span><br><span class="line">                EventBus.on(&quot;callback_event&quot;, this.callback, this);</span><br><span class="line">            &#125;</span><br><span class="line">            callback(event) &#123;</span><br><span class="line">                console.log(this.className + &quot; / type: &quot; + event.type + &quot; / dispatcher: &quot; + event.target.className);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        class TestClass2 &#123;</span><br><span class="line">            constructor() &#123;</span><br><span class="line">                this.className = &quot;TestClass2&quot;;</span><br><span class="line">            &#125;</span><br><span class="line">            dispatch() &#123;</span><br><span class="line">                EventBus.emit(&quot;callback_event&quot;, this);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        let t1 = new TestClass1();</span><br><span class="line">        let t2 = new TestClass2();</span><br><span class="line">        t2.dispatch();</span><br><span class="line">    &#125;</span><br><span class="line">    // Passing additional parameters</span><br><span class="line">    &#123;</span><br><span class="line">        class TestClass1 &#123;</span><br><span class="line">            constructor() &#123;</span><br><span class="line">                this.className = &quot;TestClass1&quot;;</span><br><span class="line">                EventBus.on(&quot;custom_event&quot;, this.doSomething, this);</span><br><span class="line">            &#125;</span><br><span class="line">            doSomething(event, param1, param2) &#123;</span><br><span class="line">                console.log(this.className + &quot;.doSomething&quot;);</span><br><span class="line">                console.log(&quot;type=&quot; + event.type);</span><br><span class="line">                console.log(&quot;params=&quot; + param1 + param2);</span><br><span class="line">                console.log(&quot;coming from=&quot; + event.target.className);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        class TestClass2 &#123;</span><br><span class="line">            constructor() &#123;</span><br><span class="line">                this.className = &quot;TestClass2&quot;;</span><br><span class="line">            &#125;</span><br><span class="line">            ready() &#123;</span><br><span class="line">                EventBus.emit(&quot;custom_event&quot;, this, &quot;javascript events&quot;, &quot; are really useful&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        let t1 = new TestClass1();</span><br><span class="line">        let t2 = new TestClass2();</span><br><span class="line">        t2.ready();</span><br><span class="line">    &#125;</span><br><span class="line">    // Debugging</span><br><span class="line">    console.log(EventBus.debug());</span><br><span class="line">    // Removing a registered handler</span><br><span class="line">    &#123;</span><br><span class="line">        var handler = function() &#123;</span><br><span class="line">            console.log(&apos;example callback&apos;);</span><br><span class="line">        &#125;;</span><br><span class="line">        EventBus.on(&apos;EXAMPLE_EVENT&apos;, handler);</span><br><span class="line">        EventBus.emit(&apos;EXAMPLE_EVENT&apos;);</span><br><span class="line">        EventBus.off(&apos;EXAMPLE_EVENT&apos;, handler);</span><br><span class="line">        // Not emitted because event was removed</span><br><span class="line">        EventBus.emit(&apos;EXAMPLE_EVENT&apos;);</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/16/å‰ç«¯ä»£ç å¼‚å¸¸ç›‘æ§å®æˆ˜/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/16/å‰ç«¯ä»£ç å¼‚å¸¸ç›‘æ§å®æˆ˜/" itemprop="url">å‰ç«¯ä»£ç å¼‚å¸¸ç›‘æ§å®æˆ˜</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-09-16T11:22:33+08:00">
                2018-09-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="æŠŠå‰ç«¯ç›‘æ§åšåˆ°æè‡´-æ˜é‡‘"><a href="#æŠŠå‰ç«¯ç›‘æ§åšåˆ°æè‡´-æ˜é‡‘" class="headerlink" title="æŠŠå‰ç«¯ç›‘æ§åšåˆ°æè‡´ - æ˜é‡‘"></a><a href="https://link.zhihu.com/?target=https%3A//juejin.im/post/5a52f138f265da3e5b32a41b" target="_blank" rel="noopener">æŠŠå‰ç«¯ç›‘æ§åšåˆ°æè‡´ - æ˜é‡‘</a></h2><h2 id="çº¿ä¸Šå‹ç¼©ä»£ç -å®šä½é”™è¯¯-æ˜é‡‘"><a href="#çº¿ä¸Šå‹ç¼©ä»£ç -å®šä½é”™è¯¯-æ˜é‡‘" class="headerlink" title="çº¿ä¸Šå‹ç¼©ä»£ç -å®šä½é”™è¯¯ - æ˜é‡‘"></a><a href="https://link.zhihu.com/?target=https%3A//juejin.im/post/5a4f6886518825734216b352" target="_blank" rel="noopener">çº¿ä¸Šå‹ç¼©ä»£ç -å®šä½é”™è¯¯ - æ˜é‡‘</a></h2><p>ç”Ÿäº§ç¯å¢ƒæ²¡æœ‰source-mapæ–‡ä»¶ï¼Œä¸ŠæŠ¥çš„é”™è¯¯éƒ½ä¸å¥½å®šä½ï¼Œè¿™é‡Œå®ç°ä¸€ä¸ªç®€å•çš„é”™è¯¯å®šä½è„šæœ¬</p>
<p>1ã€è·å–å‹ç¼©ä»£ç é”™è¯¯ä¿¡æ¯ï¼ˆè¡Œæ•°ã€åˆ—æ•°ã€é”™è¯¯ä¿¡æ¯ï¼Œé”™è¯¯æ–‡ä»¶ï¼‰</p>
<h2 id="è¿™é‡Œé€šè¿‡æ§åˆ¶å°çœ‹é”™è¯¯ä¿¡æ¯"><a href="#è¿™é‡Œé€šè¿‡æ§åˆ¶å°çœ‹é”™è¯¯ä¿¡æ¯" class="headerlink" title="è¿™é‡Œé€šè¿‡æ§åˆ¶å°çœ‹é”™è¯¯ä¿¡æ¯"></a>è¿™é‡Œé€šè¿‡æ§åˆ¶å°çœ‹é”™è¯¯ä¿¡æ¯</h2><pre><code>window.addEventListener(&apos;error&apos;, function (e) {
    console.debug(&apos;lineno: &apos;, e.lineno, &apos; colno: &apos;, e.colno)
    console.debug(&apos;errorMessage:&apos;, e.message)
    console.debug(&apos;errorFile:&apos;, e.filename)
}, true)
</code></pre><p>æˆ‘ä»¬å†™ä¸€æ®µé”™è¯¯çš„ä»£ç ï¼ˆsingle.vueçš„ç‰‡æ®µï¼‰</p>
<pre><code>method: {
   test (option) {
        const data = option.test
        const dataTest = option.data.test
        return data + dataTest
    }
}, 
created () {
    // è®¾ç½®å¼‚æ­¥é”™è¯¯çš„åŸå› æ˜¯ï¼ŒåŒæ­¥çš„é”™è¯¯ä¼šè¢«vueæ•è·
    setTimeout(() =&gt; {
        this.test({
          testOption: 1
        })
    }, 300)
}
</code></pre><p>åœ¨æµè§ˆå™¨ä¸­è¿è¡Œï¼ŒæŠ¥é”™ç»“æœå¦‚ä¸‹<br><img src="https://pic4.zhimg.com/v2-c3b8a3d91b6ee6040dbf18e06ec3431a_b.jpg" alt=""><img src="https://pic4.zhimg.com/80/v2-c3b8a3d91b6ee6040dbf18e06ec3431a_hd.jpg" alt=""></p>
<p>å¾—åˆ°é”™è¯¯ä¿¡æ¯ï¼š</p>
<ul>
<li>é”™è¯¯è¡Œæ•°ï¼š1</li>
<li>é”™è¯¯åˆ—æ•°ï¼š59236</li>
<li>é”™è¯¯ä¿¡æ¯ï¼šcannot read property â€˜testâ€™ of undefined</li>
<li>é”™è¯¯æ–‡ä»¶ï¼š0.0a77f.js</li>
</ul>
<p>2ã€å®šä½é”™è¯¯çš„nodeè„šæœ¬<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">## å®‰è£…ä¾èµ–source-map</span><br><span class="line"></span><br><span class="line"> npm install source-map</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    nodeè„šæœ¬å¦‚ä¸‹ï¼ˆmap/index.jsï¼‰</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"> // è¯»å–æ–‡ä»¶</span><br><span class="line">var fs = require(&apos;fs&apos;)</span><br><span class="line">// souceMapå¤„ç†æ–‡ä»¶</span><br><span class="line">var SourceMapConsumer = require(&apos;source-map&apos;).SourceMapConsumer</span><br><span class="line">// å¯åŠ¨æ„å»ºè¿›ç¨‹ï¼ˆå·²æ„å»ºåˆ™ä¸éœ€è¦ï¼‰</span><br><span class="line">var exec = require(&apos;child_process&apos;).exec</span><br><span class="line"></span><br><span class="line">var lineno = process.argv[2] || 0   // ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè¡Œæ•°</span><br><span class="line">var columnno = process.argv[3] || 0 // ç¬¬äºŒä¸ªå‚æ•°ä¸ºåˆ—æ•°</span><br><span class="line">var fileName = process.argv[4] || &apos;&apos; // ç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºé”™è¯¯æ–‡ä»¶ï¼ˆé”™è¯¯æ–‡ä»¶åå°±å¥½ï¼‰</span><br><span class="line"></span><br><span class="line">// æ„å»ºæœ‰mapçš„çº¿ä¸Šä»£ç </span><br><span class="line">// node build onlineMapä¸ºæ„å»ºå‘½ä»¤</span><br><span class="line">exec(&apos;node build onlineMap&apos;, function () &#123;</span><br><span class="line"> // è¯»å–é”™è¯¯æ–‡ä»¶çš„mapæ–‡ä»¶</span><br><span class="line"> var consumer = new SourceMapConsumer(fs.readFileSync(&apos;./dist/&apos; + fileName + &apos;.map&apos;, &apos;utf8&apos;))</span><br><span class="line">  // è¾“å‡ºmapçš„é”™è¯¯ä¿¡æ¯</span><br><span class="line">  console.log(consumer.originalPositionFor(&#123;</span><br><span class="line">    line: +lineno,      // +æ˜¯ä¸ºäº†è½¬åŒ–ä¸ºæ•°å­—</span><br><span class="line">    column: +columnno</span><br><span class="line">  &#125;))</span><br><span class="line">&#125;)</span><br><span class="line">`</span><br><span class="line"></span><br><span class="line">    è¿è¡Œnodeè„šæœ¬</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"> node map 1 59236 0.0a77f.js</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>æ•ˆæœå¦‚ä¸‹ï¼š</p>
</blockquote>
<p><img src="https://pic1.zhimg.com/v2-cf68e7b673405c90fe024bf48dfb42c7_b.jpg" alt=""><img src="https://pic1.zhimg.com/80/v2-cf68e7b673405c90fe024bf48dfb42c7_hd.jpg" alt=""></p>
<p>ç»“åˆæ§åˆ¶å°è¾“å‡ºçš„ä¿¡æ¯ï¼Œå°±å¯ä»¥å®šä½åˆ°é”™è¯¯ä»£ç äº†</p>
<p>æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹ï¼Œç»™ä»£ç å¼€å¯source-mapï¼Œçœ‹é”™è¯¯ä¿¡æ¯æ˜¯å¦ä¸€è‡´</p>
<p><img src="https://pic3.zhimg.com/v2-5319b431cef161a0a07ba46f8b0e6a02_b.jpg" alt=""><img src="https://pic3.zhimg.com/80/v2-5319b431cef161a0a07ba46f8b0e6a02_hd.jpg" alt=""><br>é”™è¯¯ä»£ç çš„ä½ç½®å®šä½æ˜¯å‡†ç¡®çš„ï¼Œè¯æ˜å¯è¡Œã€‚</p>
<p>3ã€åç»­æ‰©å±•æ€è·¯</p>
<h2 id="ç›®å‰å®ç°çš„æ˜¯æ¯”è¾ƒç®€å•çš„è„šæœ¬ï¼Œæ‰€ä»¥å­˜åœ¨ä¸€äº›é—®é¢˜ï¼š"><a href="#ç›®å‰å®ç°çš„æ˜¯æ¯”è¾ƒç®€å•çš„è„šæœ¬ï¼Œæ‰€ä»¥å­˜åœ¨ä¸€äº›é—®é¢˜ï¼š" class="headerlink" title="ç›®å‰å®ç°çš„æ˜¯æ¯”è¾ƒç®€å•çš„è„šæœ¬ï¼Œæ‰€ä»¥å­˜åœ¨ä¸€äº›é—®é¢˜ï¼š"></a>ç›®å‰å®ç°çš„æ˜¯æ¯”è¾ƒç®€å•çš„è„šæœ¬ï¼Œæ‰€ä»¥å­˜åœ¨ä¸€äº›é—®é¢˜ï¼š</h2><ul>
<li>éœ€è¦å½“å‰æ„å»ºå†…å®¹å’Œçº¿ä¸Šæ˜¯ä¸€è‡´çš„</li>
<li>æ“ä½œæ¯”è¾ƒç¹ç</li>
</ul>
<p>ä¼˜åŒ–æ€è·¯å¦‚ä¸‹ï¼š</p>
<p><img src="https://pic4.zhimg.com/v2-a8b63ecc364c66c8bf4bbec9880f8c23_b.jpg" alt=""><img src="https://pic4.zhimg.com/80/v2-a8b63ecc364c66c8bf4bbec9880f8c23_hd.jpg" alt=""></p>
<p>åç»­ä¼˜åŒ–æ…¢æ…¢è¡¥å……~</p>
<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¹‹å‰åœ¨å¯¹å…¬å¸çš„å‰ç«¯ä»£ç è„šæœ¬é”™è¯¯è¿›è¡Œæ’æŸ¥ï¼Œè¯•å›¾é™ä½ JS Error çš„é”™è¯¯é‡ï¼Œç»“åˆè‡ªå·±ä¹‹å‰çš„ç»éªŒå¯¹è¿™æ–¹é¢å†…å®¹è¿›è¡Œäº†å®è·µå¹¶æ€»ç»“ï¼Œä¸‹é¢å°±æ­¤è°ˆè°ˆæˆ‘å¯¹å‰ç«¯ä»£ç å¼‚å¸¸ç›‘æ§çš„ä¸€äº›è§è§£ã€‚</p>
<p>æœ¬æ–‡å¤§è‡´å›´ç»•ä¸‹é¢å‡ ç‚¹å±•å¼€è®¨è®ºï¼š</p>
<ol>
<li>JS å¤„ç†å¼‚å¸¸çš„æ–¹å¼</li>
<li>ä¸ŠæŠ¥æ–¹å¼</li>
<li>å¼‚å¸¸ç›‘æ§ä¸ŠæŠ¥å¸¸è§é—®é¢˜</li>
</ol>
<h2 id="JS-å¼‚å¸¸å¤„ç†"><a href="#JS-å¼‚å¸¸å¤„ç†" class="headerlink" title="JS å¼‚å¸¸å¤„ç†"></a>JS å¼‚å¸¸å¤„ç†</h2><p>å¯¹äº Javascript è€Œè¨€ï¼Œæˆ‘ä»¬é¢å¯¹çš„ä»…ä»…åªæ˜¯å¼‚å¸¸ï¼Œå¼‚å¸¸çš„å‡ºç°ä¸ä¼šç›´æ¥å¯¼è‡´ JS å¼•æ“å´©æºƒï¼Œæœ€å¤šåªä¼šä½¿å½“å‰æ‰§è¡Œçš„ä»»åŠ¡ç»ˆæ­¢ã€‚</p>
<ol>
<li>å½“å‰ä»£ç å—å°†ä½œä¸ºä¸€ä¸ªä»»åŠ¡å‹å…¥ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼ŒJS çº¿ç¨‹ä¼šä¸æ–­åœ°ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­æå–ä»»åŠ¡æ‰§è¡Œã€‚</li>
<li>å½“ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸ï¼Œä¸”å¼‚å¸¸æ²¡æœ‰æ•è·å¤„ç†ï¼Œåˆ™ä¼šä¸€ç›´æ²¿ç€è°ƒç”¨æ ˆä¸€å±‚å±‚å‘å¤–æŠ›å‡ºï¼Œæœ€ç»ˆç»ˆæ­¢å½“å‰ä»»åŠ¡çš„æ‰§è¡Œã€‚</li>
<li><p>JS çº¿ç¨‹ä¼šç»§ç»­ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­æå–ä¸‹ä¸€ä¸ªä»»åŠ¡ç»§ç»­æ‰§è¡Œã€‚</p>
 <script>
   error
   console.log('æ°¸è¿œä¸ä¼šæ‰§è¡Œ');
 </script>
 <script>
   console.log('æˆ‘ç»§ç»­æ‰§è¡Œ')
 </script>


</li>
</ol>
<p><img src="https://pic2.zhimg.com/v2-7a136ce7674914bcd7b7f42986d0c5bc_b.jpg" alt=""><img src="https://pic2.zhimg.com/80/v2-7a136ce7674914bcd7b7f42986d0c5bc_hd.jpg" alt=""></p>
<p>åœ¨å¯¹è„šæœ¬é”™è¯¯è¿›è¡Œä¸ŠæŠ¥ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å¼‚å¸¸è¿›è¡Œå¤„ç†ï¼Œç¨‹åºéœ€è¦å…ˆæ„ŸçŸ¥åˆ°è„šæœ¬é”™è¯¯çš„å‘ç”Ÿï¼Œç„¶åå†è°ˆå¼‚å¸¸ä¸ŠæŠ¥ã€‚</p>
<p>è„šæœ¬é”™è¯¯ä¸€èˆ¬åˆ†ä¸ºä¸¤ç§ï¼šè¯­æ³•é”™è¯¯ï¼Œè¿è¡Œæ—¶é”™è¯¯ã€‚</p>
<p>ä¸‹é¢å°±è°ˆè°ˆå‡ ç§å¼‚å¸¸ç›‘æ§çš„å¤„ç†æ–¹å¼ï¼š</p>
<h2 id="try-catch-å¼‚å¸¸å¤„ç†"><a href="#try-catch-å¼‚å¸¸å¤„ç†" class="headerlink" title="try-catch å¼‚å¸¸å¤„ç†"></a>try-catch å¼‚å¸¸å¤„ç†</h2><p>try-catch åœ¨æˆ‘ä»¬çš„ä»£ç ä¸­ç»å¸¸è§åˆ°ï¼Œé€šè¿‡ç»™ä»£ç å—è¿›è¡Œ try-catch è¿›è¡ŒåŒ…è£…åï¼Œå½“ä»£ç å—å‘ç”Ÿå‡ºé”™æ—¶ catch å°†èƒ½æ•æ‰åˆ°é”™è¯¯çš„ä¿¡æ¯ï¼Œé¡µé¢ä¹Ÿå°†å¯ä»¥ç»§ç»­æ‰§è¡Œã€‚</p>
<p>ä½†æ˜¯ try-catch å¤„ç†å¼‚å¸¸çš„èƒ½åŠ›æœ‰é™ï¼Œåªèƒ½æ•è·æ‰åˆ°è¿è¡Œæ—¶éå¼‚æ­¥é”™è¯¯ï¼Œå¯¹äºè¯­æ³•é”™è¯¯å’Œå¼‚æ­¥é”™è¯¯å°±æ˜¾å¾—æ— èƒ½ä¸ºåŠ›ï¼Œæ•æ‰ä¸åˆ°ã€‚</p>
<h2 id="ç¤ºä¾‹ï¼šè¿è¡Œæ—¶é”™è¯¯"><a href="#ç¤ºä¾‹ï¼šè¿è¡Œæ—¶é”™è¯¯" class="headerlink" title="ç¤ºä¾‹ï¼šè¿è¡Œæ—¶é”™è¯¯"></a>ç¤ºä¾‹ï¼šè¿è¡Œæ—¶é”™è¯¯</h2><pre><code>try {
  error    // æœªå®šä¹‰å˜é‡ 
} catch(e) {
  console.log(&apos;æˆ‘çŸ¥é“é”™è¯¯äº†&apos;);
  console.log(e);
}
</code></pre><p><img src="https://pic3.zhimg.com/v2-dc8ba7e4b9e56127799c11b46cf7068d_b.jpg" alt=""><img src="https://pic3.zhimg.com/80/v2-dc8ba7e4b9e56127799c11b46cf7068d_hd.jpg" alt=""></p>
<p>ç„¶è€Œå¯¹äºè¯­æ³•é”™è¯¯å’Œå¼‚æ­¥é”™è¯¯å°±æ•æ‰ä¸åˆ°äº†ã€‚</p>
<h2 id="ç¤ºä¾‹ï¼šè¯­æ³•é”™è¯¯"><a href="#ç¤ºä¾‹ï¼šè¯­æ³•é”™è¯¯" class="headerlink" title="ç¤ºä¾‹ï¼šè¯­æ³•é”™è¯¯"></a>ç¤ºä¾‹ï¼šè¯­æ³•é”™è¯¯</h2><pre><code>try {
  var error = &apos;error&apos;ï¼›   // å¤§å†™åˆ†å·
} catch(e) {
  console.log(&apos;æˆ‘æ„ŸçŸ¥ä¸åˆ°é”™è¯¯&apos;);
  console.log(e);
}
</code></pre><p><img src="https://pic3.zhimg.com/v2-8ddf6acf0f42c4b08ba8b73798b863a0_b.jpg" alt=""><img src="https://pic3.zhimg.com/80/v2-8ddf6acf0f42c4b08ba8b73798b863a0_hd.jpg" alt=""></p>
<p>ä¸€èˆ¬è¯­æ³•é”™è¯¯åœ¨ç¼–è¾‘å™¨å°±ä¼šä½“ç°å‡ºæ¥ï¼Œå¸¸è¡¨ç°çš„é”™è¯¯ä¿¡æ¯ä¸ºï¼š Uncaught SyntaxError: Invalid or unexpected token xxx è¿™æ ·ã€‚ä½†æ˜¯è¿™ç§é”™è¯¯ä¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œå¸¸ä½¿ç¨‹åºå´©æºƒï¼Œä¸€èˆ¬åœ¨ç¼–ç æ—¶å€™å®¹æ˜“è§‚å¯Ÿå¾—åˆ°ã€‚</p>
<h2 id="ç¤ºä¾‹ï¼šå¼‚æ­¥é”™è¯¯"><a href="#ç¤ºä¾‹ï¼šå¼‚æ­¥é”™è¯¯" class="headerlink" title="ç¤ºä¾‹ï¼šå¼‚æ­¥é”™è¯¯"></a>ç¤ºä¾‹ï¼šå¼‚æ­¥é”™è¯¯</h2><pre><code>try {
  setTimeout(() =&gt; {
    error        // å¼‚æ­¥é”™è¯¯
  })
} catch(e) {
  console.log(&apos;æˆ‘æ„ŸçŸ¥ä¸åˆ°é”™è¯¯&apos;);
  console.log(e);
}
</code></pre><p><img src="https://pic4.zhimg.com/v2-0ed67a00e3c7762e74975bebbbc88274_b.jpg" alt=""><img src="https://pic4.zhimg.com/80/v2-0ed67a00e3c7762e74975bebbbc88274_hd.jpg" alt=""></p>
<p>é™¤éä½ åœ¨ setTimeout å‡½æ•°ä¸­å†å¥—ä¸Šä¸€å±‚ try-catchï¼Œå¦åˆ™å°±æ— æ³•æ„ŸçŸ¥åˆ°å…¶é”™è¯¯ï¼Œä½†è¿™æ ·ä»£ç å†™èµ·æ¥æ¯”è¾ƒå•°å—¦ã€‚</p>
<h2 id="window-onerror-å¼‚å¸¸å¤„ç†"><a href="#window-onerror-å¼‚å¸¸å¤„ç†" class="headerlink" title="window.onerror å¼‚å¸¸å¤„ç†"></a>window.onerror å¼‚å¸¸å¤„ç†</h2><p>window.onerror æ•è·å¼‚å¸¸èƒ½åŠ›æ¯” try-catch ç¨å¾®å¼ºç‚¹ï¼Œæ— è®ºæ˜¯å¼‚æ­¥è¿˜æ˜¯éå¼‚æ­¥é”™è¯¯ï¼Œonerror éƒ½èƒ½æ•è·åˆ°è¿è¡Œæ—¶é”™è¯¯ã€‚</p>
<p>ç¤ºä¾‹ï¼šè¿è¡Œæ—¶åŒæ­¥é”™è¯¯</p>
<pre><code>/**
 * @param {String}  msg    é”™è¯¯ä¿¡æ¯
 * @param {String}  url    å‡ºé”™æ–‡ä»¶
 * @param {Number}  row    è¡Œå·
 * @param {Number}  col    åˆ—å·
 * @param {Object}  error  é”™è¯¯è¯¦ç»†ä¿¡æ¯
 */
 window.onerror = function (msg, url, row, col, error) {
  console.log(&apos;æˆ‘çŸ¥é“é”™è¯¯äº†&apos;);
  console.log({
    msg,  url,  row, col, error
  })
  return true;
};
error;
</code></pre><p>ç¤ºä¾‹ï¼šå¼‚æ­¥é”™è¯¯</p>
<pre><code>window.onerror = function (msg, url, row, col, error) {
  console.log(&apos;æˆ‘çŸ¥é“å¼‚æ­¥é”™è¯¯äº†&apos;);
  console.log({
    msg,  url,  row, col, error
  })
  return true;
};
setTimeout(() =&gt; {
  error;
});
</code></pre><p><img src="https://pic3.zhimg.com/v2-8bfdbb4ef72e1fe0ee29f42708d1184d_b.jpg" alt=""><img src="https://pic3.zhimg.com/80/v2-8bfdbb4ef72e1fe0ee29f42708d1184d_hd.jpg" alt=""></p>
<p>ç„¶è€Œ window.onerror å¯¹äºè¯­æ³•é”™è¯¯è¿˜æ˜¯æ— èƒ½ä¸ºåŠ›ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å†™ä»£ç çš„æ—¶å€™è¦å°½å¯èƒ½é¿å…è¯­æ³•é”™è¯¯çš„ï¼Œä¸è¿‡ä¸€èˆ¬è¿™æ ·çš„é”™è¯¯ä¼šä½¿å¾—æ•´ä¸ªé¡µé¢å´©æºƒï¼Œè¿˜æ˜¯æ¯”è¾ƒå®¹æ˜“èƒ½å¤Ÿå¯Ÿè§‰åˆ°çš„ã€‚</p>
<p>åœ¨å®é™…çš„ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œonerror ä¸»è¦æ˜¯æ¥æ•è·é¢„æ–™ä¹‹å¤–çš„é”™è¯¯ï¼Œè€Œ try-catch åˆ™æ˜¯ç”¨æ¥åœ¨å¯é¢„è§æƒ…å†µä¸‹ç›‘æ§ç‰¹å®šçš„é”™è¯¯ï¼Œä¸¤è€…ç»“åˆä½¿ç”¨æ›´åŠ é«˜æ•ˆã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œwindow.onerror å‡½æ•°åªæœ‰åœ¨è¿”å› true çš„æ—¶å€™ï¼Œå¼‚å¸¸æ‰ä¸ä¼šå‘ä¸ŠæŠ›å‡ºï¼Œå¦åˆ™å³ä½¿æ˜¯çŸ¥é“å¼‚å¸¸çš„å‘ç”Ÿæ§åˆ¶å°è¿˜æ˜¯ä¼šæ˜¾ç¤º Uncaught Error: xxxxxã€‚</p>
<p><img src="https://pic3.zhimg.com/v2-875235a4876ea8429f12e7aaf2f19588_b.jpg" alt=""><img src="https://pic3.zhimg.com/80/v2-875235a4876ea8429f12e7aaf2f19588_hd.jpg" alt=""></p>
<p>å…³äº window.onerror è¿˜æœ‰ä¸¤ç‚¹éœ€è¦å€¼å¾—æ³¨æ„</p>
<ol>
<li>å¯¹äº onerror è¿™ç§å…¨å±€æ•è·ï¼Œæœ€å¥½å†™åœ¨æ‰€æœ‰ JS è„šæœ¬çš„å‰é¢ï¼Œå› ä¸ºä½ æ— æ³•ä¿è¯ä½ å†™çš„ä»£ç æ˜¯å¦å‡ºé”™ï¼Œå¦‚æœå†™åœ¨åé¢ï¼Œä¸€æ—¦å‘ç”Ÿé”™è¯¯çš„è¯æ˜¯ä¸ä¼šè¢« onerror æ•è·åˆ°çš„ã€‚</li>
<li>å¦å¤– onerror æ˜¯æ— æ³•æ•è·åˆ°ç½‘ç»œå¼‚å¸¸çš„é”™è¯¯ã€‚</li>
</ol>
<p>å½“æˆ‘ä»¬é‡åˆ° <code>&lt;img src=&quot;./404.png&quot;&gt;</code> æŠ¥ 404 ç½‘ç»œè¯·æ±‚å¼‚å¸¸çš„æ—¶å€™ï¼Œonerror æ˜¯æ— æ³•å¸®åŠ©æˆ‘ä»¬æ•è·åˆ°å¼‚å¸¸çš„ã€‚</p>
<pre><code>&lt;script&gt;
  window.onerror = function (msg, url, row, col, error) {
    console.log(&apos;æˆ‘çŸ¥é“å¼‚æ­¥é”™è¯¯äº†&apos;);
    console.log({
      msg,  url,  row, col, error
    })
    return true;
  };
&lt;/script&gt;
&lt;img src=&quot;./404.png&quot;&gt;
</code></pre><p><img src="https://pic3.zhimg.com/v2-81341c443f078b6526e0c6031dd40953_b.jpg" alt=""><img src="https://pic3.zhimg.com/80/v2-81341c443f078b6526e0c6031dd40953_hd.jpg" alt=""></p>
<p>ç”±äºç½‘ç»œè¯·æ±‚å¼‚å¸¸ä¸ä¼šäº‹ä»¶å†’æ³¡ï¼Œå› æ­¤å¿…é¡»åœ¨æ•è·é˜¶æ®µå°†å…¶æ•æ‰åˆ°æ‰è¡Œï¼Œä½†æ˜¯è¿™ç§æ–¹å¼è™½ç„¶å¯ä»¥æ•æ‰åˆ°ç½‘ç»œè¯·æ±‚çš„å¼‚å¸¸ï¼Œä½†æ˜¯æ— æ³•åˆ¤æ–­ HTTP çš„çŠ¶æ€æ˜¯ 404 è¿˜æ˜¯å…¶ä»–æ¯”å¦‚ 500 ç­‰ç­‰ï¼Œæ‰€ä»¥è¿˜éœ€è¦é…åˆæœåŠ¡ç«¯æ—¥å¿—æ‰è¿›è¡Œæ’æŸ¥åˆ†ææ‰å¯ä»¥ã€‚</p>
<pre><code>&lt;script&gt;
window.addEventListener(&apos;error&apos;, (msg, url, row, col, error) =&gt; {
  console.log(&apos;æˆ‘çŸ¥é“ 404 é”™è¯¯äº†&apos;);
  console.log(
    msg, url, row, col, error
  );
  return true;
}, true);
&lt;/script&gt;
&lt;img src=&quot;./404.png&quot; alt=&quot;&quot;&gt;
</code></pre><p><img src="https://pic4.zhimg.com/v2-6d1c1196acd800a4a4475ee6847ee82a_b.jpg" alt=""><img src="https://pic4.zhimg.com/80/v2-6d1c1196acd800a4a4475ee6847ee82a_hd.jpg" alt=""></p>
<p>è¿™ç‚¹çŸ¥è¯†è¿˜æ˜¯éœ€è¦çŸ¥é“ï¼Œè¦ä¸ç„¶ç”¨æˆ·è®¿é—®ç½‘ç«™ï¼Œå›¾ç‰‡ CDN æ— æ³•æœåŠ¡ï¼Œå›¾ç‰‡åŠ è½½ä¸å‡ºæ¥è€Œå¼€å‘äººå‘˜æ²¡æœ‰å¯Ÿè§‰å°±å°´å°¬äº†ã€‚</p>
<h2 id="Promise-é”™è¯¯"><a href="#Promise-é”™è¯¯" class="headerlink" title="Promise é”™è¯¯"></a>Promise é”™è¯¯</h2><p>é€šè¿‡ Promise å¯ä»¥å¸®åŠ©æˆ‘ä»¬è§£å†³å¼‚æ­¥å›è°ƒåœ°ç‹±çš„é—®é¢˜ï¼Œä½†æ˜¯ä¸€æ—¦ Promise å®ä¾‹æŠ›å‡ºå¼‚å¸¸è€Œä½ æ²¡æœ‰ç”¨ catch å»æ•è·çš„è¯ï¼Œonerror æˆ– try-catch ä¹Ÿæ— èƒ½ä¸ºåŠ›ï¼Œæ— æ³•æ•æ‰åˆ°é”™è¯¯ã€‚</p>
<pre><code>window.addEventListener(&apos;error&apos;, (msg, url, row, col, error) =&gt; {
  console.log(&apos;æˆ‘æ„ŸçŸ¥ä¸åˆ° promise é”™è¯¯&apos;);
  console.log(
    msg, url, row, col, error
  );
}, true);
Promise.reject(&apos;promise error&apos;);
new Promise((resolve, reject) =&gt; {
  reject(&apos;promise error&apos;);
});
new Promise((resolve) =&gt; {
  resolve();
}).then(() =&gt; {
  throw &apos;promise error&apos;
});
</code></pre><p><img src="https://pic4.zhimg.com/v2-1ce580bb2344474b1df1517f2d11aa40_b.jpg" alt=""><img src="https://pic4.zhimg.com/80/v2-1ce580bb2344474b1df1517f2d11aa40_hd.jpg" alt=""></p>
<p>è™½ç„¶åœ¨å†™ Promise å®ä¾‹çš„æ—¶å€™å…»æˆæœ€åå†™ä¸Š catch å‡½æ•°æ˜¯ä¸ªå¥½ä¹ æƒ¯ï¼Œä½†æ˜¯ä»£ç å†™å¤šäº†å°±å®¹æ˜“ç³Šæ¶‚ï¼Œå¿˜è®°å†™ catchã€‚</p>
<p>æ‰€ä»¥å¦‚æœä½ çš„åº”ç”¨ç”¨åˆ°å¾ˆå¤šçš„ Promise å®ä¾‹çš„è¯ï¼Œç‰¹åˆ«æ˜¯ä½ åœ¨ä¸€äº›åŸºäº promise çš„å¼‚æ­¥åº“æ¯”å¦‚ axios ç­‰ä¸€å®šè¦å°å¿ƒï¼Œå› ä¸ºä½ ä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™è¿™äº›å¼‚æ­¥è¯·æ±‚ä¼šæŠ›å‡ºå¼‚å¸¸è€Œä½ å¹¶æ²¡æœ‰å¤„ç†å®ƒï¼Œæ‰€ä»¥ä½ æœ€å¥½æ·»åŠ ä¸€ä¸ª Promise å…¨å±€å¼‚å¸¸æ•è·äº‹ä»¶ <strong>unhandledrejection</strong>ã€‚</p>
<pre><code>window.addEventListener(&quot;unhandledrejection&quot;, function(e){
  e.preventDefault()
  console.log(&apos;æˆ‘çŸ¥é“ promise çš„é”™è¯¯äº†&apos;);
  console.log(e.reason);
  return true;
});
Promise.reject(&apos;promise error&apos;);
new Promise((resolve, reject) =&gt; {
  reject(&apos;promise error&apos;);
});
new Promise((resolve) =&gt; {
  resolve();
}).then(() =&gt; {
  throw &apos;promise error&apos;
});
</code></pre><p><img src="https://pic2.zhimg.com/v2-115d494f26e4f8e2172e1f3b4cb6094f_b.jpg" alt=""><img src="https://pic2.zhimg.com/80/v2-115d494f26e4f8e2172e1f3b4cb6094f_hd.jpg" alt=""></p>
<p>å½“ç„¶ï¼Œå¦‚æœä½ çš„åº”ç”¨æ²¡æœ‰åš Promise å…¨å±€å¼‚å¸¸å¤„ç†çš„è¯ï¼Œé‚£å¾ˆå¯èƒ½å°±åƒæŸä¹é¦–é¡µè¿™æ ·ï¼š</p>
<p><img src="https://pic2.zhimg.com/v2-37c6bc3763c147a4c97bdde688a59a5c_b.jpg" alt=""><img src="https://pic2.zhimg.com/80/v2-37c6bc3763c147a4c97bdde688a59a5c_hd.jpg" alt=""></p>
<h2 id="å¼‚å¸¸ä¸ŠæŠ¥æ–¹å¼"><a href="#å¼‚å¸¸ä¸ŠæŠ¥æ–¹å¼" class="headerlink" title="å¼‚å¸¸ä¸ŠæŠ¥æ–¹å¼"></a>å¼‚å¸¸ä¸ŠæŠ¥æ–¹å¼</h2><p>ç›‘æ§æ‹¿åˆ°æŠ¥é”™ä¿¡æ¯ä¹‹åï¼Œæ¥ä¸‹æ¥å°±éœ€è¦å°†æ•æ‰åˆ°çš„é”™è¯¯ä¿¡æ¯å‘é€åˆ°ä¿¡æ¯æ”¶é›†å¹³å°ä¸Šï¼Œå¸¸ç”¨çš„å‘é€å½¢å¼ä¸»è¦æœ‰ä¸¤ç§:</p>
<ol>
<li>é€šè¿‡ Ajax å‘é€æ•°æ®</li>
<li>åŠ¨æ€åˆ›å»º img æ ‡ç­¾çš„å½¢å¼</li>
</ol>
<p>å®ä¾‹ - åŠ¨æ€åˆ›å»º img æ ‡ç­¾è¿›è¡Œä¸ŠæŠ¥</p>
<pre><code>function report(error) {
  var reportUrl = &apos;http://xxxx/report&apos;;
  new Image().src = reportUrl + &apos;error=&apos; + error;
}
</code></pre><h2 id="ç›‘æ§ä¸ŠæŠ¥å¸¸è§é—®é¢˜"><a href="#ç›‘æ§ä¸ŠæŠ¥å¸¸è§é—®é¢˜" class="headerlink" title="ç›‘æ§ä¸ŠæŠ¥å¸¸è§é—®é¢˜"></a>ç›‘æ§ä¸ŠæŠ¥å¸¸è§é—®é¢˜</h2><p>ä¸‹è¿°ä¾‹å­æˆ‘å…¨éƒ¨æ”¾åœ¨æˆ‘çš„ github ä¸Šï¼Œè¯»è€…å¯ä»¥è‡ªè¡ŒæŸ¥é˜…ï¼Œåé¢ä¸å†èµ˜è¿°ã€‚</p>
<pre><code>git clone https://github.com/happylindz/blog.git
cd blog/code/jserror/
npm install
</code></pre><h2 id="Script-error-è„šæœ¬é”™è¯¯æ˜¯ä»€ä¹ˆ"><a href="#Script-error-è„šæœ¬é”™è¯¯æ˜¯ä»€ä¹ˆ" class="headerlink" title="Script error è„šæœ¬é”™è¯¯æ˜¯ä»€ä¹ˆ"></a>Script error è„šæœ¬é”™è¯¯æ˜¯ä»€ä¹ˆ</h2><p>å› ä¸ºæˆ‘ä»¬åœ¨çº¿ä¸Šçš„ç‰ˆæœ¬ï¼Œç»å¸¸åšé™æ€èµ„æº CDN åŒ–ï¼Œè¿™å°±ä¼šå¯¼è‡´æˆ‘ä»¬å¸¸è®¿é—®çš„é¡µé¢è·Ÿè„šæœ¬æ–‡ä»¶æ¥è‡ªä¸åŒçš„åŸŸåï¼Œè¿™æ—¶å€™å¦‚æœæ²¡æœ‰è¿›è¡Œé¢å¤–çš„é…ç½®ï¼Œå°±ä¼šå®¹æ˜“äº§ç”Ÿ Script errorã€‚</p>
<p><img src="https://pic3.zhimg.com/v2-840f71bf7014767132b47ad2c6a37238_b.jpg" alt=""><img src="https://pic3.zhimg.com/80/v2-840f71bf7014767132b47ad2c6a37238_hd.jpg" alt=""></p>
<p>å¯é€šè¿‡ <code>npm run nocors</code> æŸ¥çœ‹æ•ˆæœã€‚</p>
<p>Script error æ˜¯æµè§ˆå™¨åœ¨åŒæºç­–ç•¥é™åˆ¶ä¸‹äº§ç”Ÿçš„ï¼Œæµè§ˆå™¨å¤„äºå¯¹å®‰å…¨æ€§ä¸Šçš„è€ƒè™‘ï¼Œå½“é¡µé¢å¼•ç”¨éåŒåŸŸåå¤–éƒ¨è„šæœ¬æ–‡ä»¶æ—¶ä¸­æŠ›å‡ºå¼‚å¸¸çš„è¯ï¼Œæ­¤æ—¶æœ¬é¡µé¢æ˜¯æ²¡æœ‰æƒåˆ©çŸ¥é“è¿™ä¸ªæŠ¥é”™ä¿¡æ¯çš„ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯è¾“å‡º Script error è¿™æ ·çš„ä¿¡æ¯ã€‚</p>
<p><img src="https://pic2.zhimg.com/v2-fc3941d89716f96374576d0426ff4ccb_b.jpg" alt=""><img src="https://pic2.zhimg.com/80/v2-fc3941d89716f96374576d0426ff4ccb_hd.jpg" alt=""></p>
<p>è¿™æ ·åšçš„ç›®çš„æ˜¯é¿å…æ•°æ®æ³„éœ²åˆ°ä¸å®‰å…¨çš„åŸŸä¸­ï¼Œä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œ</p>
<pre><code>&lt;script src=&quot;xxxx.com/login.html&quot;&gt;&lt;/script&gt;
</code></pre><p>ä¸Šé¢æˆ‘ä»¬å¹¶æ²¡æœ‰å¼•å…¥ä¸€ä¸ª js æ–‡ä»¶ï¼Œè€Œæ˜¯ä¸€ä¸ª htmlï¼Œè¿™ä¸ª html æ˜¯é“¶è¡Œçš„ç™»å½•é¡µé¢ï¼Œå¦‚æœä½ å·²ç»ç™»å½•äº†ï¼Œé‚£ login é¡µé¢å°±ä¼šè‡ªåŠ¨è·³è½¬åˆ° <code>Welcome xxx...</code>ï¼Œå¦‚æœæœªç™»å½•åˆ™è·³è½¬åˆ° <code>Please Login...</code>ï¼Œé‚£ä¹ˆæŠ¥é”™ä¹Ÿä¼šæ˜¯ <code>Welcome xxx... is not definedï¼ŒPlease Login... is not defined</code>ï¼Œé€šè¿‡è¿™äº›ä¿¡æ¯å¯ä»¥åˆ¤æ–­ä¸€ä¸ªç”¨æˆ·æ˜¯å¦ç™»å½•ä»–çš„å¸å·ï¼Œç»™å…¥ä¾µè€…æä¾›äº†ååˆ†ä¾¿åˆ©çš„åˆ¤æ–­æ¸ é“ï¼Œè¿™æ˜¯ç›¸å½“ä¸å®‰å…¨çš„ã€‚</p>
<p>ä»‹ç»å®ŒèƒŒæ™¯åï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥å»è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ</p>
<p>é¦–å…ˆå¯ä»¥æƒ³åˆ°çš„æ–¹æ¡ˆè‚¯å®šæ˜¯åŒæºåŒ–ç­–ç•¥ï¼Œå°† JS æ–‡ä»¶å†…è”åˆ° html æˆ–è€…æ”¾åˆ°åŒåŸŸä¸‹ï¼Œè™½ç„¶èƒ½ç®€å•æœ‰æ•ˆåœ°è§£å†³ script error é—®é¢˜ï¼Œä½†æ˜¯è¿™æ ·æ— æ³•åˆ©ç”¨å¥½æ–‡ä»¶ç¼“å­˜å’Œ CDN çš„ä¼˜åŠ¿ï¼Œä¸æ¨èä½¿ç”¨ã€‚æ­£ç¡®çš„æ–¹æ³•åº”è¯¥æ˜¯ä»æ ¹æœ¬ä¸Šè§£å†³ script error çš„é”™è¯¯ã€‚</p>
<h2 id="è·¨æºèµ„æºå…±äº«æœºåˆ¶-CORS"><a href="#è·¨æºèµ„æºå…±äº«æœºåˆ¶-CORS" class="headerlink" title="è·¨æºèµ„æºå…±äº«æœºåˆ¶( CORS )"></a>è·¨æºèµ„æºå…±äº«æœºåˆ¶( CORS )</h2><p>é¦–å…ˆä¸ºé¡µé¢ä¸Šçš„ script æ ‡ç­¾æ·»åŠ  crossOrigin å±æ€§</p>
<pre><code>// http://localhost:8080/index.html
&lt;script&gt;
  window.onerror = function (msg, url, row, col, error) {
    console.log(&apos;æˆ‘çŸ¥é“é”™è¯¯äº†ï¼Œä¹ŸçŸ¥é“é”™è¯¯ä¿¡æ¯&apos;);
    console.log({
      msg,  url,  row, col, error
    })
    return true;
  };
&lt;/script&gt;
&lt;script src=&quot;http://localhost:8081/test.js&quot; crossorigin&gt;&lt;/script&gt;

// http://localhost:8081/test.js
setTimeout(() =&gt; {
  console.log(error);
});
</code></pre><p>å½“ä½ ä¿®æ”¹å®Œå‰ç«¯ä»£ç åï¼Œä½ è¿˜éœ€è¦é¢å¤–ç»™åç«¯åœ¨å“åº”å¤´é‡ŒåŠ ä¸Š <code>Access-Control-Allow-Origin: localhost:8080</code>ï¼Œè¿™é‡Œæˆ‘ä»¥ Koa ä¸ºä¾‹ã€‚</p>
<pre><code>const Koa = require(&apos;koa&apos;);
const path = require(&apos;path&apos;);
const cors = require(&apos;koa-cors&apos;);
const app = new Koa();

app.use(cors());
app.use(require(&apos;koa-static&apos;)(path.resolve(__dirname, &apos;./public&apos;)));

app.listen(8081, () =&gt; {
  console.log(&apos;koa app listening at 8081&apos;)
});
</code></pre><p><img src="https://pic1.zhimg.com/v2-9717062e56340cef40ee67b438b2ba95_b.jpg" alt=""><img src="https://pic1.zhimg.com/80/v2-9717062e56340cef40ee67b438b2ba95_hd.jpg" alt=""></p>
<p>è¯»è€…å¯é€šè¿‡ <code>npm run cors</code> è¯¦ç»†çš„è·¨åŸŸçŸ¥è¯†æˆ‘å°±ä¸å±•å¼€äº†ï¼Œæœ‰å…´è¶£å¯ä»¥çœ‹çœ‹æˆ‘ä¹‹å‰å†™çš„æ–‡ç« ï¼š<a href="https://link.zhihu.com/?target=https%3A//github.com/happylindz/blog/issues/3" target="_blank" rel="noopener">è·¨åŸŸï¼Œä½ éœ€è¦çŸ¥é“çš„å…¨åœ¨è¿™é‡Œ</a></p>
<p>ä½ ä»¥ä¸ºè¿™æ ·å°±å®Œäº†å—ï¼Ÿå¹¶æ²¡æœ‰ï¼Œä¸‹é¢å°±è¯´ä¸€äº› Script error ä½ ä¸å¸¸é‡è§çš„ç‚¹ï¼š</p>
<p>æˆ‘ä»¬éƒ½çŸ¥é“ JSONP æ˜¯ç”¨æ¥è·¨åŸŸè·å–æ•°æ®çš„ï¼Œå¹¶ä¸”å…¼å®¹æ€§è‰¯å¥½ï¼Œåœ¨ä¸€äº›åº”ç”¨ä¸­ä»ç„¶ä¼šä½¿ç”¨åˆ°ï¼Œæ‰€ä»¥ä½ çš„é¡¹ç›®ä¸­å¯èƒ½ä¼šç”¨è¿™æ ·çš„ä»£ç ï¼š</p>
<pre><code>// http://localhost:8080/index.html
window.onerror = function (msg, url, row, col, error) {
  console.log(&apos;æˆ‘çŸ¥é“é”™è¯¯äº†ï¼Œä½†ä¸çŸ¥é“é”™è¯¯ä¿¡æ¯&apos;);
  console.log({
    msg,  url,  row, col, error
  })
  return true;
};
function jsonpCallback(data) {
  console.log(data);
}
const url = &apos;http://localhost:8081/data?callback=jsonpCallback&apos;;
const script = document.createElement(&apos;script&apos;);
script.src = url;
document.body.appendChild(script);
</code></pre><p>å› ä¸ºè¿”å›çš„ä¿¡æ¯ä¼šå½“åšè„šæœ¬æ–‡ä»¶æ¥æ‰§è¡Œï¼Œä¸€æ—¦è¿”å›çš„è„šæœ¬å†…å®¹å‡ºé”™äº†ï¼Œä¹Ÿæ˜¯æ— æ³•æ•æ‰åˆ°é”™è¯¯çš„ä¿¡æ¯ã€‚</p>
<p><img src="https://pic4.zhimg.com/v2-01afbf8a4ba1fc4fdd9a22b884f9a8d8_b.jpg" alt=""><img src="https://pic4.zhimg.com/80/v2-01afbf8a4ba1fc4fdd9a22b884f9a8d8_hd.jpg" alt=""></p>
<p>è§£å†³åŠæ³•ä¹Ÿä¸éš¾ï¼Œè·Ÿä¹‹å‰ä¸€æ ·ï¼Œåœ¨æ·»åŠ åŠ¨æ€æ·»åŠ è„šæœ¬çš„æ—¶å€™åŠ ä¸Š crossOriginï¼Œå¹¶ä¸”åœ¨åç«¯é…ä¸Šç›¸åº”çš„ CORS å­—æ®µå³å¯.</p>
<pre><code>const script = document.createElement(&apos;script&apos;);
script.crossOrigin = &apos;anonymous&apos;;
script.src = url;
document.body.appendChild(script);
</code></pre><p>è¯»è€…å¯ä»¥é€šè¿‡ <code>npm run jsonp</code> æŸ¥çœ‹æ•ˆæœ</p>
<p><img src="https://pic4.zhimg.com/v2-ab0b67a7e6b5afabf281b792ca2d6bd2_b.jpg" alt=""><img src="https://pic4.zhimg.com/80/v2-ab0b67a7e6b5afabf281b792ca2d6bd2_hd.jpg" alt=""></p>
<p>çŸ¥é“åŸç†ä¹‹åä½ å¯èƒ½ä¼šè§‰å¾—æ²¡ä»€ä¹ˆï¼Œä¸å°±æ˜¯ç»™æ¯ä¸ªåŠ¨æ€ç”Ÿæˆçš„è„šæœ¬æ·»åŠ  crossOrigin å­—æ®µå˜›ï¼Œä½†æ˜¯åœ¨å®é™…å·¥ç¨‹ä¸­ï¼Œä½ å¯èƒ½æ˜¯é¢å‘å¾ˆå¤šåº“æ¥ç¼–ç¨‹ï¼Œæ¯”å¦‚ä½¿ç”¨ jQueryï¼ŒSeajs æˆ–è€… webpack æ¥å¼‚æ­¥åŠ è½½è„šæœ¬ï¼Œè®¸å¤šåº“å°è£…äº†å¼‚æ­¥åŠ è½½è„šæœ¬çš„èƒ½åŠ›ï¼Œä»¥ jQeury ä¸ºä¾‹ä½ å¯èƒ½æ˜¯è¿™æ ·æ¥è§¦å‘å¼‚æ­¥è„šæœ¬ã€‚</p>
<pre><code>$.ajax({
  url: &apos;http://localhost:8081/data&apos;,
  dataType: &apos;jsonp&apos;,
  success: (data) =&gt; {
    console.log(data);
  }
})
</code></pre><p>å‡å¦‚è¿™äº›åº“ä¸­æ²¡æœ‰æä¾› crossOrigin çš„èƒ½åŠ›çš„è¯(jQuery jsonp å¯èƒ½æœ‰ï¼Œå‡è£…ä½ ä¸çŸ¥é“)ï¼Œé‚£ä½ åªèƒ½å»ä¿®æ”¹äººå®¶å†™çš„æºä»£ç äº†ï¼Œæ‰€ä»¥æˆ‘è¿™é‡Œæä¾›ä¸€ä¸ªæ€è·¯ï¼Œå°±æ˜¯å»åŠ«æŒ document.createElementï¼Œä»æ ¹æºä¸Šå»ä¸ºæ¯ä¸ªåŠ¨æ€ç”Ÿæˆçš„è„šæœ¬æ·»åŠ  crossOrigin å­—æ®µã€‚</p>
<pre><code>document.createElement = (function() {
  const fn = document.createElement.bind(document);
  return function(type) {
    const result = fn(type);
    if(type === &apos;script&apos;) {
      result.crossOrigin = &apos;anonymous&apos;;
    }
    return result;
  }
})();
window.onerror = function (msg, url, row, col, error) {
  console.log(&apos;æˆ‘çŸ¥é“é”™è¯¯äº†ï¼Œä¹ŸçŸ¥é“é”™è¯¯ä¿¡æ¯&apos;);
  console.log({
    msg,  url,  row, col, error
  })
  return true;
};
$.ajax({
  url: &apos;http://localhost:8081/data&apos;,
  dataType: &apos;jsonp&apos;,
  success: (data) =&gt; {
    console.log(data);
  }
})
</code></pre><p>æ•ˆæœä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œè¯»è€…å¯ä»¥é€šè¿‡ <code>npm run jsonpjq</code> æ¥æŸ¥çœ‹æ•ˆæœï¼š</p>
<p><img src="https://pic4.zhimg.com/v2-30d51a96cdb3286edd1e5a88e9f794bb_b.jpg" alt=""><img src="https://pic4.zhimg.com/80/v2-30d51a96cdb3286edd1e5a88e9f794bb_hd.jpg" alt=""></p>
<p>è¿™æ ·é‡å†™ createElement ç†è®ºä¸Šæ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯å…¥ä¾µäº†åŸæœ¬çš„ä»£ç ï¼Œä¸ä¿è¯ä¸€å®šä¸ä¼šå‡ºé”™ï¼Œåœ¨å·¥ç¨‹ä¸Šè¿˜æ˜¯éœ€è¦å¤šå°è¯•ä¸‹çœ‹çœ‹å†ä½¿ç”¨ï¼Œå¯èƒ½å­˜åœ¨å…¼å®¹æ€§ä¸Šé—®é¢˜ï¼Œå¦‚æœä½ è§‰å¾—ä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜çš„è¯ä¹Ÿæ¬¢è¿ç•™è¨€è®¨è®ºä¸‹ã€‚</p>
<p>å…³äº Script error çš„é—®é¢˜å°±å†™åˆ°è¿™é‡Œï¼Œå¦‚æœä½ ç†è§£äº†ä¸Šé¢çš„å†…å®¹ï¼ŒåŸºæœ¬ä¸Šç»å¤§éƒ¨åˆ†çš„ Script error éƒ½èƒ½è¿åˆƒè€Œè§£ã€‚</p>
<h2 id="window-onerror-èƒ½å¦æ•è·-iframe-çš„é”™è¯¯"><a href="#window-onerror-èƒ½å¦æ•è·-iframe-çš„é”™è¯¯" class="headerlink" title="window.onerror èƒ½å¦æ•è· iframe çš„é”™è¯¯"></a>window.onerror èƒ½å¦æ•è· iframe çš„é”™è¯¯</h2><p>å½“ä½ çš„é¡µé¢æœ‰ä½¿ç”¨ iframe çš„æ—¶å€™ï¼Œä½ éœ€è¦å¯¹ä½ å¼•å…¥çš„ iframe åšå¼‚å¸¸ç›‘æ§çš„å¤„ç†ï¼Œå¦åˆ™ä¸€æ—¦ä½ å¼•å…¥çš„ iframe é¡µé¢å‡ºç°äº†é—®é¢˜ï¼Œä½ çš„ä¸»ç«™æ˜¾ç¤ºä¸å‡ºæ¥ï¼Œè€Œä½ å´æµ‘ç„¶ä¸çŸ¥ã€‚</p>
<p>é¦–å…ˆéœ€è¦å¼ºè°ƒï¼Œçˆ¶çª—å£ç›´æ¥ä½¿ç”¨ window.onerror æ˜¯æ— æ³•ç›´æ¥æ•è·ï¼Œå¦‚æœä½ æƒ³è¦æ•è· iframe çš„å¼‚å¸¸çš„è¯ï¼Œæœ‰åˆ†å¥½å‡ ç§æƒ…å†µã€‚</p>
<p>å¦‚æœä½ çš„ iframe é¡µé¢å’Œä½ çš„ä¸»ç«™æ˜¯åŒåŸŸåçš„è¯ï¼Œç›´æ¥ç»™ iframe æ·»åŠ  onerror äº‹ä»¶å³å¯ã€‚</p>
<pre><code>&lt;iframe src=&quot;./iframe.html&quot; frameborder=&quot;0&quot;&gt;&lt;/iframe&gt;
&lt;script&gt;
  window.frames[0].onerror = function (msg, url, row, col, error) {
    console.log(&apos;æˆ‘çŸ¥é“ iframe çš„é”™è¯¯äº†ï¼Œä¹ŸçŸ¥é“é”™è¯¯ä¿¡æ¯&apos;);
    console.log({
      msg,  url,  row, col, error
    })
    return true;
  };
&lt;/script&gt;
</code></pre><p>è¯»è€…å¯ä»¥é€šè¿‡ <code>npm run iframe</code> æŸ¥çœ‹æ•ˆæœï¼š</p>
<p><img src="https://pic2.zhimg.com/v2-3edcb5686e27ab11f5f3c9c1644986d0_b.jpg" alt=""><img src="https://pic2.zhimg.com/80/v2-3edcb5686e27ab11f5f3c9c1644986d0_hd.jpg" alt=""></p>
<p>å¦‚æœä½ åµŒå…¥çš„ iframe é¡µé¢å’Œä½ çš„ä¸»ç«™ä¸æ˜¯åŒä¸ªåŸŸåçš„ï¼Œä½†æ˜¯ iframe å†…å®¹ä¸å±äºç¬¬ä¸‰æ–¹ï¼Œæ˜¯ä½ å¯ä»¥æ§åˆ¶çš„ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡ä¸ iframe é€šä¿¡çš„æ–¹å¼å°†å¼‚å¸¸ä¿¡æ¯æŠ›ç»™ä¸»ç«™æ¥æ”¶ã€‚ä¸ iframe é€šä¿¡çš„æ–¹å¼æœ‰å¾ˆå¤šï¼Œå¸¸ç”¨çš„å¦‚ï¼špostMessageï¼Œhash æˆ–è€… name å­—æ®µè·¨åŸŸç­‰ç­‰ï¼Œè¿™é‡Œå°±ä¸å±•å¼€äº†ï¼Œæ„Ÿå…´è¶£çš„è¯å¯ä»¥çœ‹ï¼š<a href="https://link.zhihu.com/?target=https%3A//github.com/happylindz/blog/issues/3" target="_blank" rel="noopener">è·¨åŸŸï¼Œä½ éœ€è¦çŸ¥é“çš„å…¨åœ¨è¿™é‡Œ</a></p>
<p>å¦‚æœæ˜¯éåŒåŸŸä¸”ç½‘ç«™ä¸å—è‡ªå·±æ§åˆ¶çš„è¯ï¼Œé™¤äº†é€šè¿‡æ§åˆ¶å°çœ‹åˆ°è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å¤–ï¼Œæ²¡åŠæ³•æ•è·ï¼Œè¿™æ˜¯å‡ºäºå®‰å…¨æ€§çš„è€ƒè™‘ï¼Œä½ å¼•å…¥äº†ä¸€ä¸ªç™¾åº¦é¦–é¡µï¼Œäººå®¶é¡µé¢æŠ¥å‡ºçš„é”™è¯¯å‡­å•¥è®©ä½ å»ç›‘æ§å‘¢ï¼Œè¿™ä¼šå¼•å‡ºå¾ˆå¤šå®‰å…¨æ€§çš„é—®é¢˜ã€‚</p>
<h2 id="å‹ç¼©ä»£ç å¦‚ä½•å®šä½åˆ°è„šæœ¬å¼‚å¸¸ä½ç½®"><a href="#å‹ç¼©ä»£ç å¦‚ä½•å®šä½åˆ°è„šæœ¬å¼‚å¸¸ä½ç½®" class="headerlink" title="å‹ç¼©ä»£ç å¦‚ä½•å®šä½åˆ°è„šæœ¬å¼‚å¸¸ä½ç½®"></a>å‹ç¼©ä»£ç å¦‚ä½•å®šä½åˆ°è„šæœ¬å¼‚å¸¸ä½ç½®</h2><p>çº¿ä¸Šçš„ä»£ç å‡ ä¹éƒ½ç»è¿‡äº†å‹ç¼©å¤„ç†ï¼Œå‡ åä¸ªæ–‡ä»¶æ‰“åŒ…æˆäº†ä¸€ä¸ªå¹¶ä¸‘åŒ–ä»£ç ï¼Œå½“æˆ‘ä»¬æ”¶åˆ° <code>a is not defined</code> çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ ¹æœ¬ä¸çŸ¥é“è¿™ä¸ªå˜é‡ a ç©¶ç«Ÿæ˜¯ä»€ä¹ˆå«ä¹‰ï¼Œæ­¤æ—¶æŠ¥é”™çš„é”™è¯¯æ—¥å¿—æ˜¾ç„¶æ˜¯æ— æ•ˆçš„ã€‚</p>
<p>ç¬¬ä¸€æƒ³åˆ°çš„åŠæ³•æ˜¯åˆ©ç”¨ sourcemap å®šä½åˆ°é”™è¯¯ä»£ç çš„å…·ä½“ä½ç½®ï¼Œè¯¦ç»†å†…å®¹å¯ä»¥å‚è€ƒï¼š<a href="https://link.zhihu.com/?target=https%3A//github.com/joeyguo/blog/issues/14" target="_blank" rel="noopener">Sourcemap å®šä½è„šæœ¬é”™è¯¯</a></p>
<p>å¦å¤–ä¹Ÿå¯ä»¥é€šè¿‡åœ¨æ‰“åŒ…çš„æ—¶å€™ï¼Œåœ¨æ¯ä¸ªåˆå¹¶çš„æ–‡ä»¶ä¹‹é—´æ·»åŠ å‡ è¡Œç©ºæ ¼ï¼Œå¹¶ç›¸åº”åŠ ä¸Šä¸€äº›æ³¨é‡Šï¼Œè¿™æ ·åœ¨å®šä½é—®é¢˜çš„æ—¶å€™å¾ˆå®¹æ˜“å¯ä»¥çŸ¥é“æ˜¯å“ªä¸ªæ–‡ä»¶æŠ¥çš„é”™è¯¯ï¼Œç„¶åå†é€šè¿‡ä¸€äº›å…³é”®è¯çš„æœç´¢ï¼Œå¯ä»¥å¿«é€Ÿåœ°å®šä½åˆ°é—®é¢˜çš„æ‰€åœ¨ä½ç½®ã€‚</p>
<h2 id="æ”¶é›†å¼‚å¸¸ä¿¡æ¯é‡å¤ªå¤šï¼Œæ€ä¹ˆåŠ"><a href="#æ”¶é›†å¼‚å¸¸ä¿¡æ¯é‡å¤ªå¤šï¼Œæ€ä¹ˆåŠ" class="headerlink" title="æ”¶é›†å¼‚å¸¸ä¿¡æ¯é‡å¤ªå¤šï¼Œæ€ä¹ˆåŠ"></a>æ”¶é›†å¼‚å¸¸ä¿¡æ¯é‡å¤ªå¤šï¼Œæ€ä¹ˆåŠ</h2><p>å¦‚æœä½ çš„ç½‘ç«™è®¿é—®é‡å¾ˆå¤§ï¼Œå‡å¦‚ç½‘é¡µçš„ PV æœ‰ 1kwï¼Œé‚£ä¹ˆä¸€ä¸ªå¿…ç„¶çš„é”™è¯¯å‘é€çš„ä¿¡æ¯å°±æœ‰ 1kw æ¡ï¼Œæˆ‘ä»¬å¯ä»¥ç»™ç½‘ç«™è®¾ç½®ä¸€ä¸ªé‡‡é›†ç‡ï¼š</p>
<pre><code>Reporter.send = function(data) {
  // åªé‡‡é›† 30%
  if(Math.random() &lt; 0.3) {
    send(data)      // ä¸ŠæŠ¥é”™è¯¯ä¿¡æ¯
  }
}
</code></pre><p>è¿™ä¸ªé‡‡é›†ç‡å¯ä»¥é€šè¿‡å…·ä½“å®é™…çš„æƒ…å†µæ¥è®¾å®šï¼Œæ–¹æ³•å¤šæ ·åŒ–ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªéšæœºæ•°ï¼Œä¹Ÿå¯ä»¥å…·ä½“æ ¹æ®ç”¨æˆ·çš„æŸäº›ç‰¹å¾æ¥è¿›è¡Œåˆ¤å®šã€‚</p>
<p>ä¸Šé¢å·®ä¸å¤šæ˜¯æˆ‘å¯¹å‰ç«¯ä»£ç ç›‘æ§çš„ä¸€äº›ç†è§£ï¼Œè¯´èµ·æ¥å®¹æ˜“ï¼Œä½†æ˜¯ä¸€æ—¦åœ¨å·¥ç¨‹åŒ–è¿ç”¨ï¼Œéš¾å…éœ€è¦è€ƒè™‘åˆ°å…¼å®¹æ€§ç­‰ç§ç§é—®é¢˜ï¼Œè¯»è€…å¯ä»¥é€šè¿‡è‡ªå·±çš„å…·ä½“æƒ…å†µè¿›è¡Œè°ƒæ•´ï¼Œå‰ç«¯ä»£ç å¼‚å¸¸ç›‘æ§å¯¹äºæˆ‘ä»¬çš„ç½‘ç«™çš„ç¨³å®šæ€§èµ·ç€è‡³å…³é‡è¦çš„ä½œç”¨ã€‚å¦‚è‹¥æ–‡ä¸­æ‰€æœ‰ä¸å¯¹çš„åœ°æ–¹ï¼Œè¿˜æœ›æŒ‡æ­£ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/02/JSä¹‹callå’Œapply-bindçš„æ¨¡æ‹Ÿå®ç°/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/02/JSä¹‹callå’Œapply-bindçš„æ¨¡æ‹Ÿå®ç°/" itemprop="url">JSä¹‹callå’Œapply,bindçš„æ¨¡æ‹Ÿå®ç°</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-09-02T22:39:16+08:00">
                2018-09-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="call"><a href="#call" class="headerlink" title="call"></a>call</h2><p>ä¸€å¥è¯ä»‹ç» callï¼š</p>
<blockquote>
<p>call() æ–¹æ³•åœ¨ä½¿ç”¨ä¸€ä¸ªæŒ‡å®šçš„ this å€¼å’Œè‹¥å¹²ä¸ªæŒ‡å®šçš„å‚æ•°å€¼çš„å‰æä¸‹è°ƒç”¨æŸä¸ªå‡½æ•°æˆ–æ–¹æ³•ã€‚</p>
</blockquote>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code>var foo = {
    value: 1
};

function bar() {
    console.log(this.value);
}

bar.call(foo); // 1
</code></pre><p>æ³¨æ„ä¸¤ç‚¹ï¼š</p>
<ol>
<li>call æ”¹å˜äº† this çš„æŒ‡å‘ï¼ŒæŒ‡å‘åˆ° foo</li>
<li>bar å‡½æ•°æ‰§è¡Œäº†</li>
</ol>
<h2 id="æ¨¡æ‹Ÿå®ç°ç¬¬ä¸€æ­¥"><a href="#æ¨¡æ‹Ÿå®ç°ç¬¬ä¸€æ­¥" class="headerlink" title="æ¨¡æ‹Ÿå®ç°ç¬¬ä¸€æ­¥"></a>æ¨¡æ‹Ÿå®ç°ç¬¬ä¸€æ­¥</h2><p>é‚£ä¹ˆæˆ‘ä»¬è¯¥æ€ä¹ˆæ¨¡æ‹Ÿå®ç°è¿™ä¸¤ä¸ªæ•ˆæœå‘¢ï¼Ÿ</p>
<p>è¯•æƒ³å½“è°ƒç”¨ call çš„æ—¶å€™ï¼ŒæŠŠ foo å¯¹è±¡æ”¹é€ æˆå¦‚ä¸‹ï¼š</p>
<pre><code>var foo = {
    value: 1,
    bar: function() {
        console.log(this.value)
    }
};

foo.bar(); // 1
</code></pre><p>è¿™ä¸ªæ—¶å€™ this å°±æŒ‡å‘äº† fooï¼Œæ˜¯ä¸æ˜¯å¾ˆç®€å•å‘¢ï¼Ÿ</p>
<p>ä½†æ˜¯è¿™æ ·å´ç»™ foo å¯¹è±¡æœ¬èº«æ·»åŠ äº†ä¸€ä¸ªå±æ€§ï¼Œè¿™å¯ä¸è¡Œå‘ï¼</p>
<p>ä¸è¿‡ä¹Ÿä¸ç”¨æ‹…å¿ƒï¼Œæˆ‘ä»¬ç”¨ delete å†åˆ é™¤å®ƒä¸å°±å¥½äº†~</p>
<p>æ‰€ä»¥æˆ‘ä»¬æ¨¡æ‹Ÿçš„æ­¥éª¤å¯ä»¥åˆ†ä¸ºï¼š</p>
<ol>
<li>å°†å‡½æ•°è®¾ä¸ºå¯¹è±¡çš„å±æ€§</li>
<li>æ‰§è¡Œè¯¥å‡½æ•°</li>
<li>åˆ é™¤è¯¥å‡½æ•°</li>
</ol>
<p>ä»¥ä¸Šä¸ªä¾‹å­ä¸ºä¾‹ï¼Œå°±æ˜¯ï¼š</p>
<pre><code>// ç¬¬ä¸€æ­¥
foo.fn = bar
// ç¬¬äºŒæ­¥
foo.fn()
// ç¬¬ä¸‰æ­¥
delete foo.fn
</code></pre><p>fn æ˜¯å¯¹è±¡çš„å±æ€§åï¼Œåæ­£æœ€åä¹Ÿè¦åˆ é™¤å®ƒï¼Œæ‰€ä»¥èµ·æˆä»€ä¹ˆéƒ½æ— æ‰€è°“ã€‚</p>
<p>æ ¹æ®è¿™ä¸ªæ€è·¯ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ç€å»å†™ç¬¬ä¸€ç‰ˆçš„ call2 å‡½æ•°ï¼š</p>
<pre><code>// ç¬¬ä¸€ç‰ˆ
Function.prototype.call2 = function(context) {
    // é¦–å…ˆè¦è·å–è°ƒç”¨callçš„å‡½æ•°ï¼Œç”¨thiså¯ä»¥è·å–
    context.fn = this;
    context.fn();
    delete context.fn;
}

// æµ‹è¯•ä¸€ä¸‹
var foo = {
    value: 1
};

function bar() {
    console.log(this.value);
}

bar.call2(foo); // 1
</code></pre><p>æ­£å¥½å¯ä»¥æ‰“å° 1 å“ï¼æ˜¯ä¸æ˜¯å¾ˆå¼€å¿ƒï¼(ï½ï¿£â–½ï¿£)ï½</p>
<h2 id="æ¨¡æ‹Ÿå®ç°ç¬¬äºŒæ­¥"><a href="#æ¨¡æ‹Ÿå®ç°ç¬¬äºŒæ­¥" class="headerlink" title="æ¨¡æ‹Ÿå®ç°ç¬¬äºŒæ­¥"></a>æ¨¡æ‹Ÿå®ç°ç¬¬äºŒæ­¥</h2><p>æœ€ä¸€å¼€å§‹ä¹Ÿè®²äº†ï¼Œcall å‡½æ•°è¿˜èƒ½ç»™å®šå‚æ•°æ‰§è¡Œå‡½æ•°ã€‚ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code>var foo = {
    value: 1
};

function bar(name, age) {
    console.log(name)
    console.log(age)
    console.log(this.value);
}

bar.call(foo, &apos;kevin&apos;, 18);
// kevin
// 18
// 1
</code></pre><p>æ³¨æ„ï¼šä¼ å…¥çš„å‚æ•°å¹¶ä¸ç¡®å®šï¼Œè¿™å¯å’‹åŠï¼Ÿ</p>
<p>ä¸æ€¥ï¼Œæˆ‘ä»¬å¯ä»¥ä» Arguments å¯¹è±¡ä¸­å–å€¼ï¼Œå–å‡ºç¬¬äºŒä¸ªåˆ°æœ€åä¸€ä¸ªå‚æ•°ï¼Œç„¶åæ”¾åˆ°ä¸€ä¸ªæ•°ç»„é‡Œã€‚</p>
<p>æ¯”å¦‚è¿™æ ·ï¼š</p>
<pre><code>// ä»¥ä¸Šä¸ªä¾‹å­ä¸ºä¾‹ï¼Œæ­¤æ—¶çš„argumentsä¸ºï¼š
// arguments = {
//      0: foo,
//      1: &apos;kevin&apos;,
//      2: 18,
//      length: 3
// }
// å› ä¸ºargumentsæ˜¯ç±»æ•°ç»„å¯¹è±¡ï¼Œæ‰€ä»¥å¯ä»¥ç”¨forå¾ªç¯
var args = [];
for(var i = 1, len = arguments.length; i &lt; len; i++) {
    args.push(&apos;arguments[&apos; + i + &apos;]&apos;);
}

// æ‰§è¡Œå argsä¸º [foo, &apos;kevin&apos;, 18]
</code></pre><p>ä¸å®šé•¿çš„å‚æ•°é—®é¢˜è§£å†³äº†ï¼Œæˆ‘ä»¬æ¥ç€è¦æŠŠè¿™ä¸ªå‚æ•°æ•°ç»„æ”¾åˆ°è¦æ‰§è¡Œçš„å‡½æ•°çš„å‚æ•°é‡Œé¢å»ã€‚</p>
<pre><code>// å°†æ•°ç»„é‡Œçš„å…ƒç´ ä½œä¸ºå¤šä¸ªå‚æ•°æ”¾è¿›å‡½æ•°çš„å½¢å‚é‡Œ
context.fn(args.join(&apos;,&apos;))
// (O_o)??
// è¿™ä¸ªæ–¹æ³•è‚¯å®šæ˜¯ä¸è¡Œçš„å•¦ï¼ï¼ï¼
</code></pre><p>ä¹Ÿè®¸æœ‰äººæƒ³åˆ°ç”¨ ES6 çš„æ–¹æ³•ï¼Œä¸è¿‡ call æ˜¯ ES3 çš„æ–¹æ³•ï¼Œæˆ‘ä»¬ä¸ºäº†æ¨¡æ‹Ÿå®ç°ä¸€ä¸ª ES3 çš„æ–¹æ³•ï¼Œè¦ç”¨åˆ°ES6çš„æ–¹æ³•ï¼Œå¥½åƒâ€¦â€¦ï¼Œå—¯ï¼Œä¹Ÿå¯ä»¥å•¦ã€‚ä½†æ˜¯æˆ‘ä»¬è¿™æ¬¡ç”¨ eval æ–¹æ³•æ‹¼æˆä¸€ä¸ªå‡½æ•°ï¼Œç±»ä¼¼äºè¿™æ ·ï¼š</p>
<pre><code>eval(&apos;context.fn(&apos; + args +&apos;)&apos;)
</code></pre><p>è¿™é‡Œ args ä¼šè‡ªåŠ¨è°ƒç”¨ Array.toString() è¿™ä¸ªæ–¹æ³•ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬çš„ç¬¬äºŒç‰ˆå…‹æœäº†ä¸¤ä¸ªå¤§é—®é¢˜ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code>// ç¬¬äºŒç‰ˆ
Function.prototype.call2 = function(context) {
    context.fn = this;
    var args = [];
    for(var i = 1, len = arguments.length; i &lt; len; i++) {
        args.push(&apos;arguments[&apos; + i + &apos;]&apos;);
    }
    eval(&apos;context.fn(&apos; + args +&apos;)&apos;);
    delete context.fn;
}

// æµ‹è¯•ä¸€ä¸‹
var foo = {
    value: 1
};

function bar(name, age) {
    console.log(name)
    console.log(age)
    console.log(this.value);
}

bar.call2(foo, &apos;kevin&apos;, 18); 
// kevin
// 18
// 1
</code></pre><p>(à¹‘â€¢Ì€ã…‚â€¢Ì) âœ§</p>
<h2 id="æ¨¡æ‹Ÿå®ç°ç¬¬ä¸‰æ­¥"><a href="#æ¨¡æ‹Ÿå®ç°ç¬¬ä¸‰æ­¥" class="headerlink" title="æ¨¡æ‹Ÿå®ç°ç¬¬ä¸‰æ­¥"></a>æ¨¡æ‹Ÿå®ç°ç¬¬ä¸‰æ­¥</h2><p>æ¨¡æ‹Ÿä»£ç å·²ç»å®Œæˆ 80%ï¼Œè¿˜æœ‰ä¸¤ä¸ªå°ç‚¹è¦æ³¨æ„ï¼š</p>
<p>1.this å‚æ•°å¯ä»¥ä¼  nullï¼Œå½“ä¸º null çš„æ—¶å€™ï¼Œè§†ä¸ºæŒ‡å‘ window</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code>var value = 1;

function bar() {
    console.log(this.value);
}

bar.call(null); // 1
</code></pre><p>è™½ç„¶è¿™ä¸ªä¾‹å­æœ¬èº«ä¸ä½¿ç”¨ callï¼Œç»“æœä¾ç„¶ä¸€æ ·ã€‚</p>
<p>2.å‡½æ•°æ˜¯å¯ä»¥æœ‰è¿”å›å€¼çš„ï¼</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code>var obj = {
    value: 1
}

function bar(name, age) {
    return {
        value: this.value,
        name: name,
        age: age
    }
}

console.log(bar.call(obj, &apos;kevin&apos;, 18));
// Object {
//    value: 1,
//    name: &apos;kevin&apos;,
//    age: 18
// }
</code></pre><p>ä¸è¿‡éƒ½å¾ˆå¥½è§£å†³ï¼Œè®©æˆ‘ä»¬ç›´æ¥çœ‹ç¬¬ä¸‰ç‰ˆä¹Ÿå°±æ˜¯æœ€åä¸€ç‰ˆçš„ä»£ç ï¼š</p>
<pre><code>// ç¬¬ä¸‰ç‰ˆ
Function.prototype.call2 = function (context) {
    var context = context || window;
    context.fn = this;

    var args = [];
    for(var i = 1, len = arguments.length; i &lt; len; i++) {
        args.push(&apos;arguments[&apos; + i + &apos;]&apos;);
    }

    var result = eval(&apos;context.fn(&apos; + args +&apos;)&apos;);

    delete context.fn
    return result;
}

// æµ‹è¯•ä¸€ä¸‹
var value = 2;

var obj = {
    value: 1
}

function bar(name, age) {
    console.log(this.value);
    return {
        value: this.value,
        name: name,
        age: age
    }
}

bar.call(null); // 2

console.log(bar.call2(obj, &apos;kevin&apos;, 18));
// 1
// Object {
//    value: 1,
//    name: &apos;kevin&apos;,
//    age: 18
// }
</code></pre><p>åˆ°æ­¤ï¼Œæˆ‘ä»¬å®Œæˆäº† call çš„æ¨¡æ‹Ÿå®ç°ï¼Œç»™è‡ªå·±ä¸€ä¸ªèµ ï½‚ï¼ˆï¿£â–½ï¿£ï¼‰ï½„</p>
<h2 id="applyçš„æ¨¡æ‹Ÿå®ç°"><a href="#applyçš„æ¨¡æ‹Ÿå®ç°" class="headerlink" title="applyçš„æ¨¡æ‹Ÿå®ç°"></a>applyçš„æ¨¡æ‹Ÿå®ç°</h2><p>apply çš„å®ç°è·Ÿ call ç±»ä¼¼ï¼Œåœ¨è¿™é‡Œç›´æ¥ç»™ä»£ç ï¼Œä»£ç æ¥è‡ªäºçŸ¥ä¹ @éƒ‘èˆªçš„å®ç°ï¼š</p>
<pre><code>Function.prototype.apply = function (context, arr) {
    var context = Object(context) || window;
    context.fn = this;

    var result;
    if (!arr) {
        result = context.fn();
    }
    else {
        var args = [];
        for (var i = 0, len = arr.length; i &lt; len; i++) {
            args.push(&apos;arr[&apos; + i + &apos;]&apos;);
        }
        result = eval(&apos;context.fn(&apos; + args + &apos;)&apos;)
    }

    delete context.fn
    return result;
}
</code></pre><p><img src="https://pic1.zhimg.com/v2-23784bc5e0ab2bdcb4b879e5d28617c6_b.jpg" alt=""><img src="https://pic1.zhimg.com/80/v2-23784bc5e0ab2bdcb4b879e5d28617c6_hd.jpg" alt=""></p>
<p><img src="https://pic3.zhimg.com/v2-9374916fd3f03dab5836b9fc4057070a_b.jpg" alt=""><img src="https://pic3.zhimg.com/80/v2-9374916fd3f03dab5836b9fc4057070a_hd.jpg" alt=""></p>
<p><img src="https://pic3.zhimg.com/v2-7fe454d5cfd72880650f53a4f50c93cd_b.jpg" alt=""><img src="https://pic3.zhimg.com/80/v2-7fe454d5cfd72880650f53a4f50c93cd_hd.jpg" alt=""></p>
<p><img src="https://pic2.zhimg.com/v2-4f15656852b764a859194a3d7156ea99_b.jpg" alt=""><img src="https://pic2.zhimg.com/80/v2-4f15656852b764a859194a3d7156ea99_hd.jpg" alt=""></p>
<pre><code>ç±»æ•°ç»„è½¬å¯¹è±¡
åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­å·²ç»æåˆ°äº†ä¸€ç§ç±»æ•°ç»„è½¬æ•°ç»„çš„æ–¹æ³•ï¼Œå†è¡¥å……ä¸‰ä¸ªï¼š
var arrayLike = {0: &apos;name&apos;, 1: &apos;age&apos;, 2: &apos;sex&apos;, length: 3 }
// 1. slice
Array.prototype.slice.call(arrayLike); // [&quot;name&quot;, &quot;age&quot;, &quot;sex&quot;] 
// 2. splice
Array.prototype.splice.call(arrayLike, 0); // [&quot;name&quot;, &quot;age&quot;, &quot;sex&quot;] 
// 3. ES6 Array.from
Array.from(arrayLike); // [&quot;name&quot;, &quot;age&quot;, &quot;sex&quot;] 
// 4. apply
Array.prototype.concat.apply([], arrayLike)   




è¦è¯´åˆ°ç±»æ•°ç»„å¯¹è±¡ï¼ŒArguments å¯¹è±¡å°±æ˜¯ä¸€ä¸ªç±»æ•°ç»„å¯¹è±¡ã€‚
åœ¨å®¢æˆ·ç«¯ JavaScript ä¸­ï¼Œä¸€äº› DOM æ–¹æ³•(document.getElementsByTagName()ç­‰)ä¹Ÿè¿”å›ç±»æ•°ç»„å¯¹è±¡ã€‚


ä¼ é€’å‚æ•°
å°†å‚æ•°ä»ä¸€ä¸ªå‡½æ•°ä¼ é€’åˆ°å¦ä¸€ä¸ªå‡½æ•°
// ä½¿ç”¨ apply å°† foo çš„å‚æ•°ä¼ é€’ç»™ bar
function foo() {
    bar.apply(this, arguments);
}
function bar(a, b, c) {
   console.log(a, b, c);
}

foo(1, 2, 3)




å¼ºå¤§çš„ES6
ä½¿ç”¨ES6çš„ ... è¿ç®—ç¬¦ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾è½¬æˆæ•°ç»„ã€‚
function func(...arguments) {
    console.log(arguments); // [1, 2, 3]
}

func(1, 2, 3);
</code></pre><h2 id="bind"><a href="#bind" class="headerlink" title="bind"></a>bind</h2><p>ä¸€å¥è¯ä»‹ç» bind:</p>
<blockquote>
<p>bind() æ–¹æ³•ä¼šåˆ›å»ºä¸€ä¸ªæ–°å‡½æ•°ã€‚å½“è¿™ä¸ªæ–°å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œbind() çš„ç¬¬ä¸€ä¸ªå‚æ•°å°†ä½œä¸ºå®ƒè¿è¡Œæ—¶çš„ thisï¼Œä¹‹åçš„ä¸€åºåˆ—å‚æ•°å°†ä¼šåœ¨ä¼ é€’çš„å®å‚å‰ä¼ å…¥ä½œä¸ºå®ƒçš„å‚æ•°ã€‚(æ¥è‡ªäº MDN )</p>
</blockquote>
<p>ç”±æ­¤æˆ‘ä»¬å¯ä»¥é¦–å…ˆå¾—å‡º bind å‡½æ•°çš„ä¸¤ä¸ªç‰¹ç‚¹ï¼š</p>
<ol>
<li>è¿”å›ä¸€ä¸ªå‡½æ•°</li>
<li>å¯ä»¥ä¼ å…¥å‚æ•°</li>
</ol>
<h2 id="è¿”å›å‡½æ•°çš„æ¨¡æ‹Ÿå®ç°"><a href="#è¿”å›å‡½æ•°çš„æ¨¡æ‹Ÿå®ç°" class="headerlink" title="è¿”å›å‡½æ•°çš„æ¨¡æ‹Ÿå®ç°"></a>è¿”å›å‡½æ•°çš„æ¨¡æ‹Ÿå®ç°</h2><p>ä»ç¬¬ä¸€ä¸ªç‰¹ç‚¹å¼€å§‹ï¼Œæˆ‘ä»¬ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code>var foo = {
    value: 1
};

function bar() {
    console.log(this.value);
}

// è¿”å›äº†ä¸€ä¸ªå‡½æ•°
var bindFoo = bar.bind(foo); 

bindFoo(); // 1
</code></pre><p>å…³äºæŒ‡å®š this çš„æŒ‡å‘ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ call æˆ–è€… apply å®ç°ï¼Œå…³äº call å’Œ apply çš„æ¨¡æ‹Ÿå®ç°ï¼Œå¯ä»¥æŸ¥çœ‹<a href="https://link.zhihu.com/?target=https%3A//github.com/mqyqingfeng/Blog/issues/11" target="_blank" rel="noopener">ã€ŠJavaScriptæ·±å…¥ä¹‹callå’Œapplyçš„æ¨¡æ‹Ÿå®ç°ã€‹</a>ã€‚æˆ‘ä»¬æ¥å†™ç¬¬ä¸€ç‰ˆçš„ä»£ç ï¼š</p>
<pre><code>// ç¬¬ä¸€ç‰ˆ
Function.prototype.bind2 = function (context) {
    var self = this;
    return function () {
        self.apply(context);
    }

}
</code></pre><h2 id="ä¼ å‚çš„æ¨¡æ‹Ÿå®ç°"><a href="#ä¼ å‚çš„æ¨¡æ‹Ÿå®ç°" class="headerlink" title="ä¼ å‚çš„æ¨¡æ‹Ÿå®ç°"></a>ä¼ å‚çš„æ¨¡æ‹Ÿå®ç°</h2><p>æ¥ä¸‹æ¥çœ‹ç¬¬äºŒç‚¹ï¼Œå¯ä»¥ä¼ å…¥å‚æ•°ã€‚è¿™ä¸ªå°±æœ‰ç‚¹è®©äººè´¹è§£äº†ï¼Œæˆ‘åœ¨ bind çš„æ—¶å€™ï¼Œæ˜¯å¦å¯ä»¥ä¼ å‚å‘¢ï¼Ÿæˆ‘åœ¨æ‰§è¡Œ bind è¿”å›çš„å‡½æ•°çš„æ—¶å€™ï¼Œå¯ä¸å¯ä»¥ä¼ å‚å‘¢ï¼Ÿè®©æˆ‘ä»¬çœ‹ä¸ªä¾‹å­ï¼š</p>
<pre><code>var foo = {
    value: 1
};

function bar(name, age) {
    console.log(this.value);
    console.log(name);
    console.log(age);

}

var bindFoo = bar.bind(foo, &apos;daisy&apos;);
bindFoo(&apos;18&apos;);
// 1
// daisy
// 18
</code></pre><p>å‡½æ•°éœ€è¦ä¼  name å’Œ age ä¸¤ä¸ªå‚æ•°ï¼Œç«Ÿç„¶è¿˜å¯ä»¥åœ¨ bind çš„æ—¶å€™ï¼Œåªä¼ ä¸€ä¸ª nameï¼Œåœ¨æ‰§è¡Œè¿”å›çš„å‡½æ•°çš„æ—¶å€™ï¼Œå†ä¼ å¦ä¸€ä¸ªå‚æ•° age!</p>
<p>è¿™å¯å’‹åŠï¼Ÿä¸æ€¥ï¼Œæˆ‘ä»¬ç”¨ arguments è¿›è¡Œå¤„ç†ï¼š</p>
<pre><code>// ç¬¬äºŒç‰ˆ
Function.prototype.bind2 = function (context) {

    var self = this;
    // è·å–bind2å‡½æ•°ä»ç¬¬äºŒä¸ªå‚æ•°åˆ°æœ€åä¸€ä¸ªå‚æ•°
    var args = Array.prototype.slice.call(arguments, 1);

    return function () {
        // è¿™ä¸ªæ—¶å€™çš„argumentsæ˜¯æŒ‡bindè¿”å›çš„å‡½æ•°ä¼ å…¥çš„å‚æ•°
        var bindArgs = Array.prototype.slice.call(arguments);
        self.apply(context, args.concat(bindArgs));
    }

}
</code></pre><h2 id="æ„é€ å‡½æ•°æ•ˆæœçš„æ¨¡æ‹Ÿå®ç°"><a href="#æ„é€ å‡½æ•°æ•ˆæœçš„æ¨¡æ‹Ÿå®ç°" class="headerlink" title="æ„é€ å‡½æ•°æ•ˆæœçš„æ¨¡æ‹Ÿå®ç°"></a>æ„é€ å‡½æ•°æ•ˆæœçš„æ¨¡æ‹Ÿå®ç°</h2><p>å®Œæˆäº†è¿™ä¸¤ç‚¹ï¼Œæœ€éš¾çš„éƒ¨åˆ†åˆ°å•¦ï¼å› ä¸º bind è¿˜æœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼Œå°±æ˜¯</p>
<blockquote>
<p>ä¸€ä¸ªç»‘å®šå‡½æ•°ä¹Ÿèƒ½ä½¿ç”¨newæ“ä½œç¬¦åˆ›å»ºå¯¹è±¡ï¼šè¿™ç§è¡Œä¸ºå°±åƒæŠŠåŸå‡½æ•°å½“æˆæ„é€ å™¨ã€‚æä¾›çš„ this å€¼è¢«å¿½ç•¥ï¼ŒåŒæ—¶è°ƒç”¨æ—¶çš„å‚æ•°è¢«æä¾›ç»™æ¨¡æ‹Ÿå‡½æ•°ã€‚</p>
</blockquote>
<p>ä¹Ÿå°±æ˜¯è¯´å½“ bind è¿”å›çš„å‡½æ•°ä½œä¸ºæ„é€ å‡½æ•°çš„æ—¶å€™ï¼Œbind æ—¶æŒ‡å®šçš„ this å€¼ä¼šå¤±æ•ˆï¼Œä½†ä¼ å…¥çš„å‚æ•°ä¾ç„¶ç”Ÿæ•ˆã€‚ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code>var value = 2;

var foo = {
    value: 1
};

function bar(name, age) {
    this.habit = &apos;shopping&apos;;
    console.log(this.value);
    console.log(name);
    console.log(age);
}

bar.prototype.friend = &apos;kevin&apos;;

var bindFoo = bar.bind(foo, &apos;daisy&apos;);

var obj = new bindFoo(&apos;18&apos;);
// undefined
// daisy
// 18
console.log(obj.habit);
console.log(obj.friend);
// shopping
// kevin
</code></pre><p>æ³¨æ„ï¼šå°½ç®¡åœ¨å…¨å±€å’Œ foo ä¸­éƒ½å£°æ˜äº† value å€¼ï¼Œæœ€åä¾ç„¶è¿”å›äº† undefindï¼Œè¯´æ˜ç»‘å®šçš„ this å¤±æ•ˆäº†ï¼Œå¦‚æœå¤§å®¶äº†è§£ new çš„æ¨¡æ‹Ÿå®ç°ï¼Œå°±ä¼šçŸ¥é“è¿™ä¸ªæ—¶å€™çš„ this å·²ç»æŒ‡å‘äº† objã€‚</p>
<p>(å“ˆå“ˆï¼Œæˆ‘è¿™æ˜¯ä¸ºæˆ‘çš„ä¸‹ä¸€ç¯‡æ–‡ç« <a href="https://link.zhihu.com/?target=https%3A//github.com/mqyqingfeng/Blog/issues/13" target="_blank" rel="noopener">ã€ŠJavaScriptæ·±å…¥ç³»åˆ—ä¹‹newçš„æ¨¡æ‹Ÿå®ç°ã€‹</a>æ‰“å¹¿å‘Š)ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹è¿”å›çš„å‡½æ•°çš„åŸå‹æ¥å®ç°ï¼Œè®©æˆ‘ä»¬å†™ä¸€ä¸‹ï¼š</p>
<pre><code>// ç¬¬ä¸‰ç‰ˆ
Function.prototype.bind2 = function (context) {
    var self = this;
    var args = Array.prototype.slice.call(arguments, 1);

    var fBound = function () {
        var bindArgs = Array.prototype.slice.call(arguments);
        // å½“ä½œä¸ºæ„é€ å‡½æ•°æ—¶ï¼Œthis æŒ‡å‘å®ä¾‹ï¼Œæ­¤æ—¶ç»“æœä¸º trueï¼Œå°†ç»‘å®šå‡½æ•°çš„ this æŒ‡å‘è¯¥å®ä¾‹ï¼Œå¯ä»¥è®©å®ä¾‹è·å¾—æ¥è‡ªç»‘å®šå‡½æ•°çš„å€¼
        // ä»¥ä¸Šé¢çš„æ˜¯ demo ä¸ºä¾‹ï¼Œå¦‚æœæ”¹æˆ `this instanceof fBound ? null : context`ï¼Œå®ä¾‹åªæ˜¯ä¸€ä¸ªç©ºå¯¹è±¡ï¼Œå°† null æ”¹æˆ this ï¼Œå®ä¾‹ä¼šå…·æœ‰ habit å±æ€§
        // å½“ä½œä¸ºæ™®é€šå‡½æ•°æ—¶ï¼Œthis æŒ‡å‘ windowï¼Œæ­¤æ—¶ç»“æœä¸º falseï¼Œå°†ç»‘å®šå‡½æ•°çš„ this æŒ‡å‘ context
        self.apply(this instanceof fBound ? this : context, args.concat(bindArgs));
    }
    // ä¿®æ”¹è¿”å›å‡½æ•°çš„ prototype ä¸ºç»‘å®šå‡½æ•°çš„ prototypeï¼Œå®ä¾‹å°±å¯ä»¥ç»§æ‰¿ç»‘å®šå‡½æ•°çš„åŸå‹ä¸­çš„å€¼
    fBound.prototype = this.prototype;
    return fBound;
}
</code></pre><p>å¦‚æœå¯¹åŸå‹é“¾ç¨æœ‰å›°æƒ‘ï¼Œå¯ä»¥æŸ¥çœ‹<a href="https://link.zhihu.com/?target=https%3A//github.com/mqyqingfeng/Blog/issues/2" target="_blank" rel="noopener">ã€ŠJavaScriptæ·±å…¥ä¹‹ä»åŸå‹åˆ°åŸå‹é“¾ã€‹</a>ã€‚</p>
<h2 id="æ„é€ å‡½æ•°æ•ˆæœçš„ä¼˜åŒ–å®ç°"><a href="#æ„é€ å‡½æ•°æ•ˆæœçš„ä¼˜åŒ–å®ç°" class="headerlink" title="æ„é€ å‡½æ•°æ•ˆæœçš„ä¼˜åŒ–å®ç°"></a>æ„é€ å‡½æ•°æ•ˆæœçš„ä¼˜åŒ–å®ç°</h2><p>ä½†æ˜¯åœ¨è¿™ä¸ªå†™æ³•ä¸­ï¼Œæˆ‘ä»¬ç›´æ¥å°† fBound.prototype = this.prototypeï¼Œæˆ‘ä»¬ç›´æ¥ä¿®æ”¹ fBound.prototype çš„æ—¶å€™ï¼Œä¹Ÿä¼šç›´æ¥ä¿®æ”¹ç»‘å®šå‡½æ•°çš„ prototypeã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªç©ºå‡½æ•°æ¥è¿›è¡Œä¸­è½¬ï¼š</p>
<pre><code>// ç¬¬å››ç‰ˆ
Function.prototype.bind2 = function (context) {

    var self = this;
    var args = Array.prototype.slice.call(arguments, 1);

    var fNOP = function () {};

    var fBound = function () {
        var bindArgs = Array.prototype.slice.call(arguments);
        self.apply(this instanceof fNOP ? this : context, args.concat(bindArgs));
    }

    fNOP.prototype = this.prototype;
    fBound.prototype = new fNOP();
    return fBound;
}
</code></pre><p>åˆ°æ­¤ä¸ºæ­¢ï¼Œå¤§çš„é—®é¢˜éƒ½å·²ç»è§£å†³ï¼Œç»™è‡ªå·±ä¸€ä¸ªèµï¼o(ï¿£â–½ï¿£)ï½„</p>
<h2 id="ä¸‰ä¸ªå°é—®é¢˜"><a href="#ä¸‰ä¸ªå°é—®é¢˜" class="headerlink" title="ä¸‰ä¸ªå°é—®é¢˜"></a>ä¸‰ä¸ªå°é—®é¢˜</h2><p>æ¥ä¸‹æ¥å¤„ç†äº›å°é—®é¢˜:</p>
<p>1.apply è¿™æ®µä»£ç è·Ÿ MDN ä¸Šçš„ç¨æœ‰ä¸åŒ</p>
<p>åœ¨ MDN ä¸­æ–‡ç‰ˆè®² bind çš„æ¨¡æ‹Ÿå®ç°æ—¶ï¼Œapply è¿™é‡Œçš„ä»£ç æ˜¯ï¼š</p>
<pre><code>self.apply(this instanceof self ? this : context || this, args.concat(bindArgs))
</code></pre><p>å¤šäº†ä¸€ä¸ªå…³äº context æ˜¯å¦å­˜åœ¨çš„åˆ¤æ–­ï¼Œç„¶è€Œè¿™ä¸ªæ˜¯é”™è¯¯çš„ï¼</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code>var value = 2;
var foo = {
    value: 1,
    bar: bar.bind(null)
};

function bar() {
    console.log(this.value);
}

foo.bar() // 2
</code></pre><p>ä»¥ä¸Šä»£ç æ­£å¸¸æƒ…å†µä¸‹ä¼šæ‰“å° 2ï¼Œå¦‚æœæ¢æˆäº† context || thisï¼Œè¿™æ®µä»£ç å°±ä¼šæ‰“å° 1ï¼</p>
<p>æ‰€ä»¥è¿™é‡Œä¸åº”è¯¥è¿›è¡Œ context çš„åˆ¤æ–­ï¼Œå¤§å®¶æŸ¥çœ‹ MDN åŒæ ·å†…å®¹çš„è‹±æ–‡ç‰ˆï¼Œå°±ä¸å­˜åœ¨è¿™ä¸ªåˆ¤æ–­ï¼</p>
<p>2.è°ƒç”¨ bind çš„ä¸æ˜¯å‡½æ•°å’‹åŠï¼Ÿ</p>
<p>ä¸è¡Œï¼Œæˆ‘ä»¬è¦æŠ¥é”™ï¼</p>
<pre><code>if (typeof this !== &quot;function&quot;) {
  throw new Error(&quot;Function.prototype.bind - what is trying to be bound is not callable&quot;);
}
</code></pre><p>3.æˆ‘è¦åœ¨çº¿ä¸Šç”¨</p>
<p>é‚£åˆ«å¿˜äº†åšä¸ªå…¼å®¹ï¼š</p>
<pre><code>Function.prototype.bind = Function.prototype.bind || function () {
    â€¦â€¦
};
</code></pre><p>å½“ç„¶æœ€å¥½æ˜¯ç”¨ <a href="https://link.zhihu.com/?target=https%3A//github.com/es-shims/es5-shim" target="_blank" rel="noopener">es5-shim</a> å•¦ã€‚</p>
<h2 id="æœ€ç»ˆä»£ç "><a href="#æœ€ç»ˆä»£ç " class="headerlink" title="æœ€ç»ˆä»£ç "></a>æœ€ç»ˆä»£ç </h2><p>æ‰€ä»¥æœ€æœ€åçš„ä»£ç å°±æ˜¯ï¼š</p>
<pre><code>Function.prototype.bind2 = function (context) {

    if (typeof this !== &quot;function&quot;) {
      throw new Error(&quot;Function.prototype.bind - what is trying to be bound is not callable&quot;);
    }

    var self = this;
    var args = Array.prototype.slice.call(arguments, 1);

    var fNOP = function () {};

    var fBound = function () {
        var bindArgs = Array.prototype.slice.call(arguments);
        self.apply(this instanceof fNOP ? this : context, args.concat(bindArgs));
    }

    fNOP.prototype = this.prototype;
    fBound.prototype = new fNOP();
    return fBound;
}
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/20/Vueæ‰¹é‡å¼‚æ­¥æ›´æ–°ä¸nextTickåŸç†/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/20/Vueæ‰¹é‡å¼‚æ­¥æ›´æ–°ä¸nextTickåŸç†/" itemprop="url">Vueæ‰¹é‡å¼‚æ­¥æ›´æ–°ä¸nextTickåŸç†</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-08-20T13:13:34+08:00">
                2018-08-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ol>
<li>å¼‚æ­¥æ›´æ–°</li>
</ol>
<p>æˆ‘ä»¬åœ¨ä¾èµ–æ”¶é›†åŸç†çš„å“åº”å¼åŒ–æ–¹æ³• defineReactive ä¸­çš„ setter è®¿é—®å™¨ä¸­æœ‰æ´¾å‘æ›´æ–° dep.notify() æ–¹æ³•ã€‚</p>
<p>è¿™ä¸ªæ–¹æ³•ä¼šæŒ¨ä¸ªé€šçŸ¥åœ¨ dep çš„ subs ä¸­æ”¶é›†çš„è®¢é˜…è‡ªå·±å˜åŠ¨çš„watchersæ‰§è¡Œupdateã€‚</p>
<p>ä¸€èµ·æ¥çœ‹çœ‹ update æ–¹æ³•çš„å®ç°ï¼š</p>
<pre><code>// src/core/observer/watcher.js

/* Subscriberæ¥å£ï¼Œå½“ä¾èµ–å‘ç”Ÿæ”¹å˜çš„æ—¶å€™è¿›è¡Œå›è°ƒ */
update() {
  if (this.computed) {
    // ä¸€ä¸ªcomputed watcheræœ‰ä¸¤ç§æ¨¡å¼ï¼šactivated lazy(é»˜è®¤)
    // åªæœ‰å½“å®ƒè¢«è‡³å°‘ä¸€ä¸ªè®¢é˜…è€…ä¾èµ–æ—¶æ‰ç½®activatedï¼Œè¿™é€šå¸¸æ˜¯å¦ä¸€ä¸ªè®¡ç®—å±æ€§æˆ–ç»„ä»¶çš„render function
    if (this.dep.subs.length === 0) {       // å¦‚æœæ²¡äººè®¢é˜…è¿™ä¸ªè®¡ç®—å±æ€§çš„å˜åŒ–
      // lazyæ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›å®ƒåªåœ¨å¿…è¦æ—¶æ‰§è¡Œè®¡ç®—ï¼Œæ‰€ä»¥æˆ‘ä»¬åªæ˜¯ç®€å•åœ°å°†è§‚å¯Ÿè€…æ ‡è®°ä¸ºdirty
      // å½“è®¡ç®—å±æ€§è¢«è®¿é—®æ—¶ï¼Œå®é™…çš„è®¡ç®—åœ¨this.evaluate()ä¸­æ‰§è¡Œ
      this.dirty = true
    } else {
      // activatedæ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›ä¸»åŠ¨æ‰§è¡Œè®¡ç®—ï¼Œä½†åªæœ‰å½“å€¼ç¡®å®å‘ç”Ÿå˜åŒ–æ—¶æ‰é€šçŸ¥æˆ‘ä»¬çš„è®¢é˜…è€…
      this.getAndInvoke(() =&gt; {
        this.dep.notify()     // é€šçŸ¥æ¸²æŸ“watcheré‡æ–°æ¸²æŸ“ï¼Œé€šçŸ¥ä¾èµ–è‡ªå·±çš„æ‰€æœ‰watcheræ‰§è¡Œupdate
      })
    }
  } else if (this.sync) {      // åŒæ­¥
    this.run()
  } else {
    queueWatcher(this)        // å¼‚æ­¥æ¨é€åˆ°è°ƒåº¦è€…è§‚å¯Ÿè€…é˜Ÿåˆ—ä¸­ï¼Œä¸‹ä¸€ä¸ªtickæ—¶è°ƒç”¨
  }
}
</code></pre><p>å¦‚æœä¸æ˜¯ computed watcher ä¹Ÿé sync ä¼šæŠŠè°ƒç”¨updateçš„å½“å‰watcheræ¨é€åˆ°è°ƒåº¦è€…é˜Ÿåˆ—ä¸­ï¼Œä¸‹ä¸€ä¸ªtickæ—¶è°ƒç”¨ï¼Œçœ‹çœ‹ queueWatcher ï¼š</p>
<pre><code>// src/core/observer/scheduler.js

/* å°†ä¸€ä¸ªè§‚å¯Ÿè€…å¯¹è±¡pushè¿›è§‚å¯Ÿè€…é˜Ÿåˆ—ï¼Œåœ¨é˜Ÿåˆ—ä¸­å·²ç»å­˜åœ¨ç›¸åŒçš„idåˆ™
 * è¯¥watcherå°†è¢«è·³è¿‡ï¼Œé™¤éå®ƒæ˜¯åœ¨é˜Ÿåˆ—æ­£è¢«flushæ—¶æ¨é€
 */
export function queueWatcher (watcher: Watcher) {
  const id = watcher.id
  if (has[id] == null) {     // æ£€éªŒidæ˜¯å¦å­˜åœ¨ï¼Œå·²ç»å­˜åœ¨åˆ™ç›´æ¥è·³è¿‡ï¼Œä¸å­˜åœ¨åˆ™æ ‡è®°å“ˆå¸Œè¡¨hasï¼Œç”¨äºä¸‹æ¬¡æ£€éªŒ
    has[id] = true
    queue.push(watcher)      // å¦‚æœæ²¡æœ‰æ­£åœ¨flushï¼Œç›´æ¥pushåˆ°é˜Ÿåˆ—ä¸­
    if (!waiting) {          // æ ‡è®°æ˜¯å¦å·²ä¼ ç»™nextTick
      waiting = true
      nextTick(flushSchedulerQueue)
    }
  }
}

/* é‡ç½®è°ƒåº¦è€…çŠ¶æ€ */
function resetSchedulerState () {
  queue.length = 0
  has = {}
  waiting = false
}
</code></pre><p>è¿™é‡Œä½¿ç”¨äº†ä¸€ä¸ª has çš„å“ˆå¸Œmapç”¨æ¥æ£€æŸ¥æ˜¯å¦å½“å‰watcherçš„idæ˜¯å¦å­˜åœ¨ï¼Œè‹¥å·²å­˜åœ¨åˆ™è·³è¿‡ã€‚</p>
<p>ä¸å­˜åœ¨åˆ™å°±pushåˆ° queue é˜Ÿåˆ—ä¸­å¹¶æ ‡è®°å“ˆå¸Œè¡¨hasï¼Œç”¨äºä¸‹æ¬¡æ£€éªŒï¼Œé˜²æ­¢é‡å¤æ·»åŠ ã€‚</p>
<p>è¿™å°±æ˜¯ä¸€ä¸ªå»é‡çš„è¿‡ç¨‹ï¼Œæ¯”æ¯æ¬¡æŸ¥é‡éƒ½è¦å»queueä¸­æ‰¾è¦æ–‡æ˜ï¼Œåœ¨æ¸²æŸ“çš„æ—¶å€™å°±ä¸ä¼šé‡å¤ patch ç›¸åŒwatcherçš„å˜åŒ–ã€‚</p>
<p>è¿™æ ·å°±ç®—åŒæ­¥ä¿®æ”¹äº†ä¸€ç™¾æ¬¡è§†å›¾ä¸­ç”¨åˆ°çš„dataï¼Œå¼‚æ­¥ patch çš„æ—¶å€™ä¹Ÿåªä¼šæ›´æ–°æœ€åä¸€æ¬¡ä¿®æ”¹ã€‚</p>
<p>è¿™é‡Œçš„ waiting æ–¹æ³•æ˜¯ç”¨æ¥æ ‡è®° flushSchedulerQueue æ˜¯å¦å·²ç»ä¼ é€’ç»™ nextTick çš„æ ‡è®°ä½ã€‚</p>
<p>å¦‚æœå·²ç»ä¼ é€’åˆ™åªpushåˆ°é˜Ÿåˆ—ä¸­ä¸ä¼ é€’ flushSchedulerQueue ç»™ nextTickã€‚</p>
<p>ç­‰åˆ° resetSchedulerState é‡ç½®è°ƒåº¦è€…çŠ¶æ€çš„æ—¶å€™ waiting ä¼šè¢«ç½®å› false å…è®¸ flushSchedulerQueue è¢«ä¼ é€’ç»™ä¸‹ä¸€ä¸ªtickçš„å›è°ƒã€‚</p>
<p>æ€»ä¹‹ä¿è¯äº† flushSchedulerQueue å›è°ƒåœ¨ä¸€ä¸ªtickå†…åªå…è®¸è¢«ä¼ å…¥ä¸€æ¬¡ã€‚</p>
<p>æ¥çœ‹çœ‹è¢«ä¼ é€’ç»™ nextTick çš„å›è°ƒ flushSchedulerQueue åšäº†ä»€ä¹ˆï¼š</p>
<pre><code>// src/core/observer/scheduler.js

/* nextTickçš„å›è°ƒå‡½æ•°ï¼Œåœ¨ä¸‹ä¸€ä¸ªtickæ—¶flushæ‰ä¸¤ä¸ªé˜Ÿåˆ—åŒæ—¶è¿è¡Œwatchers */
function flushSchedulerQueue () {
  flushing = true
  let watcher, id

  queue.sort((a, b) =&gt; a.id - b.id)                    // æ’åº

  for (index = 0; index &lt; queue.length; index++) {     // ä¸è¦å°†lengthè¿›è¡Œç¼“å­˜
    watcher = queue[index]
    if (watcher.before) {         // å¦‚æœwatcheræœ‰beforeåˆ™æ‰§è¡Œ
      watcher.before()
    }
    id = watcher.id
    has[id] = null                // å°†hasçš„æ ‡è®°åˆ é™¤
    watcher.run()                 // æ‰§è¡Œwatcher
    if (process.env.NODE_ENV !== &apos;production&apos; &amp;&amp; has[id] != null) {  // åœ¨devç¯å¢ƒä¸‹æ£€æŸ¥æ˜¯å¦è¿›å…¥æ­»å¾ªç¯
      circular[id] = (circular[id] || 0) + 1     // æ¯”å¦‚user watcherè®¢é˜…è‡ªå·±çš„æƒ…å†µ
      if (circular[id] &gt; MAX_UPDATE_COUNT) {     // æŒç»­æ‰§è¡Œäº†ä¸€ç™¾æ¬¡watchä»£è¡¨å¯èƒ½å­˜åœ¨æ­»å¾ªç¯
        warn()                                  // è¿›å…¥æ­»å¾ªç¯çš„è­¦å‘Š
        break
      }
    }
  }
  resetSchedulerState()           // é‡ç½®è°ƒåº¦è€…çŠ¶æ€
  callActivatedHooks()            // ä½¿å­ç»„ä»¶çŠ¶æ€éƒ½ç½®æˆactiveåŒæ—¶è°ƒç”¨activatedé’©å­
  callUpdatedHooks()              // è°ƒç”¨updatedé’©å­
}
</code></pre><p>åœ¨ nextTick æ–¹æ³•ä¸­æ‰§è¡Œ flushSchedulerQueue æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æŒ¨ä¸ªæ‰§è¡Œ queue ä¸­çš„watcherçš„ run æ–¹æ³•ã€‚</p>
<p>æˆ‘ä»¬çœ‹åˆ°åœ¨é¦–å…ˆæœ‰ä¸ª queue.sort() æ–¹æ³•æŠŠé˜Ÿåˆ—ä¸­çš„watcheræŒ‰idä»å°åˆ°å¤§æ’äº†ä¸ªåºï¼Œè¿™æ ·åšå¯ä»¥ä¿è¯ï¼š</p>
<ol>
<li><p>ç»„ä»¶æ›´æ–°çš„é¡ºåºæ˜¯ä»çˆ¶ç»„ä»¶åˆ°å­ç»„ä»¶çš„é¡ºåºï¼Œå› ä¸ºçˆ¶ç»„ä»¶æ€»æ˜¯æ¯”å­ç»„ä»¶å…ˆåˆ›å»ºã€‚</p>
</li>
<li><p>ä¸€ä¸ªç»„ä»¶çš„user watchers(ä¾¦å¬å™¨watcher)æ¯”render watcherå…ˆè¿è¡Œï¼Œå› ä¸ºuser watcherså¾€å¾€æ¯”render watcheræ›´æ—©åˆ›å»º</p>
</li>
<li><p>å¦‚æœä¸€ä¸ªç»„ä»¶åœ¨çˆ¶ç»„ä»¶watcherè¿è¡ŒæœŸé—´è¢«é”€æ¯ï¼Œå®ƒçš„watcheræ‰§è¡Œå°†è¢«è·³è¿‡</p>
</li>
</ol>
<p>åœ¨æŒ¨ä¸ªæ‰§è¡Œé˜Ÿåˆ—ä¸­çš„forå¾ªç¯ä¸­ï¼Œindex &lt; queue.length è¿™é‡Œæ²¡æœ‰å°†lengthè¿›è¡Œç¼“å­˜ã€‚</p>
<p>å› ä¸ºåœ¨æ‰§è¡Œå¤„ç†ç°æœ‰watcherå¯¹è±¡æœŸé—´ï¼Œæ›´å¤šçš„watcherå¯¹è±¡å¯èƒ½ä¼šè¢«pushè¿›queueã€‚</p>
<p>é‚£ä¹ˆæ•°æ®çš„ä¿®æ”¹ä»modelå±‚åæ˜ åˆ°viewçš„è¿‡ç¨‹ï¼šæ•°æ®æ›´æ”¹ -&gt; setter -&gt; Dep -&gt; Watcher -&gt; nextTick -&gt; patch -&gt; æ›´æ–°è§†å›¾</p>
<ol start="2">
<li>nextTickåŸç†</li>
</ol>
<p><strong>2.1 å®ä»»åŠ¡/å¾®ä»»åŠ¡</strong></p>
<p>è¿™é‡Œå°±æ¥çœ‹çœ‹åŒ…å«ç€æ¯ä¸ªwatcheræ‰§è¡Œçš„æ–¹æ³•è¢«ä½œä¸ºå›è°ƒä¼ å…¥ nextTick ä¹‹åï¼ŒnextTick å¯¹è¿™ä¸ªæ–¹æ³•åšäº†ä»€ä¹ˆã€‚</p>
<p>ä¸è¿‡é¦–å…ˆè¦äº†è§£ä¸€ä¸‹æµè§ˆå™¨ä¸­çš„ EventLoopã€macro taskã€micro taskå‡ ä¸ªæ¦‚å¿µã€‚</p>
<p>ä¸äº†è§£å¯ä»¥å‚è€ƒä¸€ä¸‹ JSä¸Node.jsä¸­çš„äº‹ä»¶å¾ªç¯ è¿™ç¯‡æ–‡ç« ï¼Œè¿™é‡Œå°±ç”¨ä¸€å¼ å›¾æ¥è¡¨æ˜ä¸€ä¸‹åä¸¤è€…åœ¨ä¸»çº¿ç¨‹ä¸­çš„æ‰§è¡Œå…³ç³»ï¼š</p>
<p><img src="/2018/08/20/Vueæ‰¹é‡å¼‚æ­¥æ›´æ–°ä¸nextTickåŸç†/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt=""></p>
<p>è§£é‡Šä¸€ä¸‹ï¼Œå½“ä¸»çº¿ç¨‹æ‰§è¡Œå®ŒåŒæ­¥ä»»åŠ¡åï¼š</p>
<ol>
<li><p>å¼•æ“é¦–å…ˆä»macrotask queueä¸­å–å‡ºç¬¬ä¸€ä¸ªä»»åŠ¡ï¼Œæ‰§è¡Œå®Œæ¯•åï¼Œå°†microtask queueä¸­çš„æ‰€æœ‰ä»»åŠ¡å–å‡ºï¼ŒæŒ‰é¡ºåºå…¨éƒ¨æ‰§è¡Œï¼›</p>
</li>
<li><p>ç„¶åå†ä»macrotask queueä¸­å–ä¸‹ä¸€ä¸ªï¼Œæ‰§è¡Œå®Œæ¯•åï¼Œå†æ¬¡å°†microtask queueä¸­çš„å…¨éƒ¨å–å‡ºï¼›</p>
</li>
<li><p>å¾ªç¯å¾€å¤ï¼Œç›´åˆ°ä¸¤ä¸ªqueueä¸­çš„ä»»åŠ¡éƒ½å–å®Œã€‚</p>
</li>
</ol>
<p>æµè§ˆå™¨ç¯å¢ƒä¸­å¸¸è§çš„å¼‚æ­¥ä»»åŠ¡ç§ç±»ï¼ŒæŒ‰ç…§ä¼˜å…ˆçº§ï¼š</p>
<ul>
<li>macro task ï¼š</li>
</ul>
<p>åŒæ­¥ä»£ç ã€setImmediateã€MessageChannelã€setTimeout/setInterval</p>
<ul>
<li>micro taskï¼š</li>
</ul>
<p>Promise.thenã€MutationObserver</p>
<p>æœ‰çš„æ–‡ç« æŠŠ micro task å«å¾®ä»»åŠ¡ï¼Œmacro task å«å®ä»»åŠ¡ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªå•è¯æ‹¼å†™å¤ªåƒäº† -ã€‚- ï¼Œæ‰€ä»¥åé¢çš„æ³¨é‡Šå¤šç”¨ä¸­æ–‡è¡¨ç¤º~</p>
<p>å…ˆæ¥çœ‹çœ‹æºç ä¸­å¯¹micro taskä¸macro task çš„å®ç°ï¼š macroTimerFuncã€microTimerFunc</p>
<pre><code>// src/core/util/next-tick.js

const callbacks = []     // å­˜æ”¾å¼‚æ­¥æ‰§è¡Œçš„å›è°ƒ
let pending = false      // ä¸€ä¸ªæ ‡è®°ä½ï¼Œå¦‚æœå·²ç»æœ‰timerFuncè¢«æ¨é€åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­å»åˆ™ä¸éœ€è¦é‡å¤æ¨é€

/* æŒ¨ä¸ªåŒæ­¥æ‰§è¡Œcallbacksä¸­å›è°ƒ */
function flushCallbacks() {
  pending = false
  const copies = callbacks.slice(0)
  callbacks.length = 0
  for (let i = 0; i &lt; copies.length; i++) {
    copies[i]()
  }
}

let microTimerFunc        // å¾®ä»»åŠ¡æ‰§è¡Œæ–¹æ³•
let macroTimerFunc        // å®ä»»åŠ¡æ‰§è¡Œæ–¹æ³•
let useMacroTask = false  // æ˜¯å¦å¼ºåˆ¶ä¸ºå®ä»»åŠ¡ï¼Œé»˜è®¤ä½¿ç”¨å¾®ä»»åŠ¡

// å®ä»»åŠ¡
if (typeof setImmediate !== &apos;undefined&apos; &amp;&amp; isNative(setImmediate)) {
  macroTimerFunc = () =&gt; {
    setImmediate(flushCallbacks)
  }
} else if (typeof MessageChannel !== &apos;undefined&apos; &amp;&amp; (
  isNative(MessageChannel) ||
  MessageChannel.toString() === &apos;[object MessageChannelConstructor]&apos;  // PhantomJS
)) {
  const channel = new MessageChannel()
  const port = channel.port2
  channel.port1.onmessage = flushCallbacks
  macroTimerFunc = () =&gt; {
    port.postMessage(1)
  }
} else {
  macroTimerFunc = () =&gt; {
    setTimeout(flushCallbacks, 0)
  }
}

// å¾®ä»»åŠ¡
if (typeof Promise !== &apos;undefined&apos; &amp;&amp; isNative(Promise)) {
  const p = Promise.resolve()
  microTimerFunc = () =&gt; {
    p.then(flushCallbacks)
  }
} else {
  microTimerFunc = macroTimerFunc      // fallback to macro
}
</code></pre><p>flushCallbacks è¿™ä¸ªæ–¹æ³•å°±æ˜¯æŒ¨ä¸ªåŒæ­¥çš„å»æ‰§è¡Œcallbacksä¸­çš„å›è°ƒå‡½æ•°ä»¬ï¼Œcallbacksä¸­çš„å›è°ƒå‡½æ•°æ˜¯åœ¨è°ƒç”¨ nextTick çš„æ—¶å€™æ·»åŠ è¿›å»çš„ï¼›</p>
<p>é‚£ä¹ˆæ€ä¹ˆå»ä½¿ç”¨ micro task ä¸ macro task å»æ‰§è¡Œ flushCallbacks å‘¢ã€‚</p>
<p>è¿™é‡Œä»–ä»¬çš„å®ç° macroTimerFuncã€microTimerFunc ä½¿ç”¨æµè§ˆå™¨ä¸­å®ä»»åŠ¡/å¾®ä»»åŠ¡çš„APIå¯¹flushCallbacks æ–¹æ³•è¿›è¡Œäº†ä¸€å±‚åŒ…è£…ã€‚</p>
<p>æ¯”å¦‚å®ä»»åŠ¡æ–¹æ³• macroTimerFunc=()=&gt;{ setImmediate(flushCallbacks) }ï¼Œè¿™æ ·åœ¨è§¦å‘å®ä»»åŠ¡æ‰§è¡Œçš„æ—¶å€™ macroTimerFunc() å°±å¯ä»¥åœ¨æµè§ˆå™¨ä¸­çš„ä¸‹ä¸€ä¸ªå®ä»»åŠ¡loopçš„æ—¶å€™æ¶ˆè´¹è¿™äº›ä¿å­˜åœ¨callbacksæ•°ç»„ä¸­çš„å›è°ƒäº†ï¼Œå¾®ä»»åŠ¡åŒç†ã€‚</p>
<p>åŒæ—¶ä¹Ÿå¯ä»¥çœ‹å‡ºä¼ ç»™ nextTick çš„å¼‚æ­¥å›è°ƒå‡½æ•°æ˜¯è¢«å‹æˆäº†ä¸€ä¸ªåŒæ­¥ä»»åŠ¡åœ¨ä¸€ä¸ªtickæ‰§è¡Œå®Œçš„ï¼Œè€Œä¸æ˜¯å¼€å¯å¤šä¸ªå¼‚æ­¥ä»»åŠ¡ã€‚</p>
<p>æ³¨æ„è¿™é‡Œæœ‰ä¸ªæ¯”è¾ƒéš¾ç†è§£çš„åœ°æ–¹ï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨ nextTick çš„æ—¶å€™ pending ä¸ºfalseã€‚</p>
<p>æ­¤æ—¶å·²ç»pushåˆ°æµè§ˆå™¨event loopä¸­ä¸€ä¸ªå®ä»»åŠ¡æˆ–å¾®ä»»åŠ¡çš„taskï¼Œå¦‚æœåœ¨æ²¡æœ‰flushæ‰çš„æƒ…å†µä¸‹ç»§ç»­å¾€callbacksé‡Œé¢æ·»åŠ ã€‚</p>
<p>é‚£ä¹ˆåœ¨æ‰§è¡Œè¿™ä¸ªå ä½queueçš„æ—¶å€™ä¼šæ‰§è¡Œä¹‹åæ·»åŠ çš„å›è°ƒï¼Œæ‰€ä»¥ macroTimerFuncã€microTimerFunc ç›¸å½“äºtask queueçš„å ä½ã€‚</p>
<p>ä»¥å pending ä¸ºtrueåˆ™ç»§ç»­å¾€å ä½queueé‡Œé¢æ·»åŠ ï¼Œevent loopè½®åˆ°è¿™ä¸ªtask queueçš„æ—¶å€™å°†ä¸€å¹¶æ‰§è¡Œã€‚</p>
<p>æ‰§è¡Œ flushCallbacks æ—¶ pending ç½®falseï¼Œå…è®¸ä¸‹ä¸€è½®æ‰§è¡Œ nextTick æ—¶å¾€event loopå ä½ã€‚</p>
<p>å¯ä»¥çœ‹åˆ°ä¸Šé¢ macroTimerFunc ä¸ microTimerFunc è¿›è¡Œäº†åœ¨ä¸åŒæµè§ˆå™¨å…¼å®¹æ€§ä¸‹çš„å¹³ç¨³é€€åŒ–ï¼Œæˆ–è€…è¯´é™çº§ç­–ç•¥ï¼š</p>
<p>1ã€macroTimerFunc ï¼š</p>
<p>setImmediate -&gt; MessageChannel -&gt; setTimeoutã€‚</p>
<p>é¦–å…ˆæ£€æµ‹æ˜¯å¦åŸç”Ÿæ”¯æŒ setImmediateï¼Œè¿™ä¸ªæ–¹æ³•åªåœ¨ IEã€Edge æµè§ˆå™¨ä¸­åŸç”Ÿå®ç°ã€‚</p>
<p>ç„¶åæ£€æµ‹æ˜¯å¦æ”¯æŒ MessageChannelï¼Œå¦‚æœå¯¹ MessageChannel ä¸äº†è§£å¯ä»¥å‚è€ƒä¸€ä¸‹è¿™ç¯‡æ–‡ç« ã€‚è¿˜ä¸æ”¯æŒçš„è¯æœ€åä½¿ç”¨setTimeoutï¼›</p>
<p>ä¸ºä»€ä¹ˆä¼˜å…ˆä½¿ç”¨ setImmediate ä¸ MessageChannel è€Œä¸ç›´æ¥ä½¿ç”¨ setTimeout å‘¢ã€‚</p>
<p>æ˜¯å› ä¸ºHTML5è§„å®šsetTimeoutæ‰§è¡Œçš„æœ€å°å»¶æ—¶ä¸º4msï¼Œè€ŒåµŒå¥—çš„timeoutè¡¨ç°ä¸º10msã€‚</p>
<p>ä¸ºäº†å°½å¯èƒ½å¿«çš„è®©å›è°ƒæ‰§è¡Œï¼Œæ²¡æœ‰æœ€å°å»¶æ—¶é™åˆ¶çš„å‰ä¸¤è€…æ˜¾ç„¶è¦ä¼˜äº setTimeoutã€‚</p>
<p>2ã€microTimerFuncï¼š</p>
<p>Promise.then -&gt; macroTimerFunc ã€‚</p>
<p>é¦–å…ˆæ£€æŸ¥æ˜¯å¦æ”¯æŒ Promiseï¼Œå¦‚æœæ”¯æŒçš„è¯é€šè¿‡ Promise.then æ¥è°ƒç”¨ flushCallbacks æ–¹æ³•ã€‚</p>
<p>å¦åˆ™é€€åŒ–ä¸º macroTimerFunc ï¼›</p>
<p>vue2.5ä¹‹å nextTick ä¸­å› ä¸ºå…¼å®¹æ€§åŸå› åˆ é™¤äº†å¾®ä»»åŠ¡å¹³ç¨³é€€åŒ–çš„ MutationObserver çš„æ–¹å¼ã€‚</p>
<p><strong>2.2 nextTickå®ç°</strong></p>
<p>æœ€åæ¥çœ‹çœ‹æˆ‘ä»¬å¹³å¸¸ç”¨åˆ°çš„ nextTick æ–¹æ³•åˆ°åº•æ˜¯å¦‚ä½•å®ç°çš„ï¼š</p>
<pre><code>// src/core/util/next-tick.js

export function nextTick(cb?: Function, ctx?: Object) {
  let _resolve
  callbacks.push(() =&gt; {
    if (cb) {
      try {
        cb.call(ctx)
      } catch (e) {
        handleError(e, ctx, &apos;nextTick&apos;)
      }
    } else if (_resolve) {
      _resolve(ctx)
    }
  })
  if (!pending) {
    pending = true
    if (useMacroTask) {
      macroTimerFunc()
    } else {
      microTimerFunc()
    }
  }
  if (!cb &amp;&amp; typeof Promise !== &apos;undefined&apos;) {
    return new Promise(resolve =&gt; {
      _resolve = resolve
    })
  }
}

/* å¼ºåˆ¶ä½¿ç”¨macrotaskçš„æ–¹æ³• */
export function withMacroTask(fn: Function): Function {
  return fn._withTask || (fn._withTask = function() {
    useMacroTask = true
    const res = fn.apply(null, arguments)
    useMacroTask = false
    return res
  })
}
</code></pre><p>nextTick åœ¨è¿™é‡Œåˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹ä¸€ä¸‹ï¼›</p>
<p>1ã€é¦–å…ˆ nextTick æŠŠä¼ å…¥çš„ cb å›è°ƒå‡½æ•°ç”¨ try-catch åŒ…è£¹åæ”¾åœ¨ä¸€ä¸ªåŒ¿åå‡½æ•°ä¸­æ¨å…¥callbacksæ•°ç»„ä¸­ã€‚</p>
<p>è¿™ä¹ˆåšæ˜¯å› ä¸ºé˜²æ­¢å•ä¸ª cb å¦‚æœæ‰§è¡Œé”™è¯¯ä¸è‡³äºè®©æ•´ä¸ªJSçº¿ç¨‹æŒ‚æ‰ã€‚</p>
<p>æ¯ä¸ª cb éƒ½åŒ…è£¹æ˜¯é˜²æ­¢è¿™äº›å›è°ƒå‡½æ•°å¦‚æœæ‰§è¡Œé”™è¯¯ä¸ä¼šç›¸äº’å½±å“ï¼Œæ¯”å¦‚å‰ä¸€ä¸ªæŠ›é”™äº†åä¸€ä¸ªä»ç„¶å¯ä»¥æ‰§è¡Œã€‚</p>
<p>2ã€ç„¶åæ£€æŸ¥ pending çŠ¶æ€ï¼Œè¿™ä¸ªè·Ÿä¹‹å‰ä»‹ç»çš„ queueWatcher ä¸­çš„ waiting æ˜¯ä¸€ä¸ªæ„æ€ã€‚</p>
<p>å®ƒæ˜¯ä¸€ä¸ªæ ‡è®°ä½ï¼Œä¸€å¼€å§‹æ˜¯ false åœ¨è¿›å…¥</p>
<p>macroTimerFuncã€microTimerFuncæ–¹æ³•å‰è¢«ç½®ä¸º trueã€‚</p>
<p>å› æ­¤ä¸‹æ¬¡è°ƒç”¨ nextTick å°±ä¸ä¼šè¿›å…¥</p>
<p>macroTimerFuncã€microTimerFuncæ–¹æ³•ã€‚</p>
<p>è¿™ä¸¤ä¸ªæ–¹æ³•ä¸­ä¼šåœ¨ä¸‹ä¸€ä¸ª macro/micro tick æ—¶å€™ flushCallbacks å¼‚æ­¥çš„å»æ‰§è¡Œcallbacksé˜Ÿåˆ—ä¸­æ”¶é›†çš„ä»»åŠ¡ï¼Œè€Œ flushCallbacks æ–¹æ³•åœ¨æ‰§è¡Œä¸€å¼€å§‹ä¼šæŠŠ pending ç½® falseã€‚</p>
<p>å› æ­¤ä¸‹ä¸€æ¬¡è°ƒç”¨ nextTick æ—¶å€™åˆèƒ½å¼€å¯æ–°ä¸€è½®çš„ macroTimerFuncã€microTimerFuncï¼Œè¿™æ ·å°±å½¢æˆäº†vueä¸­çš„ event loopã€‚</p>
<p>3ã€æœ€åæ£€æŸ¥æ˜¯å¦ä¼ å…¥äº† cbã€‚</p>
<p>å› ä¸º nextTick è¿˜æ”¯æŒPromiseåŒ–çš„è°ƒç”¨ï¼šnextTick().then(() =&gt; {})ã€‚</p>
<p>æ‰€ä»¥å¦‚æœæ²¡æœ‰ä¼ å…¥ cb å°±ç›´æ¥returnäº†ä¸€ä¸ªPromiseå®ä¾‹ï¼Œå¹¶ä¸”æŠŠresolveä¼ é€’ç»™_resolveã€‚</p>
<p>è¿™æ ·åè€…æ‰§è¡Œçš„æ—¶å€™å°±è·³åˆ°æˆ‘ä»¬è°ƒç”¨çš„æ—¶å€™ä¼ é€’è¿› then çš„æ–¹æ³•ä¸­ã€‚</p>
<p>Vueæºç ä¸­ next-tick.js æ–‡ä»¶è¿˜æœ‰ä¸€æ®µé‡è¦çš„æ³¨é‡Šï¼Œè¿™é‡Œå°±ç¿»è¯‘ä¸€ä¸‹ï¼š</p>
<p>åœ¨vue2.5ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼ŒnextTickåŸºæœ¬ä¸ŠåŸºäº micro task æ¥å®ç°çš„ã€‚</p>
<p>ä½†æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹ micro task å…·æœ‰å¤ªé«˜çš„ä¼˜å…ˆçº§ï¼Œå¹¶ä¸”å¯èƒ½åœ¨è¿ç»­é¡ºåºäº‹ä»¶ä¹‹é—´ï¼ˆä¾‹å¦‚ï¼ƒ4521ï¼Œï¼ƒ6690ï¼‰æˆ–è€…ç”šè‡³åœ¨åŒä¸€äº‹ä»¶çš„äº‹ä»¶å†’æ³¡è¿‡ç¨‹ä¸­ä¹‹é—´è§¦å‘ï¼ˆï¼ƒ6566ï¼‰ã€‚</p>
<p>ä½†æ˜¯å¦‚æœå…¨éƒ¨éƒ½æ”¹æˆ macro taskï¼Œå¯¹ä¸€äº›æœ‰é‡ç»˜å’ŒåŠ¨ç”»çš„åœºæ™¯ä¹Ÿä¼šæœ‰æ€§èƒ½å½±å“ï¼Œå¦‚ issue #6813ã€‚</p>
<p>vue2.5ä¹‹åç‰ˆæœ¬æä¾›çš„è§£å†³åŠæ³•æ˜¯é»˜è®¤ä½¿ç”¨ micro taskï¼Œä½†åœ¨éœ€è¦æ—¶ï¼ˆä¾‹å¦‚åœ¨v-oné™„åŠ çš„äº‹ä»¶å¤„ç†ç¨‹åºä¸­ï¼‰å¼ºåˆ¶ä½¿ç”¨ macro taskã€‚</p>
<p>ä¸ºä»€ä¹ˆé»˜è®¤ä¼˜å…ˆä½¿ç”¨ micro task å‘¢ã€‚</p>
<p>æ˜¯åˆ©ç”¨å…¶é«˜ä¼˜å…ˆçº§çš„ç‰¹æ€§ï¼Œä¿è¯é˜Ÿåˆ—ä¸­çš„å¾®ä»»åŠ¡åœ¨ä¸€æ¬¡å¾ªç¯å…¨éƒ¨æ‰§è¡Œå®Œæ¯•ã€‚</p>
<p>å¼ºåˆ¶ macro task çš„æ–¹æ³•æ˜¯åœ¨ç»‘å®š DOM äº‹ä»¶çš„æ—¶å€™ã€‚</p>
<p>é»˜è®¤ä¼šç»™å›è°ƒçš„ handler å‡½æ•°è°ƒç”¨ withMacroTask æ–¹æ³•åšä¸€å±‚åŒ…è£… handler = withMacroTask(handler)ã€‚</p>
<p>å®ƒä¿è¯æ•´ä¸ªå›è°ƒå‡½æ•°æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œé‡åˆ°æ•°æ®çŠ¶æ€çš„æ”¹å˜ï¼Œè¿™äº›æ”¹å˜éƒ½ä¼šè¢«æ¨åˆ° macro task ä¸­ã€‚</p>
<p>ä»¥ä¸Šå®ç°åœ¨src/platforms/web/runtime/modules/events.js</p>
<p>çš„ add æ–¹æ³•ä¸­ï¼Œå¯ä»¥è‡ªå·±çœ‹ä¸€çœ‹å…·ä½“ä»£ç ã€‚</p>
<p>åˆšå¥½åœ¨å†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™æ€å¦ä¸Šæœ‰äººé—®äº†ä¸ªé—®é¢˜ vue 2.4 å’Œ2.5 ç‰ˆæœ¬çš„@inputäº‹ä»¶ä¸ä¸€æ ·ã€‚</p>
<p>è¿™ä¸ªé—®é¢˜çš„åŸå› ä¹Ÿæ˜¯å› ä¸º2.5ä¹‹å‰ç‰ˆæœ¬çš„DOMäº‹ä»¶é‡‡ç”¨ micro task ï¼Œè€Œä¹‹åé‡‡ç”¨ macro taskã€‚</p>
<p>è§£å†³çš„é€”å¾„å‚è€ƒ &lt; Vue.js å‡çº§è¸©å‘å°è®°&gt; ä¸­ä»‹ç»çš„å‡ ä¸ªåŠæ³•ã€‚</p>
<p>è¿™é‡Œå°±æä¾›ä¸€ä¸ªåœ¨mountedé’©å­ä¸­ç”¨ addEventListener æ·»åŠ åŸç”Ÿäº‹ä»¶çš„æ–¹æ³•æ¥å®ç°ã€‚</p>
<p>å‚è§ CodePen</p>
<p>ï¼ˆ<a href="https://codepen.io/SHERlocked93/pen/WKGNKJï¼‰ã€‚" target="_blank" rel="noopener">https://codepen.io/SHERlocked93/pen/WKGNKJï¼‰ã€‚</a></p>
<ol start="3">
<li>ä¸€ä¸ªä¾‹å­</li>
</ol>
<p>è¯´è¿™ä¹ˆå¤šï¼Œä¸å¦‚æ¥ä¸ªä¾‹å­ï¼Œæ‰§è¡Œå‚è§ CodePen</p>
<pre><code>&lt;div id=&quot;app&quot;&gt;
  &lt;span id=&apos;name&apos; ref=&apos;name&apos;&gt;{{ name }}&lt;/span&gt;
  &lt;button @click=&apos;change&apos;&gt;change name&lt;/button&gt;
  &lt;div id=&apos;content&apos;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;script&gt;
  new Vue({
    el: &apos;#app&apos;,
    data() {
      return {
        name: &apos;SHERlocked93&apos;
      }
    },
    methods: {
      change() {
        const $name = this.$refs.name
        this.$nextTick(() =&gt; console.log(&apos;setterå‰ï¼š&apos; + $name.innerHTML))
        this.name = &apos; nameæ”¹å–½ &apos;
        console.log(&apos;åŒæ­¥æ–¹å¼ï¼š&apos; + this.$refs.name.innerHTML)
        setTimeout(() =&gt; this.console(&quot;setTimeoutæ–¹å¼ï¼š&quot; + this.$refs.name.innerHTML))
        this.$nextTick(() =&gt; console.log(&apos;setteråï¼š&apos; + $name.innerHTML))
        this.$nextTick().then(() =&gt; console.log(&apos;Promiseæ–¹å¼ï¼š&apos; + $name.innerHTML))
      }
    }
  })
&lt;/script&gt;
</code></pre><p>æ‰§è¡Œä»¥ä¸‹çœ‹çœ‹ç»“æœï¼š</p>
<pre><code>åŒæ­¥æ–¹å¼ï¼šSHERlocked93 
setterå‰ï¼šSHERlocked93 
setteråï¼šnameæ”¹å–½ 
Promiseæ–¹å¼ï¼šnameæ”¹å–½ 
setTimeoutæ–¹å¼ï¼šnameæ”¹å–½
</code></pre><p>ä¸ºä»€ä¹ˆæ˜¯è¿™æ ·çš„ç»“æœå‘¢ï¼Œè§£é‡Šä¸€ä¸‹ï¼š</p>
<ol>
<li><p>åŒæ­¥æ–¹å¼ï¼š å½“æŠŠdataä¸­çš„nameä¿®æ”¹ä¹‹åï¼Œæ­¤æ—¶ä¼šè§¦å‘nameçš„ setter ä¸­çš„ dep.notify é€šçŸ¥ä¾èµ–æœ¬dataçš„render watcherå» updateï¼Œupdate ä¼šæŠŠ flushSchedulerQueue å‡½æ•°ä¼ é€’ç»™ nextTickï¼Œrender watcheråœ¨ flushSchedulerQueue å‡½æ•°è¿è¡Œæ—¶ watcher.run å†èµ° diff -&gt; patch é‚£ä¸€å¥—é‡æ¸²æŸ“ re-render è§†å›¾ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­ä¼šé‡æ–°ä¾èµ–æ”¶é›†ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯å¼‚æ­¥çš„ï¼›æ‰€ä»¥å½“æˆ‘ä»¬ç›´æ¥ä¿®æ”¹äº†nameä¹‹åæ‰“å°ï¼Œè¿™æ—¶å¼‚æ­¥çš„æ”¹åŠ¨è¿˜æ²¡æœ‰è¢« patch åˆ°è§†å›¾ä¸Šï¼Œæ‰€ä»¥è·å–è§†å›¾ä¸Šçš„DOMå…ƒç´ è¿˜æ˜¯åŸæ¥çš„å†…å®¹ã€‚</p>
</li>
<li><p>setterå‰ï¼š setterå‰ä¸ºä»€ä¹ˆè¿˜æ‰“å°åŸæ¥çš„æ˜¯åŸæ¥å†…å®¹å‘¢ï¼Œæ˜¯å› ä¸º nextTick åœ¨è¢«è°ƒç”¨çš„æ—¶å€™æŠŠå›è°ƒæŒ¨ä¸ªpushè¿›callbacksæ•°ç»„ï¼Œä¹‹åæ‰§è¡Œçš„æ—¶å€™ä¹Ÿæ˜¯ for å¾ªç¯å‡ºæ¥æŒ¨ä¸ªæ‰§è¡Œï¼Œæ‰€ä»¥æ˜¯ç±»ä¼¼äºé˜Ÿåˆ—è¿™æ ·ä¸€ä¸ªæ¦‚å¿µï¼Œå…ˆå…¥å…ˆå‡ºï¼›åœ¨ä¿®æ”¹nameä¹‹åï¼Œè§¦å‘æŠŠrender watcherå¡«å…¥ schedulerQueue é˜Ÿåˆ—å¹¶æŠŠä»–çš„æ‰§è¡Œå‡½æ•° flushSchedulerQueue ä¼ é€’ç»™ nextTick ï¼Œæ­¤æ—¶callbacksé˜Ÿåˆ—ä¸­å·²ç»æœ‰äº† setterå‰å‡½æ•° äº†ï¼Œå› ä¸ºè¿™ä¸ª cb æ˜¯åœ¨ setterå‰å‡½æ•° ä¹‹åè¢«pushè¿›callbacksé˜Ÿåˆ—çš„ï¼Œé‚£ä¹ˆå…ˆå…¥å…ˆå‡ºçš„æ‰§è¡Œcallbacksä¸­å›è°ƒçš„æ—¶å€™å…ˆæ‰§è¡Œ setterå‰å‡½æ•°ï¼Œè¿™æ—¶å¹¶æœªæ‰§è¡Œrender watcherçš„ watcher.runï¼Œæ‰€ä»¥æ‰“å°DOMå…ƒç´ ä»ç„¶æ˜¯åŸæ¥çš„å†…å®¹ã€‚</p>
</li>
<li><p>setteråï¼š setteråè¿™æ—¶å·²ç»æ‰§è¡Œå®Œ flushSchedulerQueueï¼Œè¿™æ—¶render watcherå·²ç»æŠŠæ”¹åŠ¨ patch åˆ°è§†å›¾ä¸Šï¼Œæ‰€ä»¥æ­¤æ—¶è·å–DOMæ˜¯æ”¹è¿‡ä¹‹åçš„å†…å®¹ã€‚</p>
</li>
<li><p>Promiseæ–¹å¼ï¼š ç›¸å½“äº Promise.then çš„æ–¹å¼æ‰§è¡Œè¿™ä¸ªå‡½æ•°ï¼Œæ­¤æ—¶DOMå·²ç»æ›´æ”¹ã€‚</p>
</li>
<li><p>setTimeoutæ–¹å¼ï¼š æœ€åæ‰§è¡Œmacro taskçš„ä»»åŠ¡ï¼Œæ­¤æ—¶DOMå·²ç»æ›´æ”¹ã€‚</p>
</li>
</ol>
<p>æ³¨æ„ï¼Œåœ¨æ‰§è¡Œ setterå‰å‡½æ•° è¿™ä¸ªå¼‚æ­¥ä»»åŠ¡ä¹‹å‰ï¼ŒåŒæ­¥çš„ä»£ç å·²ç»æ‰§è¡Œå®Œæ¯•ã€‚</p>
<p>å¼‚æ­¥çš„ä»»åŠ¡éƒ½è¿˜æœªæ‰§è¡Œï¼Œæ‰€æœ‰çš„ $nextTick å‡½æ•°ä¹Ÿæ‰§è¡Œå®Œæ¯•ã€‚</p>
<p>æ‰€æœ‰å›è°ƒéƒ½è¢«pushè¿›äº†callbacksé˜Ÿåˆ—ä¸­ç­‰å¾…æ‰§è¡Œï¼Œæ‰€ä»¥åœ¨setterå‰å‡½æ•°æ‰§è¡Œçš„æ—¶å€™ã€‚</p>
<p>æ­¤æ—¶callbacksé˜Ÿåˆ—æ˜¯è¿™æ ·çš„ï¼š</p>
<p>[setterå‰å‡½æ•°ï¼Œ</p>
<p>flushSchedulerQueueï¼Œ</p>
<p>setteråå‡½æ•°ï¼Œ</p>
<p>Promiseæ–¹å¼å‡½æ•°]ã€‚</p>
<p>å®ƒæ˜¯ä¸€ä¸ªmicro taské˜Ÿåˆ—ï¼Œæ‰§è¡Œå®Œæ¯•ä¹‹åæ‰§è¡Œmacro task setTimeoutï¼Œæ‰€ä»¥æ‰“å°å‡ºä¸Šé¢çš„ç»“æœã€‚</p>
<p>å¦å¤–ï¼Œå¦‚æœæµè§ˆå™¨çš„å®ä»»åŠ¡é˜Ÿåˆ—é‡Œé¢æœ‰setImmediateã€MessageChannelã€setTimeout/setInterval å„ç§ç±»å‹çš„ä»»åŠ¡ã€‚</p>
<p>é‚£ä¹ˆä¼šæŒ‰ç…§ä¸Šé¢çš„é¡ºåºæŒ¨ä¸ªæŒ‰ç…§æ·»åŠ è¿›event loopä¸­çš„é¡ºåºæ‰§è¡Œï¼Œæ‰€ä»¥å¦‚æœæµè§ˆå™¨æ”¯æŒMessageChannelã€‚</p>
<p>nextTickæ‰§è¡Œçš„æ˜¯macroTimerFuncã€‚</p>
<p>é‚£ä¹ˆå¦‚æœ macrotask queue ä¸­åŒæ—¶æœ‰ nextTick æ·»åŠ çš„ä»»åŠ¡å’Œç”¨æˆ·è‡ªå·±æ·»åŠ çš„ setTimeout ç±»å‹çš„ä»»åŠ¡ã€‚</p>
<p>ä¼šä¼˜å…ˆæ‰§è¡Œ nextTick ä¸­çš„ä»»åŠ¡ï¼Œå› ä¸ºMessageChannel çš„ä¼˜å…ˆçº§æ¯” setTimeoutçš„é«˜ï¼ŒsetImmediate åŒç†ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/20/ES6ä¹‹promiseã€generator-coã€async-awaitæ‰‹å†™promise/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/20/ES6ä¹‹promiseã€generator-coã€async-awaitæ‰‹å†™promise/" itemprop="url">ES6ä¹‹promiseã€generator+coã€async+awaitæ‰‹å†™promise</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-08-20T12:06:32+08:00">
                2018-08-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="ä¸€ã€å‰è¨€"><a href="#ä¸€ã€å‰è¨€" class="headerlink" title="ä¸€ã€å‰è¨€"></a>ä¸€ã€å‰è¨€</h4><p>ä¼ ç»Ÿçš„è§£å†³ä»£ç å•çº¿ç¨‹æ‰§è¡Œçš„æ–¹æ¡ˆæ˜¯<code>å›è°ƒå‡½æ•°å’Œäº‹ä»¶</code>ã€‚è¿™æ˜¯ä¸ªè§£å†³é—®é¢˜çš„æ–¹æ¡ˆï¼Œä½†æ˜¯ä¼šé€ æˆå›è°ƒåœ°ç‹±ã€‚</p>
<p>å¼‚æ­¥ç¼–ç¨‹æ˜¯ä¼˜åŒ–ä»£ç é€»è¾‘æé«˜ä»£ç æ˜“è¯»æ€§çš„å…³é”®ã€‚</p>
<p>ç›®å‰é€šç”¨çš„å¼‚æ­¥ç¼–ç¨‹æ–¹æ³•æœ‰ä¸‰ç§ï¼š</p>
<ol>
<li>Promise</li>
<li>generator+co</li>
<li>async+await</li>
</ol>
<p>è¿™ä¸‰ç§æ–¹æ³•æˆ‘éƒ½ç»å¸¸åœ¨ç”¨ï¼Œä½†æ˜¯å¯¹å®ƒä»¬çš„åŸç†å´ä¸€çŸ¥åŠè§£ã€‚äºæ˜¯æƒ³ç‚’ä¸ªå†·é¥­ä»å¤´åˆ°å°¾ç†ä¸€éï¼Œæ¢³ç†ä¸€ä¸‹å®ƒä»¬ä¹‹é—´çš„å…³ç³»ã€‚</p>
<h4 id="äºŒã€Promise"><a href="#äºŒã€Promise" class="headerlink" title="äºŒã€Promise"></a>äºŒã€Promise</h4><h5 id="2-1-åŸç†"><a href="#2-1-åŸç†" class="headerlink" title="2.1 åŸç†"></a>2.1 åŸç†</h5><p>Promiseå¯¹è±¡æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œç”¨æ¥ç”ŸæˆPromiseå®ä¾‹ã€‚<br>Promiseå¯¹è±¡ä»£è¡¨ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œæœ‰ä¸‰ç§çŠ¶æ€ï¼š<code>pending</code>ï¼ˆè¿›è¡Œä¸­ï¼‰ã€<code>fulfilled</code>ï¼ˆå·²æˆåŠŸï¼‰å’Œ<code>rejected</code>ï¼ˆå·²å¤±è´¥ï¼‰ã€‚<br>Promiseå‡½æ•°çš„ä¸¤ä¸ªå‚æ•°åˆ†åˆ«æ˜¯<code>resolve</code>å’Œ<code>reject</code>ã€‚å®ƒä»¬æ˜¯Promiseä¸­å®šä¹‰çš„ä¸¤ä¸ªå‡½æ•°ï¼Œåœ¨è¿è¡Œè‡ªå®šä¹‰å‡½æ•°æ—¶è¿”å›ã€‚<br><code>resolve</code>å‡½æ•°å°†Promiseå¯¹è±¡çš„çŠ¶æ€ä» <code>pending</code> å˜ä¸º<code>resolved</code>,<code>reject</code>å°†Promiseå¯¹è±¡çš„çŠ¶æ€ä» <code>pending</code> å˜ä¸º<code>rejected</code><br>Promiseçš„åŸå‹é“¾ä¸Šå®šä¹‰äº†thenæ–¹æ³•ï¼Œæä¾›ä¸¤ä¸ªå›è°ƒå‡½æ•°åˆ†åˆ«æ•è·resolveã€rejectè¿”å›çš„å€¼ã€‚</p>
<h5 id="2-2-é™æ€æ–¹æ³•"><a href="#2-2-é™æ€æ–¹æ³•" class="headerlink" title="2.2 é™æ€æ–¹æ³•"></a>2.2 é™æ€æ–¹æ³•</h5><p>æ–¹æ³•æè¿°<code>Promise.resolve(promise)</code>;è¿”å› <code>promise</code>ï¼ˆä»…å½“ <code>promise.constructor == Promise</code> æ—¶ï¼‰<code>Promise.resolve(thenable)</code>;<br>ä»<code>thenable</code> ä¸­ç”Ÿæˆä¸€ä¸ªæ–°<code>promise</code>ã€‚<code>thenable</code> æ˜¯å…·æœ‰ <code>then()</code> æ–¹æ³•çš„ç±»ä¼¼äº <code>promise</code> çš„å¯¹è±¡ã€‚<code>Promise.resolve(obj)</code>;<br>åœ¨æ­¤æƒ…å†µä¸‹ï¼Œç”Ÿæˆä¸€ä¸ª<code>promise</code> å¹¶åœ¨æ‰§è¡Œæ—¶è¿”å› <code>objã€‚Promise.reject(obj)</code>;ç”Ÿæˆä¸€ä¸ª<code>promise</code> å¹¶åœ¨æ‹’ç»æ—¶è¿”å› objã€‚<br>ä¸ºä¿æŒä¸€è‡´å’Œè°ƒè¯•ä¹‹ç›®çš„ï¼ˆä¾‹å¦‚å †å è¿½è¸ªï¼‰ï¼Œ obj åº”ä¸º <code>instanceof Error</code>ã€‚<br><code>Promise.all(array)</code>;ç”Ÿæˆä¸€ä¸ª<code>promise</code>ï¼Œ<br>è¯¥ promise åœ¨æ•°ç»„ä¸­å„é¡¹æ‰§è¡Œæ—¶æ‰§è¡Œï¼Œåœ¨ä»»æ„ä¸€é¡¹æ‹’ç»æ—¶æ‹’ç»ã€‚<code>Promise.race(array)</code>;<br>ç”Ÿæˆä¸€ä¸ª Promiseï¼Œè¯¥ Promise åœ¨ä»»æ„é¡¹æ‰§è¡Œæ—¶æ‰§è¡Œï¼Œæˆ–åœ¨ä»»æ„é¡¹æ‹’ç»æ—¶æ‹’ç»ï¼Œä»¥æœ€å…ˆå‘ç”Ÿçš„ä¸ºå‡†ã€‚<br>sample 1<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">let p1 = new Promise((resolve,reject)=&gt;&#123;</span><br><span class="line">    console.log(&apos;hello&apos;)</span><br><span class="line">    setTimeout(function () &#123;</span><br><span class="line">        reject(&apos;1212&apos;)</span><br><span class="line">    &#125;,1000)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">p1.then(data=&gt; &#123;</span><br><span class="line">    console.log(&apos;success&apos;+data)</span><br><span class="line">&#125;,err=&gt;&#123;</span><br><span class="line">    console.log(&apos;err&apos;+err)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">p1.then(data=&gt; &#123;</span><br><span class="line">    console.log(&apos;success&apos;+data)</span><br><span class="line">&#125;,err=&gt;&#123;</span><br><span class="line">    console.log(&apos;err&apos;+err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>terminal:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hello</span><br><span class="line">err1212</span><br><span class="line">err1212</span><br></pre></td></tr></table></figure></p>
<p>sample 1 ä¸­æ–°å»ºäº†ä¸€ä¸ªPromiseå®ä¾‹ï¼Œå®šæ—¶1Såä½¿ç”¨rejectæ–¹æ³•ï¼Œå°†Promiseå®ä¾‹çš„çŠ¶æ€ä»pendingå˜æˆrejectedï¼Œè§¦å‘thençš„erræ•æ‰å›è°ƒå‡½æ•°ã€‚</p>
<p>åœ¨sample 1 ä¸­è°ƒç”¨thenæ–¹æ³•ï¼Œå¹¶ä¸ä¼šé©¬ä¸Šæ‰§è¡Œå›è°ƒã€‚æ˜¯ç­‰å¾…å®ä¾‹ä¸­çŠ¶æ€æ”¹å˜åæ‰ä¼šæ‰§è¡Œã€‚è¿™ä¸€ç‚¹å’Œ<code>å‘å¸ƒè®¢é˜…</code>æ¨¡å¼å¾ˆç±»ä¼¼ã€‚</p>
<p>sample 2<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">let fs = require(&apos;fs&apos;)</span><br><span class="line"></span><br><span class="line">let event = &#123;</span><br><span class="line">    arr:[],</span><br><span class="line">    result:[],</span><br><span class="line">    on(fn)&#123;</span><br><span class="line">        this.arr.push(fn)</span><br><span class="line">    &#125;,</span><br><span class="line">    emit(data)&#123;</span><br><span class="line">        this.result.push(data)</span><br><span class="line">        this.arr.forEach(fn=&gt;fn(this.result))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">event.on(function (data) &#123;</span><br><span class="line">    if(data.length === 2)&#123;</span><br><span class="line">        console.log(data)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fs.readFile(&apos;1.txt&apos;,&apos;utf8&apos;,function (err,data) &#123;</span><br><span class="line">    event.emit(data)</span><br><span class="line">&#125;)</span><br><span class="line">fs.readFile(&apos;2.txt&apos;,&apos;utf8&apos;,function (err,data) &#123;</span><br><span class="line">    event.emit(data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>smaple2 ä¸­å°†ç»“æœdataæ”¾å…¥æš‚å­˜æ•°ç»„ä¸­ï¼Œåœ¨æ‰§è¡Œæ¥å¬å‡½æ•°çš„æ—¶å€™è¿”å›ã€‚</p>
<h5 id="2-3-ç®€å†™Promiseæºç "><a href="#2-3-ç®€å†™Promiseæºç " class="headerlink" title="2.3 ç®€å†™Promiseæºç "></a>2.3 ç®€å†™Promiseæºç </h5><p>é€šè¿‡ä¹‹å‰çš„ä¾‹å­å’Œå¯¹å‘å¸ƒè®¢é˜…æ¨¡å¼çš„ç†è§£ï¼Œæˆ‘ä»¬å¯ä»¥å¤§æ¦‚å†™å‡ºPromiseå®ä¾‹çš„åŸºæœ¬åŠŸèƒ½ï¼š</p>
<p>code 1ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">function Promise(executor) &#123;</span><br><span class="line">    let self = this</span><br><span class="line">    self.value = undefined</span><br><span class="line">    self.reason = undefined</span><br><span class="line">    self.status = &apos;pending&apos;</span><br><span class="line">    self.onResovedCallbacks = []</span><br><span class="line">    self.onRejectedCallbacks = []</span><br><span class="line">    function resolve(data) &#123;</span><br><span class="line">        if(self.status === &apos;pending&apos;)&#123;</span><br><span class="line">            self.value = data</span><br><span class="line">            self.status = &apos;resolved&apos;</span><br><span class="line">            self.onResovedCallbacks.forEach(fn=&gt;fn())</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    function reject(reason) &#123;</span><br><span class="line">        if(self.status === &apos;pending&apos;) &#123;</span><br><span class="line">            self.reason = reason</span><br><span class="line">            self.status = &apos;reject&apos;</span><br><span class="line">            self.onRejectedCallbacks.forEach(fn=&gt;fn())</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    //å¦‚æœå‡½æ•°æ‰§è¡Œæ—¶å‘ç”Ÿå¼‚å¸¸</span><br><span class="line">    try&#123;</span><br><span class="line">        executor(resolve,reject)</span><br><span class="line">    &#125;catch (e)&#123;</span><br><span class="line">        reject(e)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Promise.prototype.then = function (onFulfilled,onRejected) &#123;</span><br><span class="line">    let self = this</span><br><span class="line">    if(self.status === &apos;pending&apos;)&#123;</span><br><span class="line">        self.onResovedCallbacks.push(()=&gt;&#123;</span><br><span class="line">            onFulfilled(self.value)</span><br><span class="line">        &#125;)</span><br><span class="line">        self.onRejectedCallbacks.push(()=&gt;&#123;</span><br><span class="line">            onRejected(self.reason)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;elseif(self.status === &apos;resolved&apos;)&#123;</span><br><span class="line">        onFulfilled(self.value)</span><br><span class="line">    &#125;elseif(self.status === &apos;reject&apos;)&#123;</span><br><span class="line">        onRejected(self.reason)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports = Promise</span><br></pre></td></tr></table></figure></p>
<ul>
<li><p>å‡½æ•°å†…éƒ¨å˜é‡</p>
</li>
<li><p>statusï¼šå‚¨å­˜Promiseçš„çŠ¶æ€</p>
</li>
<li>onResovedCallbacksï¼šå‚¨å­˜Promise pendingçŠ¶æ€ä¸‹æˆåŠŸå›è°ƒå‡½æ•°</li>
<li>onRejectedCallbacksï¼šå‚¨å­˜Promise pendingçŠ¶æ€ä¸‹å¤±è´¥å›è°ƒå‡½æ•°</li>
<li>resolveå‡½æ•°</li>
<li><p>rejectå‡½æ•°</p>
</li>
<li><p>Promise.prototype.then</p>
</li>
<li><p>æ ¹æ®å®ä¾‹çŠ¶æ€æ‰§è¡Œå“åº”çš„å›è°ƒ</p>
</li>
<li>status == pendingä½¿ç”¨å‘å¸ƒè®¢é˜…æ¨¡å¼å‚¨å­˜å›è°ƒå‡½æ•°ã€‚</li>
</ul>
<h5 id="2-4-Promiseç”¨æ³•ç®€è¿°"><a href="#2-4-Promiseç”¨æ³•ç®€è¿°" class="headerlink" title="2.4 Promiseç”¨æ³•ç®€è¿°"></a>2.4 Promiseç”¨æ³•ç®€è¿°</h5><ol>
<li><p>å¦‚æœä¸€ä¸ªpromiseæ‰§è¡Œå®Œå,è¿”å›çš„è¿˜æ˜¯ä¸€ä¸ªPromiseå¯¹è±¡,ä¼šæŠŠè¿™ä¸ªpromiseçš„æ‰§è¡Œç»“æœ,ä¼ é€’ç»™ä¸‹ä¸€ä¸ªthenä¸­ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">let fs = require(&apos;fs&apos;)</span><br><span class="line"></span><br><span class="line">functionread(filePath,encoding) &#123;</span><br><span class="line">    return new Promise((resolve,reject)=&gt;&#123;</span><br><span class="line">        fs.readFile(filePath,encoding,(err,data)=&gt; &#123;</span><br><span class="line">            if(err) reject(err)</span><br><span class="line">            resolve(data)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">read(&apos;1.txt&apos;,&apos;utf8&apos;).then(</span><br><span class="line">    f1=&gt;read(f1,&apos;utf8&apos;) // 1</span><br><span class="line">).then(</span><br><span class="line">    data=&gt; console.log(&apos;resolved:&apos;,comments)</span><br><span class="line">    err=&gt; console.log(&apos;rejected: &apos;,err)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¦‚æœthenä¸­è¿”å›çš„ä¸æ˜¯promiseï¼Œæ˜¯ä¸€ä¸ªæ™®é€šå€¼,ä¼šå°†è¿™ä¸ªæ™®é€šå€¼ä½œä¸ºä¸‹ä¸€ä¸ªthençš„è¿”å›ç»“æœã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> ......</span><br><span class="line"> </span><br><span class="line">read(&apos;1.txt&apos;,&apos;utf8&apos;).then(</span><br><span class="line">    f1=&gt;read(f1,&apos;utf8&apos;)</span><br><span class="line">).then(</span><br><span class="line">    return 123 //2</span><br><span class="line">).then(</span><br><span class="line">    data=&gt; console.log(&apos;resolved:&apos;,comments)</span><br><span class="line">    err=&gt; console.log(&apos;rejected: &apos;,err)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¦‚æœå½“å‰thenä¸­å¤±è´¥äº†ä¼šèµ°ä¸‹ä¸€ä¸ªthençš„å¤±è´¥ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> ......</span><br><span class="line"> </span><br><span class="line">read(&apos;1.txt&apos;,&apos;utf8&apos;).then(</span><br><span class="line">    f1=&gt;read(f1,&apos;utf8&apos;)</span><br><span class="line">).then(</span><br><span class="line">    return 123</span><br><span class="line">).then(</span><br><span class="line">    throw new Error(&apos;å‡ºé”™&apos;) //3</span><br><span class="line">).then(</span><br><span class="line">    data=&gt; console.log(&apos;resolved:&apos;,comments)</span><br><span class="line">    err=&gt; console.log(&apos;rejected: &apos;,err)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¦‚æœè¿”å›çš„æ˜¯undefinedä¸ç®¡å½“å‰æ˜¯å¤±è´¥è¿˜æ˜¯æˆåŠŸï¼Œéƒ½ä¼šèµ°ä¸‹ä¸€æ¬¡æˆåŠŸã€‚</p>
</li>
<li>catchæ˜¯é”™è¯¯æ²¡æœ‰å¤„ç†çš„æƒ…å†µä¸‹ä¼šèµ°ã€‚</li>
<li>thenä¸­å¯ä»¥ä¸å†™ã€‚<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> ......</span><br><span class="line"> </span><br><span class="line">read(&apos;1.txt&apos;,&apos;utf8&apos;).then(</span><br><span class="line">    f1=&gt;read(f1,&apos;utf8&apos;)</span><br><span class="line">).then(</span><br><span class="line">    return 123</span><br><span class="line">).then(</span><br><span class="line">    throw new Error(&apos;å‡ºé”™&apos;) </span><br><span class="line">).then() //6</span><br><span class="line"> .then(</span><br><span class="line">    data=&gt; console.log(&apos;resolved:&apos;,comments)</span><br><span class="line">    err=&gt; console.log(&apos;rejected: &apos;,err)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>è¿™äº›ç”¨æ³•ä¸­æœ€é‡è¦çš„æ˜¯promiseçš„thené“¾å¼è°ƒç”¨ã€‚<br>å¯ä»¥å¤§è‡´çŒœåˆ°ï¼Œæ—§Promiseçš„thenæ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ªæ–°çš„Promiseå¯¹è±¡ã€‚</p>
<p>å‚è€ƒ<a href="https://link.juejin.im?target=https%3A%2F%2Fpromisesaplus.com%2F" target="_blank" rel="noopener">Promises/A+è§„èŒƒ</a>ï¼Œå¯ä»¥å®Œå–„æ‰‹å†™çš„Promiseæºç ä½¿å…¶æ”¯æŒpromiseçš„é™æ€æ–¹æ³•å’Œè°ƒç”¨è§„åˆ™ã€‚</p>
<p>code 2ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line">function Promise(executor) &#123;</span><br><span class="line">    let self = this</span><br><span class="line">    self.value = undefined</span><br><span class="line">    self.reason = undefined</span><br><span class="line">    self.status = &apos;pending&apos;</span><br><span class="line">    self.onResovedCallbacks = []</span><br><span class="line">    self.onRejectedCallbacks = []</span><br><span class="line">    function resolve(value) &#123;</span><br><span class="line">        if (self.status === &apos;pending&apos;) &#123;</span><br><span class="line">            self.value = value</span><br><span class="line">            self.status = &apos;resolved&apos;</span><br><span class="line">            self.onResovedCallbacks.forEach(fn=&gt;fn())</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function reject(reason) &#123;</span><br><span class="line">        if (self.status === &apos;pending&apos;) &#123;</span><br><span class="line">            self.reason = reason</span><br><span class="line">            self.status = &apos;rejected&apos;</span><br><span class="line">            self.onRejectedCallbacks.forEach(fn=&gt;fn())</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //å¦‚æœå‡½æ•°æ‰§è¡Œæ—¶å‘ç”Ÿå¼‚å¸¸</span><br><span class="line">    try &#123;</span><br><span class="line">        executor(resolve, reject)</span><br><span class="line">    &#125; catch (e) &#123;</span><br><span class="line">        reject(e)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function resolvePromise(promise2, x, resolve, reject) &#123;</span><br><span class="line">    //If promise and x refer to the same object, reject promise with a TypeError as the reason.</span><br><span class="line">    if (promise2 === x) &#123;</span><br><span class="line">        return reject(new TypeError(&apos;chaining cycle&apos;))</span><br><span class="line">    &#125;</span><br><span class="line">    let called</span><br><span class="line">    //2.3.3.Otherwise, if x is an object or function,</span><br><span class="line">    if (x !== null &amp;&amp; (typeof x == &apos;object&apos; || typeof x === &apos;function&apos;)) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            letthen = x.then</span><br><span class="line">            //2.3.3.3.If then is a function, call it with x as this, first argument resolvePromise, and second argument rejectPromise, where:</span><br><span class="line">            //2.3.3.3.3.If both resolvePromise and rejectPromise are called, or multiple calls to the same argument are made, the first call takes precedence, and any further calls are ignored.</span><br><span class="line">            if (typeof then === &apos;function&apos;) &#123;</span><br><span class="line">                then.call(x, y=&gt; &#123;</span><br><span class="line">                    if (called) return;</span><br><span class="line">                    called = true;</span><br><span class="line">                    //é€’å½’ç›´åˆ°è§£ææˆæ™®é€šå€¼ä¸ºæ­¢</span><br><span class="line">                    //2.3.3.1.If/when resolvePromise is called with a value y, run [[Resolve]](promise, y).</span><br><span class="line">                    resolvePromise(promise2, y, resolve, reject)</span><br><span class="line">                &#125;, err=&gt; &#123;</span><br><span class="line">                    if (called) return;</span><br><span class="line">                    called = true;</span><br><span class="line">                    reject(err)</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                resolve(x)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (e) &#123;</span><br><span class="line">            if (called) return;</span><br><span class="line">            called = true;</span><br><span class="line">            //2.3.3.3.If retrieving the property x.then results in a thrown exception e, reject promise with e as the reason.</span><br><span class="line">            reject(e)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        //If x is not an object or function, fulfill promise with x.</span><br><span class="line">        resolve(x)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">//thenè°ƒç”¨çš„æ—¶å€™ éƒ½æ˜¯å¼‚æ­¥è°ƒç”¨ (åŸç”Ÿçš„thençš„æˆåŠŸæˆ–è€…å¤±è´¥ æ˜¯ä¸€ä¸ªå¾®ä»»åŠ¡)</span><br><span class="line">Promise.prototype.then = function (onFulfilled, onRejected) &#123;</span><br><span class="line">    //æˆåŠŸå’Œå¤±è´¥çš„å‡½æ•° æ˜¯å¯é€‰å‚æ•°</span><br><span class="line">    onFulfilled = typeof onFulfilled === &apos;function&apos; ? onFulfilled : val=&gt;val;</span><br><span class="line">    onRejected = typeof onRejected === &apos;function&apos; ? onRejected : (e)=&gt; &#123;throw e&#125;;</span><br><span class="line">    let self = this</span><br><span class="line">    let promise2;</span><br><span class="line">    promise2 = new Promise((resolve, reject)=&gt; &#123;</span><br><span class="line">        if (self.status === &apos;resolved&apos;) &#123;</span><br><span class="line">            setTimeout(()=&gt; &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    let x = onFulfilled(self.value)</span><br><span class="line">                    resolvePromise(promise2, x, resolve, reject)</span><br><span class="line">                &#125; catch (e) &#123;</span><br><span class="line">                    reject(e)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, 0)</span><br><span class="line">        &#125; elseif (self.status === &apos;rejected&apos;) &#123;</span><br><span class="line">            setTimeout(()=&gt; &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    let x = onRejected(self.reason)</span><br><span class="line">                    resolvePromise(promise2, x, resolve, reject)</span><br><span class="line">                &#125; catch (e) &#123;</span><br><span class="line">                    reject(e)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, 0)</span><br><span class="line">        &#125; elseif (self.status === &apos;pending&apos;) &#123;</span><br><span class="line">            self.onResovedCallbacks.push(()=&gt; &#123;</span><br><span class="line">                setTimeout(()=&gt; &#123;</span><br><span class="line">                    try &#123;</span><br><span class="line">                        let x = onFulfilled(self.value)</span><br><span class="line">                        resolvePromise(promise2, x, resolve, reject)</span><br><span class="line">                    &#125; catch (e) &#123;</span><br><span class="line">                        //å½“æ‰§è¡ŒæˆåŠŸå›è°ƒçš„æ—¶å€™,å¯èƒ½ä¼šå‡ºç°å¼‚å¸¸,é‚£å°±ç”¨è¿™ä¸ªå¼‚å¸¸ä½œä¸ºpromise2çš„é”™è¯¯ç»“æœ</span><br><span class="line">                        reject(e)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, 0)</span><br><span class="line">            &#125;)</span><br><span class="line">            self.onRejectedCallbacks.push(()=&gt; &#123;</span><br><span class="line">                setTimeout(()=&gt; &#123;</span><br><span class="line">                    try &#123;</span><br><span class="line">                        let x = onRejected(self.reason)</span><br><span class="line">                        resolvePromise(promise2, x, resolve, reject)</span><br><span class="line">                    &#125; catch (e) &#123;</span><br><span class="line">                        reject(e)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, 0)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    return promise2</span><br><span class="line">&#125;</span><br><span class="line">//setTimeout (è§„èŒƒè¦æ±‚)</span><br><span class="line"></span><br><span class="line">Promise.reject = function (reason) &#123;</span><br><span class="line">    return new Promise((resolve,reject)=&gt;&#123;</span><br><span class="line">        reject(reason)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Promise.resolve = function (value) &#123;</span><br><span class="line">    return new Promise((resolve,reject)=&gt;&#123;</span><br><span class="line">        resolve(value)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Promise.prototype.catch = function (onReject) &#123;</span><br><span class="line">    return this.then(null,onReject)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Promise.defer = Promise.deferred = function () &#123;</span><br><span class="line">    let dfd = &#123;&#125;</span><br><span class="line">    dfd.promise = new Promise((resolve, reject)=&gt; &#123;</span><br><span class="line">        dfd.resolve = resolve</span><br><span class="line">        dfd.reject = reject</span><br><span class="line">    &#125;)</span><br><span class="line">    return dfd;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports = Promise</span><br></pre></td></tr></table></figure></p>
<ol>
<li>ä¸ºäº†æ”¯æŒthençš„é“¾å¼è°ƒç”¨ï¼ŒPromise.then.prototypeä¸­è¿”å›ä¸€ä¸ªæ–°çš„Promiseå¯¹è±¡<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">return p2 = new Promise()</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>2.å¢åŠ resolvePromiseæ–¹æ³•ï¼Œå¤„ç†æ—§Promiseçš„å›è°ƒå‡½æ•°çš„ç»“æœxï¼Œæ ¹æ®xçš„ç±»å‹ï¼Œåˆ†åˆ«è°ƒç”¨æ–°promiseå¯¹è±¡çš„resolve/rejectæ–¹æ³•ã€‚</p>
<ul>
<li>æ˜¯æ™®é€šå€¼ç”¨resolveæ–¹æ³•è¿”å›</li>
<li>æ˜¯å‡½æ•°æˆ–è€…å¯¹è±¡å°±ç»§ç»­ç”¨resolvePromiseæ–¹æ³•è¿­ä»£ï¼ˆè§£å†³å›è°ƒå‡½æ•°æ˜¯Promiseå¯¹è±¡ï¼‰</li>
<li>å‡ºé”™å°±ç”¨rejectæ–¹æ³•è¿”å›</li>
</ul>
<h4 id="ä¸‰ã€bluebird"><a href="#ä¸‰ã€bluebird" class="headerlink" title="ä¸‰ã€bluebird"></a>ä¸‰ã€bluebird</h4><p>1: NodeJS ä¸­çš„ fs.readFile æ–¹æ³•çš„åŸºæœ¬ä½¿ç”¨æ–¹å¼<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const fs = require(&apos;fs&apos;),path = require(&apos;path&apos;);</span><br><span class="line"> </span><br><span class="line">fs.readFile(path.join(__dirname, &apos;1.txt&apos;), &apos;utf-8&apos;, (err, data) =&gt; &#123;</span><br><span class="line"> if (err) &#123;</span><br><span class="line">   console.error(err);</span><br><span class="line"> &#125; else &#123;</span><br><span class="line">   console.log(data);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>2ï¼šä½¿ç”¨Promiseå°è£…<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">let fs = require(&apos;fs&apos;)</span><br><span class="line"></span><br><span class="line">functionread(filePath, encoding) &#123;</span><br><span class="line">    return new Promise((resolve, reject)=&gt; &#123;</span><br><span class="line">        fs.readFile(filePath, encoding, (err, data)=&gt; &#123;</span><br><span class="line">            if (err) reject(err)</span><br><span class="line">            resolve(data)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">read(&apos;1.txt&apos;, &apos;utf8&apos;).then( data=&gt; data)</span><br></pre></td></tr></table></figure></p>
<p>æŠŠfs.readFileæ–¹æ³•ç”¨Promiseå°è£…ä¸€ä¸‹å°±èƒ½ä½¿ç”¨Promise apiã€‚ä½†æ˜¯æ¯æ¬¡æ‰‹åŠ¨å°è£…æ¯”è¾ƒéº»çƒ¦ï¼Œbluebirdå¯ä»¥å¸®æˆ‘ä»¬ç®€åŒ–è¿™ä¸ªæ­¥éª¤ã€‚</p>
<p>3ï¼šåœ¨ NodeJS ç¯å¢ƒä¸­ï¼Œé€šè¿‡ const bluebird = require(â€˜bluebirdâ€™) å°±å¯ä»¥å¼€å§‹ä½¿ç”¨ Bluebird æä¾›çš„ Promise å¯¹è±¡ã€‚</p>
<p>Promise.promisify å°†å•ä¸ªæ–¹æ³•è½¬æ¢æˆPromiseå¯¹è±¡ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const bluebird = require(&apos;bluebird&apos;) </span><br><span class="line">letread = bluebird.promisify(fs.readFile)</span><br><span class="line">read(&apos;1.txt&apos;, &apos;utf-8&apos;).then(data=&gt; &#123;</span><br><span class="line">    console.log(&apos;data promisify&apos;, data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>ä½¿ç”¨<code>bluebird.promisify</code>æ–¹æ³•ï¼Œå°±èƒ½å°†fs.readFileç›´æ¥å°è£…æˆä¸€ä¸ªpromiseå¯¹è±¡ï¼Œå®ƒçš„åŸç†å¾ˆç®€å•ï¼Œreturn new Promise<br>æ˜¯å®ƒçš„æ ¸å¿ƒï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function promisify(fn) &#123;</span><br><span class="line">    return function () &#123;</span><br><span class="line">        return new Promise((resolve, reject)=&gt; &#123;</span><br><span class="line">            fn(...arguments, function (err, data) &#123;</span><br><span class="line">                if (err) reject(err)</span><br><span class="line">                resolve(data)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>4.ä½¿ç”¨ Promise.promisifyAll æŠŠä¸€ä¸ªå¯¹è±¡çš„æ‰€æœ‰æ–¹æ³•éƒ½è‡ªåŠ¨è½¬æ¢æˆä½¿ç”¨ Promiseã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const bluebird = require(&apos;bluebird&apos;),</span><br><span class="line">  fs = require(&apos;fs&apos;),</span><br><span class="line">  path = require(&apos;path&apos;);</span><br><span class="line">Promise.promisifyAll(fs);</span><br><span class="line"> </span><br><span class="line">fs.readFileAsync(path.join(__dirname, &apos;sample.txt&apos;), &apos;utf-8&apos;)</span><br><span class="line">  .then(data =&gt; console.log(data))</span><br><span class="line">  .catch(err =&gt; console.error(err));</span><br></pre></td></tr></table></figure></p>
<p>promisifyAllæ ¸å¿ƒæ˜¯éå†å¯¹è±¡ï¼Œç”Ÿæˆäº›æ–°åˆ›å»ºæ–¹æ³•çš„åç§°åœ¨å·²æœ‰æ–¹æ³•çš„åç§°ååŠ ä¸Šâ€Asyncâ€åç¼€ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function promisifyAll(obj) &#123;</span><br><span class="line">    Object.keys(obj).forEach(key=&gt;&#123;</span><br><span class="line">        if(typeof obj[key] === &apos;function&apos;)&#123;</span><br><span class="line">            obj[key+&apos;Async&apos;] = promisify(obj[key])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="å››ã€generator-co"><a href="#å››ã€generator-co" class="headerlink" title="å››ã€generator+co"></a>å››ã€generator+co</h4><h5 id="4-1-ç®€ä»‹"><a href="#4-1-ç®€ä»‹" class="headerlink" title="4.1 ç®€ä»‹"></a>4.1 ç®€ä»‹</h5><p>generatorå‡½æ•°æœ€å¤§çš„ç‰¹ç‚¹æ˜¯å¯ä»¥ç”¨<code>yield</code>æš‚åœæ‰§è¡Œï¼Œä¸ºäº†åŒºåˆ«æ™®é€šå‡½æ•°åœ¨å‡½æ•°åå‰åŠ *å·ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function *say() &#123;</span><br><span class="line">    let a = yield &quot;test1&quot;let b = yield &quot;test2&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let it = say();</span><br><span class="line"></span><br><span class="line">console.log(1, it.next()) //1 &#123; value: &apos;test1&apos;, done: false &#125;</span><br><span class="line">console.log(2, it.next()) //2 &#123; value: &apos;test2&apos;, done: false &#125;</span><br><span class="line">console.log(3, it.next()) //3 &#123; value: undefined, done: true &#125;</span><br></pre></td></tr></table></figure></p>
<p>æ‰§è¡Œsay()æ–¹æ³•è¿”å›çš„æ˜¯æŒ‡é’ˆå¯¹è±¡ï¼Œä¸ä¼šè¿”å›å‡½æ•°æ‰§è¡Œç»“æœã€‚it å°±æ˜¯iterator è¿­ä»£å™¨</p>
<p>éœ€è¦è°ƒç”¨æŒ‡é’ˆå¯¹è±¡çš„next()æ–¹æ³•ï¼Œè®©å‡½æ•°æŒ‡é’ˆä¸æ–­ç§»åŠ¨å¹¶è¿”å›ä¸€ä¸ªå¯¹è±¡ã€‚ï¼ˆ{value:xxx,done:xxx}ï¼‰</p>
<p>valueæ˜¯yieldåé¢çš„å€¼ï¼Œdoneè¡¨ç¤ºå‡½æ•°æ˜¯å¦æ‰§è¡Œå®Œæˆã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ç”¨generatorå‡½æ•°å®ç°ç»“æœçš„äº§å‡ºï¼Œä½†æ˜¯ä¹Ÿéœ€è¦å®ƒæ”¯æŒè¾“å…¥ã€‚</p>
<p>generatorå‡½æ•°çš„è¿è¡Œé¡ºåºå¦‚ä¸‹ï¼š<br>ä½¿ç”¨it.next()æ‰§è¡Œå‡½æ•°ï¼Œç»“æœå¹¶ä¸ä¼šè¿”å›ç»™å®šä¹‰çš„å˜é‡aã€‚nextæ–¹æ³•å¯ä»¥æ¥å—å‚æ•°ï¼Œè¿™æ˜¯å‘ Generator å‡½æ•°ä½“å†…è¾“å…¥æ•°æ®ã€‚<br>ç¬¬äºŒä¸ªnextçš„æ—¶å€™ä¼ å…¥å‚æ•°ï¼Œå°±èƒ½è¢«å˜é‡aæ¥æ”¶åˆ°ã€‚</p>
<p>terminal è¿”å›ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1 &#123; value: &apos;test1&apos;, done: false &#125;</span><br><span class="line">aaa</span><br><span class="line">2 &#123; value: &apos;test2&apos;, done: false &#125;</span><br><span class="line">bbb</span><br><span class="line">3 &#123; value: undefined, done: true &#125;</span><br></pre></td></tr></table></figure></p>
<p>4.2 ä½¿ç”¨</p>
<p>exampleï¼šä½¿ç”¨generatorå¼‚æ­¥æ‰§è¡Œå‡½æ•°ï¼Œä½¿å‡½æ•°çš„è¿”å›ä½œä¸ºä¸‹ä¸€ä¸ªå‡½æ•°çš„å…¥å‚æ‰§è¡Œã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">let bluebird = require(&apos;bluebird&apos;)</span><br><span class="line">let fs = require(&apos;fs&apos;)</span><br><span class="line">letread = bluebird.promisify(fs.readFile)</span><br><span class="line"></span><br><span class="line">function *r() &#123;</span><br><span class="line">    let r1 = yield read(&apos;1.txt&apos;, &apos;utf-8&apos;)</span><br><span class="line">    console.log(&apos;r1&apos;,r1); // r1 2.txt</span><br><span class="line">    let r2 = yield read(r1, &apos;utf-8&apos;)</span><br><span class="line">    console.log(&apos;r2&apos;,r2); // r2 3.txt</span><br><span class="line">    let r3 = yield read(r2, &apos;utf-8&apos;)</span><br><span class="line">    console.log(&apos;r3&apos;,r3); // r3 hello</span><br><span class="line">    return r3</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ‹¿è¯»å–æ–‡ä»¶çš„ä¾‹å­ï¼šä½¿ç”¨bluebirdå°†fs.readFileå˜æˆpromiseå¯¹è±¡ï¼Œå°†è¯»å–åˆ°çš„æ–‡ä»¶å†…å®¹ä½œä¸ºå…¥å‚ä¼ å…¥ä¸‹ä¸€ä¸ªè¦æ‰§è¡Œçš„å‡½æ•°ã€‚</p>
<p>çªç„¶å‘ç°ï¼Œè¦æ‹¿åˆ°ç»“æœä¼šæ˜¯ä¸ªå¤æ‚çš„è¿‡ç¨‹ï¼Œä½†è¿˜æ˜¯ç¡¬ç€å¤´çš®ä¸‹ä¸‹å»ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const it_r = r()</span><br><span class="line">it_r.next().value.then(d1=&gt;&#123;</span><br><span class="line">    return it_r.next(d1).value</span><br><span class="line">&#125;).then(d2=&gt;&#123;</span><br><span class="line">    return it_r.next(d2).value</span><br><span class="line">&#125;).then(d3=&gt;&#123;</span><br><span class="line">    return it_r.next(d3).value</span><br><span class="line">&#125;).then(data=&gt;&#123;</span><br><span class="line">    console.log(data) // hello</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>it.next().value è¿”å›çš„æ˜¯ä¸€ä¸ªpromiseï¼Œä½¿ç”¨thenæ–¹æ³•ï¼Œæ‹¿åˆ°å®ƒæˆåŠŸå›è°ƒçš„å€¼ï¼Œå¹¶ä¼ å…¥ä¸‹ä¸€ä¸ªnextã€‚</p>
<p>è¿™æ ·èƒ½æˆåŠŸæ‹¿åˆ°æˆ‘ä»¬è¦çš„å€¼ï¼Œä½†æ˜¯å¤ªéº»çƒ¦äº†ã€‚äºæ˜¯å°±æœ‰äº†generator+coçš„ç»„åˆï¼</p>
<p>å®‰è£…ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install co</span><br></pre></td></tr></table></figure></p>
<p>ä½¿ç”¨:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">co(r()).then(data=&gt; &#123;</span><br><span class="line">    console.log(data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>coä¼šè¿­ä»£æ‰§è¡Œit.next()æ–¹æ³•ï¼Œç›´åˆ°doneçš„å¸ƒå°”å€¼ä¸ºtrueå°±è¿”å›generatorå‡½æ•°çš„è¿è¡Œç»“æœã€‚</p>
<p>å¤§è‡´æ‰§è¡Œä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">function co(it) &#123;</span><br><span class="line">    return new Promise((resolve, reject)=&gt; &#123;</span><br><span class="line">        function next(data) &#123;</span><br><span class="line">            let &#123;value, done&#125; = it.next(data)</span><br><span class="line">            if(done)&#123;</span><br><span class="line">                resolve(value)</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                value.then(data=&gt; &#123;</span><br><span class="line">                    next(data)</span><br><span class="line">                &#125;,reject)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        next()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="äº”ã€async-await"><a href="#äº”ã€async-await" class="headerlink" title="äº”ã€async+await"></a>äº”ã€async+await</h4><p>async å‡½æ•°æ˜¯Generator å‡½æ•°çš„è¯­æ³•ç³–ã€‚</p>
<p>æ¯”Generatorå‡½æ•°ç”¨èµ·æ¥ç®€å•</p>
<ol>
<li>å¯ä»¥è®©ä»£ç åƒåŒæ­¥</li>
<li>å¯ä»¥try+catch</li>
<li>å¯ä»¥ä½¿ç”¨promise api<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">async functionr() &#123;</span><br><span class="line">   try&#123;</span><br><span class="line">        let r1 = await read(&apos;1.txt&apos;,&apos;utf8&apos;)</span><br><span class="line">        let r2 = await read(r1,&apos;utf8&apos;)</span><br><span class="line">        let r3 = await read(r2,&apos;utf8&apos;)</span><br><span class="line">        return r3</span><br><span class="line">    &#125;catch(e)&#123;</span><br><span class="line">        console.log(&apos;e&apos;,e)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">r().then(data=&gt; &#123;</span><br><span class="line">    console.log(data)</span><br><span class="line">&#125;,err=&gt;&#123;</span><br><span class="line">    console.log(&apos;err&apos;,err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>async å‡½æ•°è¿”å›ä¸€ä¸ª Promise å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨ then æ–¹æ³•æ·»åŠ å›è°ƒå‡½æ•°ã€‚é‡åˆ°awaitå°±ä¼šå…ˆè¿”å›ï¼Œç­‰å¾…å‡½æ•°æ‰§è¡Œã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/tx.jpg"
                alt="ææ–Œ" />
            
              <p class="site-author-name" itemprop="name">ææ–Œ</p>
              <p class="site-description motion-element" itemprop="description">æƒ³è¦é£å¾—é«˜ï¼Œé‚£å°±æŠŠåœ°å¹³çº¿å¿˜æ‰</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">109</span>
                  <span class="site-state-item-name">æ—¥å¿—</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">82</span>
                  <span class="site-state-item-name">æ ‡ç­¾</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/libin1991" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="3120217729@qq.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://juejin.im/user/57e737f6c4c971005f6bcd8d" target="_blank" title="juejin">
                      
                        <i class="fa fa-fw fa-spinner"></i>juejin</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ææ–Œ</span>

  
</div>


  <div class="powered-by">ç”± <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">ä¸»é¢˜ &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
<script type="text/javascript" src="/js/src/clicklove.js"></script>

