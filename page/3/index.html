<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="Blog">
<meta property="og:type" content="website">
<meta property="og:title" content="LuckDay">
<meta property="og:url" content="http://yoursite.com/page/3/index.html">
<meta property="og:site_name" content="LuckDay">
<meta property="og:description" content="Blog">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="LuckDay">
<meta name="twitter:description" content="Blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/3/"/>





  <title>LuckDay - æƒ³è¦é£å¾—é«˜ï¼Œé‚£å°±æŠŠåœ°å¹³çº¿å¿˜æ‰</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband">
    	<div class="eevee"><div class="body"><div class="head"><div class="ears"><div class="ear"><div class="lobe"></div></div><div class="ear"><div class="lobe"></div></div></div><div class="face"><div class="eyes"><div class="eye"><div class="eyelid"></div></div><div class="eye"><div class="eyelid"></div></div></div><div class="nose"></div><div class="mouth"></div></div></div><div class="chest"><div class="fur"><div class="patch"></div></div><div class="fur"><div class="patch"></div></div><div class="fur"><div class="patch"></div></div></div><div class="legs"><div class="leg"><div class="inner-leg"></div></div><div class="leg"><div class="inner-leg"></div></div><div class="leg"><div class="inner-leg"></div></div><div class="leg"><div class="inner-leg"></div></div></div><div class="tail"><div class="tail"><div class="tail"><div class="tail"><div class="tail"><div class="tail -end"></div></div></div></div></div></div></div></div>
    </div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
    	<div class="sky">
	<div class="clouds_one"></div>
	<div class="clouds_two"></div>
	<div class="clouds_three"></div>
</div>
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">LuckDay</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">æƒ³è¦é£å¾—é«˜ï¼Œé‚£å°±æŠŠåœ°å¹³çº¿å¿˜æ‰</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            æ ‡ç­¾
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            å…³äº
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            æœç´¢
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="æœç´¢..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/03/æµ…è°ˆ-instanceof-å’Œ-typeof-çš„å®ç°åŸç†/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/03/æµ…è°ˆ-instanceof-å’Œ-typeof-çš„å®ç°åŸç†/" itemprop="url">æµ…è°ˆ instanceof å’Œ typeof çš„å®ç°åŸç†</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-10-03T13:17:32+08:00">
                2018-10-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="typeof-å®ç°åŸç†"><a href="#typeof-å®ç°åŸç†" class="headerlink" title="typeof å®ç°åŸç†"></a>typeof å®ç°åŸç†</h3><p><code>typeof</code> ä¸€èˆ¬è¢«ç”¨äºåˆ¤æ–­ä¸€ä¸ªå˜é‡çš„ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ <code>typeof</code> æ¥åˆ¤æ–­<code>number</code>, <code>string</code>, <code>object</code>, <code>boolean</code>, <code>function</code>, <code>undefined</code>,<code>symbol</code> è¿™ä¸ƒç§ç±»å‹ï¼Œè¿™ç§åˆ¤æ–­èƒ½å¸®åŠ©æˆ‘ä»¬æå®šä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚åœ¨åˆ¤æ–­ä¸æ˜¯ object ç±»å‹çš„æ•°æ®çš„æ—¶å€™ï¼Œ<code>typeof</code>èƒ½æ¯”è¾ƒæ¸…æ¥šçš„å‘Šè¯‰æˆ‘ä»¬å…·ä½“æ˜¯å“ªä¸€ç±»çš„ç±»å‹ã€‚ä½†æ˜¯ï¼Œå¾ˆé—æ†¾çš„ä¸€ç‚¹æ˜¯ï¼Œ<code>typeof</code> åœ¨åˆ¤æ–­ä¸€ä¸ª objectçš„æ•°æ®çš„æ—¶å€™åªèƒ½å‘Šè¯‰æˆ‘ä»¬è¿™ä¸ªæ•°æ®æ˜¯ object, è€Œä¸èƒ½ç»†è‡´çš„å…·ä½“åˆ°æ˜¯å“ªä¸€ç§ object, æ¯”å¦‚ğŸ‘‰</p>
<pre><code>let s =newString(&apos;abc&apos;);
typeof s ===&apos;object&apos;// true
s instanceofString// true
</code></pre><p>è¦æƒ³åˆ¤æ–­ä¸€ä¸ªæ•°æ®å…·ä½“æ˜¯å“ªä¸€ç§ object çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦åˆ©ç”¨ <code>instanceof</code> è¿™ä¸ªæ“ä½œç¬¦æ¥åˆ¤æ–­ï¼Œè¿™ä¸ªæˆ‘ä»¬åé¢ä¼šè¯´åˆ°ã€‚</p>
<p>æ¥è°ˆè°ˆå…³äº <code>typeof</code> çš„åŸç†å§ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆæƒ³ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„é—®é¢˜ï¼Œjs åœ¨åº•å±‚æ˜¯æ€ä¹ˆå­˜å‚¨æ•°æ®çš„ç±»å‹ä¿¡æ¯å‘¢ï¼Ÿæˆ–è€…è¯´ï¼Œä¸€ä¸ª js çš„å˜é‡ï¼Œåœ¨å®ƒçš„åº•å±‚å®ç°ä¸­ï¼Œå®ƒçš„ç±»å‹ä¿¡æ¯æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿ</p>
<p>å…¶å®ï¼Œjs åœ¨åº•å±‚å­˜å‚¨å˜é‡çš„æ—¶å€™ï¼Œä¼šåœ¨å˜é‡çš„æœºå™¨ç çš„ä½ä½1-3ä½å­˜å‚¨å…¶ç±»å‹ä¿¡æ¯ğŸ‘‰<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">000ï¼šå¯¹è±¡</span><br><span class="line"></span><br><span class="line">010ï¼šæµ®ç‚¹æ•°</span><br><span class="line"></span><br><span class="line">100ï¼šå­—ç¬¦ä¸²</span><br><span class="line"></span><br><span class="line">110ï¼šå¸ƒå°”</span><br></pre></td></tr></table></figure></p>
<ul>
<li>1ï¼šæ•´æ•°</li>
</ul>
<p>but, å¯¹äº <code>undefined</code> å’Œ <code>null</code> æ¥è¯´ï¼Œè¿™ä¸¤ä¸ªå€¼çš„ä¿¡æ¯å­˜å‚¨æ˜¯æœ‰ç‚¹ç‰¹æ®Šçš„ã€‚</p>
<p><code>null</code>ï¼šæ‰€æœ‰æœºå™¨ç å‡ä¸º0</p>
<p><code>undefined</code>ï¼šç”¨ âˆ’2^30 æ•´æ•°æ¥è¡¨ç¤º</p>
<p>æ‰€ä»¥ï¼Œ<code>typeof</code> åœ¨åˆ¤æ–­ <code>null</code> çš„æ—¶å€™å°±å‡ºç°é—®é¢˜äº†ï¼Œç”±äº <code>null</code> çš„æ‰€æœ‰æœºå™¨ç å‡ä¸º0ï¼Œå› æ­¤ç›´æ¥è¢«å½“åšäº†å¯¹è±¡æ¥çœ‹å¾…ã€‚</p>
<p>ç„¶è€Œç”¨ <code>instanceof</code> æ¥åˆ¤æ–­çš„è¯ğŸ‘‰</p>
<pre><code>nullinstanceofnull// TypeError: Right-hand side of &apos;instanceof&apos; is not an object
</code></pre><p><code>null</code> ç›´æ¥è¢«åˆ¤æ–­ä¸ºä¸æ˜¯ objectï¼Œè¿™ä¹Ÿæ˜¯ JavaScript çš„å†å²é—ç•™bugï¼Œå¯ä»¥å‚è€ƒtypeofã€‚</p>
<p>å› æ­¤åœ¨ç”¨ <code>typeof</code> æ¥åˆ¤æ–­å˜é‡ç±»å‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦æ³¨æ„ï¼Œæœ€å¥½æ˜¯ç”¨ <code>typeof</code> æ¥åˆ¤æ–­åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆåŒ…æ‹¬<code>symbol</code>ï¼‰ï¼Œé¿å…å¯¹ null çš„åˆ¤æ–­ã€‚</p>
<p>è¿˜æœ‰ä¸€ä¸ªä¸é”™çš„åˆ¤æ–­ç±»å‹çš„æ–¹æ³•ï¼Œå°±æ˜¯<strong><font color="#dd0000">Object.prototype.toString</font></strong>ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ–¹æ³•æ¥å¯¹ä¸€ä¸ªå˜é‡çš„ç±»å‹æ¥è¿›è¡Œæ¯”è¾ƒå‡†ç¡®çš„åˆ¤æ–­</p>
<pre><code>Object.prototype.toString.call(1)// &quot;[object Number]&quot;
Object.prototype.toString.call(&apos;hi&apos;)// &quot;[object String]&quot;
Object.prototype.toString.call({a:&apos;hi&apos;})// &quot;[object Object]&quot;
Object.prototype.toString.call([1,&apos;a&apos;])// &quot;[object Array]&quot;
Object.prototype.toString.call(true)// &quot;[object Boolean]&quot;
Object.prototype.toString.call(()=&gt;{})// &quot;[object Function]&quot;
Object.prototype.toString.call(null)// &quot;[object Null]&quot;
Object.prototype.toString.call(undefined)// &quot;[object Undefined]&quot;
Object.prototype.toString.call(Symbol(1))// &quot;[object Symbol]&quot;
</code></pre><h3 id="instanceof-æ“ä½œç¬¦çš„å®ç°åŸç†"><a href="#instanceof-æ“ä½œç¬¦çš„å®ç°åŸç†" class="headerlink" title="instanceof æ“ä½œç¬¦çš„å®ç°åŸç†"></a>instanceof æ“ä½œç¬¦çš„å®ç°åŸç†</h3><p>ä¹‹å‰æˆ‘ä»¬æåˆ°äº† <code>instanceof</code> æ¥åˆ¤æ–­å¯¹è±¡çš„å…·ä½“ç±»å‹ï¼Œå…¶å® <code>instanceof</code> ä¸»è¦çš„ä½œç”¨å°±æ˜¯åˆ¤æ–­ä¸€ä¸ªå®ä¾‹æ˜¯å¦å±äºæŸç§ç±»å‹</p>
<pre><code>let person =function(){
}
let nicole =new person()
nicole instanceof person // true
</code></pre><p>å½“ç„¶ï¼Œ<code>instanceof</code> ä¹Ÿå¯ä»¥åˆ¤æ–­ä¸€ä¸ªå®ä¾‹æ˜¯å¦æ˜¯å…¶çˆ¶ç±»å‹æˆ–è€…ç¥–å…ˆç±»å‹çš„å®ä¾‹ã€‚</p>
<pre><code>let person =function(){
}
let programmer =function(){
}
programmer.prototype =new person()
let nicole =new programmer()
nicole instanceof person // true
nicole instanceof programmer // true
</code></pre><p>è¿™æ˜¯ <code>instanceof</code> çš„ç”¨æ³•ï¼Œä½†æ˜¯ <code>instanceof</code> çš„åŸç†æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæ ¹æ® ECMAScript è¯­è¨€è§„èŒƒï¼Œæˆ‘æ¢³ç†äº†ä¸€ä¸‹å¤§æ¦‚çš„æ€è·¯ï¼Œç„¶åæ•´ç†äº†ä¸€æ®µä»£ç å¦‚ä¸‹</p>
<pre><code>function new_instance_of(leftVaule, rightVaule){
    let rightProto = rightVaule.prototype;// å–å³è¡¨è¾¾å¼çš„ prototype å€¼
    leftVaule = leftVaule.__proto__;// å–å·¦è¡¨è¾¾å¼çš„__proto__å€¼
    while(true){
        if(leftVaule ===null){
            returnfalse;    
        }
        if(leftVaule === rightProto){
            returntrue;    
        }
        leftVaule = leftVaule.__proto__ 
    }
}
</code></pre><p><font color="#dd0000">å…¶å® <code>instanceof</code> ä¸»è¦çš„å®ç°åŸç†å°±æ˜¯åªè¦å³è¾¹å˜é‡çš„ <code>prototype</code> åœ¨å·¦è¾¹å˜é‡çš„åŸå‹é“¾ä¸Šå³å¯ã€‚å› æ­¤ï¼Œ<code>instanceof</code> åœ¨æŸ¥æ‰¾çš„è¿‡ç¨‹ä¸­ä¼šéå†å·¦è¾¹å˜é‡çš„åŸå‹é“¾ï¼Œç›´åˆ°æ‰¾åˆ°å³è¾¹å˜é‡çš„ <code>prototype</code>ï¼Œå¦‚æœæŸ¥æ‰¾å¤±è´¥ï¼Œåˆ™ä¼šè¿”å› falseï¼Œå‘Šè¯‰æˆ‘ä»¬å·¦è¾¹å˜é‡å¹¶éæ˜¯å³è¾¹å˜é‡çš„å®ä¾‹ã€‚<br></font><br><br>çœ‹å‡ ä¸ªå¾ˆæœ‰è¶£çš„ä¾‹å­</p>
<pre><code>functionFoo(){
}
Object instanceof Object// true
Function instanceof Function// true
Function instanceof Object// true
Foo instanceof Foo// false
Foo instanceof Object// true
Foo instanceof Function// true
</code></pre><p>è¦æƒ³å…¨éƒ¨ç†è§£ <code>instanceof</code> çš„åŸç†ï¼Œé™¤äº†æˆ‘ä»¬åˆšåˆšæåˆ°çš„å®ç°åŸç†ï¼Œæˆ‘ä»¬è¿˜éœ€è¦çŸ¥é“ JavaScript çš„åŸå‹ç»§æ‰¿åŸç†ã€‚</p>
<p>å…³äºåŸå‹ç»§æ‰¿çš„åŸç†ï¼Œæˆ‘ç®€å•ç”¨ä¸€å¼ å›¾æ¥è¡¨ç¤º</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/meG6Vo0MevjCzDE6dwt2qtltaDsSluC9M8KmmeZsLSJnFTgdTtcCRToR3zWJFYicViaUlvyAGdfwEzADj8Jk8kzQ/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt=""><br>æˆ‘ä»¬çŸ¥é“æ¯ä¸ª JavaScript å¯¹è±¡å‡æœ‰ä¸€ä¸ªéšå¼çš„ <code>__proto__</code> åŸå‹å±æ€§ï¼Œè€Œæ˜¾å¼çš„åŸå‹å±æ€§æ˜¯ <code>prototype</code>ï¼Œåªæœ‰ <code>Object.prototype.__proto__</code> å±æ€§åœ¨æœªä¿®æ”¹çš„æƒ…å†µä¸‹ä¸º null å€¼ã€‚æ ¹æ®å›¾ä¸Šçš„åŸç†ï¼Œæˆ‘ä»¬æ¥æ¢³ç†ä¸Šé¢æåˆ°çš„å‡ ä¸ªæœ‰è¶£çš„ <code>instanceof</code> ä½¿ç”¨çš„ä¾‹å­ã€‚</p>
<p><code>Object instanceof Object</code></p>
<p>ç”±å›¾å¯çŸ¥ï¼ŒObject çš„ <code>prototype</code> å±æ€§æ˜¯ <code>Object.prototype</code>, è€Œç”±äº Object æœ¬èº«æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç”± Function æ‰€åˆ›å»ºï¼Œæ‰€ä»¥ <code>Object.__proto__</code> çš„å€¼æ˜¯ <code>Function.prototype</code>ï¼Œè€Œ <code>Function.prototype</code> çš„ <code>__proto__</code> å±æ€§æ˜¯ <code>Object.prototype</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ¤æ–­å‡ºï¼Œ<code>Object instanceof Object</code> çš„ç»“æœæ˜¯ true ã€‚ç”¨ä»£ç ç®€å•çš„è¡¨ç¤ºä¸€ä¸‹</p>
<pre><code>leftValue =Object.__proto__ =Function.prototype;
rightValue =Object.prototype;
// ç¬¬ä¸€æ¬¡åˆ¤æ–­
leftValue != rightValue
leftValue =Function.prototype.__proto__ =Object.prototype
// ç¬¬äºŒæ¬¡åˆ¤æ–­
leftValue === rightValue
// è¿”å› true
</code></pre><p><code>Function instanceof Function</code> å’Œ <code>Function instanceof Object</code> çš„è¿è¡Œè¿‡ç¨‹ä¸ <code>Object instanceof Object</code> ç±»ä¼¼ï¼Œæ•…ä¸å†è¯¦è¯´ã€‚</p>
<p><code>Foo instanceof Foo</code></p>
<p>Foo å‡½æ•°çš„ <code>prototype</code> å±æ€§æ˜¯ <code>Foo.prototype</code>ï¼Œè€Œ Foo çš„ <code>__proto__</code> å±æ€§æ˜¯ <code>Function.prototype</code>ï¼Œç”±å›¾å¯çŸ¥ï¼ŒFoo çš„åŸå‹é“¾ä¸Šå¹¶æ²¡æœ‰ <code>Foo.prototype</code> ï¼Œå› æ­¤ <code>Foo instanceof Foo</code> ä¹Ÿå°±è¿”å› false ã€‚</p>
<p>æˆ‘ä»¬ç”¨ä»£ç ç®€å•çš„è¡¨ç¤ºä¸€ä¸‹</p>
<pre><code>leftValue =Foo, rightValue =Foo
leftValue =Foo.__proto =Function.prototype
rightValue =Foo.prototype
// ç¬¬ä¸€æ¬¡åˆ¤æ–­
leftValue != rightValue
leftValue =Function.prototype.__proto__ =Object.prototype
// ç¬¬äºŒæ¬¡åˆ¤æ–­
leftValue != rightValue
leftValue =Object.prototype =null
// ç¬¬ä¸‰æ¬¡åˆ¤æ–­
leftValue ===null
// è¿”å› false
</code></pre><p><code>Foo instanceof Object</code></p>
<pre><code>leftValue =Foo, rightValue =Object
leftValue =Foo.__proto__ =Function.prototype
rightValue =Object.prototype
// ç¬¬ä¸€æ¬¡åˆ¤æ–­
leftValue != rightValue
leftValue =Function.prototype.__proto__ =Object.prototype
// ç¬¬äºŒæ¬¡åˆ¤æ–­
leftValue === rightValue
// è¿”å› true 
</code></pre><p><code>Foo instanceof Function</code></p>
<pre><code>leftValue =Foo, rightValue =Function
leftValue =Foo.__proto__ =Function.prototype
rightValue =Function.prototype
// ç¬¬ä¸€æ¬¡åˆ¤æ–­
leftValue === rightValue
// è¿”å› true 
</code></pre><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ç®€å•æ¥è¯´ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>typeof</code> æ¥åˆ¤æ–­åŸºæœ¬æ•°æ®ç±»å‹æ˜¯ ok çš„ï¼Œä¸è¿‡éœ€è¦æ³¨æ„å½“ç”¨ <code>typeof</code> æ¥åˆ¤æ–­ <code>null</code> ç±»å‹æ—¶çš„é—®é¢˜ï¼Œå¦‚æœæƒ³è¦åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡çš„å…·ä½“ç±»å‹å¯ä»¥è€ƒè™‘ç”¨ <code>instanceof</code>ï¼Œä½†æ˜¯ <code>instanceof</code> ä¹Ÿå¯èƒ½åˆ¤æ–­ä¸å‡†ç¡®ï¼Œæ¯”å¦‚ä¸€ä¸ªæ•°ç»„ï¼Œä»–å¯ä»¥è¢« <code>instanceof</code> åˆ¤æ–­ä¸º Objectã€‚æ‰€ä»¥æˆ‘ä»¬è¦æƒ³æ¯”è¾ƒå‡†ç¡®çš„åˆ¤æ–­å¯¹è±¡å®ä¾‹çš„ç±»å‹æ—¶ï¼Œå¯ä»¥é‡‡å– <code>Object.prototype.toString.call</code> æ–¹æ³•ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/03/ä½ å¯èƒ½ä¼šå¿½ç•¥çš„vue-routeræŠ€å·§/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/03/ä½ å¯èƒ½ä¼šå¿½ç•¥çš„vue-routeræŠ€å·§/" itemprop="url">ä½ å¯èƒ½ä¼šå¿½ç•¥çš„vue-routeræŠ€å·§</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-10-03T12:50:52+08:00">
                2018-10-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="è¯´åˆ°Vueæƒé™æ§åˆ¶ï¼Œä½ å¯èƒ½ä¼šç¬¬ä¸€ä¸ªæƒ³åˆ°"><a href="#è¯´åˆ°Vueæƒé™æ§åˆ¶ï¼Œä½ å¯èƒ½ä¼šç¬¬ä¸€ä¸ªæƒ³åˆ°" class="headerlink" title="è¯´åˆ°Vueæƒé™æ§åˆ¶ï¼Œä½ å¯èƒ½ä¼šç¬¬ä¸€ä¸ªæƒ³åˆ°"></a>è¯´åˆ°Vueæƒé™æ§åˆ¶ï¼Œä½ å¯èƒ½ä¼šç¬¬ä¸€ä¸ªæƒ³åˆ°</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Created by superman on 17/2/16.</span><br><span class="line"> * httpé…ç½®</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">import axios from &apos;axios&apos;</span><br><span class="line">import store from &apos;./store/store&apos;</span><br><span class="line">import * as types from &apos;./store/types&apos;</span><br><span class="line">import router from &apos;./router&apos;</span><br><span class="line"></span><br><span class="line">// axios é…ç½®</span><br><span class="line">axios.defaults.timeout = 5000;</span><br><span class="line">axios.defaults.baseURL = &apos;https://api.github.com&apos;;</span><br><span class="line"></span><br><span class="line">// http request æ‹¦æˆªå™¨</span><br><span class="line">axios.interceptors.request.use(</span><br><span class="line">    config =&gt; &#123;</span><br><span class="line">        if (store.state.token) &#123;</span><br><span class="line">            config.headers.Authorization = `token $&#123;store.state.token&#125;`;</span><br><span class="line">        &#125;</span><br><span class="line">        return config;</span><br><span class="line">    &#125;,</span><br><span class="line">    err =&gt; &#123;</span><br><span class="line">        return Promise.reject(err);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">// http response æ‹¦æˆªå™¨</span><br><span class="line">axios.interceptors.response.use(</span><br><span class="line">    response =&gt; &#123;</span><br><span class="line">        return response;</span><br><span class="line">    &#125;,</span><br><span class="line">    error =&gt; &#123;</span><br><span class="line">        if (error.response) &#123;</span><br><span class="line">            switch (error.response.status) &#123;</span><br><span class="line">                case 401:</span><br><span class="line">                    // 401 æ¸…é™¤tokenä¿¡æ¯å¹¶è·³è½¬åˆ°ç™»å½•é¡µé¢</span><br><span class="line">                    store.commit(types.LOGOUT);</span><br><span class="line">                    router.replace(&#123;</span><br><span class="line">                        path: &apos;login&apos;,</span><br><span class="line">                        query: &#123;redirect: router.currentRoute.fullPath&#125;</span><br><span class="line">                    &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        // console.log(JSON.stringify(error));//console : Error: Request failed with status code 402</span><br><span class="line">        return Promise.reject(error.response.data)</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">export default axios;</span><br></pre></td></tr></table></figure>
<h3 id="VueRouter"><a href="#VueRouter" class="headerlink" title="VueRouter"></a>VueRouter</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">const router = new VueRouter(&#123;</span><br><span class="line">    routes</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.beforeEach((to, from, next) =&gt; &#123;</span><br><span class="line">    if (to.path == &apos;/login&apos;) &#123;</span><br><span class="line">         //æ¸…é™¤token</span><br><span class="line">         ...</span><br><span class="line">    &#125;</span><br><span class="line">    let token = get(&apos;token&apos;);   //è·å–token</span><br><span class="line">    if (!token &amp;&amp; to.path != &apos;/login&apos;) &#123;</span><br><span class="line">        next(&#123; path: &apos;/login&apos; &#125;)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        next()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="ä½†ä¸Šé¢çš„åªèƒ½å¯¹ç™»å½•æ‹¦æˆª-è·³è½¬æ‹¦æˆªï¼Œä¸èƒ½æ§åˆ¶useræƒé™ï¼Œæœ€å¥½çš„æ–¹å¼æ˜¯åŠ¨æ€æ³¨å…¥è·¯ç”±addRoutes"><a href="#ä½†ä¸Šé¢çš„åªèƒ½å¯¹ç™»å½•æ‹¦æˆª-è·³è½¬æ‹¦æˆªï¼Œä¸èƒ½æ§åˆ¶useræƒé™ï¼Œæœ€å¥½çš„æ–¹å¼æ˜¯åŠ¨æ€æ³¨å…¥è·¯ç”±addRoutes" class="headerlink" title="ä½†ä¸Šé¢çš„åªèƒ½å¯¹ç™»å½•æ‹¦æˆª,è·³è½¬æ‹¦æˆªï¼Œä¸èƒ½æ§åˆ¶useræƒé™ï¼Œæœ€å¥½çš„æ–¹å¼æ˜¯åŠ¨æ€æ³¨å…¥è·¯ç”±addRoutes"></a>ä½†ä¸Šé¢çš„åªèƒ½å¯¹ç™»å½•æ‹¦æˆª,è·³è½¬æ‹¦æˆªï¼Œä¸èƒ½æ§åˆ¶useræƒé™ï¼Œæœ€å¥½çš„æ–¹å¼æ˜¯åŠ¨æ€æ³¨å…¥è·¯ç”±<strong><font color="#dd0000">addRoutes</font></strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import router from &apos;./router&apos;</span><br><span class="line">router.addRoutes(routes)</span><br><span class="line">æˆ–è€…</span><br><span class="line">this.$router.addRoutes(routers)</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/03/Vueæ‰‹åŠ¿åº“/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/03/Vueæ‰‹åŠ¿åº“/" itemprop="url">Vueæ‰‹åŠ¿åº“</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-10-03T12:48:23+08:00">
                2018-10-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">function vueTouch(el, binding, type) &#123;</span><br><span class="line">	var _this = this;</span><br><span class="line">	this.obj = el;</span><br><span class="line">	this.binding = binding;</span><br><span class="line">	this.touchType = type;</span><br><span class="line">	this.vueTouches = &#123;</span><br><span class="line">		x: 0,</span><br><span class="line">		y: 0</span><br><span class="line">	&#125;;</span><br><span class="line">	this.vueMoves = true;</span><br><span class="line">	this.vueLeave = true;</span><br><span class="line">	this.longTouch = true;</span><br><span class="line"></span><br><span class="line">	this.vueCallBack = typeof(binding.value) == &quot;object&quot; ? binding.value.fn : binding.value;</span><br><span class="line"></span><br><span class="line">	this.obj.addEventListener(&quot;touchstart&quot;, function(e) &#123;</span><br><span class="line">		_this.start(e);</span><br><span class="line">	&#125;, false);</span><br><span class="line"></span><br><span class="line">	this.obj.addEventListener(&quot;touchmove&quot;, function(e) &#123;</span><br><span class="line">		_this.move(e);</span><br><span class="line">	&#125;, false);</span><br><span class="line"></span><br><span class="line">	this.obj.addEventListener(&quot;touchend&quot;, function(e) &#123;</span><br><span class="line">		_this.end(e);</span><br><span class="line">	&#125;, false);</span><br><span class="line">&#125;;</span><br><span class="line">vueTouch.prototype = &#123;</span><br><span class="line">	start(e) &#123;</span><br><span class="line">		this.vueMoves = true;</span><br><span class="line">		this.vueLeave = true;</span><br><span class="line">		this.longTouch = true;</span><br><span class="line">		this.vueTouches = &#123;</span><br><span class="line">			x: e.changedTouches[0].pageX,</span><br><span class="line">			y: e.changedTouches[0].pageY</span><br><span class="line">		&#125;;</span><br><span class="line">		this.time = setTimeout(function() &#123;</span><br><span class="line">			if(this.vueLeave &amp;&amp; this.vueMoves) &#123;</span><br><span class="line">				this.touchType == &quot;longtap&quot; &amp;&amp; this.vueCallBack(this.binding.value, e);</span><br><span class="line">				this.longTouch = false;</span><br><span class="line">			&#125;;</span><br><span class="line">		&#125;.bind(this), 1000);</span><br><span class="line">	&#125;,</span><br><span class="line">	end(e) &#123;</span><br><span class="line">		var disX = e.changedTouches[0].pageX - this.vueTouches.x;</span><br><span class="line">		var disY = e.changedTouches[0].pageY - this.vueTouches.y;</span><br><span class="line">		clearTimeout(this.time);</span><br><span class="line">		if(Math.abs(disX) &gt; 10 || Math.abs(disY) &gt; 100) &#123;</span><br><span class="line">			this.touchType == &quot;swipe&quot; &amp;&amp; this.vueCallBack(this.binding.value, e);</span><br><span class="line">			if(Math.abs(disX) &gt; Math.abs(disY)) &#123;</span><br><span class="line">				if(disX &gt; 10) &#123;</span><br><span class="line">					this.touchType == &quot;swiperight&quot; &amp;&amp; this.vueCallBack(this.binding.value, e);</span><br><span class="line">				&#125;;</span><br><span class="line">				if(disX &lt; -10) &#123;</span><br><span class="line">					this.touchType == &quot;swipeleft&quot; &amp;&amp; this.vueCallBack(this.binding.value, e);</span><br><span class="line">				&#125;;</span><br><span class="line">			&#125; else &#123;</span><br><span class="line">				if(disY &gt; 10) &#123;</span><br><span class="line">					this.touchType == &quot;swipedown&quot; &amp;&amp; this.vueCallBack(this.binding.value, e);</span><br><span class="line">				&#125;;</span><br><span class="line">				if(disY &lt; -10) &#123;</span><br><span class="line">					this.touchType == &quot;swipeup&quot; &amp;&amp; this.vueCallBack(this.binding.value, e);</span><br><span class="line">				&#125;;</span><br><span class="line">			&#125;;</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			if(this.longTouch &amp;&amp; this.vueMoves) &#123;</span><br><span class="line">				this.touchType == &quot;tap&quot; &amp;&amp; this.vueCallBack(this.binding.value, e);</span><br><span class="line">				this.vueLeave = false</span><br><span class="line">			&#125;;</span><br><span class="line">		&#125;;</span><br><span class="line">	&#125;,</span><br><span class="line">	move(e) &#123;</span><br><span class="line">		this.vueMoves = false;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Vue.directive(&quot;tap&quot;, &#123;</span><br><span class="line">	bind: function(el, binding) &#123;</span><br><span class="line">		new vueTouch(el, binding, &quot;tap&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br><span class="line">Vue.directive(&quot;swipe&quot;, &#123;</span><br><span class="line">	bind: function(el, binding) &#123;</span><br><span class="line">		new vueTouch(el, binding, &quot;swipe&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br><span class="line">Vue.directive(&quot;swipeleft&quot;, &#123;</span><br><span class="line">	bind: function(el, binding) &#123;</span><br><span class="line">		new vueTouch(el, binding, &quot;swipeleft&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br><span class="line">Vue.directive(&quot;swiperight&quot;, &#123;</span><br><span class="line">	bind: function(el, binding) &#123;</span><br><span class="line">		new vueTouch(el, binding, &quot;swiperight&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br><span class="line">Vue.directive(&quot;swipedown&quot;, &#123;</span><br><span class="line">	bind: function(el, binding) &#123;</span><br><span class="line">		new vueTouch(el, binding, &quot;swipedown&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br><span class="line">Vue.directive(&quot;swipeup&quot;, &#123;</span><br><span class="line">	bind: function(el, binding) &#123;</span><br><span class="line">		new vueTouch(el, binding, &quot;swipeup&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br><span class="line">Vue.directive(&quot;longtap&quot;, &#123;</span><br><span class="line">	bind: function(el, binding) &#123;</span><br><span class="line">		new vueTouch(el, binding, &quot;longtap&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html id=&quot;html&quot;&gt;</span><br><span class="line"></span><br><span class="line">	&lt;head&gt;</span><br><span class="line">		&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot; /&gt;</span><br><span class="line">		&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no&quot; /&gt;</span><br><span class="line">		&lt;title&gt;&lt;/title&gt;</span><br><span class="line">		&lt;style&gt;</span><br><span class="line">			.box &#123;</span><br><span class="line">				width: 250px;</span><br><span class="line">				height: 250px;</span><br><span class="line">				background-color: red;</span><br><span class="line">				color: #FFFFFF;</span><br><span class="line">				text-align: center;</span><br><span class="line">				line-height: 250px;</span><br><span class="line">				font-size: 30px;</span><br><span class="line">				position: absolute;</span><br><span class="line">				margin: auto;</span><br><span class="line">				left: 0;</span><br><span class="line">				right: 0;</span><br><span class="line">				top: 0;</span><br><span class="line">				bottom: 0;</span><br><span class="line">			&#125;</span><br><span class="line">		&lt;/style&gt;</span><br><span class="line">		&lt;script src=&quot;js/vue.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">		&lt;script type=&quot;text/javascript&quot; src=&quot;js/vue-touch.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">	&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">	&lt;body&gt;</span><br><span class="line">		&lt;div id=&quot;app&quot; class=&quot;box&quot; v-tap=&quot;&#123;fn:vuetap,name:&apos;ç‚¹å‡»&apos;&#125;&quot; v-longtap=&quot;&#123;fn:vuetap,name:&apos;é•¿æŒ‰&apos;&#125;&quot; v-swipeleft=&quot;&#123;fn:vuetap,name:&apos;å·¦æ»‘&apos;&#125;&quot; v-swiperight=&quot;&#123;fn:vuetap,name:&apos;å³æ»‘&apos;&#125;&quot; v-swipeup=&quot;&#123;fn:vuetap,name:&apos;ä¸Šæ»‘&apos;&#125;&quot; v-swipedown=&quot;&#123;fn:vuetap,name:&apos;ä¸‹æ»‘&apos;&#125;&quot;&gt;</span><br><span class="line">			&#123;&#123; name &#125;&#125;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">		&lt;!--</span><br><span class="line">	vuetouchä¸ºå‡½æ•°åï¼Œå¦‚æ²¡æœ‰å‚æ•°ï¼Œå¯ç›´æ¥å†™å‡½æ•°å,æ¯”å¦‚ï¼šv-tap=&quot;vuetap&quot;</span><br><span class="line">	å¦‚æœæœ‰å‚æ•°ä»¥å¯¹è±¡å½¢å¼ä¼ ï¼Œfn ä¸ºå‡½æ•°å</span><br><span class="line">--&gt;</span><br><span class="line">		&lt;script&gt;</span><br><span class="line">			kim = new Vue(&#123;</span><br><span class="line">				el: &quot;#app&quot;,</span><br><span class="line">				data: &#123;</span><br><span class="line">					name: &quot;å¼€å§‹&quot;</span><br><span class="line">				&#125;,</span><br><span class="line">				methods: &#123;</span><br><span class="line">					vuetap: function(s, e) &#123;</span><br><span class="line">						console.log(e)</span><br><span class="line">						this.name = s.name;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;);</span><br><span class="line">		&lt;/script&gt;</span><br><span class="line">	&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/03/async-await-å°æŠ€å·§/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/03/async-await-å°æŠ€å·§/" itemprop="url">async/await å°æŠ€å·§</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-10-03T11:58:49+08:00">
                2018-10-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="async-await-å°æŠ€å·§"><a href="#async-await-å°æŠ€å·§" class="headerlink" title="async/await å°æŠ€å·§"></a>async/await å°æŠ€å·§</h1><h2 id="sleep-å‡½æ•°"><a href="#sleep-å‡½æ•°" class="headerlink" title="sleep å‡½æ•°"></a>sleep å‡½æ•°</h2><p>ä»¥å‰åªæ¥ä½¿ç”¨ <code>setTimeout</code> å’Œå›è°ƒå‡½æ•°å®ç°ä¸€ä¸ª <code>sleep</code> ä¼šæœ‰å¾ˆå¤šçš„å‰¯ä½œç”¨ï¼Œç”¨èµ·æ¥å¾ˆä¸æ–¹ä¾¿ã€‚</p>
<p>æ‰€ä»¥è®© <code>setTimeout</code> æ­é…ä½¿ç”¨ <code>async/await</code></p>
<pre><code>constsleep=delay=&gt; {
  returnnewPromise(resolve=&gt; {
    setTimeout(resolve, delay)
  })
}

constfn=async_=&gt; {
  console.log(&apos;starting....&apos;)
  awaitsleep(1000)
  console.log(&apos;after sleeping for 1 second&apos;)
}
</code></pre><h2 id="æ­é…-map-å‡½æ•°"><a href="#æ­é…-map-å‡½æ•°" class="headerlink" title="æ­é… map() å‡½æ•°"></a>æ­é… map() å‡½æ•°</h2><p>åœ¨ <code>map</code> ä¸­å¼•å…¥å¼‚æ­¥å¤„ç†:</p>
<pre><code>constarr= [1,2,3,4,5]
constasyncFn=data=&gt; {
  // å¼‚æ­¥å¤„ç†å‡½æ•°
}

constresults=arr.map(asyncnum=&gt; {
  awaitasyncFn(num)
  return++num
})

console.log(results)
</code></pre><p>ä»£ç æ‰§è¡Œåçš„ç»“æœ <code>[Promise, Promise, Promise, Promise, Promise]</code> è€Œä¸” <code>map</code> å‡½æ•°å¹¶ä¸ä¼šç­‰å¼‚æ­¥å‡½æ•° <code>asyncFn</code> æ‰§è¡Œå®Œæ¯•åå†è¿”å›ç»“æœ</p>
<p>æ—¢ç„¶ <code>async</code> æ‰§è¡Œåä¼šè¿”å›ä¸€ä¸ª <code>Promise</code> å¯¹è±¡ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡ <code>Promise.all</code> çš„çŠ¶æ€æ¥åˆ¤æ–­å¼‚æ­¥å‡½æ•°çš„çŠ¶æ€:</p>
<pre><code>constarr= [1,2,3,4,5]
constasyncFn=data=&gt; {
  // å¼‚æ­¥å¤„ç†å‡½æ•°
}
constp=arr.map(asyncnum=&gt; {
  awaitasyncFn(num)
  return++num
})

Promise.all(p).then(results=&gt; {
  console.log(results)
})
</code></pre><p>è¿™æ ·å°±èƒ½æ­£å¸¸è¿”å›ç»“æœ <code>[2, 3, 4, 5, 6]</code></p>
<h2 id="ä½¿ç”¨-await-ä»£æ›¿-then-å‡½æ•°"><a href="#ä½¿ç”¨-await-ä»£æ›¿-then-å‡½æ•°" class="headerlink" title="ä½¿ç”¨ await ä»£æ›¿ then() å‡½æ•°"></a>ä½¿ç”¨ await ä»£æ›¿ then() å‡½æ•°</h2><p>ä¸Šé¢çš„ä¾‹å­æœ€åä½¿ç”¨äº† <code>Promise.all</code>  è¿˜æ˜¯å›åˆ°äº†ä½¿ç”¨å›è°ƒå‡½æ•°çš„æ–¹å¼</p>
<p>è¿™ä¸ªä¹Ÿå¾ˆå¥½è§£å†³ï¼Œåªéœ€è¦åœ¨å¤–å±‚å†åŠ ä¸€ä¸ª <code>async</code> å‡½æ•°</p>
<pre><code>constmain=async_=&gt; {
  constresults=awaitPromise.all(arr.map(num=&gt; {
    awaitasyncFn()
    return++num
  }))
  console.log(results)
}

main()
</code></pre><h2 id="æ­é…-reduce-å‡½æ•°"><a href="#æ­é…-reduce-å‡½æ•°" class="headerlink" title="æ­é… reduce() å‡½æ•°"></a>æ­é… reduce() å‡½æ•°</h2><p>é€šè¿‡å¼•å…¥ <code>async/await</code> å¯ä»¥æŠŠ <code>reduce</code> æ‰©å±•æˆä¸€ä¸ªæŒ‰é¡ºåºæ‰§è¡Œå¼‚æ­¥å‡½æ•°çš„å·¥å…·</p>
<p><code>reduce</code> ç”¨èµ·æ¥å¾ˆç®€å•:</p>
<pre><code>constarr= [1,2,3,4,5]
constresult=arr.reduce((prev, next) =&gt; {
  return prev+next
}, 0)

console.log(result)
</code></pre><p>åƒ <code>map</code> å‡½æ•°ä¸€æ ·å¼•å…¥ <code>async/await</code> :</p>
<pre><code>constarr= [1,2,3,4,5]
constmain=async_=&gt; {
  constresult=awaitarr.reduce(async (prev, next) =&gt; {
    consttmp=await prev
    return tmp + next
  }, Promise.resolve(0))

  console.log(result)
}

main()
</code></pre><p>è€Œä¸”è¿˜å¯ä»¥åœ¨ <code>reduce</code> å†…éƒ¨åŠ å…¥å¼‚æ­¥å‡½æ•°:</p>
<pre><code>constarr= [1,2,3,4,5]
constmain=async_=&gt; {
  constresult=awaitarr.reduce(async (prev, next) =&gt; {
    consttmp=await prev

    // å¼‚æ­¥å¤„ç† æš‚åœ1sawaitsleep(1000)
    console.log(tmp + next)

    return tmp + next
  }, Promise.resolve(0))
}

main()
</code></pre><p>ä¸Šè¿°ä»£ç ä¼šæ¯éš”ä¸€ç§’ä¾æ¬¡æ‰“å‡º 1 3 6 10 15</p>
<p>å‚è€ƒè‡ª</p>
<blockquote>
<p><a href="http://2ality.com/2016/10/async-function-tips.html" target="_blank" rel="noopener">http://2ality.com/2016/10/async-function-tips.html</a></p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/03/Event-Loop-å¿…çŸ¥å¿…ä¼šï¼ˆå…­é“é¢˜ï¼‰/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/03/Event-Loop-å¿…çŸ¥å¿…ä¼šï¼ˆå…­é“é¢˜ï¼‰/" itemprop="url">Event Loop å¿…çŸ¥å¿…ä¼šï¼ˆå…­é“é¢˜ï¼‰</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-10-03T11:48:09+08:00">
                2018-10-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ä¸€ç›´æƒ³å†™ä¸€ç¯‡å…³äº Event Loop çš„æ–‡ç« ï¼Œå‰ä¸ä¹…å‘ç° CNode ä¸Šæœ‰ä½åŒå­¦å†™äº†ä¸€ç¯‡åŸç†åˆ†æçš„<a href="https://link.zhihu.com/?target=https%3A//cnodejs.org/topic/5a9108d78d6e16e56bb80882%235a98d9a2ce1c90bc44c445af" target="_blank" rel="noopener">æ–‡ç« </a>å¾ˆè¯¦ç»†ï¼Œè¿™é‡Œæˆ‘å°±ä¸çŒ®ä¸‘äº†ã€‚æœ¬æ–‡å°±æ‹¿å‡ºå…­é“é¢˜æ¥è¡¥å……ä¸€ä¸‹ï¼Œæ”¾å‡ºä¸€å¼ æˆ‘è®¤ä¸ºéå¸¸ç›´è§‚çš„å›¾ã€‚<br><img src="https://pic4.zhimg.com/v2-3a59c624e6ff95a7e8c5a23c979f5abe_b.jpg" alt=""><img src="https://pic4.zhimg.com/80/v2-3a59c624e6ff95a7e8c5a23c979f5abe_hd.jpg" alt=""><br>ç»¿è‰²å°å—æ˜¯ macrotaskï¼ˆå®ä»»åŠ¡ï¼‰ï¼Œmacrotask ä¸­é—´çš„ç²‰çº¢ç®­å¤´æ˜¯ microtaskï¼ˆå¾®ä»»åŠ¡ï¼‰ã€‚</p>
<h2 id="é¢˜ç›®ä¸€"><a href="#é¢˜ç›®ä¸€" class="headerlink" title="é¢˜ç›®ä¸€"></a>é¢˜ç›®ä¸€</h2><pre><code>setTimeout(()=&gt;{console.log(&apos;setTimeout&apos;)},0)setImmediate(()=&gt;{console.log(&apos;setImmediate&apos;)})
</code></pre><p>è¿è¡Œç»“æœï¼š</p>
<pre><code>setImmediate
setTimeout
</code></pre><p>æˆ–è€…ï¼š</p>
<pre><code>setTimeout
setImmediate
</code></pre><p>ä¸ºä»€ä¹ˆç»“æœä¸ç¡®å®šå‘¢ï¼Ÿ</p>
<p>è§£é‡Šï¼šsetTimeout/setInterval çš„ç¬¬äºŒä¸ªå‚æ•°å–å€¼èŒƒå›´æ˜¯ï¼š[1, 2^31 - 1]ï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªèŒƒå›´åˆ™ä¼šåˆå§‹åŒ–ä¸º 1ï¼Œå³ setTimeout(fn, 0) === setTimeout(fn, 1)ã€‚æˆ‘ä»¬çŸ¥é“ setTimeout çš„å›è°ƒå‡½æ•°åœ¨ timer é˜¶æ®µæ‰§è¡Œï¼ŒsetImmediate çš„å›è°ƒå‡½æ•°åœ¨ check é˜¶æ®µæ‰§è¡Œï¼Œevent loop çš„å¼€å§‹ä¼šå…ˆæ£€æŸ¥ timer é˜¶æ®µï¼Œä½†æ˜¯åœ¨å¼€å§‹ä¹‹å‰åˆ° timer é˜¶æ®µä¼šæ¶ˆè€—ä¸€å®šæ—¶é—´ï¼Œæ‰€ä»¥å°±ä¼šå‡ºç°ä¸¤ç§æƒ…å†µï¼š</p>
<ol>
<li>timer å‰çš„å‡†å¤‡æ—¶é—´è¶…è¿‡ 1msï¼Œæ»¡è¶³  loop-&gt;time &gt;= 1ï¼Œåˆ™æ‰§è¡Œ timer é˜¶æ®µï¼ˆsetTimeoutï¼‰çš„å›è°ƒå‡½æ•°</li>
<li>timer å‰çš„å‡†å¤‡æ—¶é—´å°äº 1msï¼Œåˆ™å…ˆæ‰§è¡Œ check é˜¶æ®µï¼ˆsetImmediateï¼‰çš„å›è°ƒå‡½æ•°ï¼Œä¸‹ä¸€æ¬¡ event loop æ‰§è¡Œ timer é˜¶æ®µï¼ˆsetTimeoutï¼‰çš„å›è°ƒå‡½æ•°</li>
</ol>
<p>å†çœ‹ä¸ªä¾‹å­ï¼š</p>
<pre><code>setTimeout(()=&gt;{console.log(&apos;setTimeout&apos;)},0)setImmediate(()=&gt;{console.log(&apos;setImmediate&apos;)})conststart=Date.now()while(Date.now()-start&lt;10);
</code></pre><p>è¿è¡Œç»“æœä¸€å®šæ˜¯ï¼š</p>
<pre><code>setTimeout
setImmediate
</code></pre><h2 id="é¢˜ç›®äºŒ"><a href="#é¢˜ç›®äºŒ" class="headerlink" title="é¢˜ç›®äºŒ"></a>é¢˜ç›®äºŒ</h2><pre><code>constfs=require(&apos;fs&apos;)fs.readFile(__filename,()=&gt;{setTimeout(()=&gt;{console.log(&apos;setTimeout&apos;)},0)setImmediate(()=&gt;{console.log(&apos;setImmediate&apos;)})})
</code></pre><p>è¿è¡Œç»“æœï¼š</p>
<pre><code>setImmediate
setTimeout
</code></pre><p>è§£é‡Šï¼šfs.readFile çš„å›è°ƒå‡½æ•°æ‰§è¡Œå®Œåï¼š</p>
<ol>
<li>æ³¨å†Œ setTimeout çš„å›è°ƒå‡½æ•°åˆ° timer é˜¶æ®µ</li>
<li>æ³¨å†Œ setImmediate çš„å›è°ƒå‡½æ•°åˆ° check é˜¶æ®µ</li>
<li>event loop ä» pool é˜¶æ®µå‡ºæ¥ç»§ç»­å¾€ä¸‹ä¸€ä¸ªé˜¶æ®µæ‰§è¡Œï¼Œæ°å¥½æ˜¯ check é˜¶æ®µï¼Œæ‰€ä»¥ setImmediate çš„å›è°ƒå‡½æ•°å…ˆæ‰§è¡Œ</li>
<li>æœ¬æ¬¡ event loop ç»“æŸåï¼Œè¿›å…¥ä¸‹ä¸€æ¬¡ event loopï¼Œæ‰§è¡Œ setTimeout çš„å›è°ƒå‡½æ•°</li>
</ol>
<p>æ‰€ä»¥ï¼Œåœ¨ I/O Callbacks ä¸­æ³¨å†Œçš„ setTimeout å’Œ setImmediateï¼Œæ°¸è¿œéƒ½æ˜¯ setImmediate å…ˆæ‰§è¡Œã€‚</p>
<h2 id="é¢˜ç›®ä¸‰"><a href="#é¢˜ç›®ä¸‰" class="headerlink" title="é¢˜ç›®ä¸‰"></a>é¢˜ç›®ä¸‰</h2><pre><code>setInterval(()=&gt;{console.log(&apos;setInterval&apos;)},100)process.nextTick(functiontick(){process.nextTick(tick)})
</code></pre><p>è¿è¡Œç»“æœï¼šsetInterval æ°¸è¿œä¸ä¼šæ‰“å°å‡ºæ¥ã€‚</p>
<p>è§£é‡Šï¼šprocess.nextTick ä¼šæ— é™å¾ªç¯ï¼Œå°† event loop é˜»å¡åœ¨ microtask é˜¶æ®µï¼Œå¯¼è‡´ event loop ä¸Šå…¶ä»– macrotask é˜¶æ®µçš„å›è°ƒå‡½æ•°æ²¡æœ‰æœºä¼šæ‰§è¡Œã€‚</p>
<p>è§£å†³æ–¹æ³•é€šå¸¸æ˜¯ç”¨ setImmediate æ›¿ä»£ process.nextTickï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code>setInterval(()=&gt;{console.log(&apos;setInterval&apos;)},100)setImmediate(functionimmediate(){setImmediate(immediate)})
</code></pre><p>è¿è¡Œç»“æœï¼šæ¯ 100ms æ‰“å°ä¸€æ¬¡ setIntervalã€‚</p>
<p>è§£é‡Šï¼šprocess.nextTick å†…æ‰§è¡Œ process.nextTick ä»ç„¶å°† tick å‡½æ•°æ³¨å†Œåˆ°å½“å‰ microtask çš„å°¾éƒ¨ï¼Œæ‰€ä»¥å¯¼è‡´ microtask æ°¸è¿œæ‰§è¡Œä¸å®Œï¼› setImmediate å†…æ‰§è¡Œ setImmediate ä¼šå°† immediate å‡½æ•°æ³¨å†Œåˆ°ä¸‹ä¸€æ¬¡ event loop çš„ check é˜¶æ®µï¼Œè€Œä¸æ˜¯å½“å‰æ­£åœ¨æ‰§è¡Œçš„ check é˜¶æ®µï¼Œæ‰€ä»¥ç»™äº† event loop ä¸Šå…¶ä»– macrotask æ‰§è¡Œçš„æœºä¼šã€‚</p>
<p>å†çœ‹ä¸ªä¾‹å­ï¼š</p>
<pre><code>setImmediate(()=&gt;{console.log(&apos;setImmediate1&apos;)setImmediate(()=&gt;{console.log(&apos;setImmediate2&apos;)})process.nextTick(()=&gt;{console.log(&apos;nextTick&apos;)})})setImmediate(()=&gt;{console.log(&apos;setImmediate3&apos;)})
</code></pre><p>è¿è¡Œç»“æœï¼š</p>
<pre><code>setImmediate1
setImmediate3
nextTick
setImmediate2
</code></pre><p>æ³¨æ„ï¼šå¹¶ä¸æ˜¯è¯´ setImmediate å¯ä»¥å®Œå…¨æ›¿ä»£ process.nextTickï¼Œprocess.nextTick åœ¨ç‰¹å®šåœºæ™¯ä¸‹è¿˜æ˜¯æ— æ³•è¢«æ›¿ä»£çš„ï¼Œæ¯”å¦‚æˆ‘ä»¬å°±æƒ³å°†ä¸€äº›æ“ä½œæ”¾åˆ°æœ€è¿‘çš„ microtask é‡Œæ‰§è¡Œã€‚</p>
<h2 id="é¢˜ç›®å››"><a href="#é¢˜ç›®å››" class="headerlink" title="é¢˜ç›®å››"></a>é¢˜ç›®å››</h2><pre><code>constpromise=Promise.resolve().then(()=&gt;{returnpromise})promise.catch(console.error)
</code></pre><p>è¿è¡Œç»“æœï¼š</p>
<pre><code>TypeError: Chaining cycle detected for promise #&lt;Promise&gt;
    at &lt;anonymous&gt;
    at process._tickCallback (internal/process/next_tick.js:188:7)
    at Function.Module.runMain (module.js:667:11)
    at startup (bootstrap_node.js:187:16)
    at bootstrap_node.js:607:3
</code></pre><p>è§£é‡Šï¼špromise.then ç±»ä¼¼äº process.nextTickï¼Œéƒ½ä¼šå°†å›è°ƒå‡½æ•°æ³¨å†Œåˆ° microtask é˜¶æ®µã€‚ä¸Šé¢ä»£ç ä¼šå¯¼è‡´æ­»å¾ªç¯ï¼Œç±»ä¼¼å‰é¢æåˆ°çš„ï¼š</p>
<pre><code>process.nextTick(functiontick(){process.nextTick(tick)})
</code></pre><p>å†çœ‹ä¸ªä¾‹å­ï¼š</p>
<pre><code>constpromise=Promise.resolve()
promise.then(()=&gt;{
  console.log(&apos;promise&apos;)})
  process.nextTick(()=&gt;{
      console.log(&apos;nextTick&apos;)
  })
</code></pre><p>è¿è¡Œç»“æœï¼š</p>
<pre><code>nextTick
promise
</code></pre><p>è§£é‡Šï¼špromise.then è™½ç„¶å’Œ process.nextTick ä¸€æ ·ï¼Œéƒ½å°†å›è°ƒå‡½æ•°æ³¨å†Œåˆ° microtaskï¼Œä½†ä¼˜å…ˆçº§ä¸ä¸€æ ·ã€‚process.nextTick çš„ microtask queue æ€»æ˜¯ä¼˜å…ˆäº promise çš„ microtask queue æ‰§è¡Œã€‚</p>
<h2 id="é¢˜ç›®äº”"><a href="#é¢˜ç›®äº”" class="headerlink" title="é¢˜ç›®äº”"></a>é¢˜ç›®äº”</h2><pre><code>setTimeout(()=&gt;{
    console.log(1)
},0)
newPromise((resolve,reject)=&gt;{
   console.log(2)
   for(leti=0;i&lt;10000;i++){
     i===9999&amp;&amp;resolve()
   }
   console.log(3)
}).then(()=&gt;{
   console.log(4)
})
console.log(5)
</code></pre><p>è¿è¡Œç»“æœï¼š</p>
<p>è§£é‡Šï¼šPromise æ„é€ å‡½æ•°æ˜¯åŒæ­¥æ‰§è¡Œçš„ï¼Œæ‰€ä»¥å…ˆæ‰“å° 2ã€3ï¼Œç„¶åæ‰“å° 5ï¼Œæ¥ä¸‹æ¥ event loop è¿›å…¥æ‰§è¡Œ microtask é˜¶æ®µï¼Œæ‰§è¡Œ promise.then çš„å›è°ƒå‡½æ•°æ‰“å°å‡º 4ï¼Œç„¶åæ‰§è¡Œä¸‹ä¸€ä¸ª macrotaskï¼Œæ°å¥½æ˜¯ timer é˜¶æ®µçš„ setTimeout çš„å›è°ƒå‡½æ•°ï¼Œæ‰“å°å‡º 1ã€‚</p>
<h2 id="é¢˜ç›®å…­"><a href="#é¢˜ç›®å…­" class="headerlink" title="é¢˜ç›®å…­"></a>é¢˜ç›®å…­</h2><pre><code>setImmediate(()=&gt;{
    console.log(1)
    setTimeout(()=&gt;{
       console.log(2)
    },100)
    setImmediate(()=&gt;{
       console.log(3)
    })
    process.nextTick(
       ()=&gt;{console.log(4)})
     })
     process.nextTick(()=&gt;{
       console.log(5)
       setTimeout(()=&gt;{
        console.log(6)},100)
        setImmediate(()=&gt;{
        console.log(7)})
        process.nextTick(
        ()=&gt;{console.log(8)})
        })console.log(9)
</code></pre><p>è¿è¡Œç»“æœï¼š</p>
<p>process.nextTickã€setTimeout å’Œ setImmediate çš„ç»„åˆï¼Œè¯·è¯»è€…è‡ªå·±æ¨ç†å§ã€‚</p>
<h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><ul>
<li><a href="https://link.zhihu.com/?target=https%3A//medium.com/the-node-js-collection/what-you-should-know-to-really-understand-the-node-js-event-loop-and-its-metrics-c4907b19da4c" target="_blank" rel="noopener">https://medium.com/the-node-js-collection/what-you-should-know-to-really-understand-the-node-js-event-loop-and-its-metrics-c4907b19da4c</a></li>
<li><a href="https://link.zhihu.com/?target=https%3A//cnodejs.org/topic/57d68794cb6f605d360105bf" target="_blank" rel="noopener">https://cnodejs.org/topic/57d68794cb6f605d360105bf</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/03/ä½ ä¸çŸ¥é“çš„-Promise-å¯¹è±¡é»‘ç§‘æŠ€/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/03/ä½ ä¸çŸ¥é“çš„-Promise-å¯¹è±¡é»‘ç§‘æŠ€/" itemprop="url">ä½ ä¸çŸ¥é“çš„ Promise å¯¹è±¡é»‘ç§‘æŠ€</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-10-03T11:10:58+08:00">
                2018-10-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Promise-å¿…çŸ¥å¿…ä¼šï¼ˆåé“é¢˜ï¼‰"><a href="#Promise-å¿…çŸ¥å¿…ä¼šï¼ˆåé“é¢˜ï¼‰" class="headerlink" title="Promise å¿…çŸ¥å¿…ä¼šï¼ˆåé“é¢˜ï¼‰"></a><a href="https://libin1991.github.io/2018/09/25/Promise-%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/" target="_blank" rel="noopener">Promise å¿…çŸ¥å¿…ä¼šï¼ˆåé“é¢˜ï¼‰</a></h2><h2 id="ä¸€ã€resolve-åçš„æ‰§è¡Œæƒ…å†µ"><a href="#ä¸€ã€resolve-åçš„æ‰§è¡Œæƒ…å†µ" class="headerlink" title="ä¸€ã€resolve åçš„æ‰§è¡Œæƒ…å†µ"></a>ä¸€ã€resolve åçš„æ‰§è¡Œæƒ…å†µ</h2><p>æ— è®ºæ˜¯ resolve, rejectï¼Œéƒ½ä¼šå°†å‡½æ•°å‰©ä½™çš„ä»£ç æ‰§è¡Œå®Œ</p>
<pre><code>const promise = new Promise((resolve, reject) =&gt; {
    console.log(&apos;mark 1&apos;);
    resolve(&apos;hello world&apos;);     // reject(&apos;hello world&apos;);
    console.log(&apos;mark 2&apos;);
});

promise.then(result =&gt; {
    console.log(result);
}).catch(err =&gt; {
    console.log(err);
});
</code></pre><p>ç›¸å½“äºï¼š</p>
<pre><code>const promise = new Promise((resolve, reject) =&gt; {
    console.log(&apos;mark 1&apos;);
    console.log(&apos;mark 2&apos;);
    resolve(&apos;hello world&apos;);     // reject(&apos;hello world&apos;);
});

promise.then(result =&gt; {
    console.log(result);
}).catch(err =&gt; {
    console.log(err);
});
</code></pre><p>å¦‚æœä½ ä¸æƒ³åœ¨ resolve æˆ– reject åæ‰§è¡Œå‰©ä¸‹çš„ä»£ç æ®µï¼Œå¯ä»¥åœ¨ resolve åå°†å…¶è¿”å›<br><img src="https://pic4.zhimg.com/v2-f5b865c8a9df8ce752d057fe177c855e_b.jpg" alt=""><img src="https://pic4.zhimg.com/80/v2-f5b865c8a9df8ce752d057fe177c855e_hd.jpg" alt=""></p>
<pre><code>const promise = new Promise((resolve, reject) =&gt; {
    console.log(&apos;mark 1&apos;);
    return resolve(&apos;hello world&apos;);     // reject(&apos;hello world&apos;);
    console.log(&apos;mark 2&apos;);             // never be here
});

promise.then(result =&gt; {
    console.log(result);
}).catch(err =&gt; {
    console.log(err);
});
</code></pre><h2 id="äºŒã€ä¸²è¡Œæ‰§è¡Œå’Œå¹¶è¡Œæ‰§è¡Œï¼š"><a href="#äºŒã€ä¸²è¡Œæ‰§è¡Œå’Œå¹¶è¡Œæ‰§è¡Œï¼š" class="headerlink" title="äºŒã€ä¸²è¡Œæ‰§è¡Œå’Œå¹¶è¡Œæ‰§è¡Œï¼š"></a>äºŒã€ä¸²è¡Œæ‰§è¡Œå’Œå¹¶è¡Œæ‰§è¡Œï¼š</h2><ol>
<li>ä¸²è¡Œæ‰§è¡Œï¼šæœ‰ä¸€å † Promise å¯¹è±¡ï¼Œå®ƒä»¬çš„æ‰§è¡Œé¡ºåºæ˜¯å›ºå®šçš„ï¼Œå‰ä¸€ä¸ª promise æ‰§è¡Œå®Œåï¼Œåä¸€ä¸ª promise æ‰å¼€å§‹æ‰§è¡Œï¼Œæ¯”å¦‚æ•°æ®åº“æŸ¥è¯¢ï¼Œå®ƒä»¬å¾€å¾€æœ‰å‰åçš„å› æœå…³ç³»ã€‚</li>
<li>å¹¶è¡Œæ‰§è¡Œï¼šæœ‰ä¸€å † Promise å¯¹è±¡ï¼Œå®ƒä»¬çš„æ‰§è¡Œé¡ºåºæ˜¯ä¸å›ºå®šçš„ï¼Œæ²¡æœ‰å‰åå› æœå…³ç³»ï¼Œå¯ä»¥å¹¶å‘åœ°å»æ‰§è¡Œã€‚</li>
</ol>
<p>å¹¶è¡Œæ‰§è¡Œå¾ˆå¥½è§£å†³ï¼Œåœ¨ Promiseä¸­æœ‰ all è¿™ä¸ªå‡½æ•°æ”¯æŒ, Promise.all æ–¹æ³•ç”¨äºå°†å¤šä¸ª Promise å®ä¾‹ï¼ŒåŒ…è£…æˆä¸€ä¸ªæ–°çš„ Promise å®ä¾‹ã€‚å½“å¤šä¸ª Promise å®ä¾‹æ‰§è¡Œå®Œåæ‰å»æ‰§è¡Œæœ€åæ–°çš„ Promise å®ä¾‹ã€‚</p>
<pre><code>const datum = [];
for(let i = 0; i &lt; 10; i++) {
    datum.push(i);
}

Promise.all(datum.map(i =&gt; {
    return new Promise((resolve, reject) =&gt; {
    setTimeout(() =&gt; {
        console.log(i * 200 + &quot; ms åæ‰§è¡Œç»“æŸ&quot;);
        resolve(&quot;ç¬¬ &quot; + (i + 1) + &quot; ä¸ª Promise æ‰§è¡Œç»“æŸ&quot;);
    }, i * 200);
    })
})).then((data) =&gt; {
    console.log(data);
});
</code></pre><p>å¦‚æœä¸ä½¿ç”¨ Promise.all è¿™ä¸ªæ–¹æ³•çš„è¯ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨åƒ ES7 çš„ async/await</p>
<pre><code>const asyncFun = async () =&gt; {
    const datum = []
    for(let i = 0; i &lt; 10; i++) {
        datum.push(new Promise((resolve, reject) =&gt; {
            setTimeout(() =&gt; {
                console.log(i * 200 + &apos;ms åæ‰§è¡Œç»“æŸ&apos;)
                resolve(&apos;ç¬¬ &apos; + (i + 1) + &apos; ä¸ª Promise æ‰§è¡Œç»“æŸ&apos;)
            }, i * 200)
        }))
    }
    const result = []
    for(let promise of datum) {
        result.push(await promise)
    }
    console.log(result)
}
asyncFun()
</code></pre><p>ä¸²è¡Œæ‰§è¡Œï¼šè¿™é‡Œæä¾›ä¸¤ç§æ–¹å¼</p>
<pre><code>const datum = [];
for(let i = 0; i &lt; 10; i++) {
    datum.push(i);
}

let serial = Promise.resolve();

for(let i of datum) {
    serial = serial.then(data =&gt; {
        console.log(data);
    return new Promise((resolve, reject) =&gt; {
        setTimeout(() =&gt; {
        console.log(i * 200 + &quot; ms åæ‰§è¡Œç»“æŸ&quot;);
        resolve(&quot;ç¬¬ &quot; + (i + 1) + &quot; ä¸ª Promise æ‰§è¡Œç»“æŸ&quot;);
        }, i * 200);
    })    
    });
}
</code></pre><p>å¦å¤–å¯ä»¥ä½¿ç”¨ reduce æ¥ä¸²è¡Œï¼š</p>
<pre><code>const datum = [];
for(let i = 0; i &lt; 10; i++) {
    datum.push(i);
}

datum.reduce((prev, cur) =&gt; {
    return prev.then(data =&gt; {
    console.log(data);
    return new Promise((resolve, reject) =&gt; {
        setTimeout(() =&gt; {
        console.log(cur * 200 + &quot; ms åæ‰§è¡Œç»“æŸ&quot;);
        resolve(&quot;ç¬¬ &quot; + (cur + 1) + &quot; ä¸ª Promise æ‰§è¡Œç»“æŸ&quot;);
        }, cur * 200);
    })    
    })
}, Promise.resolve(true));
</code></pre><h2 id="ä¸‰ã€å€¼ç©¿é€é—®é¢˜ï¼š"><a href="#ä¸‰ã€å€¼ç©¿é€é—®é¢˜ï¼š" class="headerlink" title="ä¸‰ã€å€¼ç©¿é€é—®é¢˜ï¼š"></a>ä¸‰ã€å€¼ç©¿é€é—®é¢˜ï¼š</h2><pre><code>let promise = new Promise((resolve, reject) =&gt; {
    setTimeout(() =&gt; {
        resolve(&apos;Hello World!&apos;);
    }, 1000)
});

promise.then(&apos;å‘µå‘µå“’&apos;).then((data) =&gt; {
    console.log(data);           // Hello World
})
</code></pre><p>è¿™æ˜¯ä¸€ç§å€¼ç©¿é€çš„æƒ…å†µï¼Œä¸€èˆ¬æœ‰ä¸‹é¢ä¸¤ç§æƒ…å†µï¼š<br>promise å·²ç»æ˜¯ FULFILLED/REJECTED æ—¶ï¼Œé€šè¿‡ return this å®ç°çš„å€¼ç©¿é€ï¼š<br><img src="https://pic3.zhimg.com/v2-99374235673349f56d708c28511c27d2_b.jpg" alt=""><img src="https://pic3.zhimg.com/80/v2-99374235673349f56d708c28511c27d2_hd.jpg" alt=""></p>
<pre><code>let promise = new Promise((resolve, reject) =&gt; {
    setTimeout(() =&gt; {
        resolve(&apos;Hello World!&apos;);
    }, 1000)
});

promise.then(() =&gt; {
    promise.then().then(null).then(&apos;å‘µå‘µå“’&apos;).then((res) =&gt; {
        console.log(res)
    })
    promise.catch().catch(null).then(&apos;å‘µå‘µå“’&apos;).then((res) =&gt; {
        console.log(res) 
    })
})
</code></pre><p>promise æ˜¯ PENDING æ—¶ï¼Œé€šè¿‡ç”Ÿæˆæ–°çš„ promise åŠ å…¥åˆ°çˆ¶ promise çš„ queueï¼Œçˆ¶ promise æœ‰å€¼æ—¶è°ƒç”¨ callFulfilled-&gt;doResolve æˆ– callRejected-&gt;doRejectï¼ˆå› ä¸º then/catch ä¼ å…¥çš„å‚æ•°ä¸æ˜¯å‡½æ•°ï¼‰è®¾ç½®å­ promise çš„çŠ¶æ€å’Œå€¼ä¸ºçˆ¶ promise çš„çŠ¶æ€å’Œå€¼ã€‚å¦‚ï¼š<br><img src="https://pic2.zhimg.com/v2-7d3d3728e3b1f90d905d4f4782c1f97a_b.jpg" alt=""><img src="https://pic2.zhimg.com/80/v2-7d3d3728e3b1f90d905d4f4782c1f97a_hd.jpg" alt=""></p>
<pre><code>let promise = new Promise((resolve, reject) =&gt; {
    setTimeout(() =&gt; {
        resolve(&apos;Hello World!&apos;);
    }, 1000)
});

let a = promise.then(&apos;å‘µå‘µå“’&apos;);
a.then(res =&gt; {
    console.log(res);
});

let b = promise.catch(&apos;å‘µå‘µå“’&apos;);
b.then(res =&gt; {
    console.log(res);
})
</code></pre><p>æ€»è€Œè¨€ä¹‹ï¼Œå½“ä½ ç»™ then() ä¼ é€’ä¸€ä¸ªéå‡½æ•°ï¼ˆæ¯”å¦‚ä¸€ä¸ª promise ï¼‰å€¼çš„æ—¶å€™ï¼Œå®ƒå®é™…ä¸Šä¼šè§£é‡Šä¸º then(null) ï¼Œè¿™ä¼šå¯¼è‡´ä¹‹å‰çš„ promise çš„ç»“æœä¸¢å¤±ã€‚ä¾‹å¦‚:<br><img src="https://pic1.zhimg.com/v2-14fe675c00c5bc8154d161e3afed0f41_b.jpg" alt=""><img src="https://pic1.zhimg.com/80/v2-14fe675c00c5bc8154d161e3afed0f41_hd.jpg" alt=""></p>
<pre><code>Promise.resolve(&apos;First Value&apos;).then(Promise.resolve(&apos;Second Value&apos;)).then(null).then((value) =&gt; {
    console.log(value)    // First Value
})
</code></pre><h2 id="å››ã€ä¸è¦åœ¨å¼‚æ­¥å›è°ƒå‡½æ•°ä¸­ä½¿ç”¨-throw-Error"><a href="#å››ã€ä¸è¦åœ¨å¼‚æ­¥å›è°ƒå‡½æ•°ä¸­ä½¿ç”¨-throw-Error" class="headerlink" title="å››ã€ä¸è¦åœ¨å¼‚æ­¥å›è°ƒå‡½æ•°ä¸­ä½¿ç”¨ throw Error"></a>å››ã€ä¸è¦åœ¨å¼‚æ­¥å›è°ƒå‡½æ•°ä¸­ä½¿ç”¨ throw Error</h2><p>ä¸ä»… rejectï¼ŒæŠ›å‡ºçš„å¼‚å¸¸ä¹Ÿä¼šè¢«ä½œä¸ºæ‹’ç»çŠ¶æ€è¢« Promise æ•è·</p>
<pre><code>let promise = new Promise((resolve, reject) =&gt; {
    reject(&apos;This is an error&apos;);
});

promise.then(result =&gt; {
    console.log(result);
}).catch(error =&gt; {
    console.log(&apos;handle error: &apos;, error);  //handle error:  Error: This is an error
})
</code></pre><p>ä½†æ˜¯ï¼Œæ°¸è¿œä¸è¦åœ¨å›è°ƒé˜Ÿåˆ—ä¸­æŠ›å‡ºå¼‚å¸¸ï¼Œå› ä¸ºå›è°ƒé˜Ÿåˆ—è„±ç¦»äº†è¿è¡Œä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œå¼‚å¸¸æ— æ³•è¢«å½“å‰ä½œç”¨åŸŸæ•è·ã€‚</p>
<pre><code>let promise = new Promise((resolve, reject) =&gt; {
    setTimeout(() =&gt; {
        throw Error(&apos;This is an error&apos;);
    });
});

promise.then(result =&gt; {
    console.log(result);
}).catch(error =&gt; {
    console.log(&apos;handle error: &apos;, error);  // Error: This is an error
});
</code></pre><p>ç®€å•è¯´æ¥ï¼Œå›è°ƒé˜Ÿåˆ—æŒ‡çš„æ˜¯ JS äº‹ä»¶å¾ªç¯ä¸­çš„ macrotask é˜Ÿåˆ—ï¼Œæ¯”å¦‚ setTimeout setInterval ä¼šæ’å…¥åˆ° macrotask ä¸­ã€‚å¦‚æœè¦åœ¨å›è°ƒå‡½æ•°ä¸­æ•è·å¼‚å¸¸ï¼Œè¯·ä½¿ç”¨ rejectï¼Œæ°¸è¿œä¸è¦ä½¿ç”¨ Errorã€‚<br>ä¸Šè¿°çš„ä»£ç åº”æ”¹æˆï¼š</p>
<pre><code>let promise = new Promise((resolve, reject) =&gt; {
    setTimeout(() =&gt; {
        reject(&apos;This is an error&apos;);
    });
});

promise.then(result =&gt; {
    console.log(result);
}).catch(error =&gt; {
    console.log(&apos;handle error: &apos;, error);  // Error: This is an error
});
</code></pre><h2 id="äº”ã€then-çš„ç¬¬äºŒä¸ªå‚æ•°è·Ÿ-catch-çš„åŒºåˆ«-ã€é¢è¯•å¸¸é—®ã€‘"><a href="#äº”ã€then-çš„ç¬¬äºŒä¸ªå‚æ•°è·Ÿ-catch-çš„åŒºåˆ«-ã€é¢è¯•å¸¸é—®ã€‘" class="headerlink" title="äº”ã€then çš„ç¬¬äºŒä¸ªå‚æ•°è·Ÿ catch çš„åŒºåˆ« ã€é¢è¯•å¸¸é—®ã€‘"></a>äº”ã€then çš„ç¬¬äºŒä¸ªå‚æ•°è·Ÿ catch çš„åŒºåˆ« ã€é¢è¯•å¸¸é—®ã€‘</h2><p>æˆ‘ä»¬éƒ½çŸ¥é“ then çš„ç¬¬äºŒå‚æ•°è·Ÿ catch ç”¨æ³•å¾ˆåƒï¼Œéƒ½æ˜¯ç”¨æ¥è¿›è¡Œé”™è¯¯å¤„ç†çš„ï¼Œæ¯”å¦‚ä¸‹é¢è¿™æ®µä»£ç ï¼š</p>
<pre><code>let promise1 = new Promise((resolve, reject) =&gt; {
    reject(&apos;this is an error&apos;);
});

promise1.then(data =&gt; {
    console.log(data);
}, err =&gt; {
    console.log(&apos;handle err:&apos;, err);    // handle err: this is an error
});

let promise2 = new Promise((resolve, reject) =&gt; {
    reject(&apos;this is an error&apos;);
});
promise2.then(data =&gt; {
    console.log(data);
}).catch(err =&gt; {
    console.log(&apos;handle err:&apos;, err);    // handle err: this is an error
});
</code></pre><p>å½“æ—¶è¿™ä¸¤è€…è¿˜æ˜¯åŒºåˆ«çš„ï¼ŒåŒºåˆ«äº then çš„ç¬¬äºŒå‚æ•°æ— æ³•å¤„ç†ç¬¬ä¸€å‚æ•°å‡½æ•°ä¸­çš„é”™è¯¯ã€‚</p>
<pre><code>let promise1 = Promise.resolve();
promise1.then(() =&gt; {
    throw Error(&apos;this is a error&apos;);   //UnhandledPromiseRejectionWarning: Unhandled promise rejection
}, err =&gt; {
    console.log(err);
})

let promise2 = Promise.resolve();

promise2.then(() =&gt; {
    throw Error(&apos;this is a error&apos;);  
}).catch(err =&gt; {
    console.log(&apos;handle err:&apos;, err);    //handle err: Error: this is a error
})
</code></pre><blockquote>
<p>å½“ä½ ä½¿ç”¨then( resolveHandler, rejectHandler)æ ¼å¼ï¼Œå¦‚æœ resolveHandler è‡ªå·±æŠ›å‡ºä¸€ä¸ªé”™è¯¯ rejectHandler å¹¶ä¸èƒ½æ•è·ã€‚ç¬¬ä¸€ä¸ª Promise å¯¹è±¡æ— æ³•å¤„ç†åŒçº§ then ä¸­çš„å‡½æ•°æŠ›å‡ºçš„å¼‚å¸¸ï¼Œæ‰€ä»¥åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæœ€åç›´æ¥ä½¿ç”¨ catch æ¥è¿›è¡Œå¼‚å¸¸æ•è·æ¯”è¾ƒä¿é™©ã€‚</p>
</blockquote>
<h2 id="å…­ã€å¤„ç†æœ€å-catch-å‡½æ•°ä¸­çš„å¼‚å¸¸"><a href="#å…­ã€å¤„ç†æœ€å-catch-å‡½æ•°ä¸­çš„å¼‚å¸¸" class="headerlink" title="å…­ã€å¤„ç†æœ€å catch å‡½æ•°ä¸­çš„å¼‚å¸¸"></a>å…­ã€å¤„ç†æœ€å catch å‡½æ•°ä¸­çš„å¼‚å¸¸</h2><p>ä¸€èˆ¬æˆ‘ä»¬ç”¨ catch æ¥æ•æ‰å‰é¢æŠ›å‡ºçš„å¼‚å¸¸ï¼Œä½†æ˜¯å¦‚æœè¯•æƒ³ä¸€ä¸‹å¦‚æœæœ€åä¸€ä¸ª catch å‡½æ•°ä¹ŸæŠ›å‡ºäº†å¼‚å¸¸ï¼Œåº”è¯¥æ€ä¹ˆå¤„ç†å‘¢?</p>
<pre><code>let promise = new Promise((resolve, reject) =&gt; {
    reject(&apos;Hello World&apos;)
});

promise.catch((err) =&gt; {
    throw(&apos;Unexpected Error&apos;);   // Uncaught (in promise) Unexpected Error
})
</code></pre><p>é¢å¯¹è¿™æ ·çš„é”™è¯¯ï¼Œä¸ç®¡ä»¥ then æ–¹æ³•æˆ– catch æ–¹æ³•ç»“å°¾ï¼Œè¦æ˜¯æœ€åä¸€ä¸ªæ–¹æ³•æŠ›å‡ºé”™è¯¯ï¼Œéƒ½æœ‰å¯èƒ½æ— æ³•æ•æ‰åˆ°ï¼ˆå› ä¸º Promise å†…éƒ¨çš„é”™è¯¯ä¸ä¼šå†’æ³¡åˆ°å…¨å±€ï¼‰è¿™é‡Œæä¾›ä¸¤ç§æ€è·¯ï¼š</p>
<ul>
<li><p>æ‹“å±• Promise.prototype çš„æ–¹æ³•ï¼Œæ·»åŠ ä¸€ä¸ª done å‡½æ•°ï¼Œå°†é”™è¯¯æŠ›å‘å…¨å±€ã€‚</p>
<p>  window.onerror = (err) =&gt; {</p>
<pre><code>console.log(err);
</code></pre><p>  }<br>  Promise.prototype.done = function (onFulfilled, onRejected) {</p>
<pre><code>this.then(onFulfilled, onRejected)
  .catch(function (reason) {
    // æŠ›å‡ºä¸€ä¸ªå…¨å±€é”™è¯¯
    setTimeout(() =&gt; { throw reason }, 0);
  });
</code></pre><p>  };<br>  let promise = new Promise((resolve, reject) =&gt; {</p>
<pre><code>reject(&apos;Hello World&apos;)
</code></pre><p>  });</p>
<p>  promise.catch((err) =&gt; {</p>
<pre><code>throw(&apos;Unexpected Error&apos;);     // Uncaught Unexpected Error
</code></pre><p>  }).done()</p>
</li>
</ul>
<ul>
<li>åœ¨å…¨å±€æ·»åŠ  unhandledrejection äº‹ä»¶æ•è· Promise å¼‚å¸¸ã€‚</li>
</ul>
<p><img src="https://pic3.zhimg.com/v2-b512c7648df6d0d6fefb64d01009c175_b.jpg" alt=""></p>
<pre><code>window.addEventListener(&quot;unhandledrejection&quot;, (e) =&gt;{
    console.log(e.reason)
})    

let promise = new Promise((resolve, reject) =&gt; {
    reject(&apos;Hello World&apos;)
});

promise.catch((err) =&gt; {
    throw(&apos;Unexpected Error&apos;);     // Unexpected Error
})
</code></pre><h2 id="ä¸ƒã€æœªæ•è·çš„é”™è¯¯å¯ä»¥è¢«æ¢å¤"><a href="#ä¸ƒã€æœªæ•è·çš„é”™è¯¯å¯ä»¥è¢«æ¢å¤" class="headerlink" title="ä¸ƒã€æœªæ•è·çš„é”™è¯¯å¯ä»¥è¢«æ¢å¤"></a>ä¸ƒã€æœªæ•è·çš„é”™è¯¯å¯ä»¥è¢«æ¢å¤</h2><pre><code>let promise = new Promise((resolve, reject) =&gt; [
    reject(&apos;Hello world&apos;)
]).then(() =&gt; {
    console.log(&apos;resolve&apos;)
})

setTimeout(() =&gt; {
    promise.catch((e) =&gt; {
        console.log(e)
    }).then(() =&gt; {
        console.log(&apos;catch resolve&apos;)
    })
}, 1000)
</code></pre><h2 id="å…«ã€resolved-çŠ¶æ€çš„-Promise-ä¸ä¼šç«‹å³æ‰§è¡Œ"><a href="#å…«ã€resolved-çŠ¶æ€çš„-Promise-ä¸ä¼šç«‹å³æ‰§è¡Œ" class="headerlink" title="å…«ã€resolved çŠ¶æ€çš„ Promise ä¸ä¼šç«‹å³æ‰§è¡Œ"></a>å…«ã€resolved çŠ¶æ€çš„ Promise ä¸ä¼šç«‹å³æ‰§è¡Œ</h2><pre><code>let i = 0;
Promise.resolve(&apos;resolved promise&apos;).then(() =&gt; {
    i += 2
})
console.log(i)  // 0
</code></pre><p>å³ä½¿æ˜¯ resolve çš„ Promise è°ƒç”¨ then æ–¹æ³•ä¹Ÿæ˜¯å¼‚æ­¥æ‰§è¡Œã€‚</p>
<h2 id="ä¹ã€ç»“åˆ-async-await-ç¼–å†™åŒæ­¥ä»£ç "><a href="#ä¹ã€ç»“åˆ-async-await-ç¼–å†™åŒæ­¥ä»£ç " class="headerlink" title="ä¹ã€ç»“åˆ async/await ç¼–å†™åŒæ­¥ä»£ç "></a>ä¹ã€ç»“åˆ async/await ç¼–å†™åŒæ­¥ä»£ç </h2><ol>
<li>async/await å‡½æ•°å¯ä»¥å¸®åŠ©æˆ‘ä»¬å½»åº•æ‘†è„±å›è°ƒåœ°ç‹±çš„çƒ¦æ¼ï¼Œç”¨ä¸€ç§åŒæ­¥çš„æ–¹å¼æ¥ç¼–å†™å¼‚æ­¥å‡½æ•°ã€‚</li>
<li>await åé¢å¯ä»¥æ¥æ•°å€¼ï¼Œå¦‚æœæ˜¯å¼‚æ­¥è¯·æ±‚çš„è¯å¯ä»¥æ¥ Thunk å‡½æ•°å’Œ Promise å¯¹è±¡ã€‚</li>
</ol>
<p><img src="https://pic4.zhimg.com/v2-3ca5e16c6ba1743725cc92a7a8e5a7e2_b.jpg" alt=""></p>
<pre><code>const timeout = (ms) =&gt; {
    return new Promise((resolve) =&gt; {
        setTimeout(() =&gt; {
            resolve(ms + &apos; passed&apos;)
        }, ms)
    })
}

const asyncFunc =  async () =&gt; {
    const value1 = await timeout(2000)
    console.log(value1)
    const value2 = await timeout(2000)
    console.log(value2)
}

asyncFunc()
console.log(&apos;now&apos;)
</code></pre><h2 id="åã€è°ƒç”¨-then-æ–¹æ³•è¿”å›æ–°çš„-Promise-å¯¹è±¡"><a href="#åã€è°ƒç”¨-then-æ–¹æ³•è¿”å›æ–°çš„-Promise-å¯¹è±¡" class="headerlink" title="åã€è°ƒç”¨ then æ–¹æ³•è¿”å›æ–°çš„ Promise å¯¹è±¡"></a>åã€è°ƒç”¨ then æ–¹æ³•è¿”å›æ–°çš„ Promise å¯¹è±¡</h2><pre><code>let promise1 = new Promise((resolve) =&gt; {
    resolve(&apos;Hello world&apos;)
})

let promise2 = promise1.then()

console.log(promise1 === promise2)    // false
console.log(promise1 instanceof Promise)  // true
console.log(promise2 instanceof Promise)  // true
</code></pre><p>æ¯æ¬¡è°ƒç”¨ then æ–¹æ³•åéƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„ Promise å¯¹è±¡ï¼Œå¹¶ä¸æ˜¯è¿”å›åŸæœ¬çš„ Promise å¯¹è±¡ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/03/æˆ‘ä¹Ÿæ¥å®ç°ä¸€æŠŠMVVM/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/03/æˆ‘ä¹Ÿæ¥å®ç°ä¸€æŠŠMVVM/" itemprop="url">æˆ‘ä¹Ÿæ¥å®ç°ä¸€æŠŠMVVM</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-10-03T00:20:32+08:00">
                2018-10-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>å¤§å®¶éƒ½çŸ¥é“ï¼Œvueæ˜¯ä¸ªMVVMæ¡†æ¶ï¼Œèƒ½å¤Ÿå®ç°viewå’Œmodelçš„åŒå‘ç»‘å®šï¼Œä¸åƒbackboneé‚£æ ·ï¼Œmodelæ”¹å˜éœ€è¦æ‰‹åŠ¨å»é€šçŸ¥viewæ›´æ–°ï¼Œè€Œvueå®ç°çš„åŸç†å°±æ˜¯é€šè¿‡Object.definePropertyå®ç°æ•°æ®æŒŸæŒï¼Œå®šä¹‰setterï¼Œç„¶åæ•°æ®æ”¹å˜çš„æ—¶å€™é€šçŸ¥è§†å›¾æ›´æ–°ã€‚</p>
<p>ä¸‹é¢æ˜¯ç½‘ä¸Švueçš„å®ç°åŸç†å›¾ï¼š</p>
<p> <img src="https://user-gold-cdn.xitu.io/2018/4/10/162ad3d5be3e5105?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="image"></p>
<h3 id="å®ç°æ•ˆæœ"><a href="#å®ç°æ•ˆæœ" class="headerlink" title="å®ç°æ•ˆæœ"></a>å®ç°æ•ˆæœ</h3><p><img src="https://user-gold-cdn.xitu.io/2018/8/15/1653b294cd1b80e3?imageslim" alt=""></p>
<h4 id="1ã€MVVM"><a href="#1ã€MVVM" class="headerlink" title="1ã€MVVM"></a>1ã€MVVM</h4><p>å…¥å£æ–‡ä»¶ï¼Œåœ¨è¿™é‡Œå¯¹vueå½“ä¸­çš„$elã€methodsã€$dataè¿›è¡Œåˆå§‹åŒ–ï¼Œè°ƒç”¨observeréå†$dataçš„æ•°æ®å¹¶è¿›è¡ŒæŒŸæŒï¼Œè°ƒç”¨compileéå†$elä¸‹çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œè§£ææŒ‡ä»¤å’Œå–å€¼æ“ä½œã€‚éå†$dataçš„æ•°æ®ï¼Œé€šè¿‡Object.definePropertyçš„getterå’Œsetterå®ç°å¯¹$dataçš„ä»£ç†ã€‚</p>
<h4 id="2ã€Observer"><a href="#2ã€Observer" class="headerlink" title="2ã€Observer"></a>2ã€Observer</h4><p>éå†dataï¼Œé€šè¿‡Object.definePropertyè®¾ç½®getterå’Œsetterï¼Œåœ¨setterçŸ¥é“æ•°æ®å‘ç”Ÿäº†æ”¹å˜ï¼Œç„¶åé€šçŸ¥Wacherå»æ›´æ–°viewã€‚</p>
<h4 id="3ã€Compile"><a href="#3ã€Compile" class="headerlink" title="3ã€Compile"></a>3ã€Compile</h4><p>éå†$elä¸‹çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œè§£ææŒ‡ä»¤å’Œå–å€¼æ“ä½œç­‰ï¼Œä¸ºæ¯ä¸ªèŠ‚ç‚¹ç»‘å®šæ›´æ–°å‡½æ•°ï¼ˆä¸ºä»€ä¹ˆåœ¨compileè¿™é‡Œç»‘å®šå‘¢ï¼Ÿå› ä¸ºè¿™é‡Œåˆšå¥½æ˜¯éå†çš„èŠ‚ç‚¹â˜ºï¼‰ï¼Œç»‘å®šäº‹ä»¶å’Œmethodçš„å…³ç³»ï¼ŒåŒæ—¶ä¹Ÿæ·»åŠ è®¢é˜…è€…ï¼Œå½“æ¥å—åˆ°è§†å›¾æ›´æ–°çš„è®¢é˜…æ¶ˆæ¯åï¼Œè°ƒç”¨æ›´æ–°å‡½æ•°ï¼Œå®ç°è§†å›¾æ›´æ–°ã€‚åŒæ—¶åœ¨æ·»åŠ è®¢é˜…è€…çš„æ—¶å€™ï¼Œåˆå§‹åŒ–æ¸²æŸ“è§†å›¾ã€‚</p>
<h4 id="4ã€Watcher"><a href="#4ã€Watcher" class="headerlink" title="4ã€Watcher"></a>4ã€Watcher</h4><p>Watcherä½œä¸ºè®¢é˜…è€…ï¼Œå……å½“Observerå’ŒCompileçš„ä¸­é—´æ¡¥æ¢ï¼ŒåŒ…å«updateæ–¹æ³•ï¼Œupdateæ–¹æ³•è°ƒç”¨Compileä¸­ç»‘å®šçš„äº‹ä»¶æ›´æ–°å‡½æ•°ï¼Œå®ç°å¯¹è§†å›¾çš„åˆå§‹åŒ–å’Œæ›´æ–°æ“ä½œã€‚</p>
<h3 id="MVVMçš„å®ç°"><a href="#MVVMçš„å®ç°" class="headerlink" title="MVVMçš„å®ç°"></a>MVVMçš„å®ç°</h3><p>MVVMå®Œæˆåˆå§‹åŒ–æ“ä½œï¼Œå¹¶ä¸”è°ƒç”¨observerå’Œcompileã€‚å¯¹$dataè¿›è¡Œä»£ç†ï¼Œå¦‚æ­¤ä¾¿å¯ä»¥é€šè¿‡this.attributeæ¥ä»£ç†this.$data.attributeã€‚å› ä¸ºä¸€ä¸ªå±æ€§å¯èƒ½å¯¹åº”å¤šä¸ªæŒ‡ä»¤ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ª_bindingå±æ€§æ¥å­˜æ”¾å±æ€§å¯¹åº”çš„æ‰€æœ‰è®¢é˜…è€…ï¼Œè¿™æ ·å±æ€§ä¸€æ”¹å˜ï¼Œå°±å¯ä»¥å–å‡ºæ‰€æœ‰çš„è®¢é˜…è€…å»æ›´æ–°è§†å›¾ã€‚</p>
<pre><code>function MVVM(options) {
  // åˆå§‹åŒ–
  this.$data = options.data;
  this.$methods = options.methods;
  this.$el = options.el;
  // ä¿å­˜dataçš„æ¯ä¸ªå±æ€§å¯¹åº”çš„æ‰€æœ‰watcher
  this._binding  = {};
  // è°ƒç”¨observerå’Œcompile
  this._observer(options.data);
  this._compile();
  // this.xxx ä»£ç†this.$data.xxx
  this.proxyAttribute();
}
</code></pre><h3 id="Observerçš„å®ç°"><a href="#Observerçš„å®ç°" class="headerlink" title="Observerçš„å®ç°"></a>Observerçš„å®ç°</h3><p>Observeréå†$dataï¼Œé€šè¿‡Object.definePropertyçš„setterçš„æŒŸæŒæ•°æ®æ”¹å˜ï¼Œç›‘å¬åˆ°æ•°æ®æ”¹å˜åå–å‡ºæ‰€æœ‰è¯¥å±æ€§å¯¹åº”çš„è®¢é˜…è€…ï¼Œç„¶åé€šçŸ¥æ›´æ–°å‡½æ•°æ›´æ–°è§†å›¾ã€‚</p>
<p>æ³¨æ„ï¼šè¿™é‡Œæœ‰å¾ªç¯ï¼Œä¸”é—­åŒ…ï¼ˆgetterå’Œsetterï¼‰é‡Œé¢éœ€è¦ä¾èµ–å¾ªç¯é¡¹ï¼ˆvalueå’Œkeyï¼‰ï¼Œæ‰€ä»¥ç”¨ç«‹å³æ‰§è¡Œå‡½æ•°è§£å†³å¾ªç¯é¡¹è·å–ä¸å¯¹çš„é—®é¢˜ã€‚</p>
<pre><code>MVVM.prototype._observer = function(data) {
  var self = this;
  for(var key in this.$data) {
    if (this.$data.hasOwnProperty(key)) {
      // åˆå§‹åŒ–å±æ€§å¯¹åº”çš„è®¢é˜…è€…å®¹å™¨ï¼ˆæ•°ç»„ï¼‰
      this._binding[key] = {
        _directives: [],
        _texts: []
      };

      if(typeof this.$data[key] === &quot;object&quot;) {
        return this._observer(this.$data[key]);
      }
      var val = data[key];
      // ç«‹å³æ‰§è¡Œå‡½æ•°è·å–æ­£ç¡®çš„å¾ªç¯é¡¹
      (function(value, key) {
        Object.defineProperty(self.$data, key, {
          enumerable: true,
          configurable: true,
          get: function() {
            return value;
          },
          set(newval) {
            if(newval === value) {
              return;
            }
            value = newval;
            // ç›‘å¬åˆ°æ•°æ®æ”¹å˜åå–å‡ºæ‰€æœ‰è¯¥å±æ€§å¯¹åº”çš„è®¢é˜…è€…ï¼Œé€šçŸ¥viewæ›´æ–°-å±æ€§
            if(self._binding[key]._directives) {
              self._binding[key]._directives.forEach(function(watcher) {
                watcher.update();
              }, self);
            }
            // ç›‘å¬åˆ°æ•°æ®æ”¹å˜åå–å‡ºæ‰€æœ‰è¯¥å±æ€§å¯¹åº”çš„è®¢é˜…è€…ï¼Œé€šçŸ¥viewæ›´æ–°-æ–‡æœ¬
            if(self._binding[key]._texts) {
              self._binding[key]._texts.forEach(function(watcher) {
                watcher.update();
              }, self);
            }
          }
        });
      })(val, key);
    }
  }
}
</code></pre><h3 id="Compileçš„å®ç°"><a href="#Compileçš„å®ç°" class="headerlink" title="Compileçš„å®ç°"></a>Compileçš„å®ç°</h3><p>Compileéå†æ‰€æœ‰çš„èŠ‚ç‚¹ï¼Œè§£ææŒ‡ä»¤ï¼Œä¸ºæ¯ä¸ªèŠ‚ç‚¹ç»‘å®šæ›´æ–°å‡½æ•°ï¼Œä¸”æ·»åŠ è®¢é˜…è€…ï¼Œå½“è®¢é˜…è€…é€šçŸ¥viewæ›´æ–°çš„æ—¶å€™ï¼Œè°ƒç”¨æ›´æ–°å‡½æ•°ï¼Œå®ç°å¯¹è§†å›¾çš„æ›´æ–°ã€‚</p>
<p>è¿™é‡ŒåŒæ ·éœ€è¦ä½¿ç”¨ç«‹å³æ‰§è¡Œå‡½æ•°æ¥è§£å†³é—­åŒ…ä¾èµ–çš„å¾ªç¯é¡¹é—®é¢˜ã€‚</p>
<p>è¿˜æœ‰ä¸€ç‚¹éœ€è¦è§£å†³çš„æ˜¯ï¼Œå¦‚æœèŠ‚ç‚¹çš„innerTextä¾èµ–å¤šä¸ªå±æ€§çš„è¯ï¼Œå¦‚ä½•åšåˆ°åªæ›¿æ¢æ”¹å˜å±æ€§å¯¹åº”çš„æ–‡æœ¬é—®é¢˜ã€‚</p>
<p>æ¯”å¦‚ï¼šå·²ç»è¢«ç¼–è¯‘è§£ææˆâ€œæ¬¢è¿ï¼š é¸£äººâ€ï¼Œå¦‚æœmessageæ”¹å˜ä¸ºâ€œä½ å¥½â€ï¼Œæ€ä¹ˆè®©ä½¿å¾—â€œæ¬¢è¿ï¼šé¸£äººâ€æ”¹ä¸ºâ€œä½ å¥½ï¼šé¸£äººâ€ã€‚</p>
<pre><code>MVVM.prototype._compile = function() {
  var dom = document.querySelector(this.$el);
  var children = dom.children;
  var self = this;
  var i = 0, j = 0;
  // æ›´æ–°å‡½æ•°ï¼Œä½†observerä¸­modelçš„æ•°æ®æ”¹å˜çš„æ—¶å€™ï¼Œé€šè¿‡Watcherçš„updateè°ƒç”¨æ›´æ–°å‡½æ•°ï¼Œä»è€Œæ›´æ–°dom
  var updater = null;
  for(; i &lt; children.length; i++) {
    var node = children[i];
    (function(node) {
      // è§£æ{{}}é‡Œé¢çš„å†…å®¹
      // ä¿å­˜æŒ‡ä»¤åŸå§‹å†…å®¹ï¼Œä¸ç„¶æ•°æ®æ›´æ–°æ—¶æ— æ³•å®Œæˆæ›¿æ¢
      var text = node.innerText;
      var matches = text.match(/{{([^{}]+)}}/g);
      if(matches &amp;&amp; matches.length &gt; 0) {
        // ä¿å­˜å’Œnodeç»‘å®šçš„æ‰€æœ‰å±æ€§
        node.bindingAttributes = [];
        for(j = 0; j &lt; matches.length; j++) {
          // dataæŸä¸ªå±æ€§
          var attr = matches[j].match(/{{([^{}]+)}}/)[1];
          // å°†å’Œè¯¥nodeç»‘å®šçš„dataå±æ€§ä¿å­˜èµ·æ¥
          node.bindingAttributes.push(attr);
          (function(attr) {
            updater = function() {
              // æ”¹å˜çš„å±æ€§å€¼å¯¹åº”çš„æ–‡æœ¬è¿›è¡Œæ›¿æ¢
              var innerText = text.replace(new RegExp(&quot;{{" + attr + "}}&quot;, &quot;g&quot;), self.$data[attr]);
              // å¦‚æœè¯¥nodeç»‘å®šå¤šä¸ªå±æ€§ eg:&lt;div&gt;{{title}}{{description}}&lt;/div&gt;
              for(var k = 0; k &lt; node.bindingAttributes.length; k++) {
                if(node.bindingAttributes[k] !== attr) {
                  // æ¢å¤åŸæ¥æ²¡æ”¹å˜çš„å±æ€§å¯¹åº”çš„æ–‡æœ¬
                  innerText = innerText.replace(&quot;{{" + node.bindingAttributes[k] + "}}&quot;, self.$data[node.bindingAttributes[k]]);
                }
              }
              node.innerText = innerText;
            }
            self._binding[attr]._texts.push(new Watcher(self, attr, updater));
          })(attr);
        }
      }

      // è§£ævueæŒ‡ä»¤
      var attributes = node.getAttributeNames();
      for(j = 0; j &lt; attributes.length; j++) {
        // vueæŒ‡ä»¤
        var attribute = attributes[j];
        // DOM attribute
        var domAttr = null;
        // ç»‘å®šçš„dataå±æ€§
        var vmDataAttr = node.getAttribute(attribute);

        if(/v-bind:([^=]+)/.test(attribute)) {
          // è§£æv-bind
          domAttr = RegExp.$1;
          // æ›´æ–°å‡½æ•°
          updater = function(val) {
            node[domAttr] = val;
          }
          // dataå±æ€§ç»‘å®šå¤šä¸ªwatcher
          self._binding[vmDataAttr]._directives.push(
            new Watcher(self, vmDataAttr, updater)
          )
        } elseif(attribute === &quot;v-model&quot; &amp;&amp; (node.tagName = &apos;INPUT&apos; || node.tagName == &apos;TEXTAREA&apos;)) {
          // è§£æv-model
          // æ›´æ–°å‡½æ•°
          updater = function(val) {
            node.value = val;
          }
          // dataå±æ€§ç»‘å®šå¤šä¸ªwatcher
          self._binding[vmDataAttr]._directives.push(
            new Watcher(self, vmDataAttr, updater)
          )
          // ç›‘å¬input/textareaçš„æ•°æ®å˜åŒ–ï¼ŒåŒæ­¥åˆ°modelå»ï¼Œå®ç°åŒå‘ç»‘å®š
          node.addEventListener(&quot;input&quot;, function(evt) {
            var $el = evt.currentTarget;
            self.$data[vmDataAttr] = $el.value;
          });
        } elseif(/v-on:([^=]+)/.test(attribute)) {
          // è§£æv-on
          var event = RegExp.$1;
          var method = vmDataAttr;
          node.addEventListener(event, function(evt) {
            self.$methods[method] &amp;&amp; self.$methods[method].call(self, evt);
          });
        }
      }
    })(node);
  }

}
</code></pre><h3 id="Watcherçš„å®ç°"><a href="#Watcherçš„å®ç°" class="headerlink" title="Watcherçš„å®ç°"></a>Watcherçš„å®ç°</h3><p>Watcherå……å½“è®¢é˜…è€…çš„è§’è‰²ï¼Œæ¶èµ·äº†Observerå’ŒCompileçš„æ¡¥æ¢ï¼ŒObserverç›‘å¬åˆ°æ•°æ®å˜åŒ–åï¼Œé€šçŸ¥Wathceræ›´æ–°è§†å›¾(è°ƒç”¨Wathcerçš„updateæ–¹æ³•)ï¼ŒWatcherå†å‘Šè¯‰Compileå»è°ƒç”¨æ›´æ–°å‡½æ•°ï¼Œå®ç°domçš„æ›´æ–°ã€‚åŒæ—¶é¡µé¢çš„åˆå§‹åŒ–æ¸²æŸ“ä¹Ÿäº¤ç»™äº†Watcherï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥æ”¾åˆ°Compileè¿›è¡Œï¼‰ã€‚</p>
<pre><code>function Watcher(vm, attr, cb) {
  this.vm = vm; // viewmodel
  this.attr = attr; // dataçš„å±æ€§ï¼Œä¸€ä¸ªwatcherè®¢é˜…ä¸€ä¸ªdataå±æ€§
  this.cb = cb; // æ›´æ–°å‡½æ•°ï¼Œåœ¨compileé‚£è¾¹å®šä¹‰
  // åˆå§‹åŒ–æ¸²æŸ“è§†å›¾
  this.update();
}

Watcher.prototype.update = function() {
  // é€šçŸ¥comileä¸­çš„æ›´æ–°å‡½æ•°æ›´æ–°dom 
  this.cb(this.vm.$data[this.attr]);
}
</code></pre><h3 id="å…¨éƒ¨ä»£ç "><a href="#å…¨éƒ¨ä»£ç " class="headerlink" title="å…¨éƒ¨ä»£ç "></a>å…¨éƒ¨ä»£ç </h3><p>gitåœ°å€ï¼š<a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2FVikiLee%2FMVVM.git" target="_blank" rel="noopener">github.com/VikiLee/MVVâ€¦</a></p>
<p>é¸£è°¢ï¼š<a href="https://link.juejin.im?target=https%3A%2F%2Fjuejin.im%2Fpost%2F5acc17cb51882555745a03f8" target="_blank" rel="noopener">juejin.im/post/5acc17â€¦</a></p>
<h3 id="ä½¿ç”¨ä¾‹å­"><a href="#ä½¿ç”¨ä¾‹å­" class="headerlink" title="ä½¿ç”¨ä¾‹å­"></a>ä½¿ç”¨ä¾‹å­</h3><pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
  &lt;meta charset=&quot;UTF-8&quot;&gt;
  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
  &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;
  &lt;title&gt;Document&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div id=&quot;view&quot;&gt;
    &lt;div v-bind:id=&quot;id&quot;&gt;
      {{message}}:{{name}}
    &lt;/div&gt;
    &lt;input type=&quot;text&quot; v-model=&quot;name&quot;/&gt;
    &lt;button v-on:click=&quot;handleClick&quot;&gt;è·å–è¾“å…¥å€¼&lt;/button&gt;
  &lt;/div&gt;
&lt;/body&gt;
&lt;script src=&quot;js/MVVM.js&quot;type=&quot;text/javascript&quot;&gt;&lt;/script&gt;
&lt;script&gt;
  var vue = new MVVM({
    el: &quot;#view&quot;,
    data: {
      message: &quot;æ¬¢è¿å…‰ä¸´&quot;,
      name: &quot;é¸£äºº&quot;,
      id: &quot;id&quot;
    },
    methods: {
      handleClick: function() {
        alert(this.message + &quot;:&quot; + this.name + &quot;, ç‚¹å‡»ç¡®å®šè·¯é£ä¼šå‡ºæ¥&quot;);
        this.name = &apos;è·¯é£&apos;;
      }
    }
  })

  setTimeout(function() {
    vue.message = &quot;ä½ å¥½&quot;;
  }, 1000);
&lt;/script&gt;
&lt;/html&gt;
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/02/Promise-å¿…çŸ¥å¿…ä¼š/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/02/Promise-å¿…çŸ¥å¿…ä¼š/" itemprop="url">Promise å¿…çŸ¥å¿…ä¼š</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-10-02T23:18:00+08:00">
                2018-10-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="ä½ ä¸çŸ¥é“çš„-Promise-å¯¹è±¡é»‘ç§‘æŠ€"><a href="#ä½ ä¸çŸ¥é“çš„-Promise-å¯¹è±¡é»‘ç§‘æŠ€" class="headerlink" title="ä½ ä¸çŸ¥é“çš„ Promise å¯¹è±¡é»‘ç§‘æŠ€"></a><a href="https://zhuanlan.zhihu.com/p/30735250" target="_blank" rel="noopener">ä½ ä¸çŸ¥é“çš„ Promise å¯¹è±¡é»‘ç§‘æŠ€</a></h2><p>Promise æƒ³å¿…å¤§å®¶éƒ½ååˆ†ç†Ÿæ‚‰ï¼Œæƒ³æƒ³å°±é‚£ä¹ˆå‡ ä¸ª apiï¼Œå¯æ˜¯ä½ çœŸçš„äº†è§£ Promise å—ï¼Ÿæœ¬æ–‡æ ¹æ® Promise çš„ä¸€äº›çŸ¥è¯†ç‚¹æ€»ç»“äº†åé“é¢˜ï¼Œçœ‹çœ‹ä½ èƒ½åšå¯¹å‡ é“ã€‚</p>
<p>ä»¥ä¸‹ promise å‡æŒ‡ä»£ Promise å®ä¾‹ï¼Œç¯å¢ƒæ˜¯ Node.jsã€‚</p>
<h2 id="é¢˜ç›®ä¸€"><a href="#é¢˜ç›®ä¸€" class="headerlink" title="é¢˜ç›®ä¸€"></a>é¢˜ç›®ä¸€</h2><pre><code>const promise = new Promise((resolve, reject) =&gt; {
  console.log(1)
  resolve()
  console.log(2)
})
promise.then(() =&gt; {
  console.log(3)
})
console.log(4)
</code></pre><p>è¿è¡Œç»“æœï¼š</p>
<pre><code>1
2
4
3
</code></pre><p>è§£é‡Šï¼šPromise æ„é€ å‡½æ•°æ˜¯åŒæ­¥æ‰§è¡Œçš„ï¼Œpromise.then ä¸­çš„å‡½æ•°æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ã€‚</p>
<h2 id="é¢˜ç›®äºŒ"><a href="#é¢˜ç›®äºŒ" class="headerlink" title="é¢˜ç›®äºŒ"></a>é¢˜ç›®äºŒ</h2><pre><code>const promise = new Promise((resolve, reject) =&gt; {
  setTimeout(() =&gt; {
    resolve(&apos;success&apos;)
  }, 1000)
})
console.log(promise)
promise
  .then(() =&gt; {
    console.log(promise)
    throw new Error(&apos;error!!!&apos;)
  })
  .catch(err =&gt; {
    console.log(promise)
  })
</code></pre><p>è¿è¡Œç»“æœï¼š</p>
<pre><code>Promise { &lt;pending&gt; }
Promise { &apos;success&apos; }
Promise { &apos;success&apos; }
</code></pre><p>è§£é‡Šï¼špromise æœ‰ 3 ç§çŠ¶æ€ï¼špendingã€fulfilled å’Œ rejectedã€‚çŠ¶æ€æ”¹å˜åªèƒ½æ˜¯ pending-&gt;fulfilled æˆ–è€… pending-&gt;rejectedï¼ŒçŠ¶æ€ä¸€æ—¦æ”¹å˜åˆ™ä¸èƒ½å†å˜ã€‚</p>
<h2 id="é¢˜ç›®ä¸‰"><a href="#é¢˜ç›®ä¸‰" class="headerlink" title="é¢˜ç›®ä¸‰"></a>é¢˜ç›®ä¸‰</h2><pre><code>const promise = new Promise((resolve, reject) =&gt; {
  resolve(&apos;success1&apos;)
  reject(&apos;error&apos;)
  resolve(&apos;success2&apos;)
})

promise
  .then((res) =&gt; {
    console.log(&apos;then: &apos;, res)
  })
  .catch((err) =&gt; {
    console.log(&apos;catch: &apos;, err)
  })
</code></pre><p>è¿è¡Œç»“æœï¼š</p>
<pre><code>then: success1
</code></pre><p>è§£é‡Šï¼šæ„é€ å‡½æ•°ä¸­çš„ resolve æˆ– reject åªæœ‰ç¬¬ä¸€æ¬¡æ‰§è¡Œæœ‰æ•ˆï¼Œå¤šæ¬¡è°ƒç”¨æ²¡æœ‰ä»»ä½•ä½œç”¨ï¼Œå‘¼åº”ä»£ç äºŒç»“è®ºï¼špromise çŠ¶æ€ä¸€æ—¦æ”¹å˜åˆ™ä¸èƒ½å†å˜ã€‚</p>
<h2 id="é¢˜ç›®å››"><a href="#é¢˜ç›®å››" class="headerlink" title="é¢˜ç›®å››"></a>é¢˜ç›®å››</h2><pre><code>Promise.resolve(1)
  .then((res) =&gt; {
    console.log(res)
    return 2
  })
  .catch((err) =&gt; {
    return 3
  })
  .then((res) =&gt; {
    console.log(res)
  })
</code></pre><p>è¿è¡Œç»“æœï¼š</p>
<pre><code>1
2
</code></pre><p>è§£é‡Šï¼špromise å¯ä»¥é“¾å¼è°ƒç”¨ã€‚æèµ·é“¾å¼è°ƒç”¨æˆ‘ä»¬é€šå¸¸ä¼šæƒ³åˆ°é€šè¿‡ return this å®ç°ï¼Œä¸è¿‡ Promise å¹¶ä¸æ˜¯è¿™æ ·å®ç°çš„ã€‚promise æ¯æ¬¡è°ƒç”¨ .then æˆ–è€… .catch éƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„ promiseï¼Œä»è€Œå®ç°äº†é“¾å¼è°ƒç”¨ã€‚</p>
<h2 id="é¢˜ç›®äº”"><a href="#é¢˜ç›®äº”" class="headerlink" title="é¢˜ç›®äº”"></a>é¢˜ç›®äº”</h2><pre><code>const promise = new Promise((resolve, reject) =&gt; {
  setTimeout(() =&gt; {
    console.log(&apos;once&apos;)
    resolve(&apos;success&apos;)
  }, 1000)
})

const start = Date.now()
promise.then((res) =&gt; {
  console.log(res, Date.now() - start)
})
promise.then((res) =&gt; {
  console.log(res, Date.now() - start)
})
</code></pre><p>è¿è¡Œç»“æœï¼š</p>
<pre><code>once
success 1005
success 1007
</code></pre><p>è§£é‡Šï¼špromise çš„ .then æˆ–è€… .catch å¯ä»¥è¢«è°ƒç”¨å¤šæ¬¡ï¼Œä½†è¿™é‡Œ Promise æ„é€ å‡½æ•°åªæ‰§è¡Œä¸€æ¬¡ã€‚æˆ–è€…è¯´ promise å†…éƒ¨çŠ¶æ€ä¸€ç»æ”¹å˜ï¼Œå¹¶ä¸”æœ‰äº†ä¸€ä¸ªå€¼ï¼Œé‚£ä¹ˆåç»­æ¯æ¬¡è°ƒç”¨ .then æˆ–è€… .catch éƒ½ä¼šç›´æ¥æ‹¿åˆ°è¯¥å€¼ã€‚</p>
<h2 id="é¢˜ç›®å…­"><a href="#é¢˜ç›®å…­" class="headerlink" title="é¢˜ç›®å…­"></a>é¢˜ç›®å…­</h2><pre><code>Promise.resolve()
  .then(() =&gt; {
    return new Error(&apos;error!!!&apos;)
  })
  .then((res) =&gt; {
    console.log(&apos;then: &apos;, res)
  })
  .catch((err) =&gt; {
    console.log(&apos;catch: &apos;, err)
  })
</code></pre><p>è¿è¡Œç»“æœï¼š</p>
<pre><code>then: Error: error!!!
    at Promise.resolve.then (...)
    at ...
</code></pre><p>è§£é‡Šï¼š.then æˆ–è€… .catch ä¸­ return ä¸€ä¸ª error å¯¹è±¡å¹¶ä¸ä¼šæŠ›å‡ºé”™è¯¯ï¼Œæ‰€ä»¥ä¸ä¼šè¢«åç»­çš„ .catch æ•è·ï¼Œéœ€è¦æ”¹æˆå…¶ä¸­ä¸€ç§ï¼š</p>
<ol>
<li>return Promise.reject(new Error(â€˜error!!!â€™))</li>
<li>throw new Error(â€˜error!!!â€™)</li>
</ol>
<p>å› ä¸ºè¿”å›ä»»æ„ä¸€ä¸ªé promise çš„å€¼éƒ½ä¼šè¢«åŒ…è£¹æˆ promise å¯¹è±¡ï¼Œå³ return new Error(â€˜error!!!â€™) ç­‰ä»·äº return Promise.resolve(new Error(â€˜error!!!â€™))ã€‚</p>
<h2 id="é¢˜ç›®ä¸ƒ"><a href="#é¢˜ç›®ä¸ƒ" class="headerlink" title="é¢˜ç›®ä¸ƒ"></a>é¢˜ç›®ä¸ƒ</h2><pre><code>const promise = Promise.resolve()
  .then(() =&gt; {
    return promise
  })
promise.catch(console.error)
</code></pre><p>è¿è¡Œç»“æœï¼š</p>
<pre><code>TypeError: Chaining cycle detected for promise #&lt;Promise&gt;
    at &lt;anonymous&gt;
    at process._tickCallback (internal/process/next_tick.js:188:7)
    at Function.Module.runMain (module.js:667:11)
    at startup (bootstrap_node.js:187:16)
    at bootstrap_node.js:607:3
</code></pre><p>è§£é‡Šï¼š.then æˆ– .catch è¿”å›çš„å€¼ä¸èƒ½æ˜¯ promise æœ¬èº«ï¼Œå¦åˆ™ä¼šé€ æˆæ­»å¾ªç¯ã€‚ç±»ä¼¼äºï¼š</p>
<pre><code>process.nextTick(function tick () {
  console.log(&apos;tick&apos;)
  process.nextTick(tick)
})
</code></pre><h2 id="é¢˜ç›®å…«"><a href="#é¢˜ç›®å…«" class="headerlink" title="é¢˜ç›®å…«"></a>é¢˜ç›®å…«</h2><pre><code>Promise.resolve(1)
  .then(2)
  .then(Promise.resolve(3))
  .then(console.log)
</code></pre><p>è¿è¡Œç»“æœï¼š</p>
<pre><code>1
</code></pre><p>è§£é‡Šï¼š.then æˆ–è€… .catch çš„å‚æ•°æœŸæœ›æ˜¯å‡½æ•°ï¼Œä¼ å…¥éå‡½æ•°åˆ™ä¼šå‘ç”Ÿå€¼ç©¿é€ã€‚</p>
<h2 id="é¢˜ç›®ä¹"><a href="#é¢˜ç›®ä¹" class="headerlink" title="é¢˜ç›®ä¹"></a>é¢˜ç›®ä¹</h2><pre><code>Promise.resolve()
  .then(function success (res) {
    throw new Error(&apos;error&apos;)
  }, function fail1 (e) {
    console.error(&apos;fail1: &apos;, e)
  })
  .catch(function fail2 (e) {
    console.error(&apos;fail2: &apos;, e)
  })
</code></pre><p>è¿è¡Œç»“æœï¼š</p>
<pre><code>fail2: Error: error
    at success (...)
    at ...
</code></pre><p>è§£é‡Šï¼š.then å¯ä»¥æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯å¤„ç†æˆåŠŸçš„å‡½æ•°ï¼Œç¬¬äºŒä¸ªæ˜¯å¤„ç†é”™è¯¯çš„å‡½æ•°ã€‚.catch æ˜¯ .then ç¬¬äºŒä¸ªå‚æ•°çš„ç®€ä¾¿å†™æ³•ï¼Œä½†æ˜¯å®ƒä»¬ç”¨æ³•ä¸Šæœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼š.then çš„ç¬¬äºŒä¸ªå¤„ç†é”™è¯¯çš„å‡½æ•°æ•è·ä¸äº†ç¬¬ä¸€ä¸ªå¤„ç†æˆåŠŸçš„å‡½æ•°æŠ›å‡ºçš„é”™è¯¯ï¼Œè€Œåç»­çš„ .catch å¯ä»¥æ•è·ä¹‹å‰çš„é”™è¯¯ã€‚å½“ç„¶ä»¥ä¸‹ä»£ç ä¹Ÿå¯ä»¥ï¼š</p>
<pre><code>Promise.resolve()
  .then(function success1 (res) {
    throw new Error(&apos;error&apos;)
  }, function fail1 (e) {
    console.error(&apos;fail1: &apos;, e)
  })
  .then(function success2 (res) {
  }, function fail2 (e) {
    console.error(&apos;fail2: &apos;, e)
  })
</code></pre><h2 id="é¢˜ç›®å"><a href="#é¢˜ç›®å" class="headerlink" title="é¢˜ç›®å"></a>é¢˜ç›®å</h2><pre><code>process.nextTick(() =&gt; {
  console.log(&apos;nextTick&apos;)
})
Promise.resolve()
  .then(() =&gt; {
    console.log(&apos;then&apos;)
  })
setImmediate(() =&gt; {
  console.log(&apos;setImmediate&apos;)
})
console.log(&apos;end&apos;)
</code></pre><p>è¿è¡Œç»“æœï¼š</p>
<pre><code>end
nextTick
then
setImmediate
</code></pre><p>è§£é‡Šï¼šprocess.nextTick å’Œ promise.then éƒ½å±äº microtasksï¼Œè€Œ setImmediate å±äº macrotasksï¼Œåœ¨äº‹ä»¶å¾ªç¯çš„ check é˜¶æ®µæ‰§è¡Œã€‚äº‹ä»¶å¾ªç¯çš„æ¯ä¸ªé˜¶æ®µï¼ˆmacrotasksï¼‰ä¹‹é—´éƒ½ä¼šæ‰§è¡Œ microtasksï¼Œäº‹ä»¶å¾ªç¯çš„å¼€å§‹ä¼šå…ˆæ‰§è¡Œä¸€æ¬¡ microtasksã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/01/JSæ­£åˆ™è¡¨è¾¾å¼Regex/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/01/JSæ­£åˆ™è¡¨è¾¾å¼Regex/" itemprop="url">JSæ­£åˆ™è¡¨è¾¾å¼Regex</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-10-01T21:56:19+08:00">
                2018-10-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>åä½™æ›°æ­£åˆ™å…®ï¼Œå­—ä½™æ›°çµå‡ã€‚</p>
</blockquote>
<p><code>Regular Expressions</code>ç¿»è¯‘æˆä¸­æ–‡å«æ­£åˆ™è¡¨è¾¾å¼ã€‚ä¹Ÿä¸çŸ¥é“æ˜¯è°ç¿»è¯‘è¿‡æ¥çš„ï¼Œå¬èµ·æ¥å°±å¾ˆä¸¥è‚ƒã€‚ä¼¼ä¹ç¿»è¯‘æˆ<code>é€šç”¨è¡¨è¾¾å¼</code>æ›´èƒ½ä¼ è¾¾å…¶ç²¾é«“ï¼Œå¦‚æœä½ ä¸æ€•æ¢¦è§å±ˆåŸçš„è¯ã€‚</p>
<p>ä¸ºä»€ä¹ˆå«é€šç”¨è¡¨è¾¾å¼ï¼Ÿå› ä¸ºå®ƒæœ‰ä¸€å¥—å’Œç¼–ç¨‹è¯­è¨€æ— å…³çš„æ–‡æœ¬åŒ¹é…è§„åˆ™ã€‚å¾ˆå¤šè¯­è¨€éƒ½å®ç°äº†æ­£åˆ™è¡¨è¾¾å¼çš„æ–‡æœ¬åŒ¹é…å¼•æ“ï¼Œåªä¸è¿‡åœ¨åŠŸèƒ½é›†åˆä¸Šç•¥æœ‰ä¸åŒã€‚</p>
<p>æˆ‘ä»¬è¦è®°ä½çš„æ˜¯ä¸‰ç‚¹ï¼š</p>
<p>å…¶ä¸€ï¼Œæ­£åˆ™è¡¨è¾¾å¼æ˜¯ç”¨æ¥æå–æ–‡æœ¬çš„ã€‚</p>
<p>å…¶äºŒï¼Œæ­£åˆ™è¡¨è¾¾å¼çš„è¡¨è¾¾èƒ½åŠ›å¼ºå¤§åˆ°ä»¤äººå‘æŒ‡ã€‚</p>
<p>å…¶ä¸‰ï¼Œæ­£åˆ™è¡¨è¾¾å¼çš„è¯­æ³•å¯¹åˆå­¦è€…ä¸å‹å¥½ã€‚</p>
<p>å¦å¤–ï¼Œæœ¬ä¸“é¢˜åªæ¶‰åŠJavaScriptè¯­è¨€çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œå…¶ä»–è¯­è¨€çš„è§„åˆ™å¯èƒ½ç•¥æœ‰ä¸åŒã€‚</p>
<p>æˆ‘è¿˜ä¸ºå„ä½è¯»è€…å‡†å¤‡äº†ä¸€å‰¯å®£ä¼ è¯­ï¼Œåº”è¯¥èƒ½è®©ä½ å¿ƒåŠ¨(ç‚¹èµ)å§ï¼Ÿ</p>
<blockquote>
<p>å­¦ä¸€é—¨å‰ç«¯å·¥å…·ï¼Œå‡ å¹´å°±è¿‡æ—¶äº†ã€‚å­¦æ­£åˆ™è¡¨è¾¾å¼ï¼Œå—ç”¨ä¸€è¾ˆå­ã€‚</p>
</blockquote>
<h2 id="æ™®é€šå­—ç¬¦"><a href="#æ™®é€šå­—ç¬¦" class="headerlink" title="æ™®é€šå­—ç¬¦"></a>æ™®é€šå­—ç¬¦</h2><p>ä»€ä¹ˆå«æ™®é€šå­—ç¬¦ï¼Ÿ</p>
<p>å½“æˆ‘ä»¬å†™<code>a</code>çš„æ—¶å€™ï¼Œæˆ‘ä»¬æŒ‡çš„å°±æ˜¯<code>a</code>ï¼›å½“æˆ‘ä»¬å†™<code>çˆ±</code>çš„æ—¶å€™ï¼Œæˆ‘ä»¬æŒ‡çš„å°±æ˜¯<code>çˆ±</code>ã€‚</p>
<pre><code>&apos;hello ğŸ˜€ regex&apos;.match(/ğŸ˜€/);
// [&quot;ğŸ˜€&quot;, index: 6, input: &quot;hello ğŸ˜€ regex&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><p>è¿™å°±æ˜¯æ™®é€šå­—ç¬¦ï¼Œå®ƒåœ¨æ­£åˆ™ä¸­çš„å«ä¹‰å°±æ˜¯æ£€ç´¢å®ƒæœ¬èº«ã€‚é™¤äº†æ­£åˆ™è§„å®šçš„éƒ¨åˆ†å­—ç¬¦å¤–ï¼Œå…¶ä½™çš„éƒ½æ˜¯æ™®é€šå­—ç¬¦ï¼ŒåŒ…æ‹¬å„ç§äººç±»è¯­è¨€ï¼ŒåŒ…æ‹¬emojiï¼Œåªè¦èƒ½å¤Ÿè¡¨è¾¾ä¸ºå­—ç¬¦ä¸²ã€‚</p>
<h2 id="å¼€å§‹ä¸ç»“æŸ"><a href="#å¼€å§‹ä¸ç»“æŸ" class="headerlink" title="å¼€å§‹ä¸ç»“æŸ"></a>å¼€å§‹ä¸ç»“æŸ</h2><p><code>^</code>å­—ç¬¦çš„è‹±æ–‡æ˜¯<code>caret</code>ï¼Œç¿»è¯‘æˆä¸­æ–‡æ˜¯<code>è„±å­—ç¬¦</code>ã€‚ä¸è¦é—®æˆ‘ï¼Œåˆä¸æ˜¯æˆ‘ç¿»è¯‘çš„ã€‚å®ƒåœ¨æ­£åˆ™ä¸­å±äºå…ƒå­—ç¬¦ï¼Œé€šå¸¸ä»£è¡¨çš„æ„ä¹‰æ˜¯æ–‡æœ¬çš„å¼€å§‹ã€‚è¯´é€šå¸¸æ˜¯å› ä¸ºå½“å®ƒåœ¨å­—ç¬¦ç»„ä¸­<code>[^abc]</code>å¦æœ‰å«ä¹‰ã€‚</p>
<p>ä»€ä¹ˆå«æ–‡æœ¬çš„å¼€å§‹ï¼Ÿå°±æ˜¯å¦‚æœå®ƒæ˜¯æ­£åˆ™ä¸»ä½“çš„ç¬¬ä¸€ä¸ªç¬¦å·ï¼Œé‚£ç´§è·Ÿç€å®ƒçš„å­—ç¬¦å¿…é¡»æ˜¯è¢«åŒ¹é…æ–‡æœ¬çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ã€‚</p>
<pre><code>&apos;regex&apos;.match(/^r/);
// [&quot;r&quot;, index: 0, input: &quot;regex&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><p>é—®é¢˜æ¥äº†ï¼Œå¦‚æœ<code>^</code>ä¸æ˜¯æ­£åˆ™çš„ç¬¬ä¸€ä¸ªç¬¦å·å‘¢ï¼Ÿ</p>
<pre><code>&apos;regex&apos;.match(/a^r/);
// nullå¤åˆ¶ä»£ç 
</code></pre><p>æ‰€ä»¥å‘€ï¼Œå…³äºå®ƒæœ‰ä¸‰ç‚¹éœ€è¦æ³¨æ„ï¼š</p>
<ul>
<li>ä½œä¸ºåŒ¹é…æ–‡æœ¬å¼€å§‹å…ƒå­—ç¬¦çš„æ—¶å€™å¿…é¡»æ˜¯æ­£åˆ™ä¸»ä½“çš„ç¬¬ä¸€ä¸ªç¬¦å·ï¼Œå¦åˆ™æ­£åˆ™æ— æ•ˆã€‚</li>
<li>å®ƒåŒ¹é…çš„æ˜¯ä¸€ä¸ªä½ç½®ï¼Œè€Œä¸æ˜¯å…·ä½“çš„æ–‡æœ¬ã€‚</li>
<li>å®ƒåœ¨å…¶ä»–è§„åˆ™ä¸­æœ‰å¦å¤–çš„å«ä¹‰ã€‚</li>
</ul>
<p><code>$</code>å­—ç¬¦ä¸<code>^</code>æ­£å¥½ç›¸åã€‚å®ƒä»£è¡¨æ–‡æœ¬çš„ç»“æŸï¼Œå¹¶ä¸”æ²¡æœ‰å…¶ä»–å«ä¹‰(å…¶å®æ˜¯æœ‰çš„ï¼Œä½†ä¸æ˜¯åœ¨æ­£åˆ™ä¸»ä½“å†…)ã€‚åŒæ ·ï¼Œå®ƒå¿…é¡»æ˜¯æ­£åˆ™ä¸»ä½“çš„æœ€åä¸€ä¸ªç¬¦å·ã€‚</p>
<pre><code>&apos;regex&apos;.match(/x$/);
// [&quot;x&quot;, index: 4, input: &quot;regex&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><p><code>^</code>ä¸<code>$</code>ç‰¹æ®Šçš„åœ°æ–¹åœ¨äºå®ƒåŒ¹é…çš„æ˜¯ä¸€ä¸ªä½ç½®ã€‚ä½ç½®ä¸åƒå­—ç¬¦ï¼Œå®ƒçœ‹ä¸è§ï¼Œæ‰€ä»¥æ›´ä¸å®¹æ˜“ç†è§£ã€‚</p>
<h2 id="è½¬ä¹‰"><a href="#è½¬ä¹‰" class="headerlink" title="è½¬ä¹‰"></a>è½¬ä¹‰</h2><p>æˆ‘ä»¬ç°åœ¨å·²ç»çŸ¥é“<code>$</code>åŒ¹é…æ–‡æœ¬çš„ç»“æŸä½ç½®ï¼Œå®ƒæ˜¯å…ƒå­—ç¬¦ã€‚ä½†æ˜¯å¦‚æœæˆ‘æƒ³åŒ¹é…<code>$</code>æœ¬èº«å‘¢ï¼ŸåŒ¹é…ä¸€ä¸ªç¾å…ƒç¬¦å·çš„éœ€æ±‚å†å¸¸è§ä¸è¿‡äº†å§ã€‚æ‰€ä»¥æˆ‘ä»¬å¾—å°†å®ƒè´¬ä¸ºåº¶æ°‘ã€‚</p>
<p><code>\</code>åæ–œæ å°±æ˜¯å¹²è¿™ä¸ªçš„ã€‚</p>
<pre><code>&apos;price: $3.6&apos;.match(/\$[0-9]+\.[0-9]+$/);
// [&quot;$3.6&quot;, index: 7, input: &quot;price: $3.6&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><p>ä¸Šé¢çš„ä¾‹å­æœ‰ç‚¹è¶…çº²äº†ï¼Œè¶…çº²çš„éƒ¨åˆ†å…ˆä¸ç®¡ã€‚</p>
<p>ä½ å¯ä»¥è®¤ä¸º<code>\</code>ä¹Ÿæ˜¯ä¸€ä¸ªå…ƒå­—ç¬¦ï¼Œå®ƒè·Ÿåœ¨å¦ä¸€ä¸ªå…ƒå­—ç¬¦åé¢ï¼Œå°±èƒ½è¿˜åŸå®ƒæœ¬æ¥çš„å«ä¹‰ã€‚</p>
<p>å¦‚æœæœ‰ä¸¤ä¸ª<code>\</code>å‘¢ï¼Ÿé‚£å°±æ˜¯è½¬ä¹‰è‡ªèº«äº†ã€‚å¦‚æœæœ‰ä¸‰ä¸ª<code>\</code>å‘¢ï¼Ÿæˆ‘ä»¬å¾—åˆ†æˆä¸¤æ®µå»ç†è§£ã€‚ä»¥æ­¤ç±»æ¨ã€‚</p>
<p>æ™®é€šå­—ç¬¦å‰é¢è·Ÿäº†ä¸€ä¸ª<code>\</code>æ˜¯ä»€ä¹ˆæ•ˆæœï¼Ÿé¦–å…ˆå®ƒä»¬æ˜¯ä¸€ä¸ªæ•´ä½“ï¼Œç„¶åæ™®é€šå­—ç¬¦è½¬ä¹‰åè¿˜æ˜¯æ™®é€šå­—ç¬¦ã€‚</p>
<h2 id="å¸¦åæ–œæ çš„å…ƒå­—ç¬¦"><a href="#å¸¦åæ–œæ çš„å…ƒå­—ç¬¦" class="headerlink" title="å¸¦åæ–œæ çš„å…ƒå­—ç¬¦"></a>å¸¦åæ–œæ çš„å…ƒå­—ç¬¦</h2><p>ä¸€èˆ¬æ¥è¯´ï¼Œæ™®é€šå­—ç¬¦å‰é¢å¸¦åæ–œæ è¿˜æ˜¯æ™®é€šå­—ç¬¦ï¼Œä½†æ˜¯æœ‰ä¸€äº›æ™®é€šå­—ç¬¦ï¼Œå¸¦åæ–œæ ååè€Œå˜æˆäº†å…ƒå­—ç¬¦ã€‚</p>
<p>è¦æ€ªåªèƒ½æ€ªè®¡ç®—æœºé¢†åŸŸçš„å¸¸ç”¨ç¬¦å·å¤ªå°‘äº†ã€‚<br>å…ƒå­—ç¬¦å«ä¹‰\båŒ¹é…ä¸€ä¸ªå•è¯è¾¹ç•Œ(boundary)\BåŒ¹é…ä¸€ä¸ªéå•è¯è¾¹ç•Œ\dåŒ¹é…ä¸€ä¸ªæ•°å­—å­—ç¬¦(digit)\DåŒ¹é…ä¸€ä¸ªéæ•°å­—å­—ç¬¦\såŒ¹é…ä¸€ä¸ªç©ºç™½å­—ç¬¦(space)\SåŒ¹é…ä¸€ä¸ªéç©ºç™½å­—ç¬¦\wåŒ¹é…ä¸€ä¸ªå­—æ¯æˆ–è€…ä¸€ä¸ªæ•°å­—æˆ–è€…ä¸€ä¸ªä¸‹åˆ’çº¿(word)\WåŒ¹é…ä¸€ä¸ªå­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿ä¹‹å¤–çš„å­—ç¬¦<br>ä½ è¿™ä¹ˆèªæ˜ï¼Œè‚¯å®šä¸€çœ¼å°±çœ‹å‡ºæ¥ï¼Œå¤§å†™ä»£è¡¨åä¹‰ã€‚å¯¹ï¼Œå°±æ˜¯è¿™ä¹ˆå¥½è®°ã€‚</p>
<h4 id="bå…ƒå­—ç¬¦"><a href="#bå…ƒå­—ç¬¦" class="headerlink" title="\bå…ƒå­—ç¬¦"></a>\bå…ƒå­—ç¬¦</h4><p><code>\b</code>åŒ¹é…çš„ä¹Ÿæ˜¯ä¸€ä¸ªä½ç½®ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå­—ç¬¦ã€‚å•è¯å’Œç©ºæ ¼ä¹‹é—´çš„ä½ç½®ï¼Œå°±æ˜¯æ‰€è°“å•è¯è¾¹ç•Œã€‚</p>
<pre><code>&apos;hello regex&apos;.match(/\bregex$/);
// [&quot;regex&quot;, index: 6, input: &quot;hello regex&quot;, groups: undefined]&apos;hello regex&apos;.match(/\Bregex$/);
// nullå¤åˆ¶ä»£ç 
</code></pre><p>æ‰€è°“å•è¯è¾¹ç•Œï¼Œå¯¹ä¸­æ–‡ç­‰å…¶ä»–è¯­è¨€æ˜¯æ— æ•ˆçš„ã€‚</p>
<pre><code>&apos;jiangshuying gaoyuanyuan huosiyan&apos;.match(/\bgaoyuanyuan\b/);
// [&quot;gaoyuanyuan&quot;, index: 13, input: &quot;jiangshuying gaoyuanyuan huosiyan&quot;, groups: undefined]&apos;æ±Ÿç–å½± é«˜åœ†åœ† éœæ€ç‡•&apos;.match(/\bé«˜åœ†åœ†\b/);
// nullå¤åˆ¶ä»£ç 
</code></pre><p>æ‰€ä»¥<code>\b</code>ç¿»è¯‘ä¸€ä¸‹å°±æ˜¯<code>^\w|\w$|\W\w|\w\W</code>ã€‚</p>
<h4 id="då…ƒå­—ç¬¦"><a href="#då…ƒå­—ç¬¦" class="headerlink" title="\då…ƒå­—ç¬¦"></a>\då…ƒå­—ç¬¦</h4><p><code>\d</code>åŒ¹é…ä¸€ä¸ªæ•°å­—ï¼Œæ³¨æ„ï¼Œè¿™é‡Œçš„æ•°å­—ä¸æ˜¯æŒ‡JavaScriptä¸­çš„æ•°å­—ç±»å‹ï¼Œå› ä¸ºæ–‡æœ¬å…¨æ˜¯å­—ç¬¦ä¸²ã€‚å®ƒæŒ‡çš„æ˜¯ä»£è¡¨æ•°å­—çš„å­—ç¬¦ã€‚</p>
<pre><code>&apos;123&apos;.match(/\d/);
// [&quot;1&quot;, index: 0, input: &quot;123&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><h4 id="så…ƒå­—ç¬¦"><a href="#så…ƒå­—ç¬¦" class="headerlink" title="\så…ƒå­—ç¬¦"></a>\så…ƒå­—ç¬¦</h4><p><code>\s</code>åŒ¹é…ä¸€ä¸ªç©ºç™½å­—ç¬¦ã€‚</p>
<p>è¿™é‡Œéœ€è¦è§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯ç©ºç™½å­—ç¬¦ã€‚</p>
<p>ç©ºç™½å­—ç¬¦ä¸æ˜¯ç©ºæ ¼ï¼Œå®ƒæ˜¯ç©ºæ ¼çš„è¶…é›†ã€‚å¾ˆå¤šäººè¯´å®ƒæ˜¯<code>\f\n\r\t\v</code>çš„æ€»å’Œï¼Œå…¶ä¸­<code>\f</code>æ˜¯æ¢é¡µç¬¦ï¼Œ<code>\n</code>æ˜¯æ¢è¡Œç¬¦ï¼Œ<code>\r</code>æ˜¯å›è½¦ç¬¦ï¼Œ<code>\t</code>æ˜¯æ°´å¹³åˆ¶è¡¨ç¬¦ï¼Œ<code>\v</code>æ˜¯å‚ç›´åˆ¶è¡¨ç¬¦ã€‚æ˜¯è¿™æ ·ä¹ˆï¼Ÿ</p>
<pre><code>&apos;a b&apos;.match(/\w\s\w/);
// [&quot;a b&quot;, index: 0, input: &quot;a b&quot;, groups: undefined]&apos;a b&apos;.match(/\w\f\w/);
// null&apos;a b&apos;.match(/\w\n\w/);
// null&apos;a b&apos;.match(/\w\r\w/);
// null&apos;a b&apos;.match(/\w\t\w/);
// null&apos;a b&apos;.match(/\w\v\w/);
// null&apos;a b&apos;.match(/\w \w/);
// [&quot;a b&quot;, index: 0, input: &quot;a b&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><p>è¿™æ ·è¯´çš„äººï¼Œæ˜æ˜¾æ˜¯æ²¡æœ‰åšè¿‡å®éªŒã€‚å…¶å®æ­£ç¡®çš„å†™æ³•æ˜¯<code>ç©ºæ ¼\f\n\r\t\v</code>çš„æ€»å’Œï¼Œé›†åˆé‡Œé¢åŒ…å«ä¸€ä¸ªç©ºæ ¼ï¼Œå¯åƒä¸‡åˆ«å¿½ç•¥äº†ã€‚è¯¶ï¼Œéš¾é“ç©ºæ ¼åœ¨æ­£åˆ™ä¸­çš„å†™æ³•å°±æ˜¯<code>ç©ºä¸€æ ¼</code>ä¹ˆï¼Œæ˜¯çš„ï¼Œå°±æ˜¯è¿™æ ·éšæ„ã€‚</p>
<p>è¿™ä¸ªé›†åˆä¸­å¾ˆå¤šéƒ½æ˜¯ä¸å¯æ‰“å°å­—ç¬¦ï¼Œä¼°è®¡åªæœ‰<code>\n</code>æ˜¯æˆ‘ä»¬çš„è€æœ‹å‹ã€‚æ‰€ä»¥ï¼Œå¦‚æœä¸éœ€è¦åŒºåˆ†ç©ºæ ¼å’Œæ¢è¡Œçš„è¯ï¼Œé‚£å°±å¤§èƒ†çš„ç”¨<code>\s</code>å§ã€‚</p>
<h4 id="wå…ƒå­—ç¬¦"><a href="#wå…ƒå­—ç¬¦" class="headerlink" title="\wå…ƒå­—ç¬¦"></a>\wå…ƒå­—ç¬¦</h4><p><code>\w</code>åŒ¹é…ä¸€ä¸ªå­—æ¯æˆ–è€…ä¸€ä¸ªæ•°å­—æˆ–è€…ä¸€ä¸ªä¸‹åˆ’çº¿ã€‚ä¸ºä»€ä¹ˆè¦å°†å®ƒä»¬æ”¾ä¸€èµ·ï¼Ÿæƒ³ä¸€æƒ³JavaScriptä¸­çš„å˜é‡è§„åˆ™ï¼ŒåŒ…æ‹¬å¾ˆå¤šåº”ç”¨çš„ç”¨æˆ·åéƒ½åªèƒ½æ˜¯è¿™ä¸‰æ ·ï¼Œæ‰€ä»¥æŠŠå®ƒä»¬æ”¾ä¸€èµ·æŒºæ–¹ä¾¿çš„ã€‚</p>
<p>ä¸è¿‡è¦æ³¨æ„ï¼Œå­—æ¯æŒ‡çš„æ˜¯26ä¸ªè‹±æ–‡å­—æ¯ï¼Œå…¶ä»–çš„ä¸è¡Œã€‚</p>
<pre><code>&apos;æ­£åˆ™&apos;.match(/\w/);
// nullå¤åˆ¶ä»£ç 
</code></pre><h4 id="è´Ÿé˜´æŠ±é˜³"><a href="#è´Ÿé˜´æŠ±é˜³" class="headerlink" title="è´Ÿé˜´æŠ±é˜³"></a>è´Ÿé˜´æŠ±é˜³</h4><p>å¦‚æœæˆ‘ä»¬å°†å¤§å†™å’Œå°å†™çš„å¸¦åæ–œæ çš„å…ƒå­—ç¬¦ç»„åˆåœ¨ä¸€èµ·ï¼Œå°±èƒ½åŒ¹é…ä»»ä½•å­—ç¬¦ã€‚æ˜¯çš„ï¼Œä¸é’ˆå¯¹ä»»ä½•äººã€‚</p>
<pre><code>&apos;@regex&apos;.match(/[\s\S]/);
// [&quot;@&quot;, index: 0, input: &quot;@regex&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><p>æ–¹æ‹¬å·çš„å«ä¹‰æˆ‘ä»¬å…ˆæŒ‰ä¸‹ä¸è¡¨ã€‚</p>
<h2 id="é“ç”Ÿä¸€"><a href="#é“ç”Ÿä¸€" class="headerlink" title="é“ç”Ÿä¸€"></a>é“ç”Ÿä¸€</h2><p><code>.</code>åœ¨æ­£åˆ™ä¸­çš„å«ä¹‰ä»™é£é“éª¨ï¼Œå®ƒåŒ¹é…æ¢è¡Œç¬¦ä¹‹å¤–çš„ä»»æ„å•ä¸ªå­—ç¬¦ã€‚</p>
<p>å¦‚æœæ–‡æœ¬ä¸å­˜åœ¨æ¢è¡Œç¬¦ï¼Œé‚£ä¹ˆ<code>.</code>å’Œ<code>[\b\B]</code>å’Œ<code>[\d\D]</code>å’Œ<code>[\s\S]</code>å’Œ<code>[\w\W]</code>æ˜¯ç­‰ä»·çš„ã€‚</p>
<p>å¦‚æœæ–‡æœ¬å­˜åœ¨æ¢è¡Œç¬¦ï¼Œé‚£ä¹ˆ<code>(.|\n)</code>å’Œ<code>[\b\B]</code>å’Œ<code>[\d\D]</code>å’Œ<code>[\s\S]</code>å’Œ<code>[\w\W]</code>æ˜¯ç­‰ä»·çš„ã€‚</p>
<pre><code>&apos;@regex&apos;.match(/./);
// [&quot;@&quot;, index: 0, input: &quot;@regex&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><h2 id="é‡è¯"><a href="#é‡è¯" class="headerlink" title="é‡è¯"></a>é‡è¯</h2><p>å‰é¢æˆ‘ä»¬ä¸€ç›´åœ¨å¼ºè°ƒï¼Œä¸€ä¸ªå…ƒå­—ç¬¦åªåŒ¹é…ä¸€ä¸ªå­—ç¬¦ã€‚å³ä¾¿å¼ºå¤§å¦‚<code>.</code>å®ƒä¹Ÿåªèƒ½åŒ¹é…ä¸€ä¸ªã€‚</p>
<p>é‚£åŒ¹é…<code>gooooogle</code>çš„æ­£åˆ™æ˜¯ä¸æ˜¯å¾—å†™æˆ<code>/gooooogle/</code>å‘¢ï¼Ÿ</p>
<p>æ­£åˆ™å†·ç¬‘ï¼Œå¹¶å‘ä½ å‘å°„ä¸€ä¸ªè”‘è§†ã€‚</p>
<p>å¦‚æœåŒ¹é…çš„æ¨¡å¼æœ‰é‡å¤ï¼Œæˆ‘ä»¬å¯ä»¥å£°æ˜å®ƒé‡å¤çš„æ¬¡æ•°ã€‚<br>é‡è¯å«ä¹‰?é‡å¤é›¶æ¬¡æˆ–è€…ä¸€æ¬¡+é‡å¤ä¸€æ¬¡æˆ–è€…å¤šæ¬¡ï¼Œä¹Ÿå°±æ˜¯è‡³å°‘ä¸€æ¬¡*é‡å¤é›¶æ¬¡æˆ–è€…å¤šæ¬¡ï¼Œä¹Ÿå°±æ˜¯ä»»æ„æ¬¡æ•°{n}é‡å¤næ¬¡{n,}é‡å¤næ¬¡æˆ–è€…æ›´å¤šæ¬¡{n,m}é‡å¤næ¬¡åˆ°mæ¬¡ä¹‹é—´çš„æ¬¡æ•°ï¼ŒåŒ…å«næ¬¡å’Œmæ¬¡<br>æœ‰ä¸‰ç‚¹éœ€è¦æ³¨æ„ï¼š</p>
<ul>
<li><p><code>?</code>åœ¨è¯¸å¦‚åŒ¹é…httpåè®®çš„æ—¶å€™éå¸¸æœ‰ç”¨ï¼Œå°±åƒè¿™æ ·ï¼š<code>/http(s)?/</code>ã€‚å®ƒåœ¨æ­£åˆ™ä¸­é™¤äº†æ˜¯é‡è¯è¿˜æœ‰åˆ«çš„å«ä¹‰ï¼Œåé¢ä¼šæåˆ°ã€‚</p>
</li>
<li><p>æˆ‘ä»¬ä¹ æƒ¯ç”¨<code>/.*/</code>æ¥åŒ¹é…è‹¥å¹²å¯¹æˆ‘ä»¬æ²¡æœ‰ä»·å€¼çš„æ–‡æœ¬ï¼Œå®ƒçš„å«ä¹‰æ˜¯<code>è‹¥å¹²é™¤æ¢è¡Œç¬¦ä¹‹å¤–çš„å­—ç¬¦</code>ã€‚æ¯”å¦‚æˆ‘ä»¬éœ€è¦æ–‡æœ¬ä¸¤å¤´çš„æ ¼å¼åŒ–ä¿¡æ¯ï¼Œä¸­é—´æ˜¯ä»€ä¹ˆæ— æ‰€è°“ï¼Œå®ƒå°±æ´¾ä¸Šç”¨åœºäº†ã€‚ä¸è¿‡å®ƒçš„æ€§èƒ½å¯ä¸å¥½ã€‚</p>
</li>
<li><p><code>{n,m}</code>ä¹‹é—´ä¸èƒ½æœ‰ç©ºæ ¼ï¼Œç©ºæ ¼åœ¨æ­£åˆ™ä¸­æ˜¯æœ‰å«ä¹‰çš„ã€‚</p>
</li>
</ul>
<p>å…³äºé‡è¯æœ€ä»¤äººå›°æƒ‘çš„æ˜¯ï¼šå®ƒé‡å¤ä»€ä¹ˆï¼Ÿ</p>
<p>å®ƒé‡å¤ç´§è´´åœ¨å®ƒå‰é¢çš„æŸä¸ªé›†åˆã€‚ç¬¬ä¸€ç‚¹ï¼Œå¿…é¡»æ˜¯ç´§è´´åœ¨å®ƒå‰é¢ï¼›ç¬¬äºŒç‚¹ï¼Œé‡å¤ä¸€ä¸ªé›†åˆã€‚æœ€å¸¸è§çš„é›†åˆå°±æ˜¯ä¸€ä¸ªå­—ç¬¦ï¼Œå½“ç„¶æ­£åˆ™ä¸­æœ‰ä¸€äº›å…ƒå­—ç¬¦èƒ½å¤Ÿå°†è‹¥å¹²å­—ç¬¦å˜æˆä¸€ä¸ªé›†åˆï¼Œåé¢ä¼šè®²åˆ°ã€‚</p>
<pre><code>&apos;gooooogle&apos;.match(/go{2,5}gle/);
// [&quot;gooooogle&quot;, index: 0, input: &quot;gooooogle&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><p>å¦‚æœä¸€ä¸ªé‡è¯ç´§è´´åœ¨å¦ä¸€ä¸ªé‡è¯åé¢ä¼šæ€æ ·ï¼Ÿ</p>
<pre><code>&apos;gooooogle&apos;.match(/go{2,5}+gle/);
// Uncaught SyntaxError: Invalid regular expression: /go{2,5}+gle/: Nothing to repeatå¤åˆ¶ä»£ç 
</code></pre><h2 id="è´ªå©ªæ¨¡å¼ä¸éè´ªå©ªæ¨¡å¼"><a href="#è´ªå©ªæ¨¡å¼ä¸éè´ªå©ªæ¨¡å¼" class="headerlink" title="è´ªå©ªæ¨¡å¼ä¸éè´ªå©ªæ¨¡å¼"></a>è´ªå©ªæ¨¡å¼ä¸éè´ªå©ªæ¨¡å¼</h2><p>å‰é¢æåˆ°é‡è¯ä¸èƒ½ç´§è·Ÿåœ¨å¦ä¸€ä¸ªé‡è¯åé¢ï¼Œé©¬ä¸Šè¦ğŸ‘‹ğŸ‘‹æ‰“è„¸äº†ã€‚</p>
<pre><code>&apos;https&apos;.match(/http(s)?/);
// [&quot;https&quot;, &quot;s&quot;, index: 0, input: &quot;https&quot;, groups: undefined]&apos;https&apos;.match(/http(s)??/);
// [&quot;http&quot;, undefined, index: 0, input: &quot;https&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><p>ç„¶è€Œï¼Œæˆ‘çš„è„¸æ˜¯è¿™ä¹ˆå¥½æ‰“çš„ï¼Ÿ</p>
<p>ç´§è·Ÿåœ¨<code>?</code>åé¢çš„<code>?</code>å®ƒä¸æ˜¯ä¸€ä¸ªé‡è¯ï¼Œè€Œæ˜¯ä¸€ä¸ªæ¨¡å¼åˆ‡æ¢ç¬¦ï¼Œä»è´ªå©ªæ¨¡å¼åˆ‡æ¢åˆ°éè´ªå©ªæ¨¡å¼ã€‚</p>
<p>è´ªå©ªæ¨¡å¼åœ¨æ­£åˆ™ä¸­æ˜¯é»˜è®¤çš„æ¨¡å¼ï¼Œå°±æ˜¯åœ¨æ—¢å®šè§„åˆ™ä¹‹ä¸‹åŒ¹é…å°½å¯èƒ½å¤šçš„æ–‡æœ¬ã€‚å› ä¸ºæ­£åˆ™ä¸­æœ‰é‡è¯ï¼Œå®ƒçš„é‡å¤æ¬¡æ•°å¯èƒ½æ˜¯ä¸€ä¸ªåŒºé—´ï¼Œè¿™å°±æœ‰äº†å–èˆã€‚</p>
<p>ç´§è·Ÿåœ¨é‡è¯ä¹‹ååŠ ä¸Š<code>?</code>å°±å¯ä»¥å¼€å¯éè´ªå©ªæ¨¡å¼ã€‚æ€ä¹ˆçœäº‹æ€ä¹ˆæ¥ã€‚</p>
<p>è¿™é‡Œçš„è¦ç‚¹æ˜¯ï¼Œ<code>?</code>å¿…é¡»ç´§è·Ÿç€é‡è¯ï¼Œå¦åˆ™çš„è¯å®ƒè‡ªå·±å°±å˜æˆé‡è¯äº†ã€‚</p>
<h2 id="å­—ç¬¦ç»„"><a href="#å­—ç¬¦ç»„" class="headerlink" title="å­—ç¬¦ç»„"></a>å­—ç¬¦ç»„</h2><p>æ­£åˆ™ä¸­çš„æ™®é€šå­—ç¬¦åªèƒ½åŒ¹é…å®ƒè‡ªå·±ã€‚å¦‚æœæˆ‘è¦åŒ¹é…ä¸€ä¸ªæ™®é€šå­—ç¬¦ï¼Œä½†æ˜¯æˆ‘ä¸ç¡®å®šå®ƒæ˜¯ä»€ä¹ˆï¼Œæ€ä¹ˆåŠï¼Ÿ</p>
<pre><code>&apos;grey or gray&apos;.match(/gr[ae]y/);
// [&quot;grey&quot;, index: 0, input: &quot;grey or gray&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><p>æ–¹æ‹¬å·åœ¨æ­£åˆ™ä¸­è¡¨ç¤ºä¸€ä¸ªåŒºé—´ï¼Œæˆ‘ä»¬ç§°å®ƒä¸ºå­—ç¬¦ç»„ã€‚</p>
<p>é¦–å…ˆï¼Œå­—ç¬¦ç»„ä¸­çš„å­—ç¬¦é›†åˆåªæ˜¯æ‰€æœ‰çš„å¯é€‰é¡¹ï¼Œæœ€ç»ˆå®ƒåªèƒ½åŒ¹é…ä¸€ä¸ªå­—ç¬¦ã€‚</p>
<p>ç„¶åï¼Œå­—ç¬¦ç»„æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ä¸–ç•Œï¼Œå…ƒå­—ç¬¦ä¸éœ€è¦è½¬ä¹‰ã€‚</p>
<pre><code>&apos;$&apos;.match(/[$&amp;@]/);
// [&quot;$&quot;, index: 0, input: &quot;$&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><p>æœ€åï¼Œæœ‰ä¸¤ä¸ªå­—ç¬¦åœ¨å­—ç¬¦ç»„ä¸­æœ‰ç‰¹æ®Šå«ä¹‰ã€‚</p>
<p><code>^</code>åœ¨å­—ç¬¦ç»„ä¸­è¡¨ç¤ºå–åï¼Œä¸å†æ˜¯æ–‡æœ¬å¼€å§‹çš„ä½ç½®äº†ã€‚</p>
<pre><code>&apos;regex&apos;.match(/[^abc]/);
// [&quot;r&quot;, index: 0, input: &quot;regex&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><p>å¦‚æœæˆ‘å°±è¦<code>^</code>å‘¢ï¼Ÿå‰é¢å·²ç»è®²è¿‡äº†ï¼Œè½¬ä¹‰ã€‚</p>
<p><code>-</code>æœ¬æ¥æ˜¯ä¸€ä¸ªæ™®é€šå­—ç¬¦ï¼Œåœ¨å­—ç¬¦ç»„ä¸­æ‘‡èº«ä¸€å˜æˆä¸ºè¿å­—ç¬¦ã€‚</p>
<pre><code>&apos;13&apos;.match(/[1-9]3/);
// [&quot;13&quot;, index: 0, input: &quot;13&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><p>è¿å­—ç¬¦çš„æ„æ€æ˜¯åŒ¹é…èŒƒå›´åœ¨å®ƒçš„å·¦è¾¹å­—ç¬¦å’Œå³è¾¹å­—ç¬¦ä¹‹é—´ã€‚</p>
<p>å¦‚æœæˆ‘è¿™æ ·å‘¢ï¼Ÿ</p>
<pre><code>&apos;abc-3&apos;.match(/[0-z]/);
// [&quot;a&quot;, index: 0, input: &quot;abc-3&quot;, groups: undefined]å¤åˆ¶ä»£ç 

&apos;xyz-3&apos;.match(/[0-c]/);
// [&quot;3&quot;, index: 4, input: &quot;xyz-3&quot;, groups: undefined]å¤åˆ¶ä»£ç 

&apos;xyz-3&apos;.match(/[0-$]/);
// Uncaught SyntaxError: Invalid regular expression: /[0-$]/: Range out of order in character classå¤åˆ¶ä»£ç 
</code></pre><p>å‘ç°ä»€ä¹ˆäº†æ²¡æœ‰ï¼Ÿåªæœ‰ä¸¤ç§å­—ç¬¦æ˜¯å¯ä»¥ç”¨è¿å­—ç¬¦çš„ï¼šè‹±æ–‡å­—æ¯å’Œæ•°å­—ã€‚è€Œä¸”è‹±æ–‡å­—æ¯å¯ä»¥å’Œæ•°å­—è¿èµ·æ¥ï¼Œè‹±æ–‡å­—æ¯çš„é¡ºåºåœ¨åé¢ã€‚è¿™å’Œæ‰‘å…‹ç‰Œ<code>1 2 3 4 5 6 7 8 9 10 J Q K</code>æ˜¯ä¸€ä¸ªé“ç†ã€‚</p>
<h2 id="æ•è·ç»„ä¸éæ•è·ç»„"><a href="#æ•è·ç»„ä¸éæ•è·ç»„" class="headerlink" title="æ•è·ç»„ä¸éæ•è·ç»„"></a>æ•è·ç»„ä¸éæ•è·ç»„</h2><p>æˆ‘ä»¬å·²ç»çŸ¥é“é‡è¯æ˜¯æ€ä¹ˆå›äº‹äº†ï¼Œæˆ‘ä»¬ä¹ŸçŸ¥é“é‡è¯åªèƒ½é‡å¤ç´§è´´åœ¨å®ƒå‰é¢çš„å­—ç¬¦ã€‚</p>
<p>å¦‚æœæˆ‘è¦é‡å¤çš„æ˜¯ä¸€ä¸²å­—ç¬¦å‘¢ï¼Ÿ</p>
<pre><code>&apos;i love you very very very much&apos;.match(/i love you very +much/);
// null&apos;i love you very very very much&apos;.match(/i love you v+e+r+y+ +much/);
// nullå¤åˆ¶ä»£ç 
</code></pre><p>è¿™æ ·è‚¯å®šæ˜¯ä¸è¡Œçš„ã€‚æ˜¯æ—¶å€™è¯·åœ†æ‹¬å·å‡ºå±±äº†ã€‚</p>
<pre><code>&apos;i love you very very very much&apos;.match(/i love you (very )+much/);
// [&quot;i love you very very very much&quot;, &quot;very &quot;, index: 0, input: &quot;i love you very very very much&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><p>åœ†æ‹¬å·çš„æ„æ€æ˜¯å°†å®ƒå…¶ä¸­çš„å­—ç¬¦é›†åˆæ‰“åŒ…æˆä¸€ä¸ªæ•´ä½“ï¼Œç„¶åé‡è¯å°±å¯ä»¥æ“ä½œè¿™ä¸ªæ•´ä½“äº†ã€‚è¿™å’Œæ–¹æ‹¬å·çš„æ•ˆæœæ˜¯å®Œå…¨ä¸ä¸€æ ·çš„ã€‚</p>
<p>è€Œä¸”é»˜è®¤çš„ï¼Œåœ†æ‹¬å·çš„åŒ¹é…ç»“æœæ˜¯å¯ä»¥æ•è·çš„ã€‚</p>
<h4 id="æ­£åˆ™å†…æ•è·"><a href="#æ­£åˆ™å†…æ•è·" class="headerlink" title="æ­£åˆ™å†…æ•è·"></a>æ­£åˆ™å†…æ•è·</h4><p>ç°åœ¨æˆ‘ä»¬æœ‰ä¸€ä¸ªéœ€æ±‚ï¼ŒåŒ¹é…<code>&lt;div&gt;</code>æ ‡ç­¾ã€‚</p>
<pre><code>&apos;&lt;div&gt;hello regex&lt;/div&gt;&apos;.match(/&lt;div&gt;.*&lt;\/div&gt;/);
// [&quot;&lt;div&gt;hello regex&lt;/div&gt;&quot;, index: 0, input: &quot;&lt;div&gt;hello regex&lt;/div&gt;&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><p>è¿™å¾ˆç®€å•ã€‚ä½†å¦‚æœæˆ‘è¦åŒ¹é…çš„æ˜¯ä»»æ„æ ‡ç­¾ï¼ŒåŒ…æ‹¬è‡ªå®šä¹‰çš„æ ‡ç­¾å‘¢ï¼Ÿ</p>
<pre><code>&apos;&lt;App&gt;hello regex&lt;/App&gt;&apos;.match(/&lt;([a-zA-Z]+)&gt;.*&lt;\/\1&gt;/);
// [&quot;&lt;App&gt;hello regex&lt;/App&gt;&quot;, &quot;App&quot;, index: 0, input: &quot;&lt;App&gt;hello regex&lt;/App&gt;&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><p>è¿™æ—¶å€™å°±è¦ç”¨åˆ°æ­£åˆ™çš„æ•è·ç‰¹æ€§ã€‚æ­£åˆ™å†…æ•è·ä½¿ç”¨<code>\æ•°å­—</code>çš„å½¢å¼ï¼Œåˆ†åˆ«å¯¹åº”å‰é¢çš„åœ†æ‹¬å·æ•è·çš„å†…å®¹ã€‚è¿™ç§æ•è·çš„å¼•ç”¨ä¹Ÿå«<strong>åå‘å¼•ç”¨</strong>ã€‚</p>
<p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªæ›´å¤æ‚çš„æƒ…å†µï¼š</p>
<pre><code>&apos;&lt;App&gt;hello regex&lt;/App&gt;&lt;p&gt;A&lt;/p&gt;&lt;p&gt;hello regex&lt;/p&gt;&apos;.match(/&lt;((A|a)pp)&gt;(hello regex)+&lt;\/\1&gt;&lt;p&gt;\2&lt;\/p&gt;&lt;p&gt;\3&lt;\/p&gt;/);
// [&quot;&lt;App&gt;hello regex&lt;/App&gt;&lt;p&gt;A&lt;/p&gt;&lt;p&gt;hello regex&lt;/p&gt;&quot;, &quot;App&quot;, &quot;A&quot;, &quot;hello regex&quot;, index: 0, input: &quot;&lt;App&gt;hello regex&lt;/App&gt;&lt;p&gt;A&lt;/p&gt;&lt;p&gt;hello regex&lt;/p&gt;&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><p>å¦‚æœæœ‰åµŒå¥—çš„åœ†æ‹¬å·ï¼Œé‚£ä¹ˆæ•è·çš„å¼•ç”¨æ˜¯å…ˆé€’å½’çš„ï¼Œç„¶åæ‰æ˜¯ä¸‹ä¸€ä¸ªé¡¶çº§æ•è·ã€‚</p>
<h4 id="æ­£åˆ™å¤–æ•è·"><a href="#æ­£åˆ™å¤–æ•è·" class="headerlink" title="æ­£åˆ™å¤–æ•è·"></a>æ­£åˆ™å¤–æ•è·</h4><pre><code>&apos;@abc&apos;.match(/@(abc)/);
// [&quot;@abc&quot;, &quot;abc&quot;, index: 0, input: &quot;@abc&quot;, groups: undefined]RegExp.$1;
// &quot;abc&quot;å¤åˆ¶ä»£ç 
</code></pre><p>æ²¡é”™ï¼Œ<code>RegExp</code>å°±æ˜¯æ„é€ æ­£åˆ™çš„æ„é€ å‡½æ•°ã€‚å¦‚æœæœ‰æ•è·ç»„ï¼Œå®ƒçš„å®ä¾‹å±æ€§<code>$æ•°å­—</code>ä¼šæ˜¾ç¤ºå¯¹åº”çš„å¼•ç”¨ã€‚</p>
<p>å¦‚æœæœ‰å¤šä¸ªæ­£åˆ™å‘¢ï¼Ÿ</p>
<pre><code>&apos;@abc&apos;.match(/@(abc)/);
// [&quot;@abc&quot;, &quot;abc&quot;, index: 0, input: &quot;@abc&quot;, groups: undefined]&apos;@xyz&apos;.match(/@(xyz)/);
// [&quot;@xyz&quot;, &quot;xyz&quot;, index: 0, input: &quot;@xyz&quot;, groups: undefined]RegExp.$1;
// &quot;xyz&quot;å¤åˆ¶ä»£ç 
</code></pre><p><code>RegExp</code>æ„é€ å‡½æ•°çš„å¼•ç”¨åªæ˜¾ç¤ºæœ€åä¸€ä¸ªæ­£åˆ™çš„æ•è·ã€‚</p>
<p>å¦å¤–è¿˜æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²å®ä¾‹æ–¹æ³•ä¹Ÿæ”¯æŒæ­£åˆ™æ•è·çš„å¼•ç”¨ï¼Œå®ƒå°±æ˜¯<code>replace</code>æ–¹æ³•ã€‚</p>
<pre><code>&apos;hello **regex**&apos;.replace(/\*{2}(.*)\*{2}/, &apos;&lt;strong&gt;$1&lt;/strong&gt;&apos;);
// &quot;hello &lt;strong&gt;regex&lt;/strong&gt;&quot;å¤åˆ¶ä»£ç 
</code></pre><p>å®é™…ä¸Šå®ƒæ‰æ˜¯æœ€å¸¸ç”¨çš„å¼•ç”¨æ•è·çš„æ–¹å¼ã€‚</p>
<h4 id="æ•è·å‘½å"><a href="#æ•è·å‘½å" class="headerlink" title="æ•è·å‘½å"></a>æ•è·å‘½å</h4><blockquote>
<p>è¿™æ˜¯ES2018çš„æ–°ç‰¹æ€§ã€‚</p>
</blockquote>
<p>ä½¿ç”¨<code>\æ•°å­—</code>å¼•ç”¨æ•è·å¿…é¡»ä¿è¯æ•è·ç»„çš„é¡ºåºä¸å˜ã€‚ç°åœ¨å¼€å‘è€…å¯ä»¥ç»™æ•è·ç»„å‘½åäº†ï¼Œæœ‰äº†åå­—ä»¥åï¼Œå¼•ç”¨èµ·æ¥æ›´åŠ ç¡®å®šã€‚</p>
<pre><code>&apos;&lt;App&gt;hello regex&lt;/App&gt;&apos;.match(/&lt;(?&lt;tag&gt;[a-zA-Z]+)&gt;.*&lt;\/\k&lt;tag&gt;&gt;/);
// [&quot;&lt;App&gt;hello regex&lt;/App&gt;&quot;, &quot;App&quot;, index: 0, input: &quot;&lt;App&gt;hello regex&lt;/App&gt;&quot;, groups: {tag: &quot;App&quot;}]å¤åˆ¶ä»£ç 
</code></pre><p>åœ¨æ•è·ç»„å†…éƒ¨æœ€å‰é¢åŠ ä¸Š<code>?&lt;key&gt;</code>ï¼Œå®ƒå°±è¢«å‘½åäº†ã€‚ä½¿ç”¨<code>\k&lt;key&gt;</code>è¯­æ³•å°±å¯ä»¥å¼•ç”¨å·²ç»å‘½åçš„æ•è·ç»„ã€‚</p>
<p>æ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Ÿ</p>
<p>é€šå¸¸æƒ…å†µä¸‹ï¼Œå¼€å‘è€…åªæ˜¯æƒ³åœ¨æ­£åˆ™ä¸­å°†æŸäº›å­—ç¬¦å½“æˆä¸€ä¸ªæ•´ä½“çœ‹å¾…ã€‚æ•è·ç»„å¾ˆæ£’ï¼Œä½†æ˜¯å®ƒåšäº†é¢å¤–çš„äº‹æƒ…ï¼Œè‚¯å®šéœ€è¦é¢å¤–çš„å†…å­˜å ç”¨å’Œè®¡ç®—èµ„æºã€‚äºæ˜¯æ­£åˆ™åˆæœ‰äº†éæ•è·ç»„çš„æ¦‚å¿µã€‚</p>
<pre><code>&apos;@abc&apos;.match(/@(abc)/);
// [&quot;@abc&quot;, &quot;abc&quot;, index: 0, input: &quot;@abc&quot;, groups: undefined]&apos;@abc&apos;.match(/@(?:abc)/);
// [&quot;@abc&quot;, index: 0, input: &quot;@abc&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><p>åªè¦åœ¨åœ†æ‹¬å·å†…æœ€å‰é¢åŠ ä¸Š<code>?:</code>æ ‡è¯†ï¼Œå°±æ˜¯å‘Šè¯‰æ­£åˆ™å¼•æ“ï¼šæˆ‘åªè¦è¿™ä¸ªæ•´ä½“ï¼Œä¸éœ€è¦å®ƒçš„å¼•ç”¨ï¼Œä½ å°±åˆ«è´¹åŠ²äº†ã€‚ä»ä¸Šé¢çš„ä¾‹å­ä¹Ÿå¯ä»¥çœ‹å‡ºæ¥ï¼Œ<code>match</code>æ–¹æ³•è¿”å›çš„ç»“æœæœ‰äº›è®¸ä¸ä¸€æ ·ã€‚</p>
<p>ä¸ªäººè§‚ç‚¹ï¼šæˆ‘è§‰å¾—æ­£åˆ™çš„æ•è·è®¾è®¡åº”è¯¥åè¿‡æ¥ï¼Œé»˜è®¤ä¸æ•è·ï¼ŒåŠ ä¸Š<code>?:</code>æ ‡è¯†åæ‰æ•è·ã€‚å› ä¸ºå¤§å¤šæ•°æ—¶å€™å¼€å‘è€…æ˜¯ä¸éœ€è¦æ•è·çš„ï¼Œä½†æ˜¯å®ƒåˆæ‡’å¾—åŠ <code>?:</code>æ ‡è¯†ï¼Œä¼šæœ‰äº›è®¸æ€§èƒ½æµªè´¹ã€‚</p>
<h2 id="åˆ†æ”¯"><a href="#åˆ†æ”¯" class="headerlink" title="åˆ†æ”¯"></a>åˆ†æ”¯</h2><p>æœ‰æ—¶å€™å¼€å‘è€…éœ€è¦åœ¨æ­£åˆ™ä¸­ä½¿ç”¨<code>æˆ–è€…</code>ã€‚</p>
<pre><code>&apos;é«˜åœ†åœ†&apos;.match(/é™ˆä¹”æ©|é«˜åœ†åœ†/);
// [&quot;é«˜åœ†åœ†&quot;, index: 0, input: &quot;é«˜åœ†åœ†&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><p><code>|</code>å°±ä»£è¡¨<code>æˆ–è€…</code>ã€‚å­—ç¬¦ç»„å…¶å®ä¹Ÿæ˜¯ä¸€ä¸ªå¤šé€‰ç»“æ„ï¼Œä½†æ˜¯å®ƒä»¬ä¿©æœ‰æœ¬è´¨åŒºåˆ«ã€‚å­—ç¬¦ç»„æœ€ç»ˆåªèƒ½åŒ¹é…ä¸€ä¸ªå­—ç¬¦ï¼Œè€Œåˆ†æ”¯åŒ¹é…çš„æ˜¯å·¦è¾¹æ‰€æœ‰çš„å­—ç¬¦æˆ–è€…å³è¾¹æ‰€æœ‰çš„å­—ç¬¦ã€‚</p>
<p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p>
<pre><code>&apos;æˆ‘å–œæ¬¢é«˜åœ†åœ†&apos;.match(/æˆ‘å–œæ¬¢é™ˆä¹”æ©|é«˜åœ†åœ†/);
// [&quot;é«˜åœ†åœ†&quot;, index: 3, input: &quot;æˆ‘å–œæ¬¢é«˜åœ†åœ†&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><p>å› ä¸º<code>|</code>æ˜¯å°†å·¦å³ä¸¤è¾¹ä¸€åˆ‡ä¸¤åŠï¼Œç„¶ååŒ¹é…å·¦è¾¹æˆ–è€…å³è¾¹ã€‚æ‰€ä»¥ä¸Šé¢çš„æ­£åˆ™æ˜¾ç„¶è¾¾ä¸åˆ°æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœã€‚è¿™ä¸ªæ—¶å€™å°±éœ€è¦ä¸€ä¸ªä¸œè¥¿æ¥ç¼©å°åˆ†æ”¯çš„èŒƒå›´ã€‚è¯¶ï¼Œä½ å¯èƒ½å·²ç»æƒ³åˆ°äº†ï¼š</p>
<pre><code>&apos;æˆ‘å–œæ¬¢é«˜åœ†åœ†&apos;.match(/æˆ‘å–œæ¬¢(?:é™ˆä¹”æ©|é«˜åœ†åœ†)/);
// [&quot;æˆ‘å–œæ¬¢é«˜åœ†åœ†&quot;, index: 0, input: &quot;æˆ‘å–œæ¬¢é«˜åœ†åœ†&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><p>æ²¡é”™ï¼Œå°±æ˜¯åœ†æ‹¬å·ã€‚</p>
<h2 id="é›¶å®½æ–­è¨€"><a href="#é›¶å®½æ–­è¨€" class="headerlink" title="é›¶å®½æ–­è¨€"></a>é›¶å®½æ–­è¨€</h2><p>æ­£åˆ™ä¸­æœ‰ä¸€äº›å…ƒå­—ç¬¦ï¼Œå®ƒä¸åŒ¹é…å­—ç¬¦ï¼Œè€Œæ˜¯åŒ¹é…ä¸€ä¸ªä½ç½®ã€‚æ¯”å¦‚ä¹‹å‰æåˆ°çš„<code>^</code>å’Œ<code>$</code>ã€‚<code>^</code>çš„æ„æ€æ˜¯è¯´è¿™ä¸ªä½ç½®åº”è¯¥æ˜¯æ–‡æœ¬å¼€å§‹çš„ä½ç½®ã€‚</p>
<p>æ­£åˆ™è¿˜æœ‰ä¸€äº›æ¯”è¾ƒé«˜çº§çš„åŒ¹é…ä½ç½®çš„è¯­æ³•ï¼Œå®ƒåŒ¹é…çš„æ˜¯ï¼šåœ¨è¿™ä¸ªä½ç½®ä¹‹å‰æˆ–ä¹‹ååº”è¯¥æœ‰ä»€ä¹ˆå†…å®¹ã€‚</p>
<p>é›¶å®½(zero-width)æ˜¯ä»€ä¹ˆæ„æ€ï¼ŸæŒ‡çš„å°±æ˜¯å®ƒåŒ¹é…ä¸€ä¸ªä½ç½®ï¼Œæœ¬èº«æ²¡æœ‰å®½åº¦ã€‚</p>
<p>æ–­è¨€(assertion)æ˜¯ä»€ä¹ˆæ„æ€ï¼ŸæŒ‡çš„æ˜¯ä¸€ç§åˆ¤æ–­ï¼Œæ–­è¨€ä¹‹å‰æˆ–ä¹‹ååº”è¯¥æœ‰ä»€ä¹ˆæˆ–åº”è¯¥æ²¡æœ‰ä»€ä¹ˆã€‚</p>
<h4 id="é›¶å®½è‚¯å®šå…ˆè¡Œæ–­è¨€"><a href="#é›¶å®½è‚¯å®šå…ˆè¡Œæ–­è¨€" class="headerlink" title="é›¶å®½è‚¯å®šå…ˆè¡Œæ–­è¨€"></a>é›¶å®½è‚¯å®šå…ˆè¡Œæ–­è¨€</h4><p>æ‰€è°“çš„è‚¯å®šå°±æ˜¯åˆ¤æ–­æœ‰ä»€ä¹ˆï¼Œè€Œä¸æ˜¯åˆ¤æ–­æ²¡æœ‰ä»€ä¹ˆã€‚</p>
<p>è€Œå…ˆè¡ŒæŒ‡çš„æ˜¯å‘å‰çœ‹(lookahead)ï¼Œæ–­è¨€çš„è¿™ä¸ªä½ç½®æ˜¯ä¸ºå‰é¢çš„è§„åˆ™æœåŠ¡çš„ã€‚</p>
<p>è¯­æ³•å¾ˆç®€å•ï¼šåœ†æ‹¬å·å†…æœ€å·¦è¾¹åŠ ä¸Š<code>?=</code>æ ‡è¯†ã€‚</p>
<pre><code>&apos;CoffeeScript JavaScript javascript&apos;.match(/\b\w{4}(?=Script\b)/);
// [&quot;Java&quot;, index: 13, input: &quot;CoffeeScript JavaScript javascript&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><p>ä¸Šé¢åŒ¹é…çš„æ˜¯å››ä¸ªå­—æ¯ï¼Œè¿™å››ä¸ªå­—æ¯è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼šç´§è·Ÿç€çš„åº”è¯¥æ˜¯<code>Script</code>å­—ç¬¦ä¸²ï¼Œè€Œä¸”<code>Script</code>å­—ç¬¦ä¸²åº”è¯¥æ˜¯å•è¯çš„ç»“å°¾éƒ¨åˆ†ã€‚</p>
<p>æ‰€ä»¥ï¼Œé›¶å®½è‚¯å®šå…ˆè¡Œæ–­è¨€çš„æ„æ€æ˜¯ï¼šç°åœ¨æœ‰ä¸€æ®µæ­£åˆ™è¯­æ³•ï¼Œç”¨è¿™æ®µè¯­æ³•å»åŒ¹é…ç»™å®šçš„æ–‡æœ¬ã€‚ä½†æ˜¯ï¼Œæ»¡è¶³æ¡ä»¶çš„æ–‡æœ¬ä¸ä»…è¦åŒ¹é…è¿™æ®µè¯­æ³•ï¼Œç´§è·Ÿç€å®ƒçš„å¿…é¡»æ˜¯ä¸€ä¸ªä½ç½®ï¼Œè¿™ä¸ªä½ç½®åˆå¿…é¡»æ»¡è¶³ä¸€æ®µæ­£åˆ™è¯­æ³•ã€‚</p>
<p>è¯´çš„å†ç›´ç™½ç‚¹ï¼Œæˆ‘è¦åŒ¹é…ä¸€æ®µæ–‡æœ¬ï¼Œä½†æ˜¯è¿™æ®µæ–‡æœ¬åé¢å¿…é¡»ç´§è·Ÿç€å¦ä¸€æ®µç‰¹å®šçš„æ–‡æœ¬ã€‚é›¶å®½è‚¯å®šå…ˆè¡Œæ–­è¨€å°±æ˜¯ä¸€ä¸ªç•Œç¢‘ï¼Œæˆ‘è¦æ»¡è¶³å‰é¢å’Œåé¢æ‰€æœ‰çš„æ¡ä»¶ï¼Œä½†æ˜¯æˆ‘åªè¦å‰é¢çš„æ–‡æœ¬ã€‚</p>
<p>æˆ‘ä»¬æ¥çœ‹å¦ä¸€ç§æƒ…å†µï¼š</p>
<pre><code>&apos;CoffeeScript JavaScript javascript&apos;.match(/\b\w{4}(?=Script\b)\w+/);
// [&quot;JavaScript&quot;, index: 13, input: &quot;CoffeeScript JavaScript javascript&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><p>ä¸Šé¢çš„ä¾‹å­æ›´åŠ ç›´è§‚ï¼Œé›¶å®½è‚¯å®šå…ˆè¡Œæ–­è¨€å·²ç»åŒ¹é…è¿‡<code>Script</code>ä¸€æ¬¡äº†ï¼Œåé¢çš„<code>\w+</code>å´è¿˜æ˜¯èƒ½åŒ¹é…<code>Script</code>æˆåŠŸï¼Œè¶³ä»¥è¯´æ˜å®ƒçš„<code>é›¶å®½</code>ç‰¹æ€§ã€‚å®ƒä¸ºç´§è´´åœ¨å®ƒå‰é¢çš„è§„åˆ™æœåŠ¡ï¼Œå¹¶ä¸”ä¸å½±å“åé¢çš„åŒ¹é…è§„åˆ™ã€‚</p>
<h4 id="é›¶å®½è‚¯å®šåè¡Œæ–­è¨€"><a href="#é›¶å®½è‚¯å®šåè¡Œæ–­è¨€" class="headerlink" title="é›¶å®½è‚¯å®šåè¡Œæ–­è¨€"></a>é›¶å®½è‚¯å®šåè¡Œæ–­è¨€</h4><p>å…ˆè¡Œæ˜¯å‘å‰çœ‹ï¼Œé‚£åè¡Œå°±æ˜¯å‘åçœ‹(lookbehind)å’¯ã€‚</p>
<p>è¯­æ³•æ˜¯åœ†æ‹¬å·å†…æœ€å·¦è¾¹åŠ ä¸Š<code>?&lt;=</code>æ ‡è¯†ã€‚</p>
<pre><code>&apos;æ¼”å‘˜é«˜åœ†åœ† å°†å†›éœå»ç—… æ¼”å‘˜éœæ€ç‡•&apos;.match(/(?&lt;=æ¼”å‘˜)éœ\S+/);
// [&quot;éœæ€ç‡•&quot;, index: 14, input: &quot;æ¼”å‘˜é«˜åœ†åœ† å°†å†›éœå»ç—… æ¼”å‘˜éœæ€ç‡•&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><p>ä¸€ä¸ªæ­£åˆ™å¯ä»¥æœ‰å¤šä¸ªæ–­è¨€ï¼š</p>
<pre><code>&apos;æ¼”å‘˜é«˜åœ†åœ† å°†å†›éœå»ç—… æ¼”å‘˜éœæ€ç‡•&apos;.match(/(?&lt;=æ¼”å‘˜)éœ.+?(?=\s|$)/);
// [&quot;éœæ€ç‡•&quot;, index: 14, input: &quot;æ¼”å‘˜é«˜åœ†åœ† å°†å†›éœå»ç—… æ¼”å‘˜éœæ€ç‡•&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><h4 id="é›¶å®½å¦å®šå…ˆè¡Œæ–­è¨€"><a href="#é›¶å®½å¦å®šå…ˆè¡Œæ–­è¨€" class="headerlink" title="é›¶å®½å¦å®šå…ˆè¡Œæ–­è¨€"></a>é›¶å®½å¦å®šå…ˆè¡Œæ–­è¨€</h4><p>è‚¯å®šæ˜¯åˆ¤æ–­æœ‰ä»€ä¹ˆï¼Œå¦å®šå°±æ˜¯åˆ¤æ–­æ²¡æœ‰ä»€ä¹ˆå’¯ã€‚</p>
<p>è¯­æ³•æ˜¯åœ†æ‹¬å·å†…æœ€å·¦è¾¹åŠ ä¸Š<code>?!</code>æ ‡è¯†ã€‚</p>
<pre><code>&apos;TypeScript Perl JavaScript&apos;.match(/\b\w{4}(?!Script\b)/);
// [&quot;Perl&quot;, index: 11, input: &quot;TypeScript Perl JavaScript&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><h4 id="é›¶å®½å¦å®šåè¡Œæ–­è¨€"><a href="#é›¶å®½å¦å®šåè¡Œæ–­è¨€" class="headerlink" title="é›¶å®½å¦å®šåè¡Œæ–­è¨€"></a>é›¶å®½å¦å®šåè¡Œæ–­è¨€</h4><p>è¯­æ³•æ˜¯åœ†æ‹¬å·æœ€å·¦è¾¹åŠ ä¸Š<code>?&lt;!</code>æ ‡è¯†ã€‚</p>
<pre><code>&apos;æ¼”å‘˜é«˜åœ†åœ† å°†å†›éœå»ç—… æ¼”å‘˜éœæ€ç‡•&apos;.match(/(?&lt;!æ¼”å‘˜)éœ\S+/);
// [&quot;éœå»ç—…&quot;, index: 8, input: &quot;æ¼”å‘˜é«˜åœ†åœ† å°†å†›éœå»ç—… æ¼”å‘˜éœæ€ç‡•&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><h2 id="ä¿®é¥°ç¬¦"><a href="#ä¿®é¥°ç¬¦" class="headerlink" title="ä¿®é¥°ç¬¦"></a>ä¿®é¥°ç¬¦</h2><p>æ­£åˆ™è¡¨è¾¾å¼é™¤äº†ä¸»ä½“è¯­æ³•ï¼Œè¿˜æœ‰è‹¥å¹²å¯é€‰çš„æ¨¡å¼ä¿®é¥°ç¬¦ã€‚</p>
<p>å†™æ³•å°±æ˜¯å°†ä¿®é¥°ç¬¦å®‰æ’åœ¨æ­£åˆ™ä¸»ä½“çš„å°¾å·´ä¸Šã€‚æ¯”å¦‚è¿™æ ·ï¼š<code>/abc/gi</code>ã€‚</p>
<h4 id="gä¿®é¥°ç¬¦"><a href="#gä¿®é¥°ç¬¦" class="headerlink" title="gä¿®é¥°ç¬¦"></a>gä¿®é¥°ç¬¦</h4><p><code>g</code>æ˜¯<code>global</code>çš„ç¼©å†™ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ­£åˆ™ä»å·¦å‘å³åŒ¹é…ï¼Œåªè¦åŒ¹é…åˆ°äº†ç»“æœå°±ä¼šæ”¶å·¥ã€‚<code>g</code>ä¿®é¥°ç¬¦ä¼šå¼€å¯å…¨å±€åŒ¹é…æ¨¡å¼ï¼Œæ‰¾åˆ°æ‰€æœ‰åŒ¹é…çš„ç»“æœã€‚</p>
<pre><code>&apos;æ¼”å‘˜é«˜åœ†åœ† å°†å†›éœå»ç—… æ¼”å‘˜éœæ€ç‡•&apos;.match(/(?&lt;=æ¼”å‘˜)\S+/);
// [&quot;é«˜åœ†åœ†&quot;, index: 2, input: &quot;æ¼”å‘˜é«˜åœ†åœ† å°†å†›éœå»ç—… æ¼”å‘˜éœæ€ç‡•&quot;, groups: undefined]&apos;æ¼”å‘˜é«˜åœ†åœ† å°†å†›éœå»ç—… æ¼”å‘˜éœæ€ç‡•&apos;.match(/(?&lt;=æ¼”å‘˜)\S+/g);
// [&quot;é«˜åœ†åœ†&quot;, &quot;éœæ€ç‡•&quot;]å¤åˆ¶ä»£ç 
</code></pre><h4 id="iä¿®é¥°ç¬¦"><a href="#iä¿®é¥°ç¬¦" class="headerlink" title="iä¿®é¥°ç¬¦"></a>iä¿®é¥°ç¬¦</h4><p><code>i</code>æ˜¯<code>ignoreCase</code>çš„ç¼©å†™ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>/z/</code>æ˜¯æ— æ³•åŒ¹é…<code>Z</code>çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ‰æ—¶å€™ä¸å¾—ä¸è¿™æ ·å†™ï¼š<code>/[a-zA-Z]/</code>ã€‚<code>i</code>ä¿®é¥°ç¬¦å¯ä»¥å…¨å±€å¿½ç•¥å¤§å°å†™ã€‚</p>
<p>å¾ˆå¤šæ—¶å€™æˆ‘ä»¬ä¸åœ¨ä¹æ–‡æœ¬æ˜¯å¤§å†™ã€å°å†™è¿˜æ˜¯å¤§å°å†™æ··å†™ï¼Œè¿™ä¸ªä¿®é¥°ç¬¦è¿˜æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚</p>
<pre><code>&apos;javascript is great&apos;.match(/JavaScript/);
// null&apos;javascript is great&apos;.match(/JavaScript/i);
// [&quot;javascript&quot;, index: 0, input: &quot;javascript is great&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><h4 id="mä¿®é¥°ç¬¦"><a href="#mä¿®é¥°ç¬¦" class="headerlink" title="mä¿®é¥°ç¬¦"></a>mä¿®é¥°ç¬¦</h4><p><code>m</code>æ˜¯<code>multiline</code>çš„ç¼©å†™ã€‚è¿™ä¸ªä¿®é¥°ç¬¦æœ‰ç‰¹å®šèµ·ä½œç”¨çš„åœºæ™¯ï¼šå®ƒè¦å’Œ<code>^</code>å’Œ<code>$</code>æ­é…èµ·æ¥ä½¿ç”¨ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>^</code>å’Œ<code>$</code>åŒ¹é…çš„æ˜¯æ–‡æœ¬çš„å¼€å§‹å’Œç»“æŸï¼ŒåŠ ä¸Š<code>m</code>ä¿®é¥°ç¬¦ï¼Œå®ƒä»¬çš„å«ä¹‰å°±å˜æˆäº†è¡Œçš„å¼€å§‹å’Œç»“æŸã€‚</p>
<pre><code>`
abc
xyz
`.match(/xyz/);
// [&quot;xyz&quot;, index: 5, input: &quot;â†µabcâ†µxyzâ†µ&quot;, groups: undefined]`
abc
xyz
`.match(/^xyz$/);
// null`
abc
xyz
`.match(/^xyz$/m);
// [&quot;xyz&quot;, index: 5, input: &quot;â†µabcâ†µxyzâ†µ&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><h4 id="yä¿®é¥°ç¬¦"><a href="#yä¿®é¥°ç¬¦" class="headerlink" title="yä¿®é¥°ç¬¦"></a>yä¿®é¥°ç¬¦</h4><blockquote>
<p>è¿™æ˜¯ES2015çš„æ–°ç‰¹æ€§ã€‚</p>
</blockquote>
<p><code>y</code>æ˜¯<code>sticky</code>çš„ç¼©å†™ã€‚<code>y</code>ä¿®é¥°ç¬¦æœ‰å’Œ<code>g</code>ä¿®é¥°ç¬¦é‡åˆçš„åŠŸèƒ½ï¼Œå®ƒä»¬éƒ½æ˜¯å…¨å±€åŒ¹é…ã€‚æ‰€ä»¥é‡ç‚¹åœ¨<code>sticky</code>ä¸Šï¼Œæ€ä¹ˆç†è§£è¿™ä¸ª<code>ç²˜è¿</code>å‘¢ï¼Ÿ</p>
<p><code>g</code>ä¿®é¥°ç¬¦ä¸æŒ‘é£Ÿï¼ŒåŒ¹é…å®Œä¸€ä¸ªæ¥ç€åŒ¹é…ä¸‹ä¸€ä¸ªï¼Œå¯¹äºæ–‡æœ¬çš„ä½ç½®æ²¡æœ‰è¦æ±‚ã€‚ä½†æ˜¯<code>y</code>ä¿®é¥°ç¬¦è¦æ±‚å¿…é¡»ä»æ–‡æœ¬çš„å¼€å§‹å®æ–½åŒ¹é…ï¼Œå› ä¸ºå®ƒä¼šå¼€å¯å…¨å±€åŒ¹é…ï¼ŒåŒ¹é…åˆ°çš„æ–‡æœ¬çš„ä¸‹ä¸€ä¸ªå­—ç¬¦å°±æ˜¯ä¸‹ä¸€æ¬¡æ–‡æœ¬çš„å¼€å§‹ã€‚è¿™å°±æ˜¯æ‰€è°“çš„ç²˜è¿ã€‚</p>
<pre><code>&apos;a bag with a tag has a mag&apos;.match(/\wag/g);
// [&quot;bag&quot;, &quot;tag&quot;, &quot;mag&quot;]&apos;a bag with a tag has a mag&apos;.match(/\wag/y);
// null&apos;bagtagmag&apos;.match(/\wag/y);
// [&quot;bag&quot;, index: 0, input: &quot;bagtagmag&quot;, groups: undefined]&apos;bagtagmag&apos;.match(/\wag/gy);
// [&quot;bag&quot;, &quot;tag&quot;, &quot;mag&quot;]å¤åˆ¶ä»£ç 
</code></pre><p>æœ‰äººè‚¯å®šå‘ç°äº†çŒ«è…»ï¼šä½ ä¸æ˜¯è¯´<code>y</code>ä¿®é¥°ç¬¦æ˜¯å…¨å±€åŒ¹é…ä¹ˆï¼Ÿçœ‹ä¸Šé¢çš„ä¾‹å­ï¼Œå•ç‹¬ä¸€ä¸ª<code>y</code>ä¿®é¥°ç¬¦ç”¨matchæ–¹æ³•æ€ä¹ˆå¹¶ä¸æ˜¯å…¨å±€åŒ¹é…å‘¢ï¼Ÿ</p>
<p>è¯¶ï¼Œè¿™é‡Œè¯´æ¥å°±è¯é•¿äº†ã€‚</p>
<p>é•¿è¯çŸ­è¯´å‘¢ï¼Œå°±æ¶‰åŠåˆ°<code>y</code>ä¿®é¥°ç¬¦çš„æœ¬è´¨æ˜¯ä»€ä¹ˆã€‚å®ƒçš„æœ¬è´¨æœ‰äºŒï¼š</p>
<ul>
<li>å…¨å±€åŒ¹é…(å…ˆåˆ«ç€æ€¥æ‰“æˆ‘)ã€‚</li>
<li>ä»æ–‡æœ¬çš„<code>lastIndex</code>ä½ç½®å¼€å§‹æ–°çš„åŒ¹é…ã€‚lastIndexæ˜¯ä»€ä¹ˆï¼Ÿå®ƒæ˜¯æ­£åˆ™è¡¨è¾¾å¼çš„ä¸€ä¸ªå±æ€§ï¼Œå¦‚æœæ˜¯å…¨å±€åŒ¹é…ï¼Œå®ƒç”¨æ¥æ ‡æ³¨ä¸‹ä¸€æ¬¡åŒ¹é…çš„èµ·å§‹ç‚¹ã€‚è¿™æ‰æ˜¯ç²˜è¿çš„æœ¬è´¨æ‰€åœ¨ã€‚</li>
</ul>
<p>ä¸çŸ¥é“ä½ ä»¬å‘ç°ä»€ä¹ˆäº†æ²¡æœ‰ï¼š<strong>lastIndexæ˜¯æ­£åˆ™è¡¨è¾¾å¼çš„ä¸€ä¸ªå±æ€§</strong>ã€‚è€Œä¸Šé¢ä¾‹å­ä¸­çš„matchæ–¹æ³•æ˜¯ä½œç”¨åœ¨å­—ç¬¦ä¸²ä¸Šçš„ï¼Œéƒ½æ²¡æœ‰lastIndexå±æ€§ï¼Œä¼‘æ€ªäººå®¶å·¥ä½œä¸ä¸Šå¿ƒã€‚</p>
<pre><code>const reg = /\wag/y;
reg.exec(&apos;bagtagmag&apos;);
// [&quot;bag&quot;, index: 0, input: &quot;bagtagmag&quot;, groups: undefined]
reg.exec(&apos;bagtagmag&apos;);
// [&quot;tag&quot;, index: 3, input: &quot;bagtagmag&quot;, groups: undefined]
reg.exec(&apos;bagtagmag&apos;);
// [&quot;mag&quot;, index: 6, input: &quot;bagtagmag&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><p>å’±ä»¬æ¢æˆæ­£åˆ™æ–¹æ³•execï¼Œå¤šæ¬¡æ‰§è¡Œï¼Œæ­£åˆ™çš„lastIndexåœ¨å˜ï¼ŒåŒ¹é…çš„ç»“æœä¹Ÿåœ¨å˜ã€‚å…¨å±€åŒ¹é…æ— ç–‘äº†å§ã€‚</p>
<h4 id="sä¿®é¥°ç¬¦"><a href="#sä¿®é¥°ç¬¦" class="headerlink" title="sä¿®é¥°ç¬¦"></a>sä¿®é¥°ç¬¦</h4><blockquote>
<p>è¿™æ˜¯ES2018çš„æ–°ç‰¹æ€§ã€‚</p>
</blockquote>
<p><code>s</code>ä¸æ˜¯<code>dotAll</code>çš„ç¼©å†™ã€‚<code>s</code>ä¿®é¥°ç¬¦è¦å’Œ<code>.</code>æ­é…ä½¿ç”¨ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>.</code>åŒ¹é…é™¤äº†æ¢è¡Œç¬¦ä¹‹å¤–çš„ä»»æ„å•ä¸ªå­—ç¬¦ï¼Œç„¶è€Œå®ƒè¿˜æ²¡æœ‰å¼ºå¤§åˆ°æ— æ‰€ä¸èƒ½çš„åœ°æ­¥ï¼Œæ‰€ä»¥æ­£åˆ™ç´¢æ€§ç»™å®ƒå¼€ä¸ªæŒ‚ã€‚</p>
<p><code>s</code>ä¿®é¥°ç¬¦çš„ä½œç”¨å°±æ˜¯è®©<code>.</code>å¯ä»¥åŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦ã€‚</p>
<p><code>s</code>æ˜¯<code>singleline</code>çš„ç¼©å†™ã€‚</p>
<pre><code>`
abc
xyz
`.match(/c.x/);
// null`
abc
xyz
`.match(/c.x/s);
// [&quot;câ†µx&quot;, index: 3, input: &quot;â†µabcâ†µxyzâ†µ&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><h4 id="uä¿®é¥°ç¬¦"><a href="#uä¿®é¥°ç¬¦" class="headerlink" title="uä¿®é¥°ç¬¦"></a>uä¿®é¥°ç¬¦</h4><blockquote>
<p>è¿™æ˜¯ES2015çš„æ–°ç‰¹æ€§ã€‚</p>
</blockquote>
<p><code>u</code>æ˜¯<code>unicode</code>çš„ç¼©å†™ã€‚æœ‰ä¸€äº›Unicodeå­—ç¬¦è¶…è¿‡ä¸€ä¸ªå­—èŠ‚ï¼Œæ­£åˆ™å°±æ— æ³•æ­£ç¡®çš„è¯†åˆ«å®ƒä»¬ã€‚<code>u</code>ä¿®é¥°ç¬¦å°±æ˜¯ç”¨æ¥å¤„ç†è¿™äº›ä¸å¸¸è§çš„æƒ…å†µçš„ã€‚</p>
<pre><code>&apos;ğ ®·&apos;.match(/^.$/);
// null&apos;ğ ®·&apos;.match(/^.$/u);
// [&quot;ğ ®·&quot;, index: 0, input: &quot;ğ ®·&quot;, groups: undefined]å¤åˆ¶ä»£ç 
</code></pre><p><code>ğ ®·</code>å¿µ<code>jÃ­</code>ï¼Œä¸<code>å‰</code>åŒä¹‰ã€‚</p>
<p>ç¬”è€…å¯¹Unicodeè®¤è¯†å°šæµ…ï¼Œè¿™é‡Œä¸è¿‡å¤šå±•å¼€ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/01/æ¨¡æ‹Ÿå®ç°callå’Œapply/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/01/æ¨¡æ‹Ÿå®ç°callå’Œapply/" itemprop="url">æ¨¡æ‹Ÿå®ç°callå’Œapply</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-10-01T20:39:27+08:00">
                2018-10-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h4><p>JS å‡½æ•° call å’Œ apply ç”¨æ¥æ‰‹åŠ¨æ”¹å˜ this çš„æŒ‡å‘ï¼Œcall å’Œ apply  å”¯ä¸€çš„åŒºåˆ«å°±åœ¨äºå‡½æ•°å‚æ•°çš„ä¼ é€’æ–¹å¼ä¸åŒï¼Œcall æ˜¯ä»¥é€—å·çš„å½¢å¼ï¼Œapply æ˜¯ä»¥æ•°ç»„çš„å½¢å¼ï¼š</p>
<pre><code>let person1 = {
    name: &quot;person1&quot;,
    say: function(age, sex) {
        console.log(this.name + &apos; age: &apos; + age + &apos; sex: &apos; + sex);
    }
}

let person2 = {
    name: &quot;person&quot;
}

person1.say.call(person2, 20, &quot;ç”·&quot;);

person1.say.apply(person2, [20, &quot;ç”·&quot;]);
</code></pre><p>æœ¬æ–‡å°±å°è¯•ç”¨å…¶ä»–æ–¹å¼æ¥æ¨¡æ‹Ÿå®ç° call å’Œ applyã€‚</p>
<p>é¦–å…ˆè§‚å¯Ÿ call å’Œ apply æœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ</p>
<ol>
<li>è¢«å‡½æ•°è°ƒç”¨ï¼ˆå‡½æ•°ä¹Ÿæ˜¯å¯¹è±¡ï¼‰ï¼Œç›¸å½“äº call å’Œ apply æ˜¯å‡½æ•°çš„å±æ€§</li>
<li>å¦‚æœæ²¡æœ‰ä¼ å…¥éœ€è¦ this æŒ‡å‘å¯¹è±¡ï¼Œé‚£ä¹ˆ this æŒ‡å‘å…¨å±€å¯¹è±¡</li>
<li>å‡½æ•°æ‰§è¡Œäº†</li>
<li>æœ€åéƒ½æ”¹å˜äº† this çš„æŒ‡å‘</li>
</ol>
<h4 id="ä¸€ã€åˆæ­¥å®ç°"><a href="#ä¸€ã€åˆæ­¥å®ç°" class="headerlink" title="ä¸€ã€åˆæ­¥å®ç°"></a>ä¸€ã€åˆæ­¥å®ç°</h4><p>åŸºäº call å‡½æ•°æ˜¯è°ƒç”¨å‡½æ•°çš„å±æ€§çš„ç‰¹ç‚¹ï¼Œcall çš„ this æŒ‡å‘è°ƒç”¨å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•æŠŠè°ƒç”¨å‡½æ•°çš„ä½œä¸ºä¼ å…¥çš„æ–°å¯¹è±¡çš„ä¸€ä¸ªå±æ€§ï¼Œæ‰§è¡Œåï¼Œå†åˆ é™¤è¿™ä¸ªå±æ€§å°±å¥½äº†ã€‚</p>
<pre><code>Function.prototype.newCall = function (context) {
    context.fn = this;  // this æŒ‡çš„æ˜¯ say å‡½æ•°
    context.fn();
    delete context.fn;
}

var person = {
    name: &quot;jayChou&quot;
};

var say = function() {
    console.log(this.name);
}

say.newCall(person);  // jayChou
</code></pre><p>æ˜¯ä¸æ˜¯å°±åˆæ­¥æ¨¡æ‹Ÿå®ç°äº† call å‡½æ•°å‘¢ï¼Œç”±äº call è¿˜æ¶‰åŠåˆ°ä¼ å‚çš„é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿›å…¥åˆ°ä¸‹ä¸€ç¯èŠ‚ã€‚</p>
<h4 id="äºŒã€eval-æ–¹å¼"><a href="#äºŒã€eval-æ–¹å¼" class="headerlink" title="äºŒã€eval æ–¹å¼"></a>äºŒã€eval æ–¹å¼</h4><p>åœ¨ç»™å¯¹è±¡ä¸´æ—¶ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶æ‰§è¡Œæ—¶ï¼Œä¼ å…¥çš„å‚æ•°æ˜¯é™¤äº† context å…¶ä½™çš„å‚æ•°ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æˆªå– arguments å‚æ•°æ•°ç»„çš„ç¬¬ä¸€ä¸ªåï¼Œå°†å‰©ä½™çš„å‚æ•°ä¼ å…¥ä¸´æ—¶æ•°ç»„ã€‚</p>
<p>åœ¨å‰é¢æˆ‘æœ‰è®²è¿‡å‡½æ•° arguments ç±»æ•°ç»„å¯¹è±¡çš„ç‰¹ç‚¹ï¼Œarguments æ˜¯ä¸æ”¯æŒæ•°ç»„çš„å¤§å¤šæ•°æ–¹æ³•, ä½†æ˜¯æ”¯æŒfor å¾ªç¯æ¥éå†æ•°ç»„ã€‚</p>
<pre><code>Function.prototype.newCall = function (context) {
    context.fn = this;

    let args = [];

    for(let i=1; i&lt; arguments.length; i++) {
        args.push(&apos;arguments[&apos; + i + &apos;]&apos;);
    }
    // args =&gt; [arguments[1], arguments[2], arguments[3], ...]

    context.fn(args.join(&apos;,&apos;));  // ï¼Ÿï¼Ÿï¼Ÿdelete context.fn;
}

var person = {
    name: &quot;jayChou&quot;
};

var say = function(age, sex) {
    console.log(`name: ${this.name},age: ${age}, sex: ${sex}`);
}

say.newCall(person);
</code></pre><p>ä¸Šé¢ä¼ é€’å‚æ•°çš„æ–¹å¼æœ€åè‚¯å®šæ˜¯å¤±è´¥çš„ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯• eval çš„æ–¹å¼ï¼Œå°†å‚æ•°æ·»åŠ å­å‡½æ•°çš„ä½œç”¨åŸŸä¸­ã€‚</p>
<blockquote>
<p>eval() å‡½æ•°å¯è®¡ç®—æŸä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶æ‰§è¡Œå…¶ä¸­çš„çš„ JavaScript ä»£ç </p>
</blockquote>
<pre><code>Function.prototype.newCall = function (context) {
    context.fn = this;

    let args = [];

    for(var i=1; i&lt; arguments.length; i++) {
        args.push(&apos;arguments[&apos; + i + &apos;]&apos;);
    }

    // args =&gt; [arguments[1], arguments[2], arguments[3], ...]eval(&apos;context.fn(&apos; + args + &apos;)&apos;);
    delete context.fn;
}

var person = {
    name: &quot;jayChou&quot;
};

functionsay(age, sex) {
    console.log(`name: ${this.name},age: ${age}, sex: ${sex}`);
}

say.newCall(person, 18, &apos;ç”·&apos;);  // name: jayChou,age: 18, sex: ç”·
</code></pre><p>æˆåŠŸå•¦ï¼</p>
<p>å®ç°äº†å‡½æ•°å‚æ•°çš„ä¼ é€’ï¼Œé‚£ä¹ˆå‡½æ•°è¿”å›å€¼æ€ä¹ˆå¤„ç†å‘¢ã€‚è€Œä¸”ï¼Œå¦‚æœä¼ å…¥çš„å¯¹è±¡æ˜¯ nullï¼Œåˆè¯¥å¦‚ä½•å¤„ç†ï¼Ÿæ‰€ä»¥è¿˜éœ€è¦å†åšä¸€äº›å·¥ä½œï¼š</p>
<pre><code>Function.prototype.newCall = function (context) {
    if (typeof context === &apos;object&apos;) {
        context = context || window
    } else {
        context = Object.create(null);
    }

    context.fn = this;

    let args = [];

    for(var i=1; i&lt; arguments.length; i++) {
        args.push(&apos;arguments[&apos; + i + &apos;]&apos;);
    }

    // args =&gt; [arguments[1], arguments[2], arguments[3], ...]var result = eval(&apos;context.fn(&apos; + args + &apos;)&apos;);  // å¤„ç†è¿”å›å€¼delete context.fn;
    return result;  // è¿”å›è¿”å›å€¼
}

var person = {
    name: &quot;jayChou&quot;
};

functionsay(age, sex) {
    console.log(`name: ${this.name},age: ${age}, sex: ${sex}`);
    return age + sex;
}

var check = say.newCall(person, 18, &apos;ç”·&apos;);
console.log(check); // 18ç”·
</code></pre><p>åˆ¤æ–­ä¼ å…¥å¯¹è±¡çš„ç±»å‹ï¼Œå¦‚æœä¸º null å°±æŒ‡å‘ window å¯¹è±¡ã€‚åˆ©ç”¨ eval æ¥æ‰§è¡Œå­—ç¬¦ä¸²ä»£ç ï¼Œå¹¶è¿”å›å­—ç¬¦ä¸²ä»£ç æ‰§è¡Œçš„ç»“æœï¼Œå°±å®Œæˆäº†æ¨¡æ‹Ÿ callã€‚<br>å¤§åŠŸå‘Šæˆï¼</p>
<h4 id="ä¸‰ã€ES-6-å®ç°"><a href="#ä¸‰ã€ES-6-å®ç°" class="headerlink" title="ä¸‰ã€ES 6 å®ç°"></a>ä¸‰ã€ES 6 å®ç°</h4><p>å‰é¢æˆ‘ä»¬ç”¨çš„ eval æ–¹å¼å¯ä»¥ç”¨ ES6 çš„è§£å†³è¿˜å­˜åœ¨çš„ä¸€äº›é—®é¢˜ï¼Œæœ‰æ²¡æœ‰æ³¨æ„åˆ°ï¼Œè¿™æ®µä»£ç æ˜¯æœ‰é—®é¢˜çš„ã€‚</p>
<pre><code>context.fn = this;
</code></pre><p>å‡å¦‚å¯¹è±¡åœ¨è¢« call è°ƒç”¨å‰ï¼Œå·²ç»æœ‰ fn å±æ€§æ€ä¹ˆåŠï¼Ÿ</p>
<p>ES6 ä¸­æä¾›äº†ä¸€ç§æ–°çš„åŸºæœ¬æ•°æ®ç±»å‹ï¼ŒSymbolï¼Œè¡¨ç¤ºç‹¬ä¸€æ— äºŒçš„å€¼ï¼Œå¦å¤–ï¼ŒSymbol ä½œä¸ºå±æ€§çš„æ—¶å€™ï¼Œä¸èƒ½ä½¿ç”¨ç‚¹è¿ç®—ç¬¦ã€‚æ‰€ä»¥å†åŠ ä¸Š ES çš„ rest å‰©ä½™å‚æ•°æ›¿ä»£ arguments éå†çš„å·¥ä½œå°±æœ‰ï¼š</p>
<pre><code>Function.prototype.newCall = function (context,...params) {
    if (typeof context === &apos;object&apos;) {
        context = context || window
    } else {
        context = Object.create(null);
    }
    let fn = Symbol();
    context[fn] = thisvar result = context[fn](...params);

    delete context.fn;
    return result;
}

var person = {
    name: &quot;jayChou&quot;
};

functionsay(age, sex) {
    console.log(`name: ${this.name},age: ${age}, sex: ${sex}`);
    return age + sex;
}

var check = say.newCall(person, 18, &apos;ç”·&apos;);
console.log(check); // 18ç”·
</code></pre><h4 id="å››ã€apply"><a href="#å››ã€apply" class="headerlink" title="å››ã€apply"></a>å››ã€apply</h4><p>apply å’Œ call çš„å®ç°åŸç†ï¼ŒåŸºæœ¬ç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äº apply çš„å‚æ•°æ˜¯ä»¥æ•°ç»„çš„å½¢å¼ä¼ å…¥ã€‚</p>
<pre><code>Function.prototype.newApply = function (context, arr) {
    if (typeof context === &apos;object&apos;) {
        context = context || window
    } else {
        context = Object.create(null);
    }
    context.fn = this;

    var result;
    if (!arr) {  // åˆ¤æ–­å‡½æ•°å‚æ•°æ˜¯å¦ä¸ºç©º
        result = context.fn();
    }
    else {
        var args = [];
        for (var i = 0; i &lt; arr.length; i++) {
            args.push(&apos;arr[&apos; + i + &apos;]&apos;);
        }
        result = eval(&apos;context.fn(&apos; + args + &apos;)&apos;);
    }

    delete context.fn;
    return result;
}
</code></pre><p><strong>es6 å®ç°</strong></p>
<pre><code>Function.prototype.newApply = function(context, parameter) {
  if (typeof context === &apos;object&apos;) {
    context = context || window
  } else {
    context = Object.create(null)
  }
  let fn = Symbol()
  context[fn] = this;
  var result = context[fn](...parameter);
  delete context[fn];
  return result;
}
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/tx.jpg"
                alt="ææ–Œ" />
            
              <p class="site-author-name" itemprop="name">ææ–Œ</p>
              <p class="site-description motion-element" itemprop="description">æƒ³è¦é£å¾—é«˜ï¼Œé‚£å°±æŠŠåœ°å¹³çº¿å¿˜æ‰</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">107</span>
                  <span class="site-state-item-name">æ—¥å¿—</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">76</span>
                  <span class="site-state-item-name">æ ‡ç­¾</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/libin1991" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="3120217729@qq.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://juejin.im/user/57e737f6c4c971005f6bcd8d" target="_blank" title="juejin">
                      
                        <i class="fa fa-fw fa-spinner"></i>juejin</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ææ–Œ</span>

  
</div>


  <div class="powered-by">ç”± <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">ä¸»é¢˜ &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
<script type="text/javascript" src="/js/src/clicklove.js"></script>

