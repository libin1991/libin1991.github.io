<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="Blog">
<meta property="og:type" content="website">
<meta property="og:title" content="LuckDay">
<meta property="og:url" content="http://yoursite.com/page/3/index.html">
<meta property="og:site_name" content="LuckDay">
<meta property="og:description" content="Blog">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="LuckDay">
<meta name="twitter:description" content="Blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/3/"/>





  <title>LuckDay - æƒ³è¦é£å¾—é«˜ï¼Œé‚£å°±æŠŠåœ°å¹³çº¿å¿˜æ‰</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband">
    	<div class="eevee"><div class="body"><div class="head"><div class="ears"><div class="ear"><div class="lobe"></div></div><div class="ear"><div class="lobe"></div></div></div><div class="face"><div class="eyes"><div class="eye"><div class="eyelid"></div></div><div class="eye"><div class="eyelid"></div></div></div><div class="nose"></div><div class="mouth"></div></div></div><div class="chest"><div class="fur"><div class="patch"></div></div><div class="fur"><div class="patch"></div></div><div class="fur"><div class="patch"></div></div></div><div class="legs"><div class="leg"><div class="inner-leg"></div></div><div class="leg"><div class="inner-leg"></div></div><div class="leg"><div class="inner-leg"></div></div><div class="leg"><div class="inner-leg"></div></div></div><div class="tail"><div class="tail"><div class="tail"><div class="tail"><div class="tail"><div class="tail -end"></div></div></div></div></div></div></div></div>
    </div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
    	<div class="sky">
	<div class="clouds_one"></div>
	<div class="clouds_two"></div>
	<div class="clouds_three"></div>
</div>
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">LuckDay</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">æƒ³è¦é£å¾—é«˜ï¼Œé‚£å°±æŠŠåœ°å¹³çº¿å¿˜æ‰</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            æ ‡ç­¾
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            å…³äº
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            æœç´¢
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="æœç´¢..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/03/reduxä¸­é—´ä»¶/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/03/reduxä¸­é—´ä»¶/" itemprop="url">reduxä¸­é—´ä»¶</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-08-03T00:11:00+08:00">
                2018-08-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æåˆ°ä¸­é—´ä»¶ï¼Œä½ å¯èƒ½ä¼šæƒ³åˆ°<code>Express</code>å’Œ<code>Koa</code>ç­‰æœåŠ¡ç«¯æ¡†æ¶ï¼Œæ²¡æƒ³åˆ°ä¹Ÿæ²¡å…³ç³»ï¼Œè¿™å¥è¯æ˜¯æˆ‘è£…é€¼ç”¨çš„ã€‚</p>
<p>é‚£ä¹ˆreduxä¸­çš„ä¸­é—´ä»¶åˆ°åº•å¹²å˜›ç”¨çš„ï¼Ÿ</p>
<p>æœ‰è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼Ÿæˆ‘ä»¬ä¹‹å‰ç”¨çš„<code>Redux</code>éƒ½æ˜¯åœ¨<code>Action</code>å‘å‡ºä¹‹åç«‹å³æ‰§è¡Œ<code>Reducer</code>,è®¡ç®—å‡º<code>state</code>,è¿™æ˜¯åŒæ­¥æ“ä½œã€‚å¦‚æœæƒ³å¼‚æ­¥æ“ä½œå‘¢ï¼Ÿå³è¿‡ä¸€æ®µæ—¶é—´å†æ‰§è¡Œ<code>Reducer</code>æ€ä¹ˆåŠï¼Ÿè¿™é‡Œå°±éœ€è¦ç”¨åˆ°ä¸­é—´ä»¶<code>middleware</code>ã€‚</p>
<p>å…ˆæ”¾ä¸€å¼ å›¾çœ‹çœ‹ï¼š<br><img src="https://user-gold-cdn.xitu.io/2018/4/19/162dcb142c194bfb?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""></p>
<h2 id="ä¸€ã€ä¸­é—´ä»¶çš„æ¦‚å¿µ"><a href="#ä¸€ã€ä¸­é—´ä»¶çš„æ¦‚å¿µ" class="headerlink" title="ä¸€ã€ä¸­é—´ä»¶çš„æ¦‚å¿µ"></a>ä¸€ã€ä¸­é—´ä»¶çš„æ¦‚å¿µ</h2><p><code>redux</code>æ˜¯æœ‰æµç¨‹çš„ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬è¯¥æŠŠè¿™ä¸ªå¼‚æ­¥æ“ä½œæ”¾åœ¨å“ªä¸ªç¯èŠ‚æ¯”è¾ƒåˆé€‚å‘¢ï¼Ÿ</p>
<ul>
<li><code>Reducer</code>?çº¯å‡½æ•°åªæ‰¿æ‹…è®¡ç®—<code>State</code>åŠŸèƒ½ï¼Œä¸é€‚åˆå…¶å®ƒåŠŸèƒ½ã€‚</li>
<li><code>View</code>?ä¸<code>State</code>ä¸€ä¸€å¯¹åº”ï¼Œå¯ä»¥çœ‹åšæ˜¯<code>State</code>çš„è§†è§‰å±‚ï¼Œä¹Ÿä¸é€‚åˆæ‰¿æ‹…å…¶å®ƒåŠŸèƒ½ã€‚</li>
<li><code>Action</code>ï¼Ÿå®ƒæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå³å­˜å‚¨åŠ¨ä½œçš„è½½ä½“ï¼Œåªèƒ½è¢«æ“ä½œã€‚</li>
</ul>
<p>å…¶å®ï¼Œä¹Ÿåªæœ‰<code>dispatch</code>èƒ½èƒœä»»æ­¤é‡ä»»äº†ã€‚é‚£ä¹ˆæ€ä¹ˆåœ¨<code>dispatch</code>ä¸­æ·»åŠ å…¶å®ƒæ“ä½œå‘¢ï¼Ÿ</p>
<pre><code>let next = store.dispatch;
store.dispatch = function(action){
   console.log(&apos;è€çŠ¶æ€ &apos;,store.getState());
   next(action);
   console.log(&apos;æ–°çŠ¶æ€ &apos;,store.getState());
}
å¤åˆ¶ä»£ç 
</code></pre><p>ç¤ºä¾‹ä¸­å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬å¯¹<code>store.dispatch</code>é‡æ–°è¿›è¡Œäº†å®šä¹‰ï¼Œåœ¨å‘é€<code>action</code>çš„å‰åï¼Œåšäº†æ‰“å°ã€‚</p>
<p>è¿™æ˜¯ä¸­é—´ä»¶çš„å¤§è‡´é›å½¢ï¼ŒçœŸå®çš„ä¸­é—´ä»¶è¦æ¯”è¿™ä¹ˆå¤æ‚å¤šäº†</p>
<h2 id="äºŒã€ä¸­é—´ä»¶çš„ç”¨æ³•"><a href="#äºŒã€ä¸­é—´ä»¶çš„ç”¨æ³•" class="headerlink" title="äºŒã€ä¸­é—´ä»¶çš„ç”¨æ³•"></a>äºŒã€ä¸­é—´ä»¶çš„ç”¨æ³•</h2><p>æˆ‘ä»¬åœ¨è¿™é‡Œå…ˆçœ‹çœ‹ä¸­é—´ä»¶æ˜¯æ€ä¹ˆä½¿ç”¨ï¼Œä¸‹é¢æˆ‘ä»¬ä¸€æ­¥æ­¥å‰–ææ¯ä¸ªç»†èŠ‚ã€‚</p>
<pre><code>import {applyMiddleware,createStore} from &apos;redux&apos;;
import reduxLogger form &apos;redux-logger&apos;;

const store = createStore(reducer,inital_state,applyMiddleware(thunk, promise,reduxLogger));

å¤åˆ¶ä»£ç 
</code></pre><p>ä»£ç ä¸­æœ‰ä¸¤ç‚¹éœ€è¦æ³¨æ„ï¼š</p>
<ul>
<li><p>1ã€<code>createStore</code>æ–¹æ³•å¯ä»¥æ•´ä¸ªåº”ç”¨çš„åˆå§‹çŠ¶æ€ä½œä¸ºå‚æ•°<br>å†…éƒ¨æ˜¯è¿™ä¹ˆå¤„ç†çš„</p>
<p>  let state = inital_state;<br>  å¤åˆ¶ä»£ç </p>
</li>
<li><p>2ã€ä¸­é—´ä»¶çš„å‚æ•°æ¬¡åºæœ‰è®²ç©¶ã€‚ä¸‹é¢æˆ‘ä¼šæŠŠè¿™ä¸ªé—®é¢˜è®²æ˜ç™½ã€‚</p>
</li>
</ul>
<h2 id="ä¸‰ã€applyMiddleware"><a href="#ä¸‰ã€applyMiddleware" class="headerlink" title="ä¸‰ã€applyMiddleware"></a>ä¸‰ã€applyMiddleware</h2><p>Middlewareå¯ä»¥è®©ä½ åŒ…è£…<code>store</code>çš„<code>dispatch</code>æ–¹æ³•æ¥è¾¾åˆ°ä½ æƒ³è¦çš„ç›®çš„ã€‚åŒæ—¶ï¼Œ<code>middleWare</code>è¿˜æ‹¥æœ‰â€œå¯ç»„åˆâ€è¿™ä¸€å…³é”®ç‰¹æ€§ã€‚å¤šä¸ª<code>middleWare</code>å¯ä»¥è¢«ç»„åˆåˆ°ä¸€èµ·ä½¿ç”¨ï¼Œå½¢æˆ<code>middleWare</code>é“¾ï¼Œä¾æ¬¡æ‰§è¡Œã€‚å…¶ä¸­æ¯ä¸ª<code>middleware</code>ä¸éœ€è¦å…³å¿ƒé“¾å‰åçš„çš„<code>middleWare</code>çš„ä»»ä½•ä¿¡æ¯ã€‚</p>
<pre><code>function applyMiddleware(...middlewares){
    returnfunction(createStore){
        returnfunction(reducer){
            //å¼•å…¥store
            let store = createStore(reducer);
            let dispatch = store.dispatch;
            let middlewareAPI = {
                getState:store.getState,
                // å¯¹dispatchè¿›è¡ŒåŒ…è£…
                dispatch:action=&gt;dispatch(action)
            }
            //æ¯ä¸ªä¸­é—´ä»¶éƒ½æ˜¯è¿™ç§æ¨¡å‹  ({ getState, dispatch }) =&gt; next =&gt; action
            chain = middlewares.map(middleware=&gt;middleware(middleAPI));
            dispatch = compose(...chain)(store.dispatch);
            // dispatchè¢«æ”¹è£…åï¼Œè¿”å›store
            return{...store,dispatch};
        }
    }
}
å¤åˆ¶ä»£ç 
</code></pre><p>ä¸Šé¢ä»£ç ä¸­ï¼Œæ‰€æœ‰ä¸­é—´ä»¶éƒ½è¢«æ”¾è¿›äº†ä¸€ä¸ªæ•°ç»„<code>chain</code>,ç„¶ååµŒå¥—æ‰§è¡Œï¼Œæœ€åæ‰§è¡Œ<code>store.dispatch</code>ã€‚ä¸­é—´ä»¶å†…éƒ¨<code>middlewaAPI</code>å¯ä»¥æ‹¿åˆ°<code>getState</code>å’Œ<code>dispatch</code>è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚</p>
<p><code>...middleware</code>ï¼šéµå¾ª<code>Redux middleware API</code>çš„å‡½æ•°ã€‚æ¯ä¸ª<code>middleware</code>æ¥å—<code>Store</code>çš„<code>dispatch</code>å’Œ<code>getState</code>å‡½æ•°ä½œä¸ºå‘½åå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªå‡½æ•°ã€‚è¯¥å‡½æ•°ä¼šè¢«ä¼ å…¥æˆä¸º<code>next</code>çš„ä¸‹ä¸€ä¸ªmiddleWare çš„dispatchæ–¹æ³•ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ¥æ”¶actionçš„æ–°å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å¯ä»¥ç›´æ¥è°ƒç”¨next(action)ï¼Œæˆ–è€…åœ¨å…¶ä»–éœ€è¦çš„æ—¶åˆ»è°ƒç”¨ï¼Œç”šè‡³æ ¹æœ¬ä¸å»è°ƒç”¨å®ƒã€‚</p>
<p>æ‰€ä»¥ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±èƒ½çœ‹åˆ°middlewareçš„å‡½æ•°ç­¾åæ˜¯<code>({ getState, dispatch }) =&gt; next =&gt; action</code></p>
<p>å…¶å®ï¼Œå®ƒçš„æœ¬è´¨å°±æ˜¯åŒ…è£…sotreä¸­çš„<code>dispatch</code>ã€‚</p>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œè¿˜ç”¨åˆ°äº†<code>compose</code>æ–¹æ³•ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹composeæ˜¯æ€ä¹ˆæ˜¯å®ç°çš„ï¼Ÿ</p>
<h3 id="compose"><a href="#compose" class="headerlink" title="compose"></a>compose</h3><p>å…ˆçœ‹ä¸‹é¢ä¸€ä¸ªæ —å­ï¼š</p>
<pre><code>function add1(str){
   return str+1;
}
function add2(str){
    return str+2;
 }
 function add3(str){
    return str+3;
 }
 let result = add3(add2(add1(&apos;å¥½åƒ&apos;)));// å¥½åƒ123;

å¤åˆ¶ä»£ç 
</code></pre><p>è¿™ä¸­å†™æ³•è°ƒç”¨èµ·æ¥ï¼Œä¸€å±‚å¥—ä¸€å±‚ï¼Œæ˜¯ä¸æ˜¯çœ‹ç€å¾ˆä¸çˆ½ï¼Œæˆ‘ä»¬ç®€åŒ–ä¸€ä¸‹ï¼š</p>
<pre><code>function compose(...fns){
    if(fns.length==1)
     return fns[0];
   returnfunction(...args){
    let last = fns.pop();
    return fns.reduceRight((prev,next)=&gt;{
         return  next(prev);  
    },last(...args));
   }
 }
 let add = compose(add3,add2,add1);//
 let result = add(&apos;å¥½åƒ&apos;);// å¥½åƒ123
 // ä¸Šé¢çš„ä»£ç å…¶å®å°±æ˜¯redux3.6.0ç‰ˆæœ¬ä¸­composeçš„å®ç°æ–¹å¼
å¤åˆ¶ä»£ç 
</code></pre><p>çœ‹çœ‹è¿™ä¸ªä»£ç æ˜¯ä¸æ˜¯ç”¨èµ·æ¥ï¼Œå¾ˆå¹²ç»ƒä¸€äº›ã€‚å…¶å®è¿˜å¯ä»¥ç®€åŒ–</p>
<pre><code>function compose(...fns){
  if(fns.length==1)
     return fns[0];
   return fns.reduce((a,b)=&gt;(...args)=&gt;a(b(...args)));//add3(add2(add1(&apos;å¥½åƒ&apos;)))
 }
 let add = compose(add3,add2,add1);//
 let result = add(&apos;å¥½åƒ&apos;);// å¥½åƒ123
 // è¿™æ˜¯redux3.6.0ç‰ˆæœ¬ä¹‹åçš„composeå®ç°æ–¹å¼ï¼Œä¸€ç›´æ²¿ç”¨è‡³ä»Šã€‚
å¤åˆ¶ä»£ç 
</code></pre><p>è‡³äºä¸ºä»€ä¹ˆ<code>applyMiddleWare</code>çš„å‚æ•°æœ‰é¡ºåºï¼Œè¿™é‡Œç»™å‡ºäº†ç­”æ¡ˆã€‚</p>
<h2 id="å››ã€Applymiddlewareçš„ä¸‰ä¸ªå¸¸ç”¨å‚æ•°"><a href="#å››ã€Applymiddlewareçš„ä¸‰ä¸ªå¸¸ç”¨å‚æ•°" class="headerlink" title="å››ã€Applymiddlewareçš„ä¸‰ä¸ªå¸¸ç”¨å‚æ•°"></a>å››ã€Applymiddlewareçš„ä¸‰ä¸ªå¸¸ç”¨å‚æ•°</h2><h3 id="4-1ã€æ—¥å¿—è®°å½•"><a href="#4-1ã€æ—¥å¿—è®°å½•" class="headerlink" title="4.1ã€æ—¥å¿—è®°å½•"></a>4.1ã€æ—¥å¿—è®°å½•</h3><p>ä½¿ç”¨ Redux çš„ä¸€ä¸ªç›Šå¤„å°±æ˜¯å®ƒè®© state çš„å˜åŒ–è¿‡ç¨‹å˜çš„å¯é¢„çŸ¥å’Œé€æ˜ã€‚æ¯å½“ä¸€ä¸ª action å‘èµ·å®Œæˆåï¼Œæ–°çš„ state å°±ä¼šè¢«è®¡ç®—å¹¶ä¿å­˜ä¸‹æ¥ã€‚State ä¸èƒ½è¢«è‡ªèº«ä¿®æ”¹ï¼Œåªèƒ½ç”±ç‰¹å®šçš„ action å¼•èµ·å˜åŒ–ã€‚</p>
<p>è¯•æƒ³ä¸€ä¸‹ï¼Œå½“æˆ‘ä»¬çš„åº”ç”¨ä¸­æ¯ä¸€ä¸ª action è¢«å‘èµ·ä»¥åŠæ¯æ¬¡æ–°çš„ state è¢«è®¡ç®—å®Œæˆæ—¶éƒ½å°†å®ƒä»¬è®°å½•ä¸‹æ¥ï¼Œå²‚ä¸æ˜¯å¾ˆå¥½ï¼Ÿå½“ç¨‹åºå‡ºç°é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥é˜…æ—¥å¿—æ‰¾å‡ºæ˜¯å“ªä¸ª action å¯¼è‡´äº† state ä¸æ­£ç¡®ã€‚<br><img src="https://user-gold-cdn.xitu.io/2018/4/19/162dd052d2e07b77?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""><br>å›¾ç‰‡çš„æ•ˆæœæ˜¯ä¸æ˜¯å¾ˆæœŸå¾…å•Šï¼ï¼ï¼</p>
<p>æˆ‘ä»¬å…ˆæ¥æ‰‹åŠ¨å®ç°ä¸€ç‰ˆã€‚</p>
<pre><code>// è®°å½•æ‰€æœ‰è¢«å‘èµ·çš„actionå’Œæ–°çš„statelet next = store.dispatch;
store.dispatch = function(action){
   console.log(&apos;è€çŠ¶æ€ &apos;,store.getState());
   next(action);
   console.log(&apos;æ–°çŠ¶æ€ &apos;,store.getState());
}
å¤åˆ¶ä»£ç 
</code></pre><p>è¿˜æ˜¯ä¸Šé¢çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬æ¥åšä¸ªä¿®æ”¹</p>
<pre><code>let logger = function({ getState, dispatch }){
   returnfunction(next){// è¿™é‡Œçš„nextå¯ä»¥ç†è§£ä¸ºstore.dispath,æœ¬è´¨ä¸Šå°±æ˜¯è°ƒç”¨ middleware é“¾ä¸­ä¸‹ä¸€ä¸ª middleware çš„ dispatchã€‚returnfunction(action){
        console.log(&apos;è€çŠ¶æ€1 &apos;,getState());
        next(action);//æ´¾å‘åŠ¨ä½œconsole.log(&apos;æ–°çŠ¶æ€1 &apos;,getState());
    }
    }
}
// é«˜é€¼æ ¼å†™æ³•let logger = ({ getState, dispatch }) =&gt; next =&gt; action =&gt; {
  console.log(&apos;è€çŠ¶æ€1 &apos;,getState());
  next(action)
  console.log(&apos;æ–°çŠ¶æ€1 &apos;,getState());
}
å¤åˆ¶ä»£ç 
</code></pre><h3 id="4-2ã€redux-thunk-ä¸­é—´ä»¶"><a href="#4-2ã€redux-thunk-ä¸­é—´ä»¶" class="headerlink" title="4.2ã€redux-thunk ä¸­é—´ä»¶"></a>4.2ã€redux-thunk ä¸­é—´ä»¶</h3><p><code>redux-thunk</code> æ˜¯<code>redux</code>å®˜æ–¹æ–‡æ¡£ä¸­ç”¨åˆ°çš„å¼‚æ­¥ç»„ä»¶ï¼Œå®è´¨å°±æ˜¯ä¸€ä¸ª<code>redux</code>ä¸­é—´ä»¶ï¼Œä¸€ä¸ªå°è£…è¡¨è¾¾å¼çš„å‡½æ•°ï¼Œå°è£…çš„ç›®çš„å°±æ˜¯å»¶è¿Ÿæ‰§è¡Œè¡¨è¾¾å¼ã€‚</p>
<p><code>redux-thunk</code>æ˜¯ä¸€ä¸ªé€šç”¨çš„è§£å†³æ–¹æ¡ˆï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯è®©<code>action</code>å¯ä»¥å˜æˆä¸€ä¸ª<code>thunk</code>ï¼Œè¿™æ ·çš„è¯ï¼ŒåŒæ­¥æƒ…å†µï¼š<code>dispatch(action)</code>,å¼‚æ­¥æƒ…å†µï¼š<code>dispatch(thunk)</code>ã€‚</p>
<p>ä¸‹é¢æ˜¯<code>redux-thunk</code>çš„å®ç°ï¼š</p>
<pre><code>let thunk = ({dispatch,getState})=&gt;next=&gt;action=&gt;{
    if(typeof action == &apos;function&apos;){
        action(dispatch,getState);
    }else{
        next(action);//è¿™é‡Œå¯ä»¥ç†è§£ä¸ºdispatch(action),æœ¬è´¨ä¸Šå°±æ˜¯è°ƒç”¨ middleware é“¾ä¸­ä¸‹ä¸€ä¸ª middleware çš„ dispatchã€‚
    }
}
å¤åˆ¶ä»£ç 
</code></pre><p>ä½¿ç”¨redux-thunk</p>
<pre><code>const store = createStore(  
  reducer,
  applyMiddleware(thunk)
);
å¤åˆ¶ä»£ç 
</code></pre><p>ç„¶åæˆ‘ä»¬å®ç°ä¸€ä¸ªthunkActionCreator</p>
<pre><code>    //è¿‡ä¸€ç§’åŠ 1
    exportfunction thunkActionCreator(payload){
        returnfunction(dispatch,getState){
            setTimeout(function(){
                dispatch({type:types.INCREMENT,payload:payload});
            },1000);
        }
    },
å¤åˆ¶ä»£ç 
</code></pre><p>æœ€åï¼Œåœ¨ç»„ä»¶ä¸­dispatch thunk</p>
<pre><code>this.dispatch(thunkActionCreator(payload));
å¤åˆ¶ä»£ç 
</code></pre><h3 id="4-3ã€redux-promise"><a href="#4-3ã€redux-promise" class="headerlink" title="4.3ã€redux-promise"></a>4.3ã€redux-promise</h3><p><code>redux-promise</code>ä¹Ÿæ˜¯å»¶è¿Ÿæ‰§è¡Œçš„è¡¨è¾¾å¼ï¼Œå®ƒæ˜¯è§£å†³å¼‚æ­¥çš„å¦å¤–ä¸€ç§æ–¹æ¡ˆã€‚</p>
<p><code>redux-thunk</code>å’Œæ ¸å¿ƒæ€æƒ³æ˜¯æŠŠ<code>action</code>å˜æˆ<code>thunk</code>ï¼Œè€Œ<code>redux-promise</code>çš„æ ¸å¿ƒæ€æƒ³æ˜¯è®©<code>action</code>è¿”å›ä¸€ä¸ªpromiseå¯¹è±¡ã€‚</p>
<p>è¿™ä¸ªä¸­é—´ä»¶ä½¿å¾—<code>store.dispatch</code>æ–¹æ³•å¯ä»¥æ¥æ”¶Promiseå¯¹è±¡ä½œä¸ºå‚æ•°ã€‚è¿™æ—¶ ï¼Œaction æœ‰ä¸¤ç§å†™æ³•:</p>
<p>å†™æ³•ä¸€ã€è¿”å›å€¼æ˜¯ä¸€ä¸ªPromiseå¯¹è±¡ã€‚</p>
<pre><code>functionpromiseIncrement(payload){
 //  return {type:types.INCREMENT,payload:payload}  ä»¥å‰æ˜¯è¿™ç§å†™æ³•returnnewPromise(function(resolve,reject){
      setTimeout(function(){
        resolve({type:types.INCREMENT,payload:payload});
      },1000);
    });
 },
å¤åˆ¶ä»£ç 
</code></pre><p>å†™æ³•äºŒï¼Œaction å¯¹è±¡çš„payloadå±æ€§æ˜¯ä¸€ä¸ªPromiseå¯¹è±¡ï¼Œè¿™éœ€è¦ä»</p>
<pre><code>functionpayloadIncrement(){
    return {
        type:types.INCREMENT,
        payload: newPromise(function(resolve,reject){
            setTimeout(function(){
                if(Math.random()&gt;.5){
                    resolve(100);
                }else{
                    reject(-100);
                }
            },1000)
        })
    }
}
å¤åˆ¶ä»£ç 
</code></pre><p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹ <code>redux-promise</code>æ˜¯æ€ä¹ˆå®ç°çš„ï¼Œå°±ä¼šæ˜ç™½å®ƒå†…éƒ¨æ˜¯æ€ä¹ˆæ“ä½œçš„.</p>
<pre><code>let promise = ({dispatch,getState})=&gt;next=&gt;action=&gt;{
    if(action.then &amp;&amp; typeof action.then == &apos;function&apos;){
        action.then(dispatch);
        // è¿™é‡Œçš„dispatchå°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œdispatch(action){state:reducer(state,action)};
    }elseif(action.payload&amp;&amp; action.payload.then&amp;&amp; typeof action.payload.then == &apos;function&apos;){
        action.payload.then(payload=&gt;dispatch({...action,payload}),payload=&gt;dispatch({...action,payload}));
    }else{
        next(action);
    }
}
å¤åˆ¶ä»£ç 
</code></pre><p>ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœActionæœ¬èº«å°±æ˜¯ä¸€ä¸ªPromiseï¼Œå®ƒresolveä»¥åçš„å€¼åº”è¯¥æ˜¯ä¸€ä¸ªActionå¯¹è±¡ï¼Œä¼šè¢«dispatchæ–¹æ³•é€å‡ºaction.then(dispatch)ï¼›å¦‚æœ<code>Action</code>å¯¹è±¡çš„ <code>payload</code>å±æ€§æ˜¯ä¸€ä¸ª<code>Promise</code>å¯¹è±¡ï¼Œé‚£ä¹ˆæ— è®º<code>resolve</code>å’Œ<code>reject</code>,dispatch æ–¹æ³•éƒ½ä¼šå‘å‡º<code>Action</code>ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/30/å…³äº-ES6-ä¸­-Promise-çš„é¢è¯•é¢˜/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/30/å…³äº-ES6-ä¸­-Promise-çš„é¢è¯•é¢˜/" itemprop="url">å…³äº ES6 ä¸­ Promise çš„é¢è¯•é¢˜</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-07-30T20:16:20+08:00">
                2018-07-30
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h3><p>æœ€è¿‘åœ¨å¤ä¹  Promise çš„çŸ¥è¯†ï¼Œæ‰€ä»¥å°±åšäº†ä¸€äº›é¢˜ï¼Œè¿™é‡ŒæŒ‘å‡ºå‡ é“é¢˜ï¼Œå¤§å®¶ä¸€èµ·çœ‹çœ‹å§ã€‚</p>
<h3 id="é¢˜ç›®ä¸€"><a href="#é¢˜ç›®ä¸€" class="headerlink" title="é¢˜ç›®ä¸€"></a>é¢˜ç›®ä¸€</h3><pre><code>const promise = newPromise((resolve, reject) =&gt; {
    console.log(1);
    resolve();
    console.log(2);
})

promise.then(() =&gt; {
    console.log(3);
})

console.log(4);
</code></pre><h3 id="è§£æ"><a href="#è§£æ" class="headerlink" title="è§£æ"></a>è§£æ</h3><p>é¦–å…ˆ Promise æ–°å»ºåç«‹å³æ‰§è¡Œï¼Œæ‰€ä»¥ä¼šå…ˆè¾“å‡º 1ï¼Œ2ï¼Œè€Œ <code>Promise.then()</code> å†…éƒ¨çš„ä»£ç åœ¨ å½“æ¬¡ äº‹ä»¶å¾ªç¯çš„ ç»“å°¾ ç«‹åˆ»æ‰§è¡Œ ï¼Œæ‰€ä»¥ä¼šç»§ç»­è¾“å‡º4ï¼Œæœ€åè¾“å‡º3ã€‚</p>
<h3 id="ç­”æ¡ˆ"><a href="#ç­”æ¡ˆ" class="headerlink" title="ç­”æ¡ˆ"></a>ç­”æ¡ˆ</h3><pre><code>1243
</code></pre><h3 id="é¢˜ç›®äºŒ"><a href="#é¢˜ç›®äºŒ" class="headerlink" title="é¢˜ç›®äºŒ"></a>é¢˜ç›®äºŒ</h3><pre><code>const promise = newPromise((resolve, reject) =&gt; {
    resolve(&apos;success1&apos;);
    reject(&apos;error&apos;);
    resolve(&apos;success2&apos;);
});

promise.then((res) =&gt; {
    console.log(&apos;then:&apos;, res);
}).catch((err) =&gt; {
    console.log(&apos;catch:&apos;, err);
})
</code></pre><h3 id="è§£æ-1"><a href="#è§£æ-1" class="headerlink" title="è§£æ"></a>è§£æ</h3><p><code>resolve å‡½æ•°</code>å°† Promise å¯¹è±¡çš„çŠ¶æ€ä»<code>â€œæœªå®Œæˆâ€å˜ä¸ºâ€œæˆåŠŸâ€</code>ï¼ˆå³ä» <code>pending å˜ä¸º resolved</code>ï¼‰ï¼Œåœ¨å¼‚æ­¥æ“ä½œæˆåŠŸæ—¶è°ƒç”¨ï¼Œå¹¶å°†å¼‚æ­¥æ“ä½œçš„ç»“æœï¼Œä½œä¸ºå‚æ•°ä¼ é€’å‡ºå»ï¼›</p>
<p><code>reject å‡½æ•°</code>å°† Promise å¯¹è±¡çš„çŠ¶æ€ä»<code>â€œæœªå®Œæˆâ€å˜ä¸ºâ€œå¤±è´¥â€</code>ï¼ˆå³ä» <code>pending å˜ä¸º rejected</code>ï¼‰ï¼Œåœ¨å¼‚æ­¥æ“ä½œå¤±è´¥æ—¶è°ƒç”¨ï¼Œå¹¶å°†å¼‚æ­¥æ“ä½œæŠ¥å‡ºçš„é”™è¯¯ï¼Œä½œä¸ºå‚æ•°ä¼ é€’å‡ºå»ã€‚</p>
<p>è€Œä¸€æ—¦çŠ¶æ€æ”¹å˜ï¼Œå°±ä¸ä¼šå†å˜ã€‚<br>æ‰€ä»¥ ä»£ç ä¸­çš„<code>reject(&#39;error&#39;);</code> ä¸ä¼šæœ‰ä½œç”¨ã€‚</p>
<p>Promise åªèƒ½ resolve ä¸€æ¬¡ï¼Œå‰©ä¸‹çš„è°ƒç”¨éƒ½ä¼šè¢«å¿½ç•¥ã€‚<br>æ‰€ä»¥ ç¬¬äºŒæ¬¡çš„ <code>resolve(&#39;success2&#39;);</code> ä¹Ÿä¸ä¼šæœ‰ä½œç”¨ã€‚</p>
<h3 id="ç­”æ¡ˆ-1"><a href="#ç­”æ¡ˆ-1" class="headerlink" title="ç­”æ¡ˆ"></a>ç­”æ¡ˆ</h3><pre><code>then: success1
</code></pre><h3 id="é¢˜ç›®ä¸‰"><a href="#é¢˜ç›®ä¸‰" class="headerlink" title="é¢˜ç›®ä¸‰"></a>é¢˜ç›®ä¸‰</h3><pre><code>Promise.resolve(1)
  .then(2)
  .then(Promise.resolve(3))
  .then(console.log)
</code></pre><h3 id="è§£æ-2"><a href="#è§£æ-2" class="headerlink" title="è§£æ"></a>è§£æ</h3><p><code>Promise.resolve</code> æ–¹æ³•çš„å‚æ•°å¦‚æœæ˜¯ä¸€ä¸ªåŸå§‹å€¼ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªä¸å…·æœ‰ <code>then</code> æ–¹æ³•çš„å¯¹è±¡ï¼Œåˆ™ <code>Promise.resolve</code> æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°çš„ <code>Promise</code> å¯¹è±¡ï¼ŒçŠ¶æ€ä¸º<code>resolved</code>ï¼Œ<code>Promise.resolve</code> æ–¹æ³•çš„å‚æ•°ï¼Œä¼šåŒæ—¶ä¼ ç»™å›è°ƒå‡½æ•°ã€‚</p>
<p><code>then</code> æ–¹æ³•æ¥å—çš„å‚æ•°æ˜¯å‡½æ•°ï¼Œè€Œå¦‚æœä¼ é€’çš„å¹¶éæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒå®é™…ä¸Šä¼šå°†å…¶è§£é‡Šä¸º <code>then(null)</code>ï¼Œè¿™å°±ä¼šå¯¼è‡´å‰ä¸€ä¸ª <code>Promise</code> çš„ç»“æœä¼šç©¿é€ä¸‹é¢ã€‚</p>
<h3 id="ç­”æ¡ˆ-2"><a href="#ç­”æ¡ˆ-2" class="headerlink" title="ç­”æ¡ˆ"></a>ç­”æ¡ˆ</h3><pre><code>1
</code></pre><h3 id="é¢˜ç›®å››"><a href="#é¢˜ç›®å››" class="headerlink" title="é¢˜ç›®å››"></a>é¢˜ç›®å››</h3><p>çº¢ç¯ä¸‰ç§’äº®ä¸€æ¬¡ï¼Œç»¿ç¯ä¸€ç§’äº®ä¸€æ¬¡ï¼Œé»„ç¯2ç§’äº®ä¸€æ¬¡ï¼›å¦‚ä½•è®©ä¸‰ä¸ªç¯ä¸æ–­äº¤æ›¿é‡å¤äº®ç¯ï¼Ÿï¼ˆç”¨Promseå®ç°ï¼‰ä¸‰ä¸ªäº®ç¯å‡½æ•°å·²ç»å­˜åœ¨ï¼š</p>
<pre><code>functionred() {
    console.log(&apos;red&apos;);
}
functiongreen() {
    console.log(&apos;green&apos;);
}
functionyellow() {
    console.log(&apos;yellow&apos;);
}
</code></pre><h3 id="è§£æ-3"><a href="#è§£æ-3" class="headerlink" title="è§£æ"></a>è§£æ</h3><p>çº¢ç¯ä¸‰ç§’äº®ä¸€æ¬¡ï¼Œç»¿ç¯ä¸€ç§’äº®ä¸€æ¬¡ï¼Œé»„ç¯2ç§’äº®ä¸€æ¬¡ï¼Œæ„æ€å°±æ˜¯3ç§’ï¼Œæ‰§è¡Œä¸€æ¬¡ red å‡½æ•°ï¼Œ2ç§’æ‰§è¡Œä¸€æ¬¡ green å‡½æ•°ï¼Œ1ç§’æ‰§è¡Œä¸€æ¬¡ yellow å‡½æ•°ï¼Œä¸æ–­äº¤æ›¿é‡å¤äº®ç¯ï¼Œæ„æ€å°±æ˜¯æŒ‰ç…§è¿™ä¸ªé¡ºåºä¸€ç›´æ‰§è¡Œè¿™3ä¸ªå‡½æ•°ï¼Œè¿™æ­¥å¯ä»¥å°±åˆ©ç”¨é€’å½’æ¥å®ç°ã€‚</p>
<h3 id="ç­”æ¡ˆ-3"><a href="#ç­”æ¡ˆ-3" class="headerlink" title="ç­”æ¡ˆ"></a>ç­”æ¡ˆ</h3><pre><code>functionred() {
    console.log(&apos;red&apos;);
}
functiongreen() {
    console.log(&apos;green&apos;);
}
functionyellow() {
    console.log(&apos;yellow&apos;);
}

var light = function (timmer, cb) {
    returnnewPromise(function (resolve, reject) {
        setTimeout(function () {
            cb();
            resolve();
        }, timmer);
    });
};

var step = function () {
    Promise.resolve().then(function () {
        return light(3000, red);
    }).then(function () {
        return light(2000, green);
    }).then(function () {
        return light(1000, yellow);
    }).then(function () {
        step();
    });
}

step();
</code></pre><p>è¿™ä¸ªç­”æ¡ˆï¼Œçœ‹ä¸Šå»å·²ç»å¾ˆä¸é”™äº†ï¼Œä¸è¿‡ç»å°ä¼™ä¼´æé†’ï¼Œå¦‚æœä¸€ç›´è¿™ä¹ˆé€’å½’ä¸‹å»ï¼Œä¼šæœ‰æ ˆæº¢å‡ºçš„é—®é¢˜ï¼Œå¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œå…¶ä»–å°ä¼™ä¼´æœ‰ä»€ä¹ˆä¼˜åŒ–å»ºè®®çš„è¯ï¼Œå¯ä»¥åœ¨è¯„è®ºåŒºå±•ç¤ºå‡ºæ¥ã€‚</p>
<h3 id="é¢˜ç›®äº”"><a href="#é¢˜ç›®äº”" class="headerlink" title="é¢˜ç›®äº”"></a>é¢˜ç›®äº”</h3><p>å®ç° mergePromise å‡½æ•°ï¼ŒæŠŠä¼ è¿›å»çš„æ•°ç»„æŒ‰é¡ºåºå…ˆåæ‰§è¡Œï¼Œå¹¶ä¸”æŠŠè¿”å›çš„æ•°æ®å…ˆåæ”¾åˆ°æ•°ç»„ data ä¸­ã€‚</p>
<pre><code>const timeout = ms =&gt;newPromise((resolve, reject) =&gt; {
    setTimeout(() =&gt; {
        resolve();
    }, ms);
});

const ajax1 = () =&gt; timeout(2000).then(() =&gt; {
    console.log(&apos;1&apos;);
    return1;
});

const ajax2 = () =&gt; timeout(1000).then(() =&gt; {
    console.log(&apos;2&apos;);
    return2;
});

const ajax3 = () =&gt; timeout(2000).then(() =&gt; {
    console.log(&apos;3&apos;);
    return3;
});

const mergePromise = ajaxArray =&gt; {
    // åœ¨è¿™é‡Œå®ç°ä½ çš„ä»£ç 

};

mergePromise([ajax1, ajax2, ajax3]).then(data =&gt; {
    console.log(&apos;done&apos;);
    console.log(data); // data ä¸º [1, 2, 3]
});

// è¦æ±‚åˆ†åˆ«è¾“å‡º// 1// 2// 3// done// [1, 2, 3]
</code></pre><h3 id="è§£æ-4"><a href="#è§£æ-4" class="headerlink" title="è§£æ"></a>è§£æ</h3><p>é¦–å…ˆ <code>ajax1 ã€ajax2ã€ajax3</code> éƒ½æ˜¯å‡½æ•°ï¼Œåªæ˜¯è¿™äº›å‡½æ•°æ‰§è¡Œåä¼šè¿”å›ä¸€ä¸ª <code>Promise</code>ï¼ŒæŒ‰é¢˜ç›®çš„è¦æ±‚æˆ‘ä»¬åªè¦é¡ºåºæ‰§è¡Œè¿™ä¸‰ä¸ªå‡½æ•°å°±å¥½äº†ï¼Œç„¶åæŠŠç»“æœæ”¾åˆ° <code>data</code> ä¸­ï¼Œä½†æ˜¯è¿™äº›å‡½æ•°é‡Œéƒ½æ˜¯å¼‚æ­¥æ“ä½œï¼Œæƒ³è¦æŒ‰é¡ºåºæ‰§è¡Œï¼Œç„¶åè¾“å‡º 1ï¼Œ2ï¼Œ3å¹¶æ²¡æœ‰é‚£ä¹ˆç®€å•ï¼Œçœ‹ä¸ªä¾‹å­ã€‚</p>
<pre><code>functionA() {
    setTimeout(function () {
        console.log(&apos;a&apos;);
    }, 3000);
}

functionB() {
    setTimeout(function () {
        console.log(&apos;b&apos;);
    }, 1000);
}

A();
B();

// b// a
</code></pre><p>ä¾‹å­ä¸­æˆ‘ä»¬æ˜¯æŒ‰é¡ºåºæ‰§è¡Œçš„ <code>A</code>ï¼Œ<code>B</code> ä½†æ˜¯è¾“å‡ºçš„ç»“æœå´æ˜¯ <code>b</code>ï¼Œ<code>a</code> å¯¹äºè¿™äº›å¼‚æ­¥å‡½æ•°æ¥è¯´ï¼Œå¹¶ä¸ä¼šæŒ‰é¡ºåºæ‰§è¡Œå®Œä¸€ä¸ªï¼Œå†æ‰§è¡Œåä¸€ä¸ªã€‚<br>è¿™é“é¢˜å°±æ˜¯è€ƒç”¨ <code>Promise</code> æ§åˆ¶å¼‚æ­¥æµç¨‹ï¼Œæˆ‘ä»¬è¦æƒ³åŠæ³•ï¼Œè®©è¿™äº›å‡½æ•°ï¼Œä¸€ä¸ªæ‰§è¡Œå®Œä¹‹åï¼Œå†æ‰§è¡Œä¸‹ä¸€ä¸ªï¼Œçœ‹ç­”æ¡ˆå§ã€‚</p>
<h3 id="ç­”æ¡ˆ-4"><a href="#ç­”æ¡ˆ-4" class="headerlink" title="ç­”æ¡ˆ"></a>ç­”æ¡ˆ</h3><pre><code>// ä¿å­˜æ•°ç»„ä¸­çš„å‡½æ•°æ‰§è¡Œåçš„ç»“æœvar data = [];

// Promise.resolveæ–¹æ³•è°ƒç”¨æ—¶ä¸å¸¦å‚æ•°ï¼Œç›´æ¥è¿”å›ä¸€ä¸ªresolvedçŠ¶æ€çš„ Promise å¯¹è±¡ã€‚var sequence = Promise.resolve();

ajaxArray.forEach(function (item) {
    // ç¬¬ä¸€æ¬¡çš„ then æ–¹æ³•ç”¨æ¥æ‰§è¡Œæ•°ç»„ä¸­çš„æ¯ä¸ªå‡½æ•°ï¼Œ// ç¬¬äºŒæ¬¡çš„ then æ–¹æ³•æ¥å—æ•°ç»„ä¸­çš„å‡½æ•°æ‰§è¡Œåè¿”å›çš„ç»“æœï¼Œ// å¹¶æŠŠç»“æœæ·»åŠ åˆ° data ä¸­ï¼Œç„¶åæŠŠ data è¿”å›ã€‚
    sequence = sequence.then(item).then(function (res) {
        data.push(res);
        return data;
    });
})

// éå†ç»“æŸåï¼Œè¿”å›ä¸€ä¸ª Promiseï¼Œä¹Ÿå°±æ˜¯ sequenceï¼Œ ä»–çš„ [[PromiseValue]] å€¼å°±æ˜¯ dataï¼Œ// è€Œ dataï¼ˆä¿å­˜æ•°ç»„ä¸­çš„å‡½æ•°æ‰§è¡Œåçš„ç»“æœï¼‰ ä¹Ÿä¼šä½œä¸ºå‚æ•°ï¼Œä¼ å…¥ä¸‹æ¬¡è°ƒç”¨çš„ then æ–¹æ³•ä¸­ã€‚return sequence;
</code></pre><h3 id="é¢˜ç›®å…­"><a href="#é¢˜ç›®å…­" class="headerlink" title="é¢˜ç›®å…­"></a>é¢˜ç›®å…­</h3><p>ä»¥ä¸‹ä»£ç æœ€åè¾“å‡ºä»€ä¹ˆï¼Ÿ</p>
<pre><code>const first = () =&gt; (newPromise((resolve, reject) =&gt; {
    console.log(3);
    let p = newPromise((resolve, reject) =&gt; {
        console.log(7);
        setTimeout(() =&gt; {
            console.log(5);
            resolve(6);
        }, 0)
        resolve(1);
    });
    resolve(2);
    p.then((arg) =&gt; {
        console.log(arg);
    });

}));

first().then((arg) =&gt; {
    console.log(arg);
});
console.log(4);
</code></pre><h3 id="è§£æ-5"><a href="#è§£æ-5" class="headerlink" title="è§£æ"></a>è§£æ</h3><p>è¿™é“é¢˜å°±å…¶å®å’Œ <code>Promise</code> çš„å…³ç³»ä¸å¤ªå¤§ï¼Œä¸»è¦æ˜¯éœ€è¦ç†è§£ JSæ‰§è¡Œæœºåˆ¶ï¼Œæ‰èƒ½å¾ˆå¥½çš„è§£å†³è¿™é“é¢˜ï¼Œå¯¹äº JS æ‰§è¡Œæœºåˆ¶ä¸äº†è§£çš„æœ‹å‹æ¨èçœ‹çœ‹è¿™ç¯‡æ–‡ç« </p>
<p><a href="https://link.juejin.im?target=https%3A%2F%2Fjuejin.im%2Fpost%2F59e85eebf265da430d571f89" target="_blank" rel="noopener">è¿™ä¸€æ¬¡ï¼Œå½»åº•å¼„æ‡‚ JavaScript æ‰§è¡Œæœºåˆ¶</a></p>
<h4 id="ç¬¬ä¸€è½®äº‹ä»¶å¾ªç¯"><a href="#ç¬¬ä¸€è½®äº‹ä»¶å¾ªç¯" class="headerlink" title="ç¬¬ä¸€è½®äº‹ä»¶å¾ªç¯"></a>ç¬¬ä¸€è½®äº‹ä»¶å¾ªç¯</h4><p>å…ˆæ‰§è¡Œå®ä»»åŠ¡ï¼Œä¸»script ï¼Œnew Promiseç«‹å³æ‰§è¡Œï¼Œè¾“å‡ºã€3ã€‘ï¼Œ</p>
<p>æ‰§è¡Œ p è¿™ä¸ªnew Promise æ“ä½œï¼Œè¾“å‡ºã€7ã€‘ï¼Œ</p>
<p>å‘ç° setTimeoutï¼Œå°†å›è°ƒæ”¾å…¥ä¸‹ä¸€è½®ä»»åŠ¡é˜Ÿåˆ—ï¼ˆEvent Queueï¼‰ï¼Œp çš„ thenï¼Œå§‘ä¸”å«åš then1ï¼Œæ”¾å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œå‘ç° first çš„ thenï¼Œå« then2ï¼Œæ”¾å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚æ‰§è¡Œ<code>console.log(4)</code>ï¼Œè¾“å‡ºã€4ã€‘ï¼Œå®ä»»åŠ¡æ‰§è¡Œç»“æŸã€‚</p>
<p>å†æ‰§è¡Œå¾®ä»»åŠ¡ï¼Œæ‰§è¡Œ then1ï¼Œè¾“å‡ºã€1ã€‘ï¼Œ</p>
<p>æ‰§è¡Œ then2ï¼Œè¾“å‡ºã€2ã€‘ã€‚</p>
<p>åˆ°æ­¤ä¸ºæ­¢ï¼Œç¬¬ä¸€è½®äº‹ä»¶å¾ªç¯ç»“æŸã€‚å¼€å§‹æ‰§è¡Œç¬¬äºŒè½®ã€‚</p>
<h4 id="ç¬¬äºŒè½®äº‹ä»¶å¾ªç¯"><a href="#ç¬¬äºŒè½®äº‹ä»¶å¾ªç¯" class="headerlink" title="ç¬¬äºŒè½®äº‹ä»¶å¾ªç¯"></a>ç¬¬äºŒè½®äº‹ä»¶å¾ªç¯</h4><p>å…ˆæ‰§è¡Œå®ä»»åŠ¡é‡Œé¢çš„ï¼Œä¹Ÿå°±æ˜¯ setTimeout çš„å›è°ƒï¼Œè¾“å‡ºã€5ã€‘ã€‚<br><code>resolve(6)</code> ä¸ä¼šç”Ÿæ•ˆï¼Œå› ä¸º p è¿™ä¸ª Promise çš„çŠ¶æ€ä¸€æ—¦æ”¹å˜å°±ä¸ä¼šåœ¨æ”¹å˜äº†ã€‚</p>
<h3 id="ç­”æ¡ˆ-5"><a href="#ç­”æ¡ˆ-5" class="headerlink" title="ç­”æ¡ˆ"></a>ç­”æ¡ˆ</h3><pre><code>374125
</code></pre><h3 id="é¢˜ç›®ä¸ƒ"><a href="#é¢˜ç›®ä¸ƒ" class="headerlink" title="é¢˜ç›®ä¸ƒ"></a>é¢˜ç›®ä¸ƒ</h3><p>æœ‰ 8 ä¸ªå›¾ç‰‡èµ„æºçš„ urlï¼Œå·²ç»å­˜å‚¨åœ¨æ•°ç»„ <code>urls</code> ä¸­ï¼ˆå³<code>urls = [&#39;http://example.com/1.jpg&#39;, ...., &#39;http://example.com/8.jpg&#39;]ï¼‰</code>ï¼Œè€Œä¸”å·²ç»æœ‰ä¸€ä¸ªå‡½æ•° <code>function loadImg</code>ï¼Œè¾“å…¥ä¸€ä¸ª url é“¾æ¥ï¼Œè¿”å›ä¸€ä¸ª Promiseï¼Œè¯¥ Promise åœ¨å›¾ç‰‡ä¸‹è½½å®Œæˆçš„æ—¶å€™ resolveï¼Œä¸‹è½½å¤±è´¥åˆ™ rejectã€‚<br>ä½†æ˜¯æˆ‘ä»¬è¦æ±‚ï¼Œä»»æ„æ—¶åˆ»ï¼ŒåŒæ—¶ä¸‹è½½çš„é“¾æ¥æ•°é‡ä¸å¯ä»¥è¶…è¿‡ 3 ä¸ªã€‚<br>è¯·å†™ä¸€æ®µä»£ç å®ç°è¿™ä¸ªéœ€æ±‚ï¼Œè¦æ±‚å°½å¯èƒ½å¿«é€Ÿåœ°å°†æ‰€æœ‰å›¾ç‰‡ä¸‹è½½å®Œæˆã€‚</p>
<pre><code>var urls = [&apos;https://www.kkkk1000.com/images/getImgData/getImgDatadata.jpg&apos;, &apos;https://www.kkkk1000.com/images/getImgData/gray.gif&apos;, &apos;https://www.kkkk1000.com/images/getImgData/Particle.gif&apos;, &apos;https://www.kkkk1000.com/images/getImgData/arithmetic.png&apos;, &apos;https://www.kkkk1000.com/images/getImgData/arithmetic2.gif&apos;, &apos;https://www.kkkk1000.com/images/getImgData/getImgDataError.jpg&apos;, &apos;https://www.kkkk1000.com/images/getImgData/arithmetic.gif&apos;, &apos;https://user-gold-cdn.xitu.io/2018/10/29/166be40ccc434be0?w=600&amp;h=342&amp;f=png&amp;s=122185&apos;];
functionloadImg(url) {
    returnnewPromise((resolve, reject) =&gt; {
        const img = new Image()
        img.onload = function () {
            console.log(&apos;ä¸€å¼ å›¾ç‰‡åŠ è½½å®Œæˆ&apos;);
            resolve();
        }
        img.onerror = reject
        img.src = url
    })
};
</code></pre><h3 id="è§£æ-6"><a href="#è§£æ-6" class="headerlink" title="è§£æ"></a>è§£æ</h3><p>é¢˜ç›®çš„æ„æ€æ˜¯éœ€è¦æˆ‘ä»¬è¿™ä¹ˆåšï¼Œå…ˆå¹¶å‘è¯·æ±‚ 3 å¼ å›¾ç‰‡ï¼Œå½“ä¸€å¼ å›¾ç‰‡åŠ è½½å®Œæˆåï¼Œåˆä¼šç»§ç»­å‘èµ·ä¸€å¼ å›¾ç‰‡çš„è¯·æ±‚ï¼Œè®©å¹¶å‘æ•°ä¿æŒåœ¨ 3 ä¸ªï¼Œç›´åˆ°éœ€è¦åŠ è½½çš„å›¾ç‰‡éƒ½å…¨éƒ¨å‘èµ·è¯·æ±‚ã€‚</p>
<p>ç”¨ Promise æ¥å®ç°å°±æ˜¯ï¼Œå…ˆå¹¶å‘è¯·æ±‚3ä¸ªå›¾ç‰‡èµ„æºï¼Œè¿™æ ·å¯ä»¥å¾—åˆ° 3 ä¸ª Promiseï¼Œç»„æˆä¸€ä¸ªæ•°ç»„ï¼Œå°±å«<code>promises</code> å§ï¼Œç„¶åä¸æ–­çš„è°ƒç”¨ <a href="https://link.juejin.im?target=http%3A%2F%2Fes6.ruanyifeng.com%2F%23docs%2Fpromise%23Promise-race" target="_blank" rel="noopener">Promise.race</a> æ¥è¿”å›æœ€å¿«æ”¹å˜çŠ¶æ€çš„ Promiseï¼Œç„¶åä»æ•°ç»„ï¼ˆ<code>promises</code>ï¼‰ä¸­åˆ æ‰è¿™ä¸ª Promise å¯¹è±¡ï¼Œå†åŠ å…¥ä¸€ä¸ªæ–°çš„ Promiseï¼Œç›´åˆ°å…¨éƒ¨çš„ url è¢«å–å®Œï¼Œæœ€åå†ä½¿ç”¨ <a href="https://link.juejin.im?target=http%3A%2F%2Fes6.ruanyifeng.com%2F%23docs%2Fpromise%23Promise-all" target="_blank" rel="noopener">Promise.all</a> æ¥å¤„ç†ä¸€éæ•°ç»„ï¼ˆ<code>promises</code>ï¼‰ä¸­æ²¡æœ‰æ”¹å˜çŠ¶æ€çš„ Promiseã€‚</p>
<h3 id="ç­”æ¡ˆ-6"><a href="#ç­”æ¡ˆ-6" class="headerlink" title="ç­”æ¡ˆ"></a>ç­”æ¡ˆ</h3><pre><code>var urls = [&apos;https://www.kkkk1000.com/images/getImgData/getImgDatadata.jpg&apos;, &apos;https://www.kkkk1000.com/images/getImgData/gray.gif&apos;, &apos;https://www.kkkk1000.com/images/getImgData/Particle.gif&apos;, &apos;https://www.kkkk1000.com/images/getImgData/arithmetic.png&apos;, &apos;https://www.kkkk1000.com/images/getImgData/arithmetic2.gif&apos;, &apos;https://www.kkkk1000.com/images/getImgData/getImgDataError.jpg&apos;, &apos;https://www.kkkk1000.com/images/getImgData/arithmetic.gif&apos;, &apos;https://user-gold-cdn.xitu.io/2018/10/29/166be40ccc434be0?w=600&amp;h=342&amp;f=png&amp;s=122185&apos;];
functionloadImg(url) {
    returnnewPromise((resolve, reject) =&gt; {
        const img = new Image()
        img.onload = function () {
            console.log(&apos;ä¸€å¼ å›¾ç‰‡åŠ è½½å®Œæˆ&apos;);
            resolve();
        }
        img.onerror = reject
        img.src = url
    })
};

functionlimitLoad(urls, handler, limit) {
    // å¯¹æ•°ç»„åšä¸€ä¸ªæ‹·è´const sequence = [].concat(urls)
    let promises = [];

    //å¹¶å‘è¯·æ±‚åˆ°æœ€å¤§æ•°
    promises = sequence.splice(0, limit).map((url, index) =&gt; {
        // è¿™é‡Œè¿”å›çš„ index æ˜¯ä»»åŠ¡åœ¨ promises çš„è„šæ ‡ï¼Œç”¨äºåœ¨ Promise.race ä¹‹åæ‰¾åˆ°å®Œæˆçš„ä»»åŠ¡è„šæ ‡return handler(url).then(() =&gt; {
            return index
        }); 
    });

    // åˆ©ç”¨æ•°ç»„çš„ reduce æ–¹æ³•æ¥ä»¥é˜Ÿåˆ—çš„å½¢å¼æ‰§è¡Œreturn sequence.reduce((last, url, currentIndex) =&gt; {
        return last.then(() =&gt; {
            // è¿”å›æœ€å¿«æ”¹å˜çŠ¶æ€çš„ PromisereturnPromise.race(promises)
        }).catch(err =&gt; {
            // è¿™é‡Œçš„ catch ä¸ä»…ç”¨æ¥æ•è· å‰é¢ then æ–¹æ³•æŠ›å‡ºçš„é”™è¯¯// æ›´é‡è¦çš„æ˜¯é˜²æ­¢ä¸­æ–­æ•´ä¸ªé“¾å¼è°ƒç”¨console.error(err)
        }).then((res) =&gt; {
            // ç”¨æ–°çš„ Promise æ›¿æ¢æ‰æœ€å¿«æ”¹å˜çŠ¶æ€çš„ Promise
            promises[res] = handler(sequence[currentIndex]).then(() =&gt; { return res });
        })
    }, Promise.resolve()).then(() =&gt; {
        returnPromise.all(promises)
    })

}
limitLoad(urls, loadImg, 3)

/*
å› ä¸º limitLoad å‡½æ•°ä¹Ÿè¿”å›ä¸€ä¸ª Promiseï¼Œæ‰€ä»¥å½“ æ‰€æœ‰å›¾ç‰‡åŠ è½½å®Œæˆåï¼Œå¯ä»¥ç»§ç»­é“¾å¼è°ƒç”¨

limitLoad(urls, loadImg, 3).then(() =&gt; {
    console.log(&apos;æ‰€æœ‰å›¾ç‰‡åŠ è½½å®Œæˆ&apos;);
}).catch(err =&gt; {
    console.error(err);
})
*/
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/15/nodejså‡ ç§æ–‡ä»¶è·¯å¾„åŠpathæ¨¡å—/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/15/nodejså‡ ç§æ–‡ä»¶è·¯å¾„åŠpathæ¨¡å—/" itemprop="url">Node.jså‡ ç§æ–‡ä»¶è·¯å¾„åŠpathæ¨¡å—</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-07-15T22:24:49+08:00">
                2018-07-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ€è¿‘åœ¨å†™ä¸€ç¯‡weexçš„webpacké…ç½®ï¼Œåˆšåˆšè¸©å‘äº†ï¼Œweekpackä¸­ä¼šç”¨åˆ°pathæ¨¡å—ï¼Œè€Œå¯¹äºè¿™ä¸ªæ¨¡å—ï¼Œæˆ‘æƒ³æŠ½ç¦»å‡ºæ¥çœ‹ä¸€ä¸‹ï¼Œå› ä¸ºè¿™ä¸ªç”¨åˆ°çš„è¿˜æ˜¯æ¯”è¾ƒå¤šçš„,å–œæ¬¢çš„æœ‹å‹å¯ä»¥ç‚¹ä¸ªå–œæ¬¢ï¼Œæˆ–è€…å»æˆ‘çš„<a href="https://link.zhihu.com/?target=https%3A//link.juejin.im/%3Ftarget%3Dhttps%253A%252F%252Fgithub.com%252Flaihuamin%252FJS-total" target="_blank" rel="noopener">github</a>ç‚¹ä¸ªstarä¹Ÿè¡Œï¼Œè°¢è°¢æ”¯æŒï¼Œä¸¾èµ·å°æ‰‹æŒ‡ç‚¹ä¸€ç‚¹å“¦ğŸ˜¯ï¼Œå†™çš„ä¸å¯¹çš„åœ°æ–¹ï¼Œè¯„è®ºæ‹ç –ï¼Œè°¢è°¢ã€‚</p>
<h2 id="nodeä¸­çš„è·¯å¾„åˆ†ç±»"><a href="#nodeä¸­çš„è·¯å¾„åˆ†ç±»" class="headerlink" title="nodeä¸­çš„è·¯å¾„åˆ†ç±»"></a>nodeä¸­çš„è·¯å¾„åˆ†ç±»</h2><p>nodeä¸­çš„è·¯å¾„å¤§è‡´åˆ†5ç±»ï¼Œdirname,filename,process.cwd(),./,../,å…¶ä¸­å‰ä¸‰ä¸ªéƒ½æ˜¯ç»å¯¹è·¯å¾„</p>
<p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªç®€å•ç‚¹çš„ä¾‹å­</p>
<p>å‡å¦‚ï¼Œæˆ‘æœ‰ä¸€ä¸ªæ–‡ä»¶çš„ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre><code>editor/
  - dist/
  - src/
      - task.js
</code></pre><p>ç„¶åæˆ‘ä»¬åœ¨task.jsæ–‡ä»¶ä¸­å†™å…¥ä¸€ä¸‹ä»£ç </p>
<pre><code>const path = require(&apos;path&apos;);
console.log(__dirname);
console.log(__filename);
console.log(process.cwd());
console.log(path.resolve(&apos;./&apos;));
</code></pre><p>åœ¨editorç›®å½•ä¸‹è¿è¡Œnode src/task.jsï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code>/Users/laihuamin/Documents/richEditor/editor/src
/Users/laihuamin/Documents/richEditor/editor/src/task.js
/Users/laihuamin/Documents/richEditor/editor
/Users/laihuamin/Documents/richEditor/editor
</code></pre><p>ç„¶åæˆ‘ä»¬æœ‰å¯ä»¥åœ¨srcç›®å½•ä¸‹è¿è¡Œè¿™ä¸ªæ–‡ä»¶ï¼Œnode task.js,è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code>/Users/laihuamin/Documents/richEditor/editor/src
/Users/laihuamin/Documents/richEditor/editor/src/task.js
/Users/laihuamin/Documents/richEditor/editor/src
/Users/laihuamin/Documents/richEditor/editor/src
</code></pre><p>å¯¹æ¯”ä¸¤ä¸ªè¾“å‡ºç»“æœï¼Œæˆ‘ä»¬å¯ä»¥å½’çº³ä¸€ä¸‹å‡ ç‚¹ï¼š</p>
<p>1.<strong>dirname:è¿”å›çš„æ˜¯è¿™ä¸ªæ–‡ä»¶æ‰€åœ¨æ–‡ä»¶å¤¹çš„ä½ç½®<br>2.</strong>filename:ä½ è¿è¡Œå‘½ä»¤ä»£è¡¨çš„æ˜¯æ–‡ä»¶æ‰€åœ¨çš„ä½ç½®ï¼Œä¸ç®¡ä½ è¿è¡Œä»€ä¹ˆå‘½ä»¤ï¼Œéƒ½æ˜¯æŒ‡å‘æ–‡ä»¶<br>3.process.cwd():ä½ è¿è¡Œnodeå‘½ä»¤æ‰€åœ¨æ–‡ä»¶å¤¹çš„ä½ç½®ï¼Œæ¯”å¦‚ä½ åœ¨srcç›®å½•ä¸‹è¿è¡Œï¼Œé‚£ä¹ˆå°±æ˜¯è¾“å‡ºåˆ°srcä¸ºæ­¢ï¼Œä¸‹é¢çš„åŒç†ã€‚</p>
<h2 id="path"><a href="#path" class="headerlink" title="path"></a>path</h2><p>è®²å®Œå‰é¢ä¸‰ä¸ªç»å¯¹è·¯å¾„ï¼Œæˆ‘å€’æ˜¯æŒºæƒ³æ¥èŠèŠpathè¿™ä¸ªæ¨¡å—çš„ï¼Œè¿™ä¸ªnodeæ¨¡å—åœ¨å¾ˆå¤šåœ°æ–¹éƒ½æœ‰åº”ç”¨ï¼Œæ‰€ä»¥ï¼Œå¯¹äºæˆ‘ä»¬æ¥è¯´ï¼ŒæŒæ¡ä»–ï¼Œå¯¹æˆ‘ä»¬ä»¥åçš„å‘å±•æ›´æœ‰åˆ©ï¼Œä¸ç”¨æ¯æ¬¡çœ‹webpackçš„é…ç½®æ–‡ä»¶è¿˜è¦å»æŸ¥è¯¢ä¸€ä¸‹è¿™ä¸ªapiæ˜¯å¹²ä»€ä¹ˆç”¨çš„ï¼Œå¾ˆå½±å“æˆ‘ä»¬çš„æ•ˆç‡</p>
<p><a href="https://link.zhihu.com/?target=https%3A//link.juejin.im/%3Ftarget%3Dhttps%253A%252F%252Fnodejs.org%252Fapi%252Fpath.html" target="_blank" rel="noopener">nodeJS/path</a></p>
<p>ä¸Šé¢é‚£ä¸ªç½‘ç«™æœ‰è¯¦ç»†çš„apiï¼Œä½†æ˜¯æˆ‘ä»¬è¿™é‡Œä¸ç”¨éƒ½æŒæ¡å§ï¼Œæˆ‘å°±è®²å‡ ä¸ªæˆ‘é‡åˆ°è¿‡çš„ï¼Œæˆ‘è§‰å¾—webpackç­‰å·¥ç¨‹é…ç½®ä¸­ä¼šç”¨åˆ°çš„</p>
<h2 id="path-normalize"><a href="#path-normalize" class="headerlink" title="path.normalize"></a>path.normalize</h2><p>è¿™ä¸ªæ–¹æ³•å°±æ˜¯æŠŠä¸è§„èŒƒçš„è·¯å¾„è§„èŒƒåŒ–ï¼Œæ¯”å¦‚çœ‹ä¸‹é¢çš„ä¾‹å­</p>
<pre><code>const path = require(&apos;path&apos;);
console.log(path.normalize(&apos;/foo/bar//baz/asdf/quux/..&apos;));
</code></pre><p>è¾“å‡ºç»“æœï¼š</p>
<pre><code>/foo/bar/baz/asdf
</code></pre><h2 id="path-join"><a href="#path-join" class="headerlink" title="path.join"></a>path.join</h2><pre><code>const path = require(&apos;path&apos;);
console.log(path.join(&apos;src&apos;, &apos;task.js&apos;));

const path = require(&apos;path&apos;);
console.log(path.join(&apos;dist&apos;, &apos;task.js&apos;));

const path = require(&apos;path&apos;);
console.log(path.join(&apos;&apos;));
</code></pre><p>è¿™ä¹ˆä¸¤ä¸ªçš„è¾“å‡ºç»“æœæ˜¯ï¼š</p>
<pre><code>src/task.js
dist/task.js
.
</code></pre><p>ä»–çš„ä½œç”¨ä¹Ÿå°±æ˜¾è€Œæ˜“è§ï¼Œä»–æœ‰ä¸€ä¸‹å‡ æ¡è§„åˆ™ï¼š<br>1.ä¼ å…¥çš„å‚æ•°æ˜¯å­—ç¬¦ä¸²çš„è·¯å¾„ç‰‡æ®µï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªï¼Œä¹Ÿå¯ä»¥æ˜¯å¤šä¸ª</p>
<p>2.è¿”å›çš„æ˜¯ä¸€ä¸ªæ‹¼æ¥å¥½çš„è·¯å¾„ï¼Œä½†æ˜¯æ ¹æ®å¹³å°çš„ä¸åŒï¼Œä»–ä¼šå¯¹è·¯å¾„è¿›è¡Œä¸åŒçš„è§„èŒƒåŒ–ï¼Œä¸¾ä¸ªä¾‹å­ï¼ŒUnixç³»ç»Ÿæ˜¯â€/â€œï¼ŒWindowsç³»ç»Ÿæ˜¯â€\â€œï¼Œé‚£ä¹ˆä½ åœ¨ä¸¤ä¸ªç³»ç»Ÿä¸‹çœ‹åˆ°çš„è¿”å›ç»“æœå°±ä¸ä¸€æ ·ã€‚</p>
<p>3.å¦‚æœè¿”å›çš„è·¯å¾„å­—ç¬¦ä¸²é•¿åº¦ä¸ºé›¶ï¼Œé‚£ä¹ˆä»–ä¼šè¿”å›ä¸€ä¸ªâ€™.â€™ï¼Œä»£è¡¨å½“å‰çš„æ–‡ä»¶å¤¹ã€‚</p>
<p>4.å¦‚æœä¼ å…¥çš„å‚æ•°ä¸­æœ‰ä¸æ˜¯å­—ç¬¦ä¸²çš„ï¼Œé‚£å°±ç›´æ¥ä¼šæŠ¥é”™</p>
<h2 id="path-parse"><a href="#path-parse" class="headerlink" title="path.parse"></a>path.parse</h2><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸ªä¾‹å­ï¼Œåœ¨srcç›®å½•ä¸‹çš„task.jså†™å…¥</p>
<pre><code>const path = require(&apos;path&apos;);
console.log(path.parse(&apos;/Users/laihuamin/Documents/richEditor/editor&apos;));
</code></pre><p>ç„¶åè¿è¡Œnode src/task.jsä¹‹å,è¾“å‡ºçš„ç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code>{ 
  root: &apos;/&apos;,
  dir: &apos;/Users/laihuamin/Documents/richEditor&apos;,
  base: &apos;editor&apos;,
  ext: &apos;&apos;,
  name: &apos;editor&apos; 
}
</code></pre><p>ä»–è¿”å›çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥æŠŠè¿™ä¹ˆå‡ ä¸ªåè¯ç†Ÿæ‚‰ä¸€ä¸‹ï¼š</p>
<p><img src="https://pic3.zhimg.com/v2-b7c5d496b89fde98f097a4a6e2ba7d03_b.jpg" alt=""><img src="https://pic3.zhimg.com/80/v2-b7c5d496b89fde98f097a4a6e2ba7d03_hd.jpg" alt=""></p>
<p>è¿™ä¸ªè¡¨æ ¼åº”è¯¥å±•ç¤ºçš„å¾ˆå½¢è±¡ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯æ¥è§£é‡Šä¸€ä¸‹è¿™äº›åè¯ï¼š<br>1.rootï¼šä»£è¡¨æ ¹ç›®å½•<br>2.dirï¼šä»£è¡¨æ–‡ä»¶æ‰€åœ¨çš„æ–‡ä»¶å¤¹<br>3.baseï¼šä»£è¡¨æ•´ä¸€ä¸ªæ–‡ä»¶<br>4.nameï¼šä»£è¡¨æ–‡ä»¶å<br>5.ext: ä»£è¡¨æ–‡ä»¶çš„åç¼€å</p>
<p>é‚£æˆ‘ä»¬æ ¹æ®ä¸‹é¢çš„è§„åˆ™ï¼Œæ¥çœ‹ä¸€ä¸‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼Œæœ€å¥½è‡ªå·±è„‘å­åšä¸€é</p>
<pre><code>const path = require(&apos;path&apos;);
console.log(path.parse(&apos;/Users/laihuamin/Documents/richEditor/editor/src/task.js&apos;));
</code></pre><p>è¾“å‡ºçš„ç»“æœï¼š</p>
<pre><code>{ 
  root: &apos;/&apos;,
  dir: &apos;/Users/laihuamin/Documents/richEditor/editor/src&apos;,
  base: &apos;task.js&apos;,
  ext: &apos;.js&apos;,
  name: &apos;task&apos; 
}
</code></pre><p>ä½ åšå¯¹äº†ä¹ˆï¼Ÿ0.0</p>
<h2 id="path-basename"><a href="#path-basename" class="headerlink" title="path.basename"></a>path.basename</h2><p>é‚£æœ‰äº†å‰é¢è¿™ä¸ªé“ºå«ï¼Œæƒ³å¿…è¿™ä¸ªæ¥å£çŒœä¹Ÿèƒ½çŒœçš„åˆ°äº†ã€‚ã€‚ã€‚ã€‚æˆ‘ä»¬çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­</p>
<pre><code>const path = require(&apos;path&apos;);
console.log(path.basename(&apos;/Users/laihuamin/Documents/richEditor/editor/src/task.js&apos;));
</code></pre><p>è¾“å‡ºçš„ç»“æœæ˜¯ï¼š</p>
<pre><code>task.js
</code></pre><p>æˆ‘ä»¬è¿˜æ˜¯ç®€å•ä»‹ç»ä¸€ä¸‹ï¼Œæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯path,è¿˜æœ‰ä¸€ä¸ªæ˜¯extï¼ˆå¯é€‰å‚æ•°ï¼‰.</p>
<pre><code>const path = require(&apos;path&apos;)
console.log(path.basename(&apos;/Users/laihuamin/Documents/richEditor/editor/src/task.js&apos;, &apos;.js&apos;));
</code></pre><p>è¾“å‡ºç»“æœ:</p>
<pre><code>task
</code></pre><h2 id="path-dirname"><a href="#path-dirname" class="headerlink" title="path.dirname"></a>path.dirname</h2><p>è¿™ä¸ªæ¥å£æ¯”basenameè¿˜è¦ç®€å•ï¼Œæˆ‘å°±ä¸å¤šè¯´äº†ï¼Œçœ‹ä¾‹å­ï¼Œçœ‹ç»“æœ</p>
<pre><code>const path = require(&apos;path&apos;);
console.log(path.basename(&apos;/Users/laihuamin/Documents/richEditor/editor/src/task.js&apos;));
</code></pre><p>è¾“å‡ºçš„ç»“æœ:</p>
<pre><code>/Users/laihuamin/Documents/richEditor/editor/src
</code></pre><p>æ³¨æ„ä¸€ä¸‹ï¼Œæ¥æ”¶çš„å‚æ•°æ˜¯å­—ç¬¦ä¸²ç±»å‹</p>
<h2 id="path-extname"><a href="#path-extname" class="headerlink" title="path.extname"></a>path.extname</h2><p>è¿™ä¸ªå°±æ˜¯å±•ç¤ºæ–‡ä»¶çš„æ‰©å±•åï¼Œæˆ‘ä»¬å¾—æ³¨æ„å‡ ç§æƒ…å†µ</p>
<pre><code>const path = require(&apos;path&apos;);
path.extname(&apos;index.html&apos;);
path.extname(&apos;index.coffee.md&apos;);
path.extname(&apos;index.&apos;);
path.extname(&apos;index&apos;);
path.extname(&apos;.index&apos;);
</code></pre><p>è¾“å‡ºçš„ç»“æœæ˜¯ï¼š</p>
<pre><code>.html
.md
.
&apos;&apos;
&apos;&apos;
</code></pre><p>è‡ªå·±æ³¨æ„ä¸€ä¸‹è¿™å‡ ä¸ªæƒ…å†µ</p>
<h2 id="path-resolve"><a href="#path-resolve" class="headerlink" title="path.resolve"></a>path.resolve</h2><p>æˆ‘ä»¬é€šè¿‡ä¸‹é¢è¿™å‡ ä¸ªä¾‹å­å…ˆæ¥ç†Ÿæ‚‰ä¸€ä¸‹ï¼š</p>
<pre><code>const path = require(&apos;path&apos;);
console.log(path.resolve(&apos;/foo/bar&apos;, &apos;/bar/faa&apos;, &apos;..&apos;, &apos;a/../c&apos;));
</code></pre><p>è¾“å‡ºçš„ç»“æœæ˜¯</p>
<pre><code>/bar/c
</code></pre><p>ä»–å°±ç›¸å½“äºä¸€å †cdæ“ä½œï¼Œæˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥çœ‹</p>
<pre><code>cd /foo/bar/    //è¿™æ˜¯ç¬¬ä¸€æ­¥, ç°åœ¨çš„ä½ç½®æ˜¯/foo/bar/
cd /bar/faa     //è¿™æ˜¯ç¬¬äºŒæ­¥ï¼Œè¿™é‡Œå’Œç¬¬ä¸€æ­¥æœ‰åŒºåˆ«ï¼Œä»–æ˜¯ä»/è¿›å…¥çš„ï¼Œä¹Ÿå°±æ—¶å€™æ ¹ç›®å½•ï¼Œç°åœ¨çš„ä½ç½®æ˜¯/bar/faa
cd ..       //ç¬¬ä¸‰æ­¥ï¼Œä»faaé€€å‡ºæ¥ï¼Œç°åœ¨çš„ä½ç½®æ˜¯ /bar
cd a/../c   //ç¬¬å››æ­¥ï¼Œè¿›å…¥aï¼Œç„¶ååœ¨æ¨å‡ºï¼Œåœ¨è¿›å…¥cï¼Œæœ€åä½ç½®æ˜¯/bar/c
</code></pre><p>ä½†æ˜¯è¿™ä¸ªæ“ä½œå’Œcdè¿˜æ˜¯æœ‰åŒºåˆ«çš„ï¼Œè¿™ä¸ªè·¯å¾„ä¸ä¸€å®šè¦å­˜åœ¨ï¼Œè€Œä¸”æœ€åçš„å¯ä»¥æ˜¯æ–‡ä»¶</p>
<h2 id="path-relative"><a href="#path-relative" class="headerlink" title="path.relative"></a>path.relative</h2><p>è¿™ä¸ªè¿”å›çš„æ˜¯fromåˆ°toçš„ç›¸å¯¹è·¯å¾„ï¼Œä»€ä¹ˆæ„æ€å‘¢ï¼Œæˆ‘ä»¬çœ‹ä¸‹é¢çš„ä¾‹å­å°±çŸ¥é“äº†.</p>
<pre><code>const path = require(&apos;path&apos;);
console.log(path.relative(&apos;src/bar/baz&apos;, &apos;src/aaa/bbb&apos;));
</code></pre><p>è¾“å‡ºçš„ç»“æœæ˜¯ï¼š</p>
<pre><code>../../aaa/bbb
</code></pre><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿™äº›æ¯”è¾ƒå®ç”¨çš„æ–¹æ³•ï¼Œåˆ†äº«ç»™å¤§å®¶ï¼Œè‡ªå·±è¿˜æ˜¯è€è€å®å®å»çœ‹weektoolçš„webpackçš„é…ç½®æ–‡ä»¶äº†ï¼Œå–œæ¬¢çš„æœ‹å‹å¯ä»¥ç‚¹ä¸ªå–œæ¬¢ï¼Œæˆ–è€…å»æˆ‘çš„<a href="https://link.zhihu.com/?target=https%3A//link.juejin.im/%3Ftarget%3Dhttps%253A%252F%252Fgithub.com%252Flaihuamin%252FJS-total" target="_blank" rel="noopener">github</a>ç‚¹ä¸ªstarä¹Ÿè¡Œï¼Œè°¢è°¢æ”¯æŒï¼Œä¸¾èµ·å°æ‰‹æŒ‡ç‚¹ä¸€ç‚¹å“¦ğŸ˜¯ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/02/Vueå®‰å…¨æƒé™æ§åˆ¶axiosæ‹¦æˆª/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/02/Vueå®‰å…¨æƒé™æ§åˆ¶axiosæ‹¦æˆª/" itemprop="url">Vueå®‰å…¨æƒé™æ§åˆ¶axiosæ‹¦æˆª</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-07-02T22:57:53+08:00">
                2018-07-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ä½•ä¸ºæƒé™æ§åˆ¶</p>
<pre><code>//è¯·æ±‚å¤±è´¥åçš„ç»Ÿä¸€æ‹¦æˆªï¼Œä»¥åŠajaxçš„åŸºæœ¬è®¾ç½®
import axios from &apos;axios&apos;;
import qs from &apos;qs&apos;;

function cleanRequest(req) {
  for (const i in req) {
    /* eslint guard-for-in: 0 */
    if (req[i] !== 0 &amp;&amp; !req[i]) {
      delete req[i];
    }
  }
}

axios.defaults.withCredentials = true;
axios.defaults.xsrfCookieName = null;
axios.defaults.headers.common[&apos;X-Requested-With&apos;] = &apos;XMLHttpRequest&apos;;
axios.defaults.headers.post[&apos;Content-Type&apos;] = &apos;application/x-www-form-urlencoded&apos;;
//ç³»ç»Ÿå¼¹å±‚
import Toast from &apos;mint-ui/lib/toast&apos;;
import &apos;mint-ui/lib/toast/style.css&apos;;

module.exports.install = function (Vue) {
  axios.defaults.baseURL=&quot;/&quot;;
  Vue.prototype.$http = axios;
  Vue.http = axios;

  axios.interceptors.request.use(
    function (request) {
      const params = request.params;
      if (params) {
        cleanRequest(params);
      }
      if (request.data) {
        cleanRequest(request.data);
        request.data=qs.stringify(Object.assign(request.data,Bus.movieConfig))
      }else{
        request.data=qs.stringify(Bus.movieConfig)
      }
      return request;
    },
    function (error) {
      return Promise.reject(error);
    }
  );

  // Add a response interceptor
  axios.interceptors.response.use(
    function (response) {
      return response;
    },
    function (error) {
      Toast(&apos;ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åé‡è¯•!&apos;);
      // Do something with response error
      return Promise.reject(error);
    }
  );
};
</code></pre><p>æƒé™æ§åˆ¶å¤§è‡´åˆ†ä¸ºä¸¤ä¸ªç»´åº¦:</p>
<ul>
<li>å‚ç›´ç»´åº¦: æ§åˆ¶ç”¨æˆ·å¯ä»¥è®¿é—®å“ªäº›urlçš„æƒé™</li>
<li>æ°´å¹³ç»´åº¦: æ§åˆ¶ç”¨æˆ·è®¿é—®ç‰¹å®šurlï¼Œè·å–å“ªäº›æ•°æ®çš„æƒé™ï¼ˆe.g. æ™®é€šç”¨æˆ·ã€ç®¡ç†å‘˜ã€è¶…çº§ç®¡ç†å‘˜è®¿é—®åŒä¸€urlï¼Œè·å–çš„æ•°æ®æ˜¯ä¸åŒçš„ï¼‰</li>
</ul>
<p>Webæƒé™æ§åˆ¶æ–¹æ¡ˆList</p>
<ul>
<li>å‰åç«¯ä¸åˆ†ç¦»ï¼šä»¥Javaä¸ºä¾‹ï¼Œåç«¯é€šè¿‡jspã€freemarkã€thmeleafç­‰æ¨¡æ¿æ¥æ¸²æŸ“ç›¸åº”æƒé™çš„æ•°æ®ï¼Œæ¸²æŸ“å®Œå‘ˆç°åœ¨æµè§ˆå™¨ç«¯</li>
<li>å‰åç«¯åˆ†ç¦»ï¼š<br>â–«SPAå•é¡µé¢åº”ç”¨ï¼Œè·¯ç”±ç”±å‰ç«¯æ§åˆ¶ï¼Œå‰ç«¯é€šè¿‡jsæ§åˆ¶hashè·¯ç”±çš„æƒé™<br>â–«SSRæœåŠ¡ç«¯æ¸²æŸ“ï¼ŒNodeä¸­é—´å±‚åšä»£ç†è·¯ç”±ï¼Œåˆ¤æ–­æƒé™æ¸²æŸ“ç‰¹å®šçš„è·¯ç”±è‡³æµè§ˆå™¨ç«¯</li>
</ul>
<p>SPAå‰ç«¯æƒé™æ§åˆ¶æ–¹æ¡ˆ</p>
<p>SPA: å•é¡µWebåº”ç”¨ï¼ˆsingle page web applicationï¼‰å°†æ‰€æœ‰webæ´»åŠ¨å±€é™äºä¸€ä¸ªhtmlé¡µé¢ä¸­ï¼Œåˆ©ç”¨jsé€šè¿‡hashæˆ–è€…æµè§ˆå™¨history apiæ¥å®ç°æ— åˆ·æ–°è·¯ç”±è·³è½¬ï¼Œå‰åç«¯é€šè¿‡ajaxæ•°æ®é€šä¿¡ï¼Œé¿å…äº†æµè§ˆå™¨çš„åˆ·æ–°é‡æ–°åŠ è½½ï¼Œä¸ºç”¨æˆ·æä¾›æµç¨‹çš„æ“ä½œä½“éªŒã€‚è¿™æ„å‘³ç€å‰ç«¯æ¥ç®¡äº†è·¯ç”±å±‚ï¼Œéœ€è¦é€šè¿‡è°ƒç”¨å‰ç«¯è‡ªèº«çš„MVCæ¨¡å—ï¼Œæ¥æ¸²æŸ“ä¸åŒçš„é¡µé¢ã€‚</p>
<blockquote>
<p>Base onï¼š</p>
</blockquote>
<ul>
<li>Vue å‰ç«¯MVVMæ¡†æ¶</li>
<li>Vuex çŠ¶æ€ç®¡ç†æœº</li>
<li>Vue-router è·¯ç”±</li>
<li>Axios HTTPè¯·æ±‚åº“</li>
</ul>
<p>1.ç™»é™†äº‹ä»¶Login</p>
<pre><code>// 1.è§¦å‘ç™»é™†äº‹ä»¶
dispatch(&apos;login&apos;)

// actions
commit(types.LOGIN_SUCCESS, res.data.data)
...
</code></pre><p>2.è·å–Tokenï¼Œç»Base64ç¼–ç åå­˜è‡³sessionStorage</p>
<pre><code>// mutations
const mutations = {
    [types.LOGIN_SUCCESS] (state, data) {
        state.authlock = false
    // 2.ç™»é™†æˆåŠŸå›è°ƒæ‹¿åˆ°token,ç»Base64 ç¼–ç åå­˜å…¥æœ¬åœ°sessionStorage
        let token = Base64.encode(data + &apos;:HIKDATAE&apos;)
        sessionStorage.setItem(&apos;userToken&apos;, token)
    // è·¯ç”±è·³è½¬è‡³ç›®æ ‡é¡µé¢
        router.push({name: &apos;xxx&apos;})
    },
    [types.LOGOUT_SUCCESS] (state) {
        state.authlock = true
    // ç™»å‡ºæˆåŠŸå›è°ƒ,ç§»é™¤æœ¬åœ°token
        sessionStorage.removeItem(&apos;userToken&apos;)
        router.push({name: &apos;Login&apos;})
    }
}
</code></pre><p>3.æ‰€æœ‰HTTP Header Authorization åŠ ä¸Šç¼–ç åçš„token(å‰åç«¯å¯çº¦å®šè§„åˆ™)</p>
<pre><code>// Axios è¯·æ±‚é’©å­ï¼ˆrequestï¼‰
axios.interceptors.request.use(req =&gt; {
    let token = sessionStorage.getItem(&apos;user&apos;)     
    if (token) {         
        // 3.token å­˜åœ¨,åˆ™åœ¨ä¹‹åæ‰€æœ‰è¯·æ±‚çš„httpè¯·æ±‚å¤´ Authorization å¸¦ä¸Šbase64ç¼–ç åçš„token,åå°æ‹¿åˆ°tokenåè¿›è¡ŒéªŒè¯æƒé™         
        req.headers.Authorization = `Basic ${token}`     
    }
    req.data = qs.stringify(req.data)     
    return req 
}, error =&gt; {
    return Promise.reject(error) 
})
</code></pre><p>æµè§ˆå™¨http header<br><img src="https://pic4.zhimg.com/v2-48ee52913451d66397f33a47f6af3374_b.jpg" alt=""><img src="https://pic4.zhimg.com/80/v2-48ee52913451d66397f33a47f6af3374_hd.jpg" alt=""></p>
<p>4.è¯·æ±‚æ‹¦æˆªï¼šåå°æ‹¿åˆ°tokenåå¯¹æ¯ä¸ªè¯·æ±‚è¿›è¡Œæ ¡éªŒï¼Œè‹¥æ ¡éªŒå¤±è´¥è¿”å›401ï¼Œå‰ç«¯responseé’©å­é‡Œç»Ÿä¸€catch error è·³è½¬è‡³ç™»é™†é¡µé¢ã€‚</p>
<pre><code>// Axios è¯·æ±‚é’©å­ï¼ˆresponseï¼‰
axios.interceptors.response.use(res =&gt; {
    return res
}, error =&gt; {
    if (error.response) {
        switch (error.response.status) {
        // 4.æ‰€æœ‰æ¥å£responseæ ¡éªŒé’©å­,è‹¥tokenæ£€éªŒå¤±è´¥,åå°è¿”å› 401 error code, æ¸…é™¤tokenä¿¡æ¯å¹¶è·³è½¬åˆ°ç™»å½•é¡µé¢
            case 401:
                store.commit(types.LOGOUT)
                router.replace({
                    path: &apos;/login&apos;
        })
    }
    }
    return Promise.reject(error)
})
</code></pre><p>5.è·¯ç”±è·³è½¬æ‹¦æˆªï¼šä»»æ„è·¯ç”±è·³è½¬æ—¶ï¼Œåœ¨è·¯ç”±beforeEaché’©å­é‡Œæ ¡éªŒæœ¬åœ°æ˜¯å¦å­˜åœ¨tokenï¼Œè‹¥æ²¡æœ‰ï¼Œåˆ™è·³è½¬è‡³ç™»é™†é¡µé¢</p>
<pre><code>// è·¯ç”±é’©å­(æ¯ä¸ªè·¯ç”±è·³è½¬å‰è°ƒèµ·beforeEaché’©å­)
router.beforeEach((to, from, next) =&gt; {
  if (to.path === &apos;/login&apos;) {
    sessionStorage.removeItem(&apos;userToken&apos;)
  }
  let user = sessionStorage.getItem(&apos;userToken&apos;)
  if (!user &amp;&amp; to.path !== &apos;/login&apos;) {
    // è‹¥æœ¬åœ°tokenä¸å­˜åœ¨,åˆ™ä»»æ„è·¯ç”±è·³è½¬çš„æ—¶å€™,é‡å®šå‘è‡³login ç™»é™†é¡µé¢
    next({ path: &apos;/login&apos; })
  } else {
    next()
  }
})
</code></pre><p>6.ç™»å‡ºLogoutï¼šæ¸…æ¥šæœ¬åœ°sessionStorageçš„tokenä¿¡æ¯</p>
<pre><code>// mutations
const mutations = {
    ...
    [types.LOGOUT_SUCCESS] (state) {
        state.authlock = true
    // ç™»å‡ºæˆåŠŸå›è°ƒ,ç§»é™¤æœ¬åœ°token
        sessionStorage.removeItem(&apos;userToken&apos;)
    router.push({name: &apos;Login&apos;})
    }
}
</code></pre><p>æµç¨‹ç¤ºæ„å›¾å¦‚ä¸‹:<br><img src="https://pic2.zhimg.com/v2-064f7b05f15399ac9ff6aa03ee1cb710_b.jpg" alt=""><img src="https://pic2.zhimg.com/80/v2-064f7b05f15399ac9ff6aa03ee1cb710_hd.jpg" alt=""></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/21/ç§»åŠ¨ç«¯è®¾ç½®äº†overflow-hiddenå’Œborder-radiusï¼Œå­å…ƒç´ è¶…å‡ºéƒ¨åˆ†ä¸éšè—é—®é¢˜ï¼Ÿ/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/21/ç§»åŠ¨ç«¯è®¾ç½®äº†overflow-hiddenå’Œborder-radiusï¼Œå­å…ƒç´ è¶…å‡ºéƒ¨åˆ†ä¸éšè—é—®é¢˜ï¼Ÿ/" itemprop="url">ç§»åŠ¨ç«¯è®¾ç½®äº†overflow:hiddenå’Œborder-radiusï¼Œå­å…ƒç´ è¶…å‡ºéƒ¨åˆ†ä¸éšè—é—®é¢˜ï¼Ÿ</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-06-21T14:41:09+08:00">
                2018-06-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;

    &lt;head&gt;
        &lt;meta charset=&quot;UTF-8&quot;&gt;
        &lt;title&gt;&lt;/title&gt;
        &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no&quot; /&gt;
        &lt;link rel=&quot;stylesheet&quot;type=&quot;text/css&quot; href=&quot;css/SB.css&quot; /&gt;
        &lt;style type=&quot;text/css&quot;&gt;
            .main {
                width: 300px;
                height: 100px;
                border: 1px solid red;
                border-radius: 15px;
                overflow: hidden;
                /*transform:rotate(0deg); */
            }

            .con {
                display: block;
                overflow: scroll;
                overflow-y: hidden;
                -webkit-overflow-scrolling: touch;
                white-space: nowrap;
                font-size: 0px;
            }

            .item {
                width: 100px;
                height: 100px;
                background: green;
                display: inline-block;
                position: relative;
            }

            .item:nth-child(2n) {
                background: red;
            }
            .item p{
                width: 50px;
                height: 20px;
                color: white;
                text-align: center;
                position: absolute;
                left: 50%;
                transform: translateX(-50%);
                top: 0px;
                background: blue;
                font-size: 12px;
            }
        &lt;/style&gt;
    &lt;/head&gt;

    &lt;body&gt;
        &lt;div class=&quot;main&quot;&gt;
            &lt;div class=&quot;con&quot;&gt;
                &lt;div class=&quot;item&quot;&gt;
                    &lt;p&gt;å¿«ç‚¹&lt;/p&gt;
                &lt;/div&gt;
                &lt;div class=&quot;item&quot;&gt;
                    &lt;p&gt;å¿«ç‚¹&lt;/p&gt;
                &lt;/div&gt;
                &lt;div class=&quot;item&quot;&gt;
                    &lt;p&gt;å¿«ç‚¹&lt;/p&gt;
                &lt;/div&gt;
                &lt;div class=&quot;item&quot;&gt;
                    &lt;p&gt;å¿«ç‚¹&lt;/p&gt;
                &lt;/div&gt;
                &lt;div class=&quot;item&quot;&gt;
                    &lt;p&gt;å¿«ç‚¹&lt;/p&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/body&gt;

&lt;/html&gt;
å¤åˆ¶ä»£ç 
</code></pre><h3 id="PC"><a href="#PC" class="headerlink" title="PC"></a>PC</h3><p><img src="https://user-gold-cdn.xitu.io/2018/5/14/1635d69655dafdb2?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""></p>
<h3 id="ç§»åŠ¨ç«¯"><a href="#ç§»åŠ¨ç«¯" class="headerlink" title="ç§»åŠ¨ç«¯"></a>ç§»åŠ¨ç«¯</h3><p><img src="https://user-gold-cdn.xitu.io/2018/5/14/1635d6a28737a214?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""><br>è§£å†³åŠæ³•ï¼š</p>
<pre><code>.main {
                width: 300px;
                height: 100px;
                border: 1px solid red;
                border-radius: 15px;
                overflow: hidden;
                transform:rotate(0deg);  /*transform: scale(1);ä¹Ÿå¯ä»¥*/
            }
å¤åˆ¶ä»£ç 
</code></pre><p><img src="https://user-gold-cdn.xitu.io/2018/5/14/1635d6b547a6dd86?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/03/JavaScriptçš„äº‹ä»¶å¾ªç¯/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/03/JavaScriptçš„äº‹ä»¶å¾ªç¯/" itemprop="url">JavaScriptçš„äº‹ä»¶å¾ªç¯</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-06-03T11:15:38+08:00">
                2018-06-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Node-js-äº‹ä»¶å¾ªç¯ä¸€-æµ…æ"><a href="#Node-js-äº‹ä»¶å¾ªç¯ä¸€-æµ…æ" class="headerlink" title="Node.js äº‹ä»¶å¾ªç¯ä¸€: æµ…æ"></a>Node.js äº‹ä»¶å¾ªç¯ä¸€: æµ…æ</h2><blockquote>
<p>ç†è§£äº‹ä»¶å¾ªç¯ç³»åˆ—ç¬¬ä¸€æ­¥ æµ…æå’Œæ€»è§ˆ</p>
</blockquote>
<p>å¤šæ•°çš„ç½‘ç«™ä¸éœ€è¦å¤§é‡è®¡ç®—ï¼Œç¨‹åºèŠ±è´¹çš„æ—¶é—´ä¸»è¦é›†ä¸­åœ¨ç£ç›˜ I/O å’Œç½‘ç»œ I/O ä¸Šé¢</p>
<p>SSDè¯»å–å¾ˆå¿«ï¼Œä½†å’ŒCPUå¤„ç†æŒ‡ä»¤çš„é€Ÿåº¦æ¯”èµ·æ¥ä¹Ÿä¸åœ¨ä¸€ä¸ªæ•°é‡çº§ä¸Šï¼Œè€Œä¸”ç½‘ç»œä¸Šä¸€ä¸ªæ•°æ®åŒ…æ¥å›çš„æ—¶é—´æ›´æ…¢ï¼š</p>
<p><img src="https://pic1.zhimg.com/v2-67a42368c7dffa3348730760c9c0b907_b.jpg" alt=""><img src="https://pic1.zhimg.com/80/v2-67a42368c7dffa3348730760c9c0b907_hd.jpg" alt=""></p>
<p>ä¸€ä¸ªæ•°æ®åŒ…æ¥å›çš„å»¶è¿Ÿå¹³å‡320ms(æˆ‘ç½‘é€Ÿæ…¢ï¼Œpingå›½å†…ç½‘ç«™ä¼šæ›´å¿«)ï¼Œè¿™æ®µæ—¶é—´å†…ä¸€ä¸ªæ™®é€š cpu æ‰§è¡Œå‡ åƒä¸‡ä¸ªå‘¨æœŸåº”è¯¥æ²¡é—®é¢˜</p>
<p>å› æ­¤å¼‚æ­¥IOå°±è¦å‘æŒ¥ä½œç”¨äº†ï¼Œæ¯”å¦‚ç”¨å¤šçº¿ç¨‹ï¼Œå¦‚æœç”¨ Java å»è¯»ä¸€ä¸ªæ–‡ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ªé˜»å¡çš„æ“ä½œï¼Œåœ¨ç­‰å¾…æ•°æ®è¿”å›çš„è¿‡ç¨‹ä¸­ä»€ä¹ˆä¹Ÿå¹²ä¸äº†ï¼Œå› æ­¤å°±å¼€ä¸€ä¸ªæ–°çš„çº¿ç¨‹æ¥å¤„ç†æ–‡ä»¶è¯»å–ï¼Œè¯»å–æ“ä½œç»“æŸåå†å»é€šçŸ¥ä¸»çº¿ç¨‹ã€‚</p>
<p>è¿™æ ·è™½ç„¶è¡Œå¾—é€šï¼Œä½†æ˜¯ä»£ç å†™èµ·æ¥æ¯”è¾ƒéº»çƒ¦ã€‚åƒ Node.js V8 è¿™ç§æ— æ³•å¼€ä¸€ä¸ªçº¿ç¨‹çš„æ€ä¹ˆåŠï¼Ÿ</p>
<p>å…ˆçœ‹ä¸‹é¢å‡½æ•°æ‰§è¡Œè¿‡ç¨‹</p>
<h2 id="æ ˆ-Stack"><a href="#æ ˆ-Stack" class="headerlink" title="æ ˆ Stack"></a>æ ˆ Stack</h2><p>å½“æˆ‘ä»¬è°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒçš„åœ°å€ã€å‚æ•°ã€å±€éƒ¨å˜é‡éƒ½ä¼šå‹å…¥åˆ°ä¸€ä¸ª stack ä¸­</p>
<pre><code>function fire() {
    const result = sumSqrt(3, 4)
    console.log(result);
}
function sumSqrt(x, y) {
    const s1 = square(x)
    const s2 = square(y)
    const sum = s1 + s2;
    return Math.sqrt(sum)
}
function square(x) {
    return x * x;
}

fire()
</code></pre><blockquote>
<p>ä¸‹é¢çš„å›¾éƒ½æ˜¯ç”¨ keynote åšçš„ <a href="https://link.zhihu.com/?target=https%3A//github.com/ccforward/cc/blob/master/Blog/pic/event-loop.key" target="_blank" rel="noopener">keynoteåœ°å€</a></p>
</blockquote>
<p>å‡½æ•° <code>fire</code> é¦–å…ˆè¢«è°ƒç”¨</p>
<p><img src="https://pic3.zhimg.com/v2-a3840ed51ad7ccaedb915e05b087e1e4_b.jpg" alt=""><img src="https://pic3.zhimg.com/80/v2-a3840ed51ad7ccaedb915e05b087e1e4_hd.jpg" alt=""></p>
<p><code>fire</code> è°ƒç”¨ <code>sumSqrt</code> å‡½æ•° å‚æ•°ä¸º3å’Œ4</p>
<p><img src="https://pic4.zhimg.com/v2-5871549477044a0e7a657f9a16e9367c_b.jpg" alt=""><img src="https://pic4.zhimg.com/80/v2-5871549477044a0e7a657f9a16e9367c_hd.jpg" alt=""></p>
<p>ä¹‹åè°ƒç”¨ <code>square</code> å‚æ•°ä¸º x, x==3</p>
<p><img src="https://pic2.zhimg.com/v2-ced7e64c06861509c593cdb0cfbc594e_b.jpg" alt=""><img src="https://pic2.zhimg.com/80/v2-ced7e64c06861509c593cdb0cfbc594e_hd.jpg" alt=""></p>
<p>å½“ <code>square</code> æ‰§è¡Œç»“æŸè¿”å›æ—¶ï¼Œä» stack ä¸­å¼¹å‡ºï¼Œå¹¶å°†è¿”å›å€¼èµ‹å€¼ç»™ s1<br>s1åŠ å…¥åˆ° sumSqrt çš„ stack frame ä¸­</p>
<p><img src="https://pic2.zhimg.com/v2-0f214a42ee6c2226c343edb7431116be_b.jpg" alt=""><img src="https://pic2.zhimg.com/80/v2-0f214a42ee6c2226c343edb7431116be_hd.jpg" alt=""></p>
<p>ä»¥åŒæ ·çš„æ–¹å¼è°ƒç”¨ä¸‹ä¸€ä¸ª <code>square</code> å‡½æ•°</p>
<p><img src="https://pic4.zhimg.com/v2-6488db685f7ba396d9bb72b80daf0465_b.jpg" alt=""><img src="https://pic4.zhimg.com/80/v2-6488db685f7ba396d9bb72b80daf0465_hd.jpg" alt=""></p>
<p><img src="https://pic1.zhimg.com/v2-4900e4ce2e398d085ceb6f2ea31ad6d9_b.jpg" alt=""><img src="https://pic1.zhimg.com/80/v2-4900e4ce2e398d085ceb6f2ea31ad6d9_hd.jpg" alt=""></p>
<p>åœ¨ä¸‹ä¸€è¡Œçš„è¡¨è¾¾å¼ä¸­è®¡ç®—å‡º s1+s2 å¹¶èµ‹å€¼ç»™ sum</p>
<p><img src="https://pic3.zhimg.com/v2-0045b1427a3fd41aa31cbac4271b6200_b.jpg" alt=""><img src="https://pic3.zhimg.com/80/v2-0045b1427a3fd41aa31cbac4271b6200_hd.jpg" alt=""></p>
<p>ä¹‹åè°ƒç”¨ <code>Math.sqrt</code> å‚æ•°ä¸ºsum</p>
<p><img src="https://pic4.zhimg.com/v2-89dc079ce6308a32fbf78c29b67c4985_b.jpg" alt=""><img src="https://pic4.zhimg.com/80/v2-89dc079ce6308a32fbf78c29b67c4985_hd.jpg" alt=""></p>
<p>ç°åœ¨å°±å‰©ä¸‹ <code>sumSqrt</code> å‡½æ•°è¿”å›è®¡ç®—ç»“æœäº†</p>
<p><img src="https://pic2.zhimg.com/v2-3fe1e6705f665c11f3c350bdd4f643c9_b.jpg" alt=""><img src="https://pic2.zhimg.com/80/v2-3fe1e6705f665c11f3c350bdd4f643c9_hd.jpg" alt=""></p>
<p>è¿”å›å€¼èµ‹å€¼ç»™ result</p>
<p><img src="https://pic4.zhimg.com/v2-d55914f97f05518c2f31b10909efb4f4_b.jpg" alt=""><img src="https://pic4.zhimg.com/80/v2-d55914f97f05518c2f31b10909efb4f4_hd.jpg" alt=""></p>
<p>åœ¨ console ä¸­æ‰“å°å‡º result</p>
<p><img src="https://pic3.zhimg.com/v2-99d7b0ece63e888549b258944fe0e1e4_b.jpg" alt=""><img src="https://pic3.zhimg.com/80/v2-99d7b0ece63e888549b258944fe0e1e4_hd.jpg" alt=""></p>
<p>æœ€ç»ˆ <code>fire</code> æ²¡æœ‰ä»»ä½•è¿”å›å€¼ ä»stackä¸­å¼¹å‡º stackä¹Ÿæ¸…ç©ºäº†</p>
<p><img src="https://pic4.zhimg.com/v2-bd4e4983cbba11fe080913f2a1d0ef43_b.jpg" alt=""><img src="https://pic4.zhimg.com/80/v2-bd4e4983cbba11fe080913f2a1d0ef43_hd.jpg" alt=""></p>
<p>å½“å‡½æ•°æ‰§è¡Œå®Œæ¯•åæœ¬åœ°å˜é‡ä¼šä» stack ä¸­å¼¹å‡ºï¼Œè¿™åªæœ‰åœ¨ä½¿ç”¨ numbers string boolean è¿™ç§åŸºæœ¬æ•°æ®ç±»å‹æ—¶æ‰ä¼šå‘ç”Ÿã€‚è€Œå¯¹è±¡ã€æ•°ç»„çš„å€¼æ˜¯å­˜åœ¨äº heap(å †) ä¸­çš„ï¼Œstack åªå­˜æ”¾äº†ä»–ä»¬å¯¹åº”çš„æŒ‡é’ˆã€‚</p>
<p>å½“å‡½æ•°ä¹‹è¡Œç»“æŸä» stack ä¸­å¼¹å‡ºæ¥æ—¶ï¼Œåªæœ‰å¯¹è±¡çš„æŒ‡é’ˆè¢«å¼¹å‡ºï¼Œè€ŒçœŸæ­£çš„å€¼ä¾ç„¶å­˜åœ¨ heap ä¸­ï¼Œç„¶åç”±åƒåœ¾å›æ”¶å™¨è‡ªåŠ¨çš„æ¸…ç†å›æ”¶ã€‚</p>
<h2 id="äº‹ä»¶å¾ªç¯"><a href="#äº‹ä»¶å¾ªç¯" class="headerlink" title="äº‹ä»¶å¾ªç¯"></a>äº‹ä»¶å¾ªç¯</h2><p>é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥äº†è§£å‡½æ•°çš„æ‰§è¡Œé¡ºåº</p>
<pre><code>&apos;use strict&apos;

const express = require(&apos;express&apos;)
const superagent = require(&apos;superagent&apos;)
const app = express()

app.get(&apos;/&apos;, getArticle)

function getArticle(req, res) {
    fetchArticle(req, res)
    print()
}

const aids = [4564824, 4506868, 4767667, 4856099, 7456996];

function fetchArticle(req, res) {
    const aid = aids[Math.floor(Math.random() * aids.length)]
    superagent.get(`http://news-at.zhihu.com/api/4/news/${aid}`)
        .end((err, res) =&gt; {
            if(err) {
                console.log(&apos;error ......&apos;);
                return res.status(500).send(&apos;an error ......&apos;)
            }
            const article = res.body
            res.send(article)
            console.log(&apos;Got an article&apos;)
        })

    console.log(&apos;Now is fetching an article&apos;)
}

function print(){
    console.log(&apos;Print something&apos;)
}


app.listen(&apos;5000&apos;)
</code></pre><p>è¯·æ±‚ <code>http://localhost:5000/</code> åæ‰“å°å‡º</p>
<pre><code>Now is fetching an article

Print something

Got an article
</code></pre><p>è™½ç„¶ V8 æ˜¯å•çº¿ç¨‹çš„ï¼Œä½†åº•å±‚çš„ C++ API å´ä¸æ˜¯ã€‚è¿™æ„å‘³ç€å½“æˆ‘ä»¬æ‰§è¡Œä¸€äº›éé˜»å¡çš„æ“ä½œï¼ŒNodeä¼šè°ƒç”¨ä¸€äº›ä»£ç ï¼Œä¸å¼•æ“é‡Œçš„jsä»£ç åŒæ—¶æ‰§è¡Œã€‚ä¸€æ—¦è¿™ä¸ªéšè—çš„çº¿ç¨‹æ”¶åˆ°äº†ç­‰å¾…çš„è¿”å›å€¼æˆ–è€…æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œä¹‹å‰æä¾›çš„å›è°ƒå‡½æ•°å°±ä¼šæ‰§è¡Œã€‚</p>
<p>ä¸Šé¢çš„è¯´çš„Nodeè°ƒç”¨çš„ä¸€äº›ä»£ç å…¶å®å°±æ˜¯ <a href="https://link.zhihu.com/?target=https%3A//github.com/libuv/libuv" target="_blank" rel="noopener">libuv</a>ï¼Œä¸€ä¸ªå¼€æºçš„è·¨å¹³å°çš„å¼‚æ­¥ I/O ã€‚æœ€åˆå°±æ˜¯ä¸º Node.js å¼€å‘çš„ï¼Œç°åœ¨<a href="https://link.zhihu.com/?target=https%3A//github.com/libuv/libuv/wiki/Projects-that-use-libuv" target="_blank" rel="noopener">å¾ˆå¤šé¡¹ç›®</a>éƒ½åœ¨ç”¨</p>
<h2 id="ä»»åŠ¡é˜Ÿåˆ—"><a href="#ä»»åŠ¡é˜Ÿåˆ—" class="headerlink" title="ä»»åŠ¡é˜Ÿåˆ—"></a>ä»»åŠ¡é˜Ÿåˆ—</h2><p>javascript æ˜¯å•çº¿ç¨‹äº‹ä»¶é©±åŠ¨çš„è¯­è¨€ï¼Œé‚£æˆ‘ä»¬å¯ä»¥ç»™æ—¶é—´æ·»åŠ ç›‘å¬å™¨ï¼Œå½“äº‹ä»¶è§¦å‘æ—¶ï¼Œç›‘å¬å™¨å°±èƒ½æ‰§è¡Œå›è°ƒå‡½æ•°ã€‚</p>
<p>å½“æˆ‘ä»¬å»è°ƒç”¨ <code>setTimeout`</code>http.get<code></code>fs.readFile`, Node.js ä¼šæŠŠè¿™äº›å®šæ—¶å™¨ã€httpã€IOæ“ä½œå‘é€ç»™å¦ä¸€ä¸ªçº¿ç¨‹ä»¥ä¿è¯V8ç»§ç»­æ‰§è¡Œæˆ‘ä»¬çš„ä»£ç ã€‚</p>
<p>ç„¶è€Œæˆ‘ä»¬åªæœ‰ä¸€ä¸ªä¸»çº¿ç¨‹å’Œä¸€ä¸ª call-stack ï¼Œè¿™æ ·å½“ä¸€ä¸ªè¯»å–æ–‡ä»¶çš„æ“ä½œè¿˜åœ¨æ‰§è¡Œæ—¶ï¼Œæœ‰ä¸€ä¸ªç½‘ç»œè¯·æ±‚requestè¿‡æ¥ï¼Œé‚£è¿™æ—¶ä»–çš„å›è°ƒå°±éœ€è¦ç­‰stackå˜ç©ºæ‰èƒ½æ‰§è¡Œã€‚</p>
<p>å›è°ƒå‡½æ•°æ­£åœ¨ç­‰å¾…è½®åˆ°è‡ªå·±æ‰§è¡Œæ‰€æ’çš„é˜Ÿå°±è¢«ç§°ä¸ºä»»åŠ¡é˜Ÿåˆ—(æˆ–è€…äº‹ä»¶é˜Ÿåˆ—ã€æ¶ˆæ¯é˜Ÿåˆ—)ã€‚æ¯å½“ä¸»çº¿ç¨‹å®Œæˆå‰ä¸€ä¸ªä»»åŠ¡ï¼Œå›è°ƒå‡½æ•°å°±ä¼šåœ¨ä¸€ä¸ªæ— é™å¾ªç¯åœˆé‡Œè¢«è°ƒç”¨ï¼Œå› æ­¤è¿™ä¸ªåœˆè¢«ç§°ä¸ºäº‹ä»¶å¾ªç¯ã€‚</p>
<p>æˆ‘ä»¬å‰é¢é‚£ä¸ªè·å–æ–‡ç« çš„ä¾‹å­çš„æ‰§è¡Œé¡ºåºå°±ä¼šå¦‚ä¸‹ï¼š</p>
<ol>
<li>express ç»™ request äº‹ä»¶æ³¨å†Œäº†ä¸€ä¸ª handlerï¼Œå¹¶ä¸”å½“è¯·æ±‚åˆ°è¾¾è·¯å¾„ â€˜/â€˜ æ—¶æ¥è§¦å‘handler</li>
<li>è°ƒè¿‡å„ä¸ªå‡½æ•°å¹¶ä¸”åœ¨ç«¯å£ 5000 ä¸Šå¯åŠ¨ç›‘å¬</li>
<li>stack ä¸ºç©ºï¼Œç­‰å¾… <code>request</code> äº‹ä»¶è§¦å‘</li>
<li>æ ¹æ®ä¼ å…¥çš„è¯·æ±‚ï¼Œäº‹ä»¶è§¦å‘ï¼Œexpress è°ƒç”¨ä¹‹å‰æä¾›çš„å‡½æ•° <code>getArticle</code></li>
<li><code>getArticle</code> å‹å…¥(push) stack</li>
<li><code>fetchArticle</code> è¢«è°ƒç”¨ åŒæ—¶å‹å…¥ stack</li>
<li><code>Math.floor</code> å’Œ <code>Math.random</code> è¢«è°ƒç”¨å‹å…¥ stack ç„¶åå† å¼¹å‡º(pop), ä» aids é‡Œé¢å–å‡ºçš„ä¸€ä¸ªå€¼è¢«èµ‹å€¼ç»™å˜é‡ aid</li>
<li><code>superagent.get</code> è¢«æ‰§è¡Œï¼Œå‚æ•°ä¸º <code>&#39;http://news-at.zhihu.com/api/4/news/${aid}&#39;</code> ,å¹¶ä¸”å›è°ƒå‡½æ•°æ³¨å†Œç»™äº† <code>end</code> äº‹ä»¶</li>
<li>åˆ° <code>http://news-at.zhihu.com/api/4/news/${aid}</code> çš„HTTPè¯·æ±‚è¢«å‘é€åˆ°åå°çº¿ç¨‹ï¼Œç„¶åå‡½æ•°ç»§ç»­å¾€ä¸‹æ‰§è¡Œ</li>
<li><code>&#39;Now is fetching an article&#39;</code> æ‰“å°åœ¨ console ä¸­ã€‚ å‡½æ•° <code>fetchArticle</code> è¿”å›</li>
<li><code>print</code> å‡½æ•°è¢«è°ƒç”¨, <code>&#39;Print something&#39;</code> æ‰“å°åœ¨ console ä¸­</li>
<li>å‡½æ•° <code>getArticle</code> è¿”å›ï¼Œå¹¶ä» stack ä¸­å¼¹å‡ºï¼Œ stack ä¸ºç©º</li>
<li>ç­‰å¾… <code>http://news-at.zhihu.com/api/4/news/${aid}</code> å‘é€ç›¸åº”ä¿¡æ¯</li>
<li>å“åº”ä¿¡æ¯åˆ°è¾¾ï¼Œ<code>end</code> äº‹ä»¶è¢«è§¦å‘</li>
<li>æ³¨å†Œç»™ <code>end</code> äº‹ä»¶çš„åŒ¿åå›è°ƒå‡½æ•°è¢«æ‰§è¡Œï¼Œè¿™ä¸ªåŒ¿åå‡½æ•°å’Œä»–é—­åŒ…ä¸­çš„æ‰€æœ‰å˜é‡å‹å…¥ stackï¼Œè¿™æ„å‘³ç€è¿™ä¸ªåŒ¿åå‡½æ•°å¯ä»¥è®¿é—®å¹¶ä¿®æ”¹ <code>express</code>, <code>superagent</code>, <code>app</code>, <code>aids</code>, <code>req</code>, <code>res</code>, <code>aid</code> çš„å€¼ä»¥åŠä¹‹å‰æ‰€æœ‰å·²ç»å®šä¹‰çš„å‡½æ•°</li>
<li>å‡½æ•° <code>res.send()</code> ä¼´éšç€ 200 æˆ– 500 çš„çŠ¶æ€ç è¢«æ‰§è¡Œï¼Œä½†åŒæ—¶åˆè¢«æ”¾å…¥åˆ°åå°çº¿ç¨‹ä¸­ï¼Œå› æ­¤ å“åº”æµ ä¸ä¼šé˜»å¡æˆ‘ä»¬å‡½æ•°çš„æ‰§è¡Œã€‚åŒ¿åå‡½æ•°ä¹Ÿè¢« pop å‡º stackã€‚</li>
</ol>
<h2 id="Microtasks-Macrotasks"><a href="#Microtasks-Macrotasks" class="headerlink" title="Microtasks Macrotasks"></a>Microtasks Macrotasks</h2><p>ä»»åŠ¡é˜Ÿåˆ—ä¸æ­¢ä¸€ä¸ªï¼Œè¿˜æœ‰ microtasks å’Œ macrotasks</p>
<p>microtasks:</p>
<ul>
<li>process.nextTick</li>
<li>promise</li>
<li>Object.observe</li>
</ul>
<p>macrotasks:</p>
<ul>
<li>setTimeout</li>
<li>setInterval</li>
<li>setImmediate</li>
<li>I/O</li>
</ul>
<p>è¿™ä¸¤ä¸ªçš„è¯¦ç»†åŒºåˆ«ä¸‹ä¸€ç¯‡å†å†™ï¼Œå…ˆçœ‹ä¸€æ®µä»£ç </p>
<pre><code>console.log(&apos;start&apos;)

const interval = setInterval(() =&gt; {  
  console.log(&apos;setInterval&apos;)
}, 0)

setTimeout(() =&gt; {  
  console.log(&apos;setTimeout 1&apos;)
  Promise.resolve()
      .then(() =&gt; {
        console.log(&apos;promise 3&apos;)
      })
      .then(() =&gt; {
        console.log(&apos;promise 4&apos;)
      })
      .then(() =&gt; {
        setTimeout(() =&gt; {
          console.log(&apos;setTimeout 2&apos;)
          Promise.resolve()
              .then(() =&gt; {
                console.log(&apos;promise 5&apos;)
              })
              .then(() =&gt; {
                console.log(&apos;promise 6&apos;)
              })
              .then(() =&gt; {
                clearInterval(interval)
              })
        }, 0)
      })
}, 0)

Promise.resolve()
    .then(() =&gt; {  
        console.log(&apos;promise 1&apos;)
    })
    .then(() =&gt; {
        console.log(&apos;promise 2&apos;)
    })
</code></pre><p>ç†è§£äº†nodeçš„äº‹ä»¶å¾ªç¯è¿˜æ˜¯æ¯”è¾ƒå®¹æ˜“å¾—å‡ºç­”æ¡ˆçš„ï¼š</p>
<pre><code>start
promise 1
promise 2
setInterval
setTimeout 1
promise 3
promise 4
setInterval
setTimeout 2
promise 5
promise 6
</code></pre><p>æ ¹æ® <a href="https://link.zhihu.com/?target=https%3A//html.spec.whatwg.org/multipage/webappapis.html%23task-queue" target="_blank" rel="noopener">WHATVG</a> çš„è¯´æ˜ï¼Œåœ¨ä¸€ä¸ªäº‹ä»¶å¾ªç¯çš„å‘¨æœŸ(cycle)ä¸­ä¸€ä¸ª (macro)task åº”è¯¥ä» macrotask é˜Ÿåˆ—å¼€å§‹æ‰§è¡Œã€‚å½“è¿™ä¸ª macrotask ç»“æŸåï¼Œæ‰€æœ‰çš„ microtasks å°†åœ¨åŒä¸€ä¸ª cycle ä¸­æ‰§è¡Œã€‚åœ¨ microtasks æ‰§è¡Œæ—¶è¿˜å¯ä»¥åŠ å…¥æ›´å¤šçš„ microtaskï¼Œç„¶åä¸€ä¸ªä¸€ä¸ªçš„æ‰§è¡Œï¼Œç›´åˆ° microtask é˜Ÿåˆ—æ¸…ç©ºã€‚</p>
<p>è§„èŒƒç†è§£èµ·æ¥æœ‰ç‚¹æ™¦æ¶©ï¼Œæ¥çœ‹ä¸‹ä¸Šé¢çš„ä¾‹å­</p>
<h2 id="Cycle-1"><a href="#Cycle-1" class="headerlink" title="Cycle 1"></a>Cycle 1</h2><p>1)<code>setInterval</code> è¢«åˆ—ä¸º task</p>
<p>2)<code>setTimeout 1</code> è¢«åˆ—ä¸º task</p>
<p>3)<code>Promise.resolve 1</code> ä¸­ä¸¤ä¸ª <code>then</code> è¢«åˆ—ä¸º microtask</p>
<p>4) stack æ¸…ç©º microtasks æ‰§è¡Œ</p>
<p>ä»»åŠ¡é˜Ÿåˆ—ï¼š <code>setInterval`</code>setTimeout 1`</p>
<h2 id="Cycle-2"><a href="#Cycle-2" class="headerlink" title="Cycle 2"></a>Cycle 2</h2><p>5) microtasks é˜Ÿåˆ—æ¸…ç©º <code>setInteval</code> çš„å›è°ƒå¯ä»¥æ‰§è¡Œã€‚å¦ä¸€ä¸ª <code>setInterval</code> è¢«åˆ—ä¸º task , ä½äº <code>setTimeout 1</code>åé¢</p>
<p>ä»»åŠ¡é˜Ÿåˆ—ï¼š <code>setTimeout 1`</code>setInterval`</p>
<h2 id="Cycle-3"><a href="#Cycle-3" class="headerlink" title="Cycle 3"></a>Cycle 3</h2><p>6) microtask é˜Ÿåˆ—æ¸…ç©ºï¼Œ<code>setTimeout 1</code> çš„å›è°ƒå¯ä»¥æ‰§è¡Œï¼Œ<code>promise 3</code> å’Œ <code>promise 4</code> è¢«åˆ—ä¸º microtasks</p>
<p>7)<code>promise 3</code> å’Œ <code>promise 4</code> æ‰§è¡Œã€‚ <code>setTimeout 2</code> è¢«åˆ—ä¸º task</p>
<p>ä»»åŠ¡é˜Ÿåˆ— <code>setInterval`</code>setTimeout 2`</p>
<h2 id="Cycle-4"><a href="#Cycle-4" class="headerlink" title="Cycle 4"></a>Cycle 4</h2><p>8) microtask é˜Ÿåˆ—æ¸…ç©º <code>setInteval</code> çš„å›è°ƒå¯ä»¥æ‰§è¡Œã€‚ç„¶åå¦ä¸€ä¸ª <code>setInterval</code> è¢«åˆ—ä¸º task ï¼Œä½äº <code>setTimeout 2</code> åé¢</p>
<p>ä»»åŠ¡é˜Ÿåˆ—ï¼š <code>setTimeout 2`</code>setInterval`</p>
<p>9)<code>setTimeout 2</code> çš„å›è°ƒæ‰§è¡Œï¼Œ <code>promise 5</code> å’Œ <code>promise 6</code> è¢«åˆ—ä¸º microtasks</p>
<p>ç°åœ¨ <code>promise 5</code> å’Œ <code>promise 6</code> çš„å›è°ƒåº”è¯¥æ‰§è¡Œï¼Œå¹¶ä¸” clear æ‰ <code>interval</code>ã€‚ ä½†æœ‰çš„æ—¶å€™ä¸çŸ¥é“ä¸ºä»€ä¹ˆ <code>setInterval</code> è¿˜ä¼šåœ¨æ‰§è¡Œä¸€éï¼Œå˜æˆä¸‹é¢ç»“æœ</p>
<pre><code>...
setTimeout 2
setInterval
promise 5
promise 6
</code></pre><p>ä½†æ˜¯æŠŠä¸Šé¢çš„ä»£ç æ”¾å…¥ chrome console ä¸­æ‰§è¡Œå´æ²¡æœ‰é—®é¢˜ã€‚è¿™ä¸€ç‚¹è¿˜è¦å†æ ¹æ®ä¸åŒçš„ nodeç‰ˆæœ¬ æŸ¥ä¸€ä¸‹ã€‚</p>
<h2 id="å…³äº-macrotask-å’Œ-microtask"><a href="#å…³äº-macrotask-å’Œ-microtask" class="headerlink" title="å…³äº macrotask å’Œ microtask"></a>å…³äº macrotask å’Œ microtask</h2><p>ç”¨ä¾‹å­ç®€å•ç†è§£äº†ä¸‹ macrotask å’Œ microtask</p>
<p>è¿™é‡Œå†è¯¦ç»†çš„æ€»ç»“ä¸‹ä¸¤è€…çš„åŒºåˆ«å’Œä½¿ç”¨</p>
<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>ä¸€ä¸ªäº‹ä»¶å¾ªç¯(EventLoop)ä¸­ä¼šæœ‰ä¸€ä¸ªæ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡(Task)ï¼Œè€Œè¿™ä¸ªä»»åŠ¡å°±æ˜¯ä» macrotask é˜Ÿåˆ—ä¸­æ¥çš„ã€‚åœ¨<a href="https://link.zhihu.com/?target=https%3A//html.spec.whatwg.org/multipage/webappapis.html%23task-queue" target="_blank" rel="noopener">whatwgè§„èŒƒ</a>ä¸­æœ‰ queue å°±æ˜¯ä»»åŠ¡é˜Ÿåˆ—ã€‚å½“è¿™ä¸ª macrotask æ‰§è¡Œç»“æŸåæ‰€æœ‰å¯ç”¨çš„ microtask å°†ä¼šåœ¨åŒä¸€ä¸ªäº‹ä»¶å¾ªç¯ä¸­æ‰§è¡Œï¼Œå½“è¿™äº› microtask æ‰§è¡Œç»“æŸåè¿˜èƒ½ç»§ç»­æ·»åŠ  microtask ä¸€ç›´åˆ°çœŸä¸ª microtask é˜Ÿåˆ—æ‰§è¡Œç»“æŸã€‚</p>
<h2 id="æ€ä¹ˆç”¨"><a href="#æ€ä¹ˆç”¨" class="headerlink" title="æ€ä¹ˆç”¨"></a>æ€ä¹ˆç”¨</h2><p>åŸºæœ¬æ¥è¯´ï¼Œå½“æˆ‘ä»¬æƒ³ä»¥åŒæ­¥çš„æ–¹å¼æ¥å¤„ç†å¼‚æ­¥ä»»åŠ¡æ—¶å€™å°±ç”¨ microtaskï¼ˆæ¯”å¦‚æˆ‘ä»¬éœ€è¦ç›´æ¥åœ¨æŸæ®µä»£ç åå°±å»æ‰§è¡ŒæŸä¸ªä»»åŠ¡ï¼Œå°±åƒPromiseä¸€æ ·ï¼‰ã€‚</p>
<p>å…¶ä»–æƒ…å†µå°±ç›´æ¥ç”¨ macrotaskã€‚</p>
<h2 id="ä¸¤è€…çš„å…·ä½“å®ç°"><a href="#ä¸¤è€…çš„å…·ä½“å®ç°" class="headerlink" title="ä¸¤è€…çš„å…·ä½“å®ç°"></a>ä¸¤è€…çš„å…·ä½“å®ç°</h2><ul>
<li>macrotasks: setTimeout setInterval setImmediate I/O UIæ¸²æŸ“</li>
<li>microtasks: Promise process.nextTick Object.observe MutationObserver</li>
</ul>
<h2 id="ä»è§„èŒƒä¸­ç†è§£"><a href="#ä»è§„èŒƒä¸­ç†è§£" class="headerlink" title="ä»è§„èŒƒä¸­ç†è§£"></a>ä»è§„èŒƒä¸­ç†è§£</h2><p>whatwgè§„èŒƒï¼š<a href="https://link.zhihu.com/?target=https%3A//html.spec.whatwg.org/multipage/webappapis.html%23task-queue" target="_blank" rel="noopener">https://html.spec.whatwg.org/multipage/webappapis.html#task-queue</a></p>
<ul>
<li>ä¸€ä¸ªäº‹ä»¶å¾ªç¯(event loop)ä¼šæœ‰ä¸€ä¸ªæˆ–å¤šä¸ªä»»åŠ¡é˜Ÿåˆ—(task queue) task queue å°±æ˜¯ macrotask queue</li>
<li>æ¯ä¸€ä¸ª event loop éƒ½æœ‰ä¸€ä¸ª microtask queue</li>
<li>task queue == macrotask queue != microtask queue</li>
<li>ä¸€ä¸ªä»»åŠ¡ task å¯ä»¥æ”¾å…¥ macrotask queue ä¹Ÿå¯ä»¥æ”¾å…¥ microtask queue ä¸­</li>
<li>å½“ä¸€ä¸ª task è¢«æ”¾å…¥é˜Ÿåˆ— queue(macroæˆ–micro) é‚£è¿™ä¸ª task å°±å¯ä»¥è¢«ç«‹å³æ‰§è¡Œäº†</li>
</ul>
<p>å†æ¥å›é¡¾ä¸‹äº‹ä»¶å¾ªç¯å¦‚ä½•æ‰§è¡Œä¸€ä¸ªä»»åŠ¡çš„æµç¨‹</p>
<p>å½“æ‰§è¡Œæ ˆ(call stack)ä¸ºç©ºçš„æ—¶å€™ï¼Œå¼€å§‹ä¾æ¬¡æ‰§è¡Œï¼š</p>
<ol>
<li>æŠŠæœ€æ—©çš„ä»»åŠ¡(task A)æ”¾å…¥ä»»åŠ¡é˜Ÿåˆ—</li>
<li>å¦‚æœ task A ä¸ºnull (é‚£ä»»åŠ¡é˜Ÿåˆ—å°±æ˜¯ç©º)ï¼Œç›´æ¥è·³åˆ°ç¬¬6æ­¥</li>
<li>å°† currently running task è®¾ç½®ä¸º task A</li>
<li>æ‰§è¡Œ task A (ä¹Ÿå°±æ˜¯æ‰§è¡Œå›è°ƒå‡½æ•°)</li>
<li>å°† currently running task è®¾ç½®ä¸º null å¹¶ç§»å‡º task A</li>
<li>æ‰§è¡Œ microtask é˜Ÿåˆ—</li>
</ol>
<ul>
<li>a: åœ¨ microtask ä¸­é€‰å‡ºæœ€æ—©çš„ä»»åŠ¡ task X</li>
<li>b: å¦‚æœ task X ä¸ºnull (é‚£ microtask é˜Ÿåˆ—å°±æ˜¯ç©º)ï¼Œç›´æ¥è·³åˆ° g</li>
<li>c: å°† currently running task è®¾ç½®ä¸º task X</li>
<li>d: æ‰§è¡Œ task X</li>
<li>e: å°† currently running task è®¾ç½®ä¸º null å¹¶ç§»å‡º task X</li>
<li>f: åœ¨ microtask ä¸­é€‰å‡ºæœ€æ—©çš„ä»»åŠ¡ , è·³åˆ° b</li>
<li>g: ç»“æŸ microtask é˜Ÿåˆ—</li>
</ul>
<ol>
<li>è·³åˆ°ç¬¬ä¸€æ­¥</li>
</ol>
<p>ä¸Šé¢å°±ç®—æ˜¯ä¸€ä¸ªç®€å•çš„ event-loop æ‰§è¡Œæ¨¡å‹</p>
<p>å†ç®€å•ç‚¹å¯ä»¥æ€»ç»“ä¸ºï¼š</p>
<ol>
<li>åœ¨ macrotask é˜Ÿåˆ—ä¸­æ‰§è¡Œæœ€æ—©çš„é‚£ä¸ª task ï¼Œç„¶åç§»å‡º</li>
<li>æ‰§è¡Œ microtask é˜Ÿåˆ—ä¸­æ‰€æœ‰å¯ç”¨çš„ä»»åŠ¡ï¼Œç„¶åç§»å‡º</li>
<li>ä¸‹ä¸€ä¸ªå¾ªç¯ï¼Œæ‰§è¡Œä¸‹ä¸€ä¸ª macrotask ä¸­çš„ä»»åŠ¡ (å†è·³åˆ°ç¬¬2æ­¥)</li>
</ol>
<h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><ul>
<li>å½“ä¸€ä¸ªtask(åœ¨ macrotask é˜Ÿåˆ—ä¸­)æ­£å¤„äºæ‰§è¡ŒçŠ¶æ€ï¼Œä¹Ÿå¯èƒ½ä¼šæœ‰æ–°çš„äº‹ä»¶è¢«æ³¨å†Œï¼Œé‚£å°±ä¼šæœ‰æ–°çš„ task è¢«åˆ›å»ºã€‚æ¯”å¦‚ä¸‹é¢ä¸¤ä¸ª</li>
</ul>
<ol>
<li>promiseA.then() çš„å›è°ƒå°±æ˜¯ä¸€ä¸ª task</li>
</ol>
<ul>
<li>promiseA æ˜¯ resolvedæˆ–rejected: é‚£è¿™ä¸ª task å°±ä¼šæ”¾å…¥å½“å‰äº‹ä»¶å¾ªç¯å›åˆçš„ microtask queue</li>
<li>promiseA æ˜¯ pending: è¿™ä¸ª task å°±ä¼šæ”¾å…¥ äº‹ä»¶å¾ªç¯çš„æœªæ¥çš„æŸä¸ª(å¯èƒ½ä¸‹ä¸€ä¸ª)å›åˆçš„ microtask queue ä¸­</li>
<li><p>setTimeout çš„å›è°ƒä¹Ÿæ˜¯ä¸ª task ï¼Œå®ƒä¼šè¢«æ”¾å…¥ macrotask queue å³ä½¿æ˜¯ 0ms çš„æƒ…å†µ</p>
</li>
<li><p>microtask queue ä¸­çš„ task ä¼šåœ¨äº‹ä»¶å¾ªç¯çš„å½“å‰å›åˆä¸­æ‰§è¡Œï¼Œå› æ­¤ macrotask queue ä¸­çš„ task å°±åªèƒ½ç­‰åˆ°äº‹ä»¶å¾ªç¯çš„ä¸‹ä¸€ä¸ªå›åˆä¸­æ‰§è¡Œäº†</p>
</li>
<li>click ajax setTimeout çš„å›è°ƒæ˜¯éƒ½æ˜¯ task, åŒæ—¶ï¼ŒåŒ…è£¹åœ¨ä¸€ä¸ª script æ ‡ç­¾ä¸­çš„jsä»£ç ä¹Ÿæ˜¯ä¸€ä¸ª task ç¡®åˆ‡è¯´æ˜¯ macrotaskã€‚</li>
</ul>
<p>ä¸¤è€…çš„å…·ä½“å®ç°</p>
<ul>
<li>macrotasks: setTimeout ï¼ŒsetIntervalï¼Œ setImmediateï¼Œ I/O ï¼ŒUIæ¸²æŸ“ï¼ŒrequestAnimationFrame</li>
<li>microtasks: Promiseï¼Œ process.nextTickï¼Œ Object.observeï¼Œ MutationObserver</li>
</ul>
<p>å†ç®€å•ç‚¹å¯ä»¥æ€»ç»“ä¸ºï¼š<br><img src="https://pic1.zhimg.com/v2-e92a4f5f686d115832b63b9b9e3ac2cd_b.jpg" alt=""><img src="https://pic1.zhimg.com/80/v2-e92a4f5f686d115832b63b9b9e3ac2cd_hd.jpg" alt=""></p>
<ol>
<li>åœ¨ macrotask é˜Ÿåˆ—ä¸­æ‰§è¡Œæœ€æ—©çš„é‚£ä¸ª task ï¼Œç„¶åç§»å‡º</li>
<li>å†æ‰§è¡Œ microtask é˜Ÿåˆ—ä¸­æ‰€æœ‰å¯ç”¨çš„ä»»åŠ¡ï¼Œç„¶åç§»å‡º</li>
<li>ä¸‹ä¸€ä¸ªå¾ªç¯ï¼Œæ‰§è¡Œä¸‹ä¸€ä¸ª macrotask ä¸­çš„ä»»åŠ¡ (å†è·³åˆ°ç¬¬2æ­¥)</li>
</ol>
<p>è¿™é‡Œè§£é‡Šä¸€ä¸‹ï¼Œä¸€å…±æœ‰Promiseã€MutationObserverä»¥åŠsetTimeoutä¸‰ç§å°è¯•å¾—åˆ°timerFuncçš„æ–¹æ³•ã€‚<br>ä¼˜å…ˆä½¿ç”¨Promiseï¼Œåœ¨Promiseä¸å­˜åœ¨çš„æƒ…å†µä¸‹ä½¿ç”¨MutationObserverï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•çš„å›è°ƒå‡½æ•°éƒ½ä¼šåœ¨microtaskä¸­æ‰§è¡Œï¼Œå®ƒä»¬ä¼šæ¯”setTimeoutæ›´æ—©æ‰§è¡Œï¼Œæ‰€ä»¥ä¼˜å…ˆä½¿ç”¨ã€‚<br>å¦‚æœä¸Šè¿°ä¸¤ç§æ–¹æ³•éƒ½ä¸æ”¯æŒçš„ç¯å¢ƒåˆ™ä¼šä½¿ç”¨setTimeoutï¼Œåœ¨taskå°¾éƒ¨æ¨å…¥è¿™ä¸ªå‡½æ•°ï¼Œç­‰å¾…è°ƒç”¨æ‰§è¡Œã€‚</p>
<p>ä¸ºä»€ä¹ˆè¦ä¼˜å…ˆä½¿ç”¨microtaskï¼Ÿæˆ‘åœ¨é¡¾è½¶çµåœ¨çŸ¥ä¹çš„å›ç­”ä¸­å­¦ä¹ åˆ°ï¼š</p>
<blockquote>
<p>JS çš„ event loop æ‰§è¡Œæ—¶ä¼šåŒºåˆ† task å’Œ microtaskï¼Œå¼•æ“åœ¨æ¯ä¸ª task æ‰§è¡Œå®Œæ¯•ï¼Œä»é˜Ÿåˆ—ä¸­å–ä¸‹ä¸€ä¸ª task æ¥æ‰§è¡Œä¹‹å‰ï¼Œä¼šå…ˆæ‰§è¡Œå®Œæ‰€æœ‰ microtask é˜Ÿåˆ—ä¸­çš„ microtaskã€‚<br>setTimeout å›è°ƒä¼šè¢«åˆ†é…åˆ°ä¸€ä¸ªæ–°çš„ task ä¸­æ‰§è¡Œï¼Œè€Œ Promise çš„ resolverã€ MutationObserver çš„å›è°ƒéƒ½ä¼šè¢«å®‰æ’åˆ°ä¸€ä¸ªæ–°çš„ microtask ä¸­æ‰§è¡Œï¼Œä¼šæ¯” setTimeout äº§ç”Ÿçš„ task å…ˆæ‰§è¡Œã€‚<br>è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ microtaskï¼Œä¼˜å…ˆä½¿ç”¨ Promiseï¼Œå¦‚æœæµè§ˆå™¨ä¸æ”¯æŒï¼Œå†å°è¯• MutationObserverã€‚<br>å®åœ¨ä¸è¡Œï¼Œåªèƒ½ç”¨ setTimeout åˆ›å»º task äº†ã€‚<br>ä¸ºå•¥è¦ç”¨ microtaskï¼Ÿ<br>æ ¹æ® HTML Standardï¼Œåœ¨æ¯ä¸ª task è¿è¡Œå®Œä»¥åï¼ŒUI éƒ½ä¼šé‡æ¸²æŸ“ï¼Œé‚£ä¹ˆåœ¨ microtask ä¸­å°±å®Œæˆæ•°æ®æ›´æ–°ï¼Œå½“å‰ task ç»“æŸå°±å¯ä»¥å¾—åˆ°æœ€æ–°çš„ UI äº†ã€‚<br>åä¹‹å¦‚æœæ–°å»ºä¸€ä¸ª task æ¥åšæ•°æ®æ›´æ–°ï¼Œé‚£ä¹ˆæ¸²æŸ“å°±ä¼šè¿›è¡Œä¸¤æ¬¡ã€‚</p>
</blockquote>
<p>é¦–å…ˆæ˜¯Promiseï¼Œ(Promise.resolve()).then()å¯ä»¥åœ¨microtaskä¸­åŠ å…¥å®ƒçš„å›è°ƒï¼Œ</p>
<p>MutationObserveræ–°å»ºä¸€ä¸ªtextNodeçš„DOMå¯¹è±¡ï¼Œç”¨MutationObserverç»‘å®šè¯¥DOMå¹¶æŒ‡å®šå›è°ƒå‡½æ•°ï¼Œåœ¨DOMå˜åŒ–çš„æ—¶å€™åˆ™ä¼šè§¦å‘å›è°ƒ,è¯¥å›è°ƒä¼šè¿›å…¥microtaskï¼Œå³textNode.data = String(counter)æ—¶ä¾¿ä¼šåŠ å…¥è¯¥å›è°ƒã€‚</p>
<p>setTimeoutæ˜¯æœ€åçš„ä¸€ç§å¤‡é€‰æ–¹æ¡ˆï¼Œå¹¶ä¸”é»˜è®¤æœ‰4mså»¶æ—¶ï¼ŒsetTimeoutå»¶æ—¶0ä¸ä¼šè€è€å®å®ç«‹å³æ‰§è¡Œï¼š</p>
<pre><code>setTimeout(function(){
    console.log(&quot;æˆ‘ä¸æ˜¯ç«‹å³æ‰§è¡Œçš„,ä¸€èˆ¬æˆ‘ä¼šå»¶æ—¶4ms,å“ˆå“ˆ&quot;);
},0);
</code></pre><p>å®ƒä¼šå°†å›è°ƒå‡½æ•°åŠ å…¥taskä¸­ï¼Œç­‰åˆ°æ‰§è¡Œã€‚<br><img src="https://pic2.zhimg.com/v2-59cf9f88d7daac690d39edfb9fffc8b8_b.jpg" alt=""><img src="https://pic2.zhimg.com/80/v2-59cf9f88d7daac690d39edfb9fffc8b8_hd.jpg" alt=""></p>
<pre><code>setTimeout(function(){console.log(4)},0);
new Promise(function(resolve){
    console.log(1)
    for( var i=0 ; i&lt;10000 ; i++ ){
        i==9999 &amp;&amp; resolve()
    }
    console.log(2)
}).then(function(){
    console.log(5)
});
console.log(3);
ç»“æœæ˜¯ï¼š
1,2,3,5,4
</code></pre><p>å†çœ‹è¿™ä¸ªï¼Œä¸¤ä¸ªè‡ªæ‰§è¡ŒåŒæ—¶æ‰§è¡Œï¼š</p>
<pre><code>&lt;script&gt;
(function test() {
  setTimeout(function () {
    console.log(4)
  }, 0);
  new Promise(function executor (resolve) {
    console.log(1);
    for(var i = 0; i &lt; 10000; i++) {
      i == 9999 &amp;&amp; resolve();
    }
    console.log(2);
  }).then(function() {
    console.log(5);
  });
  console.log(3);
})()

(function test2() {
  setTimeout(function () {
    console.log(42)
  }, 0);
  new Promise(function executor (resolve) {
    console.log(12);
    for(var i = 0; i &lt; 10000; i++) {
      i == 9999 &amp;&amp; resolve();
    }
    console.log(22);
  }).then(function() {
    console.log(52);
  });
  console.log(32);
})()
&lt;/script&gt;
</code></pre><p><img src="https://pic2.zhimg.com/v2-cd18c572eb05069895ede7e34388bb8d_b.jpg" alt=""><img src="https://pic2.zhimg.com/80/v2-cd18c572eb05069895ede7e34388bb8d_hd.jpg" alt=""><img src="https://pic3.zhimg.com/v2-afcb6fa6fb862818359f757107b769ab_b.jpg" alt=""><br>æ•´ä¸ªæ‰§è¡Œè¿‡ç¨‹æ˜¯ä¸€ä¸ª main thread ã€<a href="https://link.zhihu.com/?target=http%3A//www.baidu.com/link%3Furl%3DCV-egCVH8yK1w-ilUqGsztryG8s2mbuhAliIC_L1n_-BSZ_KJ16tAfaNkmbcRtU8" target="_blank" rel="noopener">ä¸»çº¿ç¨‹</a>ã€‘ ï¼Œä½†å¹¶ä¸æ„å‘³ç€å…ˆæ‰§è¡Œç¬¬ä¸€ä¸ªè‡ªæ‰§è¡Œåå†æ‰§è¡Œç¬¬äºŒä¸ªï¼Œå› ä¸ºä¸¤ä¸ªè‡ªæ‰§è¡Œä¸­çš„<code>setTimeout</code>è¿›å…¥çš„æ˜¯åŒä¸€ä¸ªäº‹ä»¶å¾ªç¯ä¸­ç­‰å¾…ï¼Œå› æ­¤ä»–ä¿©åœ¨æœ€ååˆ†åˆ«è¾“å‡ºäº†äº† 4 å’Œ 42ã€‚</p>
<p>å½“ä¸€ä¸ªç¨‹åºæœ‰ï¼šsetTimeoutï¼Œ setInterval ï¼ŒsetImmediateï¼Œ I/Oï¼Œ UIæ¸²æŸ“ï¼ŒPromise ï¼Œprocess.nextTickï¼Œ Object.observeï¼Œ MutationObserverçš„æ—¶å€™ï¼š</p>
<p>1.å…ˆæ‰§è¡Œ macrotasksï¼šI/O -ã€‹ UIæ¸²æŸ“</p>
<p>2.å†æ‰§è¡Œ microtasks ï¼šprocess.nextTick -ã€‹ Promise -ã€‹MutationObserver -&gt;Object.observe</p>
<p>3.å†æŠŠsetTimeout setInterval setImmediate å¡å…¥ä¸€ä¸ªæ–°çš„macrotasksï¼Œä¾æ¬¡ï¼š</p>
<p>setTimeout ï¼ŒsetInterval â€“ã€‹setImmediate</p>
<p>ç»¼ä¸Šï¼ŒnextTickçš„ç›®çš„å°±æ˜¯äº§ç”Ÿä¸€ä¸ªå›è°ƒå‡½æ•°åŠ å…¥taskæˆ–è€…microtaskä¸­ï¼Œå½“å‰æ ˆæ‰§è¡Œå®Œä»¥åï¼ˆå¯èƒ½ä¸­é—´è¿˜æœ‰åˆ«çš„æ’åœ¨å‰é¢çš„å‡½æ•°ï¼‰è°ƒç”¨è¯¥å›è°ƒå‡½æ•°ï¼Œèµ·åˆ°äº†å¼‚æ­¥è§¦å‘ï¼ˆå³ä¸‹ä¸€ä¸ªtickæ—¶è§¦å‘ï¼‰çš„ç›®çš„ã€‚</p>
<pre><code>setImmediate(function(){
    console.log(1);
},0);
setTimeout(function(){
    console.log(2);
},0);
new Promise(function(resolve){
    console.log(3);
    resolve();
    console.log(4);
}).then(function(){
    console.log(5);
});
console.log(6);
process.nextTick(function(){
    console.log(7);
});
console.log(8);
ç»“æœæ˜¯ï¼š3 4 6 8 7 5 2 1 
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/30/æ·±å…¥ç†è§£ES6  Async Functions/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/30/æ·±å…¥ç†è§£ES6  Async Functions/" itemprop="url">æ·±å…¥ç†è§£ES6 Async Functions (å¼‚æ­¥å‡½æ•°)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-05-30T18:35:10+08:00">
                2018-05-30
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><h2 id="async-å¼‚æ­¥-å‡½æ•°å˜ä½“"><a href="#async-å¼‚æ­¥-å‡½æ•°å˜ä½“" class="headerlink" title="async(å¼‚æ­¥) å‡½æ•°å˜ä½“"></a>async(å¼‚æ­¥) å‡½æ•°å˜ä½“</h2><p>ä»¥ä¸‹æ˜¯å·²ç»å­˜åœ¨çš„å¼‚æ­¥å‡½æ•°å˜ä½“ã€‚è¯·æ³¨æ„æ— å¤„ä¸åœ¨çš„ <code>async</code> å…³é”®å­—ã€‚</p>
<ul>
<li>å¼‚æ­¥å‡½æ•°å£°æ˜ï¼š <code>async function foo() {}</code></li>
<li>å¼‚æ­¥å‡½æ•°è¡¨è¾¾å¼ï¼š <code>const foo = async function () {};</code></li>
<li>å¼‚æ­¥å‡½æ•°å®šä¹‰ï¼š<code>let obj = { async foo() {} }</code></li>
<li>å¼‚æ­¥ç®­å¤´å‡½æ•°ï¼š <code>const foo = async () =&gt; {};</code></li>
</ul>
<h2 id="async-å¼‚æ­¥-å‡½æ•°æ€»æ˜¯è¿”å›-Promises"><a href="#async-å¼‚æ­¥-å‡½æ•°æ€»æ˜¯è¿”å›-Promises" class="headerlink" title="async(å¼‚æ­¥) å‡½æ•°æ€»æ˜¯è¿”å› Promises"></a>async(å¼‚æ­¥) å‡½æ•°æ€»æ˜¯è¿”å› Promises</h2><p>async(å¼‚æ­¥) å‡½æ•°çš„ Promise å®ŒæˆçŠ¶æ€ï¼š</p>
<pre><code>async function asyncFunc() {
return 123;
}

asyncFunc()
.then(x =&gt; console.log(x));
// 123
</code></pre><p>async(å¼‚æ­¥) å‡½æ•°çš„ Promise æ‹’ç»çŠ¶æ€ï¼š</p>
<pre><code>async function asyncFunc() {
throw new Error(&apos;Problem!&apos;);
}

asyncFunc()
.catch(err =&gt; console.log(err));
// Error: Problem!
</code></pre><h2 id="é€šè¿‡-await-å¤„ç†-async-å¼‚æ­¥-è®¡ç®—çš„ç»“æœå’Œé”™è¯¯"><a href="#é€šè¿‡-await-å¤„ç†-async-å¼‚æ­¥-è®¡ç®—çš„ç»“æœå’Œé”™è¯¯" class="headerlink" title="é€šè¿‡ await å¤„ç† async(å¼‚æ­¥) è®¡ç®—çš„ç»“æœå’Œé”™è¯¯"></a>é€šè¿‡ <code>await</code> å¤„ç† async(å¼‚æ­¥) è®¡ç®—çš„ç»“æœå’Œé”™è¯¯</h2><p><code>await</code>ï¼ˆåªå…è®¸åœ¨ async(å¼‚æ­¥) å‡½æ•°å†…éƒ¨ä½¿ç”¨ï¼‰ç­‰å¾…å…¶æ“ä½œå¯¹è±¡ Promise è¿”å›ï¼š</p>
<ul>
<li>å¦‚æœ Promise æ˜¯å®ŒæˆçŠ¶æ€ï¼Œ<code>await</code> çš„ç»“æœæ˜¯å®Œæˆæ€çš„å€¼ã€‚</li>
<li>å¦‚æœ Promise æ˜¯æ‹’ç»çŠ¶æ€ï¼Œ<code>await</code> ä¼šæŠ›å‡ºæ‹’ç»å€¼ã€‚</li>
</ul>
<p>å¤„ç†å•ä¸ª async(å¼‚æ­¥) è¿”å›å€¼ï¼š</p>
<pre><code>async function asyncFunc() {
const result = await otherAsyncFunc();
   console.log(result);
}

// ç­‰ä»·äº:
function asyncFunc() {
return otherAsyncFunc()
.then(result =&gt; {
       console.log(result);
});
}
</code></pre><p>æŒ‰é¡ºåºå¤„ç†å¤šä¸ª async(å¼‚æ­¥) è¿”å›å€¼ï¼š</p>
<pre><code>async function asyncFunc() {
const result1 = await otherAsyncFunc1();
   console.log(result1);
const result2 = await otherAsyncFunc2();
   console.log(result2);
}

// ç­‰ä»·äº:
function asyncFunc() {
return otherAsyncFunc1()
.then(result1 =&gt; {
       console.log(result1);
return otherAsyncFunc2();
})
.then(result2 =&gt; {
       console.log(result2);
});
}
</code></pre><p>å¹¶è¡Œå¤„ç†å¤šä¸ª async(å¼‚æ­¥) è¿”å›å€¼ï¼š</p>
<pre><code>async function asyncFunc() {
const [result1, result2] = await Promise.all([
       otherAsyncFunc1(),
       otherAsyncFunc2(),
]);
   console.log(result1, result2);
}

// ç­‰ä»·äº:
function asyncFunc() {
return Promise.all([
       otherAsyncFunc1(),
       otherAsyncFunc2(),
])
.then([result1, result2] =&gt; {
       console.log(result1, result2);
});
}
</code></pre><p>é”™è¯¯å¤„ç†ï¼š</p>
<pre><code>async function asyncFunc() {
try {
await otherAsyncFunc();
} catch (err) {
       console.error(err);
}
}

// ç­‰ä»·äº:
function asyncFunc() {
return otherAsyncFunc()
.catch(err =&gt; {
       console.error(err);
});
}
</code></pre><h2 id="ç†è§£-async-å¼‚æ­¥-å‡½æ•°"><a href="#ç†è§£-async-å¼‚æ­¥-å‡½æ•°" class="headerlink" title="ç†è§£ async(å¼‚æ­¥) å‡½æ•°"></a>ç†è§£ async(å¼‚æ­¥) å‡½æ•°</h2><p>åœ¨æˆ‘è§£é‡Š async(å¼‚æ­¥) å‡½æ•°ä¹‹å‰ï¼Œæˆ‘éœ€è¦è§£é‡Šä¸€ä¸‹å¦‚ä½•ç»„åˆä½¿ç”¨ Promises å’Œ Generator ï¼Œé€šè¿‡çœ‹èµ·æ¥åŒæ­¥çš„ä»£ç æ¥æ‰§è¡Œ async(å¼‚æ­¥) æ“ä½œã€‚</p>
<p>å¯¹äºèƒ½å¤Ÿ async(å¼‚æ­¥) è®¡ç®—å…¶ä¸€æ¬¡æ€§ç»“æœçš„å‡½æ•°ï¼Œä½œä¸º ES6 ä¸€éƒ¨åˆ†çš„ Promises å·²ç»å˜å¾—æµè¡Œèµ·æ¥ã€‚ä¸€ä¸ªä¾‹å­æ˜¯ <a href="https://link.zhihu.com/?target=https%3A//fetch.spec.whatwg.org/%23concept-request" target="_blank" rel="noopener">å®¢æˆ·ç«¯ fetch API</a> ï¼Œå®ƒæ˜¯ XMLHttpRequest è·å–æ•°æ®çš„æ›¿ä»£æ–¹æ³•ã€‚ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<pre><code>function fetchJson(url) {
return fetch(url)
.then(request =&gt; request.text())
.then(text =&gt; {
return JSON.parse(text);
})
.catch(error =&gt; {
       console.log(`ERROR: ${error.stack}`);
});
}
fetchJson(&apos;http://example.com/some_file.json&apos;)
.then(obj =&gt; console.log(obj));
</code></pre><h2 id="é€šè¿‡-generator-æ¥ç¼–å†™å¼‚æ­¥ä»£ç "><a href="#é€šè¿‡-generator-æ¥ç¼–å†™å¼‚æ­¥ä»£ç " class="headerlink" title="é€šè¿‡ generator æ¥ç¼–å†™å¼‚æ­¥ä»£ç "></a>é€šè¿‡ generator æ¥ç¼–å†™å¼‚æ­¥ä»£ç </h2><p>co æ˜¯ä¸€ä¸ªä½¿ç”¨ Promise å’Œ generator æ¥å®ç°çœ‹ä¼¼åŒæ­¥ç¼–ç çš„åº“ï¼Œä½†ä¸ä¸Šä¸€ç¤ºä¾‹ä¸­ä½¿ç”¨çš„æ ·å¼ç›¸åŒï¼š</p>
<pre><code>const fetchJson = co.wrap(function* (url) {
try {
let request = yield fetch(url);
let text = yield request.text();
return JSON.parse(text);
}
catch (error) {
       console.log(`ERROR: ${error.stack}`);
}
});
</code></pre><p>æ¯æ¬¡å›è°ƒå‡½æ•°ï¼ˆ generator å‡½æ•°ï¼‰äº§ç”Ÿä¸€ä¸ª Promise å¯¹è±¡ç»™ co ï¼Œå›è°ƒä¼šè¢«æš‚åœï¼Œåªæœ‰å½“ Promise æ‰§è¡Œå®Œæˆåï¼Œco æ‰ä¼šç»§ç»­æ‰§è¡Œå›è°ƒ ã€‚ å¦‚æœ Promise å¤„äºå®ŒæˆçŠ¶æ€ï¼Œ<code>yield</code> è¿”å›å®ŒæˆçŠ¶æ€çš„å€¼ï¼Œå¦‚æœå¤„äºæ‹’ç»çŠ¶æ€ï¼Œ<code>yield</code> æŠ›å‡ºæ‹’ç»çŠ¶æ€çš„é”™è¯¯ã€‚æ­¤å¤–ï¼Œco ä¿è¯ç»“æœæ˜¯é€šè¿‡å›è°ƒæ‰§è¡Œå®Œæˆæ‰è¿”å›çš„ï¼ˆç±»ä¼¼äº <code>then()</code> æ‰€åšçš„å·¥ä½œï¼‰ã€‚</p>
<h2 id="é€šè¿‡-async-å¼‚æ­¥-å‡½æ•°æ¥ç¼–å†™å¼‚æ­¥ä»£ç "><a href="#é€šè¿‡-async-å¼‚æ­¥-å‡½æ•°æ¥ç¼–å†™å¼‚æ­¥ä»£ç " class="headerlink" title="é€šè¿‡ async(å¼‚æ­¥) å‡½æ•°æ¥ç¼–å†™å¼‚æ­¥ä»£ç "></a>é€šè¿‡ async(å¼‚æ­¥) å‡½æ•°æ¥ç¼–å†™å¼‚æ­¥ä»£ç </h2><p>async(å¼‚æ­¥) å‡½æ•°ç”¨çš„ç‰¹å®šè¯­æ³•åŸºæœ¬ä¸Šå’Œ co ç±»ä¼¼ï¼š</p>
<pre><code>async function fetchJson(url) {
try {
let request = await fetch(url);
let text = await request.text();
return JSON.parse(text);
}
catch (error) {
       console.log(`ERROR: ${error.stack}`);
}
}
</code></pre><p>åœ¨å†…éƒ¨ï¼Œå¼‚æ­¥å‡½æ•°å†™æ³•æ›´ç±»ä¼¼äº generators ã€‚</p>
<h2 id="ä»¥åŒæ­¥å¼€å§‹ï¼Œå¼‚æ­¥å¤„ç†çš„-async-å¼‚æ­¥-å‡½æ•°"><a href="#ä»¥åŒæ­¥å¼€å§‹ï¼Œå¼‚æ­¥å¤„ç†çš„-async-å¼‚æ­¥-å‡½æ•°" class="headerlink" title="ä»¥åŒæ­¥å¼€å§‹ï¼Œå¼‚æ­¥å¤„ç†çš„ async(å¼‚æ­¥) å‡½æ•°"></a>ä»¥åŒæ­¥å¼€å§‹ï¼Œå¼‚æ­¥å¤„ç†çš„ async(å¼‚æ­¥) å‡½æ•°</h2><p>ä»¥ä¸‹æ˜¯ async(å¼‚æ­¥)å‡½æ•°æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼š</p>
<ol>
<li>async(å¼‚æ­¥) å‡½æ•°æ€»æ˜¯è¿”å›ä¸€ä¸ª Promise å¯¹è±¡ <code>p</code> ã€‚Promise å¯¹è±¡åœ¨ async(å¼‚æ­¥) å‡½æ•°å¼€å§‹æ‰§è¡Œæ—¶è¢«åˆ›å»ºã€‚</li>
<li>å‡½æ•°ä½“æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯ä»¥é€šè¿‡ <code>return</code> æˆ– <code>throw</code> ç»ˆæ­¢æ‰§è¡Œã€‚æˆ–è€…é€šè¿‡ <code>await</code> æš‚åœæ‰§è¡Œï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé€šå¸¸ä¼šåœ¨ä»¥åç»§ç»­æ‰§è¡Œã€‚</li>
<li>è¿”å› Promise å¯¹è±¡ <code>p</code>ã€‚</li>
</ol>
<p>å½“æ‰§è¡Œ async(å¼‚æ­¥) å‡½æ•°çš„å‡½æ•°ä½“æ—¶ï¼Œ<code>return x</code> ä¸­çš„ <code>x</code> æ˜¯ Promise å¯¹è±¡ <code>p</code> çš„å®ŒæˆçŠ¶æ€çš„ç»“æœï¼Œè€Œ <code>throw err</code> æ˜¯ <code>p</code> çš„æ‹’ç»çŠ¶æ€çš„ç»“æœã€‚æ‰§è¡Œç»“æœæ˜¯å¼‚æ­¥è¿”å›çš„ã€‚æ¢å¥è¯è¯´ï¼š<code>then()</code> å’Œ <code>catch()</code> çš„å›è°ƒæ€»æ˜¯åœ¨å½“å‰ä»£ç å®Œæˆåæ‰§è¡Œã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä»£ç ç¤ºä¾‹ï¼š</p>
<pre><code>async function asyncFunc() {
   console.log(&apos;asyncFunc()&apos;); // (A)
return &apos;abc&apos;;
}
asyncFunc().
then(x =&gt; console.log(`Resolved: ${x}`)); // (B)
console.log(&apos;main&apos;); // (C)

// Output:
// asyncFunc()
// main
// Resolved: abc
</code></pre><p>æ‚¨å¯ä»¥è®¤ä¸ºæ˜¯ä»¥ä¸‹çš„æ‰§è¡Œé¡ºåºï¼š</p>
<ol>
<li>è¡ŒAï¼šasync(å¼‚æ­¥) å‡½æ•°ä»¥åŒæ­¥å¼€å§‹ã€‚async(å¼‚æ­¥) å‡½æ•°çš„ Promise é€šè¿‡ <code>return</code> æ¥è¿”å›å®ŒæˆçŠ¶æ€çš„ç»“æœã€‚</li>
<li>è¡ŒCï¼šæ‰§è¡Œç»§ç»­ã€‚</li>
<li>è¡ŒBï¼šPromise å®ŒæˆçŠ¶æ€é€šçŸ¥æ˜¯å¼‚æ­¥å‘ç”Ÿçš„ã€‚</li>
</ol>
<h2 id="è¿”å›ä¸è¢«åŒ…è£¹çš„-Promise-å¯¹è±¡"><a href="#è¿”å›ä¸è¢«åŒ…è£¹çš„-Promise-å¯¹è±¡" class="headerlink" title="è¿”å›ä¸è¢«åŒ…è£¹çš„ Promise å¯¹è±¡"></a>è¿”å›ä¸è¢«åŒ…è£¹çš„ Promise å¯¹è±¡</h2><p>Promise çš„ resolve æ˜¯ä¸€é¡¹æ ‡å‡†æ“ä½œã€‚ <code>return</code> å°±æ˜¯ä½¿ç”¨å®ƒæ¥ resolve async(å¼‚æ­¥) å‡½æ•°çš„ Promise <code>p</code> çš„ã€‚è¿™æ„å‘³ç€ï¼š</p>
<ol>
<li>è¿”å›ä¸€ä¸ªé Promise å€¼ï¼Œè¯¥å€¼å°†è¢«å¤„ç†æˆ <code>p</code> çš„å®ŒæˆçŠ¶æ€å€¼ã€‚</li>
<li>è¿”å›ä¸€ä¸ª Promise å¯¹è±¡ï¼Œé‚£ä¹ˆ <code>p</code> æ­¤æ—¶ç›¸å½“äºæ˜¯è¯¥ Promise çš„çŠ¶æ€ã€‚</li>
</ol>
<p>å› æ­¤ï¼Œæ‚¨å¯ä»¥è¿”å›ä¸€ä¸ª Promise ï¼Œå¹¶ä¸”è¿™ä¸ª Promise ä¸ä¼šåŒ…è£¹åœ¨åˆ«çš„ Promise ä¸­ï¼š</p>
<pre><code>async function asyncFunc() {
return Promise.resolve(123);
}
asyncFunc()
.then(x =&gt; console.log(x)) // 123
</code></pre><p>æœ‰è¶£çš„æ˜¯ï¼Œè¿”å›ä¸€ä¸ªæ‹’ç»çŠ¶æ€ï¼ˆrejectï¼‰çš„ Promise å¯¹è±¡ä¼šå¯¼è‡´ async(å¼‚æ­¥) å‡½æ•°è¢«æ‹’ç»ï¼ˆrejectï¼‰ï¼ˆé€šå¸¸ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <code>throw</code> ï¼‰ï¼š</p>
<pre><code>async function asyncFunc() {
return Promise.reject(new Error(&apos;Problem!&apos;));
}
asyncFunc()
.catch(err =&gt; console.error(err)); // Error: Problem!
</code></pre><p>è¿™ä¸ Promise è§£å†³æ–¹æ¡ˆçš„å·¥ä½œæ–¹å¼æ˜¯ä¸€è‡´çš„ã€‚ ä½¿ä½ èƒ½å¤Ÿåœ¨ä¸ä½¿ç”¨ <code>await</code> çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨å…¶ä»– async(å¼‚æ­¥) è®¡ç®—æ¥æ‰§è¡Œå®Œæˆå’Œæ‹’ç»å¤„ç†ï¼š</p>
<pre><code>async function asyncFunc() {
return anotherAsyncFunc();
}
</code></pre><p>ä¸Šé¢çš„ä»£ç ç¤ºä¾‹å’Œä¸‹é¢çš„ç±»ä¼¼ï¼Œä½†æ˜¯æ¯”ä¸‹é¢çš„æ›´é«˜æ•ˆã€‚ï¼ˆä»¥ä¸‹ä»£ç ç¤ºä¾‹æ²¡æœ‰åŒ…è£¹ <code>anotherAsyncFunc()</code> çš„ Promise ï¼Œè€Œæ˜¯åŒ…è£¹ <code>anotherAsyncFunc()</code> æœ¬èº« ï¼‰ï¼š</p>
<pre><code>async function asyncFunc() {
return await anotherAsyncFunc();
}
</code></pre><h2 id="ä½¿ç”¨-await-å°è´´å£«"><a href="#ä½¿ç”¨-await-å°è´´å£«" class="headerlink" title="ä½¿ç”¨ await å°è´´å£«"></a>ä½¿ç”¨ <code>await</code> å°è´´å£«</h2><h2 id="ä¸è¦å¿˜è®°ä½¿ç”¨-await"><a href="#ä¸è¦å¿˜è®°ä½¿ç”¨-await" class="headerlink" title="ä¸è¦å¿˜è®°ä½¿ç”¨ await"></a>ä¸è¦å¿˜è®°ä½¿ç”¨ <code>await</code></h2><p>åœ¨ async(å¼‚æ­¥) å‡½æ•°ä¸­å®¹æ˜“çŠ¯çš„ä¸€ä¸ªé”™è¯¯å°±æ˜¯åœ¨è°ƒç”¨ async(å¼‚æ­¥) å‡½æ•°æ—¶å¿˜è®°ä½¿ç”¨ <code>await</code> ï¼š</p>
<pre><code>async function asyncFunc() {
const value = otherAsyncFunc(); // missing `await`!
Â·Â·Â·
}
</code></pre><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ–¹æ³•æ‰§è¡Œè¿”å›çš„ Promise å¯¹è±¡èµ‹å€¼ç»™äº† <code>value</code> ï¼Œå®ƒé€šå¸¸ä¸æ˜¯ä½ åœ¨ async(å¼‚æ­¥) å‡½æ•°ä¸­æƒ³è¦çš„ç»“æœã€‚</p>
<p>await ç”šè‡³å¯ä»¥åœ¨ async(å¼‚æ­¥) å‡½æ•°ä¸è¿”å›ä»»ä½•å€¼çš„æƒ…å†µä¸‹èµ·ä½œç”¨ã€‚å®ƒçš„ Promise åªæ˜¯ç”¨æ¥å‘Šè¯‰è°ƒç”¨è€…å®ŒæˆçŠ¶æ€ã€‚ä¾‹å¦‚ï¼š</p>
<pre><code>async function foo() {
await step1(); // (A)
Â·Â·Â·
}
</code></pre><p>è¡ŒAä¸­çš„ <code>await</code> ç¡®ä¿åœ¨æ‰§è¡Œ <code>foo()</code> å‰©ä½™éƒ¨åˆ†ä¹‹å‰ï¼Œ <code>step1()</code> å·²ç»æ‰§è¡Œå®Œæˆã€‚</p>
<h2 id="ä¸éœ€è¦ä½¿ç”¨-await-çš„æƒ…å†µ"><a href="#ä¸éœ€è¦ä½¿ç”¨-await-çš„æƒ…å†µ" class="headerlink" title="ä¸éœ€è¦ä½¿ç”¨ await çš„æƒ…å†µ"></a>ä¸éœ€è¦ä½¿ç”¨ await çš„æƒ…å†µ</h2><p>æœ‰æ—¶ï¼Œä½ åªæƒ³è§¦å‘å¼‚æ­¥è®¡ç®—ï¼Œå¹¶ä¸”ä¸éœ€è¦å…³æ³¨å®ƒä»€ä¹ˆæ—¶å€™å®Œæˆã€‚ä»¥ä¸‹æ˜¯ä»£ç ç¤ºä¾‹ï¼š</p>
<pre><code>async function asyncFunc() {
const writer = openFile(&apos;someFile.txt&apos;);
   writer.write(&apos;hello&apos;); // donâ€™t wait
   writer.write(&apos;world&apos;); // donâ€™t wait
await writer.close(); // wait for file to close
}
</code></pre><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¸å…³å¿ƒå•ä¸ªçš„å†™å…¥æ“ä½œæ˜¯å¦å®Œæˆï¼Œåªéœ€è¦ä»–ä»¬ä»¥æ­£ç¡®çš„é¡ºåºæ‰§è¡Œ (APIå¿…é¡»ä¿è¯ï¼Œä½†è¿™æ˜¯ç”± async(å¼‚æ­¥) å‡½æ•°çš„æ‰§è¡Œæ¨¡å‹æ‰€é¼“åŠ±çš„ï¼Œæ­£å¦‚æˆ‘ä»¬æ‰€è§)ã€‚</p>
<p><code>asyncFunc()</code> å‡½æ•°æœ€åä¸€è¡Œçš„ <code>await</code> ç¡®ä¿è¯¥å‡½æ•°ä»…åœ¨æ–‡ä»¶å†™å…¥å…³é—­åæ‰ä¼šæ‰§è¡Œã€‚</p>
<p>ç”±äºè¿”å›çš„ Promises æ²¡æœ‰è¢«å…¶ä»– async(å¼‚æ­¥) å‡½æ•°åŒ…è£¹ï¼Œæ‰€ä»¥ä½ å¯ä»¥ç”¨ <code>return</code> æ›¿æ¢ <code>await writer.close()</code> ï¼š</p>
<pre><code>async function asyncFunc() {
const writer = openFile(&apos;someFile.txt&apos;);
   writer.write(&apos;hello&apos;);
   writer.write(&apos;world&apos;);
return writer.close();
}
</code></pre><p>è¿™ä¸¤ä¸ªç‰ˆæœ¬å„æœ‰åˆ©å¼Šï¼Œ<code>await</code> ç‰ˆæœ¬å¯èƒ½ç¨å¾®æ›´å®¹æ˜“ç†è§£ã€‚</p>
<h2 id="await-æ˜¯é¡ºåºæ‰§è¡Œçš„ï¼ŒPromise-all-æ˜¯å¹¶è¡Œçš„"><a href="#await-æ˜¯é¡ºåºæ‰§è¡Œçš„ï¼ŒPromise-all-æ˜¯å¹¶è¡Œçš„" class="headerlink" title="await æ˜¯é¡ºåºæ‰§è¡Œçš„ï¼ŒPromise.all() æ˜¯å¹¶è¡Œçš„"></a>await æ˜¯é¡ºåºæ‰§è¡Œçš„ï¼ŒPromise.all() æ˜¯å¹¶è¡Œçš„</h2><p>ä¸‹é¢çš„ä»£ç è°ƒç”¨äº†ä¸¤ä¸ª async(å¼‚æ­¥) å‡½æ•°ï¼Œ <code>asyncFunc1()</code> å’Œ <code>asyncFunc1()</code> ã€‚</p>
<pre><code>async function foo() {
const result1 = await asyncFunc1();
const result2 = await asyncFunc2();
}
</code></pre><p>è¿™ä¸¤ä¸ªå‡½æ•°è°ƒç”¨é¡ºåºæ‰§è¡Œã€‚ä½†æ˜¯å¹¶è¡Œæ‰§è¡Œå®ƒä»¬å¾€å¾€ä¼šåŠ å¿«é€Ÿåº¦ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ Promise.all() ï¼š</p>
<pre><code>async function foo() {
const [result1, result2] = await Promise.all([
       asyncFunc1(),
       asyncFunc2(),
]);
}
</code></pre><p>æˆ‘ä»¬ç°åœ¨æ­£åœ¨ç­‰å¾…ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªå…ƒç´ çš„æ•°ç»„çš„ Promise ï¼Œè€Œä¸æ˜¯ç­‰å¾…ä¸¤ä¸ª Promiseã€‚</p>
<h2 id="å¼‚æ­¥å‡½æ•°å’Œå›è°ƒ"><a href="#å¼‚æ­¥å‡½æ•°å’Œå›è°ƒ" class="headerlink" title="å¼‚æ­¥å‡½æ•°å’Œå›è°ƒ"></a>å¼‚æ­¥å‡½æ•°å’Œå›è°ƒ</h2><p>async(å¼‚æ­¥) å‡½æ•°çš„ä¸€ä¸ªé™åˆ¶æ˜¯ <code>await</code>(ç­‰å¾…) åªå½±å“ç›´æ¥ç›¸å…³çš„ async(å¼‚æ­¥) å‡½æ•°ã€‚å› æ­¤ï¼Œasync(å¼‚æ­¥) å‡½æ•°æ— æ³•åœ¨å›è°ƒï¼ˆä½†æ˜¯ï¼Œå›è°ƒå¯ä»¥æ˜¯ async(å¼‚æ­¥) å‡½æ•°æœ¬èº«ï¼Œç¨åæˆ‘ä»¬å°†ä¼šçœ‹åˆ°ï¼‰ä¸­ä½¿ç”¨ <code>await</code>(ç­‰å¾…)ã€‚è¿™ä½¿å¾—åŸºäºå›è°ƒçš„å®ç”¨å‡½æ•°å’Œæ–¹æ³•éš¾ä»¥ä½¿ç”¨ã€‚ä¾‹å­ä¸­æˆ‘ä»¬å°†ä½¿ç”¨æ•°ç»„æ–¹æ³• <code>map()</code> å’Œ <code>forEach()</code>ã€‚</p>
<h2 id="Array-prototype-map"><a href="#Array-prototype-map" class="headerlink" title="Array.prototype.map()"></a>Array.prototype.map()</h2><p>æˆ‘ä»¬ä»æ•°ç»„æ–¹æ³• <code>map()</code> å¼€å§‹è®²è§£ã€‚åœ¨ä¸‹é¢çš„ä»£ç ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬æƒ³è¦åŠ è½½ç”± URLs æ•°ç»„æŒ‡å‘çš„æ–‡ä»¶ï¼Œå¹¶å°†å®ƒä»¬è¿”å›åˆ°æ•°ç»„ä¸­ã€‚</p>
<pre><code>async function downloadContent(urls) {
return urls.map(url =&gt; {
// é”™è¯¯çš„è¯­æ³•!
const content = await httpGet(url);
return content;
});
}
</code></pre><p>è¿™ä¸èµ·ä½œç”¨ï¼Œå› ä¸ºåœ¨æ­£å¸¸ç®­å¤´å‡½æ•°ä¸­ <code>await</code> è¯­æ³•ä¸Šæ˜¯éæ³•çš„(æ„šäººç å¤´æ³¨ï¼š <code>await</code>(ç­‰å¾…) åªå½±å“ç›´æ¥ç›¸å…³çš„ async(å¼‚æ­¥) å‡½æ•°)ã€‚é‚£ä¹ˆå¦‚ä½•ä½¿ç”¨å¼‚æ­¥çš„ç®­å¤´å‡½æ•°å‘¢ï¼Ÿ</p>
<pre><code>async function downloadContent(urls) {
return urls.map(async (url) =&gt; { // æ³¨æ„è¿™ä¸€è¡Œä¸­çš„ async ;
const content = await httpGet(url);
return content;
});
}
</code></pre><p>è¿™æ®µä»£ç æœ‰ä¸¤ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>ç°åœ¨è¿”å›çš„ç»“æœæ˜¯ä¸€ä¸ª Promises å¯¹è±¡çš„æ•°ç»„ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²çš„æ•°ç»„ã€‚</li>
<li>ä¸€æ—¦ <code>map()</code> æ‰§è¡Œå®Œæˆï¼Œå›è°ƒæ‰§è¡Œçš„å·¥ä½œå¹¶ä¸èƒ½åŒæ—¶å®Œæˆï¼Œå› ä¸º <code>await</code> åªæš‚åœäº†åŒ…è£¹å®ƒçš„ç®­å¤´å‡½æ•° å’Œ <code>httpGet()</code> å¼‚æ­¥æ‰§è¡Œè¾¾åˆ°å®ŒæˆçŠ¶æ€ã€‚è¿™æ„å‘³ç€ä½ ä¸èƒ½ä½¿ç”¨ <code>await</code>ï¼Œæ¥ç­‰å¾… <code>downloadContent()</code> æ‰§è¡Œç»“æŸã€‚</li>
</ul>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>Promise.all()</code> æ¥è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œ<code>Promise.all()</code> å¯ä»¥å°†ä¸€ç³»åˆ—çš„ Promise è½¬æ¢ä¸ºä¸€ä¸ª Promise æ•°ç»„ï¼ˆæ‰€æœ‰å€¼éƒ½æ˜¯ç»è¿‡ Promise å®Œæˆå¹¶è¿”å›ï¼‰ï¼š</p>
<pre><code>async function downloadContent(urls) {
const promiseArray = urls.map(async (url) =&gt; {
const content = await httpGet(url);
return content;
});
return await Promise.all(promiseArray);
}
</code></pre><p><code>map()</code> çš„å›è°ƒå¹¶ä¸å¯¹ <code>httpGet()</code> çš„ç»“æœèµ·ä½œç”¨ï¼Œåªæ˜¯èµ·åˆ°ä¸æ–­æ‰§è¡Œçš„ä½œç”¨ã€‚å› æ­¤ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸éœ€è¦ä¸€ä¸ªå¼‚æ­¥çš„ç®­å¤´å‡½æ•°ï¼Œåªéœ€è¦ä¸€ä¸ªæ™®é€šçš„ç®­å¤´å‡½æ•°å°±èƒ½è¾¾åˆ°ç›¸åŒçš„ç»“æœã€‚</p>
<pre><code>async function downloadContent(urls) {
const promiseArray = urls.map(
       url =&gt; httpGet(url));
return await Promise.all(promiseArray);
}
</code></pre><p>æˆ‘ä»¬ä»ç„¶å¯ä»¥åšä¸€ä¸ªå°çš„æ”¹è¿›ï¼šè¿™ä¸ªå¼‚æ­¥å‡½æ•°ç¨å¾®æœ‰ç‚¹ä½æ•ˆ â€“ é¦–å…ˆé€šè¿‡ <code>await</code> æ¥è§£å¼€ <code>Promise.all()</code> çš„ç»“æœï¼Œç„¶åé€šè¿‡ <code>return</code> å†æ¬¡åŒ…è£¹å®ƒã€‚ å‡è®¾ <code>return</code> ä¸åŒ…è£¹ Promisesï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è¿”å› <code>Promise.all()</code> çš„ç»“æœï¼š</p>
<pre><code>async function downloadContent(urls) {
const promiseArray = urls.map(
       url =&gt; httpGet(url));
return Promise.all(promiseArray);
}
</code></pre><h2 id="Array-prototype-forEach"><a href="#Array-prototype-forEach" class="headerlink" title="Array.prototype.forEach()"></a>Array.prototype.forEach()</h2><p>æˆ‘ä»¬ä½¿ç”¨æ•°ç»„çš„ forEach() æ–¹æ³•åœ¨æ§åˆ¶å°ä¸­æ‰“å°å‡ ä¸ªé€šè¿‡ URLs åŠ è½½çš„æ–‡ä»¶çš„å†…å®¹ï¼š</p>
<pre><code>async function logContent(urls) {
   urls.forEach(url =&gt; {
// Wrong syntax
const content = await httpGet(url);
       console.log(content);
});
}
</code></pre><p>åŒæ ·çš„ï¼Œè¿™é‡Œçš„ä»£ç ä¼šäº§ç”Ÿä¸€ä¸ªè¯­æ³•é”™è¯¯ï¼Œå› ä¸ºä½ ä¸èƒ½åœ¨é€šå¸¸çš„ç®­å¤´å‡½æ•°å†…éƒ¨ä½¿ç”¨ <code>await</code> ã€‚</p>
<p>æˆ‘ä»¬æ¢ä½œå¼‚æ­¥ç®­å¤´å‡½æ•°ï¼š</p>
<pre><code>async function logContent(urls) {
   urls.forEach(async url =&gt; {
const content = await httpGet(url);
       console.log(content);
});
// Not finished here
}
</code></pre><p>è¿™æ®µä»£ç èµ·ä½œç”¨äº†ï¼Œä½†æ˜¯ä¼šå‡ºç°ä¸€ä¸ªè­¦å‘Šï¼š<code>httpGet()</code> è¿”å›çš„ Promise å¯¹è±¡æ˜¯å¼‚æ­¥å®Œæˆçš„ï¼Œè¿™ä¹Ÿæ„å‘³ç€å½“ <code>forEach()</code> è¿”å›çš„æ—¶å€™å›è°ƒå¯èƒ½è¿˜æ²¡æœ‰ç»“æŸï¼Œå› æ­¤ä½ æ— æ³•ç­‰åˆ° <code>logContent()</code> åªèƒ½ç»“æŸã€‚</p>
<p>å¦‚æœä½ å¹¶ä¸æƒ³è¦è¿™ä¸ªç»“æœï¼Œä½ å¯ä»¥å°† <code>forEach()</code> è½¬æ¢ä¸º <code>for-of</code> å¾ªç¯ã€‚</p>
<pre><code>async function logContent(urls) {
for (const url of urls) {
const content = await httpGet(url);
       console.log(content);
}
}
</code></pre><p>ç°åœ¨ä¸€åˆ‡éƒ½åœ¨ <code>for-of</code> å¾ªç¯å®Œæˆåå®Œæˆã€‚ä½†æ˜¯ï¼Œå¤„ç†æ­¥éª¤ä¾æ¬¡å‘ç”Ÿï¼š<code>httpGet()</code> åªæ˜¯åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨å®Œæˆåå†æ¬¡è°ƒç”¨ã€‚å¦‚æœæ‚¨å¸Œæœ›å¤„ç†æ­¥éª¤å¹¶è¡Œæ‰§è¡Œï¼Œä½ å¿…é¡»ä½¿ç”¨ <code>Promise.all()</code>ï¼š</p>
<pre><code>async function logContent(urls) {
await Promise.all(urls.map(
async url =&gt; {
const content = await httpGet(url);
           console.log(content);
}));
}
</code></pre><p><code>map()</code> ç”¨äºåˆ›å»ºä¸€ä¸ª Promises æ•°ç»„ã€‚ æˆ‘ä»¬å¯¹ä»–ä»¬çš„å®Œæˆç»“æœå¹¶ä¸æ„Ÿå…´è¶£ï¼Œæˆ‘ä»¬åªè¦ <code>await</code>(ç­‰å¾…) æ‰€æœ‰æ–¹æ³•æ‰§è¡Œå®Œæˆã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¸Œæœ›çš„æ˜¯åœ¨ async(å¼‚æ­¥) å‡½æ•°å®Œæˆä¹‹åæ‰€æœ‰çš„æ‰§è¡Œéƒ½å·²ç»å®Œæˆã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥è¿”å› <code>Promise.all()</code> ï¼Œä½†æ˜¯è¯¥å‡½æ•°çš„ç»“æœæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå…¶å…ƒç´ éƒ½æ˜¯æœªå®ŒæˆçŠ¶æ€çš„ã€‚</p>
<h2 id="ä½¿ç”¨å¼‚æ­¥å‡½æ•°å°è´´å£«"><a href="#ä½¿ç”¨å¼‚æ­¥å‡½æ•°å°è´´å£«" class="headerlink" title="ä½¿ç”¨å¼‚æ­¥å‡½æ•°å°è´´å£«"></a>ä½¿ç”¨å¼‚æ­¥å‡½æ•°å°è´´å£«</h2><h2 id="äº†è§£ä½ çš„-Promises"><a href="#äº†è§£ä½ çš„-Promises" class="headerlink" title="äº†è§£ä½ çš„ Promises"></a>äº†è§£ä½ çš„ Promises</h2><p>async(å¼‚æ­¥) å‡½æ•°çš„åŸºç¡€å°±æ˜¯ <a href="https://link.zhihu.com/?target=http%3A//exploringjs.com/es6/ch_promises.html" target="_blank" rel="noopener">Promises</a> å¯¹è±¡ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆç†è§£ Promises å¯¹äºç†è§£ async(å¼‚æ­¥) å‡½æ•°è‡³å…³é‡è¦ã€‚ç‰¹åˆ«æ˜¯å½“é‡åˆ°ä¸æ˜¯åŸºäº Promises çš„è€ä»£ç æ¥å®ç° async(å¼‚æ­¥) å‡½æ•°æ—¶ï¼Œä½ é€šå¸¸åˆ«æ— é€‰æ‹©ï¼Œåªèƒ½ç”¨ Promise æ¥é‡æ„ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œè¿™é‡Œæœ‰ä¸ª â€œpromisifiedâ€ ç‰ˆæœ¬çš„ <code>XMLHttpRequest</code> ï¼š</p>
<pre><code>function httpGet(url, responseType=&quot;&quot;) {
return new Promise(
function (resolve, reject) {
const request = new XMLHttpRequest();
           request.onload = function () {
if (this.status === 200) {
// Success
                   resolve(this.response);
} else {
// Something went wrong (404 etc.)
                   reject(new Error(this.statusText));
}
};
           request.onerror = function () {
               reject(new Error(
&apos;XMLHttpRequest Error: &apos;+this.statusText));
};
           request.open(&apos;GET&apos;, url);
           xhr.responseType = responseType;
           request.send();
});
}
</code></pre><p>XMLHttpRequest çš„ API æ˜¯åŸºäºå›è°ƒçš„ã€‚é€šè¿‡ä¸€ä¸ª async(å¼‚æ­¥) å‡½æ•°æ¥å®ç°å®ƒï¼Œæ„å‘³ç€ä½ å¿…é¡»åœ¨å›è°ƒä¸­è¿”å› Promise çš„å®Œæˆ(fulfill) æˆ–æ‹’ç»(reject) çŠ¶æ€ã€‚è¿™æ˜¯ä¸å¯èƒ½çš„ï¼Œå› ä¸ºä½ åªèƒ½é€šè¿‡ <code>return</code> æˆ–è€… <code>throw</code> æ¥å®Œæˆè¿™æ ·çš„æ“ä½œã€‚ä½ ä¸èƒ½ä»å›è°ƒå‡½æ•°å†…éƒ¨ <code>return</code> ä¸€ä¸ªå‡½æ•°çš„ç»“æœã€‚<code>throw</code>ä¹Ÿæœ‰ç±»ä¼¼çš„çº¦æŸã€‚</p>
<p>å› æ­¤ï¼Œå¼‚æ­¥å‡½æ•°çš„é€šç”¨ç¼–ç é£æ ¼æ˜¯ï¼š</p>
<ul>
<li>ç›´æ¥ä½¿ç”¨ Promise å¯¹è±¡æ¥æ„å»ºå¼‚æ­¥åŸè¯­ã€‚</li>
<li>ç”¨å¼‚æ­¥å‡½æ•°æ¥ä½¿ç”¨è¿™äº›åŸè¯­ã€‚</li>
</ul>
<p>æ‰©å±•é˜…è¯»ï¼šâ€œExploring ES6â€ ä¸­çš„ â€œ<a href="https://link.zhihu.com/?target=http%3A//exploringjs.com/es6/ch_promises.html" target="_blank" rel="noopener">å¼‚æ­¥ç¼–ç¨‹ä¸­çš„ Promises å¯¹è±¡</a>â€ ç« èŠ‚</p>
<h2 id="ç«‹å³è°ƒç”¨å¼‚æ­¥å‡½æ•°è¡¨è¾¾å¼"><a href="#ç«‹å³è°ƒç”¨å¼‚æ­¥å‡½æ•°è¡¨è¾¾å¼" class="headerlink" title="ç«‹å³è°ƒç”¨å¼‚æ­¥å‡½æ•°è¡¨è¾¾å¼"></a>ç«‹å³è°ƒç”¨å¼‚æ­¥å‡½æ•°è¡¨è¾¾å¼</h2><p>æœ‰æ—¶ï¼Œå¦‚æœä½ å¯ä»¥åœ¨æ¨¡å—æˆ–è„šæœ¬çš„é¡¶å±‚ä½¿ç”¨ await ï¼Œé‚£å°†æ˜¯ä¸€ç§å¾ˆå¥½çš„é€‰æ‹©ã€‚å½“ç„¶ï¼Œå®ƒåªèƒ½åœ¨å¼‚æ­¥å‡½æ•°ä¸­ä½¿ç”¨ã€‚æ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªå¼‚æ­¥å‡½æ•° <code>main()</code> å¹¶ç«‹å³è°ƒç”¨å®ƒï¼š</p>
<pre><code>async function main() {
   console.log(await asyncFunction());
}
main();
</code></pre><p>æˆ–è€…æ‚¨å¯ä»¥ä½¿ç”¨ç«‹å³è°ƒç”¨å¼‚æ­¥å‡½æ•°è¡¨è¾¾å¼ï¼š</p>
<pre><code>(async function () {
   console.log(await asyncFunction());
})();
</code></pre><p>å¦ä¸€ä¸ªé€‰æ‹©æ˜¯ç«‹å³è°ƒç”¨å¼‚æ­¥ç®­å¤´å‡½æ•°ï¼š</p>
<pre><code>(async () =&gt; {
   console.log(await asyncFunction());
})();
</code></pre><h2 id="ç”¨å¼‚æ­¥å‡½æ•°è¿›è¡Œå•å…ƒæµ‹è¯•"><a href="#ç”¨å¼‚æ­¥å‡½æ•°è¿›è¡Œå•å…ƒæµ‹è¯•" class="headerlink" title="ç”¨å¼‚æ­¥å‡½æ•°è¿›è¡Œå•å…ƒæµ‹è¯•"></a>ç”¨å¼‚æ­¥å‡½æ•°è¿›è¡Œå•å…ƒæµ‹è¯•</h2><p>ä»¥ä¸‹ä»£ç ä½¿ç”¨ <a href="https://link.zhihu.com/?target=https%3A//mochajs.org/" target="_blank" rel="noopener">æµ‹è¯•æ¡†æ¶ mocha</a> å¯¹å¼‚æ­¥å‡½æ•° asyncFun1() å’Œ asyncFun2() æ¥è¿›è¡Œå•å…ƒæµ‹è¯•ï¼š</p>
<pre><code>import assert from &apos;assert&apos;;

// Bug: the following test always succeeds
test(&apos;Testing async code&apos;, function () {
   asyncFunc1() // (A)
.then(result1 =&gt; {
assert.strictEqual(result1, &apos;a&apos;); // (B)
return asyncFunc2();
})
.then(result2 =&gt; {
assert.strictEqual(result2, &apos;b&apos;); // (C)
});
});
</code></pre><p>ç„¶è€Œï¼Œè¿™ä¸ªæµ‹è¯•æ€»æ˜¯æˆåŠŸçš„ï¼Œå› ä¸º mocha ä¸ä¼šç­‰å¾… B è¡Œå’Œ C è¡Œæ–­è¨€æ‰§è¡Œå®Œæˆã€‚</p>
<p>ä½ å¯ä»¥é€šè¿‡è¿”å›é“¾å¼è°ƒç”¨çš„ Promise æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸º mocha ä¼šè¯†åˆ«ä¸€ä¸ªæµ‹è¯•æ˜¯å¦è¿”å›ä¸€ä¸ª Promise ï¼Œç„¶åç­‰å¾…è¯¥ Promise å®Œæˆ å†è¿›è¡Œä¸‹ä¸€æ­¥ï¼ˆé™¤éè¶…æ—¶ï¼‰ã€‚</p>
<pre><code>return asyncFunc1() // (A)
</code></pre><p>å¼‚æ­¥å‡½æ•°æ€»æ˜¯è¿”å› Promises ï¼Œè¿™ä½¿å¾—å®ƒä»¬èƒ½æ–¹ä¾¿çš„ã€å®Œç¾çš„æ¥è¿›è¡Œè¿™ç§å•å…ƒæµ‹è¯•ï¼š</p>
<pre><code>import assert from &apos;assert&apos;;
test(&apos;Testing async code&apos;, async function () {
const result1 = await asyncFunc1();
assert.strictEqual(result1, &apos;a&apos;);
const result2 = await asyncFunc2();
assert.strictEqual(result2, &apos;b&apos;);
});
</code></pre><p>åœ¨ mocha ä¸­ä½¿ç”¨å¼‚æ­¥å•å…ƒæµ‹è¯•å¼‚æ­¥å‡½æ•°æœ‰ä¸¤ä¸ªä¼˜ç‚¹ï¼šä»£ç æ›´ç®€æ´ï¼Œèƒ½å¤Ÿå‡†ç¡®å¤„ç†è¿”å›çš„ Promise å¯¹è±¡ã€‚</p>
<h2 id="ä¸è¦æ‹…å¿ƒæ²¡æœ‰å¤„ç†çš„æ‹’ç»æ‹’æ€"><a href="#ä¸è¦æ‹…å¿ƒæ²¡æœ‰å¤„ç†çš„æ‹’ç»æ‹’æ€" class="headerlink" title="ä¸è¦æ‹…å¿ƒæ²¡æœ‰å¤„ç†çš„æ‹’ç»æ‹’æ€"></a>ä¸è¦æ‹…å¿ƒæ²¡æœ‰å¤„ç†çš„æ‹’ç»æ‹’æ€</h2><p>å½“å‰çš„ JavaScript å¼•æ“å¯ä»¥åœ¨æ‹’ç»æ€æœªå¤„ç†çš„æƒ…å†µä¸‹æå‡ºè­¦å‘Šã€‚ä»¥ä¸‹ä»£ç åœ¨è¿‡å»ä¼šç»å¸¸æ‰§è¡Œå¤±è´¥ï¼Œä½†æ˜¯å½“å‰çš„ JavaScript å¼•æ“å¯ä»¥è¿›è¡Œè­¦å‘Šï¼š</p>
<pre><code>JavaScript ä»£ç :
async function foo() {
throw new Error(&apos;Problem!&apos;);
}
foo();
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/19/for-in-ã€Object-keys-å’ŒObject-getOwnPropertyNames-for-of/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/19/for-in-ã€Object-keys-å’ŒObject-getOwnPropertyNames-for-of/" itemprop="url">(for..in)ã€Object.keys()å’ŒObject.getOwnPropertyNames(),for...of</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-05-19T23:15:50+08:00">
                2018-05-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="https://pic2.zhimg.com/v2-8b77517cd30c95a804e67ebf584d888a_b.jpg" alt=""><img src="https://pic2.zhimg.com/80/v2-8b77517cd30c95a804e67ebf584d888a_hd.jpg" alt=""></p>
<p><img src="https://pic3.zhimg.com/v2-474fc5622ed4a673ef33d34a682250bc_b.jpg" alt=""><img src="https://pic3.zhimg.com/80/v2-474fc5622ed4a673ef33d34a682250bc_hd.jpg" alt=""></p>
<p>Object.keysï¼ˆobjï¼‰ï¼Œè¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„é‡Œæ˜¯è¯¥objå¯è¢«æšä¸¾çš„æ‰€æœ‰å±æ€§ã€‚è¯·çœ‹ç¤ºä¾‹ï¼š</p>
<p>ç¤ºä¾‹ä¸€ï¼š</p>
<pre><code>function Pasta(grain, width, shape) {
          this.grain = grain;
          this.width = width;
          this.shape = shape;
          this.toString = function () {
                  return (this.grain + &quot;, &quot; + this.width + &quot;, &quot; + this.shape);
          }
  }
  console.log(Object.keys(Pasta)); //console: []
  var spaghetti = new Pasta(&quot;wheat&quot;, 0.2, &quot;circle&quot;);
  console.log(Object.keys(spaghetti)); //console: [&quot;grain&quot;, &quot;width&quot;, &quot;shape&quot;, &quot;toString&quot;]
</code></pre><p>ç¤ºä¾‹äºŒï¼š</p>
<pre><code>var arr = [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;];
   console.log(Object.keys(arr)); // console: [&quot;0&quot;, &quot;1&quot;, &quot;2&quot;]
   var obj = { 0 : &quot;a&quot;, 1 : &quot;b&quot;, 2 : &quot;c&quot;};
   console.log(Object.keys(obj)); // console: [&quot;0&quot;, &quot;1&quot;, &quot;2&quot;]
   var an_obj = { 100: &quot;a&quot;, 2: &quot;b&quot;, 7: &quot;c&quot;};
   console.log(Object.keys(an_obj)); // console: [&quot;2&quot;, &quot;7&quot;, &quot;100&quot;]
   var my_obj = Object.create({}, { getFoo : { value : function () { return this.foo } } });
   my_obj.foo = 1;
   console.log(Object.keys(my_obj)); // console: [&quot;foo&quot;]
</code></pre><p>jsä¸­å‡ ç§éå†å¯¹è±¡çš„æ–¹æ³•ï¼ŒåŒ…æ‹¬for inã€Object.keysã€Object.getOwnProperty,å®ƒä»¬åœ¨ä½¿ç”¨åœºæ™¯æ–¹é¢å„æœ‰ä¸åŒã€‚</p>
<p>for in</p>
<p>ä¸»è¦ç”¨äºéå†å¯¹è±¡çš„å¯æšä¸¾å±æ€§ï¼ŒåŒ…æ‹¬è‡ªæœ‰å±æ€§ã€ç»§æ‰¿è‡ªåŸå‹çš„å±æ€§</p>
<pre><code>var obj = {&quot;name&quot;:&quot;Poly&quot;, &quot;career&quot;:&quot;it&quot;}
Object.defineProperty(obj, &quot;age&quot;, {value:&quot;forever 18&quot;, enumerable:false});
Object.prototype.protoPer1 = function(){console.log(&quot;proto&quot;);};
Object.prototype.protoPer2 = 2;
console.log(&quot;For In : &quot;);
for(var a in obj) console.log(a);
</code></pre><p><img src="https://pic4.zhimg.com/v2-07286d25bcdcd379c3da29cf98076e14_b.jpg" alt=""><img src="https://pic4.zhimg.com/80/v2-07286d25bcdcd379c3da29cf98076e14_hd.jpg" alt=""></p>
<p><img src="https://pic4.zhimg.com/v2-ae93be2db86b326d8c5081a88bcf7636_b.jpg" alt=""><img src="https://pic4.zhimg.com/80/v2-ae93be2db86b326d8c5081a88bcf7636_hd.jpg" alt=""></p>
<p>Object.keys</p>
<p>è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œå…ƒç´ å‡ä¸ºå¯¹è±¡è‡ªæœ‰çš„å¯æšä¸¾å±æ€§</p>
<pre><code>var obj = {&quot;name&quot;:&quot;Poly&quot;, &quot;career&quot;:&quot;it&quot;}
Object.defineProperty(obj, &quot;age&quot;, {value:&quot;forever 18&quot;, enumerable:false});
Object.prototype.protoPer1 = function(){console.log(&quot;proto&quot;);};
Object.prototype.protoPer2 = 2;
console.log(&quot;Object.keys:&quot;)
console.log(Object.keys(obj));
</code></pre><p><img src="https://pic1.zhimg.com/v2-a1f7c5f0d6d306c25660d0087ccd477e_b.jpg" alt=""><img src="https://pic1.zhimg.com/80/v2-a1f7c5f0d6d306c25660d0087ccd477e_hd.jpg" alt=""></p>
<p><img src="https://pic4.zhimg.com/v2-fd283ee34f31f9aa9133cd96c0ac3fdd_b.jpg" alt=""><img src="https://pic4.zhimg.com/80/v2-fd283ee34f31f9aa9133cd96c0ac3fdd_hd.jpg" alt=""></p>
<p><img src="https://pic3.zhimg.com/v2-e02bca1186672970087d9a8bc8a5ff08_b.jpg" alt=""><img src="https://pic3.zhimg.com/80/v2-e02bca1186672970087d9a8bc8a5ff08_hd.jpg" alt=""></p>
<p><img src="https://pic2.zhimg.com/v2-65ab14f08c0821aaddf792402b19aeec_b.jpg" alt=""><img src="https://pic2.zhimg.com/80/v2-65ab14f08c0821aaddf792402b19aeec_hd.jpg" alt=""></p>
<p>Object.getOwnProperty</p>
<p>ç”¨äºè¿”å›å¯¹è±¡çš„è‡ªæœ‰å±æ€§ï¼ŒåŒ…æ‹¬å¯æšä¸¾å’Œä¸å¯æšä¸¾çš„</p>
<pre><code>var obj = {&quot;name&quot;:&quot;Poly&quot;, &quot;career&quot;:&quot;it&quot;}
Object.defineProperty(obj, &quot;age&quot;, {value:&quot;forever 18&quot;, enumerable:false});
Object.prototype.protoPer1 = function(){console.log(&quot;proto&quot;);};
Object.prototype.protoPer2 = 2;
console.log(&quot;Object.getOwnPropertyNames: &quot;);
console.log(Object.getOwnPropertyNames(obj));
</code></pre><p><img src="https://pic3.zhimg.com/v2-e58a5ceb8f77c623bd452a5fc8063745_b.jpg" alt=""><img src="https://pic3.zhimg.com/80/v2-e58a5ceb8f77c623bd452a5fc8063745_hd.jpg" alt=""></p>
<p>for..of</p>
<pre><code>var obj = {&quot;name&quot;:&quot;Poly&quot;, &quot;career&quot;:&quot;it&quot;}
Object.defineProperty(obj, &quot;age&quot;, {value:&quot;forever 18&quot;, enumerable:false});
Object.prototype.protoPer1 = function(){console.log(&quot;proto&quot;);};
Object.prototype.protoPer2 = 2;
console.log(&quot;For of : &quot;);
for(var a of Object.entries(obj)) console.log(a);
</code></pre><p><img src="https://pic1.zhimg.com/v2-cb632b12eee1e290befbd61a0da022fd_b.jpg" alt=""></p>
<p><img src="https://pic2.zhimg.com/v2-32223787728e13f239b4f59b0aa64a94_b.jpg" alt=""></p>
<p><img src="https://pic1.zhimg.com/v2-6ce8346c2e1e4479f49c6acf22292fac_b.jpg" alt=""></p>
<p><img src="https://pic1.zhimg.com/v2-ec6d7c3be11ccc0101407a2f40ef803a_b.jpg" alt=""></p>
<p><img src="https://pic3.zhimg.com/v2-84d13fa8dbdace85c39378fd2e9dc09a_b.jpg" alt=""></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/18/æ¢ç´¢webpack-æœºåˆ¶/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/18/æ¢ç´¢webpack-æœºåˆ¶/" itemprop="url">æ¢ç´¢webpack æœºåˆ¶</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-05-18T22:20:52+08:00">
                2018-05-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>æœ¬æ–‡ä»ç®€å•çš„ä¾‹å­å…¥æ‰‹ï¼Œä»æ‰“åŒ…æ–‡ä»¶å»åˆ†æä»¥ä¸‹ä¸‰ä¸ªé—®é¢˜ï¼šwebpackæ‰“åŒ…æ–‡ä»¶æ˜¯æ€æ ·çš„ï¼Ÿå¦‚ä½•åšåˆ°å…¼å®¹å„å¤§æ¨¡å—åŒ–æ–¹æ¡ˆçš„ï¼Ÿwebpack3å¸¦æ¥çš„æ–°ç‰¹æ€§åˆæ˜¯ä»€ä¹ˆï¼Ÿ</p>
<h2 id="ä¸€ä¸ªç®€å•çš„ä¾‹å­"><a href="#ä¸€ä¸ªç®€å•çš„ä¾‹å­" class="headerlink" title="ä¸€ä¸ªç®€å•çš„ä¾‹å­"></a>ä¸€ä¸ªç®€å•çš„ä¾‹å­</h2><p>webpacké…ç½®</p>
<pre><code>// webpack.config.js
module.exports = {
  entry: &apos;./src/index.js&apos;,
  output: {
    filename: &apos;bundle.js&apos;,
    path: path.resolve(__dirname, &apos;dist&apos;)
  },
};
</code></pre><p>ç®€å•çš„jsæ–‡ä»¶</p>
<pre><code>// src/index.js
 console.log(&apos;hello world&apos;);
</code></pre><p>webpackæ‰“åŒ…åçš„ä»£ç </p>
<pre><code>// dist/bundle.js
 /******/ (function(modules) { // webpackBootstrap
/******/     // The module cache
/******/     var installedModules = {};
/******/
/******/     // The require function
/******/     function __webpack_require__(moduleId) {
/******/
/******/         // Check if module is in cache
/******/         if(installedModules[moduleId]) {
/******/             return installedModules[moduleId].exports;
/******/         }
/******/         // Create a new module (and put it into the cache)
/******/         var module = installedModules[moduleId] = {
/******/             i: moduleId,
/******/             l: false,
/******/             exports: {}
/******/         };
/******/
/******/         // Execute the module function
/******/         modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/         // Flag the module as loaded
/******/         module.l = true;
/******/
/******/         // Return the exports of the module
/******/         return module.exports;
/******/     }
/******/
/******/
/******/     // expose the modules object (__webpack_modules__)
/******/     __webpack_require__.m = modules;
/******/
/******/     // expose the module cache
/******/     __webpack_require__.c = installedModules;
/******/
/******/     // define getter function for harmony exports
/******/     __webpack_require__.d = function(exports, name, getter) {
/******/         if(!__webpack_require__.o(exports, name)) {
/******/             Object.defineProperty(exports, name, {
/******/                 configurable: false,
/******/                 enumerable: true,
/******/                 get: getter
/******/             });
/******/         }
/******/     };
/******/
/******/     // getDefaultExport function for compatibility with non-harmony modules
/******/     __webpack_require__.n = function(module) {
/******/         var getter = module &amp;&amp; module.__esModule ?
/******/             function getDefault() { return module[&apos;default&apos;]; } :
/******/             function getModuleExports() { return module; };
/******/         __webpack_require__.d(getter, &apos;a&apos;, getter);
/******/         return getter;
/******/     };
/******/
/******/     // Object.prototype.hasOwnProperty.call
/******/     __webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/     // __webpack_public_path__
/******/     __webpack_require__.p = &quot;&quot;;
/******/
/******/     // Load entry module and return exports
/******/     return __webpack_require__(__webpack_require__.s = 0);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ (function(module, exports) {

console.log(&apos;hello world&apos;);


/***/ })
/******/ ]);
</code></pre><p>ä¸€çœ‹ä½ å°±ä¼šæƒ³ï¼Œæˆ‘å°±ä¸€è¡Œä»£ç ï¼Œä½ ç»™æˆ‘æ‰“åŒ…é‚£ä¹ˆå¤šï¼Ÿï¼Ÿï¼Ÿï¼ˆé»‘äººé—®å·ï¼‰</p>
<p>æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹è¿™éƒ¨åˆ†ä»£ç ï¼Œå…ˆç²¾ç®€ä¸€ä¸‹ï¼Œå…¶å®æ•´ä½“å°±æ˜¯ä¸€ä¸ªè‡ªæ‰§è¡Œå‡½æ•°ï¼Œç„¶åä¼ å…¥ä¸€ä¸ªæ¨¡å—æ•°ç»„</p>
<pre><code>(function(modules) { 
     //...
 })([function(module, exports) {
     //..
 }])
</code></pre><p>å¥½äº†ï¼Œä¼ å…¥æ¨¡å—æ•°ç»„åšäº†ä»€ä¹ˆ(å…¶å®æ³¨é‡Šéƒ½å¾ˆæ˜æ˜¾äº†ï¼Œæˆ‘åªæ˜¯å¤§æ¦‚ç¿»è¯‘ä¸€ä¸‹ï¼‰</p>
<pre><code>/******/ (function(modules) { // webpackBootstrap
/******/     // The module cache  ç¼“å­˜å·²ç»loadè¿‡çš„æ¨¡å—
/******/     var installedModules = {};
/******/
/******/     // The require function  å¼•ç”¨çš„å‡½æ•°
/******/     function __webpack_require__(moduleId) {
/******/
/******/         // Check if module is in cache å‡å¦‚åœ¨ç¼“å­˜é‡Œå°±ç›´æ¥è¿”å›
/******/         if(installedModules[moduleId]) {
/******/             return installedModules[moduleId].exports;
/******/         }
/******/         // Create a new module (and put it into the cache) æ„é€ ä¸€ä¸ªæ¨¡å—å¹¶æ”¾å…¥ç¼“å­˜
/******/         var module = installedModules[moduleId] = {
/******/             i: moduleId, //æ¨¡å—id
/******/             l: false, // æ˜¯å¦å·²ç»åŠ è½½å®Œæ¯•
/******/             exports: {} // å¯¹å¤–æš´éœ²çš„å†…å®¹
/******/         };
/******/
/******/         // Execute the module function ä¼ å…¥æ¨¡å—å‚æ•°ï¼Œå¹¶æ‰§è¡Œæ¨¡å—
/******/         modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/         // Flag the module as loaded æ ‡è®°æ¨¡å—å·²ç»åŠ è½½å®Œæ¯•
/******/         module.l = true;
/******/
/******/         // Return the exports of the module è¿”å›æ¨¡å—æš´éœ²çš„å†…å®¹
/******/         return module.exports;
/******/     }
/******/
/******/
/******/     // expose the modules object (__webpack_modules__) æš´éœ²æ¨¡å—æ•°ç»„
/******/     __webpack_require__.m = modules;
/******/
/******/     // expose the module cache æš´éœ²ç¼“å­˜æ•°ç»„
/******/     __webpack_require__.c = installedModules;
/******/
/******/     // define getter function for harmony exports ä¸ºES6 exportså®šä¹‰getter
/******/     __webpack_require__.d = function(exports, name, getter) {
/******/         if(!__webpack_require__.o(exports, name)) { // å‡å¦‚exportsæœ¬èº«ä¸å«æœ‰nameè¿™ä¸ªå±æ€§
/******/             Object.defineProperty(exports, name, {
/******/                 configurable: false,
/******/                 enumerable: true,
/******/                 get: getter
/******/             });
/******/         }
/******/     };
/******/
/******/     // getDefaultExport function for compatibility with non-harmony modules è§£å†³ES moduleå’ŒCommon js moduleçš„å†²çªï¼ŒESåˆ™è¿”å›module[&apos;default&apos;]
/******/     __webpack_require__.n = function(module) {
/******/         var getter = module &amp;&amp; module.__esModule ?
/******/             function getDefault() { return module[&apos;default&apos;]; } :
/******/             function getModuleExports() { return module; };
/******/         __webpack_require__.d(getter, &apos;a&apos;, getter);
/******/         return getter;
/******/     };
/******/
/******/     // Object.prototype.hasOwnProperty.call
/******/     __webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/     // __webpack_public_path__ webpacké…ç½®ä¸‹çš„å…¬å…±è·¯å¾„
/******/     __webpack_require__.p = &quot;&quot;;
/******/
/******/     // Load entry module and return exports æœ€åæ‰§è¡Œentryæ¨¡å—å¹¶ä¸”è¿”å›å®ƒçš„æš´éœ²å†…å®¹
/******/     return __webpack_require__(__webpack_require__.s = 0);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ (function(module, exports) {

console.log(&apos;hello world&apos;);


/***/ })
/******/ ]);
</code></pre><p>æ•´ä½“æµç¨‹æ˜¯æ€æ ·çš„å‘¢</p>
<ul>
<li>ä¼ å…¥moduleæ•°ç»„</li>
<li><p>è°ƒç”¨<strong>webpack_require</strong>(<strong>webpack_require</strong>.s = 0)</p>
</li>
<li><p>æ„é€ moduleå¯¹è±¡ï¼Œæ”¾å…¥ç¼“å­˜</p>
</li>
<li>è°ƒç”¨module,ä¼ å…¥ç›¸åº”å‚æ•°modules[moduleId].call(module.exports, module, module.exports, <strong>webpack_require</strong>); ï¼ˆè¿™é‡Œexportsä¼šè¢«å‡½æ•°å†…éƒ¨çš„ä¸œè¥¿ä¿®æ”¹ï¼‰</li>
<li>æ ‡è®°moduleå¯¹è±¡å·²ç»åŠ è½½å®Œæ¯•</li>
<li><p>è¿”å›æ¨¡å—æš´éœ²çš„å†…å®¹ï¼ˆæ³¨æ„åˆ°ä¸Šé¢å‡½æ•°ä¼ å…¥äº†module.exports,å¯ä»¥å¯¹å¼•ç”¨è¿›è¡Œä¿®æ”¹ï¼‰</p>
</li>
<li><p>æ¨¡å—å‡½æ•°ä¸­ä¼ å…¥module, module.exports, webpack_require</p>
</li>
<li>æ‰§è¡Œè¿‡ç¨‹ä¸­é€šè¿‡å¯¹ä¸Šé¢ä¸‰è€…çš„å¼•ç”¨ä¿®æ”¹ï¼Œå®Œæˆå˜é‡æš´éœ²å’Œå¼•ç”¨</li>
</ul>
<h2 id="webpackæ¨¡å—æœºåˆ¶æ˜¯æ€æ ·çš„"><a href="#webpackæ¨¡å—æœºåˆ¶æ˜¯æ€æ ·çš„" class="headerlink" title="webpackæ¨¡å—æœºåˆ¶æ˜¯æ€æ ·çš„"></a>webpackæ¨¡å—æœºåˆ¶æ˜¯æ€æ ·çš„</h2><p>æˆ‘ä»¬å¯ä»¥å»å®˜ç½‘çœ‹ä¸‹webpackæ¨¡å—</p>
<blockquote>
<p><a href="https://link.zhihu.com/?target=https%3A//doc.webpack-china.org/concepts/modules%23-webpack-" target="_blank" rel="noopener">https://doc.webpack-china.org/concepts/modules#-webpack-</a><br>webpack æ¨¡å—èƒ½å¤Ÿä»¥å„ç§æ–¹å¼è¡¨è¾¾å®ƒä»¬çš„ä¾èµ–å…³ç³»ï¼Œå‡ ä¸ªä¾‹å­å¦‚ä¸‹ï¼š</p>
</blockquote>
<ul>
<li>ES2015 import è¯­å¥</li>
<li>CommonJS require() è¯­å¥</li>
<li>AMD define å’Œ require è¯­å¥</li>
<li>css/sass/less æ–‡ä»¶ä¸­çš„ @import è¯­å¥ã€‚</li>
<li>æ ·å¼(url(â€¦))æˆ– HTML æ–‡ä»¶(<img src="/2018/05/18/æ¢ç´¢webpack-æœºåˆ¶/...">)ä¸­çš„å›¾ç‰‡é“¾æ¥(image url)</li>
</ul>
<p>å¼ºå¤§çš„webpackæ¨¡å—å¯ä»¥å…¼å®¹å„ç§æ¨¡å—åŒ–æ–¹æ¡ˆï¼Œå¹¶ä¸”æ— ä¾µå…¥æ€§(non-opinionated)</p>
<p>æˆ‘ä»¬å¯ä»¥å†ç¼–å†™ä¾‹å­ä¸€æ¢ç©¶ç«Ÿ</p>
<h2 id="CommonJS"><a href="#CommonJS" class="headerlink" title="CommonJS"></a>CommonJS</h2><p>ä¿®æ”¹src/index.js</p>
<pre><code>var cj = require(&apos;./cj.js&apos;);

console.log(&apos;hello world&apos;);
cj();
</code></pre><p>æ–°å¢src/cj.jsï¼Œä¿æŒå‰é¢ä¾‹å­å…¶ä»–ä¸å˜</p>
<pre><code>// src/cj.js
function a() {
    console.log(&quot;CommonJS&quot;);
}
module.exports = a;
</code></pre><p>å†æ¬¡è¿è¡Œwebpack</p>
<pre><code>/******/ (function(modules) { // webpackBootstrap
  //... çœç•¥ä»£ç 
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ (function(module, exports, __webpack_require__) {

let cj = __webpack_require__(1);

console.log(&apos;hello world&apos;);
cj();


/***/ }),
/* 1 */
/***/ (function(module, exports) {

function a() {
    console.log(&quot;CommonJS&quot;);
}
module.exports = a;


/***/ })
/******/ ]);
</code></pre><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ¨¡å—æ•°ç»„å¤šäº†ä¸ªå¼•å…¥çš„æ–‡ä»¶ï¼Œç„¶åindex.jsæ¨¡å—å‡½æ•°å¤šäº†ä¸ªå‚æ•°<strong>webpack_require</strong>ï¼Œå»å¼•ç”¨æ–‡ä»¶ï¼ˆ<strong>webpack_require</strong>åœ¨ä¸Šä¸€èŠ‚æœ‰ä»‹ç»ï¼‰ï¼Œæ•´ä½“ä¸Šå°±æ˜¯ä¾èµ–çš„æ¨¡å—ä¿®æ”¹äº†module.exportsï¼Œç„¶åä¸»æ¨¡å—æ‰§è¡Œä¾èµ–æ¨¡å—ï¼Œè·å–exportså³å¯</p>
<h2 id="ES2015-import"><a href="#ES2015-import" class="headerlink" title="ES2015 import"></a>ES2015 import</h2><p>æ–°å¢src/es.js</p>
<pre><code>// src/es.js
export default function b() {
    console.log(&apos;ES Modules&apos;);
}
</code></pre><p>ä¿®æ”¹src/index.js</p>
<pre><code>// src/index.js
import es from &apos;./es.js&apos;;

console.log(&apos;hello world&apos;);
es();
</code></pre><p>webpack.config.jsä¸å˜ï¼Œæ‰§è¡Œwebpack</p>
<pre><code>/******/ (function(modules) { // webpackBootstrap
// ... çœç•¥ä»£ç 
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

&quot;use strict&quot;;
Object.defineProperty(__webpack_exports__, &quot;__esModule&quot;, { value: true });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__es_js__ = __webpack_require__(1);


console.log(&apos;hello world&apos;);
Object(__WEBPACK_IMPORTED_MODULE_0__es_js__[&quot;a&quot; /* default */])();


/***/ }),
/* 1 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

&quot;use strict&quot;;
/* harmony export (immutable) */ __webpack_exports__[&quot;a&quot;] = b;
function b() {
    console.log(&apos;ES Modules&apos;);
}


/***/ })
/******/ ]);
</code></pre><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒä»¬éƒ½å˜æˆäº†ä¸¥æ ¼æ¨¡å¼ï¼Œwebpackè‡ªåŠ¨é‡‡ç”¨çš„</p>
<p>è¡¨ç°å…¶å®è·ŸCommonJSç›¸ä¼¼ï¼Œä¹Ÿæ˜¯ä¼ å…¥exportç„¶åä¿®æ”¹ï¼Œåœ¨ä¸»æ¨¡å—å†requireè¿›æ¥ï¼Œ</p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ª</p>
<pre><code>Object.defineProperty(__webpack_exports__, &quot;__esModule&quot;, { value: true });
</code></pre><p>è¿™ä¸ªå¹²å˜›ç”¨çš„ï¼Ÿå…¶å®å°±æ˜¯æ ‡è®°å½“å‰çš„exportsæ˜¯esæ¨¡å—ï¼Œè¿˜è®°å¾—ä¹‹å‰çš„<strong>webpack_require</strong>.nå—ï¼Œæˆ‘ä»¬å†æ‹¿å‡ºæ¥çœ‹çœ‹</p>
<pre><code>/******/     // getDefaultExport function for compatibility with non-harmony modules è§£å†³ES moduleå’ŒCommon js moduleçš„å†²çªï¼ŒESåˆ™è¿”å›module[&apos;default&apos;]
/******/     __webpack_require__.n = function(module) {
/******/         var getter = module &amp;&amp; module.__esModule ?
/******/             function getDefault() { return module[&apos;default&apos;]; } :
/******/             function getModuleExports() { return module; };
/******/         __webpack_require__.d(getter, &apos;a&apos;, getter);
/******/         return getter;
/******/     };
</code></pre><p>ä¸ºäº†é¿å…è·ŸéES Moduleså†²çªï¼Ÿå†²çªåœ¨å“ªé‡Œå‘¢ï¼Ÿ<br>å…¶å®è¿™éƒ¨åˆ†å¦‚æœä½ çœ‹åˆ°babelè½¬æ¢ES Modulesæºç å°±çŸ¥é“äº†ï¼Œä¸ºäº†å…¼å®¹æ¨¡å—ï¼Œä¼šæŠŠES Modulesç›´æ¥æŒ‚åœ¨exports.defaultä¸Šï¼Œç„¶ååŠ ä¸Š__esModuleå±æ€§ï¼Œå¼•å…¥çš„æ—¶å€™åˆ¤æ–­ä¸€æ¬¡æ˜¯å¦æ˜¯è½¬æ¢æ¨¡å—ï¼Œæ˜¯åˆ™å¼•å…¥module[â€˜defaultâ€™]ï¼Œä¸æ˜¯åˆ™å¼•å…¥module</p>
<p>æˆ‘ä»¬å†å¤šå¼•å…¥å‡ ä¸ªES Modulesçœ‹çœ‹æ•ˆæœ</p>
<pre><code>// src/es.js
export function es() {
    console.log(&apos;ES Modules&apos;);
}

export function esTwo() {
    console.log(&apos;ES Modules Two&apos;);
}

export function esThree() {
    console.log(&apos;ES Modules Three&apos;);
}

export function esFour() {
    console.log(&apos;ES Modules Four&apos;);
}
</code></pre><p>æˆ‘ä»¬å¤šå¼•å…¥esTwoå’ŒesFourï¼Œä½†æ˜¯ä¸ä½¿ç”¨esFour</p>
<pre><code>// src/index.js
import { es, esTwo, esFour} from &apos;./es.js&apos;;

console.log(&apos;hello world&apos;);
es();
esTwo();
</code></pre><p>å¾—å‡º</p>
<pre><code>/******/ (function(modules) { // webpackBootstrap
// ...
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

&quot;use strict&quot;;
Object.defineProperty(__webpack_exports__, &quot;__esModule&quot;, { value: true });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__es_js__ = __webpack_require__(1);


console.log(&apos;hello world&apos;);
Object(__WEBPACK_IMPORTED_MODULE_0__es_js__[&quot;a&quot; /* es */])();
Object(__WEBPACK_IMPORTED_MODULE_0__es_js__[&quot;b&quot; /* esTwo */])();


/***/ }),
/* 1 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

&quot;use strict&quot;;
/* harmony export (immutable) */ __webpack_exports__[&quot;a&quot;] = es;
/* harmony export (immutable) */ __webpack_exports__[&quot;b&quot;] = esTwo;
/* unused harmony export esThree */
/* unused harmony export esFour */
function es() {
    console.log(&apos;ES Modules&apos;);
}

function esTwo() {
    console.log(&apos;ES Modules Two&apos;);
}

function esThree() {
    console.log(&apos;ES Modules Three&apos;);
}

function esFour() {
    console.log(&apos;ES Modules Four&apos;);
}



/***/ })
/******/ ]);
</code></pre><p>å—¯å—¯å…¶å®è·Ÿå‰é¢æ˜¯ä¸€æ ·çš„ï¼Œä¸¾å‡ºè¿™ä¸ªä¾‹å­é‡ç‚¹åœ¨å“ªé‡Œå‘¢ï¼Œæœ‰æ²¡æœ‰æ³¨æ„åˆ°æ³¨é‡Šä¸­</p>
<pre><code>/* unused harmony export esThree */
/* unused harmony export esFour */
</code></pre><p>esThreeæ˜¯æˆ‘ä»¬æ²¡æœ‰å¼•å…¥çš„æ¨¡å—ï¼ŒesFouræ˜¯æˆ‘ä»¬å¼•ç”¨ä½†æ˜¯æ²¡æœ‰ä½¿ç”¨çš„æ¨¡å—ï¼Œwebpackå‡å¯¹å®ƒä»¬åšäº†unusedçš„æ ‡è®°ï¼Œå…¶å®è¿™ä¸ªå¦‚æœä½ ä½¿ç”¨äº†webpackæ’ä»¶uglifyï¼Œé€šè¿‡æ ‡è®°ï¼Œå°±ä¼šæŠŠesThreeå’ŒesFourè¿™ä¸¤ä¸ªæœªä½¿ç”¨çš„ä»£ç æ¶ˆé™¤ï¼ˆå…¶å®å®ƒå°±æ˜¯tree-shaking)</p>
<h2 id="AMD"><a href="#AMD" class="headerlink" title="AMD"></a>AMD</h2><p>æˆ‘ä»¬å†æ¥çœ‹çœ‹webpackæ€ä¹ˆæ”¯æŒAMD</p>
<p>æ–°å¢src/amd.js</p>
<pre><code>// src/amd.js
define([
],function(){
    return {
        amd:function(){
            console.log(&apos;AMD&apos;);
        }
    };
});
</code></pre><p>ä¿®æ”¹index.js</p>
<pre><code>// src/index.js
define([
    &apos;./amd.js&apos;
],function(amdModule){
    amdModule.amd();
});
</code></pre><p>å¾—åˆ°</p>
<pre><code>/******/ (function(modules) { // webpackBootstrap
// ... çœç•¥ä»£ç 
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ (function(module, exports, __webpack_require__) {

var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [
    __webpack_require__(1)
], __WEBPACK_AMD_DEFINE_RESULT__ = function(amdModule){
    amdModule.amd();
}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),
                __WEBPACK_AMD_DEFINE_RESULT__ !== undefined &amp;&amp; (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));


/***/ }),
/* 1 */
/***/ (function(module, exports, __webpack_require__) {

var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [
], __WEBPACK_AMD_DEFINE_RESULT__ = function(){
    return {
        amd:function(){
            console.log(&apos;AMD&apos;);
        }
    };
}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),
                __WEBPACK_AMD_DEFINE_RESULT__ !== undefined &amp;&amp; (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));


/***/ })
/******/ ]);
</code></pre><p>å…ˆçœ‹amd.jsæ•´ç†ä¸€ä¸‹ä»£ç </p>
<pre><code>function(module, exports, __webpack_require__) {
    var __WEBPACK_AMD_DEFINE_ARRAY__,
        __WEBPACK_AMD_DEFINE_RESULT__;

    !(
        __WEBPACK_AMD_DEFINE_ARRAY__ = [],

        __WEBPACK_AMD_DEFINE_RESULT__ = function() {
            return {
                amd: function() {
                    console.log(&apos;AMD&apos;);
                }
            };
        }.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),

        __WEBPACK_AMD_DEFINE_RESULT__ !== undefined &amp;&amp;
        (module.exports = __WEBPACK_AMD_DEFINE_RESULT__)

    );
})
</code></pre><p>ç®€å•æ¥è®²æ”¶é›†define Arrayç„¶åç½®å…¥è¿”å›å‡½æ•°ï¼Œæ ¹æ®å‚æ•°è·å–ä¾èµ–</p>
<blockquote>
<p>applyå¯¹æ•°ç»„æ‹†è§£æˆä¸€ä¸ªä¸€ä¸ªå‚æ•°</p>
</blockquote>
<p>å†çœ‹index.jsæ¨¡å—éƒ¨åˆ†</p>
<pre><code>function(module, exports, __webpack_require__) {

    var __WEBPACK_AMD_DEFINE_ARRAY__,
        __WEBPACK_AMD_DEFINE_RESULT__;
    !(
        __WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(1)],
        __WEBPACK_AMD_DEFINE_RESULT__ = function(amdModule) {
                amdModule.amd();
        }.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),

        __WEBPACK_AMD_DEFINE_RESULT__ !== undefined &amp;&amp; 
        (module.exports = __WEBPACK_AMD_DEFINE_RESULT__)
    );
}
</code></pre><p>å…¶å®å°±æ˜¯å¼•å…¥äº†amd.jsæš´éœ²çš„{amd:[Function: amd]}</p>
<h2 id="css-image"><a href="#css-image" class="headerlink" title="css/image?"></a>css/image?</h2><p>csså’Œimageä¹Ÿå¯ä»¥æˆä¸ºwebpackçš„æ¨¡å—ï¼Œè¿™æ˜¯ä»¤äººéœ‡æƒŠçš„ï¼Œè¿™å°±ä¸èƒ½é€šè¿‡æ™®é€šçš„hack commonjsæˆ–è€…å‡½æ•°è°ƒç”¨ç®€å•å»è°ƒç”¨äº†ï¼Œè¿™å°±æ˜¯anything to JSï¼Œå®ƒå°±éœ€è¦å€ŸåŠ©webpack loaderå»å®ç°äº†</p>
<blockquote>
<p>åƒcsså°±æ˜¯è½¬æ¢æˆä¸€æ®µjsä»£ç ï¼Œé€šè¿‡å¤„ç†ï¼Œè°ƒç”¨æ—¶å°±æ˜¯å¯ä»¥ç”¨jså°†è¿™æ®µcssæ’å…¥åˆ°styleä¸­ï¼Œimageä¹Ÿç±»ä¼¼ï¼Œè¿™éƒ¨åˆ†å°±ä¸è¯¦ç»†é˜è¿°äº†ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥æ·±å…¥å»ç ”ç©¶</p>
</blockquote>
<h2 id="webpack3æ–°ç‰¹æ€§"><a href="#webpack3æ–°ç‰¹æ€§" class="headerlink" title="webpack3æ–°ç‰¹æ€§"></a>webpack3æ–°ç‰¹æ€§</h2><p>æˆ‘ä»¬å¯ä»¥å†é¡ºä¾¿çœ‹ä¸‹webpack3æ–°ç‰¹æ€§çš„è¡¨ç°<br>å…·ä½“å¯ä»¥çœ‹è¿™é‡Œ<a href="https://link.zhihu.com/?target=https%3A//medium.com/webpack/webpack-3-official-release-15fd2dd8f07b" target="_blank" rel="noopener">https://medium.com/webpack/webpack-3-official-release-15fd2dd8f07b</a></p>
<h2 id="Scope-Hoisting"><a href="#Scope-Hoisting" class="headerlink" title="Scope Hoisting"></a>Scope Hoisting</h2><p>æˆ‘ä»¬å¯ä»¥å‘ç°æ¨¡å—æ•°ç»„æ˜¯ä¸€ä¸ªä¸€ä¸ªç‹¬ç«‹çš„å‡½æ•°ç„¶åé—­åŒ…å¼•ç”¨webpackä¸»å‡½æ•°çš„ç›¸åº”å†…å®¹ï¼Œæ¯ä¸ªæ¨¡å—éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œç„¶åå¸¦æ¥çš„ç»“æœæ˜¯åœ¨æµè§ˆå™¨ä¸­æ‰§è¡Œé€Ÿåº¦å˜æ…¢ï¼Œç„¶åwebpack3å­¦ä¹ äº†Closure Compilerå’ŒRollupJSè¿™ä¸¤ä¸ªå·¥å…·ï¼Œè¿æ¥æ‰€æœ‰é—­åŒ…åˆ°ä¸€ä¸ªé—­åŒ…é‡Œï¼Œæ”¾å…¥ä¸€ä¸ªå‡½æ•°ï¼Œè®©æ‰§è¡Œé€Ÿåº¦æ›´å¿«,å¹¶ä¸”æ•´ä½“ä»£ç ä½“ç§¯ä¹Ÿä¼šæœ‰æ‰€ç¼©å°</p>
<p>æˆ‘ä»¬å¯ä»¥å®é™…çœ‹ä¸€ä¸‹æ•ˆæœï¼ˆè¦æ³¨æ„çš„æ˜¯è¿™ä¸ªç‰¹æ€§åªæ”¯æŒES Modules,æ˜¯ä¸æ”¯æŒCommonJså’ŒAMDçš„ï¼‰<br>ä½¿ç”¨ä¸Šé¢çš„ä¾‹å­ï¼Œé…ç½®webpack.config.jsï¼Œå¢åŠ new webpack.optimize.ModuleConcatenationPlugin()</p>
<pre><code>const path = require(&apos;path&apos;);
const webpack = require(&apos;webpack&apos;);

module.exports = {
  entry: &apos;./src/index.js&apos;,
  output: {
    filename: &apos;bundle.js&apos;,
    path: path.resolve(__dirname, &apos;dist&apos;)
  },
  module: {
  },
  plugins: [
    new webpack.optimize.ModuleConcatenationPlugin(),
  ]
};
</code></pre><p>æ‰“åŒ…</p>
<pre><code>/******/ (function(modules) { // webpackBootstrap
// ... çœç•¥ä»£ç 
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

&quot;use strict&quot;;
Object.defineProperty(__webpack_exports__, &quot;__esModule&quot;, { value: true });

// CONCATENATED MODULE: ./src/es.js
function es() {
    console.log(&apos;ES Modules&apos;);
}

function esTwo() {
    console.log(&apos;ES Modules Two&apos;);
}

function esThree() {
    console.log(&apos;ES Modules Three&apos;);
}

function esFour() {
    console.log(&apos;ES Modules Four&apos;);
}


// CONCATENATED MODULE: ./src/index.js
// src/index.js


console.log(&apos;hello world&apos;);
es();


/***/ })
/******/ ]);
</code></pre><p>æˆ‘ä»¬å¯ä»¥æƒŠå–œçš„å‘ç°æ²¡æœ‰ä»€ä¹ˆrequireäº†ï¼Œå®ƒä»¬æ‹¼æ¥æˆäº†ä¸€ä¸ªå‡½æ•°ï¼Œgood!?</p>
<h2 id="Magic-Comments"><a href="#Magic-Comments" class="headerlink" title="Magic Comments"></a>Magic Comments</h2><p>code splittingæ˜¯webpackä¸€ä¸ªé‡ç‚¹ç‰¹æ€§ä¹‹ä¸€ï¼Œæ¶‰åŠåˆ°è¦åŠ¨æ€å¼•å…¥çš„æ—¶å€™ï¼Œwebpackå¯ä»¥ä½¿ç”¨ require.ensureå»å®ç°ï¼Œåæ¥webpack2æ”¯æŒä½¿ç”¨äº†ç¬¦åˆ ECMAScript ææ¡ˆ çš„ import() è¯­æ³•ï¼Œä½†æ˜¯å®ƒæœ‰ä¸ªä¸è¶³ä¹‹å¤„ï¼Œæ— æ³•æŒ‡å®šchunkçš„åç§°chunkName,ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå‡ºç°äº†Magic Commentsï¼Œæ”¯æŒç”¨æ³¨é‡Šçš„æ–¹å¼å»æŒ‡å®šï¼Œå¦‚ä¸‹</p>
<pre><code>import(/* webpackChunkName: &quot;my-chunk-name&quot; */ &apos;module&apos;);
</code></pre><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>webpackæ˜¯ä¸€ä¸ªå¼ºå¤§çš„æ¨¡å—æ‰“åŒ…å·¥å…·ï¼Œåœ¨å¤„ç†ä¾èµ–ã€æ¨¡å—ä¸Šéƒ½å¾ˆä¼˜ç§€ï¼Œæœ¬æ–‡ä»bundle.jsæ–‡ä»¶åˆ†æå‡ºå‘å»æ¢ç´¢äº†ä¸åŒæ¨¡å—æ–¹æ¡ˆçš„åŠ è½½æœºåˆ¶ï¼Œåˆæ­¥å»ç†è§£webpackï¼Œå¹¶ä¸”å¯¹webpack3ç‰¹æ€§è¿›è¡Œé˜è¿°ï¼Œå½“ç„¶ï¼Œwebpackè¿˜æœ‰å¾ˆå¤šåœ°æ–¹éœ€è¦å»æ¢ç´¢æ·±ç©¶ï¼Œæ•¬è¯·æœŸå¾…ä»¥åçš„æ–‡ç« å§ï½</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/02/Vueæºç å¿…çŸ¥å¿…ä¼š/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ææ–Œ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuckDay">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/02/Vueæºç å¿…çŸ¥å¿…ä¼š/" itemprop="url">Vueæºç å¿…çŸ¥å¿…ä¼š</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-05-02T16:24:04+08:00">
                2018-05-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>Vue.jsæºç åˆ†æï¼Œè®°å½•äº†ä¸ªäººå­¦ä¹ Vue.jsæºç çš„è¿‡ç¨‹ä¸­çš„ä¸€äº›å¿ƒå¾—ä»¥åŠæ”¶è·ã€‚ä»¥åŠå¯¹äºVueæ¡†æ¶ï¼Œå‘¨è¾¹åº“çš„ä¸€äº›å­¦ä¹ å¿ƒå¾—å’Œä¸ªäººè§è§£ã€‚</p>
<p>åœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­æˆ‘åˆ†åˆ«ä¸ºVue.jsã€Vuexã€Vue-routeråŠ ä¸Šäº†æ³¨é‡Šï¼Œåˆ†åˆ«åœ¨æ–‡ä»¶å¤¹<a href="https://link.zhihu.com/?target=https%3A//github.com/answershuto/learnVue/blob/master/vue-src" target="_blank" rel="noopener">vue-src</a>ã€<a href="https://link.zhihu.com/?target=https%3A//github.com/answershuto/learnVue/blob/master/vuex-src" target="_blank" rel="noopener">vuex-src</a>ä»¥åŠ<a href="https://link.zhihu.com/?target=https%3A//github.com/answershuto/learnVue/blob/master/vue-router-src" target="_blank" rel="noopener">vue-router-src</a>ä¸­ï¼Œå¸Œæœ›å¯ä»¥å¸®åŠ©æœ‰éœ€è¦çš„åŒå­¦æ›´å¥½åœ°å­¦ä¹ ç†è§£Vue.jsåŠå‘¨è¾¹åº“çš„æºç ã€‚</p>
<p>æ„Ÿè°¢å°¤å¤§æé«˜ç”Ÿäº§åŠ›ã€‚</p>
<p>å½“å‰Vue.jsæºç ç‰ˆæœ¬2.3.0ï¼ŒVuexç‰ˆæœ¬ä¸º2.4.0ï¼ŒVue-routerç‰ˆæœ¬ä¸º3.0.1ã€‚</p>
<p>æœ¬é¡¹ç›®å¸Œæœ›å¯¹Vue.jsåšæ›´è¿›ä¸€æ­¥çš„æ¢ç´¢ä¸å­¦ä¹ ï¼ŒVue.jsåŸºç¡€å†…å®¹è¯·å‚è€ƒVue.jså®˜ç½‘ï¼Œ<a href="https://link.zhihu.com/?target=https%3A//cn.vuejs.org/v2/guide/" target="_blank" rel="noopener">https://cn.vuejs.org/v2/guide/</a>ã€‚ å¯èƒ½ä¼šæœ‰ç†è§£å­˜åœ¨åå·®çš„åœ°æ–¹ï¼Œæ¬¢è¿æissueæŒ‡å‡ºï¼Œå…±åŒå­¦ä¹ ï¼Œå…±åŒè¿›æ­¥ã€‚</p>
<h2 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h2><h2 id="æºç ç›¸å…³"><a href="#æºç ç›¸å…³" class="headerlink" title="æºç ç›¸å…³"></a>æºç ç›¸å…³</h2><p><a href="https://link.zhihu.com/?target=https%3A//github.com/answershuto/learnVue/blob/master/docs/%25E5%2593%258D%25E5%25BA%2594%25E5%25BC%258F%25E5%258E%259F%25E7%2590%2586.MarkDown" target="_blank" rel="noopener">Vue.jså“åº”å¼åŸç†</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/answershuto/learnVue/blob/master/docs/%25E4%25BE%259D%25E8%25B5%2596%25E6%2594%25B6%25E9%259B%2586.MarkDown" target="_blank" rel="noopener">Vue.jsä¾èµ–æ”¶é›†</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/answershuto/learnVue/blob/master/docs/%25E4%25BB%258E%25E6%25BA%2590%25E7%25A0%2581%25E8%25A7%2592%25E5%25BA%25A6%25E5%2586%258D%25E7%259C%258B%25E6%2595%25B0%25E6%258D%25AE%25E7%25BB%2591%25E5%25AE%259A.MarkDown" target="_blank" rel="noopener">ä»Vue.jsæºç è§’åº¦å†çœ‹æ•°æ®ç»‘å®š</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/answershuto/learnVue/blob/master/docs/Vue%25E4%25BA%258B%25E4%25BB%25B6%25E6%259C%25BA%25E5%2588%25B6.MarkDown" target="_blank" rel="noopener">Vue.jsäº‹ä»¶æœºåˆ¶</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/answershuto/learnVue/blob/master/docs/VNode%25E8%258A%2582%25E7%2582%25B9.MarkDown" target="_blank" rel="noopener">VNodeèŠ‚ç‚¹(Vue.jså®ç°)</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/answershuto/learnVue/blob/master/docs/VirtualDOM%25E4%25B8%258Ediff%28Vue%25E5%25AE%259E%25E7%258E%25B0%29.MarkDown" target="_blank" rel="noopener">Virtual DOMä¸diff(Vue.jså®ç°)</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/answershuto/learnVue/blob/master/docs/%25E8%2581%258A%25E8%2581%258AVue%25E7%259A%2584template%25E7%25BC%2596%25E8%25AF%2591.MarkDown" target="_blank" rel="noopener">èŠèŠVue.jsçš„templateç¼–è¯‘</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/answershuto/learnVue/blob/master/docs/Vue.js%25E5%25BC%2582%25E6%25AD%25A5%25E6%259B%25B4%25E6%2596%25B0DOM%25E7%25AD%2596%25E7%2595%25A5%25E5%258F%258AnextTick.MarkDown" target="_blank" rel="noopener">Vue.jså¼‚æ­¥æ›´æ–°DOMç­–ç•¥åŠnextTick</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/answershuto/learnVue/blob/master/docs/%25E4%25BB%258Etemplate%25E5%2588%25B0DOM%28Vue.js%25E6%25BA%2590%25E7%25A0%2581%25E8%25A7%2592%25E5%25BA%25A6%25E7%259C%258B%25E5%2586%2585%25E9%2583%25A8%25E8%25BF%2590%25E8%25A1%258C%25E6%259C%25BA%25E5%2588%25B6%29.MarkDown" target="_blank" rel="noopener">ä»templateåˆ°DOMï¼ˆVue.jsæºç è§’åº¦çœ‹å†…éƒ¨è¿è¡Œæœºåˆ¶ï¼‰</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/answershuto/learnVue/blob/master/docs/Vuex%25E6%25BA%2590%25E7%25A0%2581%25E8%25A7%25A3%25E6%259E%2590.MarkDown" target="_blank" rel="noopener">Vuexæºç è§£æ</a></p>
<h2 id="éšç¬”æ‚è°ˆ"><a href="#éšç¬”æ‚è°ˆ" class="headerlink" title="éšç¬”æ‚è°ˆ"></a>éšç¬”æ‚è°ˆ</h2><p><a href="https://link.zhihu.com/?target=https%3A//github.com/answershuto/learnVue/blob/master/docs/Vue%25E7%25BB%2584%25E4%25BB%25B6%25E9%2597%25B4%25E9%2580%259A%25E4%25BF%25A1.MarkDown" target="_blank" rel="noopener">Vueç»„ä»¶é—´é€šä¿¡</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/answershuto/learnVue/blob/master/docs/%25E8%25AF%25B4%25E8%25AF%25B4element%25E7%25BB%2584%25E4%25BB%25B6%25E5%25BA%2593broadcast%25E4%25B8%258Edispatch.MarkDown" target="_blank" rel="noopener">è¯´è¯´elementç»„ä»¶åº“broadcastä¸dispatch</a></p>
<p>è¯¥æºç åˆ†æï¼Œä¼šå¸¦ç€å¤§å®¶ä¸€èµ·å­¦ä¹ <code>Vue</code>çš„å¤§éƒ¨åˆ†ä»£ç ï¼Œè€Œä¸æ˜¯ç®€å•çš„è®²ä¸€ä¸‹å®ƒçš„åŸç†ï¼Œæˆ‘ä¼šå°½å¯èƒ½çš„å¤šè§£é‡Šæ¯ä¸€è¡Œä¸»è¦çš„ä»£ç å«ä¹‰ï¼Œå¦å¤–ä¸€äº›è¾…åŠ©æ–¹æ³•ä»€ä¹ˆçš„ï¼Œå¤§å®¶å¯ä»¥åœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­ï¼Œè‡ªå·±çœ‹ä¸€çœ¼å°±çŸ¥é“äº†ã€‚</p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/Vue%25E6%25BA%2590%25E7%25A0%2581%25E7%259B%25AE%25E5%25BD%2595%25E7%25BB%2593%25E6%259E%2584%25E6%2595%25B4%25E7%2590%2586.md" target="_blank" rel="noopener">Vueæºç ç›®å½•ç»“æ„æ•´ç†</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/%25E4%25BB%258E%25E5%2585%25A5%25E5%258F%25A3%25E6%2596%2587%25E4%25BB%25B6%25E6%259F%25A5%25E7%259C%258BVue%25E6%25BA%2590%25E7%25A0%2581.md" target="_blank" rel="noopener">ä»å…¥å£æ–‡ä»¶æŸ¥çœ‹Vueæºç </a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/%25E4%25BB%258E%25E4%25B8%2580%25E4%25B8%25AA%25E5%25B0%258F%25E6%25A0%2597%25E5%25AD%2590%25E6%259F%25A5%25E7%259C%258BVue%25E7%259A%2584%25E7%2594%259F%25E5%2591%25BD%25E5%2591%25A8%25E6%259C%259F.md" target="_blank" rel="noopener">ä»å°æ —å­æŸ¥çœ‹Vueçš„ç”Ÿå‘½å‘¨æœŸ</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/%25E5%258F%258C%25E5%2590%2591%25E6%2595%25B0%25E6%258D%25AE%25E7%25BB%2591%25E5%25AE%259A.md" target="_blank" rel="noopener">åŒå‘æ•°æ®ç»‘å®š</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/compile%25E6%25A6%2582%25E8%25BF%25B0.md" target="_blank" rel="noopener">compileæ¦‚è¿°</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/compile%25E2%2580%2594%25E2%2580%2594%25E7%2594%259F%25E6%2588%2590ast.md" target="_blank" rel="noopener">compileâ€”â€”ç”Ÿæˆast</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/compile%25E2%2580%2594%25E2%2580%2594%25E4%25BC%2598%25E5%258C%2596%25E9%259D%2599%25E6%2580%2581%25E5%2586%2585%25E5%25AE%25B9.md" target="_blank" rel="noopener">compileâ€”â€”ä¼˜åŒ–é™æ€å†…å®¹</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/compile%25E2%2580%2594%25E2%2580%2594%25E7%2594%259F%25E6%2588%2590render%25E5%25AD%2597%25E7%25AC%25A6%25E4%25B8%25B2.md" target="_blank" rel="noopener">compileâ€”â€”ç”Ÿæˆrenderå­—ç¬¦ä¸²</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/vdom%25E6%25A6%2582%25E8%25BF%25B0.md" target="_blank" rel="noopener">vdomæ¦‚è¿°</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/Vue.extend.md" target="_blank" rel="noopener">Vue.extend</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/vdom%25E2%2580%2594%25E2%2580%2594VNode.md" target="_blank" rel="noopener">vdomâ€”â€”VNode</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/children%25E7%259A%2584%25E5%25BD%2592%25E4%25B8%2580%25E5%258C%2596%25E5%25A4%2584%25E7%2590%2586.md" target="_blank" rel="noopener">childrençš„å½’ä¸€åŒ–å¤„ç†</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/patch%25E2%2580%2594%25E2%2580%2594%25E5%2588%259B%25E5%25BB%25BAdom.md" target="_blank" rel="noopener">patchâ€”â€”åˆ›å»ºdom</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/patch%25E2%2580%2594%25E2%2580%2594diff.md" target="_blank" rel="noopener">patchâ€”â€”diff</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/patch%25E2%2580%2594%25E2%2580%2594%25E8%2587%25AA%25E5%25AE%259A%25E4%25B9%2589%25E7%25BB%2584%25E4%25BB%25B6%25E7%259A%2584%25E5%25A4%2584%25E7%2590%2586%25E6%25B5%2581%25E7%25A8%258B.md" target="_blank" rel="noopener">patchâ€”â€”è‡ªå®šä¹‰ç»„ä»¶çš„å¤„ç†æµç¨‹</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/%25E4%25BA%258B%25E4%25BB%25B6%25E5%25A4%2584%25E7%2590%2586.md" target="_blank" rel="noopener">äº‹ä»¶å¤„ç†</a></p>
<p>æŒ‡ä»¤çš„å¤„ç†</p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/directives%25E6%25A6%2582%25E8%25BF%25B0.md" target="_blank" rel="noopener">directivesæ¦‚è¿°</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/%25E8%2587%25AA%25E5%25AE%259A%25E4%25B9%2589%25E6%258C%2587%25E4%25BB%25A4.md" target="_blank" rel="noopener">è‡ªå®šä¹‰æŒ‡ä»¤</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/v-for.md" target="_blank" rel="noopener">v-for</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/v-if.md" target="_blank" rel="noopener">v-if</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/v-once.md" target="_blank" rel="noopener">v-once</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/v-show.md" target="_blank" rel="noopener">v-show</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/v-text%25E3%2580%2581v-html%25E3%2580%2581v-cloak%25E3%2580%2581v-pre.md" target="_blank" rel="noopener">v-textã€v-htmlã€v-cloakã€v-pre</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/v-model.md" target="_blank" rel="noopener">v-model</a></p>
<p>å†…ç½®ç»„ä»¶å’Œæ ‡ç­¾</p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/slot%25E5%2592%258C%25E4%25BD%259C%25E7%2594%25A8%25E5%259F%259F%25E6%258F%2592%25E6%25A7%25BD.md" target="_blank" rel="noopener">slotå’Œä½œç”¨åŸŸæ’æ§½</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/keep-alive.md" target="_blank" rel="noopener">keep-alive</a></p>
<p>ä»¥ä¸‹æ˜¯æ•´ç†ä¸€äº›æ¯”è¾ƒé›¶æ•£çš„æ•°æ®ï¼Œä¸»è¦æ˜¯è®°å½•ç»“æ„ä¸­æ¯ä¸ªæ•°æ®è¡¨ç¤ºä»€ä¹ˆæ„æ€ï¼Œä¼šä¸æ–­å®Œå–„æ›´æ–°ï¼š</p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/Vue-globals.md" target="_blank" rel="noopener">Vueå…¨å±€å±æ€§</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/Vue%25E5%25AE%259E%25E4%25BE%258B%25E5%25B1%259E%25E6%2580%25A7.md" target="_blank" rel="noopener">Vueå®ä¾‹å±æ€§</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/AstElement.md" target="_blank" rel="noopener">AstElement</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/liutao/vue2.0-source/blob/master/VNode.md" target="_blank" rel="noopener">VNode</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/tx.jpg"
                alt="ææ–Œ" />
            
              <p class="site-author-name" itemprop="name">ææ–Œ</p>
              <p class="site-description motion-element" itemprop="description">æƒ³è¦é£å¾—é«˜ï¼Œé‚£å°±æŠŠåœ°å¹³çº¿å¿˜æ‰</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">109</span>
                  <span class="site-state-item-name">æ—¥å¿—</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">83</span>
                  <span class="site-state-item-name">æ ‡ç­¾</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/libin1991" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="3120217729@qq.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://juejin.im/user/57e737f6c4c971005f6bcd8d" target="_blank" title="juejin">
                      
                        <i class="fa fa-fw fa-spinner"></i>juejin</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ææ–Œ</span>

  
</div>


  <div class="powered-by">ç”± <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">ä¸»é¢˜ &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
<script type="text/javascript" src="/js/src/clicklove.js"></script>

